<?php
if (!class_exists('Phar')) {
    if (!class_exists('PHP_Archive')) {
?><?php
/**
 * PHP_Archive Class (implements .phar)
 *
 * @package PHP_Archive
 * @category PHP
 */
/**
 * PHP_Archive Class (implements .phar)
 *
 * PHAR files a singular archive from which an entire application can run.
 * To use it, simply package it using {@see PHP_Archive_Creator} and use phar://
 * URIs to your includes. i.e. require_once 'phar://config.php' will include config.php
 * from the root of the PHAR file.
 *
 * Gz code borrowed from the excellent File_Archive package by Vincent Lascaux.
 *
 * @copyright Copyright David Shafik and Synaptic Media 2004. All rights reserved.
 * @author Davey Shafik <davey@synapticmedia.net>
 * @author Greg Beaver <cellog@php.net>
 * @link http://www.synapticmedia.net Synaptic Media
 * @version $Id: Archive.php,v 1.52 2007/09/01 20:28:14 cellog Exp $
 * @package PHP_Archive
 * @category PHP
 */
 
class PHP_Archive
{
    const GZ = 0x00001000;
    const BZ2 = 0x00002000;
    const SIG = 0x00010000;
    const SHA1 = 0x0002;
    const MD5 = 0x0001;
    /**
     * Whether this archive is compressed with zlib
     *
     * @var bool
     */
    private $_compressed;
    /**
     * @var string Real path to the .phar archive
     */
    private $_archiveName = null;
    /**
     * Current file name in the phar
     * @var string
     */
    protected $currentFilename = null;
    /**
     * Length of current file in the phar
     * @var string
     */
    protected $internalFileLength = null;
    /**
     * Current file statistics (size, creation date, etc.)
     * @var string
     */
    protected $currentStat = null;
    /**
     * @var resource|null Pointer to open .phar
     */
    protected $fp = null;
    /**
     * @var int Current Position of the pointer
     */
    protected $position = 0;

    /**
     * Map actual realpath of phars to meta-data about the phar
     *
     * Data is indexed by the alias that is used by internal files.  In other
     * words, if a file is included via:
     * <code>
     * require_once 'phar://PEAR.phar/PEAR/Installer.php';
     * </code>
     * then the alias is "PEAR.phar"
     * 
     * Information stored is a boolean indicating whether this .phar is compressed
     * with zlib, another for bzip2, phar-specific meta-data, and
     * the precise offset of internal files
     * within the .phar, used with the {@link $_manifest} to load actual file contents
     * @var array
     */
    private static $_pharMapping = array();
    /**
     * Map real file paths to alias used
     *
     * @var array
     */
    private static $_pharFiles = array();
    /**
     * File listing for the .phar
     * 
     * The manifest is indexed per phar.
     * 
     * Files within the .phar are indexed by their relative path within the
     * .phar.  Each file has this information in its internal array
     *
     * - 0 = uncompressed file size
     * - 1 = timestamp of when file was added to phar
     * - 2 = offset of file within phar relative to internal file's start
     * - 3 = compressed file size (actual size in the phar)
     * @var array
     */
    private static $_manifest = array();
    /**
     * Absolute offset of internal files within the .phar, indexed by absolute
     * path to the .phar
     *
     * @var array
     */
    private static $_fileStart = array();
    /**
     * file name of the phar
     *
     * @var string
     */
    private $_basename;


    /**
     * Default MIME types used for the web front controller
     *
     * @var array
     */
    public static $defaultmimes = array(
            'aif' => 'audio/x-aiff',
            'aiff' => 'audio/x-aiff',
            'arc' => 'application/octet-stream',
            'arj' => 'application/octet-stream',
            'art' => 'image/x-jg',
            'asf' => 'video/x-ms-asf',
            'asx' => 'video/x-ms-asf',
            'avi' => 'video/avi',
            'bin' => 'application/octet-stream',
            'bm' => 'image/bmp',
            'bmp' => 'image/bmp',
            'bz2' => 'application/x-bzip2',
            'css' => 'text/css',
            'doc' => 'application/msword',
            'dot' => 'application/msword',
            'dv' => 'video/x-dv',
            'dvi' => 'application/x-dvi',
            'eps' => 'application/postscript',
            'exe' => 'application/octet-stream',
            'gif' => 'image/gif',
            'gz' => 'application/x-gzip',
            'gzip' => 'application/x-gzip',
            'htm' => 'text/html',
            'html' => 'text/html',
            'ico' => 'image/x-icon',
            'jpe' => 'image/jpeg',
            'jpg' => 'image/jpeg',
            'jpeg' => 'image/jpeg',
            'js' => 'application/x-javascript',
            'log' => 'text/plain',
            'mid' => 'audio/x-midi',
            'mov' => 'video/quicktime',
            'mp2' => 'audio/mpeg',
            'mp3' => 'audio/mpeg3',
            'mpg' => 'audio/mpeg',
            'pdf' => 'aplication/pdf',
            'png' => 'image/png',
            'rtf' => 'application/rtf',
            'tif' => 'image/tiff',
            'tiff' => 'image/tiff',
            'txt' => 'text/plain',
            'xml' => 'text/xml',
        );

    public static $defaultphp = array(
        'php' => true
        );

    public static $defaultphps = array(
        'phps' => true
        );

    public static $deny = array('/.+\.inc$/');

    public static function viewSource($archive, $file)
    {
        // security, idea borrowed from PHK
        if (!file_exists($archive . '.introspect')) {
            header("HTTP/1.0 404 Not Found");
            return false;
        }
        if (self::_fileExists($archive, $_GET['viewsource'])) {
            $source = highlight_file('phar://@ALIAS@/' .
                $_GET['viewsource'], true);
            header('Content-Type: text/html');
            header('Content-Length: ' . strlen($source));
            echo '<html><head><title>Source of ',
                htmlspecialchars($_GET['viewsource']), '</title></head>';
            echo '<body><h1>Source of ',
                htmlspecialchars($_GET['viewsource']), '</h1>';
            if (isset($_GET['introspect'])) {
                echo '<a href="', htmlspecialchars($_SERVER['PHP_SELF']),
                    '?introspect=', urlencode(htmlspecialchars($_GET['introspect'])),
                    '">Return to ', htmlspecialchars($_GET['introspect']), '</a><br />';
            }
            echo $source;
            return false;
        } else {
            header("HTTP/1.0 404 Not Found");
            return false;
        }
        
    }

    public static function introspect($archive, $dir)
    {
        // security, idea borrowed from PHK
        if (!file_exists($archive . '.introspect')) {
            header("HTTP/1.0 404 Not Found");
            return false;
        }
        if (!$dir) {
            $dir = '/';
        }
        $dir = self::processFile($dir);
        if ($dir[0] != '/') {
            $dir = '/' . $dir;
        }
        try {
            $self = htmlspecialchars($_SERVER['PHP_SELF']);
            $iterate = new DirectoryIterator('phar://@ALIAS@' . $dir);
            echo '<html><head><title>Introspect ', htmlspecialchars($dir),
                '</title></head><body><h1>Introspect ', htmlspecialchars($dir),
                '</h1><ul>';
            if ($dir != '/') {
                echo '<li><a href="', $self, '?introspect=',
                    htmlspecialchars(dirname($dir)), '">..</a></li>';
            }
            foreach ($iterate as $entry) {
                if ($entry->isDot()) continue;
                $name = self::processFile($entry->getPathname());
                $name = str_replace('phar://@ALIAS@/', '', $name);
                if ($entry->isDir()) {
                    echo '<li><a href="', $self, '?introspect=',
                        urlencode(htmlspecialchars($name)),
                        '">',
                        htmlspecialchars($entry->getFilename()), '/</a> [directory]</li>';
                } else {
                    echo '<li><a href="', $self, '?introspect=',
                        urlencode(htmlspecialchars($dir)), '&viewsource=',
                        urlencode(htmlspecialchars($name)),
                        '">',
                        htmlspecialchars($entry->getFilename()), '</a></li>';
                }
            }
            return false;
        } catch (Exception $e) {
            echo '<html><head><title>Directory not found: ',
                htmlspecialchars($dir), '</title></head>',
                '<body><h1>Directory not found: ', htmlspecialchars($dir), '</h1>',
                '<p>Try <a href="', htmlspecialchars($_SERVER['PHP_SELF']), '?introspect=/">',
                'This link</a></p></body></html>';
            return false;
        }
    }

    public static function webFrontController($initfile)
    {
        if (isset($_SERVER) && isset($_SERVER['REQUEST_URI'])) {
            $uri = parse_url($_SERVER['REQUEST_URI']);
            $archive = realpath($_SERVER['SCRIPT_FILENAME']);
            $subpath = str_replace('/' . basename($archive), '', $uri['path']);
            if (!$subpath || $subpath == '/') {
                if (isset($_GET['viewsource'])) {
                    return self::viewSource($archive, $_GET['viewsource']);
                }
                if (isset($_GET['introspect'])) {
                    return self::introspect($archive, $_GET['introspect']);
                }
                $subpath = '/' . $initfile;
            }
            if (!self::_fileExists($archive, substr($subpath, 1))) {
                header("HTTP/1.0 404 Not Found");
                return false;
            }
            foreach (self::$deny as $pattern) {
                if (preg_match($pattern, $subpath)) {
                    header("HTTP/1.0 404 Not Found");
                    return false;
                }
            }
            $inf = pathinfo(basename($subpath));
            if (!isset($inf['extension'])) {
                header('Content-Type: text/plain');
                header('Content-Length: ' .
                    self::_filesize($archive, substr($subpath, 1)));
                readfile('phar://@ALIAS@' . $subpath);
                return false;
            }
            if (isset(self::$defaultphp[$inf['extension']])) {
                include 'phar://@ALIAS@' . $subpath;
                return false;
            }
            if (isset(self::$defaultmimes[$inf['extension']])) {
                header('Content-Type: ' . self::$defaultmimes[$inf['extension']]);
                header('Content-Length: ' .
                    self::_filesize($archive, substr($subpath, 1)));
                readfile('phar://@ALIAS@' . $subpath);
                return false;
            }
            if (isset(self::$defaultphps[$inf['extension']])) {
                header('Content-Type: text/html');
                $c = highlight_file('phar://@ALIAS@' . $subpath, true);
                header('Content-Length: ' . strlen($c));
                echo $c;
                return false;
            }
            header('Content-Type: text/plain');
            header('Content-Length: ' .
                    self::_filesize($archive, substr($subpath, 1)));
            readfile('phar://@ALIAS@' . $subpath);
        }
    }

    /**
     * Detect end of stub
     *
     * @param string $buffer stub past '__HALT_'.'COMPILER();'
     * @return end of stub, prior to length of manifest.
     */
    private static final function _endOfStubLength($buffer)
    {
        $pos = 0;
        if (!strlen($buffer)) {
            return $pos;
        }
        if (($buffer[0] == ' ' || $buffer[0] == "\n") && @substr($buffer, 1, 2) == '?>')
        {
            $pos += 3;
            if ($buffer[$pos] == "\r" && $buffer[$pos+1] == "\n") {
                $pos += 2;
            }
            else if ($buffer[$pos] == "\n") {
                $pos += 1;
            }
        }
        return $pos;
    }

    /**
     * Allows loading an external Phar archive without include()ing it
     *
     * @param string $file  phar package to load
     * @param string $alias alias to use
     * @throws Exception
     */
    public static final function loadPhar($file, $alias = NULL)
    {
        $file = realpath($file);
        if ($file) {
            $fp = fopen($file, 'rb');
            $buffer = '';
            while (!feof($fp)) {
                $buffer .= fread($fp, 8192);
                // don't break phars
                if ($pos = strpos($buffer, '__HALT_COMPI' . 'LER();')) {
                    $buffer .= fread($fp, 5);
                    fclose($fp);
                    $pos += 18;
                    $pos += self::_endOfStubLength(substr($buffer, $pos));
                    return self::_mapPhar($file, $pos, $alias);
                }
            }
            fclose($fp);
        }
    }

    /**
     * Map a full real file path to an alias used to refer to the .phar
     *
     * This function can only be called from the initialization of the .phar itself.
     * Any attempt to call from outside the .phar or to re-alias the .phar will fail
     * as a security measure.
     * @param string $alias
     * @param int $dataoffset the value of __COMPILER_HALT_OFFSET__
     */
    public static final function mapPhar($alias = NULL, $dataoffset = NULL)
    {
        try {
            $trace = debug_backtrace();
            $file = $trace[0]['file'];
            // this ensures that this is safe
            if (!in_array($file, get_included_files())) {
                die('SECURITY ERROR: PHP_Archive::mapPhar can only be called from within ' .
                    'the phar that initiates it');
            }
            $file = realpath($file);
            if (!isset($dataoffset)) {
                $dataoffset = constant('__COMPILER_HALT_OFFSET'.'__');
                $fp = fopen($file, 'rb');
                fseek($fp, $dataoffset, SEEK_SET);
                $dataoffset = $dataoffset + self::_endOfStubLength(fread($fp, 5));
                fclose($fp);
            }

            self::_mapPhar($file, $dataoffset);
        } catch (Exception $e) {
            die($e->getMessage());
        }
    }

    /**
     * Sub-function, allows recovery from errors
     *
     * @param unknown_type $file
     * @param unknown_type $dataoffset
     */
    private static function _mapPhar($file, $dataoffset, $alias = NULL)
    {
        $file = realpath($file);
        if (isset(self::$_manifest[$file])) {
            return;
        }
        if (!is_array(self::$_pharMapping)) {
            self::$_pharMapping = array();
        }
        $fp = fopen($file, 'rb');
        // seek to __HALT_COMPILER_OFFSET__
        fseek($fp, $dataoffset);
        $manifest_length = unpack('Vlen', fread($fp, 4));
        $manifest = '';
        $last = '1';
        while (strlen($last) && strlen($manifest) < $manifest_length['len']) {
            $read = 8192;
            if ($manifest_length['len'] - strlen($manifest) < 8192) {
                $read = $manifest_length['len'] - strlen($manifest);
            }
            $last = fread($fp, $read);
            $manifest .= $last;
        }
        if (strlen($manifest) < $manifest_length['len']) {
            throw new Exception('ERROR: manifest length read was "' . 
                strlen($manifest) .'" should be "' .
                $manifest_length['len'] . '"');
        }
        $info = self::_unserializeManifest($manifest);
        if ($info['alias']) {
            $alias = $info['alias'];
            $explicit = true;
        } else {
            if (!isset($alias)) {
                $alias = $file;
            }
            $explicit = false;
        }
        self::$_manifest[$file] = $info['manifest'];
        $compressed = $info['compressed'];
        self::$_fileStart[$file] = ftell($fp);
        fclose($fp);
        if ($compressed & 0x00001000) {
            if (!function_exists('gzinflate')) {
                throw new Exception('Error: zlib extension is not enabled - gzinflate() function needed' .
                    ' for compressed .phars');
            }
        }
        if ($compressed & 0x00002000) {
            if (!function_exists('bzdecompress')) {
                throw new Exception('Error: bzip2 extension is not enabled - bzdecompress() function needed' .
                    ' for compressed .phars');
            }
        }
        if (isset(self::$_pharMapping[$alias])) {
            throw new Exception('ERROR: PHP_Archive::mapPhar has already been called for alias "' .
                $alias . '" cannot re-alias to "' . $file . '"');
        }
        self::$_pharMapping[$alias] = array($file, $compressed, $dataoffset, $explicit,
            $info['metadata']);
        self::$_pharFiles[$file] = $alias;
    }

    /**
     * extract the manifest into an internal array
     *
     * @param string $manifest
     * @return false|array
     */
    private static function _unserializeManifest($manifest)
    {
        // retrieve the number of files in the manifest
        $info = unpack('V', substr($manifest, 0, 4));
        $apiver = substr($manifest, 4, 2);
        $apiver = bin2hex($apiver);
        $apiver_dots = hexdec($apiver[0]) . '.' . hexdec($apiver[1]) . '.' . hexdec($apiver[2]);
        $majorcompat = hexdec($apiver[0]);
        $calcapi = explode('.', self::APIVersion());
        if ($calcapi[0] != $majorcompat) {
            throw new Exception('Phar is incompatible API version ' . $apiver_dots . ', but ' .
                'PHP_Archive is API version '.self::APIVersion());
        }
        if ($calcapi[0] === '0') {
            if (self::APIVersion() != $apiver_dots) {
                throw new Exception('Phar is API version ' . $apiver_dots .
                    ', but PHP_Archive is API version '.self::APIVersion(), E_USER_ERROR);
            }
        }
        $flags = unpack('V', substr($manifest, 6, 4));
        $ret = array('compressed' => $flags & 0x00003000);
        // signature is not verified by default in PHP_Archive, phar is better
        $ret['hassignature'] = $flags & 0x00010000;
        $aliaslen = unpack('V', substr($manifest, 10, 4));
        if ($aliaslen) {
            $ret['alias'] = substr($manifest, 14, $aliaslen[1]);
        } else {
            $ret['alias'] = false;
        }
        $manifest = substr($manifest, 14 + $aliaslen[1]);
        $metadatalen = unpack('V', substr($manifest, 0, 4));
        if ($metadatalen[1]) {
            $ret['metadata'] = unserialize(substr($manifest, 4, $metadatalen[1]));
            $manifest = substr($manifest, 4 + $metadatalen[1]);
        } else {
            $ret['metadata'] = null;
            $manifest = substr($manifest, 4);
        }
        $offset = 0;
        $start = 0;
        for ($i = 0; $i < $info[1]; $i++) {
            // length of the file name
            $len = unpack('V', substr($manifest, $start, 4));
            $start += 4;
            // file name
            $savepath = substr($manifest, $start, $len[1]);
            $start += $len[1];
            // retrieve manifest data:
            // 0 = uncompressed file size
            // 1 = timestamp of when file was added to phar
            // 2 = compressed filesize
            // 3 = crc32
            // 4 = flags
            // 5 = metadata length
            $ret['manifest'][$savepath] = array_values(unpack('Va/Vb/Vc/Vd/Ve/Vf', substr($manifest, $start, 24)));
            $ret['manifest'][$savepath][3] = sprintf('%u', $ret['manifest'][$savepath][3]
                & 0xffffffff);
            if ($ret['manifest'][$savepath][5]) {
                $ret['manifest'][$savepath][6] = unserialize(substr($manifest, $start + 24,
                    $ret['manifest'][$savepath][5]));
            } else {
                $ret['manifest'][$savepath][6] = null;
            }
            $ret['manifest'][$savepath][7] = $offset;
            $offset += $ret['manifest'][$savepath][2];
            $start += 24 + $ret['manifest'][$savepath][5];
        }
        return $ret;
    }

    /**
     * @param string
     */
    private static function processFile($path)
    {
        if ($path == '.') {
            return '';
        }
        $std = str_replace("\\", "/", $path);
        while ($std != ($std = ereg_replace("[^\/:?]+/\.\./", "", $std))) ;
        $std = str_replace("/./", "", $std);
        if (strlen($std) > 1 && $std[0] == '/') {
            $std = substr($std, 1);
        }
        if (strncmp($std, "./", 2) == 0) {
            return substr($std, 2);
        } else {
            return $std;
        }
    }

    /**
     * Seek in the master archive to a matching file or directory
     * @param string
     */
    protected function selectFile($path, $allowdirs = true)
    {
        $std = self::processFile($path);
        if (isset(self::$_manifest[$this->_archiveName][$path])) {
            $this->_setCurrentFile($path);
            return true;
        }
        if (!$allowdirs) {
            return 'Error: "' . $path . '" is not a file in phar "' . $this->_basename . '"';
        }
        foreach (self::$_manifest[$this->_archiveName] as $file => $info) {
            if (empty($std) ||
                  //$std is a directory
                  strncmp($std.'/', $path, strlen($std)+1) == 0) {
                $this->currentFilename = $this->internalFileLength = $this->currentStat = null;
                return true;
            }
        }
        return 'Error: "' . $path . '" not found in phar "' . $this->_basename . '"';
    }

    private function _setCurrentFile($path)
    {
        $this->currentStat = array(
            2 => 0100444, // file mode, readable by all, writeable by none
            4 => 0, // uid
            5 => 0, // gid
            7 => self::$_manifest[$this->_archiveName][$path][0], // size
            9 => self::$_manifest[$this->_archiveName][$path][1], // creation time
            );
        $this->currentFilename = $path;
        $this->internalFileLength = self::$_manifest[$this->_archiveName][$path][2];
        // seek to offset of file header within the .phar
        if (is_resource(@$this->fp)) {
            fseek($this->fp, self::$_fileStart[$this->_archiveName] + self::$_manifest[$this->_archiveName][$path][7]);
        }
    }

    private static function _fileExists($archive, $path)
    {
        return isset(self::$_manifest[$archive]) &&
            isset(self::$_manifest[$archive][$path]);
    }

    private static function _filesize($archive, $path)
    {
        return self::$_manifest[$archive][$path][0];
    }

    /**
     * Seek to a file within the master archive, and extract its contents
     * @param string
     * @return array|string an array containing an error message string is returned
     *                      upon error, otherwise the file contents are returned
     */
    public function extractFile($path)
    {
        $this->fp = @fopen($this->_archiveName, "rb");
        if (!$this->fp) {
            return array('Error: cannot open phar "' . $this->_archiveName . '"');
        }
        if (($e = $this->selectFile($path, false)) === true) {
            $data = '';
            $count = $this->internalFileLength;
            while ($count) {
                if ($count < 8192) {
                    $data .= @fread($this->fp, $count);
                    $count = 0;
                } else {
                    $count -= 8192;
                    $data .= @fread($this->fp, 8192);
                }
            }
            @fclose($this->fp);
            if (self::$_manifest[$this->_archiveName][$path][4] & self::GZ) {
                $data = gzinflate($data);
            } elseif (self::$_manifest[$this->_archiveName][$path][4] & self::BZ2) {
                $data = bzdecompress($data);
            }
            if (!isset(self::$_manifest[$this->_archiveName][$path]['ok'])) {
                if (strlen($data) != $this->currentStat[7]) {
                    return array("Not valid internal .phar file (size error {$size} != " .
                        $this->currentStat[7] . ")");
                }
                if (self::$_manifest[$this->_archiveName][$path][3] != sprintf("%u", crc32($data) & 0xffffffff)) {
                    return array("Not valid internal .phar file (checksum error)");
                }
                self::$_manifest[$this->_archiveName][$path]['ok'] = true;
            }
            return $data;
        } else {
            @fclose($this->fp);
            return array($e);
        }
    }

    /**
     * Parse urls like phar:///fullpath/to/my.phar/file.txt
     *
     * @param string $file
     * @return false|array
     */
    static protected function parseUrl($file)
    {
        if (substr($file, 0, 7) != 'phar://') {
            return false;
        }
        $file = substr($file, 7);
    
        $ret = array('scheme' => 'phar');
        $pos_p = strpos($file, '.phar.php');
        $pos_z = strpos($file, '.phar.gz');
        $pos_b = strpos($file, '.phar.bz2');
        if ($pos_p) {
            if ($pos_z) {
                return false;
            }
            $ret['host'] = substr($file, 0, $pos_p + strlen('.phar.php'));
            $ret['path'] = substr($file, strlen($ret['host']));
        } elseif ($pos_z) {
            $ret['host'] = substr($file, 0, $pos_z + strlen('.phar.gz'));
            $ret['path'] = substr($file, strlen($ret['host']));
        } elseif ($pos_b) {
            $ret['host'] = substr($file, 0, $pos_z + strlen('.phar.bz2'));
            $ret['path'] = substr($file, strlen($ret['host']));
        } elseif (($pos_p = strpos($file, ".phar")) !== false) {
            $ret['host'] = substr($file, 0, $pos_p + strlen('.phar'));
            $ret['path'] = substr($file, strlen($ret['host']));
        } else {
            return false;
        }
        if (!$ret['path']) {
            $ret['path'] = '/';
        }
        return $ret;
    }
    
    /**
     * Locate the .phar archive in the include_path and detect the file to open within
     * the archive.
     *
     * Possible parameters are phar://pharname.phar/filename_within_phar.ext
     * @param string a file within the archive
     * @return string the filename within the .phar to retrieve
     */
    public function initializeStream($file)
    {
        $file = self::processFile($file);
        $info = @parse_url($file);
        if (!$info) {
            $info = self::parseUrl($file);
        }
        if (!$info) {
            return false;
        }
        if (!isset($info['host'])) {
            // malformed internal file
            return false;
        }
        if (!isset(self::$_pharFiles[$info['host']]) &&
              !isset(self::$_pharMapping[$info['host']])) {
            try {
                self::loadPhar($info['host']);
                // use alias from here out
                $info['host'] = self::$_pharFiles[$info['host']];
            } catch (Exception $e) {
                return false;
            }
        }
        if (!isset($info['path'])) {
            return false;
        } elseif (strlen($info['path']) > 1) {
            $info['path'] = substr($info['path'], 1);
        }
        if (isset(self::$_pharMapping[$info['host']])) {
            $this->_basename = $info['host'];
            $this->_archiveName = self::$_pharMapping[$info['host']][0];
            $this->_compressed = self::$_pharMapping[$info['host']][1];
        } elseif (isset(self::$_pharFiles[$info['host']])) {
            $this->_archiveName = $info['host'];
            $this->_basename = self::$_pharFiles[$info['host']];
            $this->_compressed = self::$_pharMapping[$this->_basename][1];
        }
        $file = $info['path'];
        return $file;
    }

    /**
     * Open the requested file - PHP streams API
     *
     * @param string $file String provided by the Stream wrapper
     * @access private
     */
    public function stream_open($file)
    {
        return $this->_streamOpen($file);
    }

    /**
     * @param string filename to opne, or directory name
     * @param bool if true, a directory will be matched, otherwise only files
     *             will be matched
     * @uses trigger_error()
     * @return bool success of opening
     * @access private
     */
    private function _streamOpen($file, $searchForDir = false)
    {
        $path = $this->initializeStream($file);
        if (!$path) {
            trigger_error('Error: Unknown phar in "' . $file . '"', E_USER_ERROR);
        }
        if (is_array($this->file = $this->extractFile($path))) {
            trigger_error($this->file[0], E_USER_ERROR);
            return false;
        }
        if ($path != $this->currentFilename) {
            if (!$searchForDir) {
                trigger_error("Cannot open '$file', is a directory", E_USER_ERROR);
                return false;
            } else {
                $this->file = '';
                return true;
            }
        }

        if (!is_null($this->file) && $this->file !== false) {
            return true;
        } else {
            return false;
        }
    }
    
    /**
     * Read the data - PHP streams API
     *
     * @param int
     * @access private
     */
    public function stream_read($count)
    {
        $ret = substr($this->file, $this->position, $count);
        $this->position += strlen($ret);
        return $ret;
    }
    
    /**
     * Whether we've hit the end of the file - PHP streams API
     * @access private
     */
    function stream_eof()
    {
        return $this->position >= $this->currentStat[7];
    }
    
    /**
     * For seeking the stream - PHP streams API
     * @param int
     * @param SEEK_SET|SEEK_CUR|SEEK_END
     * @access private
     */
    public function stream_seek($pos, $whence)
    {
        switch ($whence) {
            case SEEK_SET:
                if ($pos < 0) {
                    return false;
                }
                $this->position = $pos;
                break;
            case SEEK_CUR:
                if ($pos + $this->currentStat[7] < 0) {
                    return false;
                }
                $this->position += $pos;
                break;
            case SEEK_END:
                if ($pos + $this->currentStat[7] < 0) {
                    return false;
                }
                $this->position = $pos + $this->currentStat[7];
                break;
            default:
                return false;
        }
        return true;
    }
    
    /**
     * The current position in the stream - PHP streams API
     * @access private
     */
    public function stream_tell()
    {
        return $this->position;
    }

    /**
     * The result of an fstat call, returns mod time from creation, and file size -
     * PHP streams API
     * @uses _stream_stat()
     * @access private
     */
    public function stream_stat()
    {
        return $this->_stream_stat();
    }

    /**
     * Retrieve statistics on a file or directory within the .phar
     * @param string file/directory to stat
     * @access private
     */
    public function _stream_stat($file = null)
    {
        $std = $file ? self::processFile($file) : $this->currentFilename;
        if ($file) {
            if (isset(self::$_manifest[$this->_archiveName][$file])) {
                $this->_setCurrentFile($file);
                $isdir = false;
            } else {
                do {
                    $isdir = false;
                    if ($file == '/') {
                        break;
                    }
                    foreach (self::$_manifest[$this->_archiveName] as $path => $info) {
                        if (strpos($path, $file) === 0) {
                            if (strlen($path) > strlen($file) &&
                                  $path[strlen($file)] == '/') {
                                break 2;
                            }
                        }
                    }
                    // no files exist and no directories match this string
                    return false;
                } while (false);
                $isdir = true;
            }
        } else {
            $isdir = false; // open streams must be files
        }
        $mode = $isdir ? 0040444 : 0100444;
        // 040000 = dir, 010000 = file
        // everything is readable, nothing is writeable
        return array(
           0, 0, $mode, 0, 0, 0, 0, 0, 0, 0, 0, 0, // non-associative indices
           'dev' => 0, 'ino' => 0,
           'mode' => $mode,
           'nlink' => 0, 'uid' => 0, 'gid' => 0, 'rdev' => 0, 'blksize' => 0, 'blocks' => 0,
           'size' => $this->currentStat[7],
           'atime' => $this->currentStat[9],
           'mtime' => $this->currentStat[9],
           'ctime' => $this->currentStat[9],
           );
    }

    /**
     * Stat a closed file or directory - PHP streams API
     * @param string
     * @param int
     * @access private
     */
    public function url_stat($url, $flags)
    {
        $path = $this->initializeStream($url);
        return $this->_stream_stat($path);
    }

    /**
     * Open a directory in the .phar for reading - PHP streams API
     * @param string directory name
     * @access private
     */
    public function dir_opendir($path)
    {
        $info = @parse_url($path);
        if (!$info) {
            $info = self::parseUrl($path);
            if (!$info) {
                trigger_error('Error: "' . $path . '" is a file, and cannot be opened with opendir',
                    E_USER_ERROR);
                return false;
            }
        }
        $path = !empty($info['path']) ?
            $info['host'] . $info['path'] : $info['host'] . '/';
        $path = $this->initializeStream('phar://' . $path);
        if (isset(self::$_manifest[$this->_archiveName][$path])) {
            trigger_error('Error: "' . $path . '" is a file, and cannot be opened with opendir',
                E_USER_ERROR);
            return false;
        }
        if ($path == false) {
            trigger_error('Error: Unknown phar in "' . $file . '"', E_USER_ERROR);
            return false;
        }
        $this->fp = @fopen($this->_archiveName, "rb");
        if (!$this->fp) {
            trigger_error('Error: cannot open phar "' . $this->_archiveName . '"');
            return false;
        }
        $this->_dirFiles = array();
        foreach (self::$_manifest[$this->_archiveName] as $file => $info) {
            if ($path == '/') {
                if (strpos($file, '/')) {
                    $a = explode('/', $file);
                    $this->_dirFiles[array_shift($a)] = true;
                } else {
                    $this->_dirFiles[$file] = true;
                }
            } elseif (strpos($file, $path) === 0) {
                $fname = substr($file, strlen($path) + 1);
                if (strpos($fname, '/')) {
                    // this is a directory
                    $a = explode('/', $fname);
                    $this->_dirFiles[array_shift($a)] = true;
                } elseif ($file[strlen($path)] == '/') {
                    // this is a file
                    $this->_dirFiles[$fname] = true;
                }
            }
        }
        @fclose($this->fp);
        if (!count($this->_dirFiles)) {
            return false;
        }
        @uksort($this->_dirFiles, 'strnatcmp');
        return true;
    }

    /**
     * Read the next directory entry - PHP streams API
     * @access private
     */
    public function dir_readdir()
    {
        $ret = key($this->_dirFiles);
        @next($this->_dirFiles);
        if (!$ret) {
            return false;
        }
        return $ret;
    }

    /**
     * Close a directory handle opened with opendir() - PHP streams API
     * @access private
     */
    public function dir_closedir()
    {
        $this->_dirFiles = array();
        return true;
    }

    /**
     * Rewind to the first directory entry - PHP streams API
     * @access private
     */
    public function dir_rewinddir()
    {
        @reset($this->_dirFiles);
        return true;
    }

    /**
     * API version of this class
     * @return string
     */
    public static final function APIVersion()
    {
        return '1.0.0';
    }

    /**
     * Retrieve Phar-specific metadata for a Phar archive
     *
     * @param string $phar full path to Phar archive, or alias
     * @return null|mixed The value that was serialized for the Phar
     *                    archive's metadata
     * @throws Exception
     */
    public static function getPharMetadata($phar)
    {
        if (isset(self::$_pharFiles[$phar])) {
            $phar = self::$_pharFiles[$phar];
        }
        if (!isset(self::$_pharMapping[$phar])) {
            throw new Exception('Unknown Phar archive: "' . $phar . '"');
        }
        return self::$_pharMapping[$phar][4];
    }

    /**
     * Retrieve File-specific metadata for a Phar archive file
     *
     * @param string $phar full path to Phar archive, or alias
     * @param string $file relative path to file within Phar archive
     * @return null|mixed The value that was serialized for the Phar
     *                    archive's metadata
     * @throws Exception
     */
    public static function getFileMetadata($phar, $file)
    {
        if (!isset(self::$_pharFiles[$phar])) {
            if (!isset(self::$_pharMapping[$phar])) {
                throw new Exception('Unknown Phar archive: "' . $phar . '"');
            }
            $phar = self::$_pharMapping[$phar][0];
        }
        if (!isset(self::$_manifest[$phar])) {
            throw new Exception('Unknown Phar: "' . $phar . '"');
        }
        $file = self::processFile($file);
        if (!isset(self::$_manifest[$phar][$file])) {
            throw new Exception('Unknown file "' . $file . '" within Phar "'. $phar . '"');
        }
        return self::$_manifest[$phar][$file][6];
    }

    /**
     * @return list of supported signature algorithmns.
     */
    public static function getsupportedsignatures()
    {
        $ret = array('MD5', 'SHA-1');
        if (extension_loaded('hash')) {
            $ret[] = 'SHA-256';
            $ret[] = 'SHA-512';
        }
        return $ret;
    }
}
?><?php
    }
    if (!in_array('phar', stream_get_wrappers(), true)) {
        stream_wrapper_register('phar', 'PHP_Archive');
    }
}
define('PYRUS_PHAR_FILE', __FILE__);
include 'phar://' . __FILE__ . '/__index.php';
__HALT_COMPILER(); ?>
∏M `         K   s:67:".xmlregistry/packages/pear2.php.net/PEAR2_Pyrus/2.0.0a1-package.xml";   __index.php+  ≠Ø$J+  ¬ŸÕ∂      C   .xmlregistry/packages/pear2.php.net/PEAR2_Pyrus/2.0.0a1-package.xmlÎø ≠Ø$JÎø Û¥…∂      ,   test/pear2.php.net/PEAR2_Pyrus/clean.php.incv  ≠Ø$Jv  ò…^∂      :   test/pear2.php.net/PEAR2_Pyrus/RemotePackage/setup.php.incH  ≠Ø$JH  ‘?°∂      N   test/pear2.php.net/PEAR2_Pyrus/RemotePackage/remotepackage.getmaintainers.phptE
  ≠Ø$JE
  ÄY}∂      F   test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/gooduserfile.phpt  ≠Ø$J  Ë…Ü€∂      I   test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/goodsystemfile2.phptO  ≠Ø$JO  A˙A8∂      E   test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/baduserfile.phptd  ≠Ø$Jd  @k4\∂      I   test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/goodsystemfile3.phpt˚  ≠Ø$J˚  Z®∂      I   test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/goodsystemfile4.phptñ  ≠Ø$Jñ  Z˝f∂      B   test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/defaults.phpt_  ≠Ø$J_  ‘Äa?∂      I   test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/gooduser.mypath.phpt  ≠Ø$J  ûh€∂      B   test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/setup.php.inc¸  ≠Ø$J¸  4¬˙‰∂      G   test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/badsystemfile.phpt*  ≠Ø$J*  +çoﬂ∂      H   test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/goodsystemfile.phptY  ≠Ø$JY  ¢w”Á∂      ?   test/pear2.php.net/PEAR2_Pyrus/Config/userInitialized/test.phptG  ≠Ø$JG  ~ ∂      C   test/pear2.php.net/PEAR2_Pyrus/Config/userInitialized/setup.php.inc#  ≠Ø$J#  πg√∂      G   test/pear2.php.net/PEAR2_Pyrus/Config/setCascadingRegistries/basic.phptÒ	  ≠Ø$JÒ	  ∑íP∂      J   test/pear2.php.net/PEAR2_Pyrus/Config/setCascadingRegistries/setup.php.inc9  ≠Ø$J9  'ıjm∂      H   test/pear2.php.net/PEAR2_Pyrus/Config/setCascadingRegistries/basic2.phptT  ≠Ø$JT  !ßïÛ∂      >   test/pear2.php.net/PEAR2_Pyrus/Config/addConfigValue/test.phptX  ≠Ø$JX  S©∑Ÿ∂      B   test/pear2.php.net/PEAR2_Pyrus/Config/addConfigValue/setup.php.incä   ≠Ø$Jä   ®Å7∂      >   test/pear2.php.net/PEAR2_Pyrus/Config/addConfigValue/fail.phptc  ≠Ø$Jc  x‡.ﬂ∂      H   test/pear2.php.net/PEAR2_Pyrus/Config/__get__set__unset__isset/test.phpt{  ≠Ø$J{  énI∂      I   test/pear2.php.net/PEAR2_Pyrus/Config/__get__set__unset__isset/test3.phpt=  ≠Ø$J=  Rî≠∂      L   test/pear2.php.net/PEAR2_Pyrus/Config/__get__set__unset__isset/setup.php.incä   ≠Ø$Jä   ®Å7∂      I   test/pear2.php.net/PEAR2_Pyrus/Config/__get__set__unset__isset/test2.phptI  ≠Ø$JI  ´Ñ%∂      3   test/pear2.php.net/PEAR2_Pyrus/Config/setup.php.ince   ≠Ø$Je   €i±∂      >   test/pear2.php.net/PEAR2_Pyrus/Config/configSnapshot/test.phptó  ≠Ø$Jó  î™©
∂      B   test/pear2.php.net/PEAR2_Pyrus/Config/configSnapshot/setup.php.incä   ≠Ø$Jä   ®Å7∂      <   test/pear2.php.net/PEAR2_Pyrus/Config/current/singleton.phpt¬  ≠Ø$J¬  ’æ›D∂      H   test/pear2.php.net/PEAR2_Pyrus/Config/constructDefaults/bin_dir.win.phpt™  ≠Ø$J™  –âÇp∂      O   test/pear2.php.net/PEAR2_Pyrus/Config/constructDefaults/extension_dir.env2.phptÎ  ≠Ø$JÎ  DﬂÎ£∂      I   test/pear2.php.net/PEAR2_Pyrus/Config/constructDefaults/bin_dir.env2.phptî  ≠Ø$Jî  °t:Ñ∂      N   test/pear2.php.net/PEAR2_Pyrus/Config/constructDefaults/extension_dir.env.phptq  ≠Ø$Jq  K1ï∂      H   test/pear2.php.net/PEAR2_Pyrus/Config/constructDefaults/bin_dir.env.phpte  ≠Ø$Je  \:´∂      B   test/pear2.php.net/PEAR2_Pyrus/Config/constructDefaults/basic.phptÀ  ≠Ø$JÀ  íiGi∂      N   test/pear2.php.net/PEAR2_Pyrus/Config/constructDefaults/extension_dir.ini.phpt≠  ≠Ø$J≠  +°.¬∂      E   test/pear2.php.net/PEAR2_Pyrus/Config/constructDefaults/setup.php.inc7  ≠Ø$J7  w¨ú∂      )   test/pear2.php.net/PEAR2_Pyrus/.cvsignore!   ≠Ø$J!   ∂†)∂      U   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/parseName/parsename.phpt¬	  ≠Ø$J¬	  w¿È“∂      X   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/delete/delete.readonly.phptK  ≠Ø$JK  ÎÒπ∂      Q   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/delete/internal.phptD  ≠Ø$JD  ©ﬂp∂      Q   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/delete/external.phpt€  ≠Ø$J€  ò,Îõ∂      Y   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/delete/delete.installed.phpt  ≠Ø$J  fv6∂      X   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/exists/strict_internal.phpt#  ≠Ø$J#  `!‰c∂      X   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/exists/strict_external.phptm  ≠Ø$Jm  Ì√_∂      Q   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/exists/internal.phpt¬  ≠Ø$J¬  ÷”˝<∂      Q   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/exists/external.phpt≥  ≠Ø$J≥  ·¥6∂      P   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/info/basic.template‘  ≠Ø$J‘  ≈öMu∂      O   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/info/rest.template≥  ≠Ø$J≥  áÈQ∂      R   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/info/mirrors.templateù  ≠Ø$Jù   ¬∂      V   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/listChannels/default.phpt∞  ≠Ø$J∞  $vΩq∂      I   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/add/add.phpt;  ≠Ø$J;  qßûO∂      R   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/add/add.readonly.phptC  ≠Ø$JC  ¸ÈoÓ∂      X   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/update/update.readonly.phptV  ≠Ø$JV  }aR∂      O   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/update/update.phpt  ≠Ø$J  (˘ô∂      P   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/delete/delete.readonly.phpt6  ≠Ø$J6  ç¨†8∂      I   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/delete/internal.phpt3  ≠Ø$J3  È¿” ∂      I   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/delete/external.phptq  ≠Ø$Jq  •-ùJ∂      Q   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/delete/delete.installed.phpt˘  ≠Ø$J˘  ◊pø∂      B   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/setup.php.incW  ≠Ø$JW   *’∂      N   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/listChannels/default.phpt∫  ≠Ø$J∫  ‹ì∂      A   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/add/add.phpt/  ≠Ø$J/  j|ƒ˛∂      J   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/add/add.readonly.phpt-  ≠Ø$J-  íè´∂      P   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/update/update.readonly.phpt6  ≠Ø$J6  ùáÖ∂      G   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/update/update.phptÁ  ≠Ø$JÁ  gßÊÃ∂      A   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/sample_channel.xml‹  ≠Ø$J‹  Ÿ#é¥∂      N   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/delete/delete.readonly.phpt0  ≠Ø$J0  ÌïUÈ∂      G   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/delete/internal.phpt1  ≠Ø$J1  ˚Å<ı∂      G   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/delete/external.phpto  ≠Ø$Jo  bÈÑ∂      O   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/delete/delete.installed.phpt˜  ≠Ø$J˜  ûXÓX∂      @   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/setup.php.incU  ≠Ø$JU  Ù€∏∂      L   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/listChannels/default.phpt∏  ≠Ø$J∏  3•#í∂      ?   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/add/add.phpt-  ≠Ø$J-  ›RHt∂      H   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/add/add.readonly.phpt'  ≠Ø$J'  8û‘E∂      N   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/update/update.readonly.phpt0  ≠Ø$J0  ∂†˚µ∂      E   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/update/update.phptÂ  ≠Ø$JÂ  e3*∂      J   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/sample_channel_complex2.xmlµ  ≠Ø$Jµ  dße∂      I   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/sample_channel_complex.xml∂  ≠Ø$J∂  “9>∂      E   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/sample_ssl_channel.xml  ≠Ø$J  DƒKb∂      R   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/delete/delete.readonly.phpt<  ≠Ø$J<  €Ô¯§∂      K   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/delete/internal.phpt5  ≠Ø$J5  a7ì ∂      K   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/delete/external.phpts  ≠Ø$Js  Ω √π∂      S   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/delete/delete.installed.phpt˚  ≠Ø$J˚  ®O¡Q∂      D   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/setup.php.incY  ≠Ø$JY  =öä∂      P   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/listChannels/default.phptº  ≠Ø$Jº  Æ˚Õﬁ∂      C   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/add/add.phpt1  ≠Ø$J1  Päh‘∂      L   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/add/add.readonly.phpt3  ≠Ø$J3  )˘MH∂      R   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/update/update.readonly.phpt<  ≠Ø$J<  »Q »∂      I   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/update/update.phptÈ  ≠Ø$JÈ  è¥Õù∂      <   test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/setup.php.inc@   ≠Ø$J@   Â*≈ç∂      5   test/pear2.php.net/PEAR2_Pyrus/XMLWriter/attribs.phpt  ≠Ø$J  ™u&Œ∂      >   test/pear2.php.net/PEAR2_Pyrus/XMLWriter/childtag_attribs.phptò  ≠Ø$Jò  ∞¯‘∂      F   test/pear2.php.net/PEAR2_Pyrus/XMLWriter/childtag_sibling_attribs.phpt—  ≠Ø$J—  nÄ–Ó∂      :   test/pear2.php.net/PEAR2_Pyrus/XMLWriter/recursivetag.phpt  ≠Ø$J  ™°[∂      >   test/pear2.php.net/PEAR2_Pyrus/XMLWriter/childtag_content.phptX  ≠Ø$JX  í.,∂      3   test/pear2.php.net/PEAR2_Pyrus/XMLWriter/empty.phpt  ≠Ø$J  ]~x,∂      6   test/pear2.php.net/PEAR2_Pyrus/XMLWriter/setup.php.incÖ   ≠Ø$JÖ   ?>Ú*∂      6   test/pear2.php.net/PEAR2_Pyrus/XMLWriter/childtag.phpt4  ≠Ø$J4  5N≈∂      =   test/pear2.php.net/PEAR2_Pyrus/XMLWriter/attribs_content.phptá  ≠Ø$Já  7-BÃ∂      9   test/pear2.php.net/PEAR2_Pyrus/XMLWriter/siblingtags.phptK  ≠Ø$JK  vqa∂      k   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateDownloadedPackage/downloadedpackage.simple.phptò  ≠Ø$Jò  £œJy∂      r   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateDownloadedPackage/downloadedpackage.fail.optional.phpt   ≠Ø$J   gK…≠∂      m   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateDownloadedPackage/downloadedpackage.optional.phptR  ≠Ø$JR  Ω^`∂      m   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateDownloadedPackage/downloadedpackage.required.phptP  ≠Ø$JP  ™I|B∂      x   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateDownloadedPackage/downloadedpackage.optional.subpackage.phptX  ≠Ø$JX  ◊:∆
∂      o   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateDownloadedPackage/downloadedpackage.downloaded.phptU  ≠Ø$JU  √†à∂      x   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateDownloadedPackage/downloadedpackage.required.subpackage.phptV  ≠Ø$JV  [õ4∂      Ü   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.noversion.conflicts.phpt∂  ≠Ø$J∂  DÚÈâ∂      Ç   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.noversion.force.phpty  ≠Ø$Jy  Åµµˆ∂      Ñ   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.max.force.phptn  ≠Ø$Jn  Kl†∂      Ä   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.force.phptØ  ≠Ø$JØ  Òˇ¶m∂      m   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.installed.phpt   ≠Ø$J   {Ú]È∂      ç   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.recommended.nodeps.phptò  ≠Ø$Jò  *˙„∂      é   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.min.force.phptê  ≠Ø$Jê  ˝	–∂      ì   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.exclude.nodeps.phpt≤  ≠Ø$J≤  ¶l¯∂      é   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.max.force.phptê  ≠Ø$Jê  aF%∂      å   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.noversion.conflicts.force.phpt  ≠Ø$J  ø$-˜∂      å   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.exclude.phptk  ≠Ø$Jk  ï!Ã∂      ~   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.min.phpt)  ≠Ø$J)  ^ì∞0∂      É   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.installed.version.conflicts.max.phptÉ  ≠Ø$JÉ  NéÊ}∂      Å   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.installed.version.recommended.phptÒ  ≠Ø$JÒ  ‘$ΩJ∂      è   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.min.nodeps.phptí  ≠Ø$Jí  ë@Å∂      à   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.min.phptK  ≠Ø$JK  ]Ì˘q∂      Ç   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.exclude.phptP  ≠Ø$JP  mÉâ∂      ã   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.providesextension.loaded.extversionless.phptÅ  ≠Ø$JÅ  1‰Öì∂      ç   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.noversion.conflicts.nodeps.phpt	  ≠Ø$J	  ZD~—∂      w   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.installed.noversion.phptÎ  ≠Ø$JÎ  ™#∂n∂         test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.downloading.noversion.valid.phpt9  ≠Ø$J9  ó£Ä∂      Ç   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.providesextension.notinstalled.phpt  ≠Ø$J  «;À∂      ~   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.max.phpt)  ≠Ø$J)  ≤Ñk∆∂         test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.providesextension.installed.phpt^  ≠Ø$J^  q[c∂      å   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.recommended.force.phptñ  ≠Ø$Jñ  ﬂ4x±∂      à   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.max.phptK  ≠Ø$JK  ±x’ï∂      Ñ   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.min.force.phptn  ≠Ø$Jn  ›Hn~∂      â   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.exclude.nodeps.phptñ  ≠Ø$Jñ  ©ÊDf∂      É   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.noversion.nodeps.phpt{  ≠Ø$J{  â†'∂      à   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.exclude.force.phptî  ≠Ø$Jî  ’Öú:∂      è   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.max.nodeps.phptí  ≠Ø$Jí  ê|m‡∂      {   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.noversion.php4  ≠Ø$J4  ¸îπö∂      Ö   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.min.nodeps.phptq  ≠Ø$Jq  ,Gp€∂         test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.installed.version.conflicts.phptÉ  ≠Ø$JÉ  ŸÉõ—∂      í   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.exclude.force.phpt∞  ≠Ø$J∞  ]¶ˆ∂      Ö   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.max.nodeps.phptp  ≠Ø$Jp  -§Õ
∂      Ç   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.notinstalled.version.conflicts.phpts  ≠Ø$Js  ∆qV=∂      Ü   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.recommended.phptÄ  ≠Ø$JÄ  £πΩõ∂      Å   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.nodeps.phpt±  ≠Ø$J±  íC˙/∂      u   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.downloading.valid.phptÿ  ≠Ø$Jÿ  Üàx∂      z   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.phptj  ≠Ø$Jj  7_<®∂      á   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.installed.version.conflicts.exclude.phpt´  ≠Ø$J´  dÑ31∂      i   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePearinstallerDependency/pearinstallerdep.phpt£  ≠Ø$J£  +÷√<∂      E   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validator.php.inc∑  ≠Ø$J∑  Hµ€*∂      É   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.exclude.nodeps.phptç  ≠Ø$Jç  ãà[∂      |   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.noversion.force.phptj  ≠Ø$Jj  éÊ«V∂      å   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.exclude.force.phptß  ≠Ø$Jß  Ç∞Ç∂      á   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.installed.version.installed.conflicts.max.phptz  ≠Ø$Jz  Áoã∂      Ö   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.providesextension.loaded.extversionless.phptl  ≠Ø$Jl  ¡R°	∂      â   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.min.nodeps.phptâ  ≠Ø$Jâ  UG€-∂      q   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.installed.noversion.phptﬂ  ≠Ø$Jﬂ  SÁÈ∂      É   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.installed.version.installed.conflicts.phptz  ≠Ø$Jz  VÆt‰∂      ~   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.min.force.phpte  ≠Ø$Je  húb∂      Ü   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.noversion.conflicts.force.phpt˚  ≠Ø$J˚  &‰^∂      à   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.min.force.phptá  ≠Ø$Já  ù#F+∂      á   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.noversion.conflicts.nodeps.phpt˝  ≠Ø$J˝  ≥É∂      Ç   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.max.phptB  ≠Ø$JB  ÂµM∂      x   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.min.phpt   ≠Ø$J   îŒrj∂      g   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.installed.phptµ  ≠Ø$Jµ  %Ô ∂      x   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.max.phpt   ≠Ø$J   „ÓU∂      Ü   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.installed.version.notinstalled.conflicts.phptj  ≠Ø$Jj  £Zr∂      Ç   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.min.phptB  ≠Ø$JB  ﬂ"U∂      }   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.noversion.nodeps.phptl  ≠Ø$Jl  Æ|ﬁ∂      ã   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.installed.version.installed.conflicts.exclude.phpt¢  ≠Ø$J¢  Ø–∂      ~   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.max.force.phpte  ≠Ø$Je  J#Î‚∂      |   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.exclude.phptG  ≠Ø$JG  x|ﬂ∂      á   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.recommended.nodeps.phptè  ≠Ø$Jè  $uÈ∂      o   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.downloading.valid.phpt√  ≠Ø$J√  ô Q»∂      Ü   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.recommended.force.phptç  ≠Ø$Jç  3íÏ∂      |   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.providesextension.notinstalled.phpt¸  ≠Ø$J¸  
Lﬂ∂         test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.min.nodeps.phpth  ≠Ø$Jh  ¡˜ë∂      Ä   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.recommended.phptw  ≠Ø$Jw  C¨_—∂      {   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.nodeps.phpt¢  ≠Ø$J¢  A˝W´∂      Ü   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.exclude.phptb  ≠Ø$Jb  ‘í,§∂      y   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.downloading.noversion.valid.phpt0  ≠Ø$J0  ß÷ÚÄ∂      Ç   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.exclude.force.phptã  ≠Ø$Jã  L¥É<∂      z   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.force.phpt†  ≠Ø$J†  Ñ<∂      y   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.providesextension.installed.phptL  ≠Ø$JL  óOÚ∂      à   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.max.force.phptá  ≠Ø$Já  ÇEw@∂      ç   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.exclude.nodeps.phpt©  ≠Ø$J©  HØ∂      {   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.installed.version.recommended.phptË  ≠Ø$JË  …^ˆ∂         test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.max.nodeps.phptg  ≠Ø$Jg  $	ã)∂      v   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.noversion.phpt%  ≠Ø$J%  ˆ˚ãP∂      t   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.phpt[  ≠Ø$J[  «£	3∂      Ä   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.noversion.conflicts.phpt™  ≠Ø$J™  CwÓ∂      â   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.max.nodeps.phptâ  ≠Ø$Jâ  e†5∂      q   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.notloaded.force.phpt  ≠Ø$J  Õ_5/∂      r   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.noversion.nodeps.phpt  ≠Ø$J  ≥ ^∂      p   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.max.fail.force.phpt,  ≠Ø$J,  ·jH3∂      y   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.recommended.fail.nodeps.phptÅ  ≠Ø$JÅ  Çê#∂      q   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.noversion.force.phpt  ≠Ø$J  ê}@∂      u   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.exclude.fail.nodeps.phptA  ≠Ø$JA  ‘Å¡∞∂      p   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.min.fail.force.phpt,  ≠Ø$J,  l+¸∂      k   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.notloaded.phptÃ  ≠Ø$JÃ  ™/ÈÃ∂      r   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.notloaded.nodeps.phpt  ≠Ø$J  YXÈ∂      n   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.exclude.fail.phptÓ  ≠Ø$JÓ  9'°B∂      n   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.loaded.valid.phpt  ≠Ø$J  r≠·ä∂      x   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.recommended.fail.force.phpt  ≠Ø$J  ~ò}t∂      t   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.exclude.fail.force.phpt?  ≠Ø$J?  Uxπ∂      j   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.min.fail.phpt€  ≠Ø$J€  ·∂.&∂      q   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.max.fail.nodeps.phpt.  ≠Ø$J.  ÁÜL∂      k   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.noversion.phpt%  ≠Ø$J%  ﬁpl∂      w   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.loaded.extversionless.phpt
  ≠Ø$J
  .I¢n∂      q   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.min.fail.nodeps.phpt.  ≠Ø$J.  ÎX}∂      r   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.recommended.fail.phpti  ≠Ø$Ji  ¸«¿≤∂      x   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.notdownload.or.install.phptb  ≠Ø$Jb  6íÄ∂      j   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.max.fail.phpt€  ≠Ø$J€  yQ∞ˇ∂      K   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/setup.uninstall.php.inc*  ≠Ø$J*  oX'∂      [   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateOsDependency/osdep.windows.phpt‘  ≠Ø$J‘  e8a8∂      a   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateOsDependency/osdep.windows.force.phpt/  ≠Ø$J/  ít∂      Z   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateOsDependency/osdep.nodeps.phptÅ  ≠Ø$JÅ  éL^∂      Y   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateOsDependency/osdep.extra.phpt/  ≠Ø$J/  —O∂      S   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateOsDependency/osdep.phpt  ≠Ø$J  0ÂP∂      U   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePhpDependency/phpdep.phpt'  ≠Ø$J'  ∏Âê˚∂      W   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateArchDependency/archdep.phptg  ≠Ø$Jg  ±4Ù˛∂      ]   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateArchDependency/archdep.extra.phpt>  ≠Ø$J>  &†1N∂      A   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/setup.php.inc(  ≠Ø$J(  å;J∂      g   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.max.phpt  ≠Ø$J  =©«∂      q   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.exclude.force.phptW  ≠Ø$JW  œ:˝≈∂      q   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.noconflict.exclude.phpt@  ≠Ø$J@  ªT<˝∂      h   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.optional2.phpt2  ≠Ø$J2  ø\∞u∂      m   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.min.force.phptG  ≠Ø$JG  ¬$S∂      l   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.required.phptˆ  ≠Ø$Jˆ  b∞9⁄∂      n   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.max.nodeps.phptI  ≠Ø$JI  vQw<∂      r   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.noconflict.exclude2.phpt(  ≠Ø$J(  Î’ój∂      g   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.optional.phpt  ≠Ø$J  ıp †∂      s   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.required.nodeps.phpt=  ≠Ø$J=  ˝~s}∂      m   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.max.force.phptG  ≠Ø$JG  6¢∂      k   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.exclude.phpt  ≠Ø$J  «≈Ÿ⁄∂      r   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.exclude.nodeps.phptY  ≠Ø$JY  !ø\•∂      g   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.min.phpt  ≠Ø$J  *P9∂      n   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.min.nodeps.phptI  ≠Ø$JI  ﬁwˆ∂      r   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.required.force.phpt;  ≠Ø$J;  ñ‡¨Q∂      s   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.noconflict.conflicts.phpt&  ≠Ø$J&  …o#ˇ∂      i   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.noconflict.phpt  ≠Ø$J  ≤•…V∂      J   test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/setup.registry.php.inc2  ≠Ø$J2  ‰´)∂      Q   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.alpha.00.0.0.phptÇ  ≠Ø$JÇ  à™’J∂      P   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.alpha.1.0.1.phpt≠  ≠Ø$J≠  áê¢¸∂      H   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.alpha.0.3.4.phpt´  ≠Ø$J´  Íd˚_∂      W   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.stable.rcalphabeta.phpt   ≠Ø$J   îós3∂      P   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.alpha.2.0.0.phptﬁ  ≠Ø$Jﬁ  3tgt∂      J   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.validsnapshot.phpt≤  ≠Ø$J≤  Üñ!i∂      X   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.extends.alpha.2.0.1.phptØ  ≠Ø$JØ  ≈§Ô˝∂      Y   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.extends.alpha.00.1.0.phptî  ≠Ø$Jî  Tw≥å∂      X   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.extends.alpha.2.0.0.phpt¢  ≠Ø$J¢  ˙B–W∂      S   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.extends.stable.phptç  ≠Ø$Jç  äG73∂      X   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.extends.alpha.0.1.0.phptœ  ≠Ø$Jœ  êT™‚∂      P   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.devel.1.0.0.phpt]  ≠Ø$J]  ç!î∏∂      Q   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.stable.0.9.0.phptv  ≠Ø$Jv  Í⁄=È∂      H   test/pear2.php.net/PEAR2_Pyrus/Validate/validatepackagename.failure.phpt  ≠Ø$J  3Á◊Ì∂      H   test/pear2.php.net/PEAR2_Pyrus/Validate/validatepackagename.extends.phpt  ≠Ø$J  ˇ
†∂      R   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.alpha.1.0.000.phptÇ  ≠Ø$JÇ  4ÒC‘∂      P   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.alpha.1.0.0.phpt~  ≠Ø$J~  "ÆXœ∂      S   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.invalidversion.phpt@  ≠Ø$J@  x˜∞∂      Z   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.extends.alpha.2.0.000.phpt¶  ≠Ø$J¶  ÛË∂      S   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.alpha.1.0.0001.phptá  ≠Ø$Já  ±YE∂      Q   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.stable.2.0.0.phpt•  ≠Ø$J•  Ù œ¥∂      N   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.2decimals.phpt]  ≠Ø$J]  ¬íˆ∂      =   test/pear2.php.net/PEAR2_Pyrus/Validate/validpackagename.phpt;  ≠Ø$J;  |øå∂      R   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.extends.alpha.phptÑ  ≠Ø$JÑ  Ø¿+1∂      5   test/pear2.php.net/PEAR2_Pyrus/Validate/setup.php.inc@   ≠Ø$J@   Â*≈ç∂      P   test/pear2.php.net/PEAR2_Pyrus/Validate/validatepackagename.extends.failure.phptW  ≠Ø$JW  3Ês∂      R   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.alpha.extends.2.0.0a1.phpt   ≠Ø$J   m‹lz∂      K   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.00.0.0.phptV  ≠Ø$JV  _çôK∂      [   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.extends.alpha.2.0.0001.phpt´  ≠Ø$J´  Å∂      N   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.packaging.phptÕ  ≠Ø$JÕ  Ø⁄K∂      F   test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.validbeta.phptü  ≠Ø$Jü  Ô&˜∂      G   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/src/PEAR2/MultiErrors.php   ≠Ø$J   zzoÌ∂      E   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/src/PEAR2/Exception.php   ≠Ø$J   zzoÌ∂      D   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/src/PEAR2/Autoload.php   ≠Ø$J   zzoÌ∂      Q   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/src/PEAR2/MultiErrors/Exception.php   ≠Ø$J   zzoÌ∂      W   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/channel.xml∏  ≠Ø$J∏  ÍU¬U∂      T   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/make.php)  ≠Ø$J)  y≤∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/m/allmaintainers.xmlÜ  ≠Ø$JÜ  B<Å∂      b   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/m/cellog/info.xmlM  ≠Ø$JM  u_Õò∂      k   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/c/Default/packagesinfo.xmlL  ≠Ø$JL  Dó˚∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/c/Default/info.xml  ≠Ø$J  ˚íy•∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/c/categories.xmlÄ  ≠Ø$JÄ  ¸ûﬂ◊∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p3/maintainers2.xmlú  ≠Ø$Jú  Üà4F∂      ^   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p3/info.xml“  ≠Ø$J“  É˚∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p3/maintainers.xmlã  ≠Ø$Jã  |ËI∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p1/maintainers2.xmlú  ≠Ø$Jú  /ˆø∆∂      ^   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p1/info.xml“  ≠Ø$J“  Z¨t,∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p1/maintainers.xmlã  ≠Ø$Jã  U¬}∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/packages.xmlN  ≠Ø$JN  ¬‰Rµ∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p2/maintainers2.xmlú  ≠Ø$Jú  Ú¥…Î∂      ^   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p2/info.xml“  ≠Ø$J“  ä}∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p2/maintainers.xmlã  ≠Ø$Jã   $æ∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/deps.1.1.0RC2.txtt   ≠Ø$Jt   ‹∏∞#∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/latest.txt   ≠Ø$J   •ïâ∂      b   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/1.1.0RC2.xmlú  ≠Ø$Jú  ·k’6∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/1.1.0.xmlQ  ≠Ø$JQ  €±.£∂      j   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/package.1.1.0RC1.xml√  ≠Ø$J√  P~˛∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/package.1.0.0.xml+  ≠Ø$J+  ïÏ±≤∂      j   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/package.1.1.0RC2.xml√  ≠Ø$J√  _YY∆∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/deps.1.1.0.txtt   ≠Ø$Jt   ‹∏∞#∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/deps.1.0.0.txt’   ≠Ø$J’   ç:∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/package.1.1.0.xml¬  ≠Ø$J¬  z\∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/allreleases.xml  ≠Ø$J  Û…Q∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/allreleases2.xmlE  ≠Ø$JE  ïﬁv¿∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/1.0.0.xmlQ  ≠Ø$JQ  _≈∂∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/v2.1.1.0RC1.xmly  ≠Ø$Jy  “ªHn∂      ^   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/beta.txt   ≠Ø$J   •ïâ∂      b   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/1.1.0RC1.xmlX  ≠Ø$JX  ÕC„∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/stable.txt   ≠Ø$J   ˘∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/deps.1.1.0RC1.txtt   ≠Ø$Jt   ‹∏∞#∂      b   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/v2.1.1.0.xmlr  ≠Ø$Jr  @?DÂ∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/v2.1.1.0RC2.xmlï  ≠Ø$Jï  ¶≈f∂      b   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/v2.1.0.0.xmlr  ≠Ø$Jr  §ßXf∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/latest.txt   ≠Ø$J   •ïâ∂      j   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/package.1.1.0RC1.xml  ≠Ø$J  û@±∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/package.1.0.0.xml  ≠Ø$J  ¬≈¥_∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/deps.1.0.0.txtø   ≠Ø$Jø   ´i^1∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/allreleases.xml£  ≠Ø$J£  Ú@˛ﬂ∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/allreleases2.xmlƒ  ≠Ø$Jƒ  R5§∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/1.0.0.xmlQ  ≠Ø$JQ  Å_—∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/v2.1.1.0RC1.xmly  ≠Ø$Jy  ã@2∂      ^   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/beta.txt   ≠Ø$J   •ïâ∂      b   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/1.1.0RC1.xmlX  ≠Ø$JX  d‰eç∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/stable.txt   ≠Ø$J   6b;∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/deps.1.1.0RC1.txtø   ≠Ø$Jø   ´i^1∂      b   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/v2.1.0.0.xmlr  ≠Ø$Jr  ñÂÚÌ∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/latest.txt   ≠Ø$J   yôÅ<∂      b   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/1.1.0RC3.xmlX  ≠Ø$JX  ei¢/∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/deps.1.2.0a1.txtt   ≠Ø$Jt   ‹∏∞#∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/package.1.0.0.xml¬  ≠Ø$J¬  ˇ"/V∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/deps.1.1.0RC3.txtt   ≠Ø$Jt   ‹∏∞#∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/1.2.0a1.xmlV  ≠Ø$JV  5'M∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/v2.1.2.0a1.xmlw  ≠Ø$Jw  MÆh=∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/alpha.txt   ≠Ø$J   yôÅ<∂      i   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/package.1.2.0a1.xml√  ≠Ø$J√  —B	∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/deps.1.0.0.txtt   ≠Ø$Jt   ‹∏∞#∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/allreleases.xmlŒ  ≠Ø$JŒ  úÆH<∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/allreleases2.xml˛  ≠Ø$J˛  A‰˙u∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/1.0.0.xmlQ  ≠Ø$JQ  ûBoŸ∂      ^   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/beta.txt   ≠Ø$J   âÙá˘∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/stable.txt   ≠Ø$J   6b;∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/v2.1.1.0RC3.xmly  ≠Ø$Jy  wne–∂      j   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/package.1.1.0RC3.xml√  ≠Ø$J√  z∂      b   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/v2.1.0.0.xmlr  ≠Ø$Jr  ZëÍ∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P1-1.1.0RC1.zip4  ≠Ø$J4  å£ ô∂      ^   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.2.0a1.tgzû  ≠Ø$Jû  øã∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.1.0RC3.zip‡
  ≠Ø$J‡
  ô«¬∂      ^   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.2.0a1.tar &  ≠Ø$J &  P>ù—∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.1.0RC1.tgz¢  ≠Ø$J¢  l·∂      \   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.0.0.tgz∑  ≠Ø$J∑  ËÅÚe∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.1.0RC1.tar &  ≠Ø$J &  ‚¿õ[∂      \   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.0.0.tar &  ≠Ø$J &  «ñ±Ù∂      \   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.0.0.tgzù  ≠Ø$Jù  ◊g ∂      ^   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.2.0a1.zip‹
  ≠Ø$J‹
  Èy?Í∂      \   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.1.0.tar &  ≠Ø$J &  ≤ô@∂      \   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.1.0.zip”
  ≠Ø$J”
  =ÜËW∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.1.0RC1.zip‡
  ≠Ø$J‡
  p≠ï›∂      \   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P1-1.0.0.tgzÆ  ≠Ø$JÆ  6!Ì%∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.1.0RC3.tgzü  ≠Ø$Jü  &Îã∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P1-1.1.0RC1.tar &  ≠Ø$J &  ûŒì´∂      \   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P1-1.0.0.zip'  ≠Ø$J'  Œ»ﬁ∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P1-1.1.0RC1.tgz≤  ≠Ø$J≤  eø<∂      \   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.0.0.tar &  ≠Ø$J &  ÷¬ÿ∂      \   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.0.0.zip<  ≠Ø$J<  Ô“∂      \   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.1.0.tgzû  ≠Ø$Jû  +î∂      \   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P1-1.0.0.tar &  ≠Ø$J &  ïû	∂      \   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.0.0.zip”
  ≠Ø$J”
  
k¯∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.1.0RC3.tar &  ≠Ø$J &  èeì˜∂      X   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/channel.xmlw  ≠Ø$Jw  ö2@Ÿ∂      U   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/make.php  ≠Ø$J  ⁄RÓ?∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/m/allmaintainers.xmlÜ  ≠Ø$JÜ  B<Å∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/m/cellog/info.xmlM  ≠Ø$JM  u_Õò∂      l   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/c/Default/packagesinfo.xmlL  ≠Ø$JL  Dó˚∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/c/Default/info.xml  ≠Ø$J  ˚íy•∂      b   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/c/categories.xmlÄ  ≠Ø$JÄ  ¸ûﬂ◊∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/p/p3/info.xml“  ≠Ø$J“  É˚∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/p/p1/info.xml“  ≠Ø$J“  Z¨t,∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/p/packages.xmlN  ≠Ø$JN  ¬‰Rµ∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/p/p2/info.xml“  ≠Ø$J“  ä}∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/latest.txt   ≠Ø$J   6b;∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/package.1.0.0.xml]  ≠Ø$J]  Nò'π∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/deps.1.0.0.txt  ≠Ø$J  U-]Ø∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/allreleases.xmlx  ≠Ø$Jx  g©∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/allreleases2.xmlä  ≠Ø$Jä  NÍªU∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/1.0.0.xmlQ  ≠Ø$JQ  £?ı∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/maintainers2.xmlú  ≠Ø$Jú  Üà4F∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/stable.txt   ≠Ø$J   6b;∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/maintainers.xmlã  ≠Ø$Jã  |ËI∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/v2.1.0.0.xmlr  ≠Ø$Jr  ¸¢%∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/latest.txt   ≠Ø$J   6b;∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/package.1.0.0.xmlü  ≠Ø$Jü  J4.∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/deps.1.0.0.txt>  ≠Ø$J>  8v∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/allreleases.xmlx  ≠Ø$Jx   Õ/∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/allreleases2.xmlä  ≠Ø$Jä  ÒÇƒH∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/1.0.0.xmlQ  ≠Ø$JQ  ∑†–i∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/maintainers2.xmlú  ≠Ø$Jú  /ˆø∆∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/stable.txt   ≠Ø$J   6b;∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/maintainers.xmlã  ≠Ø$Jã  U¬}∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/v2.1.0.0.xmlr  ≠Ø$Jr  2ƒ}U∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/deps.1.2.0.txtt   ≠Ø$Jt   ‹∏∞#∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/1.3.1.xmlQ  ≠Ø$JQ  uƒé\∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/latest.txt   ≠Ø$J   ˘Ïzf∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/deps.1.2.3.txtt   ≠Ø$Jt   ‹∏∞#∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/deps.1.3.1.txtt   ≠Ø$Jt   ‹∏∞#∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/package.1.3.1.xml¬  ≠Ø$J¬  >m∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/v2.1.3.1.xmlr  ≠Ø$Jr  »}ñ÷∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/1.2.0.xmlQ  ≠Ø$JQ  ≤Ud*∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/package.1.0.0.xml¬  ≠Ø$J¬  L{ö∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/package.1.2.3.xml¬  ≠Ø$J¬  <Ê»Ü∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/1.2.3.xmlQ  ≠Ø$JQ  ÄL¸ç∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/v2.1.2.0.xmlr  ≠Ø$Jr  ˜‡~z∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/deps.1.0.0.txtt   ≠Ø$Jt   ‹∏∞#∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/allreleases.xmlˆ  ≠Ø$Jˆ  9∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/v2.1.2.3.xmlr  ≠Ø$Jr  mº˘∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/allreleases2.xml5  ≠Ø$J5  å≈ÉÇ∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/package.1.2.0.xml¬  ≠Ø$J¬  ñ)•∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/1.0.0.xmlQ  ≠Ø$JQ  ~Õπ∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/maintainers2.xmlú  ≠Ø$Jú  Ú¥…Î∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/stable.txt   ≠Ø$J   ˘Ïzf∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/maintainers.xmlã  ≠Ø$Jã   $æ∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/v2.1.0.0.xmlr  ≠Ø$Jr  ∫<ß∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P2-1.2.0.tgzç  ≠Ø$Jç  Rπ#˜∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P3-1.0.0.tgz∫  ≠Ø$J∫  Õ*˜Ω∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P2-1.2.0.tar $  ≠Ø$J $  `&ò
∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P3-1.0.0.tar $  ≠Ø$J $  cˇb∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P2-1.0.0.tgzâ  ≠Ø$Jâ  2›√{∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P2-1.2.3.tgzê  ≠Ø$Jê  “‰∏›∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P1-1.0.0.tgz∆  ≠Ø$J∆  i±*Z∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P2-1.2.3.tar $  ≠Ø$J $  ˘üva∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P2-1.3.1.tgzé  ≠Ø$Jé  ®=∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P2-1.0.0.tar $  ≠Ø$J $  ≥t8â∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P2-1.3.1.tar $  ≠Ø$J $  †g◊ó∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P1-1.0.0.tar $  ≠Ø$J $  Cî|Æ∂      G   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/channel.xml∏  ≠Ø$J∏  ÍU¬U∂      D   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/make.php®  ≠Ø$J®  UΩ˜˙∂      P   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/m/foo4/info.xmlH  ≠Ø$JH  ß^∑“∂      P   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/m/foo2/info.xmlG  ≠Ø$JG  Øná›∂      U   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/m/allmaintainers.xml  ≠Ø$J  ÷Bƒ∂      R   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/m/cellog/info.xmlM  ≠Ø$JM  u_Õò∂      P   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/m/foo3/info.xmlI  ≠Ø$JI  ¿>YØ∂      P   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/m/foo1/info.xmlG  ≠Ø$JG  ¸’√N∂      [   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/c/Default/packagesinfo.xmlL  ≠Ø$JL  Dó˚∂      S   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/c/Default/info.xml  ≠Ø$J  ˚íy•∂      Q   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/c/categories.xmlÄ  ≠Ø$JÄ  ¸ûﬂ◊∂      O   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/p/packages.xmlI  ≠Ø$JI  bÈ*∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/p/getmaintainers_test/maintainers2.xmlê  ≠Ø$Jê  ∂ÕM∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/p/getmaintainers_test/info.xml„  ≠Ø$J„  .ô>>∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/p/getmaintainers_test/maintainers.xml4  ≠Ø$J4  Êªåj∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/r/getmaintainers_test/latest.txt   ≠Ø$J   6b;∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/r/getmaintainers_test/package.1.0.0.xml–  ≠Ø$J–  ìh¥…∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/r/getmaintainers_test/deps.1.0.0.txtt   ≠Ø$Jt   ‹∏∞#∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/r/getmaintainers_test/allreleases.xmlâ  ≠Ø$Jâ  º¥éù∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/r/getmaintainers_test/allreleases2.xmlõ  ≠Ø$Jõ  {+H ∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/r/getmaintainers_test/1.0.0.xmlÑ  ≠Ø$JÑ  ií|∆∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/r/getmaintainers_test/stable.txt   ≠Ø$J   6b;∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/r/getmaintainers_test/v2.1.0.0.xml•  ≠Ø$J•  ¨Zv∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/get/GetMaintainers_Test-1.0.0.tar &  ≠Ø$J &  Yp—ï∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/get/GetMaintainers_Test-1.0.0.tgz"  ≠Ø$J"  ·ñl¬∂      X   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/channel.xmlw  ≠Ø$Jw  ö2@Ÿ∂      U   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/make.phpÔ  ≠Ø$JÔ  ÜV÷∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/m/allmaintainers.xml`  ≠Ø$J`  ˝†‡∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/m/cellog/info.xmlM  ≠Ø$JM  u_Õò∂      l   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/c/Default/packagesinfo.xmlL  ≠Ø$JL  Dó˚∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/c/Default/info.xml  ≠Ø$J  ˚íy•∂      b   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/c/categories.xmlÄ  ≠Ø$JÄ  ¸ûﬂ◊∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/p/p3/info.xml“  ≠Ø$J“  É˚∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/p/p1/info.xml“  ≠Ø$J“  Z¨t,∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/p/packages.xmlN  ≠Ø$JN  ¬‰Rµ∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/p/p2/info.xml“  ≠Ø$J“  ä}∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/latest.txt   ≠Ø$J   6b;∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/package.1.0.0.xml+  ≠Ø$J+  î‹∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/deps.1.0.0.txt’   ≠Ø$J’   öç∫ˆ∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/allreleases.xmlx  ≠Ø$Jx  g©∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/allreleases2.xmlä  ≠Ø$Jä  NÍªU∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/1.0.0.xmlQ  ≠Ø$JQ  1eÏõ∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/maintainers2.xmlú  ≠Ø$Jú  Üà4F∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/stable.txt   ≠Ø$J   6b;∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/maintainers.xmlã  ≠Ø$Jã  |ËI∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/v2.1.0.0.xmlr  ≠Ø$Jr   €qK∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/latest.txt   ≠Ø$J   6b;∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/package.1.0.0.xml+  ≠Ø$J+  ◊√∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/deps.1.0.0.txt’   ≠Ø$J’   awKQ∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/allreleases.xmlx  ≠Ø$Jx   Õ/∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/allreleases2.xmlä  ≠Ø$Jä  ÒÇƒH∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/1.0.0.xmlQ  ≠Ø$JQ  w≤D∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/maintainers2.xmlú  ≠Ø$Jú  /ˆø∆∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/stable.txt   ≠Ø$J   6b;∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/maintainers.xmlã  ≠Ø$Jã  U¬}∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/v2.1.0.0.xmlr  ≠Ø$Jr  Úx∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/v2.1.2.1.xmlr  ≠Ø$Jr  àéÇL∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/latest.txt   ≠Ø$J   ŒÜ∏g∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/deps.1.2.1.txtt   ≠Ø$Jt   ‹∏∞#∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/package.1.2.1.xml¬  ≠Ø$J¬  ~ks∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/1.2.1.xmlQ  ≠Ø$JQ  UmP∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/allreleases.xmlx  ≠Ø$Jx  ÿ◊‡Ç∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/allreleases2.xmlä  ≠Ø$Jä  NX∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/maintainers2.xmlú  ≠Ø$Jú  Ú¥…Î∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/stable.txt   ≠Ø$J   ŒÜ∏g∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/maintainers.xmlã  ≠Ø$Jã   $æ∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/get/P3-1.0.0.tgz£  ≠Ø$J£  újÛ∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/get/P2-1.2.1.tar $  ≠Ø$J $  Û{'∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/get/P3-1.0.0.tar $  ≠Ø$J $  Ä+sm∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/get/P1-1.0.0.tgzù  ≠Ø$Jù  ìS±7∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/get/P2-1.2.1.tgzã  ≠Ø$Jã  EØ≠B∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/get/P1-1.0.0.tar $  ≠Ø$J $  `∑ˆ∫∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/channel.xmlw  ≠Ø$Jw  ö2@Ÿ∂      \   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/make.phpk  ≠Ø$Jk  ‹ú∆∂      m   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/m/allmaintainers.xmlÜ  ≠Ø$JÜ  B<Å∂      j   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/m/cellog/info.xmlM  ≠Ø$JM  u_Õò∂      s   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/c/Default/packagesinfo.xmlL  ≠Ø$JL  Dó˚∂      k   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/c/Default/info.xml  ≠Ø$J  ˚íy•∂      i   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/c/categories.xmlÄ  ≠Ø$JÄ  ¸ûﬂ◊∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/p/p3/info.xml“  ≠Ø$J“  É˚∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/p/p5/info.xml“  ≠Ø$J“  •Ù…Y∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/p/p4/info.xml“  ≠Ø$J“  *`¬ﬂ∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/p/p1/info.xml“  ≠Ø$J“  Z¨t,∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/p/packages.xmld  ≠Ø$Jd  B˛ê˜∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/p/p2/info.xml“  ≠Ø$J“  ä}∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/latest.txt   ≠Ø$J   6b;∂      o   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/package.1.0.0.xml¬  ≠Ø$J¬  €ã∑—∂      l   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/deps.1.0.0.txtt   ≠Ø$Jt   ‹∏∞#∂      m   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/allreleases.xmlx  ≠Ø$Jx  g©∂      n   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/allreleases2.xmlä  ≠Ø$Jä  NÍªU∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/1.0.0.xmlQ  ≠Ø$JQ  £ÛÀ∂      n   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/maintainers2.xmlú  ≠Ø$Jú  Üà4F∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/stable.txt   ≠Ø$J   6b;∂      m   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/maintainers.xmlã  ≠Ø$Jã  |ËI∂      j   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/v2.1.0.0.xmlr  ≠Ø$Jr  X±n∂      j   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/v2.0.9.0.xmlp  ≠Ø$Jp  €f„©∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/latest.txt   ≠Ø$J   	pä!∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/0.9.0.xmlO  ≠Ø$JO  mƒ∂      m   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/allreleases.xmlv  ≠Ø$Jv  whâÑ∂      n   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/allreleases2.xmlà  ≠Ø$Jà  áÂ·∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/beta.txt   ≠Ø$J   	pä!∂      n   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/maintainers2.xmlú  ≠Ø$Jú  <ÿ∂      o   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/package.0.9.0.xml¿  ≠Ø$J¿  Ú?Å{∂      m   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/maintainers.xmlã  ≠Ø$Jã  Ôæ“∂      l   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/deps.0.9.0.txtt   ≠Ø$Jt   ‹∏∞#∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/devel.txt   ≠Ø$J   ±!ô/∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/latest.txt   ≠Ø$J   6b;∂      o   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/package.1.0.0.xmlH  ≠Ø$JH  •_∏b∂      l   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/deps.1.0.0.txtÔ   ≠Ø$JÔ   X.∂      m   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/allreleases.xmlx  ≠Ø$Jx  wı
î∂      n   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/allreleases2.xmlä  ≠Ø$Jä  d=ë∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/1.0.0.xmlQ  ≠Ø$JQ  ìˇ–—∂      n   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/maintainers2.xmlú  ≠Ø$Jú  H1%±∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/stable.txt   ≠Ø$J   6b;∂      m   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/maintainers.xmlã  ≠Ø$Jã  ·‚„∂      j   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/v2.1.0.0.xmlr  ≠Ø$Jr  îDuò∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/latest.txt   ≠Ø$J   6b;∂      o   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/package.1.0.0.xml+  ≠Ø$J+  µøXF∂      l   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/deps.1.0.0.txt’   ≠Ø$J’   awKQ∂      m   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/allreleases.xmlx  ≠Ø$Jx   Õ/∂      n   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/allreleases2.xmlä  ≠Ø$Jä  ÒÇƒH∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/1.0.0.xmlQ  ≠Ø$JQ  Œ˙∂      n   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/maintainers2.xmlú  ≠Ø$Jú  /ˆø∆∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/stable.txt   ≠Ø$J   6b;∂      m   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/maintainers.xmlã  ≠Ø$Jã  U¬}∂      j   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/v2.1.0.0.xmlr  ≠Ø$Jr  õrc∆∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/devel.txt   ≠Ø$J   t◊±˛∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/1.2.2.xmlQ  ≠Ø$JQ  .m∫∂      j   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/v2.0.9.0.xmlp  ≠Ø$Jp  ∑ˆ∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/latest.txt   ≠Ø$J   ‚Á∂â∂      l   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/deps.1.2.3.txt
  ≠Ø$J
  [j—∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/0.9.0.xmlO  ≠Ø$JO  ØÑ,°∂      o   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/package.1.2.3.xmlj  ≠Ø$Jj  [±j∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/1.2.3.xmlQ  ≠Ø$JQ  µ]™Ú∂      o   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/package.1.2.2.xml  ≠Ø$J  j4*ñ∂      l   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/deps.1.2.2.txtø   ≠Ø$Jø   
˘IŸ∂      j   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/v2.1.2.2.xmlr  ≠Ø$Jr  [°J‘∂      m   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/allreleases.xml   ≠Ø$J   ﬁÚΩË∂      j   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/v2.1.2.3.xmlr  ≠Ø$Jr  X≠Øw∂      n   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/allreleases2.xml˙  ≠Ø$J˙  " Pr∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/beta.txt   ≠Ø$J   	pä!∂      n   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/maintainers2.xmlú  ≠Ø$Jú  Ú¥…Î∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/stable.txt   ≠Ø$J   ‚Á∂â∂      o   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/package.0.9.0.xml¿  ≠Ø$J¿  ‰˚k-∂      m   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/maintainers.xmlã  ≠Ø$Jã   $æ∂      l   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/deps.0.9.0.txtt   ≠Ø$Jt   ‹∏∞#∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P5-0.9.0.tgzä  ≠Ø$Jä  J∏µ∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P4-1.0.0.tar $  ≠Ø$J $  ’≠òÚ∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P3-1.0.0.tgzä  ≠Ø$Jä  M;™Ì∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P4-1.0.0.tgzÆ  ≠Ø$JÆ  p7º∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P3-1.0.0.tar $  ≠Ø$J $  Ú¨ëU∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P2-1.2.3.tgz¢  ≠Ø$J¢  9Ü∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P1-1.0.0.tgzù  ≠Ø$Jù  BΩÊ´∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P2-1.2.3.tar $  ≠Ø$J $  '4∏∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P2-1.2.2.tgzú  ≠Ø$Jú  dP3∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P2-0.9.0.tar $  ≠Ø$J $  I}æ|∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P2-1.2.2.tar $  ≠Ø$J $  OëFÃ∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P5-0.9.0.tar $  ≠Ø$J $  √<∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P5-1.0.0.tgzí  ≠Ø$Jí  VØ˙K∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P1-1.0.0.tar $  ≠Ø$J $  ôz•4∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P2-0.9.0.tgzâ  ≠Ø$Jâ  ™ET∂      4   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/README∏   ≠Ø$J∏   √¥Ë∂      X   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/channel.xmlw  ≠Ø$Jw  ö2@Ÿ∂      U   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/make.php  ≠Ø$J  ±ì∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/m/allmaintainers.xml`  ≠Ø$J`  ˝†‡∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/m/cellog/info.xmlM  ≠Ø$JM  u_Õò∂      l   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/c/Default/packagesinfo.xmlL  ≠Ø$JL  Dó˚∂      d   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/c/Default/info.xml  ≠Ø$J  ˚íy•∂      b   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/c/categories.xmlÄ  ≠Ø$JÄ  ¸ûﬂ◊∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/p/p3/info.xml“  ≠Ø$J“  É˚∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/p/p1/info.xml“  ≠Ø$J“  Z¨t,∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/p/packages.xmlN  ≠Ø$JN  ¬‰Rµ∂      _   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/p/p2/info.xml“  ≠Ø$J“  ä}∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/latest.txt   ≠Ø$J   6b;∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/package.1.0.0.xml;  ≠Ø$J;  ÏåoE∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/deps.1.0.0.txtﬁ   ≠Ø$Jﬁ   ú≠õ›∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/allreleases.xmlx  ≠Ø$Jx  g©∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/allreleases2.xmlä  ≠Ø$Jä  NÍªU∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/1.0.0.xmlQ  ≠Ø$JQ  ∑xa”∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/maintainers2.xmlú  ≠Ø$Jú  Üà4F∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/stable.txt   ≠Ø$J   6b;∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/maintainers.xmlã  ≠Ø$Jã  |ËI∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/v2.1.0.0.xmlr  ≠Ø$Jr  L∆¸∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/latest.txt   ≠Ø$J   6b;∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/package.1.0.0.xml;  ≠Ø$J;  û‘C)∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/deps.1.0.0.txtﬁ   ≠Ø$Jﬁ   ™S∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/allreleases.xmlx  ≠Ø$Jx   Õ/∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/allreleases2.xmlä  ≠Ø$Jä  ÒÇƒH∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/1.0.0.xmlQ  ≠Ø$JQ  Ò?∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/maintainers2.xmlú  ≠Ø$Jú  /ˆø∆∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/stable.txt   ≠Ø$J   6b;∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/maintainers.xmlã  ≠Ø$Jã  U¬}∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/v2.1.0.0.xmlr  ≠Ø$Jr  tbí0∂      c   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/v2.1.2.1.xmlr  ≠Ø$Jr  ◊2‘¨∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/latest.txt   ≠Ø$J   ŒÜ∏g∂      e   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/deps.1.2.1.txtt   ≠Ø$Jt   ‹∏∞#∂      h   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/package.1.2.1.xml¬  ≠Ø$J¬  XÈı∂      `   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/1.2.1.xmlQ  ≠Ø$JQ  
ª;∞∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/allreleases.xmlx  ≠Ø$Jx  ÿ◊‡Ç∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/allreleases2.xmlä  ≠Ø$Jä  NX∂      g   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/maintainers2.xmlú  ≠Ø$Jú  Ú¥…Î∂      a   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/stable.txt   ≠Ø$J   ŒÜ∏g∂      f   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/maintainers.xmlã  ≠Ø$Jã   $æ∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/get/P3-1.0.0.tgz™  ≠Ø$J™  ΩüØ'∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/get/P2-1.2.1.tar $  ≠Ø$J $  uk5§∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/get/P3-1.0.0.tar $  ≠Ø$J $  º∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/get/P1-1.0.0.tgz©  ≠Ø$J©  Hrê\∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/get/P2-1.2.1.tgzã  ≠Ø$Jã  ÿÛ@(∂      ]   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/get/P1-1.0.0.tar $  ≠Ø$J $   ÁÎ∂      1   test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet.phpX  ≠Ø$JX  Ú†V>∂      <   test/pear2.php.net/PEAR2_Pyrus/Installer/install_script.phpt?  ≠Ø$J?  ƒı¸/∂      A   test/pear2.php.net/PEAR2_Pyrus/Installer/install.verifyfiles.phptˆ  ≠Ø$Jˆ  Tâ4∂      F   test/pear2.php.net/PEAR2_Pyrus/Installer/install_existing_package.phpt4  ≠Ø$J4  `µ¿∂      W   test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.fail.depconflict3.phpt  ≠Ø$J  ÚÄ»b∂      R   test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.depinstalled.phpt‹  ≠Ø$J‹  3 _o∂      _   test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.depinstalled.notupgrading.phpt√  ≠Ø$J√  i∂ÂH∂      \   test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.depinstalled.noupgrade.phpt¿  ≠Ø$J¿  ÎD¬ò∂      W   test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.fail.depconflict1.phpt·  ≠Ø$J·  ˚ÖKf∂      O   test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.duplicate.phptß  ≠Ø$Jß  }(Ÿ∂      b   test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.depinstalled.upgradeconflict.phpt   ≠Ø$J   ÓC|«∂      S   test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.explicitstate.phptû  ≠Ø$Jû  _%ßp∂      W   test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.fail.depconflict2.phpt€  ≠Ø$J€  ı:r∂      Y   test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.dep.versionconflict.phptí  ≠Ø$Jí  2`∂      W   test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.fail.depconflict4.phpt7  ≠Ø$J7  EûB∂      ?   test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/pearconfig.xmlÜ  ≠Ø$JÜ  IÜe∂      Z   test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.depinstalled.upgrade.phptL  ≠Ø$JL  o˝çÚ∂      6   test/pear2.php.net/PEAR2_Pyrus/Installer/setup.php.incﬁ  ≠Ø$Jﬁ  ºjò∂      E   test/pear2.php.net/PEAR2_Pyrus/Installer/install.remote.packages.phpt  ≠Ø$J  õc4∫∂      5   test/pear2.php.net/PEAR2_Pyrus/test_framework.php.incÁ  ≠Ø$JÁ  8ÛF∂      M   test/pear2.php.net/PEAR2_Pyrus/Validator_PECL/validateversion.failure.rc.phptË  ≠Ø$JË  @v<]∂      ;   test/pear2.php.net/PEAR2_Pyrus/Validator_PECL/setup.php.inc@   ≠Ø$J@   Â*≈ç∂      G   test/pear2.php.net/PEAR2_Pyrus/Validator_PECL/validatename.failure.phpt@  ≠Ø$J@  Z1¥5∂      3   test/pear2.php.net/PEAR2_Pyrus/clean.xdebug.php.incV  ≠Ø$JV  √”Ñ±∂      ?   test/pear2.php.net/PEAR2_Pyrus/ChannelFile_Parser_v1/error.phptﬁ  ≠Ø$Jﬁ  ∏·1∂      B   test/pear2.php.net/PEAR2_Pyrus/ChannelFile_Parser_v1/setup.php.incp   ≠Ø$Jp   6“I∂      /   test/pear2.php.net/PEAR2_Pyrus/ignorexdebug.phpp  ≠Ø$Jp  ¶£§¢∂      B   test/pear2.php.net/PEAR2_Pyrus/ScriptFileFilterIterator/basic.phpt  ≠Ø$J  õŒ[z∂      E   test/pear2.php.net/PEAR2_Pyrus/ScriptFileFilterIterator/setup.php.inc«  ≠Ø$J«  ïÔît∂      O   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2_Validator/validate.fail.task.phpt.  ≠Ø$J.  Õﬁªõ∂      O   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2_Validator/validate.newobject.phpt;  ≠Ø$J;  1¶∂      O   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2_Validator/validate.fail.role.phpt2  ≠Ø$J2  ®5πk∂      E   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2_Validator/setup.php.inc@   ≠Ø$J@   Â*≈ç∂      Y   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2_Validator/validate.newobject.packaging.phptA  ≠Ø$JA  re4Q∂      8   test/pear2.php.net/PEAR2_Pyrus/Custom/Command/basic.phptE  ≠Ø$JE  ´ù\¬∂      7   test/pear2.php.net/PEAR2_Pyrus/Custom/Command/basic.phpX	  ≠Ø$JX	  oqñ√∂      ;   test/pear2.php.net/PEAR2_Pyrus/Custom/Command/setup.php.inco  ≠Ø$Jo  áÄ´é∂      5   test/pear2.php.net/PEAR2_Pyrus/Custom/Task/basic.phpt€  ≠Ø$J€  ]z∏≥∂      8   test/pear2.php.net/PEAR2_Pyrus/Custom/Task/setup.php.incl  ≠Ø$Jl  £70Q∂      5   test/pear2.php.net/PEAR2_Pyrus/Custom/Role/basic.phpt¿  ≠Ø$J¿  ,ßÚù∂      8   test/pear2.php.net/PEAR2_Pyrus/Custom/Role/setup.php.incl  ≠Ø$Jl  “E«J∂      7   test/pear2.php.net/PEAR2_Pyrus/DirectedGraph/basic.phptÃ  ≠Ø$JÃ  1jÂ∂      :   test/pear2.php.net/PEAR2_Pyrus/DirectedGraph/setup.php.incj   ≠Ø$Jj   ˆ–¯∂      8   test/pear2.php.net/PEAR2_Pyrus/DirectedGraph/cycles.phptò  ≠Ø$Jò  @øºª∂      5   test/pear2.php.net/PEAR2_Pyrus/XMLParser/attribs.phptÁ  ≠Ø$JÁ  k&n∂      >   test/pear2.php.net/PEAR2_Pyrus/XMLParser/childtag_attribs.phpt}  ≠Ø$J}  ·”ÿ¿∂      F   test/pear2.php.net/PEAR2_Pyrus/XMLParser/childtag_sibling_attribs.phpt≤  ≠Ø$J≤  TX[∂      3   test/pear2.php.net/PEAR2_Pyrus/XMLParser/cdata.phpt  ≠Ø$J  {û∏(∂      :   test/pear2.php.net/PEAR2_Pyrus/XMLParser/recursivetag.phptﬂ  ≠Ø$Jﬂ  ™◊ÜL∂      >   test/pear2.php.net/PEAR2_Pyrus/XMLParser/childtag_content.phpt=  ≠Ø$J=  *UÙ˛∂      3   test/pear2.php.net/PEAR2_Pyrus/XMLParser/empty.phptÙ   ≠Ø$JÙ   T2Ê∂      6   test/pear2.php.net/PEAR2_Pyrus/XMLParser/setup.php.inc¢   ≠Ø$J¢   œ:ŸÏ∂      6   test/pear2.php.net/PEAR2_Pyrus/XMLParser/childtag.phpt  ≠Ø$J  WŸXH∂      =   test/pear2.php.net/PEAR2_Pyrus/XMLParser/attribs_content.phptn  ≠Ø$Jn  ‚wiÒ∂      9   test/pear2.php.net/PEAR2_Pyrus/XMLParser/siblingtags.phpt+  ≠Ø$J+  ≈=Èµ∂      C   test/pear2.php.net/PEAR2_Pyrus/ScriptRunner/postprocessprompts.phptX  ≠Ø$JX  µ8„∂      6   test/pear2.php.net/PEAR2_Pyrus/ScriptRunner/basic.phptÂ  ≠Ø$JÂ  ˆ`¨6∂      9   test/pear2.php.net/PEAR2_Pyrus/ScriptRunner/setup.php.incΩ  ≠Ø$JΩ  Õ7Ó‹∂      =   test/pear2.php.net/PEAR2_Pyrus/Task/Replace/startsession.phpt   ≠Ø$J   êµJ6∂      D   test/pear2.php.net/PEAR2_Pyrus/Task/Replace/validatexml.failure.phpt†  ≠Ø$J†  [eé◊∂      9   test/pear2.php.net/PEAR2_Pyrus/Task/setup.minimal.php.inc—  ≠Ø$J—  ëö∂µ∂      P   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure15.phptÀ  ≠Ø$JÀ  ‘@Û∂      P   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure12.phpt~  ≠Ø$J~  I ƒÊ∂      O   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure3.phptp  ≠Ø$Jp  ÷ÃYâ∂      U   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/__get/paramgroup.condition.phpt∞  ≠Ø$J∞  §∆≥Ú∂      L   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/__get/paramgroup1.phpt€  ≠Ø$J€  ÀZı¬∂      `   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/__get/paramgroup.matchesconditiontype.phpt≤  ≠Ø$J≤  Û`\g∂      F   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/__get/param.phptL  ≠Ø$JL  mÔ∂      L   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/__get/paramgroup2.phpt«  ≠Ø$J«  ,Ü<€∂      I   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/__get/setup.php.incÕ  ≠Ø$JÕ  \˘∂      O   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure7.phpt∑  ≠Ø$J∑  Ä´^Ñ∂      O   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure8.phptò  ≠Ø$Jò  Íﬁ¥∂      O   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure4.phpt%  ≠Ø$J%  e¨”∂      P   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure16.phpt§  ≠Ø$J§  P†8À∂      P   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure13.phptj  ≠Ø$Jj  S≠{(∂      P   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure17.phpt“  ≠Ø$J“  °00‰∂      P   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure11.phptH  ≠Ø$JH  ∑Ò¥)∂      O   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure2.phpt£  ≠Ø$J£  ÔΩw∂      O   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure6.phptB  ≠Ø$JB  Áäı
∂      F   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.phpt"  ≠Ø$J"  #˛∂      P   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure10.phpt  ≠Ø$J  ·ågo∂      O   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure5.phpt<  ≠Ø$J<  _¬∂      N   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure.phptà  ≠Ø$Jà  )∞ñ©∂      O   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure9.phpt  ≠Ø$J  )ÒÕ∂      P   test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure14.phptú  ≠Ø$Jú  ∆ÎÜ ∂      =   test/pear2.php.net/PEAR2_Pyrus/Task/Unixeol/startsession.phpt)  ≠Ø$J)  ¿WzÔ∂      D   test/pear2.php.net/PEAR2_Pyrus/Task/Unixeol/validatexml.failure.phpt  ≠Ø$J  j√¨æ∂      1   test/pear2.php.net/PEAR2_Pyrus/Task/setup.php.incº  ≠Ø$Jº  2™±w∂      @   test/pear2.php.net/PEAR2_Pyrus/Task/Windowseol/startsession.phpt9  ≠Ø$J9  <˛∂      G   test/pear2.php.net/PEAR2_Pyrus/Task/Windowseol/validatexml.failure.phpt  ≠Ø$J  Â≈Ës∂      B   test/pear2.php.net/PEAR2_Pyrus/PackageFile_Parser_v2/test_2.1.phpt># ≠Ø$J># F¡ﬁJ∂      B   test/pear2.php.net/PEAR2_Pyrus/PackageFile_Parser_v2/test_2.0.phptm∞ ≠Ø$Jm∞ ÉÍ+∂∂      B   test/pear2.php.net/PEAR2_Pyrus/PackageFile_Parser_v2/setup.php.incˆ  ≠Ø$Jˆ  ˜ÏD∂      I   test/pear2.php.net/PEAR2_Pyrus/PackageFile_Parser_v2/packages/package.xmlÎ&  ≠Ø$JÎ&  ÜA¢Ô∂      J   test/pear2.php.net/PEAR2_Pyrus/PackageFile_Parser_v2/packages/package2.xmlºV  ≠Ø$JºV  QΩúê∂      4   test/pear2.php.net/PEAR2_Pyrus/Channel/creation.phptb  ≠Ø$Jb  n]lÕ∂      4   test/pear2.php.net/PEAR2_Pyrus/Channel/rest.template
  ≠Ø$J
  ‹˘‘‹∂      =   test/pear2.php.net/PEAR2_Pyrus/Channel/rest_creation.template+  ≠Ø$J+  k·∂      9   test/pear2.php.net/PEAR2_Pyrus/Channel/mirrors-unset.phpt“  ≠Ø$J“  .π∂      7   test/pear2.php.net/PEAR2_Pyrus/Channel/mirrors-set.phptT  ≠Ø$JT  U2ò∂      1   test/pear2.php.net/PEAR2_Pyrus/Channel/basic.phpt¸
  ≠Ø$J¸
  ∫€V◊∂      /   test/pear2.php.net/PEAR2_Pyrus/Channel/uri.phpt“  ≠Ø$J“  ˚∏s ∂      2   test/pear2.php.net/PEAR2_Pyrus/Channel/remote.phpt∑  ≠Ø$J∑  ÃlH	∂      4   test/pear2.php.net/PEAR2_Pyrus/Channel/setup.php.inc@   ≠Ø$J@   Â*≈ç∂      3   test/pear2.php.net/PEAR2_Pyrus/Channel/mirrors.phptÊ
  ≠Ø$JÊ
  ìÿc∂      D   test/pear2.php.net/PEAR2_Pyrus/Channel/remoteiteration/setup.php.incF  ≠Ø$JF  C6(`∂      L   test/pear2.php.net/PEAR2_Pyrus/Channel/remoteiteration/channel.packages.phptÒ  ≠Ø$JÒ  ¸A<∂      E   test/pear2.php.net/PEAR2_Pyrus/Channel/remoteiteration/pearconfig.xml§  ≠Ø$J§  ∫;Ï∂      6   test/pear2.php.net/PEAR2_Pyrus/Channel/validation.phpt  ≠Ø$J  \q¡5∂      7   test/pear2.php.net/PEAR2_Pyrus/Channel/rest.errors.phpt}  ≠Ø$J}  \)å∂      7   test/pear2.php.net/PEAR2_Pyrus/Channel/ssl_channel.phpt‘  ≠Ø$J‘  $ãë∂      B   test/pear2.php.net/PEAR2_Pyrus/Uninstaller/uninstall.rollback.phpt“  ≠Ø$J“  ÿ>Âü∂      ?   test/pear2.php.net/PEAR2_Pyrus/Uninstaller/uninstall.basic.phptﬁ  ≠Ø$Jﬁ  ¨oÛ√∂      T   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/listpackages/multiple.templateV  ≠Ø$JV  ‡GY˜∂      ]   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/listpackages/multiple.channels.template‹  ≠Ø$J‹  ”éIñ∂      R   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/listpackages/simple.templateå  ≠Ø$Jå  ÿ¥‚∂      N   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/setupPackageFile.php.incB  ≠Ø$JB  ˇKDˆ∂      m   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.required.setting.templateÎ  ≠Ø$JÎ  %Tgt∂      ^   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/compatible.set.template$  ≠Ø$J$  ò%Á∂      a   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/toarray.packaging.template¨#  ≠Ø$J¨#  q8}ë∂      j   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.group.package.template   ≠Ø$J   ã#û%∂      X   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/usesrole.templateÁ  ≠Ø$JÁ  Wu™\∂      r   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.pearinstaller.complex.template=  ≠Ø$J=  ‰Û§.∂      Y   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/usesrole2.template  ≠Ø$J  Æs¡∂      l   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.group.extension.template  ≠Ø$J  ÷ ;ã∂      g   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/release.configureoption.templateﬁ  ≠Ø$Jﬁ  …Éà|∂      f   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.php.basic.template)  ≠Ø$J)  ÿô⁄∂      r   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.group.package.complex.templateÀ  ≠Ø$JÀ  ˆ¶ID∂      m   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.group.subpackage.template
  ≠Ø$J
  y8¡B∂      m   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.optional.setting.template˙  ≠Ø$J˙  »Ë4˝∂      o   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.subpackage.setting.templateg  ≠Ø$Jg  ’ñÑW∂      k   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/toarray.packaging.filelist2.templatev(  ≠Ø$Jv(  ˙Ùv ∂      k   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/toarray.packaging.filelist3.templateÀ)  ≠Ø$JÀ)  â1LØ∂      p   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.package.conflicting.templateÕ  ≠Ø$JÕ  ÎöÜ¬∂      j   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.group.setting.template  ≠Ø$J  8CµE∂      W   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/toarray.template0"  ≠Ø$J0"  ¢ûÉ∂      n   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/release.configureoption.errors.templateu  ≠Ø$Ju  ;KÓd∂      p   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.pearinstaller.basic.templateê  ≠Ø$Jê  }~˙U∂      l   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.package.complex.template  ≠Ø$J  ‘ı∂      _   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/toarray.onefile.template  ≠Ø$J  ÒË•ô∂      e   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/release.binarypackage.templateL  ≠Ø$JL  ’»¢∂      g   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.os.setting.templateb  ≠Ø$Jb  §{-5∂      f   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.php.reset.templateQ  ≠Ø$JQ  @ıò∂      o   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/release.configureoption.setting.template®  ≠Ø$J®  mcV∂      `   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/compatible.basic.templateN  ≠Ø$JN  —	µ∂      p   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.subpackage.setting2.templated  ≠Ø$Jd  Ï√k7∂      h   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.package.uri.template	  ≠Ø$J	  ∑î∂      m   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.package.setting2.templateå
  ≠Ø$Jå
  mË3∂      l   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.package.setting.template%  ≠Ø$J%  >¶∂      k   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.os.conflicting.template¢  ≠Ø$J¢  øÒØ∂      X   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/usestask.templateÁ  ≠Ø$JÁ  íÉ∂      i   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.package.pecl.template4  ≠Ø$J4  üÀMö∂      Y   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/usestask2.template  ≠Ø$J  J∆Ô≈∂      h   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/toarray.multiplegroupdep.templateµ$  ≠Ø$Jµ$  ˝å9‡∂      l   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.extension.basic.template,  ≠Ø$J,  ≤òø[∂      b   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.group.template¬  ≠Ø$J¬  ⁄å∂      Z   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/setlicense.template∞  ≠Ø$J∞  ›ìú‡∂      j   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/toarray.packaging.filelist.templateç%  ≠Ø$Jç%  ëF
d∂      o   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.subpackage.complex.templateﬂ  ≠Ø$Jﬂ  ªú÷∂      a   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/compatible.errors.template≤  ≠Ø$J≤  ∑‡π¥∂      i   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.arch.setting.templateê  ≠Ø$Jê  ﬁÈ–»∂      o   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.extension.setting2.templateL
  ≠Ø$JL
  vê:∂      m   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.arch.conflicting.template≥  ≠Ø$J≥  zú(u∂      a   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.arch.template  ≠Ø$J  zf‹†∂      h   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.php.complex.template  ≠Ø$J  E`”E∂      u   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.package.optional.complex.templater  ≠Ø$Jr  ¶T™2∂      h   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.php.exclude.template“  ≠Ø$J“  R∂      n   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.extension.setting.templateÕ	  ≠Ø$JÕ	  ‰◊_∂      _   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.os.template  ≠Ø$J  q'œù∂      x   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.subpackage.optional.complex.templateﬁ  ≠Ø$Jﬁ  l’∫N∂      R   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/basic.templateV  ≠Ø$JV  m˛Êˆ∂      T   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/license.templateÌ  ≠Ø$JÌ  î÷}`∂      R   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/file2.templateä  ≠Ø$Jä  VÓﬁq∂      U   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/release3.templateÿ  ≠Ø$Jÿ  Ìd1∂      W   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/maintainer.template8  ≠Ø$J8  [$X∞∂      ^   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/packagingcontents.template  ≠Ø$J  9r.∂      U   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/release2.templateÆ  ≠Ø$JÆ  ¯›å1∂      T   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/release.templateQ  ≠Ø$JQ  vU∂      Q   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/file.templateW  ≠Ø$JW  ~Sˇú∂      X   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/maintainer2.templateÑ  ≠Ø$JÑ  [”CC∂      [   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/allmaintainers.templateÀ  ≠Ø$JÀ  0?y«∂      Y   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/getdependentpackages/basic.template≠  ≠Ø$J≠  ùd^∂      X   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/detectfileconflicts/basic.templatez  ≠Ø$Jz  Ã√?à∂      A   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package.xmlB  ≠Ø$JB  ‡è>∂      J   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/info/simple.templateÚ  ≠Ø$JÚ  +àÁ∂      K   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/info/dirtree.templateÖ  ≠Ø$JÖ  ¨Î:B∂      R   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/info/installedfiles.templatez  ≠Ø$Jz  ¨`pi∂      M   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/uninstall/test.templateË  ≠Ø$JË  “1l∂      K   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/install/test.template3  ≠Ø$J3  ‰ º∂      Y   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/Registry/toPackageFile/cascade.phptc  ≠Ø$Jc  cb≠'∂      q   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/Registry/detectFileConflicts/detectfileconflicts.basic.phptt  ≠Ø$Jt  ËØà∂      o   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/Registry/listPackages/listpackages.multiple.channels.phptH  ≠Ø$JH  •†b.∂      X   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/Registry/listPackages/cascade.phpt‡  ≠Ø$J‡  YhÄÍ∂      T   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/Registry/setup.cascade.php.incØ  ≠Ø$JØ  \$≤≤∂      L   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/Registry/setup.php.inc¿  ≠Ø$J¿  Xqß∂      s   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/Registry/getDependentPackages/getdependentpackages.basic.phptv  ≠Ø$Jv  ^«ZÚ∂      <   test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/README∫   ≠Ø$J∫   ©¿!Ñ∂      U   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/listpackages/listpackages.multiple.phptÅ  ≠Ø$JÅ  %eáï∂      ^   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/listpackages/listpackages.multiple.channels.phptù  ≠Ø$Jù  >Wó∫∂      H   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/listpackages/setup.php.inc∆  ≠Ø$J∆  p‹áJ∂      S   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/listpackages/listpackages.simple.phptl  ≠Ø$Jl  ¸˝·õ∂      H   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/license.phptC  ≠Ø$JC  ó¿∑‹∂      R   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/packagingcontents.phptW  ≠Ø$JW  2¶¡‡∂      H   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/release.phptE  ≠Ø$JE  øa T∂      O   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/allmaintainers.phptQ  ≠Ø$JQ  ¬ÉTO∂      F   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/file2.phptK  ≠Ø$JK  Öæ¨¸∂      L   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/maintainer2.phptP  ≠Ø$JP  [^Û∂      F   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/basic.phptA  ≠Ø$JA  ˝ãX∫∂      E   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/file.phptF  ≠Ø$JF  ∑‡å∂      I   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/setup.php.incG  ≠Ø$JG  Y™M¨∂      I   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/release3.phptJ  ≠Ø$JJ  ¶››∂∂      K   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/maintainer.phptK  ≠Ø$JK  k	–â∂      I   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/release2.phptJ  ≠Ø$JJ  ñXV∂      b   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/getdependentpackages/getdependentpackages.basic.phpt{  ≠Ø$J{  HW1G∂      P   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/getdependentpackages/setup.php.inc∆  ≠Ø$J∆  p‹áJ∂      `   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/detectfileconflicts/detectfileconflicts.basic.phpty  ≠Ø$Jy  õçó∂      O   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/detectfileconflicts/setup.php.inc∆  ≠Ø$J∆  p‹áJ∂      D   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/info/info.dirtree.phptn  ≠Ø$Jn  FÊ∂      C   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/info/info.simple.phpt&  ≠Ø$J&  …É t∂      K   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/info/info.installedfiles.phpt|  ≠Ø$J|  QQß∂      @   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/info/setup.php.inc∆  ≠Ø$J∆  p‹áJ∂      A   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/uninstall/test.phpt  ≠Ø$J  ¢ÆÈı∂      E   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/uninstall/setup.php.inc¿  ≠Ø$J¿  Ÿìéã∂      ?   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/install/test.phpt  ≠Ø$J  'Î?Å∂      C   test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/install/setup.php.inc¿  ≠Ø$J¿  Ÿìéã∂      S   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/listpackages/listpackages.multiple.phpt  ≠Ø$J  ≤9∂      \   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/listpackages/listpackages.multiple.channels.phptõ  ≠Ø$Jõ  -Ûf´∂      F   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/listpackages/setup.php.inc⁄  ≠Ø$J⁄  ΩÎ¸L∂      Q   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/listpackages/listpackages.simple.phptj  ≠Ø$Jj  yßπ7∂      F   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/license.phptA  ≠Ø$JA  r=∆à∂      P   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/packagingcontents.phptU  ≠Ø$JU  ™÷oE∂      F   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/release.phptC  ≠Ø$JC  ∆º¥∂      M   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/allmaintainers.phptO  ≠Ø$JO  ¥◊cÓ∂      D   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/file2.phptI  ≠Ø$JI  ˆyÿ?∂      J   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/maintainer2.phptN  ≠Ø$JN  ¶Sô∂      D   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/basic.phpt?  ≠Ø$J?  T1è∂      C   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/file.phptD  ≠Ø$JD  @{Ÿ•∂      G   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/setup.php.incE  ≠Ø$JE  öÜ¡∏∂      G   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/release3.phptH  ≠Ø$JH  [îŒ∂      I   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/maintainer.phptI  ≠Ø$JI  Œ§J∂      G   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/release2.phptH  ≠Ø$JH  k».∂      `   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/getdependentpackages/getdependentpackages.basic.phpty  ≠Ø$Jy  ˚x·∂      N   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/getdependentpackages/setup.php.inc⁄  ≠Ø$J⁄  ΩÎ¸L∂      ^   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/detectfileconflicts/detectfileconflicts.basic.phptw  ≠Ø$Jw  [iùç∂      M   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/detectfileconflicts/setup.php.inc⁄  ≠Ø$J⁄  ΩÎ¸L∂      B   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/info/info.dirtree.phptl  ≠Ø$Jl  ˙K+∂      A   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/info/info.simple.phpt$  ≠Ø$J$  ıŒS∂      I   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/info/info.installedfiles.phptz  ≠Ø$Jz  %˙iP∂      >   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/info/setup.php.inc⁄  ≠Ø$J⁄  ΩÎ¸L∂      ?   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/uninstall/test.phpt  ≠Ø$J  ¢ÆÈı∂      C   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/uninstall/setup.php.incæ  ≠Ø$Jæ  Ÿ7∂∂      =   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/install/test.phpt  ≠Ø$J  /è„∂      A   test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/install/setup.php.incæ  ≠Ø$Jæ  Ÿ7∂∂      M   test/pear2.php.net/PEAR2_Pyrus/Registry/Base/cloneRegistry/cloneregistry.phpt˜  ≠Ø$J˜  ¯Wÿõ∂      H   test/pear2.php.net/PEAR2_Pyrus/Registry/Base/cloneRegistry/setup.php.inc  ≠Ø$J  V˘∂      c   test/pear2.php.net/PEAR2_Pyrus/Registry/Base/makeUninstallConnections/makeuninstallconnections.phpt·  ≠Ø$J·  Æbπû∂      S   test/pear2.php.net/PEAR2_Pyrus/Registry/Base/makeUninstallConnections/setup.php.inc«  ≠Ø$J«  eﬁ:=∂      m   test/pear2.php.net/PEAR2_Pyrus/Registry/Base/validateUninstallDependencies/validateuninstalldependencies.phpt£  ≠Ø$J£  Ìb(‡∂      ~   test/pear2.php.net/PEAR2_Pyrus/Registry/Base/validateUninstallDependencies/validateuninstalldependencies.parent.uninstall.phpt◊  ≠Ø$J◊  Üxú∂      r   test/pear2.php.net/PEAR2_Pyrus/Registry/Base/validateUninstallDependencies/validateuninstalldependencies.fail.phpt†  ≠Ø$J†  ÊW\ù∂      X   test/pear2.php.net/PEAR2_Pyrus/Registry/Base/validateUninstallDependencies/setup.php.incî  ≠Ø$Jî  á˜†∂      I   test/pear2.php.net/PEAR2_Pyrus/Registry/Base/arrayaccess/arrayaccess.phptØ  ≠Ø$JØ  ßÚD<∂      F   test/pear2.php.net/PEAR2_Pyrus/Registry/Base/arrayaccess/setup.php.inc«  ≠Ø$J«  eﬁ:=∂      W   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/listpackages/listpackages.multiple.phptÉ  ≠Ø$JÉ  ùç´∂      `   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/listpackages/listpackages.multiple.channels.phptü  ≠Ø$Jü  ◊bÙË∂      J   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/listpackages/setup.php.inc«  ≠Ø$J«  eﬁ:=∂      U   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/listpackages/listpackages.simple.phptn  ≠Ø$Jn  ^˚¥∂      J   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/license.phptE  ≠Ø$JE  aéãr∂      T   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/packagingcontents.phptY  ≠Ø$JY  ÎF≥£∂      J   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/release.phptG  ≠Ø$JG  /ÂÇá∂      Q   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/allmaintainers.phptS  ≠Ø$JS  „…+∂      H   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/file2.phptM  ≠Ø$JM  MK3m∂      N   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/maintainer2.phptR  ≠Ø$JR  Zñ∂      H   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/basic.phptc  ≠Ø$Jc  “	÷∂      G   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/file.phptH  ≠Ø$JH  ≈¶<|∂      K   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/setup.php.incI  ≠Ø$JI  º2≥∂      K   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/release3.phptL  ≠Ø$JL  ËÇDM∂      M   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/maintainer.phptM  ≠Ø$JM  £¸O∂      K   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/release2.phptL  ≠Ø$JL  ÿE¡≠∂      d   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/getdependentpackages/getdependentpackages.basic.phpt}  ≠Ø$J}  É4zE∂      R   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/getdependentpackages/setup.php.inc«  ≠Ø$J«  eﬁ:=∂      b   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/detectfileconflicts/detectfileconflicts.basic.phpt{  ≠Ø$J{  <Ù|æ∂      Q   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/detectfileconflicts/setup.php.inc«  ≠Ø$J«  eﬁ:=∂      >   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/init/test.phpt‰  ≠Ø$J‰  lfàa∂      C   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/init/construct.phpt’  ≠Ø$J’  Ì„{∂      F   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/info/info.dirtree.phptp  ≠Ø$Jp  É)∂      E   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/info/info.simple.phpt(  ≠Ø$J(  ¶±*˚∂      M   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/info/info.installedfiles.phpt~  ≠Ø$J~  
∂      B   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/info/setup.php.inc«  ≠Ø$J«  eﬁ:=∂      C   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/uninstall/test.phpt  ≠Ø$J  ¢ÆÈı∂      G   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/uninstall/setup.php.inc¬  ≠Ø$J¬  [
Ω=∂      A   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/install/test.phpt  ≠Ø$J  Ev∂      E   test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/install/setup.php.inc¬  ≠Ø$J¬  [
Ω=∂      5   test/pear2.php.net/PEAR2_Pyrus/Registry/setup.php.inci   ≠Ø$Ji   Ò˜∂∂      7   test/pear2.php.net/PEAR2_Pyrus/Package/arrayaccess.phpt  ≠Ø$J  ºõæê∂      <   test/pear2.php.net/PEAR2_Pyrus/Package/setup.minimal.php.inc@   ≠Ø$J@   Â*≈ç∂      4   test/pear2.php.net/PEAR2_Pyrus/Package/setup.php.inc.  ≠Ø$J.  vÆº®∂      C   test/pear2.php.net/PEAR2_Pyrus/Package/parsePackageDescription.phptÏ  ≠Ø$JÏ  ˘›®è∂      T   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/begin/begin.journal-exists.phpt∆  ≠Ø$J∆  z,UÑ∂      E   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/begin/begin.phptä  ≠Ø$Jä  OJΩ∂      J   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/begin/begin.fail.phpt…  ≠Ø$J…  ê∫∂      X   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/begin/begin.fail.intransaction.phptk  ≠Ø$Jk  Ôﬂ∂      K   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/begin/begin.fail2.phptÎ  ≠Ø$JÎ  äÔ∏∂      J   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/begin/begin.copy.phptï  ≠Ø$Jï  °¢∂      k   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/removeBackups/removebackups.fail.notintransaction.phptk  ≠Ø$Jk  /yI]∂      [   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/removePath/removepath.nonexisting.phptq  ≠Ø$Jq  Îô7˚∂      Y   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/removePath/removepath.notstrict.phpt‹  ≠Ø$J‹  3ßo∂      [   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/removePath/removepath.fail.strict.phpt…  ≠Ø$J…  ¿jﬁ∂      e   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/removePath/removepath.fail.notintransaction.phptm  ≠Ø$Jm  Ö!ô∂      H   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/setup.empty.php.ince   ≠Ø$Je   ·ﬂeí∂      a   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/rollback/rollback.fail.notintransaction.phpt  ≠Ø$J  R7f∂      L   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/rollback/rollback2.phptå  ≠Ø$Jå  E\^∂      K   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/rollback/rollback.phpt]  ≠Ø$J]  ÕV2ì∂      L   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/repair/repair.fail.phpt∫  ≠Ø$J∫  Ûº»€∂      M   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/repair/repair.basic.phptÖ  ≠Ø$JÖ  `CÂ∂      l   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/createOrOpenPath/createoropenpath.failure.contents.phptu  ≠Ø$Ju  7ß]^∂      q   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/createOrOpenPath/createoropenpath.fail.notintransaction.phpty  ≠Ø$Jy  ûM–∂      f   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/createOrOpenPath/createoropenpath.failure.fp.phptj  ≠Ø$Jj  %€“∂      p   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/createOrOpenPath/createoropenpath.fail.fp.stream.empty.phpt´  ≠Ø$J´  uLœ∂      m   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/createOrOpenPath/createoropenpath.failure.fp.stream.phptÎ  ≠Ø$JÎ  B~Ωã∂      ^   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/createOrOpenPath/createoropenpath.fp.phptÂ  ≠Ø$JÂ  ¥¨I∂      e   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/createOrOpenPath/createoropenpath.fp.stream.phptX  ≠Ø$JX  !Lˆ1∂      B   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/setup.php.inc   ≠Ø$J   îüæ∂      C   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/rmrf/rmrf.phpt¨  ≠Ø$J¨  ÿñS£∂      [   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/mkdir/mkdir.fail.notintransaction.phpto  ≠Ø$Jo  mÒú…∂      g   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/mkdir/removejournalpath.fail.notintransaction.phpt  ≠Ø$J  gÒ¨ô∂      Q   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/mkdir/mkdir.fail.isfile.phpt»  ≠Ø$J»  ÙÁTç∂      L   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/mkdir/mkdir.nomode.phptÙ  ≠Ø$JÙ  U_˘∂      ]   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/commit/commit.fail.notintransaction.phptv  ≠Ø$Jv  Qö“∂      R   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/commit/commit.failbackup.phptD  ≠Ø$JD  § k˛∂      G   test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/commit/commit.phpt/   ≠Ø$J/   üGw∂      C   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/install.phptU  ≠Ø$JU  bÊ}∂      F   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/channelAdd.phptÏ  ≠Ø$JÏ  ¸Ó¯≈∂      E   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/findpear2.phptü  ≠Ø$Jü  bbá∂      H   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/help.command.phpt»
  ≠Ø$J»
  iTÒ–∂      @   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/help.phptØ	  ≠Ø$JØ	  πcƒ∂      A   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/build.phptñ  ≠Ø$Jñ  e÷x∂      D   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/download.phpt-  ≠Ø$J-  ›Eœ∂      L   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/channelDiscover2.phptP	  ≠Ø$JP	  /°S›∂      K   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/upgradeRegistry.phpt‚  ≠Ø$J‚  ‚Àç,∂      L   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/setup.minimal.php.incœ  ≠Ø$Jœ  óÛc!∂      F   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/channelDel.phptÍ  ≠Ø$JÍ  ¯ò T∂      M   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.full.phpt«  ≠Ø$J«  ˜â3∞∂      P   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/setup.pearinstall.php.incÅD  ≠Ø$JÅD  EùÕp∂      D   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/upgrade2.phptî  ≠Ø$Jî  _ßN∂      P   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.cascade.phpt  ≠Ø$J  ∂'d|∂      P   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/install_pear1package.phptù  ≠Ø$Jù  •*Q¡∂      E   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/findpear3.phptÕ  ≠Ø$JÕ  Lg8˘∂      P   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/channelDiscover.fail.phptÆ  ≠Ø$JÆ  ˘ñÍy∂      ?   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/set.phpt¥  ≠Ø$J¥  °8¥m∂      O   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/setup.runscripts.php.incÌ  ≠Ø$JÌ  ªÓq∂      N   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1.phpt‘  ≠Ø$J‘  N ”w∂      F   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/runScripts.phptí  ≠Ø$Jí  ∫azÙ∂      H   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listChannels.phpt  ≠Ø$J  µ lA∂      N   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.empty.phpt  ≠Ø$J  ¬T‹B∂      K   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/channelDiscover.phptI	  ≠Ø$JI	  õÕ÷±∂      D   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/setup.php.inc  ≠Ø$J  ™∫>∂      X   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.depdblock    ≠Ø$J        ∂      h   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.channels/pear.foo.com.reg”  ≠Ø$J”  "¯(∂      a   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.channels/__uri.reg'  ≠Ø$J'  æE∂      h   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.channels/pear.php.net.rega  ≠Ø$Ja  »Zk∂      f   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.channels/.alias/foo.txt   ≠Ø$J   ≠j,£∂      g   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.channels/.alias/pecl.txt   ≠Ø$J   ui<Æ∂      g   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.channels/.alias/pear.txt   ≠Ø$J   ´ ÀŒ∂      h   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.channels/pecl.php.net.reg(  ≠Ø$J(  ≥0œ∂      `   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.registry/pear.reg ≠Ø$J d4˚∂      g   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.registry/php_archive.reg§Ç  ≠Ø$J§Ç  -8K*∂      j   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.registry/console_getopt.regú  ≠Ø$Jú  ´N£J∂      b   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.registry/xdebug.regÛå  ≠Ø$JÛå  Qg7˛∂      l   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.registry/structures_graph.regæN  ≠Ø$JæN  ¥à«„∂      g   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.registry/archive_tar.reg9#  ≠Ø$J9#  ≈@πì∂      d   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.registry/xml_util.regıb  ≠Ø$Jıb  ;Æ≈&∂      e   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.registry/text_diff.regﬁ`  ≠Ø$Jﬁ`  §>Œ ∂      V   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.filemapŸ3  ≠Ø$JŸ3  „Â0R∂      T   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.depdb≈
  ≠Ø$J≈
  ´Ÿte∂      S   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.lock    ≠Ø$J        ∂      E   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/findpear1.phpt”  ≠Ø$J”  0€“∂      C   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/upgrade.phpt  ≠Ø$J  ‚ ãê∂      O   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/build/docblock-0.2.0.tar ˛ ≠Ø$J ˛ —"c∂      R   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/packages/Net_URL-1.0.15.tar x  ≠Ø$J x  S$±W∂      F   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/configShow.phpt&
  ≠Ø$J&
  ·_à∂      K   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/uninstall.basic.phpt 	  ≠Ø$J 	  'Ûˇg∂      Q   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/channelDiscover.fail2.phpt  ≠Ø$J  ‚∂6N∂      ;   test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/setup.php.inc  ≠Ø$J  BÔKj∂      N   test/pear2.php.net/PEAR2_Pyrus/ChannelFile/setupFiles/setupChannelFile.php.incÑ   ≠Ø$JÑ   	áˇ
∂      8   test/pear2.php.net/PEAR2_Pyrus/ChannelFile/setup.php.inc@   ≠Ø$J@   Â*≈ç∂      F   test/pear2.php.net/PEAR2_Pyrus/ChannelFile/basic/simpleproperties.phptŸ  ≠Ø$JŸ  Y6KŸ∂      <   test/pear2.php.net/PEAR2_Pyrus/ChannelFile/basic/random.phpté  ≠Ø$Jé  æÑrù∂      B   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/toarray/onefile.phptÿ  ≠Ø$Jÿ  ŸÊb∂      D   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/toarray/packaging.phpt‹  ≠Ø$J‹  ≠Vƒ∂      K   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/toarray/multiplegroupdep.phptÛ  ≠Ø$JÛ  IR∂9∂      M   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/toarray/packaging.filelist.phpt  ≠Ø$J  ˙ˆ+ã∂      @   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/toarray/basic.phpt√  ≠Ø$J√  Ô+ª∂      N   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/toarray/packaging.filelist3.phptı  ≠Ø$Jı  sø•∂      N   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/toarray/packaging.filelist2.phptı  ≠Ø$Jı  Kµò¥∂      N   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/compatible/compatible.basic.phpt^  ≠Ø$J^  µ¸C3∂      L   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/compatible/compatible.set.phptV  ≠Ø$JV  x‡∫∂      P   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/compatible/iscompatible.basic.phptK  ≠Ø$JK  ˝rÍ§∂      O   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/compatible/compatible.errors.phptZ  ≠Ø$JZ  €î‰p∂      F   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/bloomy.phpt§  ≠Ø$J§  ˇ?}/∂      F   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/Config.phpt§  ≠Ø$J§  Ft‘∂      C   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/APC.phptõ  ≠Ø$Jõ  ÎI≤∂      P   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/Auth_PrefManager.phpt¬  ≠Ø$J¬  ¸Woc∂      D   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/Auth.phptû  ≠Ø$Jû  §v˝∂      H   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/setup.php.incZ  ≠Ø$JZ  w\óÍ∂      V   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/packages/Config/package.xml[R  ≠Ø$J[R  µOπ¶∂      S   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/packages/APC/package.xmlXZ  ≠Ø$JXZ  s"Vú∂      T   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/packages/Auth/package.xmlêï  ≠Ø$Jêï  “Nì∂      V   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/packages/bloomy/package.xml  ≠Ø$J  πs£˛∂      `   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/packages/Auth_PrefManager/package.xml¶.  ≠Ø$J¶.  m»ÓÄ∂      A   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/README&   ≠Ø$J&   -]M8∂      Q   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/setupFiles/setupPackageFile.php.inc_  ≠Ø$J_  ¶9|∂      _   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.extension.setting2.phptw  ≠Ø$Jw  9µ™è∂      Z   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.group.package.phptp  ≠Ø$Jp  nÄ=™∂      Y   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.arch.setting.phptj  ≠Ø$Jj  JãV∂      \   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.extension.basic.phptp  ≠Ø$Jp  Oƒ˙∂      ]   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.required.setting.phptr  ≠Ø$Jr  >©∂      M   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependson.uri.phptN  ≠Ø$JN  &(∂      _   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.subpackage.complex.phptv  ≠Ø$Jv  Â€P∂      ]   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.group.subpackage.phptv  ≠Ø$Jv  ØM5∂      K   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/os.iterator.phptû  ≠Ø$Jû  lFiõ∂      O   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.os.phptV  ≠Ø$JV  ƒÔà0∂      `   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.pearinstaller.basic.phptx  ≠Ø$Jx  ~}•∂      V   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.php.basic.phptd  ≠Ø$Jd   Ò¬∂      V   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.php.reset.phpth  ≠Ø$Jh  “h∂      `   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.package.conflicting.phptx  ≠Ø$Jx  gØ)≠∂      S   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.errors.phptÕP  ≠Ø$JÕP  è3É^∂      Z   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.group.setting.phptl  ≠Ø$Jl  Jzµ∂      ]   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.optional.setting.phptr  ≠Ø$Jr  ˇÂHÔ∂      b   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.group.package.complex.phptÄ  ≠Ø$JÄ  ëõB⁄∂      X   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.php.complex.phpth  ≠Ø$Jh  O3ù9∂      _   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.subpackage.setting.phptv  ≠Ø$Jv  Yín∂      Q   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependson.channel.phpt(  ≠Ø$J(  j	%Ò∂      `   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.subpackage.setting2.phpty  ≠Ø$Jy  mßôX∂      N   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/issubpackageof.phpt7  ≠Ø$J7  0≥û∂      ]   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.package.setting2.phpts  ≠Ø$Js  £¿…Õ∂      ^   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.extension.setting.phptt  ≠Ø$Jt  ˘aH:∂      [   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.os.conflicting.phptn  ≠Ø$Jn  Ç0÷¡∂      X   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependson.uri.subpackage.phpt]  ≠Ø$J]  ¢§˜ø∂      S   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/issubpackage.mixed3.phptﬁ  ≠Ø$Jﬁ  ~CÎ{∂      W   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.os.setting.phptf  ≠Ø$Jf  =•*›∂      R   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.group.phpt\  ≠Ø$J\  »€S∞∂      Y   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.package.pecl.phptj  ≠Ø$Jj  Ö‚Ë∂      P   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/issubpackage.uri.phpt≈  ≠Ø$J≈  D™Æ‘∂      R   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/issubpackage.mixed.phptŸ  ≠Ø$JŸ  ‘/é∂      e   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.package.optional.complex.phptÇ  ≠Ø$JÇ  öI¥'∂      X   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.package.uri.phpth  ≠Ø$Jh  ⁄«
	∂      \   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.group.extension.phptt  ≠Ø$Jt  ıóK∂      M   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/arch.iterator.phpt±  ≠Ø$J±  ˚™h∂      ]   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.arch.conflicting.phptr  ≠Ø$Jr  µıã∂      Q   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.arch.phptZ  ≠Ø$JZ  ¸¯£∂      \   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependson.channel.subpackage.phpt4  ≠Ø$J4  Ë\ıı∂      S   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/issubpackage.mixed2.phpt∫  ≠Ø$J∫  ÊÉ«∂      P   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/package.coverage.phpt∫  ≠Ø$J∫  ﬁµ†∂      X   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.php.exclude.phptt  ≠Ø$Jt  7Ÿ⁄s∂      h   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.subpackage.optional.complex.phptà  ≠Ø$Jà  5•ü¨∂      \   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.package.setting.phptp  ≠Ø$Jp  xñÀ^∂      \   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.package.complex.phptp  ≠Ø$Jp  *ãh∂      b   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.pearinstaller.complex.phpt|  ≠Ø$J|  2À[b∂      R   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/issubpackage.basic.phptô  ≠Ø$Jô  _6£∂      ;   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/setup.php.inc@   ≠Ø$J@   Â*≈ç∂      =   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/test.phpt8  ≠Ø$J8  jE ∂      A   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/usestask.phpt  ≠Ø$J  @BWÇ∂      @   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/license.phptÃ  ≠Ø$JÃ  ÒØ∂      B   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/usestask2.phpt  ≠Ø$J  B∂      H   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/usesrole.errors.phptÍ  ≠Ø$JÍ  —Æ-∂      J   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/packagingcontents.phptQ  ≠Ø$JQ  -J“∂      @   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/release.phpt?  ≠Ø$J?  ∆ûÏ∂      H   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/usestask.errors.phptÍ  ≠Ø$JÍ  S*˝D∂      G   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/allmaintainers.phptK  ≠Ø$JK  Ïe^Í∂      I   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/simpleproperties.phptV  ≠Ø$JV  NÜ˝∂      G   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/bundledpackage.phptò  ≠Ø$Jò  èµŸ‘∂      P   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/release.configureoption.phpt0  ≠Ø$J0  OÒá˙∂      >   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/file2.phptE  ≠Ø$JE  äsΩg∂      D   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/maintainer2.phptJ  ≠Ø$JJ  ∑P˙∂      G   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/extra.coverage.phptŒ  ≠Ø$JŒ  Èæ6∂      X   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/release.configureoption.setting.phpt@  ≠Ø$J@  ÑœD”∂      W   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/release.configureoption.errors.phpt>  ≠Ø$J>  ¡]‰ÿ∂      P   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/simpleproperties.errors.phpt&  ≠Ø$J&  	Ÿr∂      A   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/usesrole.phpt  ≠Ø$J  Œeı5∂      =   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/file.phpt@  ≠Ø$J@  ﬂìÏu∂      A   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/setup.php.inc≥  ≠Ø$J≥  ~Æ““∂      C   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/setlicense.phpt   ≠Ø$J   òﬁ@∂      A   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/release3.phptD  ≠Ø$JD  ,/∂      B   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/usesrole2.phpt  ≠Ø$J  ™ å∂      J   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/simpleproperties2.phpt  ≠Ø$J  —]œ∂      C   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/maintainer.phptE  ≠Ø$JE  ÜŸÂ®∂      N   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/release.binarypackage.phpt,  ≠Ø$J,  ‚Û∏Ú∂      A   test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/release2.phptî  ≠Ø$Jî  ›∆≤_∂         php/PEAR2/Pyrus.phpm  ≠Ø$Jm  ^≈¡‚∂         php/PEAR2/Pyrus/test.phpπ  ≠Ø$Jπ  ä¥∂      )   php/PEAR2/Pyrus/AtomicFileTransaction.phpçU  ≠Ø$JçU  „õáﬁ∂         php/PEAR2/Pyrus/IRegistry.phpæ  ≠Ø$Jæ  ∏ÿ£–∂         php/PEAR2/Pyrus/Validate.php‚O  ≠Ø$J‚O  d¢B	∂      $   php/PEAR2/Pyrus/IFileTransaction.phpi  ≠Ø$Ji  ((∂      #   php/PEAR2/Pyrus/ChannelRegistry.phpÎ  ≠Ø$JÎ  êq°∂      $   php/PEAR2/Pyrus/Config/Exception.php›  ≠Ø$J›  ∑æ„∂      #   php/PEAR2/Pyrus/Config/Snapshot.phpç  ≠Ø$Jç  SH1◊∂      "   php/PEAR2/Pyrus/Validator/PECL.phpk  ≠Ø$Jk  €÷‘†∂      !   php/PEAR2/Pyrus/DirectedGraph.phpâ  ≠Ø$Jâ  \U˘∂      $   php/PEAR2/Pyrus/IChannelRegistry.phpÅ  ≠Ø$JÅ  Y‡.j∂          php/PEAR2/Pyrus/ScriptRunner.php  ≠Ø$J  <?‹Ò∂         php/PEAR2/Pyrus/test1.phpî  ≠Ø$Jî  ∂D˚7∂      (   php/PEAR2/Pyrus/ChannelRegistry/Base.phpÈ*  ≠Ø$JÈ*  ∫›ıä∂      '   php/PEAR2/Pyrus/ChannelRegistry/Xml.php∞  ≠Ø$J∞  {(3‡∂      +   php/PEAR2/Pyrus/ChannelRegistry/Sqlite3.phpü>  ≠Ø$Jü>  uÕ§∂      2   php/PEAR2/Pyrus/ChannelRegistry/ParseException.php‹  ≠Ø$J‹  ˜.…)∂      .   php/PEAR2/Pyrus/ChannelRegistry/Mirror/Xml.phpÀ  ≠Ø$JÀ  ∞∆ê-∂      2   php/PEAR2/Pyrus/ChannelRegistry/Mirror/Sqlite3.php   ≠Ø$J   (O/∂      +   php/PEAR2/Pyrus/ChannelRegistry/Channel.php  ≠Ø$J  Ó≈-∂      -   php/PEAR2/Pyrus/ChannelRegistry/Exception.php  ≠Ø$J  ˜<^∂      )   php/PEAR2/Pyrus/ChannelRegistry/Pear1.php_!  ≠Ø$J_!  Ë YU∂      '   php/PEAR2/Pyrus/XMLWriter/Exception.php›  ≠Ø$J›  ÀÔ<Ö∂      &   php/PEAR2/Pyrus/Validate/Exception.phpF  ≠Ø$JF  h6‡B∂      '   php/PEAR2/Pyrus/Installer/Exception.phpﬂ  ≠Ø$Jﬂ  ™/P∂      &   php/PEAR2/Pyrus/Installer/Role/Ext.xml∂  ≠Ø$J∂  ∆Í˚ª∂      )   php/PEAR2/Pyrus/Installer/Role/Script.xml*  ≠Ø$J*  Íÿ}I∂      &   php/PEAR2/Pyrus/Installer/Role/Src.xml©  ≠Ø$J©  É˜®Ó∂      )   php/PEAR2/Pyrus/Installer/Role/Script.php‡  ≠Ø$J‡  ›äÑ∂      )   php/PEAR2/Pyrus/Installer/Role/Common.phpï  ≠Ø$Jï  GOv«∂      &   php/PEAR2/Pyrus/Installer/Role/Ext.php◊  ≠Ø$J◊  Hë◊∂      &   php/PEAR2/Pyrus/Installer/Role/Www.xml  ≠Ø$J  g8ô≤∂      -   php/PEAR2/Pyrus/Installer/Role/Customtask.xml$  ≠Ø$J$  Áuh˜∂      &   php/PEAR2/Pyrus/Installer/Role/Www.php⁄  ≠Ø$J⁄  àˇÅ∂      &   php/PEAR2/Pyrus/Installer/Role/Src.php◊  ≠Ø$J◊  “jˇ∂      '   php/PEAR2/Pyrus/Installer/Role/Data.xml  ≠Ø$J  {„È∂      -   php/PEAR2/Pyrus/Installer/Role/Customrole.phpÙ  ≠Ø$JÙ  é∞∂      ,   php/PEAR2/Pyrus/Installer/Role/Exception.php‹  ≠Ø$J‹  &üFí∂      0   php/PEAR2/Pyrus/Installer/Role/Customcommand.xml'  ≠Ø$J'  dEÀ∂      '   php/PEAR2/Pyrus/Installer/Role/Test.php⁄  ≠Ø$J⁄  l∆∑–∂      &   php/PEAR2/Pyrus/Installer/Role/Php.php◊  ≠Ø$J◊  î,ñ∂      -   php/PEAR2/Pyrus/Installer/Role/Customrole.xml$  ≠Ø$J$  a+	∂      '   php/PEAR2/Pyrus/Installer/Role/Data.php⁄  ≠Ø$J⁄  /ÿ“∂      0   php/PEAR2/Pyrus/Installer/Role/Customcommand.php˙  ≠Ø$J˙  ¥co∂      -   php/PEAR2/Pyrus/Installer/Role/Customtask.phpÙ  ≠Ø$JÙ  p÷ﬁ∫∂      &   php/PEAR2/Pyrus/Installer/Role/Php.xml$  ≠Ø$J$  ÄèøV∂      '   php/PEAR2/Pyrus/Installer/Role/Test.xml  ≠Ø$J  ®k¬Ä∂      &   php/PEAR2/Pyrus/Installer/Role/Doc.php◊  ≠Ø$J◊  ®πkP∂      &   php/PEAR2/Pyrus/Installer/Role/Doc.xml  ≠Ø$J  √éá∂      "   php/PEAR2/Pyrus/Installer/Role.php}$  ≠Ø$J}$  ‡
0π∂         php/PEAR2/Pyrus/IChannel.phpF  ≠Ø$JF  AdÕ∂∂         php/PEAR2/Pyrus/Config.phpΩ¨  ≠Ø$JΩ¨  ∂^7_∂      (   php/PEAR2/Pyrus/Dependency/Exception.phpÿ  ≠Ø$Jÿ  PÎõ}∂      (   php/PEAR2/Pyrus/Dependency/Validator.phpì  ≠Ø$Jì  /õ-ˆ∂      "   php/PEAR2/Pyrus/PluginRegistry.phpk  ≠Ø$Jk  xå»∂         php/PEAR2/Pyrus/REST/13.phpÇ(  ≠Ø$JÇ(  Ü˚D1∂         php/PEAR2/Pyrus/REST/11.php…&  ≠Ø$J…&  ˇaÕ∂         php/PEAR2/Pyrus/REST/10.phpäp  ≠Ø$Jäp  Ö.9∂      &   php/PEAR2/Pyrus/REST/HTTPException.php‹  ≠Ø$J‹  DÑ:∂      "   php/PEAR2/Pyrus/REST/Exception.php   ≠Ø$J   «€ÒB∂         php/PEAR2/Pyrus/IPackage.php‹  ≠Ø$J‹  /∞“Õ∂         php/PEAR2/Pyrus/Channel.php2  ≠Ø$J2  ∫1iü∂         php/PEAR2/Pyrus/ILog.php”  ≠Ø$J”  æ/∂      +   php/PEAR2/Pyrus/DirectedGraph/Exception.phpﬂ  ≠Ø$Jﬂ  ú≈ßq∂      (   php/PEAR2/Pyrus/DirectedGraph/Vertex.phpÒ  ≠Ø$JÒ  YÑ«*∂         php/PEAR2/Pyrus/Exception.php«  ≠Ø$J«  $ΩÙ<∂      "   php/PEAR2/Pyrus/PackageFile/v2.php•≠  ≠Ø$J•≠  Û$X0∂      )   php/PEAR2/Pyrus/PackageFile/Exception.phpﬂ  ≠Ø$Jﬂ  !‘V∂      )   php/PEAR2/Pyrus/PackageFile/Parser/v2.phpá  ≠Ø$Já  â∂      1   php/PEAR2/Pyrus/PackageFile/v2/SimpleProperty.phpG
  ≠Ø$JG
  H1
?∂      ,   php/PEAR2/Pyrus/PackageFile/v2/Developer.php¡+  ≠Ø$J¡+  r>∏
∂      (   php/PEAR2/Pyrus/PackageFile/v2/Files.phpü	  ≠Ø$Jü	   Oê!∂      /   php/PEAR2/Pyrus/PackageFile/v2/UsesRoleTask.phpó  ≠Ø$Jó  nx¿∂      6   php/PEAR2/Pyrus/PackageFile/v2/Developer/Exception.php  ≠Ø$J  Õw∂      *   php/PEAR2/Pyrus/PackageFile/v2/Release.phpÉ<  ≠Ø$JÉ<  €qR∂      /   php/PEAR2/Pyrus/PackageFile/v2/Dependencies.phpu/  ≠Ø$Ju/  6R_∂      4   php/PEAR2/Pyrus/PackageFile/v2/License/Exception.php  ≠Ø$J  k¿:∂      -   php/PEAR2/Pyrus/PackageFile/v2/Compatible.php"  ≠Ø$J"  à∞àv∂      <   php/PEAR2/Pyrus/PackageFile/v2/Configureoption/Exception.php  ≠Ø$J  “Ñ›¥∂      2   php/PEAR2/Pyrus/PackageFile/v2/Configureoption.php«  ≠Ø$J«  †pDÈ∂      9   php/PEAR2/Pyrus/PackageFile/v2/UsesRoleTask/Exception.php   ≠Ø$J   ≈z∫'∂      5   php/PEAR2/Pyrus/PackageFile/v2/Dependencies/Group.php_  ≠Ø$J_  95∂      9   php/PEAR2/Pyrus/PackageFile/v2/Dependencies/Exception.php  ≠Ø$J  UƒB+∂      7   php/PEAR2/Pyrus/PackageFile/v2/Dependencies/Package.phpc<  ≠Ø$Jc<  GiDä∂      3   php/PEAR2/Pyrus/PackageFile/v2/Dependencies/Dep.php:  ≠Ø$J:  ´Æëõ∂      -   php/PEAR2/Pyrus/PackageFile/v2/Files/File.php@
  ≠Ø$J@
  3+ ∂      2   php/PEAR2/Pyrus/PackageFile/v2/Files/Exception.php  ≠Ø$J  ÄG6√∂      *   php/PEAR2/Pyrus/PackageFile/v2/License.php‹  ≠Ø$J‹  Q$ı∂      :   php/PEAR2/Pyrus/PackageFile/v2/Release/ConfigureOption.php  ≠Ø$J  ∏øZi∂      8   php/PEAR2/Pyrus/PackageFile/v2/Release/BinaryPackage.phpè	  ≠Ø$Jè	  Án´Z∂      ;   php/PEAR2/Pyrus/PackageFile/v2/Release/InstallCondition.phpï.  ≠Ø$Jï.  É€ÑÕ∂      4   php/PEAR2/Pyrus/PackageFile/v2/Release/Exception.php	  ≠Ø$J	  uWA∂      1   php/PEAR2/Pyrus/PackageFile/v2/BundledPackage.phph  ≠Ø$Jh  	1∂      ,   php/PEAR2/Pyrus/PackageFile/v2/Validator.php~d  ≠Ø$J~d  ∂¢∂      7   php/PEAR2/Pyrus/PackageFile/v2/Compatible/Exception.php  ≠Ø$J  yzZ∂      *   php/PEAR2/Pyrus/PackageFile/IValidator.php  ≠Ø$J  ÉÕö∂      <   php/PEAR2/Pyrus/PackageFile/v2Iterator/PackagingIterator.phpÜ  ≠Ø$JÜ  s6üÃ∂      7   php/PEAR2/Pyrus/PackageFile/v2Iterator/FileContents.phpÔ	  ≠Ø$JÔ	  0?ë¡∂      /   php/PEAR2/Pyrus/PackageFile/v2Iterator/File.phpÃ  ≠Ø$JÃ  ≤ ÕÌ∂      C   php/PEAR2/Pyrus/PackageFile/v2Iterator/ScriptFileFilterIterator.php÷  ≠Ø$J÷  ÖX&∂      <   php/PEAR2/Pyrus/PackageFile/v2Iterator/FileContentsMulti.phpj  ≠Ø$Jj  ´x@Ê∂      A   php/PEAR2/Pyrus/PackageFile/v2Iterator/FileInstallationFilter.php0  ≠Ø$J0  
Ã]∂      <   php/PEAR2/Pyrus/PackageFile/v2Iterator/FileAttribsFilter.php:  ≠Ø$J:  CO¬h∂      2   php/PEAR2/Pyrus/PackageFile/v2Iterator/FileTag.php"  ≠Ø$J"  ≤'e∂      '   php/PEAR2/Pyrus/XMLParser/Exception.php›  ≠Ø$J›  J+ñr∂         php/PEAR2/Pyrus/XMLParser.php∂!  ≠Ø$J∂!  ¡êwŸ∂         php/PEAR2/Pyrus/PECLBuild.php›E  ≠Ø$J›E  æe6|∂         php/PEAR2/Pyrus/test2.php  ≠Ø$J  qè∂         php/PEAR2/Pyrus/ChannelFile.phpí  ≠Ø$Jí  öX±∂      "   php/PEAR2/Pyrus/ScriptFrontend.phpÍ  ≠Ø$JÍ  1∞a°∂         php/PEAR2/Pyrus/Uninstaller.php«  ≠Ø$J«  &#6w∂          php/PEAR2/Pyrus/IPackageFile.php
  ≠Ø$J
  04äˆ∂         php/PEAR2/Pyrus/PackageFile.php¡  ≠Ø$J¡  ∫NV˙∂         php/PEAR2/Pyrus/XMLWriter.php⁄#  ≠Ø$J⁄#  
‘{ﬂ∂         php/PEAR2/Pyrus/Log.phpx  ≠Ø$Jx  ÿ+V8∂      #   php/PEAR2/Pyrus/Task/Replace/rw.php¯  ≠Ø$J¯  Ä≤∂      &   php/PEAR2/Pyrus/Task/MultipleProxy.phph  ≠Ø$Jh  Ùÿ.∂         php/PEAR2/Pyrus/Task/Common.php  ≠Ø$J  †«%∂      ;   php/PEAR2/Pyrus/Task/Postinstallscript/Paramgroup/Param.php≥$  ≠Ø$J≥$  Á¿ƒ»∂      5   php/PEAR2/Pyrus/Task/Postinstallscript/Paramgroup.php.9  ≠Ø$J.9  lVPﬁ∂      #   php/PEAR2/Pyrus/Task/Unixeol/rw.php  ≠Ø$J  ƒÙìç∂      .   php/PEAR2/Pyrus/Task/Exception/InvalidTask.php€  ≠Ø$J€  Ãƒñà∂      3   php/PEAR2/Pyrus/Task/Exception/MissingAttribute.php„  ≠Ø$J„  j’È∂      /   php/PEAR2/Pyrus/Task/Exception/NoAttributes.php∞  ≠Ø$J∞  Cı√∂      6   php/PEAR2/Pyrus/Task/Exception/WrongAttributeValue.phpã  ≠Ø$Jã  +s∂      #   php/PEAR2/Pyrus/Task/Windowseol.php6
  ≠Ø$J6
  ”IÏ∫∂      "   php/PEAR2/Pyrus/Task/Exception.phpí  ≠Ø$Jí  ¨XƒØ∂      *   php/PEAR2/Pyrus/Task/Postinstallscript.phpÏG  ≠Ø$JÏG  ìÈú∂          php/PEAR2/Pyrus/Task/Replace.php  ≠Ø$J  {(©∂      &   php/PEAR2/Pyrus/Task/Windowseol/rw.php  ≠Ø$J  1Ï⁄∂          php/PEAR2/Pyrus/Task/Unixeol.php7
  ≠Ø$J7
  *pôI∂      $   php/PEAR2/Pyrus/FileTransactions.php$  ≠Ø$J$  ®svÀ∂      '   php/PEAR2/Pyrus/PECLBuild/Exception.phpË  ≠Ø$JË  K,∂o∂         php/PEAR2/Pyrus/Package.php∞  ≠Ø$J∞  '˘lÆ∂      %   php/PEAR2/Pyrus/Channel/Exception.phpŒ  ≠Ø$JŒ  Ma-ö∂      *   php/PEAR2/Pyrus/Channel/Remotepackages.php€  ≠Ø$J€  	«*∞∂      )   php/PEAR2/Pyrus/Channel/Remotepackage.php¡@  ≠Ø$J¡@  W∞º∂      #   php/PEAR2/Pyrus/Channel/IMirror.php‡  ≠Ø$J‡  ô*(å∂      !   php/PEAR2/Pyrus/Registry/Base.phpâ  ≠Ø$Jâ  æ˛ãü∂          php/PEAR2/Pyrus/Registry/Xml.php2  ≠Ø$J2  Çê*∂      $   php/PEAR2/Pyrus/Registry/Sqlite3.php ˙  ≠Ø$J ˙  É˙∂      *   php/PEAR2/Pyrus/Registry/Pear1/Package.php^  ≠Ø$J^  ‹ƒ∂      /   php/PEAR2/Pyrus/Registry/Pear1/DependencyDB.phpØI  ≠Ø$JØI  Õp∂      (   php/PEAR2/Pyrus/Registry/Xml/Package.php  ≠Ø$J  U=LŸ∂      &   php/PEAR2/Pyrus/Registry/Exception.php›  ≠Ø$J›  Ó}i∂      ,   php/PEAR2/Pyrus/Registry/Sqlite3/Package.phpû  ≠Ø$Jû  óìU‡∂      ,   php/PEAR2/Pyrus/Registry/Sqlite3/Creator.phplW  ≠Ø$JlW  Nñô∂      "   php/PEAR2/Pyrus/Registry/Pear1.php\  ≠Ø$J\  ¡C≤Ë∂      )   php/PEAR2/Pyrus/Registry/Package/Base.php;  ≠Ø$J;  A®{Ó∂         php/PEAR2/Pyrus/Installer.phpV  ≠Ø$JV   À
»∂          php/PEAR2/Pyrus/Package/Base.php•  ≠Ø$J•  ÖW'•∂         php/PEAR2/Pyrus/Package/Xml.php∫  ≠Ø$J∫  ıíá-∂      -   php/PEAR2/Pyrus/Package/Creator/Exception.phpÎ  ≠Ø$JÎ  ¯¯[Ú∂      0   php/PEAR2/Pyrus/Package/Creator/TaskIterator.phpù  ≠Ø$Jù  ÁÏ0≠∂      .   php/PEAR2/Pyrus/Package/InstalledException.php˛  ≠Ø$J˛  '~Ö2∂      )   php/PEAR2/Pyrus/Package/Zip/Exception.php‡  ≠Ø$J‡  ∆Ó0¡∂      "   php/PEAR2/Pyrus/Package/Remote.phpç0  ≠Ø$Jç0  ü’Ω∂      *   php/PEAR2/Pyrus/Package/Phar/Exception.php„  ≠Ø$J„  +cé¶∂      %   php/PEAR2/Pyrus/Package/Exception.php‘  ≠Ø$J‘  Ê1‰∂         php/PEAR2/Pyrus/Package/Tar.phpÉ,  ≠Ø$JÉ,  Íu $∂         php/PEAR2/Pyrus/Package/Zip.phpÑ  ≠Ø$JÑ  ÙAÊT∂      )   php/PEAR2/Pyrus/Package/Tar/Exception.php‡  ≠Ø$J‡  yG8O∂      #   php/PEAR2/Pyrus/Package/Creator.php¬4  ≠Ø$J¬4  Lå÷!∂          php/PEAR2/Pyrus/Package/Phar.php   ≠Ø$J   _l#g∂      $   php/PEAR2/Pyrus/Package/ICreator.phpW  ≠Ø$JW  Å©Ì˘∂      &   php/PEAR2/Pyrus/Package/Dependency.php∞/  ≠Ø$J∞/  ¿ßøÑ∂      3   php/PEAR2/Pyrus/AtomicFileTransaction/Exception.php  ≠Ø$J  F5„6∂      *   php/PEAR2/Pyrus/ScriptFrontend/Command.phpS  ≠Ø$JS  .*Â∂      +   php/PEAR2/Pyrus/ScriptFrontend/Renderer.php=
  ≠Ø$J=
  j%‹ ∂      +   php/PEAR2/Pyrus/ScriptFrontend/Commands.php≈s  ≠Ø$J≈s  |rVT∂         php/PEAR2/Pyrus/REST.php!4  ≠Ø$J!4  ©√QY∂      "   php/PEAR2/Pyrus/ChannelFile/v1.php^;  ≠Ø$J^;  üÁÂ‹∂      )   php/PEAR2/Pyrus/ChannelFile/Exception.phpB   ≠Ø$JB   ⁄◊X∂      )   php/PEAR2/Pyrus/ChannelFile/Parser/v1.php'  ≠Ø$J'  ˝ì(:∂      )   php/PEAR2/Pyrus/ChannelFile/v1/Mirror.php  ≠Ø$J  K¬˙à∂      9   php/PEAR2/Pyrus/ChannelFile/v1/Servers/Protocols/REST.php∞  ≠Ø$J∞  ‡ ûW∂      4   php/PEAR2/Pyrus/ChannelFile/v1/Servers/Protocols.php¯  ≠Ø$J¯  qãZ∂      *   php/PEAR2/Pyrus/ChannelFile/v1/Servers.phpã  ≠Ø$Jã  ~¸Fã∂         php/PEAR2/Pyrus/Registry.php "  ≠Ø$J "  ˛äs)∂      ,   php/PEAR2/Pyrus/PluginRegistry/Exception.phpÚ  ≠Ø$JÚ  _]c∂          php/PEAR2/Pyrus/IChannelFile.php  ≠Ø$J  Ã+º∑∂         php/PEAR2/Pyrus/OSGuess.phpB+  ≠Ø$JB+  ›…∂Œ∂      4   data/pear2.php.net/PEAR2_Pyrus/built-in-commands.xmlî3  ≠Ø$Jî3  f–){∂      1   data/pear2.php.net/PEAR2_Pyrus/customtask-2.0.xsdÙ  ≠Ø$JÙ  èeÙ∂      1   data/pear2.php.net/PEAR2_Pyrus/customrole-2.0.xsd´
  ≠Ø$J´
  †›˙∑∂      .   data/pear2.php.net/PEAR2_Pyrus/package-2.0.xsdÉW  ≠Ø$JÉW  ~É-∂      9   data/pear2.php.net/PEAR2_Pyrus/default_channels/__uri.xmlÒ  ≠Ø$JÒ  "∂∂      @   data/pear2.php.net/PEAR2_Pyrus/default_channels/pecl.php.net.xmlp  ≠Ø$Jp  r∞±∂      @   data/pear2.php.net/PEAR2_Pyrus/default_channels/pear.php.net.xmlù  ≠Ø$Jù  dHˇ∂      A   data/pear2.php.net/PEAR2_Pyrus/default_channels/pear2.php.net.xmlŸ  ≠Ø$JŸ  ‘wø∂      4   data/pear2.php.net/PEAR2_Pyrus/customcommand-2.0.xsd>  ≠Ø$J>  ≈BuÆ∂      .   data/pear2.php.net/PEAR2_Pyrus/channel-1.0.xsd∫  ≠Ø$J∫  ä≤vw∂      .   data/pear2.php.net/PEAR2_Pyrus/package-2.1.xsdÖZ  ≠Ø$JÖZ  W2zß∂         php/PEAR2/Autoload.php7	  ≠Ø$J7	  Æ&&…∂         php/PEAR2/MultiErrors.php•  ≠Ø$J•  ∆ıï∂      #   php/PEAR2/MultiErrors/Exception.phpB   ≠Ø$JB   ˙«z≤∂         php/PEAR2/Exception.php 0  ≠Ø$J 0  zb√2∂         php/PEAR2/HTTP/    ≠Ø$J        ˇ         php/PEAR2/HTTP/Request.phpÄ  ≠Ø$JÄ  ¢:ñ∂         php/PEAR2/HTTP/Request/    ≠Ø$J        ˇ      "   php/PEAR2/HTTP/Request/Adapter.phpw  ≠Ø$Jw  	ˇ∂         php/PEAR2/HTTP/Request/Adapter/    ≠Ø$J        ˇ      '   php/PEAR2/HTTP/Request/Adapter/Curl.phpj  ≠Ø$Jj  ˘çG0∂      '   php/PEAR2/HTTP/Request/Adapter/Http.phpò  ≠Ø$Jò  .ﬁe∂      ,   php/PEAR2/HTTP/Request/Adapter/Phpsocket.phpÎ,  ≠Ø$JÎ,  —ê~¶∂      ,   php/PEAR2/HTTP/Request/Adapter/Phpstream.php˜  ≠Ø$J˜  Sö¯ƒ∂      $   php/PEAR2/HTTP/Request/Exception.phpE   ≠Ø$JE   5≈ˆ,∂      "   php/PEAR2/HTTP/Request/Headers.phpŸ  ≠Ø$JŸ  =2d∂      #   php/PEAR2/HTTP/Request/Listener.phpê  ≠Ø$Jê  ∂*ƒ∂      #   php/PEAR2/HTTP/Request/Response.phpD  ≠Ø$JD  t5¸Ò∂         php/PEAR2/HTTP/Request/Uri.php¡  ≠Ø$J¡  m[∫\∂         php/PEAR2/Console/    ≠Ø$J        ˇ      !   php/PEAR2/Console/CommandLine.phpì  ≠Ø$Jì  ¢ÇJ5∂         php/PEAR2/Console/CommandLine/    ≠Ø$J        ˇ      (   php/PEAR2/Console/CommandLine/Result.phpï  ≠Ø$Jï  )Ê◊0∂      *   php/PEAR2/Console/CommandLine/Renderer.php@  ≠Ø$J@  
—˝€∂      +   php/PEAR2/Console/CommandLine/Outputter.phpÿ  ≠Ø$Jÿ  ≠“~1∂      (   php/PEAR2/Console/CommandLine/Option.phpä&  ≠Ø$Jä&  Ä∏‚ú∂      1   php/PEAR2/Console/CommandLine/MessageProvider.php7  ≠Ø$J7  WÂ˝∏∂      +   php/PEAR2/Console/CommandLine/Exception.phpM	  ≠Ø$JM	  ¿û≈∂      )   php/PEAR2/Console/CommandLine/Element.php‰
  ≠Ø$J‰
  ëÇÎë∂      )   php/PEAR2/Console/CommandLine/Command.phpà  ≠Ø$Jà  ˚3C•∂      *   php/PEAR2/Console/CommandLine/Argument.phpœ  ≠Ø$Jœ  πKò∂      (   php/PEAR2/Console/CommandLine/Action.php/  ≠Ø$J/  >·∏∂      '   php/PEAR2/Console/CommandLine/Renderer/    ≠Ø$J        ˇ      2   php/PEAR2/Console/CommandLine/Renderer/Default.phpﬁ(  ≠Ø$Jﬁ(  ºJ€∂      (   php/PEAR2/Console/CommandLine/Outputter/    ≠Ø$J        ˇ      3   php/PEAR2/Console/CommandLine/Outputter/Default.php™  ≠Ø$J™  ìê≥Ô∂      .   php/PEAR2/Console/CommandLine/MessageProvider/    ≠Ø$J        ˇ      9   php/PEAR2/Console/CommandLine/MessageProvider/Default.php  ≠Ø$J  ˇŸî∂      %   php/PEAR2/Console/CommandLine/Action/    ≠Ø$J        ˇ      1   php/PEAR2/Console/CommandLine/Action/Callback.php¢	  ≠Ø$J¢	  £ÿ¥H∂      0   php/PEAR2/Console/CommandLine/Action/Counter.phpº  ≠Ø$Jº  Nà]∂      -   php/PEAR2/Console/CommandLine/Action/Help.php≤  ≠Ø$J≤  	T|«∂      3   php/PEAR2/Console/CommandLine/Action/StoreFloat.php∆  ≠Ø$J∆  ﬁ(6∂      1   php/PEAR2/Console/CommandLine/Action/StoreInt.phpƒ  ≠Ø$Jƒ  ˛û€∂      4   php/PEAR2/Console/CommandLine/Action/StoreString.php‹  ≠Ø$J‹  ƒ.c¨∂      2   php/PEAR2/Console/CommandLine/Action/StoreTrue.php  ≠Ø$J  z∫Ir∂      0   php/PEAR2/Console/CommandLine/Action/Version.php¢  ≠Ø$J¢  Ó]Xˆ∂      <?php
function pyrus_autoload($class)
{
    include 'phar://' . PYRUS_PHAR_FILE . '/php/' . implode('/', explode('_', $class)) . '.php';
}
spl_autoload_register("pyrus_autoload");
$frontend = new PEAR2_Pyrus_ScriptFrontend_Commands;
@array_shift($_SERVER['argv']);
$frontend->run($_SERVER['argv']);
<?xml version="1.0" encoding="UTF-8"?>
<package xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="2.1" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>PEAR2_Pyrus</name>
 <channel>pear2.php.net</channel>
 <summary>Pyrus is the package manager and installer for PHP 5.3 or newer
</summary>
 <description>
Pyrus provides the means to install and manage installations for
packages built using package.xml version 2.0 or newer.  Pyrus is
redesigned from the ground up for PHP 5.3 or newer, and provides
significant improvements over the older PEAR Installer.

To use Pyrus, in this development series of releases, you need to
instantiate a simple script that creates a package and installs it:

&lt;?php
// use full path if include_path is not set up
include 'PEAR2/Autoload.php';
$config = PEAR2_Pyrus_Config::singleton('/where/to/install');
// this can be a url to a remote package, a local .tgz, .zip or package.xml
$p = new PEAR2_Pyrus_Package('thingtoinstall');
try {
    PEAR2_Pyrus_Installer::begin();
    PEAR2_Pyrus_Installer::prepare($p);
    PEAR2_Pyrus_Installer::commit();
} catch (Exception $e) {
    PEAR2_Pyrus_Installer::rollback();
    echo $e;
}
?&gt;</description>
 <lead>
  <name>Gregory Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-06-01</date>
 <time>23:50:22</time>
 <version>
  <release>2.0.0a1</release>
  <api>2.0.0a1</api>
 </version>
 <stability>
  <release>devel</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>Initial development release

Missing features:
 - introspection of packages, installed or not
 - mass upgrade/remote-list
 - anything pecl
 - post-install scripts
 - fancy frontends

Implemented features:
 - install of both PEAR and Pyrus-generated packages
 - remote install from URL
 - remote install from channel
 - more robust file transactions that are nearly atomic
 - much smarter dependency resolution than PEAR
 - much smarter pre-download version resolution for dependencies
 - registry transactions on installation
 - redundant registries in sqlite3, xml formats
 - full support for PEAR 1.x serialized array registry
 - simple CLI frontend</notes>
 <contents>
  <dir name="/">
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLWriter/siblingtags.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLWriter/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLWriter/recursivetag.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLWriter/empty.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLWriter/childtag_sibling_attribs.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLWriter/childtag_content.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLWriter/childtag_attribs.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLWriter/childtag.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLWriter/attribs_content.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLWriter/attribs.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLParser/siblingtags.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLParser/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLParser/recursivetag.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLParser/empty.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLParser/childtag_sibling_attribs.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLParser/childtag_content.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLParser/childtag_attribs.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLParser/childtag.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLParser/cdata.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLParser/attribs_content.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/XMLParser/attribs.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validator_PECL/validateversion.failure.rc.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validator_PECL/validatename.failure.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validator_PECL/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validpackagename.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.validsnapshot.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.validbeta.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.stable.rcalphabeta.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.stable.2.0.0.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.stable.0.9.0.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.packaging.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.invalidversion.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.extends.stable.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.extends.alpha.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.extends.alpha.2.0.1.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.extends.alpha.2.0.0001.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.extends.alpha.2.0.0.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.extends.alpha.2.0.000.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.extends.alpha.00.1.0.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.extends.alpha.0.1.0.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.devel.1.0.0.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.alpha.2.0.0.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.alpha.1.0.0001.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.alpha.1.0.1.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.alpha.1.0.0.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.alpha.1.0.000.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.alpha.00.0.0.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.2decimals.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.failure.00.0.0.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.alpha.extends.2.0.0a1.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validateversion.alpha.0.3.4.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validatepackagename.failure.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validatepackagename.extends.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/validatepackagename.extends.failure.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Validate/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Uninstaller/uninstall.rollback.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Uninstaller/uninstall.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/test_framework.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Windowseol/validatexml.failure.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Windowseol/startsession.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Unixeol/validatexml.failure.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Unixeol/startsession.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/setup.minimal.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Replace/validatexml.failure.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Replace/startsession.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/__get/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/__get/paramgroup2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/__get/paramgroup1.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/__get/paramgroup.matchesconditiontype.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/__get/paramgroup.condition.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/__get/param.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure17.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure16.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure15.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure14.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure13.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure12.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure11.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure10.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure9.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure8.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure7.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure6.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure5.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure4.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure3.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Task/Postinstallscript/validatexml.failure.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptRunner/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptRunner/postprocessprompts.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptRunner/basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/upgradeRegistry.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/upgrade2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/upgrade.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/uninstall.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/setup.runscripts.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/setup.pearinstall.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/setup.minimal.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/set.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/runScripts.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/packages/Net_URL-1.0.15.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.registry/xml_util.reg" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.registry/xdebug.reg" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.registry/text_diff.reg" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.registry/structures_graph.reg" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.registry/php_archive.reg" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.registry/pear.reg" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.registry/console_getopt.reg" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.registry/archive_tar.reg" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.lock" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.filemap" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.depdblock" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.depdb" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.channels/__uri.reg" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.channels/pecl.php.net.reg" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.channels/pear.php.net.reg" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.channels/pear.foo.com.reg" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.channels/.alias/pecl.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.channels/.alias/pear.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1/php/.channels/.alias/foo.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.pear1.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.full.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.empty.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listPackages.cascade.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/listChannels.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/install_pear1package.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/install.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/help.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/help.command.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/findpear3.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/findpear2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/findpear1.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/download.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/configShow.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/channelDiscover2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/channelDiscover.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/channelDiscover.fail2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/channelDiscover.fail.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/channelDel.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/channelAdd.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/build/docblock-0.2.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFrontend/Commands/build.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFileFilterIterator/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ScriptFileFilterIterator/basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/RemotePackage/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/RemotePackage/remotepackage.getmaintainers.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/uninstall/test.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/uninstall/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/release3.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/release2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/release.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/packagingcontents.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/maintainer2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/maintainer.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/license.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/file2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/file.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/package/basic/allmaintainers.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/listpackages/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/listpackages/listpackages.simple.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/listpackages/listpackages.multiple.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/listpackages/listpackages.multiple.channels.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/install/test.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/install/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/info/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/info/info.simple.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/info/info.installedfiles.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/info/info.dirtree.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/getdependentpackages/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/getdependentpackages/getdependentpackages.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/detectfileconflicts/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Xml/detectfileconflicts/detectfileconflicts.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/uninstall/test.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/uninstall/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/release3.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/release2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/release.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/packagingcontents.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/maintainer2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/maintainer.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/license.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/file2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/file.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/package/basic/allmaintainers.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/listpackages/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/listpackages/listpackages.simple.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/listpackages/listpackages.multiple.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/listpackages/listpackages.multiple.channels.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/install/test.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/install/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/init/test.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/init/construct.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/info/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/info/info.simple.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/info/info.installedfiles.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/info/info.dirtree.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/getdependentpackages/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/getdependentpackages/getdependentpackages.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/detectfileconflicts/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Sqlite3/detectfileconflicts/detectfileconflicts.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/uninstall/test.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/uninstall/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/release3.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/release2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/release.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/packagingcontents.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/maintainer2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/maintainer.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/license.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/file2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/file.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/package/basic/allmaintainers.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/listpackages/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/listpackages/listpackages.simple.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/listpackages/listpackages.multiple.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/listpackages/listpackages.multiple.channels.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/install/test.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/install/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/info/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/info/info.simple.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/info/info.installedfiles.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/info/info.dirtree.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/getdependentpackages/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/getdependentpackages/getdependentpackages.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/detectfileconflicts/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Pear1/detectfileconflicts/detectfileconflicts.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Base/validateUninstallDependencies/validateuninstalldependencies.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Base/validateUninstallDependencies/validateuninstalldependencies.parent.uninstall.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Base/validateUninstallDependencies/validateuninstalldependencies.fail.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Base/validateUninstallDependencies/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Base/makeUninstallConnections/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Base/makeUninstallConnections/makeuninstallconnections.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Base/cloneRegistry/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Base/cloneRegistry/cloneregistry.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Base/arrayaccess/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/Base/arrayaccess/arrayaccess.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/uninstall/test.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/setupPackageFile.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/Registry/toPackageFile/cascade.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/Registry/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/Registry/setup.cascade.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/Registry/listPackages/listpackages.multiple.channels.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/Registry/listPackages/cascade.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/Registry/getDependentPackages/getdependentpackages.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/Registry/detectFileConflicts/detectfileconflicts.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/README" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/usestask2.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/usestask.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/usesrole2.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/usesrole.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/toarray.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/toarray.packaging.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/toarray.packaging.filelist3.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/toarray.packaging.filelist2.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/toarray.packaging.filelist.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/toarray.onefile.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/toarray.multiplegroupdep.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/setlicense.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/release.configureoption.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/release.configureoption.setting.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/release.configureoption.errors.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/release.binarypackage.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.subpackage.setting2.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.subpackage.setting.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.subpackage.optional.complex.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.subpackage.complex.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.required.setting.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.php.reset.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.php.exclude.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.php.complex.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.php.basic.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.pearinstaller.complex.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.pearinstaller.basic.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.package.uri.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.package.setting2.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.package.setting.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.package.pecl.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.package.optional.complex.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.package.conflicting.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.package.complex.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.os.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.os.setting.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.os.conflicting.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.optional.setting.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.group.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.group.subpackage.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.group.setting.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.group.package.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.group.package.complex.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.group.extension.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.extension.setting2.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.extension.setting.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.extension.basic.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.arch.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.arch.setting.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/dependencies.arch.conflicting.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/compatible.set.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/compatible.errors.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/extended/compatible.basic.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/release3.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/release2.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/release.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/packagingcontents.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/maintainer2.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/maintainer.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/license.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/file2.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/file.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/basic.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package/basic/allmaintainers.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/package.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/listpackages/simple.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/listpackages/multiple.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/listpackages/multiple.channels.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/install/test.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/info/simple.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/info/installedfiles.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/info/dirtree.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/getdependentpackages/basic.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Registry/AllRegistries/detectfileconflicts/basic.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2_Validator/validate.newobject.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2_Validator/validate.newobject.packaging.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2_Validator/validate.fail.task.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2_Validator/validate.fail.role.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2_Validator/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/toarray/packaging.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/toarray/packaging.filelist3.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/toarray/packaging.filelist2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/toarray/packaging.filelist.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/toarray/onefile.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/toarray/multiplegroupdep.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/toarray/basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/setupFiles/setupPackageFile.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/README" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/packages/Config/package.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/packages/bloomy/package.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/packages/Auth_PrefManager/package.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/packages/Auth/package.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/packages/APC/package.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/Config.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/bloomy.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/Auth_PrefManager.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/Auth.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/oddorderings/APC.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/package.coverage.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/os.iterator.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/issubpackageof.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/issubpackage.uri.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/issubpackage.mixed3.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/issubpackage.mixed2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/issubpackage.mixed.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/issubpackage.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependson.uri.subpackage.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependson.uri.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependson.channel.subpackage.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependson.channel.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.subpackage.setting2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.subpackage.setting.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.subpackage.optional.complex.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.subpackage.complex.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.required.setting.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.php.reset.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.php.exclude.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.php.complex.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.php.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.pearinstaller.complex.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.pearinstaller.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.package.uri.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.package.setting2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.package.setting.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.package.pecl.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.package.optional.complex.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.package.conflicting.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.package.complex.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.os.setting.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.os.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.os.conflicting.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.optional.setting.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.group.subpackage.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.group.setting.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.group.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.group.package.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.group.package.complex.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.group.extension.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.extension.setting2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.extension.setting.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.extension.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.errors.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.arch.setting.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.arch.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/dependencies.arch.conflicting.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/dependencies/arch.iterator.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/compatible/iscompatible.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/compatible/compatible.set.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/compatible/compatible.errors.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/compatible/compatible.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/usestask2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/usestask.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/usestask.errors.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/usesrole2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/usesrole.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/usesrole.errors.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/test.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/simpleproperties2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/simpleproperties.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/simpleproperties.errors.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/setlicense.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/release3.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/release2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/release.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/release.configureoption.setting.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/release.configureoption.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/release.configureoption.errors.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/release.binarypackage.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/packagingcontents.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/maintainer2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/maintainer.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/license.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/file2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/file.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/extra.coverage.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/bundledpackage.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_v2/basic/allmaintainers.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_Parser_v2/test_2.1.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_Parser_v2/test_2.0.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_Parser_v2/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_Parser_v2/packages/package2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/PackageFile_Parser_v2/packages/package.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Package/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Package/setup.minimal.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Package/parsePackageDescription.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Package/arrayaccess.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/src/PEAR2/MultiErrors/Exception.php" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/src/PEAR2/MultiErrors.php" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/src/PEAR2/Exception.php" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/src/PEAR2/Autoload.php" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/r/getmaintainers_test/v2.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/r/getmaintainers_test/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/r/getmaintainers_test/package.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/r/getmaintainers_test/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/r/getmaintainers_test/deps.1.0.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/r/getmaintainers_test/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/r/getmaintainers_test/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/r/getmaintainers_test/1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/p/packages.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/p/getmaintainers_test/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/p/getmaintainers_test/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/p/getmaintainers_test/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/m/foo4/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/m/foo3/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/m/foo2/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/m/foo1/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/m/cellog/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/m/allmaintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/c/Default/packagesinfo.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/c/Default/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/rest/c/categories.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/make.php" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/get/GetMaintainers_Test-1.0.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/get/GetMaintainers_Test-1.0.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/remotepackage/channel.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/README" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/v2.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/package.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/deps.1.0.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p3/1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/v2.1.3.1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/v2.1.2.3.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/v2.1.2.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/v2.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/package.1.3.1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/package.1.2.3.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/package.1.2.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/package.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/deps.1.3.1.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/deps.1.2.3.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/deps.1.2.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/deps.1.0.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/1.3.1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/1.2.3.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/1.2.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p2/1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/v2.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/package.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/deps.1.0.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/r/p1/1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/p/packages.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/p/p3/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/p/p2/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/p/p1/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/m/cellog/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/m/allmaintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/c/Default/packagesinfo.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/c/Default/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/rest/c/categories.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/make.php" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P3-1.0.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P3-1.0.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P2-1.3.1.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P2-1.3.1.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P2-1.2.3.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P2-1.2.3.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P2-1.2.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P2-1.2.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P2-1.0.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P2-1.0.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P1-1.0.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/get/P1-1.0.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict4/channel.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/v2.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/package.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/deps.1.0.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p3/1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/v2.1.2.1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/package.1.2.1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/deps.1.2.1.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p2/1.2.1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/v2.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/package.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/deps.1.0.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/r/p1/1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/p/packages.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/p/p3/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/p/p2/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/p/p1/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/m/cellog/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/m/allmaintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/c/Default/packagesinfo.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/c/Default/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/rest/c/categories.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/make.php" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/get/P3-1.0.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/get/P3-1.0.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/get/P2-1.2.1.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/get/P2-1.2.1.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/get/P1-1.0.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/get/P1-1.0.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict2/channel.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/v2.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/package.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/deps.1.0.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p3/1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/v2.1.2.1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/package.1.2.1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/deps.1.2.1.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p2/1.2.1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/v2.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/package.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/deps.1.0.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/r/p1/1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/p/packages.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/p/p3/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/p/p2/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/p/p1/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/m/cellog/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/m/allmaintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/c/Default/packagesinfo.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/c/Default/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/rest/c/categories.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/make.php" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/get/P3-1.0.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/get/P3-1.0.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/get/P2-1.2.1.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/get/P2-1.2.1.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/get/P1-1.0.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/get/P1-1.0.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.depconflict1/channel.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/v2.0.9.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/package.0.9.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/deps.0.9.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/beta.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p5/0.9.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/v2.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/package.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/devel.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/deps.1.0.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p4/1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/v2.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/package.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/deps.1.0.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p3/1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/v2.1.2.3.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/v2.1.2.2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/v2.0.9.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/package.1.2.3.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/package.1.2.2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/package.0.9.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/devel.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/deps.1.2.3.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/deps.1.2.2.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/deps.0.9.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/beta.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/1.2.3.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/1.2.2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p2/0.9.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/v2.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/package.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/deps.1.0.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/r/p1/1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/p/packages.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/p/p5/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/p/p4/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/p/p3/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/p/p2/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/p/p1/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/m/cellog/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/m/allmaintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/c/Default/packagesinfo.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/c/Default/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/rest/c/categories.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/make.php" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P5-1.0.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P5-0.9.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P5-0.9.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P4-1.0.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P4-1.0.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P3-1.0.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P3-1.0.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P2-1.2.3.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P2-1.2.3.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P2-1.2.2.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P2-1.2.2.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P2-0.9.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P2-0.9.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P1-1.0.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/get/P1-1.0.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/installer.prepare.dep.versionconflict/channel.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/v2.1.1.0RC2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/v2.1.1.0RC1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/v2.1.1.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/v2.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/package.1.1.0RC2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/package.1.1.0RC1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/package.1.1.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/package.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/deps.1.1.0RC2.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/deps.1.1.0RC1.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/deps.1.1.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/deps.1.0.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/beta.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/1.1.0RC2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/1.1.0RC1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/1.1.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p3/1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/v2.1.2.0a1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/v2.1.1.0RC3.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/v2.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/package.1.2.0a1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/package.1.1.0RC3.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/package.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/deps.1.2.0a1.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/deps.1.1.0RC3.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/deps.1.0.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/beta.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/alpha.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/1.2.0a1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/1.1.0RC3.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p2/1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/v2.1.1.0RC1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/v2.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/stable.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/package.1.1.0RC1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/package.1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/latest.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/deps.1.1.0RC1.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/deps.1.0.0.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/beta.txt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/allreleases2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/allreleases.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/1.1.0RC1.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/r/p1/1.0.0.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/packages.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p3/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p3/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p3/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p2/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p2/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p2/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p1/maintainers2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p1/maintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/p/p1/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/m/cellog/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/m/allmaintainers.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/c/Default/packagesinfo.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/c/Default/info.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/rest/c/categories.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/make.php" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.1.0RC1.zip" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.1.0RC1.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.1.0RC1.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.1.0.zip" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.1.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.1.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.0.0.zip" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.0.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P3-1.0.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.2.0a1.zip" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.2.0a1.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.2.0a1.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.1.0RC3.zip" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.1.0RC3.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.1.0RC3.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.0.0.zip" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.0.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P2-1.0.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P1-1.1.0RC1.zip" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P1-1.1.0RC1.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P1-1.1.0RC1.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P1-1.0.0.zip" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P1-1.0.0.tgz" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/get/P1-1.0.0.tar" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet/install.prepare.explicitstate/channel.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Mocks/Internet.php" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/pearconfig.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.fail.depconflict4.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.fail.depconflict3.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.fail.depconflict2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.fail.depconflict1.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.explicitstate.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.duplicate.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.depinstalled.upgradeconflict.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.depinstalled.upgrade.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.depinstalled.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.depinstalled.noupgrade.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.depinstalled.notupgrading.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/prepare/install.prepare.dep.versionconflict.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/install_script.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/install_existing_package.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/install.verifyfiles.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Installer/install.remote.packages.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ignorexdebug.php" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/DirectedGraph/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/DirectedGraph/cycles.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/DirectedGraph/basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validator.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.providesextension.notinstalled.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.providesextension.loaded.extversionless.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.providesextension.installed.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.notinstalled.version.conflicts.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.installed.version.recommended.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.installed.version.conflicts.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.installed.version.conflicts.max.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.installed.version.conflicts.exclude.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.installed.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.installed.noversion.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.recommended.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.recommended.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.recommended.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.min.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.min.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.min.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.max.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.max.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.max.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.exclude.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.exclude.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.exclude.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.min.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.min.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.min.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.max.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.max.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.max.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.exclude.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.exclude.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.version.conflicts.exclude.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.noversion.php" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.noversion.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.noversion.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.noversion.conflicts.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.noversion.conflicts.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.fail.installed.noversion.conflicts.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.downloading.valid.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateSubpackageDependency/subpackagedep.downloading.noversion.valid.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePhpDependency/phpdep.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePearinstallerDependency/pearinstallerdep.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.optional2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.optional.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.noconflict.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.noconflict.exclude2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.noconflict.exclude.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.noconflict.conflicts.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.required.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.required.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.required.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.min.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.min.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.min.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.max.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.max.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.max.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.exclude.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.exclude.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageUninstall/uninstalldep.fail.exclude.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.providesextension.notinstalled.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.providesextension.loaded.extversionless.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.providesextension.installed.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.installed.version.recommended.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.installed.version.notinstalled.conflicts.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.installed.version.installed.conflicts.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.installed.version.installed.conflicts.max.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.installed.version.installed.conflicts.exclude.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.installed.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.installed.noversion.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.recommended.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.recommended.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.recommended.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.min.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.min.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.min.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.max.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.max.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.max.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.exclude.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.exclude.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.exclude.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.min.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.min.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.min.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.max.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.max.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.max.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.exclude.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.exclude.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.version.conflicts.exclude.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.noversion.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.noversion.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.noversion.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.noversion.conflicts.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.noversion.conflicts.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.fail.installed.noversion.conflicts.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.downloading.valid.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validatePackageDependency/packagedep.downloading.noversion.valid.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateOsDependency/osdep.windows.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateOsDependency/osdep.windows.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateOsDependency/osdep.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateOsDependency/osdep.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateOsDependency/osdep.extra.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.recommended.fail.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.recommended.fail.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.recommended.fail.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.noversion.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.noversion.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.noversion.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.notloaded.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.notloaded.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.notloaded.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.notdownload.or.install.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.min.fail.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.min.fail.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.min.fail.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.max.fail.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.max.fail.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.max.fail.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.loaded.valid.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.loaded.extversionless.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.exclude.fail.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.exclude.fail.nodeps.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateExtensionDependency/extensiondep.exclude.fail.force.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateDownloadedPackage/downloadedpackage.simple.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateDownloadedPackage/downloadedpackage.required.subpackage.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateDownloadedPackage/downloadedpackage.required.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateDownloadedPackage/downloadedpackage.optional.subpackage.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateDownloadedPackage/downloadedpackage.optional.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateDownloadedPackage/downloadedpackage.fail.optional.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateDownloadedPackage/downloadedpackage.downloaded.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateArchDependency/archdep.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/validateArchDependency/archdep.extra.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/setup.uninstall.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/setup.registry.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Dependency_Validator/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Custom/Task/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Custom/Task/basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Custom/Role/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Custom/Role/basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Custom/Command/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Custom/Command/basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Custom/Command/basic.php" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/__get__set__unset__isset/test3.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/__get__set__unset__isset/test2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/__get__set__unset__isset/test.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/__get__set__unset__isset/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/userInitialized/test.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/userInitialized/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/setCascadingRegistries/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/setCascadingRegistries/basic2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/setCascadingRegistries/basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/gooduserfile.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/gooduser.mypath.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/goodsystemfile4.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/goodsystemfile3.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/goodsystemfile2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/goodsystemfile.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/defaults.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/baduserfile.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/loadConfigFile/badsystemfile.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/current/singleton.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/constructDefaults/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/constructDefaults/extension_dir.ini.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/constructDefaults/extension_dir.env2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/constructDefaults/extension_dir.env.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/constructDefaults/bin_dir.win.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/constructDefaults/bin_dir.env2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/constructDefaults/bin_dir.env.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/constructDefaults/basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/configSnapshot/test.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/configSnapshot/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/addConfigValue/test.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/addConfigValue/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Config/addConfigValue/fail.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/clean.xdebug.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/clean.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/update/update.readonly.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/update/update.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/listChannels/default.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/delete/internal.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/delete/external.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/delete/delete.readonly.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/delete/delete.installed.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/add/add.readonly.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Xml/add/add.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/update/update.readonly.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/update/update.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/listChannels/default.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/delete/internal.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/delete/external.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/delete/delete.readonly.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/delete/delete.installed.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/add/add.readonly.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Sqlite3/add/add.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/sample_ssl_channel.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/sample_channel_complex2.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/sample_channel_complex.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/sample_channel.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/update/update.readonly.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/update/update.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/listChannels/default.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/delete/internal.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/delete/external.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/delete/delete.readonly.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/delete/delete.installed.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/add/add.readonly.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/Pear1/add/add.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/update/update.readonly.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/update/update.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/parseName/parsename.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/listChannels/default.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/info/rest.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/info/mirrors.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/info/basic.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/exists/strict_internal.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/exists/strict_external.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/exists/internal.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/exists/external.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/delete/internal.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/delete/external.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/delete/delete.readonly.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/delete/delete.installed.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/add/add.readonly.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelRegistry/AllRegistries/add/add.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelFile_Parser_v1/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelFile_Parser_v1/error.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelFile/setupFiles/setupChannelFile.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelFile/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelFile/basic/simpleproperties.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/ChannelFile/basic/random.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Channel/validation.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Channel/uri.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Channel/ssl_channel.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Channel/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Channel/rest_creation.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Channel/rest.template" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Channel/rest.errors.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Channel/remoteiteration/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Channel/remoteiteration/pearconfig.xml" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Channel/remoteiteration/channel.packages.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Channel/remote.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Channel/mirrors.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Channel/mirrors-unset.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Channel/mirrors-set.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Channel/creation.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/Channel/basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/setup.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/setup.empty.php.inc" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/rollback/rollback2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/rollback/rollback.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/rollback/rollback.fail.notintransaction.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/rmrf/rmrf.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/repair/repair.fail.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/repair/repair.basic.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/removePath/removepath.notstrict.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/removePath/removepath.nonexisting.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/removePath/removepath.fail.strict.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/removePath/removepath.fail.notintransaction.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/removeBackups/removebackups.fail.notintransaction.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/mkdir/removejournalpath.fail.notintransaction.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/mkdir/mkdir.nomode.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/mkdir/mkdir.fail.notintransaction.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/mkdir/mkdir.fail.isfile.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/createOrOpenPath/createoropenpath.fp.stream.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/createOrOpenPath/createoropenpath.fp.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/createOrOpenPath/createoropenpath.failure.fp.stream.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/createOrOpenPath/createoropenpath.failure.fp.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/createOrOpenPath/createoropenpath.failure.contents.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/createOrOpenPath/createoropenpath.fail.notintransaction.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/createOrOpenPath/createoropenpath.fail.fp.stream.empty.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/commit/commit.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/commit/commit.failbackup.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/commit/commit.fail.notintransaction.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/begin/begin.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/begin/begin.journal-exists.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/begin/begin.fail2.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/begin/begin.fail.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/begin/begin.fail.intransaction.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/AtomicFileTransaction/begin/begin.copy.phpt" baseinstalldir="/"/>
   <file role="test" name="test/pear2.php.net/PEAR2_Pyrus/.cvsignore" baseinstalldir="/"/>
   <file role="php" name="php/PEAR2/Pyrus/XMLWriter/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/XMLWriter.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/XMLParser/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/XMLParser.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Validator/PECL.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Validate/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Validate.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Uninstaller.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/test2.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/test1.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/test.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Task/Windowseol/rw.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Task/Windowseol.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Task/Unixeol/rw.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Task/Unixeol.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Task/Replace/rw.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Task/Replace.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Task/Postinstallscript/Paramgroup/Param.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Task/Postinstallscript/Paramgroup.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Task/Postinstallscript.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Task/MultipleProxy.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Task/Exception/WrongAttributeValue.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Task/Exception/NoAttributes.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Task/Exception/MissingAttribute.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Task/Exception/InvalidTask.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Task/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Task/Common.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ScriptRunner.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ScriptFrontend/Renderer.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ScriptFrontend/Commands.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ScriptFrontend/Command.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ScriptFrontend.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/REST/HTTPException.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/REST/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/REST/13.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/REST/11.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/REST/10.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/REST.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Registry/Xml/Package.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Registry/Xml.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Registry/Sqlite3/Package.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Registry/Sqlite3/Creator.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Registry/Sqlite3.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Registry/Pear1/Package.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Registry/Pear1/DependencyDB.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Registry/Pear1.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Registry/Package/Base.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Registry/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Registry/Base.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Registry.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PluginRegistry/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PluginRegistry.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PECLBuild/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PECLBuild.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2Iterator/ScriptFileFilterIterator.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2Iterator/PackagingIterator.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2Iterator/FileTag.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2Iterator/FileInstallationFilter.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2Iterator/FileContentsMulti.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2Iterator/FileContents.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2Iterator/FileAttribsFilter.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2Iterator/File.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Validator.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/UsesRoleTask/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/UsesRoleTask.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/SimpleProperty.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Release/InstallCondition.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Release/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Release/ConfigureOption.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Release/BinaryPackage.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Release.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/License/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/License.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Files/File.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Files/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Files.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Developer/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Developer.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Dependencies/Package.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Dependencies/Group.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Dependencies/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Dependencies/Dep.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Dependencies.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Configureoption/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Configureoption.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Compatible/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/Compatible.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2/BundledPackage.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/v2.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/Parser/v2.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/IValidator.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/PackageFile.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package/Zip/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package/Zip.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package/Xml.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package/Tar/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package/Tar.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package/Remote.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package/Phar/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package/Phar.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package/InstalledException.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package/ICreator.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package/Dependency.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package/Creator/TaskIterator.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package/Creator/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package/Creator.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package/Base.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Package.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/OSGuess.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Log.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/IRegistry.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/IPackageFile.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/IPackage.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Www.xml" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Www.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Test.xml" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Test.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Src.xml" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Src.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Script.xml" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Script.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Php.xml" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Php.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Ext.xml" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Ext.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Doc.xml" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Doc.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Data.xml" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Data.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Customtask.xml" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Customtask.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Customrole.xml" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Customrole.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Customcommand.xml" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Customcommand.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role/Common.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Role.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Installer.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ILog.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/IFileTransaction.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/IChannelRegistry.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/IChannelFile.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/IChannel.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/FileTransactions.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/DirectedGraph/Vertex.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/DirectedGraph/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/DirectedGraph.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Dependency/Validator.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Dependency/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Config/Snapshot.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Config/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Config.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelRegistry/Xml.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelRegistry/Sqlite3.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelRegistry/Pear1.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelRegistry/ParseException.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelRegistry/Mirror/Xml.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelRegistry/Mirror/Sqlite3.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelRegistry/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelRegistry/Channel.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelRegistry/Base.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelRegistry.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelFile/v1/Servers/Protocols/REST.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelFile/v1/Servers/Protocols.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelFile/v1/Servers.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelFile/v1/Mirror.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelFile/v1.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelFile/Parser/v1.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelFile/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/ChannelFile.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Channel/Remotepackages.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Channel/Remotepackage.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Channel/IMirror.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Channel/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/Channel.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/AtomicFileTransaction/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus/AtomicFileTransaction.php" baseinstalldir="PEAR2"/>
   <file role="php" name="php/PEAR2/Pyrus.php" baseinstalldir="PEAR2"/>
   <file role="data" name="data/pear2.php.net/PEAR2_Pyrus/package-2.1.xsd" baseinstalldir="/"/>
   <file role="data" name="data/pear2.php.net/PEAR2_Pyrus/package-2.0.xsd" baseinstalldir="/"/>
   <file role="data" name="data/pear2.php.net/PEAR2_Pyrus/default_channels/__uri.xml" baseinstalldir="/"/>
   <file role="data" name="data/pear2.php.net/PEAR2_Pyrus/default_channels/pecl.php.net.xml" baseinstalldir="/"/>
   <file role="data" name="data/pear2.php.net/PEAR2_Pyrus/default_channels/pear2.php.net.xml" baseinstalldir="/"/>
   <file role="data" name="data/pear2.php.net/PEAR2_Pyrus/default_channels/pear.php.net.xml" baseinstalldir="/"/>
   <file role="data" name="data/pear2.php.net/PEAR2_Pyrus/customtask-2.0.xsd" baseinstalldir="/"/>
   <file role="data" name="data/pear2.php.net/PEAR2_Pyrus/customrole-2.0.xsd" baseinstalldir="/"/>
   <file role="data" name="data/pear2.php.net/PEAR2_Pyrus/customcommand-2.0.xsd" baseinstalldir="/"/>
   <file role="data" name="data/pear2.php.net/PEAR2_Pyrus/channel-1.0.xsd" baseinstalldir="/"/>
   <file role="data" name="data/pear2.php.net/PEAR2_Pyrus/built-in-commands.xml" baseinstalldir="/"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
<?php
// set $dir and include
if (!($dir = realpath($dir))) return;
foreach (new RecursiveIteratorIterator(new RecursiveDirectoryIterator($dir),
                                       RecursiveIteratorIterator::CHILD_FIRST)
         as $file) {
    if (isset($exceptions) && in_array($file->getPathName(), $exceptions, 1)) {
        continue;
    }
    if ($file->getFilename() == '.' || $file->getFilename() == '..') {
        continue;
    }
    if (is_dir($file->getPathname())) {
        rmdir($file->getPathname());
    } else {
        unlink($file->getPathname());
    }
}
if (!isset($preservedir)) {
    rmdir($dir);
}
?>
<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
@mkdir(MYDIR . DIRECTORY_SEPARATOR . 'testit');
set_include_path(MYDIR . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(MYDIR.'/testit', MYDIR . '/pearconfig.xml');
$c->bin_dir = MYDIR . '/testit/bin';
restore_include_path();
$c->saveConfig();--TEST--
PEAR2_Pyrus_Channel_RemotePackage::getMaintainers()
--FILE--
<?php

define('MYDIR', __DIR__);
include __DIR__ . '/setup.php.inc';
require __DIR__ . '/../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../Mocks/Internet/remotepackage',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
PEAR2_Pyrus_Package_Remote::$downloadClass = 'Internet';
$remote = new PEAR2_Pyrus_Channel_Remotepackage(PEAR2_Pyrus_Config::current()->channelregistry['pear2.php.net'],
                                                'stable');
$remote = $remote['GetMaintainers_Test'];
$remote->version['release'] = '1.0.0'; // choose the version we are accessing
// first, test with REST1.2
$res = array();
foreach ($remote->maintainer as $maintainer) {
    $res[$maintainer->user] = array($maintainer->email, $maintainer->name, $maintainer->role);
}
asort($res);
$test->assertEquals(array (
  'cellog' => 
  array (
    0 => '*hidden*',
    1 => 'cellog',
    2 => 'lead',
  ),
  'foo1' => 
  array (
    0 => '*hidden*',
    1 => 'foo1',
    2 => 'developer',
  ),
  'foo2' => 
  array (
    0 => '*hidden*',
    1 => 'foo2',
    2 => 'developer',
  ),
  'foo3' => 
  array (
    0 => '*hidden*',
    1 => 'foo3',
    2 => 'contributor',
  ),
  'foo4' => 
  array (
    0 => '*hidden*',
    1 => 'foo4',
    2 => 'helper',
  ),
), $res, 'maintainers REST1.2');

// next, test with REST1.0
unset(PEAR2_Pyrus_Config::current()->channelregistry['pear2.php.net']->protocols->rest['REST1.2']);
$remote = new PEAR2_Pyrus_Channel_Remotepackage(PEAR2_Pyrus_Config::current()->channelregistry['pear2.php.net'],
                                                'stable');
$remote = $remote['GetMaintainers_Test'];
$remote->version['release'] = '1.0.0'; // choose the version we are accessing
$res = array();
foreach ($remote->maintainer as $maintainer) {
    $res[$maintainer->user] = array($maintainer->email, $maintainer->name, $maintainer->role);
}
asort($res);
$test->assertEquals(array (
  'cellog' => 
  array (
    0 => '*hidden*',
    1 => 'cellog',
    2 => 'lead',
  ),
  'foo1' => 
  array (
    0 => '*hidden*',
    1 => 'foo1',
    2 => 'lead',
  ),
  'foo2' => 
  array (
    0 => '*hidden*',
    1 => 'foo2',
    2 => 'lead',
  ),
  'foo3' => 
  array (
    0 => '*hidden*',
    1 => 'foo3',
    2 => 'lead',
  ),
  'foo4' => 
  array (
    0 => '*hidden*',
    1 => 'foo4',
    2 => 'lead',
  ),
), $res, 'maintainers REST1.0');
?>
===DONE===
--CLEAN--
<?php
unlink(__DIR__ . '/pearconfig.xml');
$dir = __DIR__ . '/testit';
include __DIR__ . '/../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Config::loadConfigFile() good userfile
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
set_include_path(''); // disable include_path cascading for simplicity
file_put_contents($testpath . '/.config', '<?xml version="1.0" ?>
<c>
 <!-- make sure php_dir and data_dir are not processed -->
 <php_dir>oops</php_dir>
 <data_dir>I did it again</data_dir>
 <ext_dir>@php_dir@/foo</ext_dir>
 <doc_dir>@php_dir@/bah</doc_dir>
 <bin_dir>@php_dir@/bar</bin_dir>
 <www_dir>@php_dir@/boo</www_dir>
 <test_dir>@php_dir@/blah</test_dir>
 <php_bin>/path/to/php</php_bin>
 <php_ini>/path/to/php.ini</php_ini>
 <unknown>ha!</unknown>
</c>');
file_put_contents($testpath . '/blah', '<?xml version="1.0" ?>
<c>
 <default_channel>pear.poo.net</default_channel>
 <preferred_mirror>pear.poo.de</preferred_mirror>
 <auto_discover>2</auto_discover>
 <http_proxy>hi</http_proxy>
 <cache_dir>/path/tomy/dir</cache_dir>
 <temp_dir>/path/to/temp</temp_dir>
 <download_dir>/download</download_dir>
 <username>boo</username>
 <password>ya</password>
 <verbose>5</verbose>
 <preferred_state>beta</preferred_state>
 <umask>' . 0642 . '</umask>
 <cache_ttl>1</cache_ttl>
 <sig_type>buh</sig_type>
 <sig_bin>/path/to/buh</sig_bin>
 <sig_keyid>999999random</sig_keyid>
 <sig_keydir>/path/to/buh/dir</sig_keydir>
 <my_pear_path>' . $testpath . '</my_pear_path>
 <unknown>ha!</unknown>
</c>');
$a = $configclass::singleton($testpath, $testpath . '/blah');
$test->assertEquals($testpath, $a->path, 'peardir');
$test->assertEquals('pear.poo.net', $a->default_channel, 'default_channel');
$test->assertEquals('pear.poo.de', $a->preferred_mirror, 'preferred_mirror');
$test->assertEquals('2', $a->auto_discover, 'auto_discover');
$test->assertEquals('hi', $a->http_proxy, 'http_proxy');
$test->assertEquals('/path/tomy/dir', $a->cache_dir, 'cache_dir');
$test->assertEquals('/path/to/temp', $a->temp_dir, 'temp_dir');
$test->assertEquals('/download', $a->download_dir, 'download_dir');
$test->assertEquals('boo', $a->username, 'username');
$test->assertEquals('ya', $a->password, 'password');
$test->assertEquals('5', $a->verbose, 'verbose');
$test->assertEquals('beta', $a->preferred_state, 'preferred_state');
$test->assertEquals((string) 0642, $a->umask, 'umask');
$test->assertEquals('1', $a->cache_ttl, 'cache_ttl');
$test->assertEquals('buh', $a->sig_type, 'sig_type');
$test->assertEquals('/path/to/buh', $a->sig_bin, 'sig_bin');
$test->assertEquals('999999random', $a->sig_keyid, 'sig_keyid');
$test->assertEquals('/path/to/buh/dir', $a->sig_keydir, 'sig_keydir');
$test->assertEquals($testpath, $a->my_pear_path, 'my_pear_path');
try {
    $test->assertEquals('this should NOT execute, should go to exception', $a->unknown, 'unknown');
} catch (PEAR2_Pyrus_Config_Exception $e) {
    echo "here\n";
    $test->assertEquals('Unknown configuration variable "unknown" in location ' .
            $a->path, $e->getMessage(), 'exception message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
here
===DONE===
--TEST--
PEAR2_Pyrus_Config::loadConfigFile() good systemfile 2
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
set_include_path($testpath); // disable include_path cascading for simplicity
file_put_contents($testpath . '/.config', '<?xml version="1.0" ?>
<c>
 <!-- make sure php_dir and data_dir are not processed -->
 <php_dir>oops</php_dir>
 <ext_dir>@php_dir@/foo</ext_dir>
 <doc_dir>@php_dir@/bah</doc_dir>
 <bin_dir>@php_dir@/bar</bin_dir>
 <www_dir>@php_dir@/boo</www_dir>
 <test_dir>@php_dir@/blah</test_dir>
 <php_bin>/path/to/php</php_bin>
 <php_ini>/path/to/php.ini</php_ini>
 <unknown>ha!</unknown>
</c>');
$a = $configclass::singleton($testpath, $testpath . '/blah');
restore_include_path();
$test->assertEquals($testpath, $a->path, 'peardir');
$test->assertEquals($testpath . '/blah', $a->userfile, 'userfile');
$test->assertEquals($testpath . '/php', $a->php_dir, 'php_dir');
$test->assertEquals($testpath . '/data', $a->data_dir, 'data_dir');
$test->assertEquals($testpath . '/foo', $a->ext_dir, 'ext_dir');
$test->assertEquals($testpath . '/bah', $a->doc_dir, 'doc_dir');
$test->assertEquals($testpath . '/bar', $a->bin_dir, 'bin_dir');
$test->assertEquals($testpath . '/boo', $a->www_dir, 'www_dir');
$test->assertEquals($testpath . '/blah', $a->test_dir, 'test_dir');
$test->assertEquals('/path/to/php', $a->php_bin, 'php_bin');
$test->assertEquals('/path/to/php.ini', $a->php_ini, 'php_ini');
try {
    $test->assertEquals('this should NOT execute, should go to exception', $a->unknown, 'unknown');
} catch (PEAR2_Pyrus_Config_Exception $e) {
    echo "here\n";
    $test->assertEquals('Unknown configuration variable "unknown" in location ' .
            $a->path, $e->getMessage(), 'exception message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
here
===DONE===
--TEST--
PEAR2_Pyrus_Config::loadConfigFile() corrupt userfile
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
set_include_path($testpath); // disable include_path cascading for simplicity
file_put_contents($testpath . '/blah', '<?xml version="1.0" ?>oops> <cra&p>; ?>');
try {
    tc::$test = $test;
    $a = new tc($testpath, $testpath . '/blah');
    //restore_include_path(); done in tc->setCascadingRegistries
    $test->assertEquals($testpath, $a->pearDir, 'peardir');
    $test->assertEquals($testpath . '/blah', $a->userFile, 'userfile');
} catch (Exception $e) {
    $test->assertException($e, 'PEAR2_Pyrus_Config_Exception', 'Unable to parse invalid user PEAR configuration at "' . $testpath . '/blah"', 'exception');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===
--TEST--
PEAR2_Pyrus_Config::loadConfigFile() good systemfile 3
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
set_include_path($testpath); // disable include_path cascading for simplicity
file_put_contents($testpath . '/.config', '<?xml version="1.0" ?>
<c>
 <ext_dir>@php_dir@/foo</ext_dir>
 <doc_dir>@php_dir@/bah</doc_dir>
 <bin_dir>@php_dir@/bar</bin_dir>
 <www_dir>@php_dir@/boo</www_dir>
 <test_dir>@php_dir@/blah</test_dir>
 <php_bin>/path/to/php</php_bin>
 <php_ini>/path/to/php.ini</php_ini>
 <unknown>ha!</unknown>
</c>');
$a = $configclass::singleton($testpath, $testpath . '/blah');
restore_include_path();
$test->assertEquals($testpath, $a->path, 'peardir');
$test->assertEquals($testpath . '/blah', $a->userfile, 'userfile');
$test->assertEquals($testpath . '/php', $a->php_dir, 'php_dir');
$test->assertEquals($testpath . '/data', $a->data_dir, 'data_dir');
$test->assertEquals($testpath . '/foo', $a->ext_dir, 'ext_dir');
$test->assertEquals($testpath . '/bah', $a->doc_dir, 'doc_dir');
$test->assertEquals($testpath . '/bar', $a->bin_dir, 'bin_dir');
$test->assertEquals($testpath . '/boo', $a->www_dir, 'www_dir');
$test->assertEquals($testpath . '/blah', $a->test_dir, 'test_dir');
$test->assertEquals('/path/to/php', $a->php_bin, 'php_bin');
$test->assertEquals('/path/to/php.ini', $a->php_ini, 'php_ini');
try {
    $test->assertEquals('this should NOT execute, should go to exception', $a->unknown, 'unknown');
} catch (PEAR2_Pyrus_Config_Exception $e) {
    echo "here\n";
    $test->assertEquals('Unknown configuration variable "unknown" in location ' .
            $a->path, $e->getMessage(), 'exception message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
here
===DONE===
--TEST--
PEAR2_Pyrus_Config::loadConfigFile() good systemfile 4 [verifies correct code branching]
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
set_include_path($testpath); // disable include_path cascading for simplicity
file_put_contents($testpath . '/.config', '<?xml version="1.0" ?>
<c>
 <!-- make sure php_dir and data_dir are not processed -->
 <php_dir>oops</php_dir>
 <data_dir>I did it again</data_dir>
 <ext_dir>@php_dir@/foo</ext_dir>
 <doc_dir>@php_dir@/bah</doc_dir>
 <bin_dir>@php_dir@/bar</bin_dir>
 <www_dir>@php_dir@/boo</www_dir>
 <test_dir>@php_dir@/blah</test_dir>
 <php_bin>/path/to/php</php_bin>
 <php_ini>/path/to/php.ini</php_ini>
 <unknown>ha!</unknown>
</c>');
$a = $configclass::singleton($testpath, $testpath . '/blah');
restore_include_path();
$test->assertEquals($testpath, $a->path, 'peardir');
$test->assertEquals($testpath . '/blah', $a->userfile, 'userfile');
$test->assertEquals($testpath . '/php', $a->php_dir, 'php_dir');
$test->assertEquals($testpath . '/data', $a->data_dir, 'data_dir');
$test->assertEquals($testpath . '/foo', $a->ext_dir, 'ext_dir');
$test->assertEquals($testpath . '/bah', $a->doc_dir, 'doc_dir');
$test->assertEquals($testpath . '/bar', $a->bin_dir, 'bin_dir');
$test->assertEquals($testpath . '/boo', $a->www_dir, 'www_dir');
$test->assertEquals($testpath . '/blah', $a->test_dir, 'test_dir');
$test->assertEquals('/path/to/php', $a->php_bin, 'php_bin');
$test->assertEquals('/path/to/php.ini', $a->php_ini, 'php_ini');
try {
    $test->assertEquals('this should NOT execute, should go to exception', $a->unknown, 'unknown');
} catch (PEAR2_Pyrus_Config_Exception $e) {
    echo "here\n";
    $test->assertEquals('Unknown configuration variable "unknown" in location ' .
            $a->path, $e->getMessage(), 'exception message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
here
===DONE===
--TEST--
PEAR2_Pyrus_Config::loadConfigFile() no configuration found, use defaults
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
set_include_path($testpath); // disable include_path cascading for simplicity
tc::$test = $test;
$a = new tc($testpath, $testpath . '/notfound', 1);
//restore_include_path(); done in tc->setCascadingRegistries
$test->assertEquals($testpath, $a->pearDir, 'peardir');
$test->assertEquals($testpath . '/notfound', $a->userFile, 'userfile');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===
--TEST--
PEAR2_Pyrus_Config::loadConfigFile() good userfile with my_pear_path set
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
set_include_path($testpath); // disable include_path cascading for simplicity
file_put_contents($testpath . '/blah', '<?xml version="1.0" ?>
<c>
 <my_pear_path>' . $testpath . '/hi/there</my_pear_path>
</c>');
try {
    tc::$test = $test;
    $a = new tc($testpath, $testpath . '/blah');
    $test->assertEquals(tc::$called, 1, 'called times');
    $test->assertEquals($testpath, $a->pearDir, 'peardir');
    $test->assertEquals($testpath . '/blah', $a->userFile, 'userfile');
} catch (Exception $e) {
    echo "failed with $e";
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===
<?php
require __DIR__ . '/../setup.php.inc';
$testpath = __DIR__ . '/testit';
mkdir($testpath);
class tc extends PEAR2_Pyrus_Config
{
    /**
     * location of PEAR2 installation
     *
     * @var string
     */
    public $pearDir;
    /**
     * location of user-specific configuration file
     *
     * @var string
     */
    public $userFile;

    public static $test;

    public static $called = 0;

    private static $paths;

    public function __construct($pearDirectory, $userfile = false, $reversed = false)
    {
        if ($reversed) {
            self::$paths = array($GLOBALS['testpath'], $GLOBALS['testpath'] . PATH_SEPARATOR .
                             $GLOBALS['testpath'] . DIRECTORY_SEPARATOR . 'hi/there', );
        } else {
            self::$paths = array($GLOBALS['testpath'] . PATH_SEPARATOR .
                             $GLOBALS['testpath'] . DIRECTORY_SEPARATOR . 'hi/there', $GLOBALS['testpath'], );
        }
        return parent::__construct($pearDirectory, $userfile);
    }

    public function setCascadingRegistries($path)
    {
        restore_include_path();
        self::$test->assertEquals(self::$paths[self::$called++], $path, "called " . (self::$called - 1));
        return parent::setCascadingRegistries($path);
    }
}
--TEST--
PEAR2_Pyrus_Config::loadConfigFile() corrupt systemfile
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
set_include_path($testpath); // disable include_path cascading for simplicity
file_put_contents($testpath . '/.config', '<?xml version="1.0" ?>oops> <cra&p>; ?>');
try {
    $a = PEAR2_Pyrus_Config::singleton($testpath, $testpath . '/blah');
    restore_include_path();
    throw new Exception('bad news - passed and should have failed');
} catch (PEAR2_Pyrus_Config_Exception $e) {
    restore_include_path();
    $test->assertException($e, 'PEAR2_Pyrus_Config_Exception', 'Unable to parse invalid PEAR configuration at "' . $testpath . '"', 'exception');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===
--TEST--
PEAR2_Pyrus_Config::loadConfigFile() good systemfile
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
set_include_path($testpath); // disable include_path cascading for simplicity
file_put_contents($testpath . '/.config', '<?xml version="1.0" ?>
<c>
 <!-- make sure php_dir and data_dir are not processed -->
 <data_dir>I did it again</data_dir>
 <ext_dir>@php_dir@/foo</ext_dir>
 <doc_dir>@php_dir@/bah</doc_dir>
 <bin_dir>@php_dir@/bar</bin_dir>
 <www_dir>@php_dir@/boo</www_dir>
 <test_dir>@php_dir@/blah</test_dir>
 <php_bin>/path/to/php</php_bin>
 <php_ini>/path/to/php.ini</php_ini>
 <unknown>ha!</unknown>
</c>');
$a = $configclass::singleton($testpath, $testpath . '/blah');
restore_include_path();
$test->assertEquals($testpath, $a->path, 'peardir');
$test->assertEquals($testpath . '/blah', $a->userfile, 'userfile');
$test->assertEquals($testpath . '/php', $a->php_dir, 'php_dir');
$test->assertEquals($testpath . '/data', $a->data_dir, 'data_dir');
$test->assertEquals($testpath . '/foo', $a->ext_dir, 'ext_dir');
$test->assertEquals($testpath . '/bah', $a->doc_dir, 'doc_dir');
$test->assertEquals($testpath . '/bar', $a->bin_dir, 'bin_dir');
$test->assertEquals($testpath . '/boo', $a->www_dir, 'www_dir');
$test->assertEquals($testpath . '/blah', $a->test_dir, 'test_dir');
$test->assertEquals('/path/to/php', $a->php_bin, 'php_bin');
$test->assertEquals('/path/to/php.ini', $a->php_ini, 'php_ini');
try {
    $test->assertEquals('this should NOT execute, should go to exception', $a->unknown, 'unknown');
} catch (PEAR2_Pyrus_Config_Exception $e) {
    echo "here\n";
    $test->assertEquals('Unknown configuration variable "unknown" in location ' .
            $a->path, $e->getMessage(), 'exception message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
here
===DONE===
--TEST--
PEAR2_Pyrus_Config::userInitialized() basic test
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$test->assertFalse(r::userInitialized(), 'first, nothing found');
r::$foo = 2;
mkdir(__DIR__ . '/testing');
file_put_contents(__DIR__ . '/testing/myfile.xml', '<hi/>');
$test->assertTrue(r::userInitialized(), 'second, myfile.xml found');
r::$foo = 1;
copy(__DIR__ . '/testing/myfile.xml', __DIR__ . '/testing/pearconfig.xml');
$dir = getcwd();
chdir(__DIR__ . '/testing');
$test->assertFileExists(__DIR__ . '/testing/pearconfig.xml', 'pearconfig.xml should exist');
$test->assertTrue(r::userInitialized(), 'third, pearconfig.xml found');
file_put_contents(__DIR__ . '/testing/pearconfig.xml', '<?xml version="1.0"?>
<pearconfig version="1.0"><default_channel>pear2.php.net</default_channel><preferred_mirror>pear2.php.net</preferred_mirror><auto_discover>0</auto_discover><download_dir>/hoo/boy</download_dir></pearconfig>
');
$t = r::singleton();
$test->assertEquals(__DIR__ . DIRECTORY_SEPARATOR . 'testing' . DIRECTORY_SEPARATOR . 'pearconfig.xml', $t->userfile, 'pearconfig.xml file');
$test->assertEquals('/hoo/boy', $t->download_dir, 'check whether it loaded pearconfig.xml');
chdir($dir);
?>
===DONE===
--CLEAN--
--CLEAN--
<?php
$dir = __DIR__ . '/testing';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===
<?php
require dirname(dirname(__FILE__)) . '/setup.php.inc';
class r extends PEAR2_Pyrus_Config
{
    static $foo = 1;
    static function getDefaultUserConfigFile()
    {
        if (self::$foo == 1) return __DIR__ . '/testing/oops';
        return __DIR__ . '/testing/myfile.xml';
    }
}
--TEST--
PEAR2_Pyrus_Config::setCascading Registries() basic test
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'foo');

set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'foo');

$unused = $configclass::singleton(__DIR__ . '/foo',
                                  __DIR__ . '/something/blah');

$c = $configclass::singleton(dirname(__FILE__) . '/something' . PATH_SEPARATOR . dirname(__FILE__) . '/foo',
                             dirname(__FILE__) . '/something/blah');
restore_include_path();

$test->assertEquals(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'something',
                    $c->registry->path, 'registry path 1');
$test->assertEquals(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'foo',
                    $c->registry->parent->path, 'registry->parent path 1');
$test->assertNull($c->registry->parent->parent, 'registry parent parent 1');
$test->assertEquals(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'something',
                    $c->channelregistry->path, 'channelregistry path 1');
$test->assertEquals(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'foo',
                    $c->channelregistry->parent->path, 'channelregistry->parent path 1');
$test->assertNull($c->channelregistry->parent->parent, 'channelregistry parent parent 1');

unset($c);
// test to see if 2nd call to singleton returns the same object
$c = $configclass::singleton(dirname(__FILE__) . '/something' . PATH_SEPARATOR . dirname(__FILE__) . '/foo',
                             dirname(__FILE__) . '/something/blah');

$test->assertEquals(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'something',
                    $c->registry->path, 'registry path 2');
$test->assertEquals(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'foo',
                    $c->registry->parent->path, 'registry->parent path 2');
$test->assertNull($c->registry->parent->parent, 'registry parent parent 2');
$test->assertEquals(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'something',
                    $c->channelregistry->path, 'channelregistry path 2');
$test->assertEquals(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'foo',
                    $c->channelregistry->parent->path, 'channelregistry->parent path 2');
$test->assertNull($c->channelregistry->parent->parent, 'channelregistry parent parent 2');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/foo';
include __DIR__ . '/../../clean.php.inc';
?>
<?php
$dir = __DIR__ . '/something';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===
<?php
require dirname(dirname(__FILE__)) . '/setup.php.inc';
class r extends PEAR2_Pyrus_Registry
{
    public $parent;
    public $path;
}
class c extends PEAR2_Pyrus_ChannelRegistry
{
    public $parent;
    public $path;
}
PEAR2_Pyrus_Registry::$className = 'r';
PEAR2_Pyrus_ChannelRegistry::$className = 'c';
--TEST--
PEAR2_Pyrus_Config::setCascading Registries() basic test 2
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';

// check descending from php to registry directory
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'something/php');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'something/php');
$unused = $configclass::singleton(dirname(__FILE__) . '/something' . PATH_SEPARATOR . dirname(__FILE__) . '/foo',
                             dirname(__FILE__) . '/something/blah2');
$c = $configclass::singleton(dirname(__FILE__) . '/something2', dirname(__FILE__) . '/something/blah');
restore_include_path();

$test->assertEquals(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'something2',
                    $c->registry->path, 'registry path 3');
$test->assertEquals(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'something',
                    $c->registry->parent->path, 'registry->parent path 3');
$test->assertNull($c->registry->parent->parent, 'registry parent parent 3');
$test->assertEquals(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'something2',
                    $c->channelregistry->path, 'channelregistry path 3');
$test->assertEquals(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'something',
                    $c->channelregistry->parent->path, 'channelregistry->parent path 3');
$test->assertNull($c->channelregistry->parent->parent, 'channelregistry parent parent 3');

// now check starting with unregisterable directory
if (substr(PHP_OS, 0, 3) != 'WIN') {
    // no way to do this on windows that I know of
    try {
        $c = $configclass::singleton('/', __DIR__ . '/something/blah');
        echo "ERROR: no exception thrown\n";
    } catch (Exception $e) {
        $test->assertEquals($configclass . '_Exception', get_class($e), 'exception class');
        $test->assertEquals('Cannot initialize primary registry in path /', $e->getMessage(), 'exception message');
    }
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/something2';
include __DIR__ . '/../../clean.php.inc';
?>
<?php
$dir = __DIR__ . '/something';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===
--TEST--
PEAR2_Pyrus_Config::addConfigValue()
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
set_include_path(''); // disable include_path cascading for simplicity
$a = $configclass::singleton($testpath, $testpath . '/blah');
$a->addConfigValue('foo', 'booya');
$a->addConfigValue('foo2', 'booya2', false);
$test->assertEquals('booya', $a->foo, 'foo');
$test->assertEquals('booya2', $a->foo2, 'foo');
$a->foo = 'hi';
$a->foo2 = 'hi2';
$test->assertEquals('hi', $a->foo, 'foo');
$test->assertEquals('hi2', $a->foo2, 'foo2');

$test->assertEquals('<?xml version="1.0"?>
<pearconfig version="1.0"><php_dir>' .
    $a->php_dir . '</php_dir><ext_dir>' .
    $a->ext_dir . '</ext_dir><cfg_dir>' .
    $a->cfg_dir . '</cfg_dir><doc_dir>' .
    $a->doc_dir . '</doc_dir><bin_dir>' .
    $a->bin_dir . '</bin_dir><data_dir>' .
    $a->data_dir . '</data_dir><www_dir>' .
    $a->www_dir . '</www_dir><test_dir>' .
    $a->test_dir . '</test_dir><src_dir>' .
    $a->src_dir . '</src_dir><php_bin>' .
    $a->php_bin . '</php_bin><php_ini>' .
    $a->php_ini . '</php_ini><php_prefix></php_prefix><php_suffix></php_suffix><foo>' .
    $a->foo . '</foo></pearconfig>
', file_get_contents($cdir . '/' . $a->configSnapshot()), 'contents 1');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===
<?php
require __DIR__ . '/../setup.php.inc';
$testpath = __DIR__ . '/testit';
mkdir($testpath);
$cdir = $testpath . '/.configsnapshots/';
--TEST--
PEAR2_Pyrus_Config::addConfigValue() failure
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
set_include_path(''); // disable include_path cascading for simplicity
$a = $configclass::singleton($testpath, $testpath . '/blah');
foreach (array('registry',
                                        'channelregistry',
                                        'systemvars',
                                        'uservars',
                                        'mainsystemvars',
                                        'mainuservars',
                                        'userfile',
                                        'path') as $var) {
    try {
        $a->addConfigValue($var, 'fail');
        throw new Exception($var . ' should have failed!');
    } catch (PEAR2_Pyrus_Config_Exception $e) {
        $test->assertEquals('Invalid custom configuration variable ' . $var .
                            ', already in use for retrieving configuration information', $e->getMessage(), $var . ' exception message');
    }
}
try {
    $a->addConfigValue("a\n!", 'sneaky');
    throw new Exception('sneaky should have failed!');
} catch (PEAR2_Pyrus_Config_Exception $e) {
    $test->assertEquals('Invalid custom configuration variable name "'.  "a\n!" . '"', $e->getMessage(), 'sneaky message');
}
try {
    $a->addConfigValue("a\n!", 'sneaky', false);
    throw new Exception('sneaky user should have failed!');
} catch (PEAR2_Pyrus_Config_Exception $e) {
    $test->assertEquals('Invalid custom configuration variable name "'.  "a\n!" . '"', $e->getMessage(), 'sneaky user message');
}
foreach ($a->mainsystemvars as $var) {
    try {
        $a->addConfigValue($var, 'fail');
        throw new Exception($var . ' system should have failed!');
    } catch (PEAR2_Pyrus_Config_Exception $e) {
        $test->assertEquals('Cannot override existing configuration value "' . $var . '"', $e->getMessage(),
                            $var . ' system exception message');
    }
}
foreach ($a->mainsystemvars as $var) {
    try {
        $a->addConfigValue($var, 'fail', false);
        throw new Exception($var . ' system user should have failed!');
    } catch (PEAR2_Pyrus_Config_Exception $e) {
        $test->assertEquals('Cannot override existing configuration value "' . $var . '" with user value', $e->getMessage(),
                            $var . ' system user exception message');
    }
}
foreach ($a->mainuservars as $var) {
    try {
        $a->addConfigValue($var, 'fail');
        throw new Exception($var . ' user should have failed!');
    } catch (PEAR2_Pyrus_Config_Exception $e) {
        $test->assertEquals('Cannot override existing user configuration value "' . $var . '" with system value', $e->getMessage(),
                            $var . ' user exception message');
    }
}
foreach ($a->mainuservars as $var) {
    try {
        $a->addConfigValue($var, 'fail', false);
        throw new Exception($var . ' user user should have failed!');
    } catch (PEAR2_Pyrus_Config_Exception $e) {
        $test->assertEquals('Cannot override existing configuration value "' . $var . '"', $e->getMessage(),
                            $var . ' user user exception message');
    }
}

$a->addConfigValue('foo', 'booya');
$a->addConfigValue('foo2', 'booya2', false);

try {
    $a->addConfigValue('foo', 'fail');
    throw new Exception('foo should have failed!');
} catch (PEAR2_Pyrus_Config_Exception $e) {
    $test->assertEquals('Cannot override existing custom configuration value "foo"', $e->getMessage(),
                        'foo exception message');
}

try {
    $a->addConfigValue('foo', 'fail', false);
    throw new Exception('foo user should have failed!');
} catch (PEAR2_Pyrus_Config_Exception $e) {
    $test->assertEquals('Cannot override existing custom system configuration value "foo" with user value', $e->getMessage(),
                        'foo user exception message');
}

try {
    $a->addConfigValue('foo2', 'fail');
    throw new Exception('foo2 should have failed!');
} catch (PEAR2_Pyrus_Config_Exception $e) {
    $test->assertEquals('Cannot override existing custom user configuration value "foo2" with system value', $e->getMessage(),
                        'foo2 exception message');
}

try {
    $a->addConfigValue('foo2', 'fail', false);
    throw new Exception('foo2 user should have failed!');
} catch (PEAR2_Pyrus_Config_Exception $e) {
    $test->assertEquals('Cannot override existing custom configuration value "foo2"', $e->getMessage(),
                        'foo2 user exception message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===
--TEST--
PEAR2_Pyrus_Config::__get() and friends
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
set_include_path(''); // disable include_path cascading for simplicity
$a = $configclass::singleton($testpath, $testpath . '/blah');
$a->addConfigValue('foo', 'booya');
$a->addConfigValue('foo2', 'booya2', false);

$test->assertEquals('pear2.php.net', $a->default_channel, 'get user config var');
$test->assertEquals('booya', $a->foo, 'get custom system config var');
$test->assertEquals('booya2', $a->foo2, 'get custom user config var');
$test->assertEquals('PEAR2_Pyrus_Registry', get_class($a->registry), 'registry');
$test->assertEquals('PEAR2_Pyrus_ChannelRegistry', get_class($a->channelregistry), 'channelregistry');
$test->assertEquals(array_merge($a->mainsystemvars, array('foo')), $a->systemvars, 'systemvars');
$test->assertEquals(array_merge($a->mainuservars, array('foo2')), $a->uservars, 'uservars');
$test->assertEquals($testpath, $a->path, 'path');
$test->assertEquals($testpath . '/blah', $a->userfile, 'userfile');
$test->assertEquals(array('foo'), $a->customsystemvars, 'customsystemvars');
$test->assertEquals(array('foo2'), $a->customuservars, 'customuservars');

$a->foo2 = 'hi';
$test->assertEquals('hi', $a->foo2, 'test retrieving set value');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===
--TEST--
PEAR2_Pyrus_Config::__isset() and friends
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
set_include_path(''); // disable include_path cascading for simplicity
$a = $configclass::singleton($testpath, $testpath . '/blah');
$a->addConfigValue('foo', 'booya');
$a->addConfigValue('foo2', 'booya2', false);

foreach (array('registry',
                                        'channelregistry',
                                        'systemvars',
                                        'uservars',
                                        'mainsystemvars',
                                        'mainuservars',
                                        'userfile',
                                        'path',
                                        'php_dir',
                                        'data_dir') as $var) {
    $test->assertTrue(isset($a->$var), $var . ' isset');
}

foreach (array('registry',
                                        'channelregistry',
                                        'systemvars',
                                        'uservars',
                                        'mainsystemvars',
                                        'mainuservars',
                                        'userfile',
                                        'path',) as $var) {
    try {
        unset($a->$var);
        throw new Exception($var . ' unsetting did not fail');
    } catch (PEAR2_Pyrus_Config_Exception $e) {
        $test->assertEquals('Cannot unset magic value ' . $var, $e->getMessage(), $var . ' message');
    }
    $test->assertTrue(isset($a->$var), $var . ' isset');
}

foreach (array('php_dir', 'data_dir') as $var) {
    try {
        unset($a->$var);
        throw new Exception($var . ' unsetting did not fail');
    } catch (PEAR2_Pyrus_Config_Exception $e) {
        $test->assertEquals('Cannot unset ' . $var, $e->getMessage(), $var . ' message');
    }
}


$test->assertFalse(isset($a->test_dir), 'test_dir 1');
$a->test_dir = 'hi';
$test->assertTrue(isset($a->test_dir), 'test_dir 2');
unset($a->test_dir);
$test->assertFalse(isset($a->test_dir), 'test_dir 3');

$test->assertFalse(isset($a->foo), 'foo 1');
$a->foo = 'hi';
$test->assertTrue(isset($a->foo), 'foo 2');
unset($a->foo);
$test->assertFalse(isset($a->foo), 'foo 3');

$test->assertFalse(isset($a->default_channel), 'default_channel 1');
$a->default_channel = 'pear.php.net';
$test->assertTrue(isset($a->default_channel), 'default_channel 2');
unset($a->default_channel);
$test->assertFalse(isset($a->default_channel), 'default_channel 3');

$test->assertFalse(isset($a->foo2), 'foo 1');
$a->foo2 = 'hi';
$test->assertTrue(isset($a->foo2), 'foo 2');
unset($a->foo2);
$test->assertFalse(isset($a->foo2), 'foo 3');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===
<?php
require __DIR__ . '/../setup.php.inc';
$testpath = __DIR__ . '/testit';
mkdir($testpath);
$cdir = $testpath . '/.configsnapshots/';
--TEST--
PEAR2_Pyrus_Config::__set() and friends
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
set_include_path(''); // disable include_path cascading for simplicity
$a = $configclass::singleton($testpath, $testpath . '/blah');
$a->addConfigValue('foo', 'booya');
$a->addConfigValue('foo2', 'booya2', false);

foreach (array('registry',
                                        'channelregistry',
                                        'systemvars',
                                        'uservars',
                                        'mainsystemvars',
                                        'mainuservars',
                                        'userfile',
                                        'path') as $var) {
    try {
        $a->$var = 'oops';
        throw new Exception($var . ' setting did not fail');
    } catch (PEAR2_Pyrus_Config_Exception $e) {
        $test->assertEquals('Cannot set magic configuration variable ' . $var, $e->getMessage(), $var . ' message');
    }
}
try {
    $a->php_dir = 'oops';
    throw new Exception('php_dir setting did not fail');
} catch (PEAR2_Pyrus_Config_Exception $e) {
    $test->assertEquals('Cannot set php_dir, move the repository to change this value', $e->getMessage(), 'php_dir message');
}
try {
    $a->data_dir = 'oops';
    throw new Exception('data_dir setting did not fail');
} catch (PEAR2_Pyrus_Config_Exception $e) {
    $test->assertEquals('Cannot set data_dir, move the repository to change this value', $e->getMessage(), 'data_dir message');
}
try {
    $a->gronk = 'oops';
    throw new Exception('gronk setting did not fail');
} catch (PEAR2_Pyrus_Config_Exception $e) {
    $test->assertEquals('Unknown configuration variable "gronk" in location ' . $testpath, $e->getMessage(), 'gronk message');
}
$a->test_dir = 'hi';
$test->assertEquals('hi', $a->test_dir, 'test_dir');
$a->foo = 'hi2';
$test->assertEquals('hi2', $a->foo, 'foo');
$a->foo2 = 'hi3';
$test->assertEquals('hi3', $a->foo2, 'foo2');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===
<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
$configclass = 'PEAR2_Pyrus_Config';
--TEST--
PEAR2_Pyrus_Config::configSnapshot()
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
set_include_path(''); // disable include_path cascading for simplicity
$a = $configclass::singleton($testpath, $testpath . '/blah');
$d = DIRECTORY_SEPARATOR;
$test->assertEquals('configsnapshot-' . date('Y-m-d H:i:s') . '.xml', $a->configSnapshot(), 1);
$test->assertEquals('configsnapshot-' . date('Y-m-d H:i:s') . '.xml', $a->configSnapshot(), 2);
$test->assertEquals('configsnapshot-' . date('Y-m-d H:i:s') . '.xml', $a->configSnapshot(), 3);
$t = $a->test_dir;
$a->test_dir = 'hi';
$test->assertEquals('configsnapshot-' . date('Y-m-d H:i:s') . '.1.xml', $a->configSnapshot(), 4);
$test->assertEquals('configsnapshot-' . date('Y-m-d H:i:s') . '.1.xml', $a->configSnapshot(), 5);
$a->test_dir = $t;
$test->assertEquals('configsnapshot-' . date('Y-m-d H:i:s') . '.xml', $a->configSnapshot(), 6);
$a->test_dir = 'another';
$test->assertEquals('configsnapshot-' . date('Y-m-d H:i:s') . '.1.1.xml', $a->configSnapshot(), 7);

$test->assertEquals('<?xml version="1.0"?>
<pearconfig version="1.0"><php_dir>' .
    $a->php_dir . '</php_dir><ext_dir>' .
    $a->ext_dir . '</ext_dir><cfg_dir>' .
    $a->cfg_dir . '</cfg_dir><doc_dir>' .
    $a->doc_dir . '</doc_dir><bin_dir>' .
    $a->bin_dir . '</bin_dir><data_dir>' .
    $a->data_dir . '</data_dir><www_dir>' .
    $a->www_dir . '</www_dir><test_dir>' .
    $t . '</test_dir><src_dir>' .
    $a->src_dir . '</src_dir><php_bin>' .
    $a->php_bin . '</php_bin><php_ini>' .
    $a->php_ini . '</php_ini><php_prefix></php_prefix><php_suffix></php_suffix></pearconfig>
', file_get_contents($cdir . '/configsnapshot-' . date('Y-m-d H:i:s') . '.xml'), 'contents 1');
$test->assertEquals('<?xml version="1.0"?>
<pearconfig version="1.0"><php_dir>' .
    $a->php_dir . '</php_dir><ext_dir>' .
    $a->ext_dir . '</ext_dir><cfg_dir>' .
    $a->cfg_dir . '</cfg_dir><doc_dir>' .
    $a->doc_dir . '</doc_dir><bin_dir>' .
    $a->bin_dir . '</bin_dir><data_dir>' .
    $a->data_dir . '</data_dir><www_dir>' .
    $a->www_dir . '</www_dir><test_dir>' .
    'hi</test_dir><src_dir>' .
    $a->src_dir . '</src_dir><php_bin>' .
    $a->php_bin . '</php_bin><php_ini>' .
    $a->php_ini . '</php_ini><php_prefix></php_prefix><php_suffix></php_suffix></pearconfig>
', file_get_contents($cdir . '/configsnapshot-' . date('Y-m-d H:i:s') . '.1.xml'), 'contents 2');
$test->assertEquals('<?xml version="1.0"?>
<pearconfig version="1.0"><php_dir>' .
    $a->php_dir . '</php_dir><ext_dir>' .
    $a->ext_dir . '</ext_dir><cfg_dir>' .
    $a->cfg_dir . '</cfg_dir><doc_dir>' .
    $a->doc_dir . '</doc_dir><bin_dir>' .
    $a->bin_dir . '</bin_dir><data_dir>' .
    $a->data_dir . '</data_dir><www_dir>' .
    $a->www_dir . '</www_dir><test_dir>' .
    'another</test_dir><src_dir>' .
    $a->src_dir . '</src_dir><php_bin>' .
    $a->php_bin . '</php_bin><php_ini>' .
    $a->php_ini . '</php_ini><php_prefix></php_prefix><php_suffix></php_suffix></pearconfig>
', file_get_contents($cdir . '/configsnapshot-' . date('Y-m-d H:i:s') . '.1.1.xml'), 'contents 3');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===
<?php
require __DIR__ . '/../setup.php.inc';
$testpath = __DIR__ . '/testit';
mkdir($testpath);
$cdir = $testpath . '/.configsnapshots/';
--TEST--
test current returns singleton registry object
--FILE--
<?php
require dirname(__FILE__) . '/../setup.php.inc';
$test->assertEquals('PEAR2_Pyrus_Config',
                    get_class(PEAR2_Pyrus_Config::current()),
                    'test config');

$test->assertEquals('PEAR2_Pyrus_Registry',
                    get_class(PEAR2_Pyrus_Config::current()->registry),
                    'test registry');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Config::constructDefaults() bin_dir from PATH on Windows
--SKIPIF--
<?php
if (PATH_SEPARATOR !== ';') echo 'skip requires MS Windows';
?>
--ENV--
PATH=.;{PWD}
PHP_PEAR_BIN_DIR=
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
tc::constructDefaults();
$defaults = tc::getTestDefaults();
$test->assertEquals(dirname(__FILE__), $defaults['bin_dir'], 'after');
?>
===DONE===
--EXPECT--
===DONE===
--TEST--
PEAR2_Pyrus_Config::constructDefaults() extension_dir from PEAR_EXTENSION_DIR
--SKIPIF--
<?php
if (ini_get('extension_dir')) die("skip extension_dir must be unset to test this");
?>
--ENV--
PATH=.
PHP_PEAR_EXTENSION_DIR=
PEAR_EXTENSION_DIR=somethingelse2
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
tc::constructDefaults();
$defaults = tc::getTestDefaults();
$test->assertEquals('somethingelse2', $defaults['ext_dir'], 'after');
?>
===DONE===
--EXPECT--
===DONE===
--TEST--
PEAR2_Pyrus_Config::constructDefaults() bin_dir from PHP_BINDIR
--SKIPIF--
<?php
if (PATH_SEPARATOR == ';') echo 'skip requires non-MS Windows';
?>
--ENV--
PHP_PEAR_BIN_DIR=
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
tc::constructDefaults();
$defaults = tc::getTestDefaults();
$test->assertEquals(PHP_BINDIR, $defaults['bin_dir'], 'after');
?>
===DONE===
--EXPECT--
===DONE===
--TEST--
PEAR2_Pyrus_Config::constructDefaults() extension_dir from PHP_PEAR_EXTENSION_DIR
--ENV--
PATH=.
PHP_PEAR_EXTENSION_DIR=somethingelse
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
tc::constructDefaults();
$defaults = tc::getTestDefaults();
$test->assertEquals('somethingelse', $defaults['ext_dir'], 'after');
?>
===DONE===
--EXPECT--
===DONE===
--TEST--
PEAR2_Pyrus_Config::constructDefaults() bin_dir from PHP_PEAR_BIN_DIR
--ENV--
PATH=.;{PWD}
PHP_PEAR_BIN_DIR=somethingelse
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
tc::constructDefaults();
$defaults = tc::getTestDefaults();
$test->assertEquals('somethingelse', $defaults['bin_dir'], 'after');
?>
===DONE===
--EXPECT--
===DONE===
--TEST--
PEAR2_Pyrus_Config::constructDefaults() basic test
--INI--
extension_dir=
--ENV--
PATH=.
PHP_PEAR_BIN_DIR=
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$test->assertEquals(array(
            'php_dir' => '@php_dir@/php', // pseudo-value in this implementation
            'ext_dir' => '@php_dir@/ext',
            'doc_dir' => '@php_dir@/docs',
            'bin_dir' => PHP_BINDIR,
            'data_dir' => '@php_dir@/data', // pseudo-value in this implementation
            'cfg_dir' => '@php_dir@/cfg',
            'www_dir' => '@php_dir@/www',
            'test_dir' => '@php_dir@/tests',
            'src_dir' => '@php_dir@/src',
            'php_bin' => '',
            'php_prefix' => '',
            'php_suffix' => '',
            'php_ini' => '',
            'default_channel' => 'pear2.php.net',
            'preferred_mirror' => 'pear2.php.net',
            'auto_discover' => 0,
            'http_proxy' => '',
            'cache_dir' => '@php_dir@/cache',
            'temp_dir' => '@php_dir@/temp',
            'download_dir' => '@php_dir@/downloads',
            'username' => '',
            'password' => '',
            'verbose' => 1,
            'preferred_state' => 'stable',
            'umask' => '0022',
            'cache_ttl' => 3600,
            'sig_type' => '',
            'sig_bin' => '',
            'sig_keyid' => '',
            'sig_keydir' => '',
            'my_pear_path' => '@php_dir@',
            'plugins_dir' => '@default_config_dir@',
        ), tc::getTestDefaults(), 'before init');
tc::constructDefaults();
$test->assertEquals(array(
            'php_dir' => '@php_dir@' . DIRECTORY_SEPARATOR . 'php',
            'ext_dir' => PEAR_EXTENSION_DIR,
            'doc_dir' => '@php_dir@' . DIRECTORY_SEPARATOR . 'docs',
            'bin_dir' => PHP_BINDIR,
            'data_dir' => '@php_dir@' . DIRECTORY_SEPARATOR . 'data', // pseudo-value in this implementation
            'cfg_dir' => '@php_dir@/cfg',
            'www_dir' => '@php_dir@' . DIRECTORY_SEPARATOR . 'www',
            'test_dir' => '@php_dir@' . DIRECTORY_SEPARATOR . 'tests',
            'src_dir' => '@php_dir@' . DIRECTORY_SEPARATOR . 'src',
            'php_bin' => PEAR2_Pyrus_Config::current()->php_bin, // no way to reliably test this, so a cop-out
            'php_prefix' => '',
            'php_suffix' => '',
            'php_ini' => php_ini_loaded_file(),
            'default_channel' => 'pear2.php.net',
            'preferred_mirror' => 'pear2.php.net',
            'auto_discover' => '0',
            'http_proxy' => '',
            'cache_dir' => '@php_dir@' . DIRECTORY_SEPARATOR . 'cache',
            'temp_dir' => '@php_dir@' . DIRECTORY_SEPARATOR . 'temp',
            'download_dir' => '@php_dir@' . DIRECTORY_SEPARATOR . 'downloads',
            'username' => '',
            'password' => '',
            'verbose' => '1',
            'preferred_state' => 'stable',
            'umask' => '0022',
            'cache_ttl' => '3600',
            'sig_type' => '',
            'sig_bin' => '',
            'sig_keyid' => '',
            'sig_keydir' => '',
            'my_pear_path' => '@php_dir@',
            'plugins_dir' => '@default_config_dir@',
        ), tc::getTestDefaults(), 'after');
$phpini = tc::getTestDefaults();
$test->assertRegex('/\.ini/', $phpini['php_ini'], 'php_ini');
// increase code coverage
$c = PEAR2_Pyrus_Config::current();
$test->assertSame($c, PEAR2_Pyrus_Config::singleton(), 'current = singleton');
?>
===DONE===
--EXPECT--
===DONE===
--TEST--
PEAR2_Pyrus_Config::constructDefaults() extension_dir from php.ini
--SKIPIF--
<?php if (!ini_get('extension_dir')) die("skip extension_dir not set"); ?>
--ENV--
PHP_PEAR_EXTENSION_DIR=
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
tc::constructDefaults();
$defaults = tc::getTestDefaults();
$test->assertEquals(ini_get('extension_dir'), $defaults['ext_dir'], 'after');
?>
===DONE===
--EXPECT--
===DONE===
<?php
require dirname(dirname(__FILE__)) . '/setup.php.inc';
class tc extends PEAR2_Pyrus_Config
{
    public static function getTestDefaults($nophpini = false)
    {
        return self::$defaults;
    }

    public static function constructDefaults()
    {
        return parent::constructDefaults();
    }
}
*.php
*.out
*.exp
*.log
*.xdebug
--TEST--
PEAR2_Pyrus_ChannelRegistry_Base::parseName()
--FILE--
<?php
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$creg = new PEAR2_Pyrus_ChannelRegistry(__DIR__ . '/testit');

$test->assertEquals(array(
    'package' => 'foo',
    'channel' => 'pear2.php.net',
), $creg->parseName('foo'), 'foo');

$test->assertEquals(array(
    'package' => 'foo',
    'channel' => 'pear.php.net',
), $creg->parseName('foo', 'pear.php.net'), 'foo pear.php.net');

$test->assertEquals(array(
    'package' => 'foo',
    'channel' => 'pear.php.net',
), $creg->parseName('channel://pear/foo'), 'channel://pear/foo');

$test->assertEquals(array(
    'package' => 'foo',
    'channel' => 'pecl.php.net',
    'user' => 'user',
    'pass' => 'pass',
), $creg->parseName('channel://user:pass@pecl.php.net/foo'), 'channel://pear/foo');

$test->assertEquals(array(
    'uri' => 'http://user:pass@pecl.php.net/foo',
    'channel' => '__uri',
), $creg->parseName('http://user:pass@pecl.php.net/foo'), 'http://user:pass@pecl.php.net/foo');

$test->assertEquals(array(
    'uri' => 'https://user:pass@pecl.php.net/foo',
    'channel' => '__uri',
), $creg->parseName('https://user:pass@pecl.php.net/foo'), 'https://user:pass@pecl.php.net/foo');

$test->assertEquals(array(
    'package' => 'foo',
    'channel' => 'pear2.php.net',
    'group' => 'group',
), $creg->parseName('foo#group'), 'foo#group');

$test->assertEquals(array(
    'package' => 'foo',
    'channel' => 'pear2.php.net',
    'group' => 'group',
    'opts' => array(
        'one' => 'one',
        'two' => 'two',
    )
), $creg->parseName('foo?one=one&two=two#group'), 'foo?one=one&two=two#group');

foreach (array('tgz', 'tar', 'zip', 'tbz', 'phar') as $ext) {
    $test->assertEquals(array(
        'package' => 'foo',
        'channel' => 'pear2.php.net',
        'extension' => $ext,
    ), $creg->parseName("foo.$ext"), "foo.$ext");
}

$test->assertEquals(array(
    'package' => 'foo',
    'channel' => 'pear2.php.net',
    'version' => '1.2.3',
), $creg->parseName('foo-1.2.3'), 'foo-1.2.3');

foreach (array('devel', 'snapshot', 'alpha', 'beta', 'stable') as $state) {
    $test->assertEquals(array(
        'package' => 'foo',
        'channel' => 'pear2.php.net',
        'state' => $state,
    ), $creg->parseName("foo-$state"), "foo-$state");
}

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry::delete() readonly test
--FILE--
<?php
mkdir(__DIR__ . '/testit');
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
// construct the registries first
$creg = new PEAR2_Pyrus_ChannelRegistry(__DIR__ . '/testit', array('Sqlite3', 'Xml'), false);
$creg = new PEAR2_Pyrus_ChannelRegistry(__DIR__ . '/testit', array('Sqlite3', 'Xml'), true);
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
try {
    $creg->delete($chan);
    throw new Exception('passed and shouldn\'t');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot delete channel, registry is read-only', $e->getMessage(), 'message');
}

try {
    unset($creg[$chan->name]);
    throw new Exception('passed and shouldn\'t');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot delete channel, registry is read-only', $e->getMessage(), 'message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry::delete() delete internal channel
--FILE--
<?php
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
restore_include_path();
$c->saveConfig();
foreach (array('pear.php.net',
               'pear2.php.net',
               'pecl.php.net',
               '__uri') as $name) {
    $chan = $c->channelregistry->get($name);
    $thrown = false;
    try {
        $c->channelregistry->delete($chan);
        throw new Exception('delete succeeded and should have failed');
    } catch(PEAR2_Pyrus_ChannelRegistry_Exception $e) {
        $test->assertEquals('Cannot delete default channel ' . $name, $e->getMessage(), $name . ' message');
    }
    $test->assertEquals(true, $c->channelregistry->exists($name), $name.' channel still exists');
}

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry::delete() delete external channel
--FILE--
<?php
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
restore_include_path();
$c->saveConfig();
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
$c->channelregistry->add($chan);
$test->assertEquals(true, $c->channelregistry->exists('pear.unl.edu'), 'successfully added the channel');
$chan = $c->channelregistry->get('pear.unl.edu');
$c->channelregistry->delete($chan);
$test->assertEquals(false, $c->channelregistry->exists('pear.unl.edu'), 'successfully deleted');

$c->channelregistry->add($chan);
$test->assertEquals(true, $c->channelregistry->exists('pear.unl.edu'), 'successfully added the channel 2');
unset($c->channelregistry[$chan->name]);
$test->assertEquals(false, $c->channelregistry->exists('pear.unl.edu'), 'successfully deleted 2');

$c->channelregistry[$chan->name] = $chan;
$test->assertEquals(true, $c->channelregistry->exists('pear.unl.edu'), 'successfully added the channel 3');
unset($c->channelregistry[$chan->alias]);
$test->assertEquals(false, $c->channelregistry->exists('pear.unl.edu'), 'successfully deleted 3');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry::delete() delete failure, channel has installed packages
--FILE--
<?php
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
include __DIR__ . '/../../../Registry/AllRegistries/setupPackageFile.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
restore_include_path();
$c->saveConfig();
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
$c->channelregistry->add($chan);
$test->assertEquals(true, $c->channelregistry->exists('pear.unl.edu'), 'successfully added the channel');
$chan = $c->channelregistry->get('pear.unl.edu');

$info->channel = 'pear.unl.edu';
$c->registry->install($info);

try {
    $c->channelregistry->delete($chan);
    die('Should not have worked');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot delete channel pear.unl.edu, packages are installed', $e->getMessage(), 'error');
}
$test->assertEquals(true, $c->channelregistry->exists('pear.unl.edu'), 'not successfully deleted');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry::exists() strict internal channel test
--FILE--
<?php
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
restore_include_path();
$c->saveConfig();
foreach (array('pear'=>'pear.php.net',
               'pear2'=>'pear2.php.net',
               'pecl'=>'pecl.php.net') as $alias=>$name) {
    $test->assertEquals(false, $c->channelregistry->exists($alias, true), $alias.' channel alias should not exist');
    $test->assertEquals(true, $c->channelregistry->exists($name, true), $name.' channel name');
}
$test->assertEquals(true, $c->channelregistry->exists('__uri', true), '__uri channel');
$test->assertEquals(false, $c->channelregistry->exists('cookiemonster', true), 'fake channel does not exist, 1');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry::exists() strict external channel check
--FILE--
<?php
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
restore_include_path();
$c->saveConfig();
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
$c->channelregistry->add($chan);
$test->assertEquals(true, $c->channelregistry->exists('pear.unl.edu', true), 'external channel using full name');
$test->assertEquals(false, $c->channelregistry->exists('unl', true), 'external channel alias should fail strict check');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry::exists() basic test
--FILE--
<?php
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
restore_include_path();
$c->saveConfig();
foreach (array('pear'=>'pear.php.net',
               'pear2'=>'pear2.php.net',
               'pecl'=>'pecl.php.net') as $alias=>$name) {
    $test->assertEquals(true, $c->channelregistry->exists($alias, false), $alias.' channel alias');
    $test->assertEquals(true, $c->channelregistry->exists($name, false), $name.' channel name');
}
$test->assertEquals(true, $c->channelregistry->exists('__uri', false), '__uri channel');
$test->assertEquals(false, $c->channelregistry->exists('cookiemonster', false), 'fake channel does not exist, 1');

$test->assertEquals(true, isset($c->channelregistry['__uri']), '__uri channel 2');
$test->assertEquals(false, isset($c->channelregistry['cookiemonster']), 'fake channel does not exist, 2');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry::exists() basic test
--FILE--
<?php
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
restore_include_path();
$c->saveConfig();
$test->assertEquals(false, $c->channelregistry->exists('pear.unl.edu'), 'successfully added the channel');
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
$c->channelregistry->add($chan);
$test->assertEquals(true, $c->channelregistry->exists('pear.unl.edu', false), 'successfully added the channel');
$test->assertEquals(true, $c->channelregistry->exists('unl', false), 'successfully added the channel');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
$test->assertEquals('pear.php.net', $channel->name,           'Channel name');
$test->assertEquals(80,             $channel->port,           'Channel port');
$test->assertEquals(false,          $channel->ssl,            'Channel SSL');
$test->assertEquals('pear',         $channel->alias,          'Channel alias');
$test->assertEquals('PHP Extension and Application Repository',
                                    $channel->summary,        'Channel summary');
<?php
$test->assertEquals('http://pear.php.net/rest1.0/',
                                    $channel->protocols->rest['REST1.0']->baseurl,
                                                              'Get rest 1.0');
$test->assertEquals('http://pear.php.net/rest1.3/',
                                    $channel->protocols->rest['REST1.3']->baseurl,
                                                              'Get rest 1.3');

<?php
$test->assertTrue(isset($channel->mirror['us.pear.php.net']), 'Mirrors are set');
$test->assertFalse(isset($channel->mirror['foo']), 'Fake mirror is not set');


$test->assertEquals('http://us.pear.php.net/rest1.0/',
                                    $channel->mirror['us.pear.php.net']->protocols->rest['REST1.0']->baseurl,
                                                              'Get Mirror rest 1.0');
$test->assertEquals('http://us.pear.php.net/rest1.3/',
                                    $channel->mirror['us.pear.php.net']->protocols->rest['REST1.3']->baseurl,
                                                              'Get Mirror rest 1.3');--TEST--
PEAR2_Pyrus_ChannelRegistry::listChannels() default channels
--FILE--
<?php
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
restore_include_path();
$c->saveConfig();

$chans = $c->channelregistry->listChannels();
sort($chans);

$test->assertEquals(array(
    '__uri',
    'pear.php.net',
    'pear2.php.net',
    'pecl.php.net',
), $chans, 'listChannels');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry::add() basic test
--FILE--
<?php
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
restore_include_path();
$c->saveConfig();
$test->assertEquals(false, $c->channelregistry->exists('pear.unl.edu'), 'channel should not exist');
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
$c->channelregistry->add($chan);
$test->assertEquals(true, $c->channelregistry->exists('pear.unl.edu'), 'successfully added the channel');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry::add() readonly test
--FILE--
<?php
mkdir(__DIR__ . '/testit');
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
// construct the registries first
$creg = new PEAR2_Pyrus_ChannelRegistry(__DIR__ . '/testit', array('Sqlite3', 'Xml'), false);
$creg = new PEAR2_Pyrus_ChannelRegistry(__DIR__ . '/testit', array('Sqlite3', 'Xml'), true);
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
try {
    $creg->add($chan);
    throw new Exception('passed and shouldn\'t');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot add channel, registry is read-only', $e->getMessage(), 'message');
}
try {
    $creg[$chan->name] = $chan;
    throw new Exception('passed and shouldn\'t 2');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot add channel, registry is read-only', $e->getMessage(), 'message 2');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry::update() readonly test
--FILE--
<?php
mkdir(__DIR__ . '/testit');
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
// construct the registries first
$creg = new PEAR2_Pyrus_ChannelRegistry(__DIR__ . '/testit', array('Sqlite3', 'Xml'), false);
$creg = new PEAR2_Pyrus_ChannelRegistry(__DIR__ . '/testit', array('Sqlite3', 'Xml'), true);
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
try {
    $creg->update($chan);
    throw new Exception('passed and shouldn\'t');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot update channel, registry is read-only', $e->getMessage(), 'message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry::update() basic test
--FILE--
<?php
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
restore_include_path();
$c->saveConfig();
$test->assertEquals(false, $c->channelregistry->exists('pear.unl.edu'), 'channel should not exist');
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
$c->channelregistry->add($chan);
$test->assertEquals(true, $c->channelregistry->exists('pear.unl.edu'), 'successfully added the channel');

$test->assertEquals(80, $c->channelregistry->get('pear.unl.edu')->port, 'before');
$chan->port = 234;
$c->channelregistry->update($chan);
$test->assertEquals(234, $c->channelregistry->get('pear.unl.edu')->port, 'before');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Pear1::delete() readonly test
--FILE--
<?php
mkdir(__DIR__ . '/testit');
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
// construct the registries first
$creg = new PEAR2_Pyrus_ChannelRegistry_Pear1(__DIR__ . '/testit', false);
$creg = new PEAR2_Pyrus_ChannelRegistry_Pear1(__DIR__ . '/testit', true);
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
try {
    $creg->delete($chan);
    throw new Exception('passed and shouldn\'t');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot delete channel, registry is read-only', $e->getMessage(), 'message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Pear1::delete() delete internal channel
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
foreach (array('pear.php.net',
               'pear2.php.net',
               'pecl.php.net',
               '__uri') as $name) {
    $chan = $creg->get($name);
    $thrown = false;
    try {
        $creg->delete($chan);
        throw new Exception('delete succeeded and should have failed');
    } catch(PEAR2_Pyrus_ChannelRegistry_Exception $e) {
        $test->assertEquals('Cannot delete default channel ' . $name, $e->getMessage(), $name . ' message');
    }
    $test->assertEquals(true, $creg->exists($name), $name.' channel still exists');
}

?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Pear1::delete() delete external channel
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
$creg->add($chan);
$test->assertEquals(true, $creg->exists('pear.unl.edu'), 'successfully added the channel');
$chan = $creg->get('pear.unl.edu');
$creg->delete($chan);
$test->assertEquals(false, $creg->exists('pear.unl.edu'), 'successfully deleted');

?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Pear1::delete() delete failure, channel has installed packages
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
include __DIR__ . '/../../../Registry/AllRegistries/setupPackageFile.php.inc';
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
$creg->add($chan);
$test->assertEquals(true, $creg->exists('pear.unl.edu'), 'successfully added the channel');
$chan = $creg->get('pear.unl.edu');

$info->channel = 'pear.unl.edu';
$creg->getRegistry()->install($info);

try {
    $creg->delete($chan);
    die('Should not have worked');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot delete channel pear.unl.edu, packages are installed', $e->getMessage(), 'error');
}
$test->assertEquals(true, $creg->exists('pear.unl.edu'), 'not successfully deleted');

?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include __DIR__ . '/../../test_framework.php.inc';
@mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
restore_include_path();
$c->saveConfig();
$creg = new PEAR2_Pyrus_ChannelRegistry_Pear1(__DIR__ . '/testit');

--TEST--
PEAR2_Pyrus_ChannelRegistry_Pear1::listChannels() default channels
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$chans = $creg->listChannels();
sort($chans);

$test->assertEquals(array(
    '__uri',
    'pear.php.net',
    'pear2.php.net',
    'pecl.php.net',
), $chans, 'listChannels');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Pear1::add() basic test
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$test->assertEquals(false, $creg->exists('pear.unl.edu'), 'channel should not exist');
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(__DIR__ . '/../../sample_channel_complex2.xml'));
$creg->add($chan);
$test->assertEquals(true, $creg->exists('pear.unl.edu'), 'successfully added the channel');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Pear1::add() readonly test
--FILE--
<?php
mkdir(__DIR__ . '/testit');
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
// construct the registries first
$creg = new PEAR2_Pyrus_ChannelRegistry_Pear1(__DIR__ . '/testit', false);
$creg = new PEAR2_Pyrus_ChannelRegistry_Pear1(__DIR__ . '/testit', true);
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
try {
    $creg->add($chan);
    throw new Exception('passed and shouldn\'t');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot add channel, registry is read-only', $e->getMessage(), 'message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Pear1::update() readonly test
--FILE--
<?php
mkdir(__DIR__ . '/testit');
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
// construct the registries first
$creg = new PEAR2_Pyrus_ChannelRegistry_Pear1(__DIR__ . '/testit', false);
$creg = new PEAR2_Pyrus_ChannelRegistry_Pear1(__DIR__ . '/testit', true);
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
try {
    $creg->update($chan);
    throw new Exception('passed and shouldn\'t');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot update channel, registry is read-only', $e->getMessage(), 'message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Pear1::update() basic test
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$test->assertEquals(false, $creg->exists('pear.unl.edu'), 'channel should not exist');
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(__DIR__ . '/../../sample_channel_complex2.xml'));
$creg->add($chan);
$test->assertEquals(true, $creg->exists('pear.unl.edu'), 'successfully added the channel');

$test->assertEquals(80, $creg->get('pear.unl.edu')->port, 'before');
$chan->port = 234;
$creg->update($chan);
$test->assertEquals(234, $creg->get('pear.unl.edu')->port, 'before');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?xml version="1.0" encoding="ISO-8859-1" ?>
<channel version="1.0" xmlns="http://pear.php.net/channel-1.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://pear.php.net/dtd/channel-1.0 http://pear.php.net/dtd/channel-1.0.xsd">
 <name>pear.unl.edu</name>
 <summary>UNL PHP Extension and Application Repository</summary>
 <suggestedalias>unl</suggestedalias>
 <servers>
  <primary>
   <rest>

    <baseurl type="REST1.0">http://pear.unl.edu/Chiara_PEAR_Server_REST1.0/</baseurl>
    <baseurl type="REST1.1">http://pear.unl.edu/Chiara_PEAR_Server_REST1.1/</baseurl>
    <baseurl type="REST1.3">http://pear.unl.edu/Chiara_PEAR_Server_REST1.3/</baseurl>
   </rest>
  </primary>
 </servers>
</channel>--TEST--
PEAR2_Pyrus_ChannelRegistry_Xml::delete() readonly test
--FILE--
<?php
mkdir(__DIR__ . '/testit');
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
// construct the registries first
$creg = new PEAR2_Pyrus_ChannelRegistry_Xml(__DIR__ . '/testit', false);
$creg = new PEAR2_Pyrus_ChannelRegistry_Xml(__DIR__ . '/testit', true);
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
try {
    $creg->delete($chan);
    throw new Exception('passed and shouldn\'t');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot delete channel, registry is read-only', $e->getMessage(), 'message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Xml::delete() delete internal channel
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
foreach (array('pear.php.net',
               'pear2.php.net',
               'pecl.php.net',
               '__uri') as $name) {
    $chan = $creg->get($name);
    $thrown = false;
    try {
        $creg->delete($chan);
        throw new Exception('delete succeeded and should have failed');
    } catch(PEAR2_Pyrus_ChannelRegistry_Exception $e) {
        $test->assertEquals('Cannot delete default channel ' . $name, $e->getMessage(), $name . ' message');
    }
    $test->assertEquals(true, $creg->exists($name), $name.' channel still exists');
}

?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Xml::delete() delete external channel
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
$creg->add($chan);
$test->assertEquals(true, $creg->exists('pear.unl.edu'), 'successfully added the channel');
$chan = $creg->get('pear.unl.edu');
$creg->delete($chan);
$test->assertEquals(false, $creg->exists('pear.unl.edu'), 'successfully deleted');

?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Xml::delete() delete failure, channel has installed packages
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
include __DIR__ . '/../../../Registry/AllRegistries/setupPackageFile.php.inc';
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
$creg->add($chan);
$test->assertEquals(true, $creg->exists('pear.unl.edu'), 'successfully added the channel');
$chan = $creg->get('pear.unl.edu');

$info->channel = 'pear.unl.edu';
$creg->getRegistry()->install($info);

try {
    $creg->delete($chan);
    die('Should not have worked');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot delete channel pear.unl.edu, packages are installed', $e->getMessage(), 'error');
}
$test->assertEquals(true, $creg->exists('pear.unl.edu'), 'not successfully deleted');

?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include __DIR__ . '/../../test_framework.php.inc';
@mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
restore_include_path();
$c->saveConfig();
$creg = new PEAR2_Pyrus_ChannelRegistry_Xml(__DIR__ . '/testit');

--TEST--
PEAR2_Pyrus_ChannelRegistry_Xml::listChannels() default channels
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$chans = $creg->listChannels();
sort($chans);

$test->assertEquals(array(
    '__uri',
    'pear.php.net',
    'pear2.php.net',
    'pecl.php.net',
), $chans, 'listChannels');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Xml::add() basic test
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$test->assertEquals(false, $creg->exists('pear.unl.edu'), 'channel should not exist');
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(__DIR__ . '/../../sample_channel_complex2.xml'));
$creg->add($chan);
$test->assertEquals(true, $creg->exists('pear.unl.edu'), 'successfully added the channel');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Xml::add() readonly test
--FILE--
<?php
mkdir(__DIR__ . '/testit');
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
// construct the registries first
$creg = new PEAR2_Pyrus_ChannelRegistry_Xml(__DIR__ . '/testit', false);
$creg = new PEAR2_Pyrus_ChannelRegistry_Xml(__DIR__ . '/testit', true);
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
try {
    $creg->add($chan);
    throw new Exception('passed and shouldn\'t');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot add channel, registry is read-only', $e->getMessage(), 'message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Xml::update() readonly test
--FILE--
<?php
mkdir(__DIR__ . '/testit');
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
// construct the registries first
$creg = new PEAR2_Pyrus_ChannelRegistry_Xml(__DIR__ . '/testit', false);
$creg = new PEAR2_Pyrus_ChannelRegistry_Xml(__DIR__ . '/testit', true);
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
try {
    $creg->update($chan);
    throw new Exception('passed and shouldn\'t');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot update channel, registry is read-only', $e->getMessage(), 'message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Xml::update() basic test
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$test->assertEquals(false, $creg->exists('pear.unl.edu'), 'channel should not exist');
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(__DIR__ . '/../../sample_channel_complex2.xml'));
$creg->add($chan);
$test->assertEquals(true, $creg->exists('pear.unl.edu'), 'successfully added the channel');

$test->assertEquals(80, $creg->get('pear.unl.edu')->port, 'before');
$chan->port = 234;
$creg->update($chan);
$test->assertEquals(234, $creg->get('pear.unl.edu')->port, 'before');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?xml version="1.0" encoding="ISO-8859-1"?>
<channel version="1.0" xmlns="http://pear.php.net/channel-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/channel-1.0
http://pear.php.net/dtd/channel-1.0.xsd">
 <name>pear.unl.edu</name>
 <suggestedalias>unl</suggestedalias>
 <summary>PHP Extension and Application Repository</summary>
 <servers>
  <primary>
   <rest>

    <baseurl type="REST1.0">http://pear.php.net/rest1.0/</baseurl>
    <baseurl type="REST1.1">http://pear.php.net/rest1.1/</baseurl>
    <baseurl type="REST1.2">http://pear.php.net/rest1.2/</baseurl>
    <baseurl type="REST1.3">http://pear.php.net/rest1.3/</baseurl>
   </rest>
  </primary>
  <mirror host="us.pear.unl.edu">

   <rest>
    <baseurl type="REST1.0">http://us.pear.php.net/rest1.0/</baseurl>
    <baseurl type="REST1.1">http://us.pear.php.net/rest1.1/</baseurl>
    <baseurl type="REST1.2">http://us.pear.php.net/rest1.2/</baseurl>
    <baseurl type="REST1.3">http://us.pear.php.net/rest1.3/</baseurl>
   </rest>
  </mirror>

  <mirror host="de.pear.unl.edu" ssl="yes" port="3452">
   <rest>
    <baseurl type="REST1.0">https://de.pear.php.net:3452/rest/</baseurl>
    <baseurl type="REST1.1">https://de.pear.php.net:3452/rest/</baseurl>
    <baseurl type="REST1.2">https://de.pear.php.net:3452/rest/</baseurl>
    <baseurl type="REST1.3">https://de.pear.php.net:3452/rest/</baseurl>
   </rest>

  </mirror>
 </servers>
</channel>
<?xml version="1.0" encoding="ISO-8859-1"?>
<channel version="1.0" xmlns="http://pear.php.net/channel-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/channel-1.0
http://pear.php.net/dtd/channel-1.0.xsd">
 <name>pear.php.net</name>
 <suggestedalias>pear</suggestedalias>
 <summary>PHP Extension and Application Repository</summary>
 <servers>
  <primary>
   <rest>

    <baseurl type="REST1.0">http://pear.php.net/rest1.0/</baseurl>
    <baseurl type="REST1.1">http://pear.php.net/rest1.1/</baseurl>
    <baseurl type="REST1.2">http://pear.php.net/rest1.2/</baseurl>
    <baseurl type="REST1.3">http://pear.php.net/rest1.3/</baseurl>
   </rest>
  </primary>
  <mirror host="us.pear.php.net">

   <rest>
    <baseurl type="REST1.0">http://us.pear.php.net/rest1.0/</baseurl>
    <baseurl type="REST1.1">http://us.pear.php.net/rest1.1/</baseurl>
    <baseurl type="REST1.2">http://us.pear.php.net/rest1.2/</baseurl>
    <baseurl type="REST1.3">http://us.pear.php.net/rest1.3/</baseurl>
   </rest>
  </mirror>

  <mirror host="de.pear.php.net" ssl="yes" port="3452">
   <rest>
    <baseurl type="REST1.0">https://de.pear.php.net:3452/rest/</baseurl>
    <baseurl type="REST1.1">https://de.pear.php.net:3452/rest/</baseurl>
    <baseurl type="REST1.2">https://de.pear.php.net:3452/rest/</baseurl>
    <baseurl type="REST1.3">https://de.pear.php.net:3452/rest/</baseurl>
   </rest>

  </mirror>
 </servers>
</channel>
<?xml version="1.0" encoding="UTF-8"?>
<channel version="1.0" xmlns="http://pear.php.net/channel-1.0">
 <name>pear.example.com</name>
 <suggestedalias>sslchannel</suggestedalias>
 <summary>Test SSL Channel</summary>
 <servers>
  <primary ssl="yes" port="443">
   <rest>
    <baseurl type="REST1.0">https://pear.example.com/rest1.0/</baseurl>
    <baseurl type="REST1.1">https://pear.example.com/rest1.1/</baseurl>
    <baseurl type="REST1.3">https://pear.example.com/rest1.3/</baseurl>
   </rest>
  </primary>
 </servers>
</channel>
--TEST--
PEAR2_Pyrus_ChannelRegistry_Sqlite3::delete() readonly test
--FILE--
<?php
mkdir(__DIR__ . '/testit');
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
// construct the registries first
$creg = new PEAR2_Pyrus_ChannelRegistry_Sqlite3(__DIR__ . '/testit', false);
$creg = new PEAR2_Pyrus_ChannelRegistry_Sqlite3(__DIR__ . '/testit', true);
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
try {
    $creg->delete($chan);
    throw new Exception('passed and shouldn\'t');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot delete channel, registry is read-only', $e->getMessage(), 'message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Sqlite3::delete() delete internal channel
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
foreach (array('pear.php.net',
               'pear2.php.net',
               'pecl.php.net',
               '__uri') as $name) {
    $chan = $creg->get($name);
    $thrown = false;
    try {
        $creg->delete($chan);
        throw new Exception('delete succeeded and should have failed');
    } catch(PEAR2_Pyrus_ChannelRegistry_Exception $e) {
        $test->assertEquals('Cannot delete default channel ' . $name, $e->getMessage(), $name . ' message');
    }
    $test->assertEquals(true, $creg->exists($name), $name.' channel still exists');
}

?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Sqlite3::delete() delete external channel
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
$creg->add($chan);
$test->assertEquals(true, $creg->exists('pear.unl.edu'), 'successfully added the channel');
$chan = $creg->get('pear.unl.edu');
$creg->delete($chan);
$test->assertEquals(false, $creg->exists('pear.unl.edu'), 'successfully deleted');

?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Sqlite3::delete() delete failure, channel has installed packages
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
include __DIR__ . '/../../../Registry/AllRegistries/setupPackageFile.php.inc';
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
$creg->add($chan);
$test->assertEquals(true, $creg->exists('pear.unl.edu'), 'successfully added the channel');
$chan = $creg->get('pear.unl.edu');

$info->channel = 'pear.unl.edu';
$creg->getRegistry()->install($info);

try {
    $creg->delete($chan);
    die('Should not have worked');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot delete channel pear.unl.edu, packages are installed', $e->getMessage(), 'error');
}
$test->assertEquals(true, $creg->exists('pear.unl.edu'), 'not successfully deleted');

?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include __DIR__ . '/../../test_framework.php.inc';
@mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
restore_include_path();
$c->saveConfig();
$creg = new PEAR2_Pyrus_ChannelRegistry_Sqlite3(__DIR__ . '/testit');

--TEST--
PEAR2_Pyrus_ChannelRegistry_Sqlite3::listChannels() default channels
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$chans = $creg->listChannels();
sort($chans);

$test->assertEquals(array(
    '__uri',
    'pear.php.net',
    'pear2.php.net',
    'pecl.php.net',
), $chans, 'listChannels');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Sqlite3::add() basic test
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$test->assertEquals(false, $creg->exists('pear.unl.edu'), 'channel should not exist');
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(__DIR__ . '/../../sample_channel_complex2.xml'));
$creg->add($chan);
$test->assertEquals(true, $creg->exists('pear.unl.edu'), 'successfully added the channel');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Sqlite3::add() readonly test
--FILE--
<?php
mkdir(__DIR__ . '/testit');
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
// construct the registries first
$creg = new PEAR2_Pyrus_ChannelRegistry_Sqlite3(__DIR__ . '/testit', false);
$creg = new PEAR2_Pyrus_ChannelRegistry_Sqlite3(__DIR__ . '/testit', true);
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
try {
    $creg->add($chan);
    throw new Exception('passed and shouldn\'t');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot add channel, registry is read-only', $e->getMessage(), 'message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Sqlite3::update() readonly test
--FILE--
<?php
mkdir(__DIR__ . '/testit');
require dirname(dirname(__FILE__)) . '/../setup.php.inc';
// construct the registries first
$creg = new PEAR2_Pyrus_ChannelRegistry_Sqlite3(__DIR__ . '/testit', false);
$creg = new PEAR2_Pyrus_ChannelRegistry_Sqlite3(__DIR__ . '/testit', true);
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/../sample_channel.xml'));
try {
    $creg->update($chan);
    throw new Exception('passed and shouldn\'t');
} catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
    $test->assertEquals('Cannot update channel, registry is read-only', $e->getMessage(), 'message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelRegistry_Sqlite3::update() basic test
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$test->assertEquals(false, $creg->exists('pear.unl.edu'), 'channel should not exist');
$chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(__DIR__ . '/../../sample_channel_complex2.xml'));
$creg->add($chan);
$test->assertEquals(true, $creg->exists('pear.unl.edu'), 'successfully added the channel');

$test->assertEquals(80, $creg->get('pear.unl.edu')->port, 'before');
$chan->port = 234;
$creg->update($chan);
$test->assertEquals(234, $creg->get('pear.unl.edu')->port, 'before');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
--TEST--
Pyrus XMLWriter: attributes
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';

$write = new $xmlwriter(array('a' => array('attribs' => array('one' => 'two'))));
$test->assertEquals('<?xml version="1.0" encoding="UTF-8"?>
<a one="two"/>', (string) $write, 1);
$write = new $xmlwriter(array('a' => array('attribs' => array('one' => 'two', 'three' => 'four'))));
$test->assertEquals('<?xml version="1.0" encoding="UTF-8"?>
<a one="two" three="four"/>', (string) $write, 2);
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Pyrus XMLWriter: child tag + attributes
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$write = new $xmlwriter(array(
  'a' =>
  array(
    'b' =>
    array(
      'attribs' =>
      array(
        'one' => 'two'
      )
    ),
  ),
));
$test->assertEquals('<?xml version="1.0" encoding="UTF-8"?>
<a>
 <b one="two"/>
</a>', (string) $write, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Pyrus XMLWriter: child tag + sibling attributes
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$write = new $xmlwriter(array(
  'a' =>
  array(
    'b' =>
    array(
      '',
      array(
        'attribs' =>
        array(
          'one' => 'two'
        )
      ),
    ),
  ),
));
$test->assertEquals('<?xml version="1.0" encoding="UTF-8"?>
<a>
 <b></b>
 <b one="two"/>
</a>', (string) $write, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Pyrus XMLWriter: complex recursive tags
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$write = new $xmlwriter(array (
  'package' => 
  array (
    'lead' => 
    array (
      0 => 
      array (
        'name' => 'test',
        'another' => 'tag',
      ),
      1 => 
      array (
        'name' => 'second',
        'another' => 'thing',
      ),
    ),
    'contents' => 
    array (
      'dir' => 
      array (
        0 => 
        array (
          'attribs' => 
          array (
            'name' => 'blah',
          ),
          'dir' => 
          array (
            'attribs' => 
            array (
              'name' => 'two',
            ),
            'dir' => 
            array (
              'attribs' => 
              array (
                'name' => 'three',
              ),
              'file' => 
              array (
                'attribs' => 
                array (
                  'name' => 'my',
                ),
              ),
            ),
          ),
        ),
        1 => 
        array (
          'attribs' => 
          array (
            'name' => 'four',
          ),
          'file' => 
          array (
            'attribs' => 
            array (
              'name' => 'my2',
            ),
          ),
        ),
      ),
    ),
  ),
));
$test->assertEquals('<?xml version="1.0" encoding="UTF-8"?>
<package>
 <lead>
  <name>test</name>
  <another>tag</another>
 </lead>
 <lead>
  <name>second</name>
  <another>thing</another>
 </lead>
 <contents>
  <dir name="blah">
   <dir name="two">
    <dir name="three">
     <file name="my"/>
    </dir>
   </dir>
  </dir>
  <dir name="four">
   <file name="my2"/>
  </dir>
 </contents>
</package>', (string) $write, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Pyrus XMLWriter: child tag + content
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$write = new $xmlwriter(array(
  'a' =>
  array(
    'b' => '',
    '_content' => 'hi',
  ),
));
$test->assertEquals('<?xml version="1.0" encoding="UTF-8"?>
<a>
 <b/>hi
</a>', (string) $write, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Pyrus XMLWriter: empty xml
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$write = new $xmlwriter(array('a' => ''));
$test->assertEquals('<?xml version="1.0" encoding="UTF-8"?>
<a/>', (string) $write, 'test');
?>
===DONE===
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
// for easy move to namespaces
$xmlwriter = 'PEAR2_Pyrus_XMLWriter';
--TEST--
Pyrus XMLWriter: child tag
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$write = new $xmlwriter(array(
  'a' =>
  array(
    'b' => '',
  ),
));
$test->assertEquals('<?xml version="1.0" encoding="UTF-8"?>
<a>
 <b/>
</a>', (string) $write, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Pyrus XMLWriter: attributes + content
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';

$write = new $xmlwriter(array(
  'a' =>
  array(
    'attribs' =>
    array(
      'one' => 'two',
    ),
    '_content' => 'hi',
  ),
));
$test->assertEquals('<?xml version="1.0" encoding="UTF-8"?>
<a one="two">hi</a>', (string) $write, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Pyrus XMLWriter: sibling tags
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$write = new $xmlwriter(array(
  'a' =>
  array(
    'b' => array('', ''),
  ),
));
$test->assertEquals('<?xml version="1.0" encoding="UTF-8"?>
<a>
 <b></b>
 <b/>
</a>', (string) $write, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: validate downloaded package, simple case
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$test->assertEquals(true, $validator->validateDownloadedPackage($fake, array($fake)), 'foo');
$test->assertEquals(0, count($errs), 'foo count');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: validate downloaded package, failure, optional dep not satisfied
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$reg = PEAR2_Pyrus_Config::current()->registry;

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
$fake->dependencies['optional']->package['pear2.php.net/test']->min('1.2.4');

$reg->install($fake);

$fake->name = 'test';

$test->assertEquals(false, $validator->validateDownloadedPackage($fake, array($fake)), 'foo');
$test->assertEquals(2, count($errs->E_ERROR), 'foo count');
$test->assertEquals(2, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/foo requires package "channel://pear2.php.net/test" (version >= 1.2.4), downloaded version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo message 1');
$test->assertEquals('channel://pear2.php.net/test cannot be installed, conflicts with installed packages', $errs->E_ERROR[1]->getMessage(), 'foo message 2');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: validate downloaded package, simple case, optionally depends
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$reg = PEAR2_Pyrus_Config::current()->registry;

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'test';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
$fake->dependencies['optional']->package['pear2.php.net/foo']->save();

$reg->install($fake);

$fake->name = 'foo';

$test->assertEquals(true, $validator->validateDownloadedPackage($fake, array($fake)), 'foo');
$test->assertEquals(0, count($errs), 'foo count');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: validate downloaded package, simple case, required depends
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$reg = PEAR2_Pyrus_Config::current()->registry;

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'test';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
$fake->dependencies['required']->package['pear2.php.net/foo']->save();

$reg->install($fake);

$fake->name = 'foo';

$test->assertEquals(true, $validator->validateDownloadedPackage($fake, array($fake)), 'foo');
$test->assertEquals(0, count($errs), 'foo count');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: validate downloaded subpackage, simple case, optionally depends
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$reg = PEAR2_Pyrus_Config::current()->registry;

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'test';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
$fake->dependencies['optional']->subpackage['pear2.php.net/foo']->save();

$reg->install($fake);

$fake->name = 'foo';

$test->assertEquals(true, $validator->validateDownloadedPackage($fake, array($fake)), 'foo');
$test->assertEquals(0, count($errs), 'foo count');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: validate downloaded package, would fail, but new downloaded version passes
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$reg = PEAR2_Pyrus_Config::current()->registry;

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
$fake->dependencies['optional']->package['pear2.php.net/test']->min('1.2.4');

$reg->install($fake);

$foo = clone $fake;
$fake->name = 'test';
PEAR2_Pyrus_Log::$log = array();
$test->assertEquals(true, $validator->validateDownloadedPackage($fake, array($fake, $foo)), 'foo');
$test->assertEquals(0, count($errs), 'foo count');
$test->assertEquals(array('skipping installed package check of "channel://pear2.php.net/foo", version "1.2.3" will be downloaded and installed'), PEAR2_Pyrus_Log::$log[3], 'log');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: validate downloaded subpackage, simple case, required depends
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$reg = PEAR2_Pyrus_Config::current()->registry;

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'test';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
$fake->dependencies['required']->subpackage['pear2.php.net/foo']->save();

$reg->install($fake);

$fake->name = 'foo';

$test->assertEquals(true, $validator->validateDownloadedPackage($fake, array($fake)), 'foo');
$test->assertEquals(0, count($errs), 'foo count');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, conflicts, installed failure
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->conflicts(true);

$test->assertEquals(false, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, PEAR2_Pyrus_Validate::DOWNLOADING, $errs);

PEAR2_Pyrus_Config::current()->registry->uninstall('foo', 'pear2.php.net');

$test->assertEquals(false, $validator->validateSubpackageDependency($foo, array($fake)), 'foo downloading');
$test->assertEquals(1, count($errs->E_ERROR), 'foo downloading count');
$test->assertEquals(1, count($errs), 'foo downloading count 2');
$test->assertEquals('channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo", downloaded version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo downloading error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, no version, installed failure --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo'];

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test requires package "channel://pear2.php.net/foo"', $errs->E_WARNING[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$foo = $fake->dependencies['optional']->subpackage['pear2.php.net/foo'];

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo optional');
$test->assertEquals(1, count($errs->E_WARNING), 'foo optional count');
$test->assertEquals(1, count($errs), 'foo optional count 2');
$test->assertEquals('channel://pear2.php.net/test can optionally use package "channel://pear2.php.net/foo"', $errs->E_WARNING[0]->getMessage(), 'foo optional error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, installed max fail --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->max('1.2.2');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version <= 1.2.2), installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, installed failure --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->min('1.2.0');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version >= 1.2.0)', $errs->E_WARNING[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$foo = $fake->dependencies['optional']->subpackage['pear2.php.net/foo']->min('1.2.0');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo optional');
$test->assertEquals(1, count($errs->E_WARNING), 'foo optional count');
$test->assertEquals(1, count($errs), 'foo optional count 2');
$test->assertEquals('channel://pear2.php.net/test can optionally use package "channel://pear2.php.net/foo" (version >= 1.2.0)', $errs->E_WARNING[0]->getMessage(), 'foo optional error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, version valid bounds
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->min('1.0.0')->max('1.2.3')->providesextension('foo');
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo max');
$test->assertEquals(0, count($errs), 'foo count max');

$fake->version['release'] = '1.0.0';
PEAR2_Pyrus_Config::current()->registry->replace($fake);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo min');
$test->assertEquals(0, count($errs), 'foo count min');

$foo->recommended('1.0.0');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo recommended');
$test->assertEquals(0, count($errs), 'foo count recommended');

$foo->exclude('1.2.0');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');

$foo->exclude = null;
$foo->exclude('1.0.0')->exclude('1.4.5')->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo conflicts with exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, installed recommended version fail --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->recommended('1.2.2');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test dependency package "channel://pear2.php.net/foo" installed version 1.2.3 is not the recommended version 1.2.2', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, conflicts, installed min fail --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->min('1.2.2')->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo" (version >= 1.2.2), installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, conflicts, installed exclude fail --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->exclude('1.2.0')->exclude('1.2.1')->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test is not compatible with version 1.2.3 of package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, conflicts, installed max fail --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->max('1.2.4')->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo" (version <= 1.2.4), installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, conflicts, installed failure --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, PEAR2_Pyrus_Validate::DOWNLOADING, $errs);

PEAR2_Pyrus_Config::current()->registry->uninstall('foo', 'pear2.php.net');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array($fake)), 'foo downloading');
$test->assertEquals(1, count($errs->E_WARNING), 'foo downloading count');
$test->assertEquals(1, count($errs), 'foo downloading count 2');
$test->assertEquals('warning: channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo", downloaded version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo downloading error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, conflicts, installed exclude fail
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->exclude('1.2.0')->exclude('1.2.1')->conflicts(true);

$test->assertEquals(false, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test is not compatible with version 1.2.3 of package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, installed min fail
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->min('1.2.4');

$test->assertEquals(false, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version >= 1.2.4), installed version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, conflicts, installed max pass
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->max('1.2.0')->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(0, count($errs->E_WARNING), 'foo count');
$test->assertEquals(0, count($errs), 'foo count 2');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, installed recommended version
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$validator = new test_Validator($package, PEAR2_Pyrus_Validate::DOWNLOADING, $errs);

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
$fake->compatible['pear2.php.net/test']->min('1.2.2')->max('1.2.3');
PEAR2_Pyrus_Config::current()->registry->install($fake);

$fake->name = 'test';

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->recommended('1.2.2');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array($fake)), 'foo');
$test->assertEquals(0, count($errs), 'foo count');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, conflicts, installed min fail --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->min('1.2.2')->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo" (version >= 1.2.2), installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, conflicts, installed min fail
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->min('1.2.2')->conflicts(true);

$test->assertEquals(false, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo" (version >= 1.2.2), installed version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, installed exclude fail 
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->exclude('1.2.0')->exclude('1.2.3');

$test->assertEquals(false, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test is not compatible with version 1.2.3 of package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: PECL subpackage dependency, extension loaded, version valid bounds
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->subpackage['pecl.php.net/foo']->min('1.0.0')->max('1.2.3')->providesextension('foo');
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '1.2.3';

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo max');
$test->assertEquals(0, count($errs), 'foo count max');

$validator->versions['foo'] = '1.0.0';

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo min');
$test->assertEquals(0, count($errs), 'foo count min');

$foo->recommended('1.0.0');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo recommended');
$test->assertEquals(0, count($errs), 'foo count recommended');

$foo->exclude('1.2.0');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');

$foo->exclude = null;
$foo->exclude('1.0.0')->exclude('1.4.5')->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo conflicts with exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, conflicts, installed failure --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, PEAR2_Pyrus_Validate::DOWNLOADING, $errs);

PEAR2_Pyrus_Config::current()->registry->uninstall('foo', 'pear2.php.net');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array($fake)), 'foo downloading');
$test->assertEquals(1, count($errs->E_WARNING), 'foo downloading count');
$test->assertEquals(1, count($errs), 'foo downloading count 2');
$test->assertEquals('warning: channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo", downloaded version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo downloading error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, no version, installed
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->conflicts(true);


$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo conflicts');
$test->assertEquals(0, count($errs), 'foo conflicts count');

$foo->conflicts = false;

$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(0, count($errs), 'foo count');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Subpackage dependency, downloaded no version
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$validator = new test_Validator($package, PEAR2_Pyrus_Validate::DOWNLOADING, $errs);

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo'];

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array($fake)), 'foo');
$test->assertEquals(0, count($errs), 'foo count');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: PECL extension dependency, extension not loaded but downloaded, version valid bounds
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$validator = new test_Validator($package, PEAR2_Pyrus_Validate::DOWNLOADING, $errs);

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->subpackage['pecl.php.net/foo']->min('1.0.0')->max('1.2.3')->providesextension('foo');
$fake->name = 'foo';
$fake->channel = 'pecl.php.net';
$fake->version['release'] = '1.2.3';

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array($fake)), 'foo max');
$test->assertEquals(0, count($errs), 'foo count max');

$fake->version['release'] = '1.0.0';

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array($fake)), 'foo min');
$test->assertEquals(0, count($errs), 'foo count min');

$foo->recommended('1.0.0');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array($fake)), 'foo recommended');
$test->assertEquals(0, count($errs), 'foo count recommended');

$foo->exclude('1.2.0');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array($fake)), 'foo exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');

$foo->exclude = null;
$foo->exclude('1.0.0')->exclude('1.4.5')->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array($fake)), 'foo conflicts with exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, installed max fail
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->max('1.2.2');

$test->assertEquals(false, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version <= 1.2.2), installed version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: PECL extension dependency, extension not loaded but installed, version valid bounds
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$validator = new test_Validator($package, PEAR2_Pyrus_Validate::DOWNLOADING, $errs);

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->subpackage['pecl.php.net/foo']->min('1.0.0')->max('1.2.3')->providesextension('foo');
$fake->name = 'foo';
$fake->channel = 'pecl.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'src');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
$fake->type = 'extsrc';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo max');
$test->assertEquals(0, count($errs), 'foo count max');

$fake->version['release'] = '1.0.0';
PEAR2_Pyrus_Config::current()->registry->replace($fake);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo min');
$test->assertEquals(0, count($errs), 'foo count min');

$foo->recommended('1.0.0');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo recommended');
$test->assertEquals(0, count($errs), 'foo count recommended');

$foo->exclude('1.2.0');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');

$foo->exclude = null;
$foo->exclude('1.0.0')->exclude('1.4.5')->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo conflicts with exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, installed recommended version fail --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->recommended('1.2.2');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test dependency package "channel://pear2.php.net/foo" installed version 1.2.3 is not the recommended version 1.2.2', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, conflicts, installed max fail
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->max('1.2.4')->conflicts(true);

$test->assertEquals(false, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo" (version <= 1.2.4), installed version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, installed min fail --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->min('1.2.4');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version >= 1.2.4), installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, installed exclude fail --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->exclude('1.2.0')->exclude('1.2.3');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test is not compatible with version 1.2.3 of package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, no version, installed failure --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo'];

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test requires package "channel://pear2.php.net/foo"', $errs->E_WARNING[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$foo = $fake->dependencies['optional']->subpackage['pear2.php.net/foo'];

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo optional');
$test->assertEquals(1, count($errs->E_WARNING), 'foo optional count');
$test->assertEquals(1, count($errs), 'foo optional count 2');
$test->assertEquals('channel://pear2.php.net/test can optionally use package "channel://pear2.php.net/foo"', $errs->E_WARNING[0]->getMessage(), 'foo optional error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, installed exclude fail --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->exclude('1.2.0')->exclude('1.2.3');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test is not compatible with version 1.2.3 of package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, conflicts, installed max fail --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->max('1.2.4')->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo" (version <= 1.2.4), installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, no version, installed failure
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo'];

$test->assertEquals(false, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test requires package "channel://pear2.php.net/foo"', $errs->E_ERROR[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$foo = $fake->dependencies['optional']->subpackage['pear2.php.net/foo'];

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo optional');
$test->assertEquals(1, count($errs->E_WARNING), 'foo optional count');
$test->assertEquals(1, count($errs), 'foo optional count 2');
$test->assertEquals('channel://pear2.php.net/test can optionally use package "channel://pear2.php.net/foo"', $errs->E_WARNING[0]->getMessage(), 'foo optional error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, installed min fail --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);


$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->min('1.2.4');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version >= 1.2.4), installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, conflicts, installed min pass
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->min('1.3.0')->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(0, count($errs->E_WARNING), 'foo count');
$test->assertEquals(0, count($errs), 'foo count 2');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, conflicts, installed exclude fail --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->exclude('1.2.0')->exclude('1.2.1')->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test is not compatible with version 1.2.3 of package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, installed max fail --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->max('1.2.2');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version <= 1.2.2), installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, conflicts, not installed
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->min('1.2.0')->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(0, count($errs->E_WARNING), 'foo count');
$test->assertEquals(0, count($errs), 'foo count 2');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, installed recommended version fail
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->recommended('1.2.2');

$test->assertEquals(false, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test dependency package "channel://pear2.php.net/foo" installed version 1.2.3 is not the recommended version 1.2.2, but may be compatible, use --force to install', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, installed failure --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->min('1.2.0');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version >= 1.2.0)', $errs->E_WARNING[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$foo = $fake->dependencies['optional']->subpackage['pear2.php.net/foo']->min('1.2.0');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo optional');
$test->assertEquals(1, count($errs->E_WARNING), 'foo optional count');
$test->assertEquals(1, count($errs), 'foo optional count 2');
$test->assertEquals('channel://pear2.php.net/test can optionally use package "channel://pear2.php.net/foo" (version >= 1.2.0)', $errs->E_WARNING[0]->getMessage(), 'foo optional error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Subpackage dependency, downloaded version valid bounds
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$validator = new test_Validator($package, PEAR2_Pyrus_Validate::DOWNLOADING, $errs);

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->min('1.0.0')->max('1.2.3');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array($fake)), 'foo max');
$test->assertEquals(0, count($errs), 'foo count max');

$fake->version['release'] = '1.0.0';

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array($fake)), 'foo min');
$test->assertEquals(0, count($errs), 'foo count min');

$foo->recommended('1.0.0');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array($fake)), 'foo recommended');
$test->assertEquals(0, count($errs), 'foo count recommended');

$foo->exclude('1.2.0');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array($fake)), 'foo exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');

$foo->exclude = null;
$foo->exclude('1.0.0')->exclude('1.4.5')->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array($fake)), 'foo conflicts with exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, installed failure
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->min('1.2.0');

$test->assertEquals(false, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version >= 1.2.0)', $errs->E_ERROR[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$foo = $fake->dependencies['optional']->subpackage['pear2.php.net/foo']->min('1.2.0');

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo optional');
$test->assertEquals(1, count($errs->E_WARNING), 'foo optional count');
$test->assertEquals(1, count($errs), 'foo optional count 2');
$test->assertEquals('channel://pear2.php.net/test can optionally use package "channel://pear2.php.net/foo" (version >= 1.2.0)', $errs->E_WARNING[0]->getMessage(), 'foo optional error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: subpackage dependency, conflicts, installed exclude pass
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->subpackage['pear2.php.net/foo']->exclude('1.2.0')->exclude('1.2.3')->min('1.2.0')->conflicts(true);

$test->assertEquals(true, $validator->validateSubpackageDependency($foo, array()), 'foo');
$test->assertEquals(0, count($errs->E_WARNING), 'foo count');
$test->assertEquals(0, count($errs), 'foo count 2');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Pear installer dependency
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$pear = $fake->dependencies['required']->pearinstaller;
$pear->min('5.3.0')->max('5.4.0')->exclude('5.3.1');
$validator->pearversion = '5.3.0';
$test->assertEquals(true, $validator->validatePearinstallerDependency($pear), '5.3.0');

$validator->pearversion = '5.4.0';
$test->assertEquals(true, $validator->validatePearinstallerDependency($pear), '5.4.0');

$validator->pearversion = '5.2.9';
$test->assertEquals(false, $validator->validatePearinstallerDependency($pear), '5.2.9 fail');
$test->assertEquals(1, count($errs->E_ERROR), '5.2.9 fail count');
$test->assertEquals(1, count($errs), '5.2.9 fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test requires PEAR Installer ' .
                        '(version >= 5.3.0, version <= 5.4.0, excluded versions: 5.3.1)' .
                        ', installed version is 5.2.9', $error->getMessage(),
                        '5.2.9 fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$validator->pearversion = '5.4.1';
$test->assertEquals(false, $validator->validatePearinstallerDependency($pear), '5.4.1 fail');
$test->assertEquals(1, count($errs->E_ERROR), '5.4.1 fail count');
$test->assertEquals(1, count($errs), '5.4.1 fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test requires PEAR Installer ' .
                        '(version >= 5.3.0, version <= 5.4.0, excluded versions: 5.3.1)' .
                        ', installed version is 5.4.1', $error->getMessage(),
                        '5.4.1 fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$validator->pearversion = '5.3.1';
$test->assertEquals(false, $validator->validatePearinstallerDependency($pear), '5.3.1 fail');
$test->assertEquals(1, count($errs->E_ERROR), '5.3.1 fail count');
$test->assertEquals(1, count($errs), '5.3.1 fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test is not compatible with PEAR Installer version 5.3.1', $error->getMessage(),
                        '5.3.1 fail message');
}

PEAR2_Pyrus_Installer::$options = array('force' => true);

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$validator->pearversion = '5.2.9';
$test->assertEquals(true, $validator->validatePearinstallerDependency($pear), '5.2.9 fail');
$test->assertEquals(1, count($errs->E_WARNING), '5.2.9 fail count');
$test->assertEquals(1, count($errs), '5.2.9 fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test requires PEAR Installer ' .
                        '(version >= 5.3.0, version <= 5.4.0, excluded versions: 5.3.1)' .
                        ', installed version is 5.2.9', $error->getMessage(),
                        '5.2.9 fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$validator->pearversion = '5.4.1';
$test->assertEquals(true, $validator->validatePearinstallerDependency($pear), '5.4.1 fail');
$test->assertEquals(1, count($errs->E_WARNING), '5.4.1 fail count');
$test->assertEquals(1, count($errs), '5.4.1 fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test requires PEAR Installer ' .
                        '(version >= 5.3.0, version <= 5.4.0, excluded versions: 5.3.1)' .
                        ', installed version is 5.4.1', $error->getMessage(),
                        '5.4.1 fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$validator->pearversion = '5.3.1';
$test->assertEquals(true, $validator->validatePearinstallerDependency($pear), '5.3.1 fail');
$test->assertEquals(1, count($errs->E_WARNING), '5.3.1 fail count');
$test->assertEquals(1, count($errs), '5.3.1 fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test is not compatible with PEAR Installer version 5.3.1', $error->getMessage(),
                        '5.3.1 fail message');
}

?>
===DONE===
--EXPECT--
===DONE===<?php
class test_Validator extends PEAR2_Pyrus_Dependency_Validator
{
    public $os = 'linux';
    public $sysname = 'linux';
    public $patterns = array();
    public $extensions = array();
    public $versions = array();
    public $phpversion = '5.3.0';
    public $pearversion = '2.0.0';

    /**
     * This makes unit-testing a heck of a lot easier
     */
    function getPHP_OS()
    {
        return $this->os;
    }

    /**
     * This makes unit-testing a heck of a lot easier
     */
    function getsysname()
    {
        return $this->sysname;
    }

    /**
     * This makes unit-testing a heck of a lot easier
     */
    function matchSignature($pattern)
    {
        if (isset($this->patterns[$pattern])) {
            return true;
        }
        return false;
    }

    /**
     * This makes unit-testing a heck of a lot easier
     */
    function extension_loaded($name)
    {
        return isset($this->extensions[$name]);
    }

    /**
     * This makes unit-testing a heck of a lot easier
     */
    function phpversion($name = null)
    {
        if ($name !== null) {
            if (!isset($this->versions[$name])) {
                return null;
            }
            return $this->versions[$name];
        } else {
            return $this->phpversion;
        }
    }

    /**
     * This makes unit-testing a heck of a lot easier
     */
    function getPEARVersion()
    {
        return $this->pearversion;
    }
}--TEST--
Dependency_Validator: package dependency, installed exclude fail --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->exclude('1.2.0')->exclude('1.2.3');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test is not compatible with version 1.2.3 of package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, no version, installed failure --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->package['pear2.php.net/foo'];

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test requires package "channel://pear2.php.net/foo"', $errs->E_WARNING[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$foo = $fake->dependencies['optional']->package['pear2.php.net/foo'];

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo optional');
$test->assertEquals(1, count($errs->E_WARNING), 'foo optional count');
$test->assertEquals(1, count($errs), 'foo optional count 2');
$test->assertEquals('channel://pear2.php.net/test can optionally use package "channel://pear2.php.net/foo"', $errs->E_WARNING[0]->getMessage(), 'foo optional error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, conflicts, installed exclude fail --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->exclude('1.2.0')->exclude('1.2.1')->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test is not compatible with version 1.2.3 of package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, conflicts, installed max pass
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->max('1.2.0')->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(0, count($errs->E_WARNING), 'foo count');
$test->assertEquals(0, count($errs), 'foo count 2');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: PECL package dependency, extension loaded, version valid bounds
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->package['pecl.php.net/foo']->min('1.0.0')->max('1.2.3')->providesextension('foo');
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '1.2.3';

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo max');
$test->assertEquals(0, count($errs), 'foo count max');

$validator->versions['foo'] = '1.0.0';

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo min');
$test->assertEquals(0, count($errs), 'foo count min');

$foo->recommended('1.0.0');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo recommended');
$test->assertEquals(0, count($errs), 'foo count recommended');

$foo->exclude('1.2.0');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');

$foo->exclude = null;
$foo->exclude('1.0.0')->exclude('1.4.5')->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo conflicts with exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, conflicts, installed min fail --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.2.2')->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo" (version >= 1.2.2), installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, no version, installed
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->conflicts(true);


$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo conflicts');
$test->assertEquals(0, count($errs), 'foo conflicts count');

$foo->conflicts = false;

$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(0, count($errs), 'foo count');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, conflicts, installed min pass
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.3.0')->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(0, count($errs->E_WARNING), 'foo count');
$test->assertEquals(0, count($errs), 'foo count 2');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, installed min fail --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.2.4');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version >= 1.2.4), installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, conflicts, installed failure --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, PEAR2_Pyrus_Validate::DOWNLOADING, $errs);

PEAR2_Pyrus_Config::current()->registry->uninstall('foo', 'pear2.php.net');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array($fake)), 'foo downloading');
$test->assertEquals(1, count($errs->E_WARNING), 'foo downloading count');
$test->assertEquals(1, count($errs), 'foo downloading count 2');
$test->assertEquals('warning: channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo", downloaded version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo downloading error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, conflicts, installed min fail --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.2.2')->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo" (version >= 1.2.2), installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, conflicts, installed failure --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, PEAR2_Pyrus_Validate::DOWNLOADING, $errs);

PEAR2_Pyrus_Config::current()->registry->uninstall('foo', 'pear2.php.net');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array($fake)), 'foo downloading');
$test->assertEquals(1, count($errs->E_WARNING), 'foo downloading count');
$test->assertEquals(1, count($errs), 'foo downloading count 2');
$test->assertEquals('warning: channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo", downloaded version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo downloading error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, conflicts, installed max fail
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->max('1.2.4')->conflicts(true);

$test->assertEquals(false, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo" (version <= 1.2.4), installed version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, installed min fail
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.2.4');

$test->assertEquals(false, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version >= 1.2.4), installed version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, version valid bounds
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.0.0')->max('1.2.3')->providesextension('foo');
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo max');
$test->assertEquals(0, count($errs), 'foo count max');

$fake->version['release'] = '1.0.0';
PEAR2_Pyrus_Config::current()->registry->replace($fake);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo min');
$test->assertEquals(0, count($errs), 'foo count min');

$foo->recommended('1.0.0');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo recommended');
$test->assertEquals(0, count($errs), 'foo count recommended');

$foo->exclude('1.2.0');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');

$foo->exclude = null;
$foo->exclude('1.0.0')->exclude('1.4.5')->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo conflicts with exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, installed max fail
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->max('1.2.2');

$test->assertEquals(false, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version <= 1.2.2), installed version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, conflicts, not installed
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.2.0')->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(0, count($errs->E_WARNING), 'foo count');
$test->assertEquals(0, count($errs), 'foo count 2');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, conflicts, installed min fail
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.2.2')->conflicts(true);

$test->assertEquals(false, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo" (version >= 1.2.2), installed version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, no version, installed failure --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->package['pear2.php.net/foo'];

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test requires package "channel://pear2.php.net/foo"', $errs->E_WARNING[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$foo = $fake->dependencies['optional']->package['pear2.php.net/foo'];

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo optional');
$test->assertEquals(1, count($errs->E_WARNING), 'foo optional count');
$test->assertEquals(1, count($errs), 'foo optional count 2');
$test->assertEquals('channel://pear2.php.net/test can optionally use package "channel://pear2.php.net/foo"', $errs->E_WARNING[0]->getMessage(), 'foo optional error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, conflicts, installed exclude pass
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->exclude('1.2.0')->exclude('1.2.3')->min('1.2.0')->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(0, count($errs->E_WARNING), 'foo count');
$test->assertEquals(0, count($errs), 'foo count 2');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, installed max fail --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->max('1.2.2');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version <= 1.2.2), installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, installed exclude fail 
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->exclude('1.2.0')->exclude('1.2.3');

$test->assertEquals(false, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test is not compatible with version 1.2.3 of package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, installed recommended version fail --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->recommended('1.2.2');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test dependency package "channel://pear2.php.net/foo" installed version 1.2.3 is not the recommended version 1.2.2', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Package dependency, downloaded version valid bounds
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$validator = new test_Validator($package, PEAR2_Pyrus_Validate::DOWNLOADING, $errs);

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.0.0')->max('1.2.3');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array($fake)), 'foo max');
$test->assertEquals(0, count($errs), 'foo count max');

$fake->version['release'] = '1.0.0';

$test->assertEquals(true, $validator->validatePackageDependency($foo, array($fake)), 'foo min');
$test->assertEquals(0, count($errs), 'foo count min');

$foo->recommended('1.0.0');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array($fake)), 'foo recommended');
$test->assertEquals(0, count($errs), 'foo count recommended');

$foo->exclude('1.2.0');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array($fake)), 'foo exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');

$foo->exclude = null;
$foo->exclude('1.0.0')->exclude('1.4.5')->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array($fake)), 'foo conflicts with exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, installed recommended version fail --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->recommended('1.2.2');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test dependency package "channel://pear2.php.net/foo" installed version 1.2.3 is not the recommended version 1.2.2', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: PECL extension dependency, extension not loaded but downloaded, version valid bounds
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$validator = new test_Validator($package, PEAR2_Pyrus_Validate::DOWNLOADING, $errs);

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->package['pecl.php.net/foo']->min('1.0.0')->max('1.2.3')->providesextension('foo');
$fake->name = 'foo';
$fake->channel = 'pecl.php.net';
$fake->version['release'] = '1.2.3';

$test->assertEquals(true, $validator->validatePackageDependency($foo, array($fake)), 'foo max');
$test->assertEquals(0, count($errs), 'foo count max');

$fake->version['release'] = '1.0.0';

$test->assertEquals(true, $validator->validatePackageDependency($foo, array($fake)), 'foo min');
$test->assertEquals(0, count($errs), 'foo count min');

$foo->recommended('1.0.0');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array($fake)), 'foo recommended');
$test->assertEquals(0, count($errs), 'foo count recommended');

$foo->exclude('1.2.0');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array($fake)), 'foo exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');

$foo->exclude = null;
$foo->exclude('1.0.0')->exclude('1.4.5')->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array($fake)), 'foo conflicts with exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, installed min fail --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);


$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.2.4');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version >= 1.2.4), installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, installed recommended version fail
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->recommended('1.2.2');

$test->assertEquals(false, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test dependency package "channel://pear2.php.net/foo" installed version 1.2.3 is not the recommended version 1.2.2, but may be compatible, use --force to install', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, installed failure --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.2.0');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version >= 1.2.0)', $errs->E_WARNING[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$foo = $fake->dependencies['optional']->package['pear2.php.net/foo']->min('1.2.0');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo optional');
$test->assertEquals(1, count($errs->E_WARNING), 'foo optional count');
$test->assertEquals(1, count($errs), 'foo optional count 2');
$test->assertEquals('channel://pear2.php.net/test can optionally use package "channel://pear2.php.net/foo" (version >= 1.2.0)', $errs->E_WARNING[0]->getMessage(), 'foo optional error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, conflicts, installed exclude fail
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->exclude('1.2.0')->exclude('1.2.1')->conflicts(true);

$test->assertEquals(false, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test is not compatible with version 1.2.3 of package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Package dependency, downloaded no version
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$validator = new test_Validator($package, PEAR2_Pyrus_Validate::DOWNLOADING, $errs);

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$foo = $fake->dependencies['required']->package['pear2.php.net/foo'];

$test->assertEquals(true, $validator->validatePackageDependency($foo, array($fake)), 'foo');
$test->assertEquals(0, count($errs), 'foo count');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, installed exclude fail --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->exclude('1.2.0')->exclude('1.2.3');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test is not compatible with version 1.2.3 of package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, installed failure --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.2.0');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version >= 1.2.0)', $errs->E_WARNING[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$foo = $fake->dependencies['optional']->package['pear2.php.net/foo']->min('1.2.0');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo optional');
$test->assertEquals(1, count($errs->E_WARNING), 'foo optional count');
$test->assertEquals(1, count($errs), 'foo optional count 2');
$test->assertEquals('channel://pear2.php.net/test can optionally use package "channel://pear2.php.net/foo" (version >= 1.2.0)', $errs->E_WARNING[0]->getMessage(), 'foo optional error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: PECL extension dependency, extension not loaded but installed, version valid bounds
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$validator = new test_Validator($package, PEAR2_Pyrus_Validate::DOWNLOADING, $errs);

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->package['pecl.php.net/foo']->min('1.0.0')->max('1.2.3')->providesextension('foo');
$fake->name = 'foo';
$fake->channel = 'pecl.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'src');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
$fake->type = 'extsrc';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo max');
$test->assertEquals(0, count($errs), 'foo count max');

$fake->version['release'] = '1.0.0';
PEAR2_Pyrus_Config::current()->registry->replace($fake);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo min');
$test->assertEquals(0, count($errs), 'foo count min');

$foo->recommended('1.0.0');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo recommended');
$test->assertEquals(0, count($errs), 'foo count recommended');

$foo->exclude('1.2.0');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');

$foo->exclude = null;
$foo->exclude('1.0.0')->exclude('1.4.5')->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo conflicts with exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, conflicts, installed max fail --force
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->max('1.2.4')->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo" (version <= 1.2.4), installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, conflicts, installed exclude fail --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->exclude('1.2.0')->exclude('1.2.1')->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test is not compatible with version 1.2.3 of package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, installed recommended version
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$validator = new test_Validator($package, PEAR2_Pyrus_Validate::DOWNLOADING, $errs);

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
$fake->compatible['pear2.php.net/test']->min('1.2.2')->max('1.2.3');
PEAR2_Pyrus_Config::current()->registry->install($fake);

$fake->name = 'test';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->recommended('1.2.2');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array($fake)), 'foo');
$test->assertEquals(0, count($errs), 'foo count');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, installed max fail --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->max('1.2.2');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version <= 1.2.2), installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, no version, installed failure
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->package['pear2.php.net/foo'];

$test->assertEquals(false, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test requires package "channel://pear2.php.net/foo"', $errs->E_ERROR[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$foo = $fake->dependencies['optional']->package['pear2.php.net/foo'];

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo optional');
$test->assertEquals(1, count($errs->E_WARNING), 'foo optional count');
$test->assertEquals(1, count($errs), 'foo optional count 2');
$test->assertEquals('channel://pear2.php.net/test can optionally use package "channel://pear2.php.net/foo"', $errs->E_WARNING[0]->getMessage(), 'foo optional error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, installed failure
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.2.0');

$test->assertEquals(false, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test requires package "channel://pear2.php.net/foo" (version >= 1.2.0)', $errs->E_ERROR[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$foo = $fake->dependencies['optional']->package['pear2.php.net/foo']->min('1.2.0');

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo optional');
$test->assertEquals(1, count($errs->E_WARNING), 'foo optional count');
$test->assertEquals(1, count($errs), 'foo optional count 2');
$test->assertEquals('channel://pear2.php.net/test can optionally use package "channel://pear2.php.net/foo" (version >= 1.2.0)', $errs->E_WARNING[0]->getMessage(), 'foo optional error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, conflicts, installed failure
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->conflicts(true);

$test->assertEquals(false, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo", installed version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo error');

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, PEAR2_Pyrus_Validate::DOWNLOADING, $errs);

PEAR2_Pyrus_Config::current()->registry->uninstall('foo', 'pear2.php.net');

$test->assertEquals(false, $validator->validatePackageDependency($foo, array($fake)), 'foo downloading');
$test->assertEquals(1, count($errs->E_ERROR), 'foo downloading count');
$test->assertEquals(1, count($errs), 'foo downloading count 2');
$test->assertEquals('channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo", downloaded version is 1.2.3', $errs->E_ERROR[0]->getMessage(), 'foo downloading error');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: package dependency, conflicts, installed max fail --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.registry.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';
PEAR2_Pyrus_Config::current()->registry->install($fake);

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->max('1.2.4')->conflicts(true);

$test->assertEquals(true, $validator->validatePackageDependency($foo, array()), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/test conflicts with package "channel://pear2.php.net/foo" (version <= 1.2.4), installed version is 1.2.3', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, extension version, extension not loaded --force
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->min('1.0')->conflicts(true);
$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo');

$foo->conflicts = false;
$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo fail');
$test->assertEquals(1, count($errs->E_WARNING), 'foo fail count');
$test->assertEquals(1, count($errs), 'foo fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test requires PHP extension "foo" (version >= 1.0)', $error->getMessage(),
                        'foo fail message');
}

$foo = $fake->dependencies['optional']->extension['foo']->min('1.0');
// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo optional fail');
$test->assertEquals(1, count($errs->E_WARNING), 'foo optional fail count');
$test->assertEquals(1, count($errs), 'foo optional fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('channel://pear2.php.net/test can optionally use PHP extension "foo" (version >= 1.0)', $error->getMessage(),
                        'foo optional fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, no extension version --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo'];
$validator->extensions['foo'] = true;
$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo');

$foo->conflicts = true;
$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo conflicts fail');
$test->assertEquals(1, count($errs->E_WARNING), 'foo conflicts fail count');
$test->assertEquals(1, count($errs), 'foo conflicts fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test conflicts with PHP extension "foo"', $error->getMessage(),
                        'foo conflicts fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo conflicts');

$foo->conflicts = false;
$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo fail');
$test->assertEquals(1, count($errs->E_WARNING), 'foo fail count');
$test->assertEquals(1, count($errs), 'foo fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test requires PHP extension "foo"', $error->getMessage(),
                        'foo fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, max bounds failure --force
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->max('2.0.0');
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.2.3';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'basic fail');
$test->assertEquals(1, count($errs->E_WARNING), 'basic fail count');
$test->assertEquals(1, count($errs), 'basic fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test requires PHP extension "foo" (version <= 2.0.0), installed version is 2.2.3', $error->getMessage(),
                        'basic fail message');
}

$foo->conflicts(true);

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.0.0';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'conflicts fail');
$test->assertEquals(1, count($errs->E_WARNING), 'conflicts fail count');
$test->assertEquals(1, count($errs), 'conflicts fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test conflicts with PHP extension "foo" (version <= 2.0.0), installed version is 2.0.0', $error->getMessage(),
                        'conflicts fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, recommended failure --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->recommended('2.1.0');
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.0.0';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'basic fail');
$test->assertEquals(1, count($errs->E_WARNING), 'basic fail count');
$test->assertEquals(1, count($errs), 'basic fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test dependency: PHP extension foo version "2.0.0" is not the recommended version "2.1.0"', $error->getMessage(),
                        'basic fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, no extension version --force
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo'];
$validator->extensions['foo'] = true;
$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo');

$foo->conflicts = true;
$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo conflicts fail');
$test->assertEquals(1, count($errs->E_WARNING), 'foo conflicts fail count');
$test->assertEquals(1, count($errs), 'foo conflicts fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test conflicts with PHP extension "foo"', $error->getMessage(),
                        'foo conflicts fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo conflicts');

$foo->conflicts = false;
$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo fail');
$test->assertEquals(1, count($errs->E_WARNING), 'foo fail count');
$test->assertEquals(1, count($errs), 'foo fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test requires PHP extension "foo"', $error->getMessage(),
                        'foo fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, exclude failure --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->exclude('2.0.0');
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.0.0';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'basic fail');
$test->assertEquals(1, count($errs->E_WARNING), 'basic fail count');
$test->assertEquals(1, count($errs), 'basic fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test is not compatible with version 2.0.0 of PHP extension "foo", installed version is 2.0.0', $error->getMessage(),
                        'basic fail message');
}

$foo->conflicts(true);

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.0.1';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'conflicts fail');
$test->assertEquals(1, count($errs->E_WARNING), 'conflicts fail count');
$test->assertEquals(1, count($errs), 'conflicts fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test is not compatible with version 2.0.1 of PHP extension "foo", installed version is 2.0.1', $error->getMessage(),
                        'conflicts fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, min bounds failure --force
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->min('2.0.0');
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '1.2.3';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'basic fail');
$test->assertEquals(1, count($errs->E_WARNING), 'basic fail count');
$test->assertEquals(1, count($errs), 'basic fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test requires PHP extension "foo" (version >= 2.0.0), installed version is 1.2.3', $error->getMessage(),
                        'basic fail message');
}

$foo->conflicts(true);

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.0.0';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'conflicts fail');
$test->assertEquals(1, count($errs->E_WARNING), 'conflicts fail count');
$test->assertEquals(1, count($errs), 'conflicts fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test conflicts with PHP extension "foo" (version >= 2.0.0), installed version is 2.0.0', $error->getMessage(),
                        'conflicts fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, extension version, extension not loaded
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->min('1.0')->conflicts(true);
$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo');

$foo->conflicts = false;
$test->assertEquals(false, $validator->validateExtensionDependency($foo), 'foo fail');
$test->assertEquals(1, count($errs->E_ERROR), 'foo fail count');
$test->assertEquals(1, count($errs), 'foo fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test requires PHP extension "foo" (version >= 1.0)', $error->getMessage(),
                        'foo fail message');
}

$foo = $fake->dependencies['optional']->extension['foo']->min('1.0');
// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo optional fail');
$test->assertEquals(1, count($errs->E_WARNING), 'foo optional fail count');
$test->assertEquals(1, count($errs), 'foo optional fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('channel://pear2.php.net/test can optionally use PHP extension "foo" (version >= 1.0)', $error->getMessage(),
                        'foo optional fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, extension version, extension not loaded --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->min('1.0')->conflicts(true);
$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo');

$foo->conflicts = false;
$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo fail');
$test->assertEquals(1, count($errs->E_WARNING), 'foo fail count');
$test->assertEquals(1, count($errs), 'foo fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test requires PHP extension "foo" (version >= 1.0)', $error->getMessage(),
                        'foo fail message');
}

$foo = $fake->dependencies['optional']->extension['foo']->min('1.0');
// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo optional fail');
$test->assertEquals(1, count($errs->E_WARNING), 'foo optional fail count');
$test->assertEquals(1, count($errs), 'foo optional fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('channel://pear2.php.net/test can optionally use PHP extension "foo" (version >= 1.0)', $error->getMessage(),
                        'foo optional fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, exclude failure
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->exclude('2.0.0');
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.0.0';

$test->assertEquals(false, $validator->validateExtensionDependency($foo), 'basic fail');
$test->assertEquals(1, count($errs->E_ERROR), 'basic fail count');
$test->assertEquals(1, count($errs), 'basic fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test is not compatible with version 2.0.0 of PHP extension "foo", installed version is 2.0.0', $error->getMessage(),
                        'basic fail message');
}

$foo->conflicts(true);

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.0.1';

$test->assertEquals(false, $validator->validateExtensionDependency($foo), 'conflicts fail');
$test->assertEquals(1, count($errs->E_ERROR), 'conflicts fail count');
$test->assertEquals(1, count($errs), 'conflicts fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test is not compatible with version 2.0.1 of PHP extension "foo", installed version is 2.0.1', $error->getMessage(),
                        'conflicts fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, extension version valid bounds
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->min('1.0.0')->max('1.2.3');
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '1.2.3';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo max');
$test->assertEquals(0, count($errs), 'foo count max');

$validator->versions['foo'] = '1.0.0';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo min');
$test->assertEquals(0, count($errs), 'foo count min');

$foo->recommended('1.0.0');

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo recommended');
$test->assertEquals(0, count($errs), 'foo count recommended');

$foo->exclude('1.2.0');

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');

$foo->exclude = null;
$foo->exclude('1.0.0')->exclude('1.4.5')->conflicts(true);

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo conflicts with exclude');
$test->assertEquals(0, count($errs), 'foo count exclude');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, recommended failure --force
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->recommended('2.1.0');
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.0.0';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'basic fail');
$test->assertEquals(1, count($errs->E_WARNING), 'basic fail count');
$test->assertEquals(1, count($errs), 'basic fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test dependency: PHP extension foo version "2.0.0" is not the recommended version "2.1.0"', $error->getMessage(),
                        'basic fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, exclude failure --force
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->exclude('2.0.0');
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.0.0';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'basic fail');
$test->assertEquals(1, count($errs->E_WARNING), 'basic fail count');
$test->assertEquals(1, count($errs), 'basic fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test is not compatible with version 2.0.0 of PHP extension "foo", installed version is 2.0.0', $error->getMessage(),
                        'basic fail message');
}

$foo->conflicts(true);

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.0.1';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'conflicts fail');
$test->assertEquals(1, count($errs->E_WARNING), 'conflicts fail count');
$test->assertEquals(1, count($errs), 'conflicts fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test is not compatible with version 2.0.1 of PHP extension "foo", installed version is 2.0.1', $error->getMessage(),
                        'conflicts fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, min bounds failure
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->min('2.0.0');
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '1.2.3';

$test->assertEquals(false, $validator->validateExtensionDependency($foo), 'basic fail');
$test->assertEquals(1, count($errs->E_ERROR), 'basic fail count');
$test->assertEquals(1, count($errs), 'basic fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test requires PHP extension "foo" (version >= 2.0.0), installed version is 1.2.3', $error->getMessage(),
                        'basic fail message');
}

$foo->conflicts(true);

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.0.0';

$test->assertEquals(false, $validator->validateExtensionDependency($foo), 'conflicts fail');
$test->assertEquals(1, count($errs->E_ERROR), 'conflicts fail count');
$test->assertEquals(1, count($errs), 'conflicts fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test conflicts with PHP extension "foo" (version >= 2.0.0), installed version is 2.0.0', $error->getMessage(),
                        'conflicts fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, max bounds failure --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->max('2.0.0');
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.2.3';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'basic fail');
$test->assertEquals(1, count($errs->E_WARNING), 'basic fail count');
$test->assertEquals(1, count($errs), 'basic fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test requires PHP extension "foo" (version <= 2.0.0), installed version is 2.2.3', $error->getMessage(),
                        'basic fail message');
}

$foo->conflicts(true);

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.0.0';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'conflicts fail');
$test->assertEquals(1, count($errs->E_WARNING), 'conflicts fail count');
$test->assertEquals(1, count($errs), 'conflicts fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test conflicts with PHP extension "foo" (version <= 2.0.0), installed version is 2.0.0', $error->getMessage(),
                        'conflicts fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, no extension version
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo'];
$validator->extensions['foo'] = true;
$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo');

$foo->conflicts = true;
$test->assertEquals(false, $validator->validateExtensionDependency($foo), 'foo conflicts fail');
$test->assertEquals(1, count($errs->E_ERROR), 'foo conflicts fail count');
$test->assertEquals(1, count($errs), 'foo conflicts fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test conflicts with PHP extension "foo"', $error->getMessage(),
                        'foo conflicts fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo conflicts');

$foo->conflicts = false;
$test->assertEquals(false, $validator->validateExtensionDependency($foo), 'foo fail');
$test->assertEquals(1, count($errs->E_ERROR), 'foo fail count');
$test->assertEquals(1, count($errs), 'foo fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test requires PHP extension "foo"', $error->getMessage(),
                        'foo fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$foo = $fake->dependencies['optional']->extension['foo'];
$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'foo optional fail');
$test->assertEquals(1, count($errs->E_WARNING), 'foo fail count');
$test->assertEquals(1, count($errs), 'foo fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('channel://pear2.php.net/test can optionally use PHP extension "foo"', $error->getMessage(),
                        'foo optional fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, extension version, extension has no version
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->min('1.0');
$validator->extensions['foo'] = true;

$test->assertEquals(false, $validator->validateExtensionDependency($foo), 'foo fail');
$test->assertEquals(1, count($errs->E_ERROR), 'foo fail count');
$test->assertEquals(1, count($errs), 'foo fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test requires PHP extension "foo" (version >= 1.0), installed version is 0', $error->getMessage(),
                        'foo fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, min bounds failure --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->min('2.0.0');
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '1.2.3';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'basic fail');
$test->assertEquals(1, count($errs->E_WARNING), 'basic fail count');
$test->assertEquals(1, count($errs), 'basic fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test requires PHP extension "foo" (version >= 2.0.0), installed version is 1.2.3', $error->getMessage(),
                        'basic fail message');
}

$foo->conflicts(true);

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.0.0';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'conflicts fail');
$test->assertEquals(1, count($errs->E_WARNING), 'conflicts fail count');
$test->assertEquals(1, count($errs), 'conflicts fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test conflicts with PHP extension "foo" (version >= 2.0.0), installed version is 2.0.0', $error->getMessage(),
                        'conflicts fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, recommended failure
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->recommended('2.1.0');
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.0.0';

$test->assertEquals(false, $validator->validateExtensionDependency($foo), 'basic fail');
$test->assertEquals(1, count($errs->E_ERROR), 'basic fail count');
$test->assertEquals(1, count($errs), 'basic fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test dependency: PHP extension foo version "2.0.0" is not the recommended version "2.1.0", but may be compatible, use --force to install', $error->getMessage(),
                        'basic fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, not downloading or installing
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->exclude('2.0.0');

$validator = new test_Validator($package, PEAR2_Pyrus_Validate::UNINSTALLING, $errs);
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.0.1';

$test->assertEquals(true, $validator->validateExtensionDependency($foo), 'conflicts fail');
$test->assertEquals(0, count($errs), 'conflicts fail count 2');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: Extension dependency, max bounds failure
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$foo = $fake->dependencies['required']->extension['foo']->max('2.0.0');
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.2.3';

$test->assertEquals(false, $validator->validateExtensionDependency($foo), 'basic fail');
$test->assertEquals(1, count($errs->E_ERROR), 'basic fail count');
$test->assertEquals(1, count($errs), 'basic fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test requires PHP extension "foo" (version <= 2.0.0), installed version is 2.2.3', $error->getMessage(),
                        'basic fail message');
}

$foo->conflicts(true);

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$validator->extensions['foo'] = true;
$validator->versions['foo'] = '2.0.0';

$test->assertEquals(false, $validator->validateExtensionDependency($foo), 'conflicts fail');
$test->assertEquals(1, count($errs->E_ERROR), 'conflicts fail count');
$test->assertEquals(1, count($errs), 'conflicts fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test conflicts with PHP extension "foo" (version <= 2.0.0), installed version is 2.0.0', $error->getMessage(),
                        'conflicts fail message');
}
?>
===DONE===
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
require __DIR__ . '/validator.php.inc';
$errs = new PEAR2_MultiErrors;
if (!isset($state)) {
    $state = 'UNINSTALLING';
}
if (!isset($package)) {
    $package = array('channel' => 'pear2.php.net', 'package' => 'test');
}
switch ($state) {
    case 'INSTALLING' :
        $state = PEAR2_Pyrus_Validate::INSTALLING;
        break;
    case 'DOWNLOADING' :
        $state = PEAR2_Pyrus_Validate::DOWNLOADING;
        break;
    case 'UNINSTALLING' :
        $state = PEAR2_Pyrus_Validate::UNINSTALLING;
        break;
    case 'NORMAL' :
        $state = PEAR2_Pyrus_Validate::NORMAL;
        break;
    case 'PACKAGING' :
        $state = PEAR2_Pyrus_Validate::PACKAGING;
        break;
}
$validator = new test_Validator($package, $state, $errs);--TEST--
Dependency_Validator: OS dependency windows
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$fake = new PEAR2_Pyrus_PackageFile_v2;
$os = $fake->dependencies['required']->os;
$os->name = 'windows';
$validator->os = 'Windows XP';
$test->assertEquals(true, $validator->validateOSDependency($os), 'windows pass');

$os->conflicts = true;
$test->assertEquals(false, $validator->validateOSDependency($os), 'windows conflicts fail');
$test->assertEquals(1, count($errs->E_ERROR), 'windows conflicts fail count');
$test->assertEquals(1, count($errs), 'windows conflicts fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('Cannot install channel://pear2.php.net/test on Windows', $error->getMessage(),
                        'windows conflicts fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$validator->os = 'Linux';
$test->assertEquals(true, $validator->validateOSDependency($os), 'windows conflicts pass');

$os->conflicts = null;
$test->assertEquals(false, $validator->validateOSDependency($os), 'windows fail');
$test->assertEquals(1, count($errs->E_ERROR), 'windows fail count');
$test->assertEquals(1, count($errs), 'windows fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('Can only install channel://pear2.php.net/test on Windows', $error->getMessage(),
                        'windows fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: OS dependency windows --force
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
PEAR2_Pyrus_Installer::$options = array('force' => true);
$fake = new PEAR2_Pyrus_PackageFile_v2;
$os = $fake->dependencies['required']->os;
$os->name = 'windows';
$validator->os = 'Windows XP';
$test->assertEquals(true, $validator->validateOSDependency($os), 'windows pass');

$os->conflicts = true;
$test->assertEquals(true, $validator->validateOSDependency($os), 'windows conflicts fail');
$test->assertEquals(1, count($errs->E_WARNING), 'windows conflicts fail count');
$test->assertEquals(1, count($errs), 'windows conflicts fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: Cannot install channel://pear2.php.net/test on Windows', $error->getMessage(),
                        'windows conflicts fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$validator->os = 'Linux';
$test->assertEquals(true, $validator->validateOSDependency($os), 'windows conflicts pass');

$os->conflicts = false;
$test->assertEquals(true, $validator->validateOSDependency($os), 'windows fail');
$test->assertEquals(1, count($errs->E_WARNING), 'windows fail count');
$test->assertEquals(1, count($errs), 'windows fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: Can only install channel://pear2.php.net/test on Windows', $error->getMessage(),
                        'windows fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: OS dependency unix --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

PEAR2_Pyrus_Installer::$options = array('nodeps' => true);
$fake = new PEAR2_Pyrus_PackageFile_v2;
$os = $fake->dependencies['required']->os;
$os->name = 'unix';
$validator->os = $validator->sysname = 'Linux';
$test->assertEquals(true, $validator->validateOSDependency($os), 'unix pass');

$os->conflicts = true;
$test->assertEquals(true, $validator->validateOSDependency($os), 'unix conflicts fail');
$test->assertEquals(1, count($errs->E_WARNING), 'unix conflicts fail count');
$test->assertEquals(1, count($errs), 'unix conflicts fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: Cannot install channel://pear2.php.net/test on any Unix system', $error->getMessage(),
                        'unix conflicts fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$validator->os = $validator->sysname = 'Linux';
$os->name = 'linux';
$os->conflicts = null;
$test->assertEquals(true, $validator->validateOSDependency($os), 'linux pass');

$os->conflicts = true;
$test->assertEquals(true, $validator->validateOSDependency($os), 'linux conflicts fail');
$test->assertEquals(1, count($errs->E_WARNING), 'linux conflicts fail count');
$test->assertEquals(1, count($errs), 'linux conflicts fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: Cannot install channel://pear2.php.net/test on linux operating system', $error->getMessage(),
                        'linux conflicts fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$os->name = 'unix';
$os->conflicts = true;
$validator->os = $validator->sysname = 'Windows XP';
$test->assertEquals(true, $validator->validateOSDependency($os), 'unix conflicts pass');

$os->conflicts = null;
$test->assertEquals(true, $validator->validateOSDependency($os), 'unix fail');
$test->assertEquals(1, count($errs->E_WARNING), 'unix fail count');
$test->assertEquals(1, count($errs), 'unix fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: Can only install channel://pear2.php.net/test on a Unix system', $error->getMessage(),
                        'unix fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$os->name = 'linux';
$os->conflicts = true;
$validator->os = $validator->sysname = 'Windows XP';
$test->assertEquals(true, $validator->validateOSDependency($os), 'linux conflicts pass');

$os->conflicts = null;
$test->assertEquals(true, $validator->validateOSDependency($os), 'linux fail');
$test->assertEquals(1, count($errs->E_WARNING), 'linux fail count');
$test->assertEquals(1, count($errs), 'linux fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: Cannot install channel://pear2.php.net/test on Windows XP operating system, can only install on linux', $error->getMessage(),
                        'linux fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: OS dependency extra tidbits
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$os = $fake->dependencies['required']->os;
$os->name = '*';
$validator = new test_Validator($package, $state, $errs);
$validator->os = $validator->sysname = 'Linux';
$test->assertEquals(true, $validator->validateOSDependency($os), '* pass');

$os->name = 'windows';
$validator = new test_Validator($package, PEAR2_Pyrus_Validate::UNINSTALLING, $errs);
$validator->os = $validator->sysname = 'Linux';
// verify that we pass even with a conflict if we aren't installing or downloading
$test->assertEquals(true, $validator->validateOSDependency($os), 'UNINSTALLING');
$test->assertEquals(0, count($errs), 'UNINSTALLING count');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: OS dependency unix
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$os = $fake->dependencies['required']->os;
$os->name = 'unix';
$validator->os = $validator->sysname = 'Linux';
$test->assertEquals(true, $validator->validateOSDependency($os), 'unix pass');

$os->conflicts = true;
$test->assertEquals(false, $validator->validateOSDependency($os), 'unix conflicts fail');
$test->assertEquals(1, count($errs->E_ERROR), 'unix conflicts fail count');
$test->assertEquals(1, count($errs), 'unix conflicts fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('Cannot install channel://pear2.php.net/test on any Unix system', $error->getMessage(),
                        'unix conflicts fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$validator->os = $validator->sysname = 'Linux';
$os->name = 'linux';
$os->conflicts = null;
$test->assertEquals(true, $validator->validateOSDependency($os), 'linux pass');

$os->conflicts = true;
$test->assertEquals(false, $validator->validateOSDependency($os), 'linux conflicts fail');
$test->assertEquals(1, count($errs->E_ERROR), 'linux conflicts fail count');
$test->assertEquals(1, count($errs), 'linux conflicts fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('Cannot install channel://pear2.php.net/test on linux operating system', $error->getMessage(),
                        'linux conflicts fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$os->name = 'unix';
$os->conflicts = true;
$validator->os = $validator->sysname = 'Windows XP';
$test->assertEquals(true, $validator->validateOSDependency($os), 'unix conflicts pass');

$os->conflicts = null;
$test->assertEquals(false, $validator->validateOSDependency($os), 'unix fail');
$test->assertEquals(1, count($errs->E_ERROR), 'unix fail count');
$test->assertEquals(1, count($errs), 'unix fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('Can only install channel://pear2.php.net/test on a Unix system', $error->getMessage(),
                        'unix fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$os->name = 'linux';
$os->conflicts = true;
$validator->os = $validator->sysname = 'Windows XP';
$test->assertEquals(true, $validator->validateOSDependency($os), 'linux conflicts pass');

$os->conflicts = null;
$test->assertEquals(false, $validator->validateOSDependency($os), 'linux fail');
$test->assertEquals(1, count($errs->E_ERROR), 'linux fail count');
$test->assertEquals(1, count($errs), 'linux fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('Cannot install channel://pear2.php.net/test on Windows XP operating system, can only install on linux', $error->getMessage(),
                        'linux fail message');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: PHP dependency
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$php = $fake->dependencies['required']->php;
$php->min('5.3.0')->max('5.4.0')->exclude('5.3.1');
$test->assertEquals(true, $validator->validatePhpDependency($php), '5.3.0');

$validator->phpversion = '5.4.0';
$test->assertEquals(true, $validator->validatePhpDependency($php), '5.4.0');

$validator->phpversion = '5.2.9';
$test->assertEquals(false, $validator->validatePhpDependency($php), '5.2.9 fail');
$test->assertEquals(1, count($errs->E_ERROR), '5.2.9 fail count');
$test->assertEquals(1, count($errs), '5.2.9 fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test requires PHP ' .
                        '(version >= 5.3.0, version <= 5.4.0, excluded versions: 5.3.1)' .
                        ', installed version is 5.2.9', $error->getMessage(),
                        '5.2.9 fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$validator->phpversion = '5.4.1';
$test->assertEquals(false, $validator->validatePhpDependency($php), '5.4.1 fail');
$test->assertEquals(1, count($errs->E_ERROR), '5.4.1 fail count');
$test->assertEquals(1, count($errs), '5.4.1 fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test requires PHP ' .
                        '(version >= 5.3.0, version <= 5.4.0, excluded versions: 5.3.1)' .
                        ', installed version is 5.4.1', $error->getMessage(),
                        '5.4.1 fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$validator->phpversion = '5.3.1';
$test->assertEquals(false, $validator->validatePhpDependency($php), '5.3.1 fail');
$test->assertEquals(1, count($errs->E_ERROR), '5.3.1 fail count');
$test->assertEquals(1, count($errs), '5.3.1 fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test is not compatible with PHP version 5.3.1', $error->getMessage(),
                        '5.3.1 fail message');
}

PEAR2_Pyrus_Installer::$options = array('force' => true);

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$validator->phpversion = '5.2.9';
$test->assertEquals(true, $validator->validatePhpDependency($php), '5.2.9 fail');
$test->assertEquals(1, count($errs->E_WARNING), '5.2.9 fail count');
$test->assertEquals(1, count($errs), '5.2.9 fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test requires PHP ' .
                        '(version >= 5.3.0, version <= 5.4.0, excluded versions: 5.3.1)' .
                        ', installed version is 5.2.9', $error->getMessage(),
                        '5.2.9 fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$validator->phpversion = '5.4.1';
$test->assertEquals(true, $validator->validatePhpDependency($php), '5.4.1 fail');
$test->assertEquals(1, count($errs->E_WARNING), '5.4.1 fail count');
$test->assertEquals(1, count($errs), '5.4.1 fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test requires PHP ' .
                        '(version >= 5.3.0, version <= 5.4.0, excluded versions: 5.3.1)' .
                        ', installed version is 5.4.1', $error->getMessage(),
                        '5.4.1 fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);

$validator->phpversion = '5.3.1';
$test->assertEquals(true, $validator->validatePhpDependency($php), '5.3.1 fail');
$test->assertEquals(1, count($errs->E_WARNING), '5.3.1 fail count');
$test->assertEquals(1, count($errs), '5.3.1 fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test is not compatible with PHP version 5.3.1', $error->getMessage(),
                        '5.3.1 fail message');
}

// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, PEAR2_Pyrus_Validate::UNINSTALLING, $errs);

$validator->phpversion = '5.3.1';
$test->assertEquals(true, $validator->validatePhpDependency($php), 'UNINSTALLING should not fail on conflict');
$test->assertEquals(0, count($errs), 'UNINSTALLING fail count');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: arch dependency
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$arch = $fake->dependencies['required']->arch;
$arch->pattern = 'foobar';
$validator->patterns['foobar'] = true;
$test->assertEquals(true, $validator->validateArchDependency($arch), 'foobar pass');

$arch->conflicts = true;
$test->assertEquals(false, $validator->validateArchDependency($arch), 'foobar conflicts fail');
$test->assertEquals(1, count($errs->E_ERROR), 'foobar conflicts fail count');
$test->assertEquals(1, count($errs), 'foobar conflicts fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test Architecture dependency failed, cannot match ' .
                        '"foobar"', $error->getMessage(),
                        'foobar conflicts fail message');
}

PEAR2_Pyrus_Installer::$options = array('force' => true);
// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$arch->conflicts = false;
$test->assertEquals(true, $validator->validateArchDependency($arch), 'foobar pass force');

$arch->conflicts = true;
$test->assertEquals(true, $validator->validateArchDependency($arch), 'foobar conflicts fail force');
$test->assertEquals(1, count($errs->E_WARNING), 'foobar conflicts fail count');
$test->assertEquals(1, count($errs), 'foobar conflicts fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test Architecture dependency failed, does not ' .
                        'match "foobar"', $error->getMessage(),
                        'foobar conflicts fail message force');
}

PEAR2_Pyrus_Installer::$options = array();
// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$arch->conflicts = true;
$arch->pattern = 'barfoo';
$test->assertEquals(true, $validator->validateArchDependency($arch), 'barfoo conflicts pass');

$arch->conflicts = false;
$test->assertEquals(false, $validator->validateArchDependency($arch), 'barfoo fail');
$test->assertEquals(1, count($errs->E_ERROR), 'barfoo conflicts fail count');
$test->assertEquals(1, count($errs), 'barfoo conflicts fail count 2');
foreach ($errs->E_ERROR as $error) {
    $test->assertEquals('channel://pear2.php.net/test Architecture dependency failed, does not match ' .
                        '"barfoo"', $error->getMessage(),
                        'barfoo fail message');
}

PEAR2_Pyrus_Installer::$options = array('nodeps' => true);
// reset multierrors
$errs = new PEAR2_MultiErrors;
$validator = new test_Validator($package, $state, $errs);
$arch->conflicts = true;
$arch->pattern = 'barfoo';
$test->assertEquals(true, $validator->validateArchDependency($arch), 'barfoo conflicts pass nodeps');

$validator->patterns['barfoo'] = true;
$test->assertEquals(true, $validator->validateArchDependency($arch), 'barfoo fail nodeps');
$test->assertEquals(1, count($errs->E_WARNING), 'barfoo conflicts fail count');
$test->assertEquals(1, count($errs), 'barfoo conflicts fail count 2');
foreach ($errs->E_WARNING as $error) {
    $test->assertEquals('warning: channel://pear2.php.net/test Architecture dependency failed, cannot match ' .
                        '"barfoo"', $error->getMessage(),
                        'barfoo fail message nodeps');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Dependency_Validator: arch dependency extra tidbits
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$arch = $fake->dependencies['required']->arch;
$os->pattern = 'goo';
$validator = new test_Validator($package, PEAR2_Pyrus_Validate::UNINSTALLING, $errs);
// verify that we pass even with a conflict if we aren't installing or downloading
$test->assertEquals(true, $validator->validateArchDependency($os), 'UNINSTALLING');
$test->assertEquals(0, count($errs), 'UNINSTALLING count');

?>
===DONE===
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
require __DIR__ . '/validator.php.inc';
$errs = new PEAR2_MultiErrors;
if (!isset($state)) {
    $state = 'INSTALLING';
}
if (!isset($package)) {
    $package = array('channel' => 'pear2.php.net', 'package' => 'test');
}
switch ($state) {
    case 'INSTALLING' :
        $state = PEAR2_Pyrus_Validate::INSTALLING;
        break;
    case 'DOWNLOADING' :
        $state = PEAR2_Pyrus_Validate::DOWNLOADING;
        break;
    case 'UNINSTALLING' :
        $state = PEAR2_Pyrus_Validate::UNINSTALLING;
        break;
    case 'NORMAL' :
        $state = PEAR2_Pyrus_Validate::NORMAL;
        break;
    case 'PACKAGING' :
        $state = PEAR2_Pyrus_Validate::PACKAGING;
        break;
}
$validator = new test_Validator($package, $state, $errs);--TEST--
Dependency_Validator: uninstall package dependency, fail uninstall, max version failure
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->max('1.3.0');

$test->assertEquals(false, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/foo (version <= 1.3.0) is required by installed package "channel://pear2.php.net/test"', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, fail uninstall, exclude version failure --force
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->exclude('1.3.0');

$test->assertEquals(true, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/foo (excluded versions: 1.3.0) is required by installed package "channel://pear2.php.net/test"', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, no version conflict because of exclude, OK to uninstall
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.2.0')->max('1.3.0')->exclude('1.2.3');

$test->assertEquals(true, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(0, count($errs), 'foo count');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, optional dependency, OK to uninstall (2)
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['optional']->package['pear2.php.net/foo']->min('1.2.0');

$test->assertEquals(true, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/foo (version >= 1.2.0) can be optionally used by ' .
                        'installed package "channel://pear2.php.net/test"', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, fail uninstall, min version failure --force
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.2.0');

$test->assertEquals(true, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/foo (version >= 1.2.0) is required by installed package "channel://pear2.php.net/test"', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, required dependency failure
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo'];

$test->assertEquals(false, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('"channel://pear2.php.net/foo" is required by ' .
                        'installed package channel://pear2.php.net/test', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, fail uninstall, max version failure --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->max('1.3.0');

$test->assertEquals(true, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/foo (version <= 1.3.0) is required by installed package "channel://pear2.php.net/test"', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, no version conflict because of exclude, OK to uninstall (2)
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->exclude('1.2.3');

$test->assertEquals(true, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(0, count($errs), 'foo count');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, optional dependency, OK to uninstall
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['optional']->package['pear2.php.net/foo'];

$test->assertEquals(true, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('"channel://pear2.php.net/foo" can be optionally used by ' .
                        'installed package channel://pear2.php.net/test', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, required dependency failure --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo'];

$test->assertEquals(true, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: "channel://pear2.php.net/foo" is required by ' .
                        'installed package channel://pear2.php.net/test', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, fail uninstall, max version failure --force
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->max('1.3.0');

$test->assertEquals(true, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/foo (version <= 1.3.0) is required by installed package "channel://pear2.php.net/test"', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, fail uninstall, exclude version failure
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->exclude('1.3.0');

$test->assertEquals(false, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/foo (excluded versions: 1.3.0) is required by installed package "channel://pear2.php.net/test"', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, fail uninstall, exclude version failure --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->exclude('1.3.0');

$test->assertEquals(true, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/foo (excluded versions: 1.3.0) is required by installed package "channel://pear2.php.net/test"', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, fail uninstall, min version failure
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.2.0');

$test->assertEquals(false, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(1, count($errs->E_ERROR), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('channel://pear2.php.net/foo (version >= 1.2.0) is required by installed package "channel://pear2.php.net/test"', $errs->E_ERROR[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, fail uninstall, min version failure --nodeps
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

PEAR2_Pyrus_Installer::$options['nodeps'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.2.0');

$test->assertEquals(true, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: channel://pear2.php.net/foo (version >= 1.2.0) is required by installed package "channel://pear2.php.net/test"', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, required dependency failure --force
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

PEAR2_Pyrus_Installer::$options['force'] = true;
$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo'];

$test->assertEquals(true, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(1, count($errs->E_WARNING), 'foo count');
$test->assertEquals(1, count($errs), 'foo count 2');
$test->assertEquals('warning: "channel://pear2.php.net/foo" is required by ' .
                        'installed package channel://pear2.php.net/test', $errs->E_WARNING[0]->getMessage(), 'foo message');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, dep conflicts, OK to uninstall
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.2.0')->max('1.3.0')->conflicts(true);

$test->assertEquals(true, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(0, count($errs), 'foo count');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Dependency_Validator: uninstall package dependency, no version conflict, OK to uninstall
--FILE--
<?php
require __DIR__ . '/../setup.uninstall.php.inc';

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->name = 'foo';
$fake->channel = 'pear2.php.net';
$fake->version['release'] = '1.2.3';
$fake->files['foo'] = array('role' => 'php');
$fake->notes = 'hi';
$fake->summary = 'hi';
$fake->description = 'hi';

$foo = $fake->dependencies['required']->package['pear2.php.net/foo']->min('1.2.4')->max('1.3.0');

$test->assertEquals(true, $validator->validatePackageUninstall($foo, $fake, array($fake)), 'foo');
$test->assertEquals(0, count($errs), 'foo count');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/validator.php.inc';
$errs = new PEAR2_MultiErrors;
if (!isset($state)) {
    $state = 'INSTALLING';
}
if (!isset($package)) {
    $package = array('channel' => 'pear2.php.net', 'package' => 'test');
}
switch ($state) {
    case 'INSTALLING' :
        $state = PEAR2_Pyrus_Validate::INSTALLING;
        break;
    case 'DOWNLOADING' :
        $state = PEAR2_Pyrus_Validate::DOWNLOADING;
        break;
    case 'UNINSTALLING' :
        $state = PEAR2_Pyrus_Validate::UNINSTALLING;
        break;
    case 'NORMAL' :
        $state = PEAR2_Pyrus_Validate::NORMAL;
        break;
    case 'PACKAGING' :
        $state = PEAR2_Pyrus_Validate::PACKAGING;
        break;
}
$validator = new test_Validator($package, $state, $errs);--TEST--
Validate::validateVersion(), failure, version is 00.1.0 instead of 0.1.0, alpha
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing';
$pf->version['release'] = '00.1.0';
$pf->stability['release'] = 'alpha';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - version "00.1.0" should be "0.1.0"',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, alpha, version = 1.0.1
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing';
$pf->version['release'] = '1.0.1';
$pf->stability['release'] = 'alpha';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - bugfix versions (1.3.x where x > 0) probably should ' .
                    'not be alpha or beta',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, alpha, version = 0.3.4
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing';
$pf->version['release'] = '0.3.4';
$pf->stability['release'] = 'alpha';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(0, count($validate->getFailures()), 'failure count');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, alpha, version = 0.9.0RC1/beta1/b1/a1/alpha1
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing';
$pf->version['release'] = '1.0.0a1';
$pf->stability['release'] = 'stable';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');

$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - version "1.0.0a1" ' .
                    'or any RC/beta/alpha version cannot be stable',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message 1');

$pf->version['release'] = '1.0.0b1';
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 2');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - version "1.0.0b1" ' .
                    'or any RC/beta/alpha version cannot be stable',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message 2');

$pf->version['release'] = '1.0.0RC1';
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 3');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - version "1.0.0RC1" ' .
                    'or any RC/beta/alpha version cannot be stable',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message 3');

$pf->version['release'] = '1.0.0beta1';
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 4');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - version "1.0.0beta1" ' .
                    'or any RC/beta/alpha version cannot be stable',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message 4');

$pf->version['release'] = '1.0.0alpha1';
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 5');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - version "1.0.0alpha1" ' .
                    'or any RC/beta/alpha version cannot be stable',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message 5');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, alpha, version = 2.0.0
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing';
$pf->version['release'] = '2.0.0';
$pf->stability['release'] = 'alpha';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - major versions greater than 1 are not allowed for packages ' .
                    'without an <extends> tag or an identical postfix (foo2 v2.0.0)',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), valid snapshot version
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing';
$pf->version['release'] = '1.0.0b1-2009-05-10';
$pf->stability['release'] = 'snapshot';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(0, count($validate->getFailures()), 'failure count');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, extends, alpha, version = 2.0.1
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2';
$pf->extends = 'testing';
$pf->version['release'] = '2.0.1';
$pf->stability['release'] = 'alpha';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - bugfix versions (2.x.y where y > 0) should not be alpha or beta',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, extends, alpha, version = 00.1.0
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2';
$pf->extends = 'testing';
$pf->version['release'] = '00.1.0';
$pf->stability['release'] = 'alpha';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - version "00.1.0" should be "0.1.0"',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, extends, alpha, version = 2.0.0
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2';
$pf->extends = 'testing';
$pf->version['release'] = '2.0.0';
$pf->stability['release'] = 'alpha';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - version 2.0.0 probably should not be alpha or beta',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validatePackageName(), package extends another package, failure, stable
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2';
$pf->extends = 'testing';
$pf->version['release'] = '1.0.0';
$pf->stability['release'] = 'stable';
$pf->date = '2009-05-10';

$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(2, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "package" - package testing2 extends package testing and so the name ' .
                    'should have a postfix equal to the major version like "testing1"',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
$test->assertEquals('Channel validator error: field "version" - first version number "1' .
                    '" must match the postfix of ' .
                    'package name "testing2" (2)',
                    $validate->getFailures()->E_WARNING[1]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, extends, alpha, version = 0.1.0
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2';
$pf->extends = 'testing';
$pf->version['release'] = '0.1.0';
$pf->stability['release'] = 'alpha';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(0, count($validate->getFailures()), 'failure count');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, devel, version >= 1.0.0
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing';
$pf->version['release'] = '1.0.0';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - packages with devel stability must be < version 1.0.0',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, alpha, version = 0.9.0
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing';
$pf->version['release'] = '0.9.0';
$pf->stability['release'] = 'stable';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - versions less than 1.0.0 cannot be stable',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validatePackageName(), package extends another package
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2$';
$pf->version['release'] = '2.0.0';
$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);
$test->assertEquals(false, $validate->validatePackageName(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "package" - package name "testing2$" is invalid',
                    $validate->getFailures()->E_ERROR[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validatePackageName(), package extends another package
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2';
$pf->extends = 'testing';
$pf->version['release'] = '2.0.0';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);
$test->assertEquals(true, $validate->validatePackageName(), 'test 1');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, alpha, version = 1.0.000
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing';
$pf->version['release'] = '1.0.000';
$pf->stability['release'] = 'alpha';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - version 1.0.0 probably should not be alpha or beta',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, alpha, version = 1.0.0
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing';
$pf->version['release'] = '1.0.0';
$pf->stability['release'] = 'alpha';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - version 1.0.0 probably should not be alpha or beta',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, invalid version
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2';
$pf->version['release'] = '2.0.0#';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(false, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - Invalid version number "2.0.0#"',
                    $validate->getFailures()->E_ERROR[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, extends, alpha, version = 2.0.000
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2';
$pf->extends = 'testing';
$pf->version['release'] = '2.0.000';
$pf->stability['release'] = 'alpha';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - version 2.0.0 probably should not be alpha or beta',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, alpha, version = 1.0.0001
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing';
$pf->version['release'] = '1.0.0001';
$pf->stability['release'] = 'alpha';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - version 1.0.0001 probably should not be alpha or beta',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validatePackageName(), failure, stable 2.0.0, no extends
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2';
$pf->version['release'] = '2.0.0';
$pf->stability['release'] = 'stable';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - major version x in x.y.z may not be greater than' .
                    ' 1 for any package that does not have an <extends> tag',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, version is X.Y instead of X.Y.Z
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing';
$pf->version['release'] = '2.0';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - A version number should have 3 decimals (x.y.z)',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validPackageName()
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$validate = new PEAR2_Pyrus_Validate;
$test->assertEquals(false, $validate->validPackageName('55'), '55');
$test->assertEquals(true, $validate->validPackageName('55', '55'), '55 validate package name');
$test->assertEquals(false, $validate->validPackageName('5.5'), '5.5');
$test->assertEquals(true, $validate->validPackageName('5.5', '5.5'), '5.5 validate package name');
$test->assertEquals(0, count($validate->getFailures()), 'failure count');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validatePackageName(), package extends another package, failure
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2';
$pf->extends = 'testing';
$pf->version['release'] = '1.0.0';
$pf->stability['release'] = 'alpha';
$pf->date = '2009-05-10';

$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(2, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "package" - package testing2 extends package testing and so the name ' .
                    'should have a postfix equal to the major version like "testing1"',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
$test->assertEquals('Channel validator error: field "version" - first version number "1' .
                    '" must match the postfix of ' .
                    'package name "testing2" (2)',
                    $validate->getFailures()->E_WARNING[1]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
--TEST--
Validate::validatePackageName(), package extends another package, failure
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2';
$pf->extends = 'testing';
$pf->version['release'] = '1.0.0';

$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$test->assertEquals(true, $validate->validatePackageName(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "package" - package testing2 extends package testing and so the name ' .
                    'should have a postfix equal to the major version like "testing1"',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');

$validate = new PEAR2_Pyrus_Validate;
$pf->extends = 'oops';
$pf->version['release'] = '2.0.0';
$validate->setPackageFile($pf);
$test->assertEquals(true, $validate->validatePackageName(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "package" - package testing2 extends package oops and so the name ' .
                    'must be an extension like "oops2"',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message oops');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, alpha, version = 2.0.0a1
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2';
$pf->extends = 'testing';
$pf->version['release'] = '2.0.0a1';
$pf->stability['release'] = 'alpha';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(0, count($validate->getFailures()), 'failure count');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, version is 00.1.0 instead of 0.1.0
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing';
$pf->version['release'] = '00.1.0';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - version "00.1.0" should be "0.1.0"',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, extends, alpha, version = 2.0.0001
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2';
$pf->extends = 'testing';
$pf->version['release'] = '2.0.0001';
$pf->stability['release'] = 'alpha';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - version 2.0.0001 probably should not be alpha or beta',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), failure, packaging rc instead of RC
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2';
$pf->version['release'] = '1.0.0rc1';
$pf->stability['release'] = 'beta';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = date('Y-m-d');

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(false, $validate->validate(PEAR2_Pyrus_Validate::PACKAGING), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - Release Candidate versions ' .
                    'must have capital RC, not lower-case rc',
                    $validate->getFailures()->E_ERROR[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Validate::validateVersion(), valid beta version
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing';
$pf->version['release'] = '1.0.0b1';
$pf->stability['release'] = 'beta';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = '2009-05-10';

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validate;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(), 'test 1');
$test->assertEquals(0, count($validate->getFailures()), 'failure count');
?>
===DONE===
--EXPECT--
===DONE===hi
hi
hi
hi
<?xml version="1.0" encoding="UTF-8"?>
<channel version="1.0" xmlns="http://pear.php.net/channel-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/channel-1.0 http://pear.php.net/dtd/channel-1.0.xsd">
 <name>pear2.php.net</name>
 <suggestedalias>salty</suggestedalias>
 <summary>unit test channel</summary>
 <servers>
  <primary>
   <rest>
    <baseurl type="REST1.0">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.1">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.2">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.3">http://pear2.php.net/rest/</baseurl>
   </rest>
  </primary>
 </servers>
</channel>
<?php
/**
 * Test cascade of preferred stability to a package and its dependencies only
 *
 * P1-1.1.0RC1 beta -> P2
 * P1-1.0.0         -> P2
 *
 * P2-1.2.0a1 alpha
 * P2-1.1.0RC3 beta
 * P2-1.0.0
 *
 * P3-1.1.0RC1 beta
 * P3-1.1.0
 * P3-1.0.0         -> P2 <= 1.0.0
 *
 * Install of P1-beta and P3 should install
 *
 *  - P1-1.1.0RC1
 *  - P2-1.1.0RC3
 *  - P3-1.1.0
 */

require __DIR__ . '/../../../../../autoload.php';

set_include_path(__DIR__);
$c = PEAR2_Pyrus_Config::singleton(dirname(__DIR__), dirname(__DIR__) . '/pearconfig.xml');
$c->bin_dir = __DIR__ . '/bin';
restore_include_path();
$c->saveConfig();

$chan = new PEAR2_SimpleChannelServer_Channel('pear2.php.net', 'unit test channel');
$scs = new PEAR2_SimpleChannelServer($chan, __DIR__, dirname(__DIR__));

$scs->saveChannel();

$pf = new PEAR2_Pyrus_PackageFile_v2;

for ($i = 1; $i <= 3; $i++) {
    file_put_contents(__DIR__ . "/glooby$i", 'hi');
}

$pf->name = 'P1';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->version['release'] = '1.0.0';
$pf->stability['release'] = 'stable';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->date = '2008-10-03';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');

$pf->setPackagefile(__DIR__ . '/package.xml');
$save = clone $pf;

$pf->dependencies['required']->package['pear2.php.net/P2']->save();

$pf_beta = clone $pf;
$pf_beta->version['release'] = '1.1.0RC1';
$pf_beta->stability['release'] = 'beta';
$pf_beta->date = '2008-11-03';

$p2 = clone $save;
$p2->name = 'P2';
$p2beta = clone $p2;
$p2beta->date = '2008-11-03';
$p2beta->version['release'] = '1.1.0RC3';
$p2beta->stability['release'] = 'beta';
$p2alpha = clone $p2;
$p2alpha->date = '2008-12-03';
$p2alpha->version['release'] = '1.2.0a1';
$p2alpha->stability['release'] = 'alpha';

$p3 = clone $save;
$p3->name = 'P3';
$p3beta = clone $p3;
$p3beta->stability['release'] = 'beta';
$p3beta->version['release'] = '1.1.0RC1';
$p3beta->date = '2008-11-03';

$p32 = clone $p3;
$p32->version['release'] = '1.0.0';
$p3->version['release'] = '1.1.0';

$p32->dependencies['required']->package['pear2.php.net/P2']->max('1.0.0');

$pf->files['glooby1'] =  array('role' => 'php');
$pf_beta->files['glooby1'] =  array('role' => 'php');
$p2->files['glooby2'] = array('role' => 'php');
$p2beta->files['glooby2'] = array('role' => 'php');
$p2alpha->files['glooby2'] = array('role' => 'php');
$p3->files['glooby3'] = array('role' => 'php');
$p3beta->files['glooby3'] = array('role' => 'php');
$p32->files['glooby3'] = array('role' => 'php');

file_put_contents(__DIR__ . '/package.xml', $pf);

$package1 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package1, $xmlcontainer);
$package1->setInternalPackage($xml);
$package1->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package1, 'cellog');

$package2 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf_beta);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package2, $xmlcontainer);
$package2->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $pf_beta);
$package2->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package2, 'cellog');

$package2 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p2);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package2, $xmlcontainer);
$package2->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p2);
$package2->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package2, 'cellog');

$package2 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p2beta);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package2, $xmlcontainer);
$package2->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p2beta);
$package2->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package2, 'cellog');

$package2 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p2alpha);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package2, $xmlcontainer);
$package2->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p2alpha);
$package2->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package2, 'cellog');

$package3 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p32);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package3, $xmlcontainer);
$package3->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p32);
$package3->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package3, 'cellog');

$package3 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p3);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package3, $xmlcontainer);
$package3->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p3);
$package3->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package3, 'cellog');

$package3 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p3beta);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package3, $xmlcontainer);
$package3->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p3beta);
$package3->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package3, 'cellog');

// clean up
unlink(dirname(__DIR__) . '/pearconfig.xml');
unlink(dirname(__DIR__) . '/.config');
for ($i = 1; $i <= 3; $i++) {
    unlink(__DIR__ . "/glooby$i");
}
unlink(__DIR__ . '/package.xml');
foreach (new DirectoryIterator(dirname(__DIR__) . '/.configsnapshots') as $file) {
    if ($file->isDot()) {
        continue;
    }
    unlink($file->getPathName());
}
rmdir(dirname(__DIR__) . '/.configsnapshots');
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.allmaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allmaintainers http://pear.php.net/dtd/rest.allmaintainers.xsd">
 <h xlink:href="rest/m/.svn">.svn</h>
 <h xlink:href="rest/m/cellog">cellog</h>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.maintainer" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.maintainer http://pear.php.net/dtd/rest.maintainer.xsd">
 <n>cellog</n>
 <h>Greg Beaver</h>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<f xmlns="http://pear.php.net/dtd/rest.categorypackageinfo" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.categorypackageinfo http://pear.php.net/dtd/rest.categorypackageinfo.xsd">
 <pi/>
</f>
<?xml version="1.0" encoding="UTF-8"?>
<c xmlns="http://pear.php.net/dtd/rest.category" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.category http://pear.php.net/dtd/rest.category.xsd">
 <n>Default</n>
 <a>Default</a>
 <c>pear2.php.net</c>
 <d>This is the default category</d>
</c>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allcategories" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allcategories http://pear.php.net/dtd/rest.allcategories.xsd">
 <ch>pear2.php.net</ch>
 <c xlink:href="rest/c/Default/info.xml">Default</c>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P3</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P1</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allpackages" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allpackages http://pear.php.net/dtd/rest.allpackages.xsd">
 <p>p1</p>
 <p>p2</p>
 <p>p3</p>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P2</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}}}1.1.0RC1<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p3">P3</p>
 <c>pear2.php.net</c>
 <v>1.1.0RC2</v>
 <st>beta</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1219</f>
 <g>http://pear2.php.net/get/P3-1.1.0RC2</g>
 <x xlink:href="package.1.1.0RC2.xml"/>
</r>
<!-- this is intended to test broken REST (and failed download) -->
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p3">P3</p>
 <c>pear2.php.net</c>
 <v>1.1.0</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P3-1.1.0</g>
 <x xlink:href="package.1.1.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.1.0RC1</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>beta</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <max>1.0.0</max>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.1.0RC2</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>beta</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}}}a:1:{s:8:"required";a:3:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}s:7:"package";a:3:{s:4:"name";s:2:"P2";s:7:"channel";s:13:"pear2.php.net";s:3:"max";s:5:"1.0.0";}}}<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.1.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.1.0</v>
  <s>stable</s>
 </r>
 <r>
  <v>1.1.0RC1</v>
  <s>beta</s>
 </r>
 <r>
  <v>1.1.0RC2</v> <!-- to test broken REST -->
  <s>beta</s>
 </r>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.1.0</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
 <r>
  <v>1.1.0RC1</v>
  <s>beta</s>
  <m>5.2.0</m>
 </r>
 <r>
  <v>1.1.0RC2</v> <!-- to test broken REST -->
  <s>beta</s>
 </r>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p3">P3</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1323</f>
 <g>http://pear2.php.net/get/P3-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p3">P3</p>
 <c>pear2.php.net</c>
 <v>1.1.0RC1</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>beta</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1219</f>
 <g>http://pear2.php.net/get/P3-1.1.0RC1</g>
 <x xlink:href="package.1.1.0RC1.xml"/>
</r>
1.1.0RC1<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p3">P3</p>
 <c>pear2.php.net</c>
 <v>1.1.0RC1</v>
 <st>beta</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1219</f>
 <g>http://pear2.php.net/get/P3-1.1.0RC1</g>
 <x xlink:href="package.1.1.0RC1.xml"/>
</r>
1.1.0a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}}}<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p3">P3</p>
 <c>pear2.php.net</c>
 <v>1.1.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P3-1.1.0</g>
 <x xlink:href="package.1.1.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p3">P3</p>
 <c>pear2.php.net</c>
 <v>1.1.0RC2</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>beta</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1219</f>
 <g>http://pear2.php.net/get/P3-1.1.0RC2</g>
 <x xlink:href="package.1.1.0RC2.xml"/>
</r>
<!-- to test broken REST --><?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p3">P3</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1323</f>
 <g>http://pear2.php.net/get/P3-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
1.1.0RC1<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P1</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.1.0RC1</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>beta</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby1"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P1</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby1"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
a:1:{s:8:"required";a:3:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}s:7:"package";a:2:{s:4:"name";s:2:"P2";s:7:"channel";s:13:"pear2.php.net";}}}<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.1.0RC1</v>
  <s>beta</s>
 </r>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.1.0RC1</v>
  <s>beta</s>
  <m>5.2.0</m>
 </r>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p1">P1</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1302</f>
 <g>http://pear2.php.net/get/P1-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p1">P1</p>
 <c>pear2.php.net</c>
 <v>1.1.0RC1</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>beta</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1303</f>
 <g>http://pear2.php.net/get/P1-1.1.0RC1</g>
 <x xlink:href="package.1.1.0RC1.xml"/>
</r>
1.1.0RC1<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p1">P1</p>
 <c>pear2.php.net</c>
 <v>1.1.0RC1</v>
 <st>beta</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1303</f>
 <g>http://pear2.php.net/get/P1-1.1.0RC1</g>
 <x xlink:href="package.1.1.0RC1.xml"/>
</r>
1.0.0a:1:{s:8:"required";a:3:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}s:7:"package";a:2:{s:4:"name";s:2:"P2";s:7:"channel";s:13:"pear2.php.net";}}}<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p1">P1</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1302</f>
 <g>http://pear2.php.net/get/P1-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
1.2.0a1<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.1.0RC3</v>
 <st>beta</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1219</f>
 <g>http://pear2.php.net/get/P2-1.1.0RC3</g>
 <x xlink:href="package.1.1.0RC3.xml"/>
</r>
a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}}}<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}}}<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.2.0a1</v>
 <st>alpha</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1219</f>
 <g>http://pear2.php.net/get/P2-1.2.0a1</g>
 <x xlink:href="package.1.2.0a1.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.2.0a1</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>alpha</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1219</f>
 <g>http://pear2.php.net/get/P2-1.2.0a1</g>
 <x xlink:href="package.1.2.0a1.xml"/>
</r>
1.2.0a1<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.2.0a1</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>alpha</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}}}<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.2.0a1</v>
  <s>alpha</s>
 </r>
 <r>
  <v>1.1.0RC3</v>
  <s>beta</s>
 </r>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.2.0a1</v>
  <s>alpha</s>
  <m>5.2.0</m>
 </r>
 <r>
  <v>1.1.0RC3</v>
  <s>beta</s>
  <m>5.2.0</m>
 </r>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P2-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
1.1.0RC31.0.0<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.1.0RC3</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>beta</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1219</f>
 <g>http://pear2.php.net/get/P2-1.1.0RC3</g>
 <x xlink:href="package.1.1.0RC3.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.1.0RC3</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>beta</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-24 18:22:20</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P2-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
PK       í∏:ß)…O3  3  ;  .xmlregistry/packages/pear2.php.net/P1/1.1.0RC1-package.xmlnu W+AÑ∂        <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P1</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.1.0RC1</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>beta</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby1"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
PK       êüÎ±gû∂C   C     .phar/.metadata.binnu ˇŸA          s:59:".xmlregistry/packages/pear2.php.net/P1/1.1.0RC1-package.xml";PK       í∏:¨*ìÿ        src/glooby1nu W+AÑ∂        hiPK       í∏:            
  src/PEAR2/nu ﬂ˙•ˇ        PK       í∏:zzoÌ        src/PEAR2/Autoload.phpnu W+AÑ∂        hi
PK       í∏:zzoÌ        src/PEAR2/MultiErrors.phpnu W+AÑ∂        hi
PK       í∏:˙«z≤B   B   #  src/PEAR2/MultiErrors/Exception.phpnu W+AÑ∂        <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}PK       í∏:zzoÌ        src/PEAR2/Exception.phpnu W+AÑ∂        hi
PK         í∏:ß)…O3  3  ;                .xmlregistry/packages/pear2.php.net/P1/1.1.0RC1-package.xmlnu W+AÑ∂        PK         êüÎ±gû∂C   C               û  .phar/.metadata.binnu ˇŸA          PK         í∏:¨*ìÿ                  $  src/glooby1nu W+AÑ∂        PK         í∏:            
            a  src/PEAR2/nu ﬂ˙•ˇ        PK         í∏:zzoÌ                  õ  src/PEAR2/Autoload.phpnu W+AÑ∂        PK         í∏:zzoÌ                  ‰  src/PEAR2/MultiErrors.phpnu W+AÑ∂        PK         í∏:˙«z≤B   B   #            0  src/PEAR2/MultiErrors/Exception.phpnu W+AÑ∂        PK         í∏:zzoÌ                  ≈  src/PEAR2/Exception.phpnu W+AÑ∂        PK      Ã    C s:59:".xmlregistry/packages/pear2.php.net/P1/1.1.0RC1-package.xml";ã      ÌX›o€ ﬂsˇ
‰˜Á£ÀàªNÎˆ“N’>§ΩU‘f	*±= K¢iˇ˚b;n◊5Uó&ì‚ﬂã·«wpw`€_L•‚c°çZ‚Ç%7lÃ5.8Sƒ/&ÖüqÉ/	}‚,Ïî>hΩx4@øﬂøóê(ºCÙ£^Dz]‡√~ø°‡Ò&ûéô6LÅ…]ÿ˙AO îËWZ‰Ÿ»˝¿C<KÚTd„ë˜ÂÛªŒ±w—2kI‚á›Lèºâ1≈ª¨©ì&5iïOùµÏ–0}ÛÄÜÓ8/VÚ-jÈ˘|Óœ#?WcL G◊ãÛO…ÑOYGd≈,·†•≈P;Ú<OòqÆn4Ü,6J˘ù>(ŸXÓcÂÏú*	’ÿ‹ ∂ >B4cS_ä]àd¬≤åÀ¯VâR\— °g”)SÀÿpm äWå•\'Jv_‚â@ç.≈Õ1ïú•,]xáz√∏X˚ÇËLs'\ Ã∏éeaÛÖ,È◊µá+÷é≥ƒà<^rMqŸ{∏4HSfx~Ÿ	z“«,FÄŸxH»êª.–ÂÆπ©áY4H≠Œ+ä+¬Ÿ-D¿ûÉÆmZõk]
t-§0À[1YLÿü”ît5MSóJëLs4S∑S7/ÄŒg*·.ÖK1çØu⁄);6û^¸Åœ—õOo—˘ä§ï®Àá¬Oó»5 ÆoÛ"œœåv.¶B!§ëámÛMHéT.Å≤6 Q≠<ñy~Ω$vöT›íÛA÷ÄÎ)ÇÎrwæœÑ‚Èjnò–5ùä,ÓŸ≠ßÿ6›(ÆÜ©MYW©RÆ2•‘pŸnÉ’–π+jCP€¥πzÀ#ÎB"X≠*,>⁄˜Ò˙ﬂ2é)ÏOπaPfÃøŸ÷mî˜¸ﬂ¯ H›∂rñ	H–ﬁˇ;Äˆéáûˇ‰∑@Ô’æW–‚_–∏ûÕ∆Ü˜˚	pÁ˝ƒ£∂˛wÅâÿ∑-ˆ	[ˇógßüØ˙Wu>ÓÂ´;ˇn˝ÇzœËSçØˇ:˛¯tfrô≥‘^¯€µ±˘¸èÓ˛ˇ	∫§˝ˇ≥LD˚çt»X◊ˇ≈Lq¶TÆÙñèÄ'‘vI[ˇ;@[ˇáç{Îü-Ó~oÂ$ÿTˇ·ﬂaÌ˜ﬂ.@O ¬GâdZ#óWç<∏™Û ÒÖ·YZ…¨˘üøˆΩÇˇÇu˝o∑Êõx ˚?€˙ﬂ⁄˚øEã-øP>ù— &  PK       í∏:◊éªﬂ  ﬂ  ;  .xmlregistry/packages/pear2.php.net/P2/1.1.0RC3-package.xmlnu W+AÑ∂        <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.1.0RC3</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>beta</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
PK       êüÎFC   C     .phar/.metadata.binnu ˇŸA          s:59:".xmlregistry/packages/pear2.php.net/P2/1.1.0RC3-package.xml";PK       í∏:¨*ìÿ        src/glooby2nu W+AÑ∂        hiPK       í∏:            
  src/PEAR2/nu ﬂ˙•ˇ        PK       í∏:zzoÌ        src/PEAR2/Autoload.phpnu W+AÑ∂        hi
PK       í∏:zzoÌ        src/PEAR2/MultiErrors.phpnu W+AÑ∂        hi
PK       í∏:˙«z≤B   B   #  src/PEAR2/MultiErrors/Exception.phpnu W+AÑ∂        <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}PK       í∏:zzoÌ        src/PEAR2/Exception.phpnu W+AÑ∂        hi
PK         í∏:◊éªﬂ  ﬂ  ;                .xmlregistry/packages/pear2.php.net/P2/1.1.0RC3-package.xmlnu W+AÑ∂        PK         êüÎFC   C               J  .phar/.metadata.binnu ˇŸA          PK         í∏:¨*ìÿ                  –  src/glooby2nu W+AÑ∂        PK         í∏:            
              src/PEAR2/nu ﬂ˙•ˇ        PK         í∏:zzoÌ                  G  src/PEAR2/Autoload.phpnu W+AÑ∂        PK         í∏:zzoÌ                  ê  src/PEAR2/MultiErrors.phpnu W+AÑ∂        PK         í∏:˙«z≤B   B   #            ‹  src/PEAR2/MultiErrors/Exception.phpnu W+AÑ∂        PK         í∏:zzoÌ                  q  src/PEAR2/Exception.phpnu W+AÑ∂        PK      Ã  ª  C s:59:".xmlregistry/packages/pear2.php.net/P2/1.1.0RC3-package.xml";.xmlregistry/packages/pear2.php.net/P2/1.2.0a1-package.xml                                          0000666                 00000002337 11206353254 0016643 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.2.0a1</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>alpha</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                                                                                                                 .phar/.metadata.bin                                                                                 0000000                 00000000102 00000000000 0010020 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       s:58:".xmlregistry/packages/pear2.php.net/P2/1.2.0a1-package.xml";                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/glooby2                                                                                         0000666                 00000000002 11206353254 0006630 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2                                                                                           0000777                 00000000000 11206353254 0006072 5                                                                                                    ustar 00                                                                                                                                                                                                                                                       src/PEAR2/Autoload.php                                                                              0000666                 00000000003 11206353254 0010423 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           0000666                 00000000003 11206353254 0011142 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 0000666                 00000000102 11206353254 0013100 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Exception.php                                                                             0000666                 00000000003 11206353254 0010611 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ã      ÌX]s⁄:Ìs~Ö∆ÔXñ†•ä”Ø‹˚ív2˝òÈ[Gÿ*h*lWÊŒ˝Ô]	€ò4-ôÑ@g‚ÛÇt¥“Æµg%õp9SZL§±zÖKû~„ap)∏¶a9-√\X|cí0zˇöÙ*ì¶=π-"¿`0∏ë–8>!ÑFÉ∏”˛)d0§C›⁄√=07ñkpy_!ÿ9d˝⁄»"? ÀyZd2üúü>˛”{ú''¨ ˚∆íÜ$@077g¡‘⁄rÑΩj—d6´ı‘€ÿé,7ﬂ˛0√˜|k˚•ëçıb±qXË	¶†¸˘ÌÂát*fº's»bû
òe‰»xÚ≤Hπı°ÓtÜvZÖKì˝—≤ı∏∑µsk®"tks#ÿÇ‰±úœDr3Ï@§SûÁB%[% pMÉÖôœf\Ø+åÖ,2\0ñ	ìjY∫}I¶µ∫∑«¿T	û¡o¬øpH†WÇCàM,àÕç–I*î*¿çÔ86_™ä~—D∏f›8O≠¸!íï0Wmá+á,„V$ê‡gΩ®ﬂ£ßò#`¿JpKûé(—àaﬂ∫⁄5ø¥∞ä´Íºb∏fº„R&ëø–tN7ìHh,ï¥´≠ï∆¬Ú_W·™úÚÕ*Ì©L…T‰F†πﬁñnQ]Ãu*ºÑ+3É«&ÎUóœ y'Ë’á7ËrM≤⁄‘Î°Ä¥&≥ÚHÖÔ;]ππ5>ƒLj‰ít`ß"`æJ%ê.PŒG5jtä'™(∆´8¿~&Ü©˛ëZÎÅj Ùé)Lµ9ﬂÁRãlΩ6,ËàÕdûÙCÍ6ÿ5˝(Æáôì¨ØT•÷J©fxµs≤5Á∫©KA„”iu+"Bï"xVWXrrÏ„ıØ(ékŒ@ÂPf<À|Ô>™{˛w|D¢∏i;;«Dît˜ˇ`F˝g£ º˚[`¸ÿè–·h› Êc«˚ø˚∏ˆ˛ÊqWˇá¿T;Ç«Ñ´ˇ´ãóÔÈ˙p>o‰Î;ˇz˝GCä˙SÉG^ˇM˛ÒÀπ-T¡3w·Ô◊«ÓÛ?æ˛ˇOtJ„Ó¸? ¶≤˚FzÃÿ‘ˇ€π≤ÚBÎBõ=w®BNiWˇ@Wˇè7÷?æX¶¬ˇºóì`W˝ì_æˇHL¢®´ˇÄùCÜOR≈çA^_Z:¯“Ë â•yV€l¯ˇ˛?ˆt∏6ıøﬂöo„.Ôˇ“˝ˇst˜á:<N¸‚¿õ[ &  ã      ÌXﬂo€6Œs˛
BÔE…?ZèQ⁄bŸ^“!X;`o#±6QZ“H∫∂QÙÔë¶,9…Í÷qÏ—˜"Ú„Ô»ª#%ÖÀôT|"¥Q+\±Ïõpç+ŒTV”*,∏¡7	&aF=?ÇŒŸO á√y@<àFgÑƒ—0$Ò†<ˆ…E?cd_Ãµa
L√÷ÙÇâ>s•EY\Á Ò"+sQL.Çøﬁˇ÷{\¶Á‘áæëåC –-ÙE05¶có5õ§…M^ÁSØë¶?}G√˜úk˘•È≈b.í∞TCé‡øﬂ^øÀ¶|∆z¢Ä(--∆⁄ë◊e∆åsuß1d±S*\Í¸ªí≠Â˛®úù3@ûP≠ÕÖr“sD6„ÈMB±k ëMYQpônï(≈5z>õ1µJ◊¢HqM¿XŒu¶De˜%ù
‘ÍR‹Q…YOÔ¬ÔpH†7úÅã_ùkÆ“åKYÇ◊±,læêû~µÒpÕ⁄qñÒôß+Æ)ˆm∞áΩAö3√SÀ^4Ë≈}pÃ0`ò%/∆q<é#ä]høknj≈aRv)ÆªŒj%“vh€¥M
˘s+§0´≠i,+˘˝yò¨¶¨ôß≠L•»x°9ö´ÌÃ-+†Àπ ∏À`/¶Ò≠Œ{æc√§zÛÓWtΩ&i-Í“°Ñ®¶≥ràÑÎ€¥(√£ùãπP»∆Ë"¿6âÄ˘($G™î@Y~T´OdYﬁÆí ;M™nI≠˘ i¿ıN¡µﬂûÊBÒ|=7LËàŒDë¬ÿn±m∫Q\Sõ±ÆP•\'ä◊p…Œ»ñŒ=—˙ ÚzÎ≤àõTD?PŒ [÷…aõﬁ\3∑çıfq∂&∂ñn◊Ísˆ´•xÍc|o¿>1Ö√7 åÖ∑¢8∏œˇãú9Üª˚ˇ–„¡pÑ{æøú⁄ˇèCÎ
x2;ﬁˇÌ'¿ù˜OHWˇG¿Tú⁄ÉßÑ≠ˇõ´◊∆Oh√V¯h4zêØÔ¸ªıçb4xBü6xÊıøâ?~=7•,Yn/¸√⁄ÿ}˛'wˇˇD˝8ÈŒˇ#`*˛øﬂ.è¶˛ﬂŒ•WJïJ¯ÿ£˛	È«]˝]˝?o<Xˇ¯jôq˜#¯ '¡Æ˙'˜æˇHB¢®´ˇ#Ä^BÑœ3…¥F.>¥Ú‡√&_^‰µL√˘zÍtxö˙?lÕ∑±œ˚ˇêtˇéÅÓ˛Ô–°CáÁâo«ñ±Ù &  .xmlregistry/packages/pear2.php.net/P3/1.1.0RC1-package.xml                                         0000666                 00000002337 11206353254 0016727 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.1.0RC1</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>beta</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                                                                                                                 .phar/.metadata.bin                                                                                 0000000                 00000000103 00000000000 0010021 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       s:59:".xmlregistry/packages/pear2.php.net/P3/1.1.0RC1-package.xml";                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/glooby3                                                                                         0000666                 00000000002 11206353254 0006631 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2                                                                                           0000777                 00000000000 11206353254 0006072 5                                                                                                    ustar 00                                                                                                                                                                                                                                                       src/PEAR2/Autoload.php                                                                              0000666                 00000000003 11206353254 0010423 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           0000666                 00000000003 11206353254 0011142 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 0000666                 00000000102 11206353254 0013100 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Exception.php                                                                             0000666                 00000000003 11206353254 0010611 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             .xmlregistry/packages/pear2.php.net/P3/1.0.0-package.xml                                            0000666                 00000002507 11206353254 0016417 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <max>1.0.0</max>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                         .phar/.metadata.bin                                                                                 0000000                 00000000100 00000000000 0010016 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       s:56:".xmlregistry/packages/pear2.php.net/P3/1.0.0-package.xml";                                                                                                                                                                                                                                                                                                                                                                                                                                                                src/glooby3                                                                                         0000666                 00000000002 11206353254 0006631 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2                                                                                           0000777                 00000000000 11206353254 0006072 5                                                                                                    ustar 00                                                                                                                                                                                                                                                       src/PEAR2/Autoload.php                                                                              0000666                 00000000003 11206353254 0010423 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           0000666                 00000000003 11206353254 0011142 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 0000666                 00000000102 11206353254 0013100 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Exception.php                                                                             0000666                 00000000003 11206353254 0010611 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ã      ÌXQo€6Œs~°wãe+ù«(m±l/i¨∞∑ÇëÆ6QZ“H∫∂1Ïø˜HK∂úfıö:vÅË{1˘›Ôƒª#%áÀô“0ë∆Í≠E˛QL¿–Ñfa=≠√,Ωe4£04ÚmŒæ"M”yKíÙ,éYî&£ÑçÜ»«È0NIÙ-Nãπ±B£Àc¯˙¡Ø0ô‰h#´Ú2¿< º*d9π˛¸„◊¡ã‡*;ÁMÍ∑ö,åÇ∂•π¶÷÷cÍ´fS4Ö-⁄zlu«Vòè_±‚Åèb≠ø4r£ΩX,¬EVzB÷˝ÎÕÕª|
31ê%f±Ã≠åOﬁTπ∞>‘ΩŒà√^≠piäØjv˜ˇÍπ5“∫≥πÿnAvNx)fê›2N˝ â|* T∂”¢ú∂4jò˘l&Ù*≥`,fë”ñ@Y&◊≤v˚íM%ÈL9Ì PUÅ(∑	·7<$»k‚&¬ÁtñÉR∫Ò«‚ÊK’–/7ÆY'πïü [Å·¥£?⁄8‰Ö∞êaÇD£b`é@ÅïË6~1flÃ"N˝Èf◊¸“pÉZn9mßﬁk-≥wi7t∑ñÎÁN*iW;À8V¡óÎUO≈vùÆ1W2á“ ôÎ› ≠j§´πŒ¡Wp£fËù)Õƒ•3»ﬁ¬Çº~˜πYìºUıÂPaV≥Ÿä¯f¬œ]YT•Ö“b!5q9∫®+"d>HDW
)Á£ëù”â™™ª®∑§hÍ©≥Ü^‡© ¡4€Û˜\j(÷k„Ç~@¯LñŸ(dnã›–Ki+ÊÆb}£*µ.î∆¬ªàwlÓ´∫l|∫R›â»Ö–§É∑ñùü˙t˝ÒÅ%'4g`∂ôÔdypÕ=ˇ_|£,⁄‚Ã3˝˝òÒ(·#ﬂÉüOèÔCÁ
x2{ﬁˇ›'¿Ω˜TO¢æˇèÄ©<u=N	◊ˇ∑◊Ø~∫Ó_˜˘≈≈≈É|{ÁﬂÔˇËÇë—∆¥¡3ÔˇM˛È´π≠T%
w·÷«˛Û?πˇˇO4dI˛SŸ$=gl˚ˇÕ\Yy≠u•ÕÅèÄGÙYﬂˇG@ﬂˇœˆ?Ω^Ê‡ˇ>»I∞Øˇ„/æˇ‚$é˙ÔøcÄ_aÜœs%å!æﬁwÍ‡˝¶,-îE´≥Âˇ˘˜‘O–„{∞Ìˇ√ˆ|èyˇO„∏Ôˇ#†øˇ{ÙË—„y‚3÷¬ÿ &  PK       í∏:Êìﬂ  ﬂ  :  .xmlregistry/packages/pear2.php.net/P2/1.2.0a1-package.xmlnu W+AÑ∂        <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.2.0a1</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>alpha</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
PK       êüÎãDK†B   B     .phar/.metadata.binnu ˇŸA          s:58:".xmlregistry/packages/pear2.php.net/P2/1.2.0a1-package.xml";PK       í∏:¨*ìÿ        src/glooby2nu W+AÑ∂        hiPK       í∏:            
  src/PEAR2/nu ﬂ˙•ˇ        PK       í∏:zzoÌ        src/PEAR2/Autoload.phpnu W+AÑ∂        hi
PK       í∏:zzoÌ        src/PEAR2/MultiErrors.phpnu W+AÑ∂        hi
PK       í∏:˙«z≤B   B   #  src/PEAR2/MultiErrors/Exception.phpnu W+AÑ∂        <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}PK       í∏:zzoÌ        src/PEAR2/Exception.phpnu W+AÑ∂        hi
PK         í∏:Êìﬂ  ﬂ  :                .xmlregistry/packages/pear2.php.net/P2/1.2.0a1-package.xmlnu W+AÑ∂        PK         êüÎãDK†B   B               I  .phar/.metadata.binnu ˇŸA          PK         í∏:¨*ìÿ                  Œ  src/glooby2nu W+AÑ∂        PK         í∏:            
              src/PEAR2/nu ﬂ˙•ˇ        PK         í∏:zzoÌ                  E  src/PEAR2/Autoload.phpnu W+AÑ∂        PK         í∏:zzoÌ                  é  src/PEAR2/MultiErrors.phpnu W+AÑ∂        PK         í∏:˙«z≤B   B   #            ⁄  src/PEAR2/MultiErrors/Exception.phpnu W+AÑ∂        PK         í∏:zzoÌ                  o  src/PEAR2/Exception.phpnu W+AÑ∂        PK      À  π  B s:58:".xmlregistry/packages/pear2.php.net/P2/1.2.0a1-package.xml";.xmlregistry/packages/pear2.php.net/P3/1.1.0-package.xml                                            0000666                 00000002336 11206353254 0016420 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.1.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                                                                                                                  .phar/.metadata.bin                                                                                 0000000                 00000000100 00000000000 0010016 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       s:56:".xmlregistry/packages/pear2.php.net/P3/1.1.0-package.xml";                                                                                                                                                                                                                                                                                                                                                                                                                                                                src/glooby3                                                                                         0000666                 00000000002 11206353254 0006631 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2                                                                                           0000777                 00000000000 11206353254 0006072 5                                                                                                    ustar 00                                                                                                                                                                                                                                                       src/PEAR2/Autoload.php                                                                              0000666                 00000000003 11206353254 0010423 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           0000666                 00000000003 11206353254 0011142 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 0000666                 00000000102 11206353254 0013100 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Exception.php                                                                             0000666                 00000000003 11206353254 0010611 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             PK       í∏:7≈ã"ﬁ  ﬁ  8  .xmlregistry/packages/pear2.php.net/P3/1.1.0-package.xmlnu W+AÑ∂        <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.1.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
PK       êüÎjP%∑@   @     .phar/.metadata.binnu ˇŸA          s:56:".xmlregistry/packages/pear2.php.net/P3/1.1.0-package.xml";PK       í∏:¨*ìÿ        src/glooby3nu W+AÑ∂        hiPK       í∏:            
  src/PEAR2/nu ﬂ˙•ˇ        PK       í∏:zzoÌ        src/PEAR2/Autoload.phpnu W+AÑ∂        hi
PK       í∏:zzoÌ        src/PEAR2/MultiErrors.phpnu W+AÑ∂        hi
PK       í∏:˙«z≤B   B   #  src/PEAR2/MultiErrors/Exception.phpnu W+AÑ∂        <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}PK       í∏:zzoÌ        src/PEAR2/Exception.phpnu W+AÑ∂        hi
PK         í∏:7≈ã"ﬁ  ﬁ  8                .xmlregistry/packages/pear2.php.net/P3/1.1.0-package.xmlnu W+AÑ∂        PK         êüÎjP%∑@   @               F  .phar/.metadata.binnu ˇŸA          PK         í∏:¨*ìÿ                  …  src/glooby3nu W+AÑ∂        PK         í∏:            
              src/PEAR2/nu ﬂ˙•ˇ        PK         í∏:zzoÌ                  @  src/PEAR2/Autoload.phpnu W+AÑ∂        PK         í∏:zzoÌ                  â  src/PEAR2/MultiErrors.phpnu W+AÑ∂        PK         í∏:˙«z≤B   B   #            ’  src/PEAR2/MultiErrors/Exception.phpnu W+AÑ∂        PK         í∏:zzoÌ                  j  src/PEAR2/Exception.phpnu W+AÑ∂        PK      …  ¥  @ s:56:".xmlregistry/packages/pear2.php.net/P3/1.1.0-package.xml";PK       í∏:/P/¶ﬂ  ﬂ  ;  .xmlregistry/packages/pear2.php.net/P3/1.1.0RC1-package.xmlnu W+AÑ∂        <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.1.0RC1</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>beta</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
PK       êüÎæ´•oC   C     .phar/.metadata.binnu ˇŸA          s:59:".xmlregistry/packages/pear2.php.net/P3/1.1.0RC1-package.xml";PK       í∏:¨*ìÿ        src/glooby3nu W+AÑ∂        hiPK       í∏:            
  src/PEAR2/nu ﬂ˙•ˇ        PK       í∏:zzoÌ        src/PEAR2/Autoload.phpnu W+AÑ∂        hi
PK       í∏:zzoÌ        src/PEAR2/MultiErrors.phpnu W+AÑ∂        hi
PK       í∏:˙«z≤B   B   #  src/PEAR2/MultiErrors/Exception.phpnu W+AÑ∂        <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}PK       í∏:zzoÌ        src/PEAR2/Exception.phpnu W+AÑ∂        hi
PK         í∏:/P/¶ﬂ  ﬂ  ;                .xmlregistry/packages/pear2.php.net/P3/1.1.0RC1-package.xmlnu W+AÑ∂        PK         êüÎæ´•oC   C               J  .phar/.metadata.binnu ˇŸA          PK         í∏:¨*ìÿ                  –  src/glooby3nu W+AÑ∂        PK         í∏:            
              src/PEAR2/nu ﬂ˙•ˇ        PK         í∏:zzoÌ                  G  src/PEAR2/Autoload.phpnu W+AÑ∂        PK         í∏:zzoÌ                  ê  src/PEAR2/MultiErrors.phpnu W+AÑ∂        PK         í∏:˙«z≤B   B   #            ‹  src/PEAR2/MultiErrors/Exception.phpnu W+AÑ∂        PK         í∏:zzoÌ                  q  src/PEAR2/Exception.phpnu W+AÑ∂        PK      Ã  ª  C s:59:".xmlregistry/packages/pear2.php.net/P3/1.1.0RC1-package.xml";ã      ÌX[s⁄8Œs~Ö∆ÔXñ ”≤ä≥Ì4ÌK⁄…Ù2”∑ébkASaªí(0ù˝Ô{$llíliR;/XüŒM:ÁH6·r¶¥òHcı
ó<˝ '¬‡RpM√rZÜπ∞¯ä`Fa‘´ÊC–9π"@«wÚ :àÈ	!4ä˚√>Ä'ÒÄQt'≈‹XÆ¡Â!|˝¡Œ!ôËª–F˘Y yê»”"ì˘‰,¯ÙÒuÔYpûú≤*ıç$IÄ@77g¡‘⁄rå}’lä&≥Y]OΩFvlπ˘˙?›ÛQ¨ÂóFn§ãE∏ËáÖû`
5Ç?øΩ¸êN≈å˜dYÃSZFéç'/ãî[ÍNg»aßT∏4ŸO%[À˝U9g3@°[õÌ$ßàÂ|&í+¬∞ "ùÚ<*ŸjQÜk$Ã|6„zïXa,dë·öÄπLòTÀ“ÌK2ï®5d∏=¢J~´ﬁ¿!Å^
!nbAlnÑNR°Tn¸¿±∞˘RUÙüõ◊¨õÁ©ïﬂE≤Ü·Í¸· !À∏	$¯y/ˆË sLX	n…≥1•c1Ïá@WªÊMkVHπd∏zØ•L"ÿq†›£Ûÿh2®ük©§]môq¨∑ÌpUNycß≠ÃîLEnöÎÌ -J†ãπNÖØ‡JÃ‡kìı™ÅKgêºÙÚ√+tπ&Y-ÍÀ°Ä¨&≥Úê	?veQ‰V‰÷¯3©ëÀ—YÄ]ÛóTÈBÂ|T≥Fßx¢ä‚zEÏ51®˙%µÏA—@Ëú
Ròj{æÕ•Ÿ⁄6ÙàÕdûCÍ∂ÿ=˙Y\O3W±æQïZJ•·ãùì-ù[¢ıTÈ≠€Ç6•à~°3ºÂ∆åKÎfÆ¸∑VÈñU•∂¶•xÏ{øÄ}‚á3a9¥Øeæw’=ˇo|D`.jp‚w˜ˇ`∆√xÑ|˛8v¸~≠+‡—|Ïxˇwü 7ﬁˇAúé∫˛? ¶Úÿt8&\ˇ_]ºxO—áÎ—ht'_ﬂ˘7˚?Q4|ƒò6x‚˝ø…?~1∑Ö*xÊ.¸˝˙ÿ}˛˜o˛ˇhø;ˇÄ©¸ü}–t∏ö˛;WV^h]h≥Á#‡˝O»Äv˝ t˝ˇ¥qgˇ„ãe*¸¡{9	vı?πı˝G˙$ä∫˛? ÿ9d¯4U‹‰Î‡K´ælÍ â•yVÀ4¸èøèΩÇøÉ¶ˇ˜€Ûm<‰˝?&§Îˇ†ªˇ;tË–·i‚ïû	 &  ã      ÌXﬂo€ ﬁsˇ
‰˜7…öQwø∫ΩtS’n“ﬁ*b≥çÿê%—¥ˇ}±ßÌö™MìIı˜¯∏„Óp¸˘D*>⁄®.XÚÉç∏∆gä¯≈∏3n9¡°˙¡≈ª®Sä¯†ˆ‚æ Ω^ÔV@¢®ˇ"I–ã∫Èˆ˙QÄÇ{[x¶⁄0&waÎ?=ÅH¢_\iëg«DŸC<KÚTd£cÔÎóùóﬁI|@À∏Ø$âzt3}Ïçç)ÿeMù4©I´|Í¨dÜÈwh∏·éÛb)?◊¢ñûÕf˛,Ús5¬r˚tvôå˘ÑuDQÃZZ¥#œÚÑÁÍFc»b£î?◊ÈùíçÂﬁWŒŒÈ°íPçÕ`‚D36·Ò9°ÿ5ÄH∆,À∏å◊Jî‚ä	=ùLòZƒÜkQ§∏"`,Â:Q¢∞˚èjt)néÅ®‰,Öﬂ“ÖèpH†∑úÅãµ/àN5Wq¬•Ã¡åÎX6_»í~]{∏dÌ8Kå¯≈„◊óm∞áKÉ4eÜ«‡£N–ÌêCpÃ0`ò_êÄb◊∫‹57µ‚0ã©Úº¢∏bú·BƒÅª–¥FW Rh(§0ãµôÜ‹∞õ≥0YåŸjñ¶*ï"·ôÊh™÷S7/ÄŒß*·.ÖK1çá:ÌîO/˛ÃgËÌÂ{t∂$i%ÍÚ!á∞∆ìrÖÎ€º»3√3£ùã©P»Èÿ√6ãÄ˘.$G*ó@YÂ®V	…<.àáù&U∑§∆|ê5‡z
«Ç‡∫‹úüS°x∫ú&tD'"ãª>±lõnW√‘¶¨´T)óôRj∏lg·öŒuQÇ⁄¶Õ’5è¨eà`¥™∞¯`ﬂ«Î»8¶∞?Å,á2c˛Pd[∑QﬁÛˇ‚É0àÍ∂ï≥L@¬ˆ˛ﬂÙ†{4¸áøΩW˚^BãG†q<ôçÔ˚	pÌ˝‚Ì˚'ã}{–bü∞ı~˙Ê‚È™YÁ˝~ˇVæ∫ÛØ◊–'®˚Ñ>’xÊı_«øôö\Ê,µ˛vml>ˇ£Îˇˇá$jœˇ`,⁄o§ÁåU˝öJ#Nï ïﬁÚÄ˙√C“÷ˇ–÷ˇÛ∆≠ıèOÁ	woÂ$ÿTˇ·çÔø0
Éˆ˚o†'·ÉD2≠ëÀÉ´F\’yÄ¯‹,≠dV¸Ô?˚^Aã«`Uˇ€≠˘&Ú˛ÔÖÌˇøª@{ˇ∑h—¢≈Ûƒ_èeì˜ &  .xmlregistry/packages/pear2.php.net/P1/1.1.0RC1-package.xml                                         0000666                 00000002463 11206353254 0016725 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P1</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.1.0RC1</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>beta</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby1"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                             .phar/.metadata.bin                                                                                 0000000                 00000000103 00000000000 0010021 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       s:59:".xmlregistry/packages/pear2.php.net/P1/1.1.0RC1-package.xml";                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/glooby1                                                                                         0000666                 00000000002 11206353254 0006627 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2                                                                                           0000777                 00000000000 11206353254 0006072 5                                                                                                    ustar 00                                                                                                                                                                                                                                                       src/PEAR2/Autoload.php                                                                              0000666                 00000000003 11206353254 0010423 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           0000666                 00000000003 11206353254 0011142 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 0000666                 00000000102 11206353254 0013100 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Exception.php                                                                             0000666                 00000000003 11206353254 0010611 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             PK       í∏:ÕòH2  2  8  .xmlregistry/packages/pear2.php.net/P1/1.0.0-package.xmlnu W+AÑ∂        <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P1</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby1"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
PK       êüÎTöG‘@   @     .phar/.metadata.binnu ˇŸA          s:56:".xmlregistry/packages/pear2.php.net/P1/1.0.0-package.xml";PK       í∏:¨*ìÿ        src/glooby1nu W+AÑ∂        hiPK       í∏:            
  src/PEAR2/nu ﬂ˙•ˇ        PK       í∏:zzoÌ        src/PEAR2/Autoload.phpnu W+AÑ∂        hi
PK       í∏:zzoÌ        src/PEAR2/MultiErrors.phpnu W+AÑ∂        hi
PK       í∏:˙«z≤B   B   #  src/PEAR2/MultiErrors/Exception.phpnu W+AÑ∂        <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}PK       í∏:zzoÌ        src/PEAR2/Exception.phpnu W+AÑ∂        hi
PK         í∏:ÕòH2  2  8                .xmlregistry/packages/pear2.php.net/P1/1.0.0-package.xmlnu W+AÑ∂        PK         êüÎTöG‘@   @               ö  .phar/.metadata.binnu ˇŸA          PK         í∏:¨*ìÿ                    src/glooby1nu W+AÑ∂        PK         í∏:            
            Z  src/PEAR2/nu ﬂ˙•ˇ        PK         í∏:zzoÌ                  î  src/PEAR2/Autoload.phpnu W+AÑ∂        PK         í∏:zzoÌ                  ›  src/PEAR2/MultiErrors.phpnu W+AÑ∂        PK         í∏:˙«z≤B   B   #            )  src/PEAR2/MultiErrors/Exception.phpnu W+AÑ∂        PK         í∏:zzoÌ                  æ  src/PEAR2/Exception.phpnu W+AÑ∂        PK      …    @ s:56:".xmlregistry/packages/pear2.php.net/P1/1.0.0-package.xml";ã      ÌXKs€6ŒŸø√ªz%
L7i›^úé'ifzÀ@$"aBë, E“d˙ﬂªÄ¿áb7rlY ƒ¸.?Ïÿ]ÄT∏^dJÃ§6jÉKû|‚3°q)∏¢a9/√\|M0	IΩ˝ïÙºHjœÓä0çnÂt0Í?#ÑF£˛∞Oá‡…hLá(∫≥á`©W‡Úæ~@∞»$˙,îñE~@ñ$Ú§He>;ﬁˇı{Ôypü1ü˜FíÜ$@†õÎÛ`nL9¡ÆjÍ¢IMZ’SØëùÆ?}C√M˜\[˘µñµÙjµ
W˝∞P3L°FﬂoÆﬁ%s±‡=ôCÛDÄññÌ»´"·∆Ö∫◊≤ÿ+Æu˙M…÷rÔ*gm»™µπlA|ÜXŒ"æ&ª…úÁπ»‚ùe∏¢AB/Æ6±⁄@ÆòKÖNî,ÌæƒsâZè∑Á@4<Ö_¬pH†◊ÇCàu,à-µPq"≤¨ 7Ó¡≤∞˘2ÛÙ/uÑ[÷ŒÛƒ»œ"ﬁÕ∞É?Ï≤îCÇ_Ù¢aè 0K¿Ñë‡ñ<üP:°√ÓhøkŒ¥`EÉî?ØÆÁ∏îqdg¿/≠”FôA	Me&Õf«“T~”
œ 9o¨¥UY&ëkÅñj∑tãËb©·Jÿãi<’iœ?ÿ|ÒübÖ^ø˚]mIVâ∫z( ≠ÒbÉ‹ R·ûm]ππ—.ƒT*dìt`[E¿|îô@™»Ä≤>¸¨V	ûeE1›ê ;M™nI-{P5z
«Ç⁄oŒ?K©D∫µ› ±ÖÃ„aHÌ€°õ≈’4≥%Î:5À∂ï‚5\µs≤£sC¥:Åºﬁ∂/hSãË≠·,7flZÎuÿ˙ﬂY•]ñO;lMKÒ‘GˆA€ƒPÂ–f<ú ¸‡>¸=ˇ|D¢~=∂rñâ(ÈÓˇ#@OÜ/&Axˇ∑¿‡Â©ó–·h› èÊcœ˚ø˝¯Í˝ƒÈ∏Îˇ#`.OAáS¬ˆˇıÂ´∑Ù}ÿè«∑Ú’ùˇuˇGcäÜèSç'ﬁˇu˛Ò´•)≤Çßˆ¬?¨è˝Áˇçˇ¢ÌwÁˇ0ó?◊˜LáÔC”ˇoñôëóJJ¯∏Gˇ2†]ˇ]ˇ?m‹⁄ˇ¯rù˜GANÇ}˝On|ˇë>â¢Æˇè v>K2Æ5ru°UÍ:@bmDûV2ˇÂﬂSØ†√C–Ùˇa{æç˚ºˇèH˜ˇÔ1–›ˇ:tË4ÒûŒì´ &  .xmlregistry/packages/pear2.php.net/P2/1.0.0-package.xml                                            0000666                 00000002336 11206353254 0016416 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                                                                                                                  .phar/.metadata.bin                                                                                 0000000                 00000000100 00000000000 0010016 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       s:56:".xmlregistry/packages/pear2.php.net/P2/1.0.0-package.xml";                                                                                                                                                                                                                                                                                                                                                                                                                                                                src/glooby2                                                                                         0000666                 00000000002 11206353254 0006630 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2                                                                                           0000777                 00000000000 11206353254 0006072 5                                                                                                    ustar 00                                                                                                                                                                                                                                                       src/PEAR2/Autoload.php                                                                              0000666                 00000000003 11206353254 0010423 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           0000666                 00000000003 11206353254 0011142 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 0000666                 00000000102 11206353254 0013100 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Exception.php                                                                             0000666                 00000000003 11206353254 0010611 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             PK       í∏:LÁ•ÔG  G  8  .xmlregistry/packages/pear2.php.net/P3/1.0.0-package.xmlnu W+AÑ∂        <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <max>1.0.0</max>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
PK       êüÎ)õÉ0@   @     .phar/.metadata.binnu ˇŸA          s:56:".xmlregistry/packages/pear2.php.net/P3/1.0.0-package.xml";PK       í∏:¨*ìÿ        src/glooby3nu W+AÑ∂        hiPK       í∏:            
  src/PEAR2/nu ﬂ˙•ˇ        PK       í∏:zzoÌ        src/PEAR2/Autoload.phpnu W+AÑ∂        hi
PK       í∏:zzoÌ        src/PEAR2/MultiErrors.phpnu W+AÑ∂        hi
PK       í∏:˙«z≤B   B   #  src/PEAR2/MultiErrors/Exception.phpnu W+AÑ∂        <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}PK       í∏:zzoÌ        src/PEAR2/Exception.phpnu W+AÑ∂        hi
PK         í∏:LÁ•ÔG  G  8                .xmlregistry/packages/pear2.php.net/P3/1.0.0-package.xmlnu W+AÑ∂        PK         êüÎ)õÉ0@   @               Ø  .phar/.metadata.binnu ˇŸA          PK         í∏:¨*ìÿ                  2  src/glooby3nu W+AÑ∂        PK         í∏:            
            o  src/PEAR2/nu ﬂ˙•ˇ        PK         í∏:zzoÌ                  ©  src/PEAR2/Autoload.phpnu W+AÑ∂        PK         í∏:zzoÌ                  Ú  src/PEAR2/MultiErrors.phpnu W+AÑ∂        PK         í∏:˙«z≤B   B   #            >  src/PEAR2/MultiErrors/Exception.phpnu W+AÑ∂        PK         í∏:zzoÌ                  ”  src/PEAR2/Exception.phpnu W+AÑ∂        PK      …    @ s:56:".xmlregistry/packages/pear2.php.net/P3/1.0.0-package.xml";ã      ÌYQo€6Œs~°wã¢d+ù«(m±l/i¨∞∑ÇëÆ6QZ“H∫∂1Ïø˜HK∂úfıö:vÅË{	˘›Ôƒª#%'\ŒîÜâ4VØh-ÚèbÜ÷ t÷”:,¡“€Ñ≤êÖ—†ëáhsˆàiö>»#‚$Iœã£4%Òhà<KáqD¢oqÚXÃç]√◊~Ö…$ü@Yïóf9 PÊU!À…eÁø^WŸ9oRø’åC¥-Õe0µ∂S_5õ¢)l—÷”`´;∂¬|¸äÖ|k˝•ëÌ≈b.í∞“cç–øﬁ‹ºÀß0YbÀ– »±Ò‰MïÎC›Îå8Ï’
ó¶¯™fÁqˇØû[3 °;õ·dÁÑóbŸm¬© ëOEYÇ vZî”ñF3üÕÑ^eå≈,r⁄(+¿‰Z÷n_≤©$ù)ß]™*˛mB¯	ÚÜ∏âÖπùÂ†TÖn¸ƒ±∏˘R5ÙÀMÑk÷…EnÂ'»V`8m∆Ëè6y!,dò‡ü—h10G†¿JtÀ^å„xGú˙)“ÕÆ˘•5‡*µ‹y≈i;ı^kôEk⁄ù«≠%«˙πìJ⁄’Œ2éUÂ:B’S±]ßkÃïÃ°4@Êz∑r´ÈjÆs‹®zgäA3qÈ≤∑∞ Øﬂ˝Bn÷$oU}9Tò’l∂"~ÄôsWUi°¥∆áXHM\é.ÍäôR—ïB ˘h§FÁt¢™Ínï‘[R4ıè‘YãC/Tê`öÌ˘{.5ÎµqA? |&Àl∆nã›–Ki+ÊÆb}£*µ.î∆¬ª`;6˜U]
6>]©ÓD‰BhRÑè¡€ÀŒO}∫˛¯¿íöÜ3∞€LÑw≤<∏èÊûˇ/>b(ã∂8ÛK˚˚ˇ0„Q:¬Gæ?ü:˛ﬂáŒd>ˆºˇªOÄ{Ôˇ®û∞æˇèÄ©<u=N	◊ˇ∑◊Ø~èü–áÎããã˘ˆŒøﬂˇ—ELFO”œºˇ7˘ßØÊ∂Rï(‹ÖX˚œˇ‰˛Ô?—0N˙Ûˇò ˛#È9c€ˇoÊ  k≠+m|<¢ˇ∆}ˇ}ˇ?o<ÿˇÙzôÉˇ!¯ '¡æ˛g_|ˇ±ÑE˝ˇé~Ö>œï0Ü¯:xﬂ©É˜õ: ∞¥P≠ŒñˇÁﬂS?AèÔ¡∂ˇ€Û]<Ê˝?e˝Ô?«@ˇ˜Ë—£«Ûƒg≤ô@ &  .xmlregistry/packages/pear2.php.net/P1/1.0.0-package.xml                                            0000666                 00000002462 11206353254 0016415 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P1</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby1"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                              .phar/.metadata.bin                                                                                 0000000                 00000000100 00000000000 0010016 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       s:56:".xmlregistry/packages/pear2.php.net/P1/1.0.0-package.xml";                                                                                                                                                                                                                                                                                                                                                                                                                                                                src/glooby1                                                                                         0000666                 00000000002 11206353254 0006627 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2                                                                                           0000777                 00000000000 11206353254 0006072 5                                                                                                    ustar 00                                                                                                                                                                                                                                                       src/PEAR2/Autoload.php                                                                              0000666                 00000000003 11206353254 0010423 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           0000666                 00000000003 11206353254 0011142 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 0000666                 00000000102 11206353254 0013100 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Exception.php                                                                             0000666                 00000000003 11206353254 0010611 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             PK       í∏:UZSkﬁ  ﬁ  8  .xmlregistry/packages/pear2.php.net/P2/1.0.0-package.xmlnu W+AÑ∂        <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
PK       êüÎ∑YØ@   @     .phar/.metadata.binnu ˇŸA          s:56:".xmlregistry/packages/pear2.php.net/P2/1.0.0-package.xml";PK       í∏:¨*ìÿ        src/glooby2nu W+AÑ∂        hiPK       í∏:            
  src/PEAR2/nu ﬂ˙•ˇ        PK       í∏:zzoÌ        src/PEAR2/Autoload.phpnu W+AÑ∂        hi
PK       í∏:zzoÌ        src/PEAR2/MultiErrors.phpnu W+AÑ∂        hi
PK       í∏:˙«z≤B   B   #  src/PEAR2/MultiErrors/Exception.phpnu W+AÑ∂        <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}PK       í∏:zzoÌ        src/PEAR2/Exception.phpnu W+AÑ∂        hi
PK         í∏:UZSkﬁ  ﬁ  8                .xmlregistry/packages/pear2.php.net/P2/1.0.0-package.xmlnu W+AÑ∂        PK         êüÎ∑YØ@   @               F  .phar/.metadata.binnu ˇŸA          PK         í∏:¨*ìÿ                  …  src/glooby2nu W+AÑ∂        PK         í∏:            
              src/PEAR2/nu ﬂ˙•ˇ        PK         í∏:zzoÌ                  @  src/PEAR2/Autoload.phpnu W+AÑ∂        PK         í∏:zzoÌ                  â  src/PEAR2/MultiErrors.phpnu W+AÑ∂        PK         í∏:˙«z≤B   B   #            ’  src/PEAR2/MultiErrors/Exception.phpnu W+AÑ∂        PK         í∏:zzoÌ                  j  src/PEAR2/Exception.phpnu W+AÑ∂        PK      …  ¥  @ s:56:".xmlregistry/packages/pear2.php.net/P2/1.0.0-package.xml";.xmlregistry/packages/pear2.php.net/P2/1.1.0RC3-package.xml                                         0000666                 00000002337 11206353254 0016730 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-24</date>
 <time>18:22:20</time>
 <version>
  <release>1.1.0RC3</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>beta</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                                                                                                                 .phar/.metadata.bin                                                                                 0000000                 00000000103 00000000000 0010021 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       s:59:".xmlregistry/packages/pear2.php.net/P2/1.1.0RC3-package.xml";                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/glooby2                                                                                         0000666                 00000000002 11206353254 0006630 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2                                                                                           0000777                 00000000000 11206353254 0006072 5                                                                                                    ustar 00                                                                                                                                                                                                                                                       src/PEAR2/Autoload.php                                                                              0000666                 00000000003 11206353254 0010423 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           0000666                 00000000003 11206353254 0011142 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 0000666                 00000000102 11206353254 0013100 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Exception.php                                                                             0000666                 00000000003 11206353254 0010611 0                                                                                                    ustar 00                                                                                                                                                                                                                                                       hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             <?xml version="1.0" encoding="UTF-8"?>
<channel version="1.0" xmlns="http://pear.php.net/channel-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/channel-1.0 http://pear.php.net/dtd/channel-1.0.xsd">
 <name>pear2.php.net</name>
 <suggestedalias>salty</suggestedalias>
 <summary>unit test channel</summary>
 <servers>
  <primary>
   <rest>
    <baseurl type="REST1.0">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.1">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.3">http://pear2.php.net/rest/</baseurl>
   </rest>
  </primary>
 </servers>
</channel>
<?php
/**
 * In order to test excluding all possible versions
 * 
 * Create a dependency tree like so:
 *
 * P1 -> P2 min 1.1.0, exclude 1.2.0
 * P3 -> P2 max 1.3.0, exclude 1.2.3
 *
 * P2 only has releases for 1.0.0, 1.2.0, 1.2.3, and 1.3.1
 *
 * to test composite dep failure
 */

require __DIR__ . '/../../../../../autoload.php';

set_include_path(__DIR__);
$c = PEAR2_Pyrus_Config::singleton(dirname(__DIR__), dirname(__DIR__) . '/pearconfig.xml');
$c->bin_dir = __DIR__ . '/bin';
restore_include_path();
$c->saveConfig();

$chan = new PEAR2_SimpleChannelServer_Channel('pear2.php.net', 'unit test channel');
$scs = new PEAR2_SimpleChannelServer($chan, __DIR__, dirname(__DIR__));

$scs->saveChannel();

$pf = new PEAR2_Pyrus_PackageFile_v2;

for ($i = 1; $i <= 6; $i++) {
    file_put_contents(__DIR__ . "/glooby$i", 'hi');
}

$pf->name = 'P1';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->version['release'] = '1.0.0';
$pf->stability['release'] = 'stable';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');

$pf->setPackagefile(__DIR__ . '/package.xml');
$save = clone $pf;

$pf->dependencies['required']->package['pear2.php.net/P2']->min('1.1.0')->exclude('1.2.0')->exclude('1.2.3')
    ->recommended('1.3.1')->max('2.0.0');
$pf->files['glooby1'] =  array('role' => 'php');

$p2_1 = clone $save;
$p2_1->name = 'P2';
$p2_1->version['release'] = '1.0.0';
$p2_1->stability['release'] = 'stable';
$p2_1->files['glooby2'] =  array('role' => 'php');

$p2_2 = clone $save;
$p2_2->name = 'P2';
$p2_2->version['release'] = '1.2.0';
$p2_2->stability['release'] = 'stable';
$p2_2->files['glooby3'] =  array('role' => 'php');

$p2_3 = clone $save;
$p2_3->name = 'P2';
$p2_3->version['release'] = '1.2.3';
$p2_3->stability['release'] = 'stable';
$p2_3->files['glooby4'] =  array('role' => 'php');

$p2_4 = clone $save;
$p2_4->name = 'P2';
$p2_4->version['release'] = '1.3.1';
$p2_4->stability['release'] = 'stable';
$p2_4->files['glooby5'] =  array('role' => 'php');

$p3 = clone $save;
$p3->name = 'P3';
$p3->files['glooby6'] =  array('role' => 'php');
$p3->dependencies['required']->package['pear2.php.net/P2']->max('1.3.0')->exclude('1.2.3')->min('1.0.0');

file_put_contents(__DIR__ . '/package.xml', $pf);

$package1 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package1, $xmlcontainer);
$package1->setInternalPackage($xml);
$package1->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package1, 'cellog');

$package2 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p2_1);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package2, $xmlcontainer);
$package2->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p2_1);
$package2->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package2, 'cellog');

$package2 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p2_2);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package2, $xmlcontainer);
$package2->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p2_2);
$package2->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package2, 'cellog');

$package2 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p2_3);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package2, $xmlcontainer);
$package2->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p2_3);
$package2->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package2, 'cellog');

$package2 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p2_4);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package2, $xmlcontainer);
$package2->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p2_4);
$package2->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package2, 'cellog');

$package3 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p3);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package3, $xmlcontainer);
$package3->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p3);
$package3->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package3, 'cellog');

// clean up
unlink(dirname(__DIR__) . '/pearconfig.xml');
unlink(dirname(__DIR__) . '/.config');
for ($i = 1; $i <= 6; $i++) {
    unlink(__DIR__ . "/glooby$i");
}
unlink(__DIR__ . '/package.xml');
foreach (new DirectoryIterator(dirname(__DIR__) . '/.configsnapshots') as $file) {
    if ($file->isDot()) {
        continue;
    }
    unlink($file->getPathName());
}
rmdir(dirname(__DIR__) . '/.configsnapshots');
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.allmaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allmaintainers http://pear.php.net/dtd/rest.allmaintainers.xsd">
 <h xlink:href="rest/m/.svn">.svn</h>
 <h xlink:href="rest/m/cellog">cellog</h>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.maintainer" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.maintainer http://pear.php.net/dtd/rest.maintainer.xsd">
 <n>cellog</n>
 <h>Greg Beaver</h>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<f xmlns="http://pear.php.net/dtd/rest.categorypackageinfo" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.categorypackageinfo http://pear.php.net/dtd/rest.categorypackageinfo.xsd">
 <pi/>
</f>
<?xml version="1.0" encoding="UTF-8"?>
<c xmlns="http://pear.php.net/dtd/rest.category" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.category http://pear.php.net/dtd/rest.category.xsd">
 <n>Default</n>
 <a>Default</a>
 <c>pear2.php.net</c>
 <d>This is the default category</d>
</c>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allcategories" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allcategories http://pear.php.net/dtd/rest.allcategories.xsd">
 <ch>pear2.php.net</ch>
 <c xlink:href="rest/c/Default/info.xml">Default</c>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P3</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P1</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allpackages" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allpackages http://pear.php.net/dtd/rest.allpackages.xsd">
 <p>p1</p>
 <p>p2</p>
 <p>p3</p>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P2</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>17:02:05</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby6"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <min>1.0.0</min>
    <max>1.3.0</max>
    <exclude>1.2.3</exclude>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
a:1:{s:8:"required";a:3:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}s:7:"package";a:5:{s:4:"name";s:2:"P2";s:7:"channel";s:13:"pear2.php.net";s:3:"min";s:5:"1.0.0";s:3:"max";s:5:"1.3.0";s:7:"exclude";s:5:"1.2.3";}}}<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p3">P3</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 17:02:05</da>
 <n>my notes</n>
 <f>1373</f>
 <g>http://pear2.php.net/get/P3-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p3">P3</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 17:02:05</da>
 <n>my notes</n>
 <f>1373</f>
 <g>http://pear2.php.net/get/P3-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P1</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>17:02:04</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby1"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <min>1.1.0</min>
    <max>2.0.0</max>
    <recommended>1.3.1</recommended>
    <exclude>1.2.0</exclude>
    <exclude>1.2.3</exclude>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
a:1:{s:8:"required";a:3:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}s:7:"package";a:6:{s:4:"name";s:2:"P2";s:7:"channel";s:13:"pear2.php.net";s:3:"min";s:5:"1.1.0";s:3:"max";s:5:"2.0.0";s:11:"recommended";s:5:"1.3.1";s:7:"exclude";a:2:{i:0;s:5:"1.2.0";i:1;s:5:"1.2.3";}}}}<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p1">P1</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 17:02:04</da>
 <n>my notes</n>
 <f>1439</f>
 <g>http://pear2.php.net/get/P1-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p1">P1</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 17:02:04</da>
 <n>my notes</n>
 <f>1439</f>
 <g>http://pear2.php.net/get/P1-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}}}<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.3.1</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 17:02:05</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P2-1.3.1</g>
 <x xlink:href="package.1.3.1.xml"/>
</r>
1.3.1a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}}}a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}}}<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>17:02:05</time>
 <version>
  <release>1.3.1</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby5"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.3.1</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 17:02:05</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P2-1.3.1</g>
 <x xlink:href="package.1.3.1.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.2.0</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 17:02:04</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P2-1.2.0</g>
 <x xlink:href="package.1.2.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>17:02:04</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>17:02:05</time>
 <version>
  <release>1.2.3</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby4"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.2.3</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 17:02:05</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P2-1.2.3</g>
 <x xlink:href="package.1.2.3.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.2.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 17:02:04</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P2-1.2.0</g>
 <x xlink:href="package.1.2.0.xml"/>
</r>
a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}}}<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
 </r>
 <r>
  <v>1.2.0</v>
  <s>stable</s>
 </r>
 <r>
  <v>1.2.3</v>
  <s>stable</s>
 </r>
 <r>
  <v>1.3.1</v>
  <s>stable</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.2.3</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 17:02:05</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P2-1.2.3</g>
 <x xlink:href="package.1.2.3.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
 <r>
  <v>1.2.0</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
 <r>
  <v>1.2.3</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
 <r>
  <v>1.3.1</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>17:02:04</time>
 <version>
  <release>1.2.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 17:02:04</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P2-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
1.3.1<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 17:02:04</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P2-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
ã      ÏYKo„6ˆ9øÇ–›‚Cñ‹å“]4Ì%[›Ëm¡H¨M,-©$µ∂QÙøwHK∂‹.ízë:-¢Ô"rúÁRq‚ÌZπT÷ônDÒQ,•≈çÜ≈Õ™â+È=√4f1ôv˙|&gÄíÕfì	Ú ËÙâKíQ HJÊŸ<ôÅÑ&lé&‰ú _ä÷:a&Ñ‹ÔLk±{Jˇ?øÅb¢O“XUW◊çIÑdU‘•™ñ◊—œ?}7˝*∫…ØxW˙£%ãiÑ¿∑≤◊— πfÅk§)]ŸÛiz¥]8a?>‚‘”ê≈ﬁ~k’¡z≥Ÿƒõ$ÆÕ3B(˛Â››˚b%◊b™*®bUH≤jaÉÆ.Ñ©>,–I´xkÀG-Ø˚OÌ¸öÍf∞π∂ øBºkôﬂ3é√ ≈JTï‘˘Iãr‹ã¡¬∂Îµ0ª‹IÎ†ä˜–ï“F5~_ÚïBÉ)«Còj)Jxv)|áz+§x»Ò÷JìRÎ¬Ñâó¬Ê+›âø9d∏ózΩ(ú˙$Ûù¥wcàáªÄºNÊP‡Øß$ù2ây(úÇ∞tæ lAfá)àª]K	´X∞ÚÁ«˝4DmTN`«AÏá>‚—ìîVnw≤åój˘˜uÑnV‚∏Œ–ôkU» J‘öSÊ÷àÎ÷20∏3≥¯¡ñ”n‚ÀÂ?»z˚˛[t∑Úﬁ4–°Ü™ÊÎ
®Dò{Z‘ïìï≥!≈R‰ktaO"ê¸™¥D¶÷ Ú1:≠5^Í∫~ÿ%û\√+÷“@Í%ú
J⁄n{~kïëÂ~mX0_´*O˜;ÔáAã{5˜åç™ıû(ùG ª†'>5ı%8ƒÙT=…»ß–ï^É˜ñ_ΩÙÈ˙ﬂ«ÄˇZå„˝OÁi∏˜˚gvzˇSö•lºˇ/ÅïzÈFº$|ˇﬂﬂæ˘ë·7≠´u-J	=oåß˚?	˝?ci¬2Íd«¿ÿˇ¿Jçó‰k∆±ˇﬂµ⁄©[cjcü˘8´ˇÁ)®g4ˇ˛ø∆˛›¯lˇ„€m!√œrú”ˇ	M@ùQíç˝	å˝ˇ∫qÏˇÁÌ˘!Œ˚˛œ¸˜∆∆˛ø∆˛›∏Ï˝ˇŸˇˇ!JÜøˇ˘Ôˇt>'cˇ_¸*|Uha-
<¯0‡¡áê‹:YïΩÕQ˛˚/˝#Få1‚K'   ˇˇ `&ò
 $  ã      ÏY[o€6Œs~°wãîdYõ¡(m±l/i¨-∞∑ÇëXõ(-i$U€(˙ﬂwHSñåI]dˆÜË{y.<GáÁ#}	7+©¯Bh£∂∏a≈'∂‡7ú©8lñMXqÉÔÖ$$Ø¡Á‚DÑÃ¶”ãdA–·°8Õ"E1II6Àí$QíÄû‰g—j√‘!w[’ÍÏ”ˇOAØa3—gÆ¥®´´ ˆ9@º*ÍRTã´‡˝ªﬂ'ø◊˘%ı[ﬂ[∆a ≠ÙU∞4¶ôc◊5˚¶)MŸı”§∑ù¶?=‡·‘ó≈Œ~£≈ﬁzΩ^áÎ$¨’«ÑD¯Ø◊∑oã%_±â®`´ÇÉósÌÑ∑u¡åKı—`Æµ
7∫|–r∫?jg◊ê®AqÅnA~âh≈V<øK(vKVU\Ê•∏ÉÖnW+¶∂π·⁄¿.R‹	@Wr](—ÿ∫‰KÅSäá:0ïúïÙ)¸áz≈§∏œ—Vsï\ ¬∏âïBÒÖÙ‚˚wR´gÖüyæÂöb?Üxÿ§%3<á˛uB“IL 1+ Ö6 Ê$ûìîb7±Øö[ZqXEÉï- ≈›‘EmDN†‚ ∂C±˜§–?˜B
≥=X∆J%ˇv&õ%Î◊:S)
^iéZuÿπu‚∫UwÏÕ4æ◊ÂƒOÏv˘æFØﬁ˛ÜnwB⁄ô∫v®aWÛ’πÏÑõ€∂®+√+£]ä•P»Ó—UÄmÅ‰£ê©ZÇ»∆Z≠
ºêu}øùÿybpuØ4XöR/·T\˚Ú¸›
≈À›⁄∞† ∫UûÜ±-±:-Ó‘‘v¨#™îªFÒÆŸYt‡Ûçiw yø-‚æ—0£Ëõ£B∂a‚Ñ0‹	˘¶êmi[)Å›‘'ÿgcªc_À¢ÉbŸÍ¯ÓÅ
œ}{Z‡_ã—ﬂˇQñ∫{ø{và˜ˇ‘—,M«˚ˇXäsg0‚ú∞¸øªy˘gå_∂¶ñ5+Ì…˘¥1Á‚¯?ç”$û≈†N¶på¸?ñ‚ørç8z˛øn•7J’J?Òpˇ3¯˛M£4˘
å¸ﬁ¯.ˇÒÕ¶‡ÓáÄ'9	é·%†ûEd6Úˇ˘ˇº—Ûˇi9?ƒqüˇgˆÛˇ,˘å¸ﬁ8Ì˝ˇ›ˇˇPDÜøˇY˛ßYç¸?Ë5Ïe!ô÷»ı¡áA|ÿ˜‚√´≤≥ÈÂ_æû˚Få1bƒœ‡   ˇˇ 	«£$ $  .xmlregistry/packages/pear2.php.net/P2/1.2.0-package.xml                                            100644       0       0         2336 11205076734  21327  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>17:02:04</time>
 <version>
  <release>1.2.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                                                                                                                  src/glooby3                                                                                         100644    1750    1750            2 11205076734  11652  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205076735  15770  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              .xmlregistry/packages/pear2.php.net/P3/1.0.0-package.xml                                            100644       0       0         2571 11205076736  21331  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>17:02:05</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby6"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <min>1.0.0</min>
    <max>1.3.0</max>
    <exclude>1.2.3</exclude>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                       src/glooby6                                                                                         100644    1750    1750            2 11205076734  11655  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205076736  15771  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ã      ÏYKo€8ˆ9øÇ–›"EYÚ÷`î∂hv/iÙÙV0k•%ï§jEˇ˚i…ñ€"YYßEÙ]DŒÉ3‚ÃG
v∏^*-Ê“XΩ¡5œ?Òπ0∏\”∞^‘a),æ¶8
IH∆≠>ü—àI'ì—9t¯Dà∆qä¢àíÑL”i<I”ç»1A~ç±\èπﬁË∆‹bwó˛ªÄb¢/BYïÁ‘9@¢Ã´BñÛÛ‡›€ø«ŸkKø∑§a -Õy∞∞∂ûaﬂ5ª¶)l—ı”xo;≥‹|∫≈√´«>ã≠˝⁄»ùıjµ
WqXÈ9¶ÑD¯˝À´7˘B,˘XñP≈2‡e‰Ãx·UïsÎSΩ3òo√;≠¬µ)nµÏΩÓµsk®ËﬁÊ›ÇÏ±í/EvMˆ‰^ñBee∏ÉÖiñKÆ7ô∆BÓ†+Ñ…µ¨›ædâzSÜ˚:0UÇlS¯	Ù\pHqóbç:ÀÖRÑÒ'ÖÕó™?›e∏ï:=œ≠¸"≤ç0∑càá€Ä¨‡VdP‡'cíå)Åƒú VBÿh:#tF&˚)à€]ÛKk´∞r»p7ıQkôÿqª°ã∏˜d–?7RIª9X∆Iï¯qÆÍﬂØ”wfJÊ¢45˙∞s´ƒU£s·;∏53¯∆„v‚ dØƒ
=Û]mÖ¨3ıÌPAU≥Â˘T¬œ][T••5>≈Bj‰jt`◊D ˘(ï@∫R r1Z≠—9û´™∫Ÿ– {OÆ˛ïzÎA”@Íú
Ròv{>7Rãbª6,Ëà-eô%!u[ÏÜ^ã;5sÎâ™‘∂QZﬂÏ<:˘ﬁ‘ï`”µÍAF.Ö∂D¨#Xvˆ–ßÎÔè^¸o1ˆ˜4M¸Ωﬂ=;–√˚?ä“$ÓˇS`!:É	«ˇÎÀgØ)~÷ÿJUºpó–˝∆∏õˇ±ÁˇÑ&1M)®„	ˇOÄÖ.…«å=ˇ_6  K≠+mÓ˘8äˇ”‘ì(ô¸?˛?n¸îˇ¯rùˇC¿Ωú«?ébPßI˛üˇ7ˆ¸ø_Œ˜q‹˜ÍæˇS:ˇ$¯ˇ∏q⁄˚ˇßˇˇ°à|ˇ˚_ÉÅˇß ªÄ
üÂäÉ||Ëı¡á] ±∂¢,:õΩ¸Î∑á~É+¯  ˇˇ ≥t8â $  ã      ÏYKo„6ˆ9øÇ–›‚Cñ‹å“]4Ì%[›Ëm¡H¨M,-©$µ∂QÙøwHK∂‹.ízë:-¢Ô"rúg>Râ„ÌZπT÷ônDÒQ,•≈çÜ≈Õ™â+È=√4fq2ÌÙ1¯LŒ %$õÕ&‰A–È!ñ$¢îëîÃ≥yíÇÑ&IÇ&‰ú _ä÷:a&Ñ‹ÔLk±{Jˇ?øÅb¢O“XUW◊çIÑdU‘•™ñ◊—œ?}7˝*∫…ØxW˙£%ãiÑ¿∑≤◊— πfÅC◊ö¶teﬂO”£Ì¬	˚Òè†ûÜ,ˆˆ[´÷õÕ&ﬁ$qmñòBÒ/ÔÓﬁ+πSUA´BÇóUÑwu!\Hı…`°ü¥ä∑∂|‘r∫ˇ‘ŒØ°N`õK`Ú+ƒ+±ñ˘=„8@P¨DUIùüPî„^∂]ØÖŸÂNZU‰∏ÄÆî∂0™Ò˚íØL9Í¿TKQ¬≥K·{8$–[) ≈C.à∑VöºêZ◊&Lº6_ÈN¸Õ!√Ω‘ÎE·‘'ôÔ§Â∏C<‹‰•p2á=%ÈîHÃ@·Ñ•Ûaír¶ Óv-,m$¨b¡ üW˜”µQ9Åá˝–G<zrËü•ï€ù,„•Z˛}°õï8Æ3tÊZ≤≤µÊ¥sÎƒuk
:∏3≥¯¡ñ”n‚ÀÂ?»z˚˛[t∑Úﬁ4¥CUÕ◊;Pâ0˜mQWNVŒÜKeêØ—uÑ}Å‰W•%2µëè—i≠)R◊ı√n·‡â¡5º“`=hHΩÑSAI€mœo≠2≤‹ØÜ‚kUÂ)Ï<l±-Ó’‹wl ™÷˚FÈ<B≥z‚ÛWS_ÇCLﬂ™'˘∫¡kû`˘’KüÆˇ}Z‡_ãqºˇÈ<˜~ˇÏ¡˜ˇ‘4K«˚ˇ"X©óŒ`ƒK¬Ûˇ˛ˆÕèøi]≠kQ˙KËyc<Õˇ$∆“Ñe‘…éÅëˇ¿Jçó‰k∆ëˇÔZÌ‘≠1µ±œ|ú≈ˇ9¸˝Og4ùè¸øF˛øn|ñˇ¯v[»èÄg9	Œ·BPgîd#ˇ/ÅëˇØG˛?/Áá8Ô˚?Ûﬂˇ˘å¸›∏Ï˝ˇŸﬂˇ%ÏÙ˜?¯˙üìëˇó øÅ
_ZXãB|Ù¡áC πu≤*{õ£¸˜?^˙Få1bƒó‡O   ˇˇ ˘üva $  ã      ÏY[o€6Œs~°wã§‰Àf0 Z,€K:kÏ≠`$Œ&J]FRµçbˇ}áîd…Kê‘Ö·†àæëÁ¬sƒÛR∞√mÆ¥XIcıW<˝ÃW¬‡JpÖ’∫
aÒ≈4$!ô¥˙|.é %d>ù^\ ÇüEÛEå(ç»å,`8	çc–ìcÇ|/jcπæ ‰nßkÛÑ›s˙ÏäâæmdY\PÁ â"-3Y¨ÆÇè~õ¸\'ó¨-}oÖ4@‡[ò´`mmµƒû5{“d6Î¯4ÈmóñõœOxxıƒg—ÿoç‹[o6õpá•^·àäˇzw˚>]ãúOdU,R^F.çﬁñ)∑>’gÉy>knMˆ§Â‡uø’Œ≠†V†õÌ$óà<…eÿ@êÆyQï¥(√ù,LùÁ\Ô+åÖ*2‹	@ó	ìjYπ}I÷¶u`™œ‡Ÿ¶;Ë≠‡ê‚>ƒj#tí
•J„'N
õ/U+˛eüa#uzûZ˘E$;an«∑Y∆≠H†¿?O»lHÃ	@a%Ñ•ã%âñd ∞üÇ∏›5ø¥∞ä+∑ÅwSµí	Å±∫àΩ'˛‹K%ÌÓ`'U‚·:\UkﬁØ3tfJ¶¢0’˙êπe‚≤÷©nÕæ7Ÿ§ù∏r…bÉﬁæˇ›6B÷ôz:îP’$ﬂ!?ÄJ¯π£EYXQX„SÃ§FÆFWv$…ﬂR	§K"£’ù‚ï*À˚∞˜ƒ‡Í_i∞êRœ‡Tê¬¥€ÛO-µ»öµaA?@,óE2#∑≈nËµ∏S3«Xﬂ®J5Di=<Ÿ9=y`⁄@≠_”QOEÙù—§∫p ‰€&¬∞jëñyÓ^<è8§éΩ®1€T’ô„õÎn˙P*ºè[xø°Æ∂€ÌoÀ?®—¿Ò$ÁˇÄ'YÔ1Ù˜?]Ã¸Ωﬂ=;Dá˜?•ÛŸxˇük˘“åxI∏˛øªyÛgÑﬂ‘∂T%œ‹…y⁄œ˜Û˝?çfq4è@O·˚ˇXÀ”‹##~LÙ˝ˇÆVVﬁh]js‚#‡®˛_Ã@=•≥≈ÿˇÁ¿ÿˇØèˆ?æŸ¶¬ˇpíì‡ò˛èiÍ9%Û±ˇœÅ±ˇ_7˙˛?mœq‹˜ˇ‹}ˇœ£±ˇœÇ±ˇ_7Œ{ˇ?˙ˇ¢‰ˇøˇÕ`0ˆˇ9¿Æ°¬ó©‚∆ œÉO|⁄Û â≠E÷ŸÙÚØˇæÙå1bƒàÔ¡   ˇˇ Cî|Æ $  .xmlregistry/packages/pear2.php.net/P2/1.2.3-package.xml                                            100644       0       0         2336 11205076735  21333  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>17:02:05</time>
 <version>
  <release>1.2.3</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby4"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                                                                                                                  src/glooby4                                                                                         100644    1750    1750            2 11205076734  11653  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205076735  15770  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ã      ÏYKo„6ˆ9øÇ–›‚Cñ‹å“]4Ì%[›Ëm¡H¨M,-©$µ∂QÙøwHK∂‹.ízë:-¢Ô"rúg>Râ„ÌZπT÷ônDÒQ,•≈çÜ≈Õ™â+È=√4Nb:ÌÙ1¯LŒ %$õÕ&‰A–È!ñ$¢îëîÃ≥yíÇÑ&	CrNê/Ekù0BÓw¶µèÿ=•ˇüÇﬂ@1—'i¨™´Îà∆$B≤*ÍRUÀÎËÁüæõ~›‰Wº+˝—í≈4B‡[ŸÎhÂ\≥¿°kMS∫≤ÔßÈ—v·Ñ˝¯àGPOC{˚≠UÎÕfoí∏6KÃ°¯ówwÔãï\ã©™†äU!¡À™Ö¬ª∫.§˙d∞–ÜOZ≈[[>j9x›jÁ◊åP'0ÉÕ%∞˘‚ïXÀ¸ûq (V¢™§ŒO( q/€Æ◊¬Ïr'≠É*r‹@WJ[’¯}…W
¶u`™•(·Ÿ•=Ë≠ê‚!ƒ[+M^H≠k&^
õØt'˛Êê·^Íı¢pÍìÃw“r‹ç!ÓÚR8ôCÅøûít $Ê†p
¬“˘Ç∞I9Swªñ6V±`Âœ+é˚ià⁄®ú¿é√Ç~Ë#=9ÙœÉ“ ÌNñÒR-ˇæé–ÕJ◊:s≠
YYâZs⁄πu‚∫5Ö‹ôY¸`Ài7ÒÂåÚ‰Ω}ˇ-∫€yo⁄°Ü™ÊÎ
®Dò˚∂®+'+gCä•2»◊Ë:¬æâ@Ú´“ôZÉ»«Ë¥÷x©Î˙aóF8xbpØ4XöR/·TP“v€Û[´å,˜k√ÇaÄ¯ZUy3ø≈~¥∏Wsﬂ±Å®ZÔ•ÛÕ.Ëâœ_M}	1}´ûd‰SËJØ¡{ÇÂW/}∫˛˜1hÅ-∆Ò˛ßÛ4‹˚˝≥‹ˇ3P”,ùç˜ˇ%∞R/ù¡àóÑÁˇ˝Ìõ~”∫Z◊¢Ùó–Û∆xöˇI‡ˇå•	À®ìY2Úˇ"X©Òí|Õ8Úˇ]´ù∫5¶6ˆôèÄ≥¯?áøˇÈå¶Ûëˇó¿»ˇ◊çœÚﬂn˛,'¡9¸OhÍåíl‰ˇ%0Úˇu„»ˇÁÂ¸Á}ˇg˛˚?c#ˇ/ÇëˇØóΩˇ?˚˚¢Ñù˛˛_ˇs2Úˇ‡7P·´BkQËÉÉ>¯pË$∑NVeosîˇ˛«Kø¡à#Få¯¸	  ˇˇ †g◊ó $  .xmlregistry/packages/pear2.php.net/P2/1.0.0-package.xml                                            100644       0       0         2336 11205076734  21325  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>17:02:04</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                                                                                                                  src/glooby2                                                                                         100644    1750    1750            2 11205076734  11651  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205076734  15767  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              .xmlregistry/packages/pear2.php.net/P2/1.3.1-package.xml                                            100644       0       0         2336 11205076735  21332  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>17:02:05</time>
 <version>
  <release>1.3.1</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby5"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                                                                                                                  src/glooby5                                                                                         100644    1750    1750            2 11205076734  11654  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205076735  15770  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              .xmlregistry/packages/pear2.php.net/P1/1.0.0-package.xml                                            100644       0       0         2673 11205076734  21330  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P1</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>17:02:04</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby1"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <min>1.1.0</min>
    <max>2.0.0</max>
    <recommended>1.3.1</recommended>
    <exclude>1.2.0</exclude>
    <exclude>1.2.3</exclude>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                     src/glooby1                                                                                         100644    1750    1750            2 11205076734  11650  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205076734  15767  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <?xml version="1.0" encoding="UTF-8"?>
<channel version="1.0" xmlns="http://pear.php.net/channel-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/channel-1.0 http://pear.php.net/dtd/channel-1.0.xsd">
 <name>pear2.php.net</name>
 <suggestedalias>salty</suggestedalias>
 <summary>unit test channel</summary>
 <servers>
  <primary>
   <rest>
    <baseurl type="REST1.0">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.1">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.2">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.3">http://pear2.php.net/rest/</baseurl>
   </rest>
  </primary>
 </servers>
</channel>
<?php
/**
 * Test features of remote packages
 */

require __DIR__ . '/../../../../../autoload.php';

set_include_path(__DIR__);
$c = PEAR2_Pyrus_Config::singleton(dirname(__DIR__), dirname(__DIR__) . '/pearconfig.xml');
$c->bin_dir = __DIR__ . '/bin';
restore_include_path();
$c->saveConfig();

$chan = new PEAR2_SimpleChannelServer_Channel('pear2.php.net', 'unit test channel');
$scs = new PEAR2_SimpleChannelServer($chan, __DIR__, dirname(__DIR__));

$scs->saveChannel();

$pf = new PEAR2_Pyrus_PackageFile_v2;

for ($i = 1; $i <= 6; $i++) {
    file_put_contents(__DIR__ . "/glooby$i", 'hi');
}

$pf->name = 'GetMaintainers_Test';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->version['release'] = '1.0.0';
$pf->stability['release'] = 'stable';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');
$pf->maintainer['foo1']->role('developer')->email('foo1@example.com')->active('yes')->name('Foo One');
$pf->maintainer['foo2']->role('developer')->email('foo2@example.com')->active('yes')->name('Foo Two');
$pf->maintainer['foo3']->role('contributor')->email('foo3@example.com')->active('yes')->name('Foo Three');
$pf->maintainer['foo4']->role('helper')->email('foo4@example.com')->active('yes')->name('Foo Four');

$pf->setPackagefile(__DIR__ . '/package.xml');
$pf->files['glooby1'] = array('role' => 'php');
file_put_contents(__DIR__ . '/package.xml', $pf);

$package1 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package1, $xmlcontainer);
$package1->setInternalPackage($xml);
$package1->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package1, 'cellog');

// clean up
unlink(dirname(__DIR__) . '/pearconfig.xml');
unlink(dirname(__DIR__) . '/.config');
for ($i = 1; $i <= 6; $i++) {
    unlink(__DIR__ . "/glooby$i");
}
unlink(__DIR__ . '/package.xml');
foreach (new DirectoryIterator(dirname(__DIR__) . '/.configsnapshots') as $file) {
    if ($file->isDot()) {
        continue;
    }
    unlink($file->getPathName());
}
rmdir(dirname(__DIR__) . '/.configsnapshots');
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.maintainer" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.maintainer http://pear.php.net/dtd/rest.maintainer.xsd">
 <n>foo4</n>
 <h>Foo Four</h>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.maintainer" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.maintainer http://pear.php.net/dtd/rest.maintainer.xsd">
 <n>foo2</n>
 <h>Foo Two</h>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.allmaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allmaintainers http://pear.php.net/dtd/rest.allmaintainers.xsd">
 <h xlink:href="rest/m/foo4">foo4</h>
 <h xlink:href="rest/m/.svn">.svn</h>
 <h xlink:href="rest/m/foo2">foo2</h>
 <h xlink:href="rest/m/cellog">cellog</h>
 <h xlink:href="rest/m/foo3">foo3</h>
 <h xlink:href="rest/m/foo1">foo1</h>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.maintainer" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.maintainer http://pear.php.net/dtd/rest.maintainer.xsd">
 <n>cellog</n>
 <h>Greg Beaver</h>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.maintainer" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.maintainer http://pear.php.net/dtd/rest.maintainer.xsd">
 <n>foo3</n>
 <h>Foo Three</h>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.maintainer" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.maintainer http://pear.php.net/dtd/rest.maintainer.xsd">
 <n>foo1</n>
 <h>Foo One</h>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<f xmlns="http://pear.php.net/dtd/rest.categorypackageinfo" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.categorypackageinfo http://pear.php.net/dtd/rest.categorypackageinfo.xsd">
 <pi/>
</f>
<?xml version="1.0" encoding="UTF-8"?>
<c xmlns="http://pear.php.net/dtd/rest.category" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.category http://pear.php.net/dtd/rest.category.xsd">
 <n>Default</n>
 <a>Default</a>
 <c>pear2.php.net</c>
 <d>This is the default category</d>
</c>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allcategories" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allcategories http://pear.php.net/dtd/rest.allcategories.xsd">
 <ch>pear2.php.net</ch>
 <c xlink:href="rest/c/Default/info.xml">Default</c>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allpackages" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allpackages http://pear.php.net/dtd/rest.allpackages.xsd">
 <p>getmaintainers_test</p>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>GetMaintainers_Test</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
 <m>
  <h>foo1</h>
  <a>yes</a>
  <r>developer</r>
 </m>
 <m>
  <h>foo2</h>
  <a>yes</a>
  <r>developer</r>
 </m>
 <m>
  <h>foo4</h>
  <a>yes</a>
  <r>helper</r>
 </m>
 <m>
  <h>foo3</h>
  <a>yes</a>
  <r>contributor</r>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>GetMaintainers_Test</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>GetMaintainers_Test</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
 <m>
  <h>foo1</h>
  <a>yes</a>
 </m>
 <m>
  <h>foo2</h>
  <a>yes</a>
 </m>
 <m>
  <h>foo4</h>
  <a>yes</a>
 </m>
 <m>
  <h>foo3</h>
  <a>yes</a>
 </m>
</m>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>GetMaintainers_Test</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <developer>
  <name>Foo One</name>
  <user>foo1</user>
  <email>foo1@example.com</email>
  <active>yes</active>
 </developer>
 <developer>
  <name>Foo Two</name>
  <user>foo2</user>
  <email>foo2@example.com</email>
  <active>yes</active>
 </developer>
 <contributor>
  <name>Foo Three</name>
  <user>foo3</user>
  <email>foo3@example.com</email>
  <active>yes</active>
 </contributor>
 <helper>
  <name>Foo Four</name>
  <user>foo4</user>
  <email>foo4@example.com</email>
  <active>yes</active>
 </helper>
 <date>2009-05-22</date>
 <time>14:33:26</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby1"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}}}<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>GetMaintainers_Test</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>GetMaintainers_Test</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/getmaintainers_test">GetMaintainers_Test</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-22 14:33:26</da>
 <n>my notes</n>
 <f>1744</f>
 <g>http://pear2.php.net/get/GetMaintainers_Test-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/getmaintainers_test">GetMaintainers_Test</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-22 14:33:26</da>
 <n>my notes</n>
 <f>1744</f>
 <g>http://pear2.php.net/get/GetMaintainers_Test-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
.xmlregistry/packages/pear2.php.net/GetMaintainers_Test/1.0.0-package.xml                           100644       0       0         3354 11205577006  24754  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>GetMaintainers_Test</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <developer>
  <name>Foo One</name>
  <user>foo1</user>
  <email>foo1@example.com</email>
  <active>yes</active>
 </developer>
 <developer>
  <name>Foo Two</name>
  <user>foo2</user>
  <email>foo2@example.com</email>
  <active>yes</active>
 </developer>
 <contributor>
  <name>Foo Three</name>
  <user>foo3</user>
  <email>foo3@example.com</email>
  <active>yes</active>
 </contributor>
 <helper>
  <name>Foo Four</name>
  <user>foo4</user>
  <email>foo4@example.com</email>
  <active>yes</active>
 </helper>
 <date>2009-05-22</date>
 <time>14:33:26</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby1"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                                                                                                    src/glooby1                                                                                         100644       0       0          117 11205577006  11523  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  /home/user/workspace/all/Pyrus/tests/Mocks/Internet/temp/pyrpackage/src/glooby1                                                                                                                                                                                                                                                                                                                                                                                                                                                 src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205577006  15765  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ã      ÏX€n„6ÕsæÇ–ªE],ª5ew—§(ê¥ãn
Ù-`§Yõ%™$€(˙Ô“í/âì¨[Ø∑Et √“Ãêgƒ·—ˆÁ•P0Ê⁄®≠Y~œ∆†iLE~=©˝
˝Ã5„ï¡(}{⁄––¸†◊qíìÁ¡†ﬂ?9!Ÿ˛&$éì>	√(Hí·C	â˙C4ù/Ãy0LµaÍ$>.‘Tø˜öˇäÙkG∞Æ\Vgñ’#PÂ≤‡’¯Ã˚ÌÊ≤˜ùwûù¶M•◊ëëz«V˙ÃõSè®€5´MSò¢›OΩuÏ»0}ˇ¬ÁÓπ,ñÒsÕW—≥ŸÃü≈æTcAHøæ˙îO†d=^a´pîÊ#ÌåW2g∆•˙*ô€ÜØF˘s]ºπÒ∏_gÁÙHcPããÍÚ≤SíV¨Ñlá SÍ<ëOXUÅ»∂4õ“÷åzZñL-2É„∞¨)mË+@Áä◊v°≤	'∑)›Ùa® V‡wõvÚÊº Ö§S*ÀAâ4Ó∆Z±\4Êw´óVÎgπ·ê-@ß¥πF>⁄bé d›LÊ∏.•$øTò˘≥î·^k|sV÷¸\ñ_¿º…¯˝ÕLÓ†èv—GˇÜ>óïQ¸nj‰„&
v≠@º+Öxœ∂Y”	à'p)ßOJèL˝]Ù˝=ÈW|i¡d(˜Ô{A“ãpyùÜ#qÿ≈Ò(§‘›¢π—êõ\n!çQVN)mooÕ≥ ıáf{i9◊#SÏ&w\p≥ÿö∆Z<ùáâz¬÷ÛlNœ°“@¶jªèau+çòÉÎgMò¶w∫Ë57VÀ^ˆ3Ã»áO?ê´•1mC]sê(È¨\wÅµp˜ÕûÅ hób¡±U:Û®m)h˘Ã%ö,G„’*ßc!Â›"Ù®IqËj74Û°0ıﬂt≥<LπÇb97NË.HZÚ*K¸».±Ωt^⁄∫S€Æ\€bπYöÆı±pkÃ„P[ÇßïÀVF6Ö¶D¯i€n≥”o˝Æ˝/b£Ë_ç„ïÛû˝Ü€Áø0L¢∏;ˇt"KpõŒ§∫◊(†(4Íûó⁄#É¶◊2ø◊Ù'Ï ûaî5≠™=∆Íu`k˜Ò‚˝Ø}èÔz!Ya_;áÂXÎ?&N˜ÌwãÿÈø%q4à–˜„Ó˜ﬂQ0·›kÒ-c≠ˇÎ©0¸B)©ÙÅ[¿^˙&ËÓá…∞”ˇ1–Èˇmcß˛È≈<˜øœA:¡>˙è√›Ét˙?:˝øm¨ıXÕobøÛø˝˝¢NˇGAßˇ∑ç„æˇü˘ˇ/à˝ˇóIßˇc =«
üÊÇiM‹>∏›ÿ∑´}@`n†*⁄òµ˝œøæıtË–°CáÇø  ˇˇ Yp—ï &  <?xml version="1.0" encoding="UTF-8"?>
<channel version="1.0" xmlns="http://pear.php.net/channel-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/channel-1.0 http://pear.php.net/dtd/channel-1.0.xsd">
 <name>pear2.php.net</name>
 <suggestedalias>salty</suggestedalias>
 <summary>unit test channel</summary>
 <servers>
  <primary>
   <rest>
    <baseurl type="REST1.0">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.1">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.3">http://pear2.php.net/rest/</baseurl>
   </rest>
  </primary>
 </servers>
</channel>
<?php
/**
 * Create a dependency tree like so:
 *
 * P1 -> P2 >= 1.2.0
 * P3 -> P2 <= 1.1.0
 *
 * to test composite dep failure
 */

require __DIR__ . '/../../../../../autoload.php';

set_include_path(__DIR__);
$c = PEAR2_Pyrus_Config::singleton(dirname(__DIR__), dirname(__DIR__) . '/pearconfig.xml');
$c->bin_dir = __DIR__ . '/bin';
restore_include_path();
$c->saveConfig();

$chan = new PEAR2_SimpleChannelServer_Channel('pear2.php.net', 'unit test channel');
$scs = new PEAR2_SimpleChannelServer($chan, __DIR__, dirname(__DIR__));

$scs->saveChannel();

$pf = new PEAR2_Pyrus_PackageFile_v2;

for ($i = 1; $i <= 3; $i++) {
    file_put_contents(__DIR__ . "/glooby$i", 'hi');
}

$pf->name = 'P1';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->version['release'] = '1.0.0';
$pf->stability['release'] = 'stable';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');

$pf->setPackagefile(__DIR__ . '/package.xml');
$save = clone $pf;

$pf->dependencies['required']->package['pear2.php.net/P2']->min('1.2.0');
$pf->files['glooby1'] =  array('role' => 'php');

$p2 = clone $save;
$p2->name = 'P2';
$p2->version['release'] = '1.2.1';
$p2->stability['release'] = 'stable';
$p2->files['glooby2'] =  array('role' => 'php');

$p3 = clone $save;
$p3->name = 'P3';
$p3->files['glooby3'] =  array('role' => 'php');
$p3->dependencies['required']->package['pear2.php.net/P2']->max('1.1.0');
$p3->files['glooby3'] =  array('role' => 'php');

file_put_contents(__DIR__ . '/package.xml', $pf);

$package1 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package1, $xmlcontainer);
$package1->setInternalPackage($xml);
$package1->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package1, 'cellog');

$package2 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p2);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package2, $xmlcontainer);
$package2->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p2);
$package2->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package2, 'cellog');

$package3 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p3);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package3, $xmlcontainer);
$package3->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p3);
$package3->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package3, 'cellog');

// clean up
unlink(dirname(__DIR__) . '/pearconfig.xml');
unlink(dirname(__DIR__) . '/.config');
for ($i = 1; $i <= 3; $i++) {
    unlink(__DIR__ . "/glooby$i");
}
unlink(__DIR__ . '/package.xml');
foreach (new DirectoryIterator(dirname(__DIR__) . '/.configsnapshots') as $file) {
    if ($file->isDot()) {
        continue;
    }
    unlink($file->getPathName());
}
rmdir(dirname(__DIR__) . '/.configsnapshots');
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.allmaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allmaintainers http://pear.php.net/dtd/rest.allmaintainers.xsd">
 <h xlink:href="rest/m/cellog">cellog</h>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.maintainer" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.maintainer http://pear.php.net/dtd/rest.maintainer.xsd">
 <n>cellog</n>
 <h>Greg Beaver</h>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<f xmlns="http://pear.php.net/dtd/rest.categorypackageinfo" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.categorypackageinfo http://pear.php.net/dtd/rest.categorypackageinfo.xsd">
 <pi/>
</f>
<?xml version="1.0" encoding="UTF-8"?>
<c xmlns="http://pear.php.net/dtd/rest.category" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.category http://pear.php.net/dtd/rest.category.xsd">
 <n>Default</n>
 <a>Default</a>
 <c>pear2.php.net</c>
 <d>This is the default category</d>
</c>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allcategories" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allcategories http://pear.php.net/dtd/rest.allcategories.xsd">
 <ch>pear2.php.net</ch>
 <c xlink:href="rest/c/Default/info.xml">Default</c>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P3</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P1</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allpackages" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allpackages http://pear.php.net/dtd/rest.allpackages.xsd">
 <p>p1</p>
 <p>p2</p>
 <p>p3</p>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P2</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>16:20:46</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <max>1.1.0</max>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
a:1:{s:8:"required";a:3:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}s:7:"package";a:3:{s:4:"name";s:2:"P2";s:7:"channel";s:13:"pear2.php.net";s:3:"max";s:5:"1.1.0";}}}<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p3">P3</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 16:20:46</da>
 <n>my notes</n>
 <f>1323</f>
 <g>http://pear2.php.net/get/P3-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p3">P3</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 16:20:46</da>
 <n>my notes</n>
 <f>1323</f>
 <g>http://pear2.php.net/get/P3-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P1</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>16:20:46</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby1"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <min>1.2.0</min>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
a:1:{s:8:"required";a:3:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}s:7:"package";a:3:{s:4:"name";s:2:"P2";s:7:"channel";s:13:"pear2.php.net";s:3:"min";s:5:"1.2.0";}}}<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p1">P1</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 16:20:46</da>
 <n>my notes</n>
 <f>1323</f>
 <g>http://pear2.php.net/get/P1-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p1">P1</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 16:20:46</da>
 <n>my notes</n>
 <f>1323</f>
 <g>http://pear2.php.net/get/P1-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.2.1</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 16:20:46</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P2-1.2.1</g>
 <x xlink:href="package.1.2.1.xml"/>
</r>
1.2.1a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}}}<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>16:20:46</time>
 <version>
  <release>1.2.1</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.2.1</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 16:20:46</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P2-1.2.1</g>
 <x xlink:href="package.1.2.1.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.2.1</v>
  <s>stable</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.2.1</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
1.2.1<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
ã      ÏYKo€8ˆ9øÇ–›")ŸÚ÷`î∂ÿ¥ótÙÙV0k•%-I’6ä˝Ô;§%Knã§Œf—w∞»ypHŒ|§eáõï“b!ç’[\ÒÏ_É+¡uVÀ*,Ñ≈◊1¶!	…∏—á‡3:îêd2çêAáOÑ¢)ô!J#O¯H@Bc:C#rLê˚¢6ñÎ!◊[]õ[ÏÓ“ˇ¶`êLÙUh#À‚<Ä<HYôÀbq|xˇj¸Gpëû±&ıùe“ ÅoaŒÉ•µ’˚™ŸMnÛ∂û∆ùÌ‹rÛÂØ˚YÏÏ7FÓ≠◊Îu∏é√R/pD≈ﬂ\ΩÀñb≈«≤Ä,ô /#Á∆Ø å[?’;É˘2º”*‹ò¸VÀﬁr’Œç†F†{õt“3ƒ
æÈuÃ∞oÄ [Ú¢*=†(√≠,LΩZqΩM≠0≤»p+ ].L¶eÂˆ%]J‘Î2‹◊Å©<ág3Ö◊pH†óÇ√˜sA¨6BßôP™Ñ0æ„§∞˘R5‚Á˚Ó§Nœ3+øät+√M‚·& Àπ)$¯ŸòL«Åâ9(¨Ñ∞4ôGd>Iˆ]7ªÊá÷F1`Â6ê·∂Î£V2%∞„ vM±ÛdP?7RIª=∆Iï¯qÆ™%Ô∆È;3%3QÅj}Xπe‚≤÷ô‹ò|cÚq”qÈ“øƒΩ|˜'∫⁄	YkÍÀ°Ñ¨¶´-Ú»ÑÔª≤(+
k¸s©ëÀ—yÄ]Å‰≥TÈRÅ»≈h¥Fgx° Úfÿ{bpıKÍçESœ·Tê¬4€Ûw-µ»wc√ÄæÅÿJÈ4å‹ª¶◊‚VÕ\≈z¢*µ+î∆√;ß>?ò∂P„∑£E‘ï"˙f¯Ä|≈·´¿5õp›ÿ.◊˚≈9N,›≠µ©ÿØû„c„˜FØ˛∑›˝OgSÔ∑œ—·˝Oi2âá˚ˇX «û¡Ä«Ñ„ˇıÂã∑~Q€Rï<w'Á√∆∏õˇ±Áˇ$ö∆QÅ:ûƒìÅˇß¿R˛æw◊ÄˇééˇojeÂ•÷•6|≈ˇŸ‘:ﬁˇOÇÅˇO?Â?æ‹d¬ˇ '¡1¸èiÍÑíd‡ˇ)0ˇi£„ˇ√ræè„æˇª˜ˇ8â˛üˇü6N{ˇˇÙˇ?D…˜øˇMg	¯
∞»Y¶∏1»◊¡ß^|⁄◊+äºµÈ‰ﬂ˛yÏ0`¿Ä˚‡_   ˇˇ Ä+sm $  .xmlregistry/packages/pear2.php.net/P2/1.2.1-package.xml                                            100644       0       0         2336 11205072056  21321  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>16:20:46</time>
 <version>
  <release>1.2.1</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                                                                                                                  src/glooby2                                                                                         100644    1750    1750            2 11205072056  11642  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205072056  15760  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              .xmlregistry/packages/pear2.php.net/P3/1.0.0-package.xml                                            100644       0       0         2507 11205072056  21317  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>16:20:46</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <max>1.1.0</max>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                         src/glooby3                                                                                         100644    1750    1750            2 11205072056  11643  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205072056  15760  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ã      ÏYﬂo€6ˆs˛
BÔI…í7ÉQ÷bŸ^“!X7`o#q6QZ“H™∂QÏﬂëñ,y)í:À—˜`ë˜Éw‚›G&v∏]+-ñ“XΩ√5œ?Ú•0∏\GaΩ™√RX|K1IH¶≠>ü…	†Ñ§≥ŸdÇ:~"%dé(ç<·#	çiÇ&‰î OEc,◊Bnw∫1ÿ=¶ˇF¡Æ†òËì–FVÂe uê(Û™êÂÚ2¯˝∑ü¶ﬂWŸkKﬂ[F!¯ñÊ2XY[/∞ÔöC”∂Ë˙i⁄€.,7Í©œboø5Ú`ΩŸl¬MVzâ#B(˛„›Õ˚|%÷|*K®bô2raº¶ πı©>Ã∑·£V·÷Z^˜kÌ‹öjz∞π@∑ ª@¨‰kë›RÜ˝ ˘äó•PŸEÓƒ`aöıöÎ]fÖ±PEÜ;Ë
ar-k∑/ŸJ¢¡î·°Lï‡<€~ÜCΩR<‰ÇXcÑŒr°Ta¸ƒIaÛ•j≈?2‹KùûÁV~ŸNÜ€1ƒ√m@Vp+2(˜SíL#â9(¨Ñ∞4]Dd1KˆS∑ªÊó÷V1`Â6ê·nÍ£÷2#∞„ vC±˜d–?wRIª;Z∆Iï∏øWıä˜Îùôíπ(ç@ç>Ó‹™q’Ë\¯nÕæ3≈¥ù∏rŸ/bÉﬁæˇ›ÏÖ¨3ıÌPAU≥ı˘T¬œ][T••5>≈Bj‰jt`◊D ˘S*Åt•@‰b¥Z£sºTUu∑£ˆû\˝+÷É¶Å‘8§0Ìˆ¸’H-ä˝⁄∞† ∂ñeñÑë€b7ÙZ‹©ôÎXOT•ˆç“z¯fÁÙ»Áûiw µ~{ZD}+¢Ø`FêﬁK±_€’˙réGØÓﬁµÌÿØÅ„K„O∆†˛∑˝˝OÁâø˜ªgáË¯˛ß4ù—Ò˛?VÚ•3Òíp¸øΩ~ÛkÑﬂ4∂R/‹…˘º1ÁÏ˘?ãí8J#P«≥x6ÚˇX…o˜ÓÒﬂ—Ûˇ]£¨º÷∫“ÊôèÄì¯?O@=£…|‰ˇ90Úˇu„ã¸«◊€\¯/ûÂ$8Öˇ1çAùRíé¸?F˛ønÙ¸^Œq⁄ﬂˇÓˇˇ8çF˛ü#ˇ_7Œ{ˇÒ˜?D…øøˇKÊ)˘∞+®EÆ∏1»˜¡áA|8Ù[+ ¢≥ÈÂüˇ~È71bƒàO¡?   ˇˇ `∑ˆ∫ $  ã      ÏY[o€6ˆs~°wãŸÚf0J[,€K:kÏ≠`$÷&JKI’6ä˝˜“í-wE2ô”"˙,Ú\xéxæC&vºYi# :≥≈µ»?äÖ¥∏ñ¬∞∏^÷q)æeò∆,¶„VÉœËPB“…d4B?bIí"Jôí|§ °	£hDN	Ú≠h¨fD»Ì÷4ˆªáÙ?(¯}í∆™™ºåhL"$Àº*Tπ∏åﬁΩ˝u¸Stï]∂ÙK‡CÑ¿∑¥ó—“πzékˆ§)\—Òi|∞ù;a?ﬁ„‘„ê≈Œ~c’ﬁzΩ^«Î$ÆÃ3B(˛ÛıÕõ|)Wb¨J®bôK≤jnÉ¶ Ö©>,–A´xcã{-{Ø˚_Ì¸öj¶∑π∂ ª@º+ô›2é√ ˘Rî•‘ŸQãr‹â¡¬6´ï0€ÃIÎ†äw–“ÊF’~_≤•BΩ)«}òj)
x∂)¸áz%§∏œÒ∆JìÂRÎ
¬Ñâó¬Ê+›ä_Ï3‹IΩ^‰N}íŸVZé€1ƒ√m@^'3(œc23ây(úÇ∞4ù32ü§á)à€]K	´X∞ÚÁ«›4D≠UF`«aA?Ùû¯sß¥r€£eºTÀØ#tΩáu˙Œ\´\ñV¢∆3∑™A\5&óÅ¡≠ô≈w∂∑_Œ(˚]Æ—´7ø†õùêw¶ÅT5[mQ@%¬‹”¢*ù,ù)  _£À{Å‰É“ôJÉ»«hµ÷‰x°´ÍnÀ"<1∏ÜWÍ≠§Å‘8î¥Ìˆ¸’(#ã›⁄∞` æRe6Öùá-ˆ√†≈ùö{∆ÜF’zGî÷#ê]–#ü/M}	ˆ1=Uè2Ú)¥%Ç◊‡]ÉeO}∫~ˇËQ‡ãq∏ˇÈlÓ˝ÓŸÅﬂˇî¶6‹ˇÁ¿R=uûæˇoØ_˛¡À∆U∫ÖøÑ7∆√˝üÑ˛ü∞i¬RÍdíLÜ˛?ñj∏$ü3˝ˇ∫—N]S˚»G¿I˝?õÇzBß≥°ˇœÅ°ˇü7æ⁄ˇ¯zìÀE¿£úßÙBPßî§CˇüCˇ?o˙ˇq{æè”˛˛˜ˇˇ')˙ˇ,˙ˇy„º˜ˇWˇCî|˘˝ﬂtñí°ˇœ~æ»µ∞ºÔÒ‡˝ûHnú,ãŒÊ ˇ¸˜Sø¡Ä¯¸  ˇˇ Û{' $  .xmlregistry/packages/pear2.php.net/P1/1.0.0-package.xml                                            100644       0       0         2507 11205072056  21315  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P1</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>16:20:46</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby1"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <min>1.2.0</min>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                         src/glooby1                                                                                         100644    1750    1750            2 11205072056  11641  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205072056  15760  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <?xml version="1.0" encoding="UTF-8"?>
<channel version="1.0" xmlns="http://pear.php.net/channel-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/channel-1.0 http://pear.php.net/dtd/channel-1.0.xsd">
 <name>pear2.php.net</name>
 <suggestedalias>salty</suggestedalias>
 <summary>unit test channel</summary>
 <servers>
  <primary>
   <rest>
    <baseurl type="REST1.0">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.1">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.3">http://pear2.php.net/rest/</baseurl>
   </rest>
  </primary>
 </servers>
</channel>
<?php
/**
 * Create a dependency tree like so:
 *
 * P1 -> P2 >= 1.2.0 (1.2.3 is latest version)
 *
 * P2 1.2.3 -> P3
 *          -> P5
 *
 * P2 1.2.2 -> P3
 *
 * P3
 *
 * P4 -> P2 != 1.2.3
 *
 * P5
 *
 * This causes a conflict when P1 and P4 are installed that must resolve to installing:
 *
 * P1
 * P2 1.2.2
 * P3
 * P4
 */

require __DIR__ . '/../../../../../autoload.php';

set_include_path(__DIR__);
$c = PEAR2_Pyrus_Config::singleton(dirname(__DIR__), dirname(__DIR__) . '/pearconfig.xml');
$c->bin_dir = __DIR__ . '/bin';
restore_include_path();
$c->saveConfig();

$chan = new PEAR2_SimpleChannelServer_Channel('pear2.php.net', 'unit test channel');
$scs = new PEAR2_SimpleChannelServer($chan, __DIR__, dirname(__DIR__));

$scs->saveChannel();

$pf = new PEAR2_Pyrus_PackageFile_v2;

for ($i = 1; $i <= 5; $i++) {
    file_put_contents(__DIR__ . "/glooby$i", 'hi');
}

$pf->name = 'P1';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->version['release'] = '1.0.0';
$pf->stability['release'] = 'stable';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');

$pf->setPackagefile(__DIR__ . '/package.xml');
$save = clone $pf;

$pf->dependencies['required']->package['pear2.php.net/P2']->min('1.2.0');
$pf->files['glooby1'] =  array('role' => 'php');

$p2_3 = clone $save;
$p2_3->name = 'P2';
$p2_3->version['release'] = '1.2.3';
$p2_3->dependencies['required']->package['pear2.php.net/P3']->save();
$p2_3->dependencies['required']->package['pear2.php.net/P5']->save();
$p2_3->files['glooby2'] =  array('role' => 'php');

$p2_2 = clone $save;
$p2_2->name = 'P2';
$p2_2->version['release'] = '1.2.2';
$p2_2->dependencies['required']->package['pear2.php.net/P3']->save();
$p2_2->files['glooby2'] =  array('role' => 'php');


$p2_0 = clone $save;
$p2_0->name = 'P2';
$p2_0->version['release'] = '0.9.0';
$p2_0->stability['release'] = 'beta';
$p2_0->files['glooby2'] =  array('role' => 'php');

$p3 = clone $save;
$p3->name = 'P3';
$p3->files['glooby3'] =  array('role' => 'php');

$p4 = clone $save;
$p4->name = 'P4';
$p4->dependencies['required']->package['pear2.php.net/P2']->min('1.2.0')->exclude('1.2.3');
$p4->files['glooby4'] =  array('role' => 'php');

$p5 = $save;
$p5->name = 'P5';
$p5->stability['release'] = 'beta';
$p5->version['release'] = '0.9.0';
$p5->files['glooby5'] =  array('role' => 'php');

file_put_contents(__DIR__ . '/package.xml', $pf);

$package1 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package1, $xmlcontainer);
$package1->setInternalPackage($xml);
$package1->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package1, 'cellog');

$package2_0_9_0 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p2_0);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package2_0_9_0, $xmlcontainer);
$package2_0_9_0->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p2_0);
$package2_0_9_0->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package2_0_9_0, 'cellog');

$package2_1_2_2 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p2_2);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package2_1_2_2, $xmlcontainer);
$package2_1_2_2->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p2_2);
$package2_1_2_2->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package2_1_2_2, 'cellog');

$package2_1_2_3 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p2_3);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package2_1_2_3, $xmlcontainer);
$package2_1_2_3->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p2_3);
$package2_1_2_3->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package2_1_2_3, 'cellog');

$package3 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p3);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package3, $xmlcontainer);
$package3->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p3);
$package3->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package3, 'cellog');

$package4 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p4);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package4, $xmlcontainer);
$package4->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p4);
$package4->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package4, 'cellog');

$package5 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p5);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package5, $xmlcontainer);
$package5->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p5);
$package5->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package5, 'cellog');

// clean up
unlink(dirname(__DIR__) . '/pearconfig.xml');
unlink(dirname(__DIR__) . '/.config');
for ($i = 1; $i <= 5; $i++) {
    unlink(__DIR__ . "/glooby$i");
}
unlink(__DIR__ . '/package.xml');
foreach (new DirectoryIterator(dirname(__DIR__) . '/.configsnapshots') as $file) {
    if ($file->isDot()) {
        continue;
    }
    unlink($file->getPathName());
}
rmdir(dirname(__DIR__) . '/.configsnapshots');
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.allmaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allmaintainers http://pear.php.net/dtd/rest.allmaintainers.xsd">
 <h xlink:href="rest/m/.svn">.svn</h>
 <h xlink:href="rest/m/cellog">cellog</h>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.maintainer" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.maintainer http://pear.php.net/dtd/rest.maintainer.xsd">
 <n>cellog</n>
 <h>Greg Beaver</h>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<f xmlns="http://pear.php.net/dtd/rest.categorypackageinfo" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.categorypackageinfo http://pear.php.net/dtd/rest.categorypackageinfo.xsd">
 <pi/>
</f>
<?xml version="1.0" encoding="UTF-8"?>
<c xmlns="http://pear.php.net/dtd/rest.category" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.category http://pear.php.net/dtd/rest.category.xsd">
 <n>Default</n>
 <a>Default</a>
 <c>pear2.php.net</c>
 <d>This is the default category</d>
</c>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allcategories" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allcategories http://pear.php.net/dtd/rest.allcategories.xsd">
 <ch>pear2.php.net</ch>
 <c xlink:href="rest/c/Default/info.xml">Default</c>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P3</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P5</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P4</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P1</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allpackages" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allpackages http://pear.php.net/dtd/rest.allpackages.xsd">
 <p>p1</p>
 <p>p2</p>
 <p>p3</p>
 <p>p4</p>
 <p>p5</p>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P2</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>15:34:42</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}}}<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p3">P3</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 15:34:42</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P3-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p3">P3</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 15:34:42</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P3-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p5">P5</p>
 <c>pear2.php.net</c>
 <v>0.9.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>beta</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 15:34:42</da>
 <n>my notes</n>
 <f>1216</f>
 <g>http://pear2.php.net/get/P5-0.9.0</g>
 <x xlink:href="package.0.9.0.xml"/>
</r>
0.9.0<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p5">P5</p>
 <c>pear2.php.net</c>
 <v>0.9.0</v>
 <st>beta</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 15:34:42</da>
 <n>my notes</n>
 <f>1216</f>
 <g>http://pear2.php.net/get/P5-0.9.0</g>
 <x xlink:href="package.0.9.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P5</p>
 <c>pear2.php.net</c>
 <r>
  <v>0.9.0</v>
  <s>beta</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P5</p>
 <c>pear2.php.net</c>
 <r>
  <v>0.9.0</v>
  <s>beta</s>
  <m>5.2.0</m>
 </r>
</a>
0.9.0<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P5</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P5</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>15:34:42</time>
 <version>
  <release>0.9.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>beta</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby5"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P5</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}}}0.1.01.0.0<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P4</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>15:34:42</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby4"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <min>1.2.0</min>
    <exclude>1.2.3</exclude>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
a:1:{s:8:"required";a:3:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}s:7:"package";a:4:{s:4:"name";s:2:"P2";s:7:"channel";s:13:"pear2.php.net";s:3:"min";s:5:"1.2.0";s:7:"exclude";s:5:"1.2.3";}}}<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P4</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P4</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p4">P4</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 15:34:42</da>
 <n>my notes</n>
 <f>1352</f>
 <g>http://pear2.php.net/get/P4-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P4</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P4</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p4">P4</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 15:34:42</da>
 <n>my notes</n>
 <f>1352</f>
 <g>http://pear2.php.net/get/P4-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P1</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>15:34:41</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby1"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <min>1.2.0</min>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
a:1:{s:8:"required";a:3:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}s:7:"package";a:3:{s:4:"name";s:2:"P2";s:7:"channel";s:13:"pear2.php.net";s:3:"min";s:5:"1.2.0";}}}<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p1">P1</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 15:34:41</da>
 <n>my notes</n>
 <f>1323</f>
 <g>http://pear2.php.net/get/P1-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p1">P1</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 15:34:41</da>
 <n>my notes</n>
 <f>1323</f>
 <g>http://pear2.php.net/get/P1-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
1.2.2<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.2.2</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 15:34:41</da>
 <n>my notes</n>
 <f>1302</f>
 <g>http://pear2.php.net/get/P2-1.2.2</g>
 <x xlink:href="package.1.2.2.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>0.9.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>beta</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 15:34:41</da>
 <n>my notes</n>
 <f>1216</f>
 <g>http://pear2.php.net/get/P2-0.9.0</g>
 <x xlink:href="package.0.9.0.xml"/>
</r>
1.2.3a:1:{s:8:"required";a:3:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}s:7:"package";a:2:{i:0;a:2:{s:4:"name";s:2:"P3";s:7:"channel";s:13:"pear2.php.net";}i:1;a:2:{s:4:"name";s:2:"P5";s:7:"channel";s:13:"pear2.php.net";}}}}<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>0.9.0</v>
 <st>beta</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 15:34:41</da>
 <n>my notes</n>
 <f>1216</f>
 <g>http://pear2.php.net/get/P2-0.9.0</g>
 <x xlink:href="package.0.9.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>15:34:42</time>
 <version>
  <release>1.2.3</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P3</name>
    <channel>pear2.php.net</channel>
   </package>
   <package>
    <name>P5</name>
    <channel>pear2.php.net</channel>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.2.3</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 15:34:42</da>
 <n>my notes</n>
 <f>1386</f>
 <g>http://pear2.php.net/get/P2-1.2.3</g>
 <x xlink:href="package.1.2.3.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>15:34:41</time>
 <version>
  <release>1.2.2</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P3</name>
    <channel>pear2.php.net</channel>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
a:1:{s:8:"required";a:3:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}s:7:"package";a:2:{s:4:"name";s:2:"P3";s:7:"channel";s:13:"pear2.php.net";}}}<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.2.2</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 15:34:41</da>
 <n>my notes</n>
 <f>1302</f>
 <g>http://pear2.php.net/get/P2-1.2.2</g>
 <x xlink:href="package.1.2.2.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.2.3</v>
  <s>stable</s>
 </r>
 <r>
  <v>1.2.2</v>
  <s>stable</s>
 </r>
 <r>
  <v>0.9.0</v>
  <s>beta</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.2.3</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 15:34:42</da>
 <n>my notes</n>
 <f>1386</f>
 <g>http://pear2.php.net/get/P2-1.2.3</g>
 <x xlink:href="package.1.2.3.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.2.3</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
 <r>
  <v>1.2.2</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
 <r>
  <v>0.9.0</v>
  <s>beta</s>
  <m>5.2.0</m>
 </r>
</a>
0.9.0<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
1.2.3<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>15:34:41</time>
 <version>
  <release>0.9.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>beta</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}}}ã      ÏY[o”0ﬁÛ~Öï˜∆v.T^à¡À@â7‰%¶µpì`;¥‚øsÏ&m
h£”Ë4-ﬂKÏsÒ9Ò9üù≠·rÆ¥òJcı
◊<ˇ ß¬‡ZpÖı¨KaÒeäI¯4$£VÇœ—†Ñåì‰Ë9¥˚D(ä„QëÃ“$	çc–ì}Ç‹ç±\rπ“çπ∆Ó&˝;Éb¢ÔBYïßIÄDôWÖ,ßß¡«ØFOÇ≥Ïòµ•ﬂZF!¯ñÊ4òY[O∞ÔöM”∂Ë˙i¥µùXnæ^„·’#ü≈⁄~i‰∆z±XÑã8¨ÙGÑP¸ÈÕ≈˚|&Ê|$K®bô2rbº¢ πı©ﬁÃ∑·çV·“◊Zˆ^˜_Ì‹öj∫∑π∂ ;F¨‰së]¶˚Ú/K°≤ä2‹â¡¬4Û9◊´Ã
c°äw–¬‰Z÷n_≤ôDΩ)√}ò*¡x∂)ºÜCΩR‹‰ÇXcÑŒr°Ta¸ƒIaÛ•j≈œ6Æ•Nœs+øãl%√Ì‚·6 +∏¯Èà§£à@bN 
+!,M'q2I"Ü˝ƒÌÆ˘•µÄUå»¸y≈p7ıQk	bÍƒnË"n=ÙœïT“Ævñπñˇπ
WıåoWÈª2%sQÅΩ€∑U‚™—π˝€ö|eäQ;q≈≤∑bÅ^ºâ.÷B÷ô˙f®†¶Ÿ|Ö¸ Í‡ÁÆ)™“ä“üb!5r:∞k!ê|ëJ ])π≠÷ËOUU]≠“ {OÆ˛ïzÎAÀ@Íú	Ròvsæ5RãbΩ6,ËàÕeô•a‰6ÿΩwjÊ˙’”T©uõ¥æ’9›Ò˘›‘ï`”5ÍNF.Ö∂D¨£Wv|ﬂgÎC@Ø	˛[åÌ˝OORÔwœQÔ˛á≥ìR˜ˇ!0ì˜ù¡Ä˚Ñ„ˇÂ˘Ûw~ﬁÿJUºp◊–›∆∏ôˇ±Á•q4ÜÔ''¡¿ˇ`&ákÚ1cÀˇ7ç≤Ú\ÎJõ;>ˆ‚ˇI
ÍÑ¶'ˇÅÅˇèÂ?>_Ê¬ˇ#‡NNÇ}¯”‘cJ∆ˇÅÅˇè[˛ﬂ-Á˚ÿÔ˚Ïæˇ«—¿ˇÉ`‡ˇ„∆aÔˇø˛˛á(âvˇÉØˇ1¯∞3®qÆ∏1»˜¡Á^|ﬁÙK+ ¢≥Ÿ ¸ºÔ70`¿Ä∑¡/   ˇˇ √< $  .xmlregistry/packages/pear2.php.net/P4/1.0.0-package.xml                                            100644       0       0         2544 11205064542  21322  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P4</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>15:34:42</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby4"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <min>1.2.0</min>
    <exclude>1.2.3</exclude>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                            src/glooby4                                                                                         100644    1750    1750            2 11205064541  11644  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205064542  15761  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ã      ÏY[o”0ﬁÛ~Öï˜∆qnÉ Àÿƒ‡eCâ7‰%¶µpì`;k+ƒÁÿM⁄–F—Ë@À˜˚\|N|ŒgG≠øòI≈'Bµƒ5À?≥	◊∏ÊLÖ~=≠˝í|a‚~0jı>¯Ï i ã m?
£(EÑÑAfIÇÑD!ËÉ]Ç¸)mò:Ç´•jÙv˜ÈˇS–(&∫ÂJã™<ˆ†Œ‚e^¢ú{ÔﬂΩ=ÛN≤C⁄ñ~c˙ƒC‡[ÍcojL=∆Æk÷MSò¢Îß—∆vlò˛|ááSè\+˚ÖkÎ˘|Óœ#øR¡./ÆÛ)ü±ë(°äeŒ¡Kã±v¬ã*g∆•zo0◊Ü˜Z˘]‹iŸ{›ﬂµ≥kz®®ﬁÊ›ºÏ—íÕxvQÏ »ß¨,πÃ∂(Jq'›ÃfL-3√µÅ*R‹	@Wpù+Q€}…¶ı¶˜u`*9+‡Ÿ¶	t∆§∏Œ—FsïÂ\ 
¬∏âï¬ÊŸä_¨3\I≠ûÂF‹Úl…5≈Ì‚·6 -ò·¯˘(HFa âY(åÄ∞$GÒ8)vS∑ªÊñVV—`e7ê‚nÍ¢÷"`«Alá6‚∆ìBˇ‹)Ãrk+ï¸Áuò¨ßl≥NﬂôJëÛRs‘®ÌŒ≠jWç πÎ‡÷L„]å⁄â-ßóΩ·stv˝]¨Ñ¥3uÌPAU≥ŸπT¬Õm[T•·•—.≈B(dktÏa€D ˘$$G™í ≤1Z≠V9û»™∫YFvû\›+ı÷É¶Å‘8◊Ìˆ|iÑ‚≈jmX–ùâ2K¸–n±:-Ó‘‘v¨#™î´Fi=\≥3≤ÂÛ£©-¡:¶m’≠ål
mâ‡5hG∞Ï±O◊Ω¯k16˜?9J‹Ωﬂ=;ÑΩ˚ŒNB“8Óˇ}`*;Éè	Àˇ´Û”∑!>mL%+VÿKËac‹œˇ»Ò?ì(L·˚üDq¸ﬂ¶b∏$ü26¸øl§ÁJUJ?∞ˇèP«$9¯ø¸⁄¯%ˇÒ˘"ÁÓáÄ9	v·D"Pß$H˛Ôˇü66¸XŒ˜±€˜jøˇ”p‡ˇ^0ˇicø˜ˇ/ˇˇC$∑ˇˇÉØˇî¸ﬂË	T¯0óLk‰˙‡cØ>Æ˚ ÒÖ·e—Ÿl‰_ø=ˆ0`¿Ä?¡w   ˇˇ Ú¨ëU $  ã      ÏYKo€8ˆ9øÇ–›¢HINk0 ∂ÿ¥ótÙÙV0◊&JKZí™m˝Ô;§%KFã§.Rg—w9Œh8)ÿ·f•¥XHcı◊<ˇÃ¬‡ZpM√zYá•∞¯&¡$å¬h⁄ÍCôE≥$ôLêCÑü—4I!4J¡,M(HHL)öD«˘U4∆r=â¢õ≠nÃv˜Èˇß`ó∞ôËã–FVÂE ˚ QÊU!À≈E·˝´È≥‡2;cÌ÷˜ñ4$ﬂ“\KkÎ9ˆ]≥oö¬]?M{€πÂÊÛ^=ıYÏÏ7FÓ≠◊Îu∏é√J/0ç"Ç?æπ~ó/≈äOe	ªXÊºåú/ºÆrn}™˜ÛmxØU∏1≈ùñÉ◊˝Y;∑fÄZÅËdgàï|%≤õÑa? Aæ‰e)Tv@QÜ;1Xòfµ‚zõYa,Ï"√ù tÖ0πñµ´K∂îh0ex®S%xœ6Ö◊pH†óÇCä˚\kå–Y.î™ åü8)_™V¸«>√ù‘ÈynÂëmÖa∏C<‹d∑"É~>ç“)ç 1' Öïñ§Û8ô'îa?q[5ø¥∞ä+W@Üª©èZÀ,ÇäÉÿ]ƒﬁìAˇ‹J%Ìˆ`'U‚˚u∏™óº_gËÃîÃEijÙaÁV5à´FÁ¬wpkf≠)¶Ìƒmgê˝%÷ËÂª?—ıN»:SﬂÏj∂⁄"?Äùs◊UiEiçO±êπ=∫∞k"ê¸-ï@∫R r1Z≠—9^®™∫›&ˆû\˝+÷É¶Å‘8§0my˛i§≈nmX–[…2KCÍJÏÜ^ã;5sÎâ™‘ÆQZﬂÏú¯|g⁄@≠ﬂé¥oEÙÃËí√°a7πj
·1tj;msÈªFÿøπ#ÃA]\!⁄FÅb˚åøÉ¯m1˙˚üúß˛ﬁÔûË‡˛á≥ì∞ÔˇS`);Éè	«ˇõ´o)~—ÿJUºp'Á√∆∏üˇ±ÁB”òŒ‡˚üƒI<Úˇ$X ˇÙı4‚7£ÁˇõFYy•u•ÕGÒˇ<uB“Ûëˇß¿»ˇßçÚ_mr·xêì‡˛«$ıåD≥ëˇß¿»ˇßçûˇÀ˘!é˚˛üπÔˇ˘å¸⁄8Ì˝ˇ√ˇˇâË·ˇı?##ˇOv	;|ñ+nÚ}i–üˆ}Äƒ∆ä≤Ëlz˘◊oè˝#Få1‚W/   ˇˇ ’≠òÚ $  .xmlregistry/packages/pear2.php.net/P3/1.0.0-package.xml                                            100644       0       0         2336 11205064542  21320  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>15:34:42</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                                                                                                                  src/glooby3                                                                                         100644    1750    1750            2 11205064541  11643  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205064542  15761  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ã      ÏYÀn€8ı:_AhoQ§ôä“ìvìÇ¶fW0k•%I’6ä˘˜π§%KFÉ§Ó§6äËl$ﬁ'uyIÿ˛z)üm‘◊,ˇ¬Ê\„ö3E˝zQ˚%7¯Üb‚S?ú∂z|&ÄAEì	≤–˛!ö	"Ñ1ò≈		iÑ&¡!I~ç6LMÇ‡f£˝Ä›c˙ﬂÈ%,&˙ ïUy·?/Û™Â¸¬˚¯·ÕÙÔ2;K€•Ô-©O<æ•æ∆‘3Ï∫f◊4Ö)∫~öˆ∂3√Ùó<úzÍf±µ_k±≥^≠V˛*Ù+5«4˛˚›ımæ‡K6%¨bôs“b¶ù∫ ôqS}4ôk√G≠¸µ.¥|Óè⁄ŸòjjP‹ Jêù°¥dKû›–ª‰Vñ\f{Mq'›,óLm2√µÅULq' ]¡uÆDmÎí-S<‘Å©‰¨Äg;Ö∑∞I†◊ú¡wsAi£π r.ei‹¿J°¯B∂‚óªn•Vœr#æÚl√uä€w»á€Ñi¡œ`Å_LÉxJòòÄ¬HK‚YÕ"®àÇ∏≠ö≠8D—`e˜´wCóµY áÄˆ’fÏ=SËü;!ÖŸÏÖ±R…øè√dΩ`}ú°s*EŒKÕQ£ˆ;∑™A\5*ÁÆÉ[3çÔt1mv9ΩÏ/æBØoˇD◊[a⁄ô∫v®`U≥ÂπX	7∂mQïÜóFª)B!ªF∂MíœBr§*	"õ£’jï„π¨™ªı∞Ûƒ‡Í>iö¶^¿Æ ∏nÀÛO#/∂±!†{AÈRîYïá€Wß≈ù:µÎà*Â∂QZ◊ÏåÏ˘|g⁄m@≠ﬂñaﬂäËò·"¬‹3˛_1m´Ïjc)µW9[™∂ï†‹«”ÌˇÉ¯e9˙Ûüú«Ó‹ÔûË‡¸áΩìêÆ„˘,ƒ©g0‚î∞¸øπzıû‚Wç©d≈
ªÀ=mé«˘:˛G4i˜F·xˇ?
‚Ñáœàì£ÁˇªFq•T•ÙoÒˇ<uD‚Ûëˇ«¿»ˇÁç{˘èØ÷9w?<…NpˇCÇ:!A2Úˇ˘ˇº—Ûˇi9?ƒa˜ˇƒﬁˇ:Úˇ(˘ˇºq‹Ûˇﬁˇˇ	Ë˛ˇp˚O»»ˇc ΩÑ>À%”π>¯4ËÉOª>@|mxYt6Ω¸€øß˛Ç#FåÒ3¯  ˇˇ '4∏ $  ã      ÏYKo„6ˆ9øÇ–›"©á›å“]4Ì%[›Ëm¡H¨M,-©$µ∂±ËÔêñ,πY$Î4u∞àæã»ypÜú˘H#	∑k•≈R´w∏Ê˘Gæ◊ÇÎ(¨WuX
ão)¶!	…¥’á‡39îêYíL&»Å†„/BQJÊà“à§`ñ&$4¶)öêSÇ<ç±\Oπ›È∆<`˜ò˛ªÇb¢OBYïó‘9@¢Ã´BñÀÀ‡˜ﬂ~ö~\e¨-}oÖ4@‡[öÀ`emΩ¿ækMSÿ¢Îßioª∞‹||¿√´ß>ãΩ˝÷»Éıf≥	7qXÈ%é°¯èw7ÔÛïXÛ©,°äe.¿À»ÖÒ¬õ*Á÷ß˙h0ﬂÜèZÖ[S<h9ÿÓ◊⁄π5‘
Ù‡pÅnAvÅX…◊"ª•˚Ú/K°≤#ä2‹â¡¬4Î5◊ªÃ
c°äw–¬‰Z÷Ó\≤ïDÉ)√Cò*¡¯∂)¸óz+8§x»±∆ùÂB©
¬¯âì¬·K’ä8d∏ó:=œ≠¸$≤ù0∑càá€Ä¨‡VdP‡Ôß$ùFsPX	ai∫àìE'‚ß nOÕ/≠¨b¿  √›‘G≠eF‡ƒAÏÜ.bÔ…†Ó§ívw¥åì*qÆÍÔ◊:3%sQÅ}‹πU‚™—π‹ö|gäi;qÂ≤_ƒΩ}ˇ#∫ŸYgÍ€°Ç™fÎÚ®Ñüª∂®J+Jk|äÖ‘»’Ë2¿Æâ@ÚßTÈJÅ»≈hµFÁx©™ÍnGÏ=1∏˙-÷É¶Å‘∏§0ÌÒ¸’H-ä˝⁄∞† ∂ñeñÜë;b7ÙZ‹©ôÎXOT•ˆç“z¯fÁÙ»Áûiwµ~{ZD}+¢Ø`FêﬁK±_€’˙∞9«â£≠ªΩ∂Ω Á5p|Èk¸…¥¿ˇ£ˇÈ<ıÔ~˜ÌøˇîŒ‡3æˇg¿Jæt#^éˇ∑◊o~çõ∆V™‚Öª9ü7∆„¸è=ˇì(ç£YÍ8âìëˇÁ¿J~ªo◊àˇéûˇÔeÂµ÷ï6œ|úƒˇy
ÍÑ¶ÛëˇÁ¿»ˇ◊ç/Ú_os·ˇ,7¡)¸èiÍ%≥ëˇÁ¿»ˇ◊çûˇœÀ˘!N˚˝?søˇg—»ˇ≥`‰ˇÎ∆yﬂˇ/˛ˇQÚÔøˇ•Û˘∞+®EÆ∏1»˜¡áA|8Ù[+ ¢≥ÈÂüˇ~Èå1bƒàß‡   ˇˇ ôz•4 $  .xmlregistry/packages/pear2.php.net/P2/1.2.3-package.xml                                            100644       0       0         2606 11205064542  21324  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>15:34:42</time>
 <version>
  <release>1.2.3</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P3</name>
    <channel>pear2.php.net</channel>
   </package>
   <package>
    <name>P5</name>
    <channel>pear2.php.net</channel>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                          src/glooby2                                                                                         100644    1750    1750            2 11205064541  11642  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205064542  15761  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ã      ÏY[o€6ˆs~°wã"%9´¡(m±l/i¨∞∑ÇëXõ(-i$U€ˆﬂ{HKñºI]x∂Ë{ëxÆ$œ˘H_¬ÕJi±ê∆Í-Æy˛â/Ñ¡µ‡öÜı≤KaÒ≈$§!ù∂˙|&GÄD—,I&‰°√'B4ôQDçR0KSä&—1I~ç±\O¢Ën´ÛÄ›c˙ˇ(ÿ5}⁄»™º
HHîyU»rq¸˛˛óÈO¡uv¡⁄“˜ñ4$ﬂ“\KkÎ9ˆ]≥oö¬]?M{€πÂÊ”^=ı≥ÿŸoå‹[Ø◊Îpáï^`EˇÒÊˆ]æ+>ï%T±Ãx97^x[Â‹˙©>öÃ∑·£V·∆Zñ˚Ωv.fÄZÅln[ê] VÚï»Ó(√˛˘íó•PŸEÓƒ`aö’äÎmfÖ±PEÜ;Ë
ar-k∑/ŸR¢¡ê·°Lï‡<€)¸
áz-8Lq?ƒ#tñ•*H„N
õ/U+~πü·NÍÙ<∑Ú≥»∂¬0‹æC>‹&d∑"ÉøòFÈîF01' Öïêñ§Û8ô'Ña?qªk>¥≈Äï;ØÓÜ>k-≥v∫Wó±˜d–?˜RIª=„§J|á´z…˚8Cg¶d.J#P£;∑™A\5:æÉ[3ÉÔM1mÆúAˆV¨—Îw?£€ùêu¶æ*®j∂⁄"ˇïc◊UiEiçüb!5r5∫
∞k"ê|îJ ])π≠÷Ë/TU›oiÄΩ'Wø§A<hòzßÇ¶›û?©E±ã˝b+Yf)Ï<l±{ıZ‹©ôÎXOT•vç“z¯fÁ‰¿Á+”Ó j˝v¥à˚VDﬂ¡π„ ∫_ákˇÉU∫eµeá≠8>ıâ}ZZ‡_À—ﬂˇ‰2ı˜~˜Ïè˚üêY2ﬁˇg¡R>ıF<%ˇÔn^˝FÒ´∆V™‚Ö;9Oõ„q˛«ûˇ	Mc
ﬂâì8˘,ÂˇÏBqz˛øiîï7ZW⁄ú¯8äˇó)®í^é¸?F˛?o|ìˇ¯fìˇC¿INÇc¯ì‘3ÕF˛ü#ˇü7z˛üñÛC˜˘Ê>ˇœË»ˇ≥`‰ˇÛ∆yÔˇo˛ˇáH4¸˝œ}ˇO/gd‰ˇ9¿Æ°¬π‚∆ ﬂ}aﬂHl¨(ãŒ¶óˇı˜SØ`ƒà#F¸æ   ˇˇ H5ä $  .xmlregistry/packages/pear2.php.net/P2/0.9.0-package.xml                                            100644       0       0         2334 11205064541  21324  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>15:34:41</time>
 <version>
  <release>0.9.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>beta</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                                                                                                                    src/glooby2                                                                                         100644    1750    1750            2 11205064541  11642  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205064541  15760  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              .xmlregistry/packages/pear2.php.net/P2/1.2.2-package.xml                                            100644       0       0         2462 11205064542  21323  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>15:34:41</time>
 <version>
  <release>1.2.2</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P3</name>
    <channel>pear2.php.net</channel>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                              src/glooby2                                                                                         100644    1750    1750            2 11205064541  11642  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205064542  15761  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              .xmlregistry/packages/pear2.php.net/P5/0.9.0-package.xml                                            100644       0       0         2334 11205064542  21330  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P5</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>15:34:42</time>
 <version>
  <release>0.9.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>beta</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby5"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                                                                                                                    src/glooby5                                                                                         100644    1750    1750            2 11205064541  11645  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205064542  15761  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ã      ÏYMo€8ı9øÇ–›")YN◊`î&h⁄KR€]`o#±6QZRI*∂±ÿˇﬁ!-Y2Z$Î"Î`aΩã»˘‡9ÛD%◊K•≈\´7∏‚ŸW>WÇÎ(¨UXãÔLCíq£¡gt (!”…d4BÌ?ä&$AîFdGÁ	åQDczéF‰ê øä⁄XÆGÑ‹otmû∞{Nˇ?ªÑb¢G°ç,ãã Í Qde.ã˘EÁÔ«oÇÀÙå5•Ô,£ê|s,¨≠fÿwÕÆirõ∑˝4ÓlgñõØOxxıÿg±µ_π≥^≠V·*K=«!ˇuw˚)[à%À™Xdºåú/º-3n}™œÛm¯¨U∏6˘ìñΩÌ˛[;∑fÄÅÓ.–-Hœ+¯R§˜	√~ Çl¡ãB®tè¢∑b∞0ır…ı&µ¬X®"√≠ tπ0ôñï;ót!Qo p_¶JûM
‡%ÅÆáwπ V°”L(UB?qR8|©Ò€]Ü[©”ÛÃ GënÑa∏C<‹d9∑"Öˇ6&…òæÅƒú VBXœíÈå¿â¯)àõSÛKk´∞r»p;ıQ+ô8qª°ãÿy2Ëü©§›Ï-„§J¸∏W’ÇwÎÙùôíô(å@µﬁÔ‹≤qYÎL¯nÃ~0˘∏ô∏rÈG±B◊üﬁ°€≠êµ¶æJ®j∫‹ ?ÄJ¯πkã≤∞¢∞∆ßòKç\ç.Ïö$_§Hó
D.F£5:√sUñõ {Gû~GΩÂ`ÈeLÇÉÿ..`#9º#§èÏOÎ[-µ›S∞!∂îEöÑë;s7‹ÍÒŒÄπ&ˆ‹Uj€;≠ì' ß˚n?ª¬t°]ÔßÊRiJáõmu[a-”≥◊~	ø"∫¯Ôbt˜?Ö˚ıû-‚Ì˝%Ò$äAMìd∏ˇèÇÖ<ÂÓ‡¯sı{ÑØj[™íÁÓzŸá?öF†é'Òd‡ˇ10ˇ¥—ÒˇÆVVﬁh]jÛ¬ØÄÉ¯ˇ”	Óˇ„`‡ˇi„ß¸«7ÎL¯º»õ‡˛«‘}ˇO)ô¸?˛ü6:˛ø,Á˚8Ï˚Íæˇß—¿ˇ£`‡ˇi„∏˜ˇOˇCîD˚øˇ¡◊ˇî¸?ÿ%T¯,S‹‰˚‡sØ>Ô˙ âµEﬁ⁄tÚøˇyÌ0`¿Ä_¡w   ˇˇ _µR¯ $  .xmlregistry/packages/pear2.php.net/P1/1.0.0-package.xml                                            100644       0       0         2507 11205064541  21315  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P1</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>15:34:41</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby1"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <min>1.2.0</min>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                         src/glooby1                                                                                         100644    1750    1750            2 11205064541  11641  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205064541  15760  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ã      ÏY[o€6ˆs~°wãIŒj0 Z,€K:kÏ≠`$Œ&JKI’6Ü˝˜“í-wE2ôÉ"˙^Dûœœ˘H¡é7+m‰BYg∂∏≈'±ê7R7À&Æ§√wì¯UL¶ù>ü…	†ÑÃ“t2A?bIí"J…¿,K)Hh¬R4!ß˘V¥÷	3!‰nkZ˚Ä›c˙Ô¸äâ>KcU]]E4&íUQó™Z\Eﬁˇ<˝!∫Œ/xW˙É%ãiÑ¿∑≤W—“πféC◊Ïõ¶teﬂO”ÉÌ‹	˚Èè†ûÜ,vˆ´ˆ÷Îı:^'qmòBÒÔooﬂKπSUA´BÇóUsÑ∑u!\Hı—`°µä7∂|–r∫ˇ’ŒØ°N`õK`Úƒ+±í˘„8@P,EUIùQî„^∂]≠ÑŸÊNZU‰∏ÄÆî∂0™Ò˚í/L9Í¿TKQ¬≥K·8$–) ≈}.à∑VöºêZ◊&Lº6_ÈN¸„>√ù‘ÎE·‘gôo•Â∏C<‹‰•p2áøöíl $Ê†p
¬“lû§Ûîr¶ Óv-,m$¨beŒ+é˚ià⁄(S/ˆCÒ‡…°ÓïVn{¥ÃΩt‚ﬂ´›,≈aï°+◊™êïï®5«}[7 Æ[S»–øùô≈˜∂úv_Ã(ˇUÆ—õw?°€ùê˜¶°j®iæ⁄¢0Ä:Ñπoä∫r≤r6§X*É|ÖÆ"Ï[$(-ë©5à|åNkMÅ∫ÆÔ∑,¬¡Ékx•¡z–2êz	gÇí∂€ú?[edπ[ƒW™ ≥ò˘ˆ√†≈Ωö˚~4’z◊&ùGhuAè|æ4ı%ÿ«ÙçzîëO°+ºÔÈï_<˜Ÿ˙=`–ˇ[å√˝O/≥pÔ˜œÏ¯˛ßtñ≤Ò˛?ñÍπ3Òú¸øªy˝√Ø[WÎZî˛z⁄èÛ?	¸OYñ∞uí&„˜ˇY∞T„5˘íq‡ˇ€V;ucLmÏ'Òˇ2uJ≥ÀëˇÁ¿»ˇóçØÚﬂl
~xíì‡˛'4ıåíŸ»ˇs`‰ˇÀ∆ÅˇOÀ˘!N˚˛ü˘Ôˇ˘å¸Ÿ8Ô˝ˇ’ˇˇ%_˛˛ó]Œ»»ˇsÄ_CÖ/
-¨E°>˙‡„æê‹8YïΩÕA˛◊ﬂœ˝#Få1‚[   ˇˇ I}æ| $  This directory is for storage of fake document roots to be used for internet-based tests

Scripts for document root creation are stored in each respective document root as "make.php"

<?xml version="1.0" encoding="UTF-8"?>
<channel version="1.0" xmlns="http://pear.php.net/channel-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/channel-1.0 http://pear.php.net/dtd/channel-1.0.xsd">
 <name>pear2.php.net</name>
 <suggestedalias>salty</suggestedalias>
 <summary>unit test channel</summary>
 <servers>
  <primary>
   <rest>
    <baseurl type="REST1.0">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.1">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.3">http://pear2.php.net/rest/</baseurl>
   </rest>
  </primary>
 </servers>
</channel>
<?php
/**
 * Create a dependency tree like so:
 *
 * P1 -> P2 recommended 1.2.0
 * P3 -> P2 recommended 1.1.0
 *
 * to test composite dep failure
 */

require __DIR__ . '/../../../../../autoload.php';

set_include_path(__DIR__);
$c = PEAR2_Pyrus_Config::singleton(dirname(__DIR__), dirname(__DIR__) . '/pearconfig.xml');
$c->bin_dir = __DIR__ . '/bin';
restore_include_path();
$c->saveConfig();

$chan = new PEAR2_SimpleChannelServer_Channel('pear2.php.net', 'unit test channel');
$scs = new PEAR2_SimpleChannelServer($chan, __DIR__, dirname(__DIR__));

$scs->saveChannel();

$pf = new PEAR2_Pyrus_PackageFile_v2;

for ($i = 1; $i <= 3; $i++) {
    file_put_contents(__DIR__ . "/glooby$i", 'hi');
}

$pf->name = 'P1';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->version['release'] = '1.0.0';
$pf->stability['release'] = 'stable';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');

$pf->setPackagefile(__DIR__ . '/package.xml');
$save = clone $pf;

$pf->dependencies['required']->package['pear2.php.net/P2']->recommended('1.2.0');
$pf->files['glooby1'] =  array('role' => 'php');

$p2 = clone $save;
$p2->name = 'P2';
$p2->version['release'] = '1.2.1';
$p2->stability['release'] = 'stable';
$p2->files['glooby2'] =  array('role' => 'php');

$p3 = clone $save;
$p3->name = 'P3';
$p3->files['glooby3'] =  array('role' => 'php');
$p3->dependencies['required']->package['pear2.php.net/P2']->recommended('1.1.0');
$p3->files['glooby3'] =  array('role' => 'php');

file_put_contents(__DIR__ . '/package.xml', $pf);

$package1 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package1, $xmlcontainer);
$package1->setInternalPackage($xml);
$package1->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package1, 'cellog');

$package2 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p2);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package2, $xmlcontainer);
$package2->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p2);
$package2->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package2, 'cellog');

$package3 = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($p3);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/package.xml', $package3, $xmlcontainer);
$package3->setInternalPackage($xml);
file_put_contents(__DIR__ . '/package.xml', $p3);
$package3->archivefile = __DIR__ . '/package.xml';
$scs->saveRelease($package3, 'cellog');

// clean up
unlink(dirname(__DIR__) . '/pearconfig.xml');
unlink(dirname(__DIR__) . '/.config');
for ($i = 1; $i <= 3; $i++) {
    unlink(__DIR__ . "/glooby$i");
}
unlink(__DIR__ . '/package.xml');
foreach (new DirectoryIterator(dirname(__DIR__) . '/.configsnapshots') as $file) {
    if ($file->isDot()) {
        continue;
    }
    unlink($file->getPathName());
}
rmdir(dirname(__DIR__) . '/.configsnapshots');
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.allmaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allmaintainers http://pear.php.net/dtd/rest.allmaintainers.xsd">
 <h xlink:href="rest/m/cellog">cellog</h>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.maintainer" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.maintainer http://pear.php.net/dtd/rest.maintainer.xsd">
 <n>cellog</n>
 <h>Greg Beaver</h>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<f xmlns="http://pear.php.net/dtd/rest.categorypackageinfo" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.categorypackageinfo http://pear.php.net/dtd/rest.categorypackageinfo.xsd">
 <pi/>
</f>
<?xml version="1.0" encoding="UTF-8"?>
<c xmlns="http://pear.php.net/dtd/rest.category" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.category http://pear.php.net/dtd/rest.category.xsd">
 <n>Default</n>
 <a>Default</a>
 <c>pear2.php.net</c>
 <d>This is the default category</d>
</c>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allcategories" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allcategories http://pear.php.net/dtd/rest.allcategories.xsd">
 <ch>pear2.php.net</ch>
 <c xlink:href="rest/c/Default/info.xml">Default</c>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P3</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P1</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allpackages" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allpackages http://pear.php.net/dtd/rest.allpackages.xsd">
 <p>p1</p>
 <p>p2</p>
 <p>p3</p>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<p>
 <n>P2</n>
 <c>pear2.php.net</c>
 <ca xlink:href="rest/c/Default" xmlns:xlink="rest/c/Default">Default</ca>
 <l>New BSD License</l>
 <s>testing</s>
 <d>hi description</d>
 <r xmlns="http://pear.php.net/dtd/rest.package" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.package http://pear.php.net/dtd/rest.package.xsd"/>
</p>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>16:39:44</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <recommended>1.1.0</recommended>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
a:1:{s:8:"required";a:3:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}s:7:"package";a:3:{s:4:"name";s:2:"P2";s:7:"channel";s:13:"pear2.php.net";s:11:"recommended";s:5:"1.1.0";}}}<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p3">P3</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 16:39:44</da>
 <n>my notes</n>
 <f>1339</f>
 <g>http://pear2.php.net/get/P3-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P3</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p3">P3</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 16:39:44</da>
 <n>my notes</n>
 <f>1339</f>
 <g>http://pear2.php.net/get/P3-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P1</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>16:39:44</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby1"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <recommended>1.2.0</recommended>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
a:1:{s:8:"required";a:3:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}s:7:"package";a:3:{s:4:"name";s:2:"P2";s:7:"channel";s:13:"pear2.php.net";s:11:"recommended";s:5:"1.2.0";}}}<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.0.0</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p1">P1</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 16:39:44</da>
 <n>my notes</n>
 <f>1339</f>
 <g>http://pear2.php.net/get/P1-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
1.0.0<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P1</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p1">P1</p>
 <c>pear2.php.net</c>
 <v>1.0.0</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 16:39:44</da>
 <n>my notes</n>
 <f>1339</f>
 <g>http://pear2.php.net/get/P1-1.0.0</g>
 <x xlink:href="package.1.0.0.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release2 http://pear.php.net/dtd/rest.release2.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.2.1</v>
 <a>0.1.0</a>
 <mp>5.2.0</mp>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 16:39:44</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P2-1.2.1</g>
 <x xlink:href="package.1.2.1.xml"/>
</r>
1.2.1a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"5.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"2.0.0a1";}}}<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>16:39:44</time>
 <version>
  <release>1.2.1</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<r xmlns="http://pear.php.net/dtd/rest.release" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.release http://pear.php.net/dtd/rest.release.xsd">
 <p xlink:href="rest/p/p2">P2</p>
 <c>pear2.php.net</c>
 <v>1.2.1</v>
 <st>stable</st>
 <l>New BSD License</l>
 <m>cellog</m>
 <s>testing</s>
 <d>hi description</d>
 <da>2009-05-20 16:39:44</da>
 <n>my notes</n>
 <f>1218</f>
 <g>http://pear2.php.net/get/P2-1.2.1</g>
 <x xlink:href="package.1.2.1.xml"/>
</r>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases http://pear.php.net/dtd/rest.allreleases.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.2.1</v>
  <s>stable</s>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<a xmlns="http://pear.php.net/dtd/rest.allreleases2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.allreleases2 http://pear.php.net/dtd/rest.allreleases2.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <r>
  <v>1.2.1</v>
  <s>stable</s>
  <m>5.2.0</m>
 </r>
</a>
<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers2 http://pear.php.net/dtd/rest.packagemaintainers2.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
  <r>lead</r>
 </m>
</m>
1.2.1<?xml version="1.0" encoding="UTF-8"?>
<m xmlns="http://pear.php.net/dtd/rest.packagemaintainers" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/rest.packagemaintainers http://pear.php.net/dtd/rest.packagemaintainers.xsd">
 <p>P2</p>
 <c>pear2.php.net</c>
 <m>
  <h>cellog</h>
  <a>yes</a>
 </m>
</m>
ã      ÏY[o€6ˆs~°wã§.ˆj0 Z,€K:ÎÏ≠`$Œ&J]F“µçaˇ}á¥d…hëƒÖÁ†àæâÁ¬s»Û“ê√m©¥XJcı7<ˇƒó¬‡FpÖÕ™	+aÒ}åiHB2mı!¯LN %dñ$ì	r Ë¯âPîFsDiDR2O¢ÑÄÑ∆tÜ&‰î ﬂäµ±\OπﬂÈµyƒÓ)˝w
v≈DüÖ6≤ÆÆ®sÄDï◊Ö¨ñ◊¡øˇ<˝!∏…ÆX[˙ﬁ2
iÄ¿∑2◊¡ ⁄fÅ=k§)l—Òi⁄€.,7üÒÍ©œboø5Ú`ΩŸl¬M÷zâ#B(˛Û˝›á|%J>ïT± xπ0^xWÁ‹˙TüÊi¯§U∏5≈£ñÉÂ>◊ŒÕ†V†õÌdWàUºŸ}Ã∞Aæ‚U%Tv‘¢wb∞0Î≤‰zóYa,Të·N ∫Bò\À∆ÌK∂íh0dx®S%xœ6Ö_‡ê@Ôáπ ∂6BgπP™Ü0~‡§∞˘Rµ‚Ó•Nœs+?ãl'√Ì;ƒ√m@Vp+2(õ)IßÅƒú VBX:[ƒoI¬∞Ç∏›5?µ0ã+∑ÅwCµëÅ±{u{O¸yêJ⁄›—4N™ƒóÛp’¨x?œ–ô)ôã ¥÷«Ã≠◊kùœ‡÷Ã‡SL€Å+gê˝*6Ë›áü–›^»:SOá™öï;‰_†~ÏhQWVT÷¯©ë´—uÄâ@ÚóTÈZÅ»≈hµFÁx©Í˙aÿ{bpıKÃ§Å‘8§0Ìˆ¸ΩñZ˚πaBˇÇX)´,#∑≈Ó’kqßfé±æQï⁄•ıdÁÙ»Á”Ó j˝ˆmıTDœË‰SœÎ≤tÀ)Ä$tOí^‘ÜÔc9ıa±ÆGé∂¬≠ΩÂÏﬂ¿Ò•èıgc@Åˇ-Fˇ”yÍÔ˝ÓŸ!:æˇ)ù¡cºˇ/Äï|ÈFº$\ˇﬂﬂæ˝-¬o◊∂V5/‹…yﬁO˜Ï˚?â“8öE†éì8˚ˇX…ÔÁÆq~Ù˝ˇ~≠¨º’∫÷ÊÃG¿I˝?OAù–t>ˆˇ%0ˆˇÎ∆W˚ﬂns·?úÂ$8•ˇcÉzF…¯˝Ô"˚ˇu£ÔˇÛˆ¸ß˝˛üπﬂˇ≥hÏˇã`Ïˇ◊çÀﬁˇ_˝ˇQ2¸˛GAêŒ”±ˇ/væ 7y|‡„ÅHl≠®äŒ¶óˇÛÔKØ`ƒà#F|˛  ˇˇ º $  .xmlregistry/packages/pear2.php.net/P2/1.2.1-package.xml                                            100644       0       0         2336 11205074240  21316  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P2</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>16:39:44</time>
 <version>
  <release>1.2.1</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby2"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                                                                                                                                                  src/glooby2                                                                                         100644    1750    1750            2 11205074240  11637  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205074240  15755  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              .xmlregistry/packages/pear2.php.net/P3/1.0.0-package.xml                                            100644       0       0         2527 11205074240  21316  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P3</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>16:39:44</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby3"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <recommended>1.1.0</recommended>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                         src/glooby3                                                                                         100644    1750    1750            2 11205074240  11640  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205074241  15756  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ã      ÏYKo€8ˆ9øÇ–›"©áΩ5e[4ªó¥∂[`o#qm¢zï§jEˇ˚i…í€"âØÉ"˙.Á¡ræ!€ﬂπK©ç⁄‚öß˘Rh\Æø^’~)æ•ò˙ƒ'”VÔÉœ‰PBfQ4ô Çüq0Gî$&Û(àHhH#4!«˘Y4⁄p5!‰v´}è›C˙_Ï
äâ>•eU^zPgâ2≠2Y./Ω˜ˇ1˝ÕªJ.X[˙ﬁ2©á¿∑‘óﬁ òzÅkˆ§…L÷Òi⁄€.◊ÔÒpÍ©Àbgø—roΩ^Ø˝uËWjâB(˛ÁÕÕªt%
>ï%T±Lxiπ–NxS•‹∏TÊh¯†ïø—ŸΩñÉÂ>÷ŒŒÈ°V†õÌÊ%àïº…-eÿΩÄ ]Ò≤yr–¢wb∞–MQpµMå–™»p' ]&t™dm˜%YI42<‘Åi.xœ6Ö?·ê@Øá˜π ÷h°íT‰ya‹¿JaÛeﬁäﬂg∏ìZ=Oç¸,í≠–∑Ô∑Y∆çH†¿/¶$û≥P	aÈlæXD√n‚v◊‹‘J¿,¨Ï2‹]‘Z&vƒˆ’FÏ=ÁNÊ“l¶±“\|?œÎÔÁ:≥\¶¢‘5ÍêπU‚™Q©pnÕ4æ”Ÿ¥ÿrz…[±FØﬁΩF7;!ÎL*®jRlë{ÅJ∏±•EUQÌRÃ§B∂Fó∂$…ø2HU9àlåV´UäóyU›m©áù'W∑§¡|@H=ÉSA
›nœßF*ëÌÊÜ	›bÖ,ìÿÏ€Wß≈ùöY∆∫FÕÛQZGvN|æ3Ì†÷o◊AOEÙàŒ@.ı¥*
ªúHÏH“ã⁄},´ﬁ/÷ˆ»¡Vÿµ∑‹Ä˝8>ı±˛h(ø≈ËÔ:è›Ωﬂ=;á˜?•≥p6ﬁˇÁ¿J>u#û∂ˇoØ_˛‡óç©Úägˆ‰<måá˚?t˝qÃPáQ8~ˇü+˘Î‹U#Nèæˇﬂ4πë◊JUJü¯8™ˇÁ1®#œ«˛?∆˛ﬁ¯aˇ„ÎM*‹'9	éÈˇêÜ†ûQ2~ˇücˇ?oÙ˝⁄û‚∏Ôˇô˝˛ücˇücˇ?oú˜˛ˇ·ˇàíoˇãÁq<ˆˇ9¿Æ†¬iŒµFé<¯∞Á# ¨≥ÈÂ_æ>ı
Få1bƒœ‡?   ˇˇ  ÁÎ $  ã      ÏY[o€6ˆs~°wã§n^Fiãe{Iá`mÅΩåƒ⁄DiI#©⁄∆∞ˇæCZ≤ÂÆHÊ"sZDﬂã»s·9‚˘i»·f•¥XHcı7º¯ƒ¬‡FpÖÕ≤	+aÒmÑiÖt⁄ÈCôú JHñ$ì	r Ë¯âP«¢4")ô%QB@Bcö°	9%»∑¢5ñÎ	!∑[›ö{Ï“ˇ†`WPLÙYh#ÎÍ2†!	ê®ä∫î’‚2xˇÓóÈO¡U~¡∫“,Åﬂ \Kkõ9ˆ¨Ÿì¶¥eœßÈ¡vnπ˘tèáWO};˚çë{ÎızÆ„∞÷BÒonﬁK±‚SYA´BÄóës„Ö7u¡≠Oı¡`ûÜZÖSﬁk9x›ˇjÁ÷P'–ÉÕ%∞˘b_â¸6bÿ@P,yU	ïµ(√Ω,LªZqΩÕ≠0™»p/ ])L°e„ˆ%_J4ò2<‘Å©ºÑgó¬ØpH†◊ÇCä˚\kç–y!î™!åü8)læTù¯Â>√ù‘ÈyaÂgëoÖa∏C<‹d%∑"áøòítHÃ	@a%Ñ•Ÿ<~1OÜ˝ƒ›Æ˘•µÄUXπÛä·~Í£62'∞„∞†∫àO¸πìJ⁄Ì—2N™ƒø◊·™YÚ√:Cg¶d!*#P´èô[7 Æ[]œ‡ŒÃ‡;SNªâ+gêˇ&÷Ëı€ü—ÕN»zSOá™öØ∂»†~ÓhQWVT÷¯K©ë´—eÄâ@ÚQ*Åt≠@‰btZ£ºPu}∑çÏ=1∏˙W¨§Å‘K8§0›ˆ¸ŸJ- ›⁄∞† ∂íUû¬Œ√ª°◊‚^Õc}£*µ#JÁ·…ŒÈëœó¶Æ˚òé™Gπ∫¡k∞æ¡Úãß>]ø(ø≈8‹ˇtñ˙{øˆàéÔJ≥x6ﬁˇÁ¿R>u#ûÆˇoØ_˝·W≠≠UÕKw	=nåá˚?ˆ˝üDie®„$N∆˛?ñrº$ü3˝ˇ¶UV^k]kÛ»G¿I˝?KAù–tºˇœÇ±ˇü7æ⁄ˇ¯zSˇ!‡QNÇS˙?¶1®3J∆Ôg¡ÿˇœá˛‹û‚¥ﬂˇô˚˝üEcˇücˇ?oú˜˛ˇÍˇàí/øˇ•≥4˚ˇ`WP·ãBqcêÁ¡á>ÏyÄƒ∆ä™ÏmÚø˛~Í71bƒàﬂÇ   ˇˇ uk5§ $  .xmlregistry/packages/pear2.php.net/P1/1.0.0-package.xml                                            100644       0       0         2527 11205074240  21314  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd" packagerversion="2.0.0">
 <name>P1</name>
 <channel>pear2.php.net</channel>
 <summary>testing</summary>
 <description>hi description</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-05-20</date>
 <time>16:39:44</time>
 <version>
  <release>1.0.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>my notes</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/glooby1"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
   <package>
    <name>P2</name>
    <channel>pear2.php.net</channel>
    <recommended>1.2.0</recommended>
   </package>
  </required>
 </dependencies>
 <phprelease/>
</package>
                                                                                                                                                                         src/glooby1                                                                                         100644    1750    1750            2 11205074240  11636  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              src/PEAR2/Autoload.php                                                                              100644    1750    1750            3 11204253262  13434  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors.php                                                                           100644    1750    1750            3 11204253275  14157  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644    1750    1750            3 11204253313  16106  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/Exception.php                                                                             100644    1750    1750            3 11204253266  13626  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  hi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             src/PEAR2/MultiErrors/Exception.php                                                                 100644       0       0          102 11205074240  15755  0                                                                                                    ustar 00Pyrus                           Pyrus                                                                                                                                                                                                                  <?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <?php
/**
 * Simulate the internet
 */
class Internet extends PEAR2_HTTP_Request
{
    public static $requestMap;

    /**
     * sets up the adapter
     *
     * @param  string $class adapter to use
     */
    public function __construct($url = null) 
    {
        $this->adapter = new Internet_Adapter($this);
        if ($url) {
            $this->url = $url;
        }
    }

    static function addDirectory($dir, $urlbase)
    {
        self::$requestMap[$urlbase] = realpath($dir);
    }
}

class Internet_Exception extends Exception {}

class Internet_Adapter extends PEAR2_HTTP_Request_Adapter
{
    public $internet;
    function __construct($internet)
    {
        $this->internet = $internet;
    }

    /**
     * Send the request
     *
     * This function sends the actual request to the
     * remote/local webserver using pecl http
     *
     * @link http://us2.php.net/manual/en/http.request.options.php
     * @todo catch exceptions from HttpRequest and rethrow
     * @todo handle Puts
     */
    public function sendRequest() 
    {
        $uri = $this->uri->url;
        $actualfile = false;
        foreach (Internet::$requestMap as $urlbase => $dir) {
            if (strpos($uri, $urlbase) === 0) {
                $actualfile = $dir . DIRECTORY_SEPARATOR . substr($uri, strlen($urlbase));
                break;
            }
        }
        if (!$actualfile) {
            throw new Internet_Exception('URL ' . $uri . ' is not in the request map, setup is needed');
        }
        $details = $this->uri->toArray();
        if (!file_exists($actualfile)) {
            $details['code'] = '404';
            $body = '';
        } else {
            $body = file_get_contents($actualfile);
            $details['code'] = '200';
        }
        // $this->verb is GET/POST/etc.
        // $this->uri is PEAR2_HTTP_Request_Uri
        // $this->headers is array of headers
        // $this->body is request body

        $details['httpVersion'] = 'HTTP/1.1';
        $cookies = array();
        $headers = array();
        if ($details['code'] == '200') {
            $headers['content-disposition'] = 'filename="' . basename($actualfile) . '"';
            $headers['content-length'] = strlen($body);
            $headers['etag'] = md5($body);
            $headers['last-modified'] = date('Y-m-d H:i', filemtime($actualfile));
            $info = pathinfo($actualfile);
            switch ($info['extension']) {
                case 'xml' :
                    $headers['content-type'] = 'text/xml';
                    break;
                case 'txt' :
                    $headers['content-type'] = 'text/plain';
                    break;
                default :
                    $headers['content-type'] = 'application/octet-stream';
            }
        }

        return new PEAR2_HTTP_Request_Response($details, $body, $headers, $cookies);
    }	   
}
--TEST--
PEAR2_Pyrus_Installer::commit() scripts should be executable
--FILE--
<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
$package = new PEAR2_Pyrus_Package(__DIR__.'/../../../sandbox/SimpleChannelServer/package.xml');
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare($package);
PEAR2_Pyrus_Installer::commit();
$test->assertEquals(true, file_exists(__DIR__ . '/testit/bin/pearscs'), 'script was installed');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Installer::install() verify files installed correctly
--FILE--
<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
$package = new PEAR2_Pyrus_Package(__DIR__.'/../../../sandbox/SimpleChannelServer/package.xml');
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare($package);
PEAR2_Pyrus_Installer::commit();
$test->assertFileExists(__DIR__ . '/testit/bin/pearscs', 'bin/pearscs');
$test->assertEquals(decoct(0755), decoct(0777 & fileperms(__DIR__ . '/testit/bin/pearscs')), 'bin/pearscs perms');
$test->assertFileExists(__DIR__ . '/testit/php/PEAR2/SimpleChannelServer.php', 'src/PEAR2/SimpleChannelServer.php');
$test->assertEquals(file_get_contents(__DIR__.'/../../../sandbox/SimpleChannelServer/src/SimpleChannelServer.php'),
                    file_get_contents(__DIR__ . '/testit/php/PEAR2/SimpleChannelServer.php'), 'files match');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Installer::prepare() installed package is the same or newer version
--FILE--
<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
$package = new PEAR2_Pyrus_Package(__DIR__.'/../../../sandbox/SimpleChannelServer/package.xml');
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();

class TestLog implements PEAR2_Pyrus_ILog
{
    protected $messages = array();
    
    function log($level, $message)
    {
        $this->messages[] = $message;
    }
    
    function getMessages()
    {
        return $this->messages;
    }
}

PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare($package);
PEAR2_Pyrus_Installer::commit();
$observer = new TestLog();
PEAR2_Pyrus_Log::attach($observer);
PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare($package);
PEAR2_Pyrus_Installer::commit();
$test->assertEquals(true, in_array("Skipping installed package {$package->channel}/{$package->name}", $observer->getMessages()), 'package already installed');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Installer::prepare(), composite dep conflict 3
--FILE--
<?php
/**
 * Test a dependency tree like so:
 *
 * P1 -> P2 recommended 1.2.0
 * P3 -> P2 recommended 1.1.0
 *
 * to test composite dep failure
 */

define('MYDIR', __DIR__);
include __DIR__ . '/../setup.php.inc';
require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../../Mocks/Internet/installer.prepare.depconflict2',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('pear2/P3-1.0.0'));
PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('pear2/P1-1.0.0'));
try {
    PEAR2_Pyrus_Installer::preCommitDependencyResolve();
    throw new Exception('should have failed, did not');
} catch (PEAR2_Pyrus_Package_Exception $e) {
    $test->assertEquals('Cannot install pear2.php.net/P2, two dependencies conflict (' .
                        'different recommended values for pear2.php.net/P1 and pear2.php.net/P3)', $e->getMessage(),
                        'right cause message');
}
PEAR2_Pyrus_Installer::rollback();
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Installer::prepare(), dependency is installed, and is latest version
--FILE--
<?php

define('MYDIR', __DIR__);
include __DIR__ . '/../setup.php.inc';
require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../../Mocks/Internet/install.prepare.explicitstate',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
PEAR2_Pyrus_Installer::$options['upgrade'] = true;
class b extends PEAR2_Pyrus_Installer
{
    static $installPackages = array();
}

// first, install P2 1.0.0 in the registry
$a = new PEAR2_Pyrus_PackageFile(__DIR__ .
                                '/../../Mocks/Internet/install.prepare.explicitstate/rest/r/p2/package.1.1.0RC3.xml');
PEAR2_Pyrus_Config::current()->registry->package[] = $a->info;

b::begin();
b::prepare(new PEAR2_Pyrus_Package('pear2/P1-beta'));
b::preCommitDependencyResolve();
$test->assertEquals(1, count(b::$installPackages), '1 package should be installed');
$test->assertEquals('1.1.0RC1', b::$installPackages['pear2.php.net/P1']->version['release'], 'verify P1-1.1.0RC1');
b::rollback();
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Installer::prepare(), dep already installed, not upgrading
--FILE--
<?php
/**
 * P1-1.1.0RC1 beta -> P2
 *
 * P2-1.2.0a1 alpha
 * P2-1.1.0RC3 beta
 * P2-1.0.0
 *
 * P3-1.1.0RC1 beta
 * P3-1.1.0
 * P3-1.0.0         -> P2 <= 1.0.0
 *
 * Install of P1-beta and P3-1.0.0 should install
 *
 *  - P1-1.1.0RC1
 *  - P2-1.0.0 (already installed)
 *  - P3-1.1.0
 */

define('MYDIR', __DIR__);
include __DIR__ . '/../setup.php.inc';
require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../../Mocks/Internet/install.prepare.explicitstate',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
class b extends PEAR2_Pyrus_Installer
{
    static $installPackages = array();
}

// first, install P2 1.0.0 in the registry
$a = new PEAR2_Pyrus_PackageFile(__DIR__ .
                                '/../../Mocks/Internet/install.prepare.explicitstate/rest/r/p2/package.1.0.0.xml');
PEAR2_Pyrus_Config::current()->registry->package[] = $a->info;

b::begin();
b::prepare(new PEAR2_Pyrus_Package('pear2/P1-beta'));
b::prepare(new PEAR2_Pyrus_Package('pear2/P3-1.0.0'));
b::preCommitDependencyResolve();
$test->assertEquals(2, count(b::$installPackages), '2 packages should be installed');
$pnames = array();
foreach (b::$installPackages as $package) {
    $pnames[] = $package->name;
    switch ($package->name) {
        case 'P1' :
            $test->assertEquals('1.1.0RC1', $package->version['release'], 'verify P1-1.1.0RC1');
            break;
        case 'P3' :
            $test->assertEquals('1.0.0', $package->version['release'], 'verify P3-1.0.0');
            break;
        default:
            $test->assertEquals(false, $package->name, 'wrong package downloaded');
    }
}
sort($pnames);
$test->assertEquals(array('P1', 'P3'), $pnames, 'correct packages');
b::rollback();
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Installer::prepare(), dependency already installed, upgrade available, but we're not upgrading
--FILE--
<?php

define('MYDIR', __DIR__);
include __DIR__ . '/../setup.php.inc';
require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../../Mocks/Internet/install.prepare.explicitstate',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
class b extends PEAR2_Pyrus_Installer
{
    static $installPackages = array();
}

// first, install P2 1.0.0 in the registry
$a = new PEAR2_Pyrus_PackageFile(__DIR__ .
                                '/../../Mocks/Internet/install.prepare.explicitstate/rest/r/p2/package.1.0.0.xml');
PEAR2_Pyrus_Config::current()->registry->package[] = $a->info;

b::begin();
b::prepare(new PEAR2_Pyrus_Package('pear2/P1-beta'));
b::preCommitDependencyResolve();
$test->assertEquals(1, count(b::$installPackages), '1 package should be installed');
$test->assertEquals('1.1.0RC1', b::$installPackages['pear2.php.net/P1']->version['release'], 'verify P1-1.1.0RC1');
b::rollback();
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Installer::prepare(), composite dep conflict 1
--FILE--
<?php
/**
 * Test a dependency tree like so:
 *
 * P1 -> P2 >= 1.2.0
 * P3 -> P2 <= 1.1.0
 *
 * to test composite dep failure
 */

define('MYDIR', __DIR__);
include __DIR__ . '/../setup.php.inc';
require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../../Mocks/Internet/installer.prepare.depconflict1',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('pear2/P1-1.0.0'));
PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('pear2/P3-1.0.0', true));
try {
    PEAR2_Pyrus_Installer::preCommitDependencyResolve();
    throw new Exception('should have failed, did not');
} catch (PEAR2_Pyrus_Package_Exception $e) {
    $test->assertEquals('Cannot install pear2.php.net/P2, two dependencies conflict (' .
                        'pear2.php.net/P3 max is < pear2.php.net/P1 min)', $e->getMessage(),
                        'right cause message');
}
PEAR2_Pyrus_Installer::rollback();
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Installer::prepare(), duplicate package
--FILE--
<?php
define('MYDIR', __DIR__);
include __DIR__ . '/../setup.php.inc';
class boo extends PEAR2_Pyrus_Installer
{
    static $installPackages = array();
}
boo::begin();
boo::prepare($package);
$test->assertEquals(1, count(boo::$installPackages), 'first prepare');
boo::prepare($package);
$test->assertEquals(1, count(boo::$installPackages), 'second prepare');
boo::rollback();
$test->assertEquals(0, count(boo::$installPackages), 'rollback');
// this passes if no exceptions are thrown
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Installer::prepare(), dep already installed, upgrade version fails dep tests, fall back to installed
--FILE--
<?php
/**
 * P1-1.1.0RC1 beta -> P2
 *
 * P2-1.2.0a1 alpha
 * P2-1.1.0RC3 beta
 * P2-1.0.0
 *
 * P3-1.1.0RC1 beta
 * P3-1.1.0
 * P3-1.0.0         -> P2 <= 1.0.0
 *
 * Install of P1-beta and P3-1.0.0 should install
 *
 *  - P1-1.1.0RC1
 *  - P2-1.0.0 (already installed)
 *  - P3-1.0.0
 */

define('MYDIR', __DIR__);
include __DIR__ . '/../setup.php.inc';
require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../../Mocks/Internet/install.prepare.explicitstate',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
class b extends PEAR2_Pyrus_Installer
{
    static $installPackages = array();
}

// first, install P2 1.0.0 in the registry
$a = new PEAR2_Pyrus_PackageFile(__DIR__ .
                                '/../../Mocks/Internet/install.prepare.explicitstate/rest/r/p2/package.1.0.0.xml');
PEAR2_Pyrus_Config::current()->registry->package[] = $a->info;
PEAR2_Pyrus_Installer::$options['upgrade'] = true;

b::begin();
b::prepare(new PEAR2_Pyrus_Package('pear2/P1-beta'));
b::prepare(new PEAR2_Pyrus_Package('pear2/P3-1.0.0'));
b::preCommitDependencyResolve();
$test->assertEquals(2, count(b::$installPackages), '2 packages should be installed');
$pnames = array();
foreach (b::$installPackages as $package) {
    $pnames[] = $package->name;
    switch ($package->name) {
        case 'P1' :
            $test->assertEquals('1.1.0RC1', $package->version['release'], 'verify P1-1.1.0RC1');
            break;
        case 'P3' :
            $test->assertEquals('1.0.0', $package->version['release'], 'verify P3-1.0.0');
            break;
        default:
            $test->assertEquals(false, $package->name, 'wrong package downloaded');
    }
}
sort($pnames);
$test->assertEquals(array('P1', 'P3'), $pnames, 'correct packages');
b::rollback();
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Installer::prepare(), installing package-beta with its dependencies
--FILE--
<?php
/**
 * Test cascade of preferred stability to a package and its dependencies only
 *
 * P1-1.1.0RC1 beta -> P2
 * P1-1.0.0         -> P2
 *
 * P2-1.2.0a1 alpha
 * P2-1.1.0RC3 beta
 * P2-1.0.0
 *
 * P3-1.1.0RC1 beta
 * P3-1.1.0
 * P3-1.0.0         -> P2 <= 1.0.0
 *
 * Install of P1-beta and P3 should install
 *
 *  - P1-1.1.0RC1
 *  - P2-1.1.0RC3
 *  - P3-1.1.0
 */

define('MYDIR', __DIR__);
include __DIR__ . '/../setup.php.inc';
require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../../Mocks/Internet/install.prepare.explicitstate',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
class b extends PEAR2_Pyrus_Installer
{
    static $installPackages = array();
}

b::begin();
b::prepare(new PEAR2_Pyrus_Package('pear2/P1-beta'));
b::prepare(new PEAR2_Pyrus_Package('pear2/P3'));
b::preCommitDependencyResolve();
$test->assertEquals(3, count(b::$installPackages), '3 packages should be installed');
$pnames = array();
foreach (b::$installPackages as $package) {
    $pnames[] = $package->name;
    switch ($package->name) {
        case 'P1' :
            $test->assertEquals('1.1.0RC1', $package->version['release'], 'verify P1-1.1.0RC1');
            break;
        case 'P2' :
            $test->assertEquals('1.1.0RC3', $package->version['release'], 'verify P2-1.1.0RC3');
            break;
        case 'P3' :
            $test->assertEquals('1.1.0', $package->version['release'], 'verify P3-1.1.0');
            break;
        default:
            $test->assertEquals(false, $package->name, 'wrong package downloaded');
    }
}
sort($pnames);
$test->assertEquals(array('P1', 'P2', 'P3'), $pnames, 'correct packages');
b::rollback();
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Installer::prepare(), composite dep conflict 2
--FILE--
<?php
/**
 * Test a dependency tree like so:
 *
 * P1 -> P2 >= 1.2.0
 * P3 -> P2 <= 1.1.0
 *
 * to test composite dep failure
 */

define('MYDIR', __DIR__);
include __DIR__ . '/../setup.php.inc';
require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../../Mocks/Internet/installer.prepare.depconflict1',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('pear2/P3-1.0.0'));
PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('pear2/P1-1.0.0'));
try {
    PEAR2_Pyrus_Installer::preCommitDependencyResolve();
    throw new Exception('should have failed, did not');
} catch (PEAR2_Pyrus_Package_Exception $e) {
    $test->assertEquals('Cannot install pear2.php.net/P2, two dependencies conflict (' .
                        'pear2.php.net/P1 min is > pear2.php.net/P3 max)', $e->getMessage(),
                        'right cause message');
}
PEAR2_Pyrus_Installer::rollback();
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Installer::prepare(), resolve the correct dependency version from 2 options
--FILE--
<?php
/**
 * Test a dependency tree like so:
 *
 * P1 -> P2 >= 1.2.0 (1.2.3 is latest version)
 *
 * P2 1.2.3 -> P3
 *          -> P5
 *
 * P2 1.2.2 -> P3
 *
 * P3
 *
 * P4 -> P2 != 1.2.3
 *
 * P5
 *
 * This causes a conflict when P1 and P4 are installed that must resolve to installing:
 *
 * P1
 * P2 1.2.2
 * P3
 * P4
 */

define('MYDIR', __DIR__);
include __DIR__ . '/../setup.php.inc';
require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../../Mocks/Internet/installer.prepare.dep.versionconflict',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
class boo extends PEAR2_Pyrus_Installer
{
    static $installPackages = array();
}
boo::begin();
boo::prepare(new PEAR2_Pyrus_Package('pear2/P1-1.0.0'));
boo::prepare(new PEAR2_Pyrus_Package('pear2/P4-stable', true));
boo::preCommitDependencyResolve();
$test->assertEquals(4, count(boo::$installPackages), '4 packages should be installed');
$pnames = array();
foreach (boo::$installPackages as $package) {
    $pnames[] = $package->name;
    switch ($package->name) {
        case 'P1' :
        case 'P3' :
        case 'P4' :
            // these should be in there and we don't care about version
            break;
        case 'P5' :
            $test->assertFalse(true, 'Package P5 downloaded');
            break;
        case 'P2' :
            $test->assertEquals('1.2.2', $package->version['release'], 'verify we got 1.2.2');
            break;
        default:
            $test->assertEquals(false, $package->name, 'wrong package downloaded');
    }
}
sort($pnames);
$test->assertEquals(array('P1', 'P2', 'P3', 'P4'), $pnames, 'correct packages');
boo::rollback();
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Installer::prepare(), composite dep conflict 4
--FILE--
<?php
/**
 * In order to test excluding all possible versions
 * 
 * Create a dependency tree like so:
 *
 * P1 -> P2 min 1.1.0, exclude 1.2.0
 * P3 -> P2 max 1.3.0, exclude 1.2.3
 *
 * P2 only has releases for 1.0.0, 1.2.0, 1.2.3, and 1.3.1
 *
 * to test composite dep failure
 */

define('MYDIR', __DIR__);
include __DIR__ . '/../setup.php.inc';
require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../../Mocks/Internet/installer.prepare.depconflict4',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('pear2/P3-1.0.0'));
PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('pear2/P1-1.0.0'));
try {
    PEAR2_Pyrus_Installer::preCommitDependencyResolve();
    throw new Exception('should have failed, did not');
} catch (PEAR2_Pyrus_Installer_Exception $e) {
    $test->assertEquals('Dependency validation failed for some packages to install, installation aborted', $e->getMessage(),
                        'right error message');
    $test->assertIsa('PEAR2_Pyrus_Channel_Exception', $e->getCause(), 'cause class');
    $test->assertEquals('Unable to locate a package release for pear2.php.net/P2 that can satisfy all dependencies', $e->getCause()->getMessage(), 'cause message');
}
PEAR2_Pyrus_Installer::rollback();
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?xml version="1.0"?>
<pearconfig version="1.0"><default_channel>pear2.php.net</default_channel><preferred_mirror>pear2.php.net</preferred_mirror><auto_discover>0</auto_discover><http_proxy></http_proxy><cache_dir>/home/user/workspace/all/Pyrus/tests/Installer/prepare/testit/cache</cache_dir><temp_dir>/home/user/workspace/all/Pyrus/tests/Installer/prepare/testit/temp</temp_dir><download_dir>/home/user/workspace/all/Pyrus/tests/Installer/prepare/testit/downloads</download_dir><username></username><password></password><verbose>1</verbose><preferred_state>stable</preferred_state><umask>0022</umask><cache_ttl>3600</cache_ttl><sig_type></sig_type><sig_bin></sig_bin><sig_keyid></sig_keyid><sig_keydir></sig_keydir><my_pear_path>/home/user/workspace/all/Pyrus/tests/Installer/prepare/testit</my_pear_path><plugins_dir>/home/user/workspace/all/Pyrus/tests/Installer/prepare</plugins_dir></pearconfig>
--TEST--
PEAR2_Pyrus_Installer::prepare(), dependency is installed, but can be upgraded
--FILE--
<?php

define('MYDIR', __DIR__);
include __DIR__ . '/../setup.php.inc';
require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../../Mocks/Internet/install.prepare.explicitstate',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
PEAR2_Pyrus_Installer::$options['upgrade'] = true;
class b extends PEAR2_Pyrus_Installer
{
    static $installPackages = array();
}

// first, install P2 1.0.0 in the registry
$a = new PEAR2_Pyrus_PackageFile(__DIR__ .
                                '/../../Mocks/Internet/install.prepare.explicitstate/rest/r/p2/package.1.0.0.xml');
PEAR2_Pyrus_Config::current()->registry->package[] = $a->info;

b::begin();
b::prepare(new PEAR2_Pyrus_Package('pear2/P1-beta'));
b::preCommitDependencyResolve();
$test->assertEquals(2, count(b::$installPackages), '2 packages should be installed');
$test->assertEquals('1.1.0RC1', b::$installPackages['pear2.php.net/P1']->version['release'], 'verify P1-1.1.0RC1');
$test->assertEquals('1.1.0RC3', b::$installPackages['pear2.php.net/P2']->version['release'], 'verify P2-1.1.0RC3');
b::rollback();
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
@mkdir(MYDIR . DIRECTORY_SEPARATOR . 'testit');
set_include_path(MYDIR . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(MYDIR.'/testit', MYDIR . '/testit/pearconfig.xml');
$c->bin_dir = MYDIR . '/testit/bin';
restore_include_path();
$c->saveConfig();

$pf = new PEAR2_Pyrus_PackageFile_v2;

$pf->name = 'testing2';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');
$pf->files['foobar'] = array(
    'attribs' => array('role' => 'php'),
    'tasks:replace' => array('attribs' =>
                             array('from' => '@blah@', 'to' => 'version', 'type' => 'package-info'))
);
$pf->files['glooby'] = array('role' => 'php');
$pf->release[0]->installAs('foobar', 'blah/blah');
$pf->release[0]->ignore('glooby');
$pf->setPackagefile(MYDIR . '/testit/package.xml');

$package = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(MYDIR . '/testit/package.xml', $package, $xmlcontainer);
$package->setInternalPackage($xml);
--TEST--
PEAR2_Pyrus_Installer: install remote packages with complex dependencies
--FILE--
<?php
/**
 * Test a dependency tree like so:
 *
 * P1 -> P2 >= 1.2.0 (1.2.3 is latest version)
 *
 * P2 1.2.3 -> P3
 *          -> P5
 *
 * P2 1.2.2 -> P3
 *
 * P3
 *
 * P4 -> P2 != 1.2.3
 *
 * P5
 *
 * This causes a conflict when P1 and P4 are installed that must resolve to installing:
 *
 * P1
 * P2 1.2.2
 * P3
 * P4
 */

define('MYDIR', __DIR__);
include __DIR__ . '/setup.php.inc';
require __DIR__ . '/../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../Mocks/Internet/installer.prepare.dep.versionconflict',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
PEAR2_Pyrus_Package_Remote::$downloadClass = 'Internet';
PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('pear2/P1-1.0.0'));
PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('pear2/P4-stable', true));
PEAR2_Pyrus_Installer::commit();
$reg = PEAR2_Pyrus_Config::current()->registry;
for ($i = 1; $i <= 4; $i++) {
    $test->assertTrue(isset($reg->package["P$i"]), "installed P$i");
}
$test->assertFalse(isset($reg->package['P5']), 'installed P5');
$test->assertEquals('1.0.0', $reg->info('P1', 'pear2.php.net', 'version'), 'P1 version');
$test->assertEquals('1.2.2', $reg->info('P2', 'pear2.php.net', 'version'), 'P2 version');
$test->assertEquals('1.0.0', $reg->info('P3', 'pear2.php.net', 'version'), 'P3 version');
$test->assertEquals('1.0.0', $reg->info('P4', 'pear2.php.net', 'version'), 'P4 version');

for ($i = 1; $i <= 4; $i++) {
    $test->assertFileExists(__DIR__ . "/testit/php/glooby$i", "P$i file not installed");
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
$__e = error_reporting();
error_reporting(E_ERROR|E_NOTICE|E_WARNING);
require_once __DIR__ . '/../../autoload.php';
@include_once 'Text/Diff.php';
@include_once 'Text/Diff/Renderer.php';
@include_once 'Text/Diff/Renderer/unified.php';
error_reporting($__e);
class PEAR2_PHPT
{
    var $_diffonly;
    function __construct($diffonly = false)
    {
        $this->_diffonly = $diffonly;
        $this->_errors = array();
    }

    function assertTrue($test, $message)
    {
        if ($test === true) {
            return true;
        }
        $this->_failTest(debug_backtrace(), $message);
        echo "Unexpected non-true value: \n";
        var_export($test);
        echo "\n'$message'\n";
        return false;
    }

    function assertIsa($control, $test, $message)
    {
        if (is_a($test, $control)) {
            return true;
        }
        $this->_failTest(debug_backtrace(), $message);
        echo "Unexpected non-$control object: \n";
        var_export($test);
        echo "\n'$message'\n";
        return false;
    }

    function assertNull($test, $message)
    {
        if ($test === null) {
            return true;
        }
        $this->_failTest(debug_backtrace(), $message);
        echo "Unexpected non-null value: \n";
        var_export($test);
        echo "\n'$message'\n";
        return false;
    }

    function assertNotNull($test, $message)
    {
        if ($test !== null) {
            return true;
        }
        $this->_failTest(debug_backtrace(), $message);
        echo "Unexpected null: \n";
        var_export($test);
        echo "\n'$message'\n";
        return false;
    }

    function assertSame($test, $test1, $message)
    {
        if ($test === $test1) {
            return true;
        }
        $this->_failTest(debug_backtrace(), $message);
        echo "Unexpectedly two vars are not the same thing: \n";
        echo "\n'$message'\n";
        return false;
    }

    function assertNotSame($test, $test1, $message)
    {
        if ($test !== $test1) {
            return true;
        }
        $this->_failTest(debug_backtrace(), $message);
        echo "Unexpectedly two vars are the same thing: \n";
        echo "\n'$message'\n";
        return false;
    }

    function assertFalse($test, $message)
    {
        if ($test === false) {
            return true;
        }
        $this->_failTest(debug_backtrace(), $message);
        echo "Unexpected non-false value: \n";
        var_export($test);
        echo "\n'$message'\n";
        return false;
    }

    function assertNotTrue($test, $message)
    {
        if (!$test) {
            return true;
        }
        $this->_failTest(debug_backtrace(), $message);
        echo "Unexpected loose true value: \n";
        var_export($test);
        echo "\n'$message'\n";
        return false;
    }

    function assertNotFalse($test, $message)
    {
        if ($test) {
            return true;
        }
        $this->_failTest(debug_backtrace(), $message);
        echo "Unexpected loose false value: \n";
        var_export($test);
        echo "\n'$message'\n";
        return false;
    }

    function assertRegex($regex, $test, $message)
    {
        if (!preg_match($regex, $test)) {
            $this->_failTest(debug_backtrace(), $message);
            echo "Expecting:\nText Matching Regular Expression $regex\n";
            echo "\nReceived:\n";
            var_export($test);
            echo "\n";
            return false;
        }
        return true;
    }

    function assertException($exception, $class, $emessage, $message)
    {
        if (!($exception instanceof $class)) {
            $this->_failTest(debug_backtrace(), $message);
            echo "Expecting class $class, got ", get_class($exception);
        }
        $this->assertEquals($emessage, $exception->getMessage(), $message, debug_backtrace());
    }

    function assertEquals($control, $test, $message, $trace = null)
    {
        if (!$trace) {
            $trace = debug_backtrace();
        }
        if (str_replace(array("\r", "\n"), array('', ''),
            var_export($control, true)) != str_replace(array("\r", "\n"), array('', ''),
            var_export($test, true))) {
            $this->_failTest($trace, $message);
            if (class_exists('Text_Diff')) {
                echo "Diff of expecting/received:\n";
                $diff = new Text_Diff(
                    explode("\n", var_export($control, true)),
                    explode("\n", var_export($test, true)));

                // Output the diff in unified format.
                $renderer = new Text_Diff_Renderer_unified();
                echo $renderer->render($diff);
                if ($this->_diffonly) {
                    return false;
                }
            }
            echo "Expecting:\n";
            var_export($control);
            echo "\nReceived:\n";
            var_export($test);
            echo "\n";
            return false;
        }
        return true;
    }

    function assertFileExists($fname, $message)
    {
        if (!@file_exists($fname)) {
            $this->_failTest(debug_backtrace(), $message);
            echo "File '$fname' does not exist, and should\n";
            return false;
        }
        return true;
    }

    function assertFileNotExists($fname, $message)
    {
        if (@file_exists($fname)) {
            $this->_failTest(debug_backtrace(), $message);
            echo "File '$fname' exists, and should not\n";
            return false;
        }
        return true;
    }

    function _failTest($trace, $message)
    {
        echo 'Test Failure: "' . $message  . "\"\n in " . $trace[0]['file'] . ' line ' .
            $trace[0]['line'] . "\n";
    }

    function showAll()
    {
        $this->_diffonly = false;
    }
}
$test = new PEAR2_PHPT();
?>
--TEST--
Validate_PECL::validateVersion(), failure, 1.0.0rc1
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2';
$pf->channel = 'pecl.php.net';
$pf->version['release'] = '1.0.0rc1';
$pf->stability['release'] = 'beta';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = date('Y-m-d');

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validator_PECL;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(false, $validate->validate(PEAR2_Pyrus_Validate::PACKAGING), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "version" - Release Candidate versions must have ' .
                    'upper-case RC, not lower-case rc',
                    $validate->getFailures()->E_ERROR[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
--TEST--
Validate_PECL::validateName(), failure, package name != providesextension
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->name = 'testing2';
$pf->providesextension = 'testing';
$pf->type = 'extsrc';
$pf->channel = 'pecl.php.net';
$pf->version['release'] = '1.0.0RC1';
$pf->stability['release'] = 'beta';
$pf->summary = 'hi';
$pf->description = 'hi';
$pf->date = date('Y-m-d');

$chan = new PEAR2_Pyrus_ChannelFile_v1;
$chan->setValidationPackage('notfoo', '1.2');
$validate = new PEAR2_Pyrus_Validator_PECL;
$validate->setPackageFile($pf);
$validate->setChannel($chan);

$test->assertEquals(true, $validate->validate(PEAR2_Pyrus_Validate::PACKAGING), 'test 1');
$test->assertEquals(1, count($validate->getFailures()), 'failure count');
$test->assertEquals('Channel validator error: field "providesextension" - ' .
                    'package name "testing2" is different from extension name "testing"',
                    $validate->getFailures()->E_WARNING[0]->getMessage(), 'failure message');
?>
===DONE===
--EXPECT--
===DONE===<?php
// clean up stray .xdebug files
$dir = __DIR__;
foreach (new RecursiveIteratorIterator(new RecursiveDirectoryIterator($dir), RecursiveIteratorIterator::CHILD_FIRST) as $name => $file) {
    if ($file->isDir()) {
        continue;
    }
    if (strpos($file->getFilename(), '.xdebug')) {
        unlink($file->getPathname());
    }
}
?>
--TEST--
PEAR2_Pyrus_ChannelFile_Parser_v1 errors
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
try {
    $parser->parse('', false, 'stdClass');
    throw new Exception('stdClass worked and should not');
} catch (PEAR2_Pyrus_ChannelFile_Exception $e) {
    $test->assertEquals('Class stdClass' .
                ' passed to parse() must be a child class of PEAR2_Pyrus_ChannelFile_v1',
                $e->getMessage(), 'stdClass');
}

try {
    $parser->parse('<channel');
    throw new Exception('invalid xml worked and should not');
} catch (PEAR2_Pyrus_ChannelFile_Exception $e) {
    $test->assertEquals('Invalid channel.xml',
                $e->getMessage(), 'invalid xml');
}
?>
===DONE===
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
$parser = new PEAR2_Pyrus_ChannelFile_Parser_v1;<?php

if (!isset($_SERVER['argv'],$_SERVER['argv'][1])
    || $_SERVER['argv'][1] == '--help') {
    echo "This script requires at least one argument.\n";
    echo "ignorexdebug.php dirname\n";
    exit();
}

for ($i=1; $i<$_SERVER['argc']; $i++) {
    if (is_dir($_SERVER['argv'][$i])) {
        exec('svn propset svn:ignore *.xdebug '.$_SERVER['argv'][$i]);
    }
}--TEST--
ScriptFileFilterIterator: verify it gets only script files
--FILE--
<?php
include __DIR__ . '/setup.php.inc';
$postinstall = $package->files['foobar']->postinstallscript->add();

$postinstall->paramgroup['first']->param['paramname']->type('string')->prompt('paramname');
$postinstall->paramgroup['first']->param['paramname2']->type('string')->prompt('paramname2');
$postinstall->paramgroup['first']->instructions = "testing\nthis thing";

$postinstall->paramgroup['second']->save();

$postinstall->paramgroup['third']->param['paramname']->type('string')->prompt('paramname');
$postinstall->paramgroup['third']->param['paramname2']->type('string')->prompt('paramname');

$postinstall->paramgroup['fourth']->param['paramname']->type('string')->prompt('paramname');
$postinstall->paramgroup['fourth']->param['paramname2']->type('string')->prompt('paramname');

$files = array();
foreach (new PEAR2_Pyrus_PackageFile_v2Iterator_ScriptFileFilterIterator($package->getFilelist(), $package)
         as $file) {
    $files[] = $file;
}

$test->assertEquals(1, count($files), 'correct count');
$test->assertEquals('foobar', $files[0]['attribs']['name'], 'correct script file');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include __DIR__ . '/../test_framework.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;

$pf->name = 'testing2';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');
$pf->files['foobar'] = array(
    'attribs' => array('role' => 'php'),
    'tasks:replace' => array('attribs' =>
                             array('from' => '@blah@', 'to' => 'version', 'type' => 'package-info'))
);
$pf->files['glooby'] = array('role' => 'php');
$pf->release[0]->installAs('foobar', 'blah/blah');
$pf->release[0]->ignore('glooby');
$pf->setPackagefile(__DIR__ . '/testit/package.xml');

$package = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/testit/package.xml', $package, $xmlcontainer);
$package->setInternalPackage($xml);
--TEST--
package.xml v2.0 validator: validating, fail because of custom task not known
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
@mkdir(__DIR__ . '/testit');
$pf = new PEAR2_Pyrus_PackageFile_v2;

$pf->name = 'testing';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');
$pf->files['foobar'] = array(
    'attribs' => array('role' => 'php'),
    'tasks:foo' => array('attribs' =>
                             array('from' => '@blah@', 'to' => 'version', 'type' => 'package-info'))
);
$pf->usestask['foo']->package('Foo')->channel('pear2.php.net');
$pf->setPackagefile(__DIR__ . '/testit/package.xml');

$package = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/testit/package.xml', $package, $xmlcontainer);
$package->setInternalPackage($xml);

try {
    $pf->getValidator()->validate($package);
    throw new Exception('passed and should have failed');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Invalid package.xml', $e->getMessage(), 'basic message');
    $causes = array();
    $e->getCauseMessage($causes);
    $test->assertEquals('This package contains task "foo" and requires package "channel://pear2.php.net/Foo" to be used', $causes[1]['message'], 'blah');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
package.xml v2.0 validator: validating from-object (not from parsed package.xml)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
@mkdir(__DIR__ . '/testit');
$pf = new PEAR2_Pyrus_PackageFile_v2;

$pf->name = 'testing2';
$pf->{'extends'} = 'testing';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');
$pf->files['foobar'] = array(
    'attribs' => array('role' => 'php'),
    'tasks:replace' => array('attribs' =>
                             array('from' => '@blah@', 'to' => 'version', 'type' => 'package-info'))
);
$pf->files['glooby'] = array('role' => 'php');
$pf->release[0]->installAs('foobar', 'blah/blah');
$pf->release[0]->ignore('glooby');
$pf->setPackagefile(__DIR__ . '/testit/package.xml');

$package = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/testit/package.xml', $package, $xmlcontainer);
$package->setInternalPackage($xml);

$test->assertEquals(PEAR2_Pyrus_Validate::NORMAL, $pf->getValidator()->validate($package), 'validate');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
package.xml v2.0 validator: validating, fail because of custom role not known
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
@mkdir(__DIR__ . '/testit');
$pf = new PEAR2_Pyrus_PackageFile_v2;

$pf->name = 'testing';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');
$pf->files['foobar'] = array(
    'attribs' => array('role' => 'foo'),
    'tasks:replace' => array('attribs' =>
                             array('from' => '@blah@', 'to' => 'version', 'type' => 'package-info'))
);
$pf->usesrole['foo']->package('Foo')->channel('pear2.php.net');
$pf->setPackagefile(__DIR__ . '/testit/package.xml');

$package = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/testit/package.xml', $package, $xmlcontainer);
$package->setInternalPackage($xml);

try {
    $pf->getValidator()->validate($package);
    throw new Exception('passed and should have failed');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Invalid package.xml', $e->getMessage(), 'basic message');
    $causes = array();
    $e->getCauseMessage($causes);
    $test->assertEquals('This package contains role "foo" and requires package "channel://pear2.php.net/Foo" to be used', $causes[1]['message'], 'blah');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
--TEST--
package.xml v2.0 validator: validating from-object (not from parsed package.xml)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
@mkdir(__DIR__ . '/testit');
$pf = new PEAR2_Pyrus_PackageFile_v2;

$pf->name = 'testing2';
$pf->{'extends'} = 'testing';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');
$pf->files['foobar'] = array(
    'attribs' => array('role' => 'php'),
    'tasks:replace' => array('attribs' =>
                             array('from' => '@blah@', 'to' => 'version', 'type' => 'package-info'))
);
$pf->files['glooby'] = array('role' => 'php');
$pf->release[0]->installAs('foobar', 'blah/blah');
$pf->release[0]->ignore('glooby');
$pf->setPackagefile(__DIR__ . '/testit/package.xml');

file_put_contents(__DIR__ . '/testit/foobar', '<?php
interface testing
{
    function thing();
}
class blahblah extends another implements ArrayAccess, testing
{
    /**
     * @nodep stdClass
     */
    function thing()
    {
        $a = new stdClass;
        $b::thing();
        blahblah::thing();
        parent::thing();
        $my[\'thing\'] = ($t + 1);
        $a = <<<AA
        hi
AA;
    }
}

function foo(){}
');
file_put_contents(__DIR__ . '/testit/glooby', 'foo');

$package = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/testit/package.xml', $package, $xmlcontainer);
$package->setInternalPackage($xml);

$test->assertEquals(PEAR2_Pyrus_Validate::PACKAGING, $pf->getValidator()->validate($package, PEAR2_Pyrus_Validate::PACKAGING), 'validate');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Custom command: basic test
--FILE--
<?php
include __DIR__ . '/setup.php.inc';
PEAR2_Pyrus_Installer::$options['install-plugins'] = true;

$test->assertTrue($package->isPlugin(), 'ensure the package registers as a plugin');

file_put_contents(__DIR__ . '/testit/foobar', '<?xml version="1.0" encoding="UTF-8"?>
<commands version="2.0" xmlns="http://pear2.php.net/dtd/customcommand-2.0">
 <command>
  <name>foobar</name>
  <class>Fronky_Wonky_Burm</class>
  <function>doDatThingy</function>
  <autoloadpath></autoloadpath>
  <summary>Install a package.  Use install --plugin to install plugins</summary>
  <shortcut>y</shortcut>
  <options>
   <option>
    <name>plugin</name>
    <shortopt>p</shortopt>
    <type><string/></type>
    <doc>Manage plugin installation only</doc>
   </option>
   <option>
    <name>packagingroot</name>
    <shortopt>r</shortopt>
    <type><string/></type>
    <doc>Install the package in a directory in preparation for packaging with tools like RPM</doc>
   </option>
   <option>
    <name>optionaldeps</name>
    <shortopt>o</shortopt>
    <type><bool/></type>
    <doc>Automatically download and install all optional dependencies</doc>
   </option>
   <option>
    <name>force</name>
    <shortopt>f</shortopt>
    <type><bool/></type>
    <doc>Force the installation to proceed independent of errors.  USE SPARINGLY.</doc>
   </option>
  </options>
  <arguments>
   <argument>
    <name>package</name>
    <multiple>1</multiple>
    <optional>0</optional>
    <doc>argument 1.</doc>
   </argument>
  </arguments>
  <doc>My extra doc
Is Pretty Sweet.</doc>
 </command>
</commands>');
define('MYDIR', __DIR__);
mkdir(__DIR__ . '/testit/Fronky/Wonky', 0755, true);
file_put_contents(__DIR__ . '/testit/Fronky/Wonky/Burm.php', '<?php
class Fronky_Wonky_Burm
{
    function doDatThingy($args, $opts)
    {
        var_dump($args, $opts);
    }
}');

PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare($package);
PEAR2_Pyrus_Installer::commit();



ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'foobar', '--force', '-r/hi/there', 'oof', 'da'));

$contents = ob_get_contents();
ob_end_clean();

$test->assertEquals('Using PEAR installation found at ' . __DIR__ . DIRECTORY_SEPARATOR . 'testit
array(1) {
  ["package"]=>
  array(2) {
    [0]=>
    string(3) "oof"
    [1]=>
    string(2) "da"
  }
}
array(5) {
  ["plugin"]=>
  NULL
  ["packagingroot"]=>
  string(9) "/hi/there"
  ["optionaldeps"]=>
  NULL
  ["force"]=>
  bool(true)
  ["help"]=>
  NULL
}
', $contents, 'command output');
$reg = new PEAR2_Pyrus_PluginRegistry(__DIR__ . '/testit/plugins');
$test->assertTrue(isset($reg->package['pear2.php.net/testing2']), 'custom command installed');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include __DIR__ . '/setup.php.inc';
PEAR2_Pyrus_Installer::$options['install-plugins'] = true;

$test->assertTrue($package->isPlugin(), 'ensure the package registers as a plugin');

file_put_contents(__DIR__ . '/testit/foobar', '<?xml version="1.0" encoding="UTF-8"?>
<commands version="2.0" xmlns="http://pear2.php.net/dtd/customcommand-2.0">
 <command>
  <name>foobar</name>
  <class>Fronky_Wonky_Burm</class>
  <function>doDatThingy</function>
  <autoloadpath></autoloadpath>
  <summary>Install a package.  Use install --plugin to install plugins</summary>
  <shortcut>y</shortcut>
  <options>
   <option>
    <name>plugin</name>
    <shortopt>p</shortopt>
    <type><string/></type>
    <doc>Manage plugin installation only</doc>
   </option>
   <option>
    <name>packagingroot</name>
    <shortopt>r</shortopt>
    <type><string/></type>
    <doc>Install the package in a directory in preparation for packaging with tools like RPM</doc>
   </option>
   <option>
    <name>optionaldeps</name>
    <shortopt>o</shortopt>
    <type><bool/></type>
    <doc>Automatically download and install all optional dependencies</doc>
   </option>
   <option>
    <name>force</name>
    <shortopt>f</shortopt>
    <type><bool/></type>
    <doc>Force the installation to proceed independent of errors.  USE SPARINGLY.</doc>
   </option>
  </options>
  <arguments>
   <argument>
    <name>package</name>
    <multiple>1</multiple>
    <optional>0</optional>
    <doc>argument 1.</doc>
   </argument>
  </arguments>
  <doc>My extra doc
Is Pretty Sweet.</doc>
 </command>
</commands>');
define('MYDIR', __DIR__);
mkdir(__DIR__ . '/testit/Fronky/Wonky', 0755, true);
file_put_contents(__DIR__ . '/testit/Fronky/Wonky/Burm.php', '<?php
class Fronky_Wonky_Burm
{
    function doDatThingy($args, $opts)
    {
        var_dump($args, $opts);
    }
}');

PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare($package);
PEAR2_Pyrus_Installer::commit();



ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'foobar', '--force', '-r/hi/there', 'oof', 'da'));

$contents = ob_get_contents();
ob_end_clean();

$test->assertEquals('', $contents, 'command output');
$reg = new PEAR2_Pyrus_PluginRegistry(__DIR__ . '/testit/plugins');
$test->assertTrue(isset($reg->package['pear2.php.net/testing2']), 'custom command installed');

?>
===DONE===
<?php
include dirname(__FILE__) . '/../../test_framework.php.inc';
@mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__ . '/testit', __DIR__ . '/testit/pearconfig.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
$c->plugins_dir = __DIR__ . '/testit/plugins';
restore_include_path();
$c->saveConfig();

$pf = new PEAR2_Pyrus_PackageFile_v2;

$pf->name = 'testing2';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');
$pf->files['foobar'] = array(
    'attribs' => array('role' => 'customcommand'),
);
$pf->files['Fronky/Wonky/Burm.php'] = array(
    'attribs' => array('role' => 'php'),
);
$pf->setPackagefile(__DIR__ . '/testit/package.xml');

$package = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/testit/package.xml', $package, $xmlcontainer);
$package->setInternalPackage($xml);
--TEST--
Custom file task: basic test
--FILE--
<?php
include __DIR__ . '/setup.php.inc';
PEAR2_Pyrus_Installer::$options['install-plugins'] = true;

$test->assertTrue($package->isPlugin(), 'ensure the package registers as a plugin');

file_put_contents(__DIR__ . '/testit/foobar', '<?xml version="1.0" encoding="UTF-8"?>
<task version="2.0" xmlns="http://pear2.php.net/dtd/customtask-2.0">
 <name>burm</name>
 <classprefix>Fronky_Wonky</classprefix>
 <autoloadpath></autoloadpath>
</task>');
define('MYDIR', __DIR__);
mkdir(__DIR__ . '/testit/Fronky/Wonky', 0755, true);
file_put_contents(__DIR__ . '/testit/Fronky/Wonky/Burm.php', '<?php
class Fronky_Wonky_Burm extends PEAR2_Pyrus_Task_Common {
    const TYPE = "simple";
    const PHASE = PEAR2_Pyrus_Task_Common::PACKAGEANDINSTALL;
    static function validateXml(PEAR2_Pyrus_IPackage $pkg, $xml, $fileXml, $file)
    {
        return true;
    }

    function startSession($fp, $dest)
    {
        return true;
    }
}');

PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare($package);
PEAR2_Pyrus_Installer::commit();

$reg = new PEAR2_Pyrus_PluginRegistry(__DIR__ . '/testit/plugins');
$reg->scan();
$test->assertTrue(isset($reg->package['pear2.php.net/testing2']), 'custom task installed');
$task = $package->getTask('burm');
$test->assertEquals('Fronky_Wonky_Burm', $task, 'right task class retrieved');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../../test_framework.php.inc';
@mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__ . '/testit', __DIR__ . '/testit/pearconfig.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
$c->plugins_dir = __DIR__ . '/testit/plugins';
restore_include_path();
$c->saveConfig();

$pf = new PEAR2_Pyrus_PackageFile_v2;

$pf->name = 'testing2';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');
$pf->files['foobar'] = array(
    'attribs' => array('role' => 'customtask'),
);
$pf->files['Fronky/Wonky/Burm.php'] = array(
    'attribs' => array('role' => 'php'),
);
$pf->setPackagefile(__DIR__ . '/testit/package.xml');

$package = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/testit/package.xml', $package, $xmlcontainer);
$package->setInternalPackage($xml);
--TEST--
Custom file role: basic test
--FILE--
<?php
include __DIR__ . '/setup.php.inc';
PEAR2_Pyrus_Installer::$options['install-plugins'] = true;

$test->assertTrue($package->isPlugin(), 'ensure the package registers as a plugin');

file_put_contents(__DIR__ . '/testit/foobar', '<?xml version="1.0" encoding="UTF-8"?>
<role version="2.0" xmlns="http://pear2.php.net/dtd/customrole-2.0">
 <name>burm</name>
 <classprefix>Fronky_Wonky</classprefix>
 <autoloadpath></autoloadpath>
 <releasetypes>php</releasetypes>
 <releasetypes>extsrc</releasetypes>
 <releasetypes>extbin</releasetypes>
 <releasetypes>zendextsrc</releasetypes>
 <releasetypes>zendextbin</releasetypes>
 <installable>1</installable>
 <locationconfig>www_dir</locationconfig>
 <honorsbaseinstall />
 <unusualbaseinstall>1</unusualbaseinstall>
 <phpfile />
 <executable />
 <phpextension />
 <configvar>
  <name>burm_dir</name>
  <type>string</type>
  <default><![CDATA[<?php $default = md5(MYDIR);]]></default>
  <doc>The Burm config variable</doc>
  <prompt>Burm</prompt>
  <group>My Group</group>
  <configtype>system</configtype>
 </configvar>
 <configvar>
  <name>userburm</name>
  <type>set</type>
  <default>hi</default>
  <doc>The Burm config variable</doc>
  <validset>hi</validset>
  <validset>bye</validset>
  <validset>ok</validset>
  <prompt>Burm</prompt>
  <group>My Group</group>
  <configtype>user</configtype>
 </configvar>
</role>');
define('MYDIR', __DIR__);
mkdir(__DIR__ . '/testit/Fronky/Wonky', 0755, true);
file_put_contents(__DIR__ . '/testit/Fronky/Wonky/Burm.php', '<?php
class Fronky_Wonky_Burm extends PEAR2_Pyrus_Installer_Role_Common {}');

PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare($package);
PEAR2_Pyrus_Installer::commit();

$reg = new PEAR2_Pyrus_PluginRegistry(__DIR__ . '/testit/plugins');
$reg->scan();
$test->assertTrue(isset($reg->package['pear2.php.net/testing2']), 'custom role installed');
$test->assertEquals(md5(__DIR__), PEAR2_Pyrus_Config::current()->burm_dir, 'burm_dir default value');
$test->assertEquals('hi', PEAR2_Pyrus_Config::current()->userburm, 'userburm default value');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../../test_framework.php.inc';
@mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__ . '/testit', __DIR__ . '/testit/pearconfig.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
$c->plugins_dir = __DIR__ . '/testit/plugins';
restore_include_path();
$c->saveConfig();

$pf = new PEAR2_Pyrus_PackageFile_v2;

$pf->name = 'testing2';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');
$pf->files['foobar'] = array(
    'attribs' => array('role' => 'customrole'),
);
$pf->files['Fronky/Wonky/Burm.php'] = array(
    'attribs' => array('role' => 'php'),
);
$pf->setPackagefile(__DIR__ . '/testit/package.xml');

$package = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/testit/package.xml', $package, $xmlcontainer);
$package->setInternalPackage($xml);
--TEST--
Pyrus DirectedGraph: basic topological sort
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$a1 = new stdClass;
$a2 = new stdClass;
$a3 = new stdClass;
$a4 = new stdClass;
$a5 = new stdClass;
$digraph->add($a1);
$digraph->add($a2);
$digraph->add($a3);
$digraph->add($a4);
$digraph->add($a5);

$digraph->connect($a1, $a2);
$digraph->connect($a1, $a3);
$digraph->connect($a2, $a3);
$digraph->connect($a2, $a5);
$digraph->connect($a4, $a2);
$digraph->connect($a4, $a1);
$digraph->connect($a4, $a5);
$digraph->connect($a5, $a3);

$res = array();
foreach ($digraph as $val) {
    $res[] = $val;
}
$test->assertEquals(array($a3, $a5, $a2, $a1, $a4), $res, 'test');
?>
===DONE===
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
$digraph = new PEAR2_Pyrus_DirectedGraph;
--TEST--
Pyrus DirectedGraph: topological sort with cycles
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$a1 = new stdClass;
$a2 = new stdClass;
$a3 = new stdClass;
$a4 = new stdClass;
$a5 = new stdClass;
$digraph->add($a1);
$digraph->add($a2);
$digraph->add($a3);
$digraph->add($a4);
$digraph->add($a5);

$digraph->connect($a1, $a2);
$digraph->connect($a2, $a1);
$digraph->connect($a3, $a4);
$digraph->connect($a4, $a5);
$digraph->connect($a5, $a1);
$digraph->connect($a1, $a3);

$res = array();
foreach ($digraph as $val) {
    $res[] = $val;
}
$test->assertEquals(array($a2, $a1, $a3, $a4, $a5), $res, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Pyrus XMLParser: attributes
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$res = $parser->parseString('<?xml version="1.0" ?><a one="two"/>');
$test->assertEquals(array('a' => array('attribs' => array('one' => 'two'))), $res, 'test');
$res = $parser->parseString('<?xml version="1.0" ?><a one="two" three="four"/>');
$test->assertEquals(array('a' => array('attribs' => array('one' => 'two', 'three' => 'four'))), $res, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Pyrus XMLParser: child tag + attributes
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$res = $parser->parseString('<?xml version="1.0" ?><a><b one="two"/></a>');
$test->assertEquals(array(
  'a' =>
  array(
    'b' =>
    array(
      'attribs' =>
      array(
        'one' => 'two'
      )
    ),
  ),
), $res, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Pyrus XMLParser: child tag + sibling attributes
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$res = $parser->parseString('<?xml version="1.0" ?><a><b /><b one="two"/></a>');
$test->assertEquals(array(
  'a' =>
  array(
    'b' =>
    array(
      '',
      array(
        'attribs' =>
        array(
          'one' => 'two'
        )
      ),
    ),
  ),
), $res, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Pyrus XMLParser: <![CDATA[]]>
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$res = $parser->parseString('<?xml version="1.0" ?><a><![CDATA[hi<there>]]></a>');
$test->assertEquals(array('a' => 'hi<there>'), $res, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Pyrus XMLParser: complex recursive tags
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$res = $parser->parseString('<?xml version="1.0" ?><package>
<lead>
 <name>test</name>
 <another>tag</another>
</lead>
<lead>
 <name>second</name>
 <another>thing</another>
</lead>
<contents>
 <dir name="blah">
  <dir name="two">
   <dir name="three">
    <file name="my"/>
   </dir>
  </dir>
 </dir>
 <dir name="four">
  <file name="my2"/>
 </dir>
</contents>
</package>');
$test->assertEquals(array (
  'package' => 
  array (
    'lead' => 
    array (
      0 => 
      array (
        'name' => 'test',
        'another' => 'tag',
      ),
      1 => 
      array (
        'name' => 'second',
        'another' => 'thing',
      ),
    ),
    'contents' => 
    array (
      'dir' => 
      array (
        0 => 
        array (
          'attribs' => 
          array (
            'name' => 'blah',
          ),
          'dir' => 
          array (
            'attribs' => 
            array (
              'name' => 'two',
            ),
            'dir' => 
            array (
              'attribs' => 
              array (
                'name' => 'three',
              ),
              'file' => 
              array (
                'attribs' => 
                array (
                  'name' => 'my',
                ),
              ),
            ),
          ),
        ),
        1 => 
        array (
          'attribs' => 
          array (
            'name' => 'four',
          ),
          'file' => 
          array (
            'attribs' => 
            array (
              'name' => 'my2',
            ),
          ),
        ),
      ),
    ),
  ),
), $res, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Pyrus XMLParser: child tag + content
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$res = $parser->parseString('<?xml version="1.0" ?><a><b/>hi</a>');
$test->assertEquals(array(
  'a' =>
  array(
    'b' => '',
    '_content' => 'hi',
  ),
), $res, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Pyrus XMLParser: empty xml
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$res = $parser->parseString('<?xml version="1.0" ?><a/>');
$test->assertEquals(array('a' => ''), $res, 'test');
?>
===DONE===
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
include dirname(__FILE__) . '/../../src/Pyrus/XMLParser.php';
$parser = new PEAR2_Pyrus_XMLParser;--TEST--
Pyrus XMLParser: child tag
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$res = $parser->parseString('<?xml version="1.0" ?><a><b/></a>');
$test->assertEquals(array(
  'a' =>
  array(
    'b' => '',
  ),
), $res, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Pyrus XMLParser: attributes + content
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$res = $parser->parseString('<?xml version="1.0" ?><a one="two">hi</a>');
$test->assertEquals(array(
  'a' =>
  array(
    'attribs' =>
    array(
      'one' => 'two',
    ),
    '_content' => 'hi',
  ),
), $res, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
Pyrus XMLParser: sibling tags
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$res = $parser->parseString('<?xml version="1.0" ?><a><b/><b/></a>');
$test->assertEquals(array(
  'a' =>
  array(
    'b' => array('', ''),
  ),
), $res, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
ScriptRunner: post-install script runner test, with post-processing of prompts
--FILE--
<?php
include __DIR__ . '/setup.php.inc';
file_put_contents(__DIR__ . '/testit/php/foobar', '<?php
class foobar_postinstall extends fake2 {}');

class fake2 extends fake
{
    function postProcessPrompts(array $prompts, $section)
    {
        fakefrontend::$displayed[] = array('postprocessprompts' => $prompts, 'section' => $section);
        if ($section === 'fourth') {
            foreach ($prompts as $i => $prompt) {
                $prompts[$i]['default'] = 'booya';
                $prompts[$i]['prompt'] = 'I am teh fail, are you?';
            }
        }
        return $prompts;
    }

    function run(array $answers, $section)
    {
        // for coverage, also test skipParamgroup
        PEAR2_Pyrus_ScriptRunner::skipParamgroup('third');
        return parent::run($answers, $section);
    }
}

$postinstall = $package->files['foobar']->postinstallscript->add();

$postinstall->paramgroup['first']->param['paramname']->type('string')->prompt('paramname');
$postinstall->paramgroup['first']->param['paramname2']->type('string')->prompt('paramname2');
$postinstall->paramgroup['first']->instructions = "testing\nthis thing";

$postinstall->paramgroup['second']->save();

$postinstall->paramgroup['third']->param['paramname']->type('string')->prompt('paramname');
$postinstall->paramgroup['third']->param['paramname2']->type('string')->prompt('paramname');

$postinstall->paramgroup['fourth']->param['paramname']->type('string')->prompt('paramname');
$postinstall->paramgroup['fourth']->param['paramname2']->type('string')->prompt('paramname');

PEAR2_Pyrus_Config::current()->registry->package[] = $package;

$frontend = new fakefrontend;

$frontend->addPrompts(array('paramname' => 'first thingy', 'paramname2' => 'second thingy'));
$frontend->addPrompts(array('paramname' => 'first thingy 2', 'paramname2' => 'second thingy 2'));
$frontend->addPrompts(array('paramname' => 'first thingy 4', 'paramname2' => 'second thingy 4'));

$runner = new PEAR2_Pyrus_ScriptRunner($frontend);
$runner->run($package);

$test->assertEquals(array (
  0 => 
  array (
    'init' => 
    array (
      0 => 'pear2.php.net/testing2',
      1 => NULL,
    ),
  ),
  1 => 
  array (
    'answers' => 
    array (
      'paramname' => 'first thingy 2',
      'paramname2' => 'second thingy 2',
    ),
    'section' => 'first',
  ),
  2 => 
  array (
    'answers' => 
    array (
      'first::paramname' => 'first thingy 2',
      'first::paramname2' => 'second thingy 2',
    ),
    'section' => 'second',
  ),
  3 => 
  array (
    'answers' => 
    array (
      'paramname' => 'first thingy 4',
      'paramname2' => 'second thingy 4',
      'first::paramname' => 'first thingy 2',
      'first::paramname2' => 'second thingy 2',
    ),
    'section' => 'fourth',
  ),
), fake::$captured, 'script info passed in');
$test->assertEquals(array (
  0 => 'testing
this thing',
  1 => 
  array (
    'postprocessprompts' => 
    array (
      0 => 
      array (
        'name' => 'paramname',
        'prompt' => 'paramname',
        'type' => 'string',
      ),
      1 => 
      array (
        'name' => 'paramname2',
        'prompt' => 'paramname2',
        'type' => 'string',
      ),
    ),
    'section' => 'first',
  ),
  2 => 
  array (
    0 => 
    array (
      'name' => 'paramname',
      'prompt' => 'paramname',
      'type' => 'string',
    ),
    1 => 
    array (
      'name' => 'paramname2',
      'prompt' => 'paramname2',
      'type' => 'string',
    ),
  ),
  3 => 
  array (
    'postprocessprompts' => 
    array (
      0 => 
      array (
        'name' => 'paramname',
        'prompt' => 'paramname',
        'type' => 'string',
      ),
      1 => 
      array (
        'name' => 'paramname2',
        'prompt' => 'paramname',
        'type' => 'string',
      ),
    ),
    'section' => 'fourth',
  ),
  4 => 
  array (
    0 => 
    array (
      'name' => 'paramname',
      'prompt' => 'I am teh fail, are you?',
      'type' => 'string',
      'default' => 'booya',
    ),
    1 => 
    array (
      'name' => 'paramname2',
      'prompt' => 'I am teh fail, are you?',
      'type' => 'string',
      'default' => 'booya',
    ),
  ),
), fakefrontend::$displayed, 'stuff displayed');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
ScriptRunner: basic post-install script runner test
--FILE--
<?php
include __DIR__ . '/setup.php.inc';
$postinstall = $package->files['foobar']->postinstallscript->add();

$postinstall->paramgroup['first']->param['paramname']->type('string')->prompt('paramname');
$postinstall->paramgroup['first']->param['paramname2']->type('string')->prompt('paramname2');
$postinstall->paramgroup['first']->instructions = "testing\nthis thing";

$postinstall->paramgroup['second']->save();

$postinstall->paramgroup['third']->param['paramname']->type('string')->prompt('paramname');
$postinstall->paramgroup['third']->param['paramname2']->type('string')->prompt('paramname');

$postinstall->paramgroup['fourth']->param['paramname']->type('string')->prompt('paramname');
$postinstall->paramgroup['fourth']->param['paramname2']->type('string')->prompt('paramname');

PEAR2_Pyrus_Config::current()->registry->package[] = $package;

$frontend = new fakefrontend;

$frontend->addPrompts(array('paramname' => 'first thingy', 'paramname2' => 'second thingy'));
$frontend->addPrompts(array('paramname' => 'first thingy 2', 'paramname2' => 'second thingy 2'));
$frontend->addPrompts(array('paramname' => 'first thingy 3', 'paramname2' => 'second thingy 3'));
$frontend->addPrompts(array('paramname' => 'first thingy 4', 'paramname2' => 'second thingy 4'));

$runner = new PEAR2_Pyrus_ScriptRunner($frontend);
$runner->run($package);

$test->assertEquals(array (
  0 => 
  array (
    'init' => 
    array (
      0 => 'pear2.php.net/testing2',
      1 => NULL,
    ),
  ),
  1 => 
  array (
    'answers' => 
    array (
      'paramname' => 'first thingy 2',
      'paramname2' => 'second thingy 2',
    ),
    'section' => 'first',
  ),
  2 => 
  array (
    'answers' => 
    array (
      'first::paramname' => 'first thingy 2',
      'first::paramname2' => 'second thingy 2',
    ),
    'section' => 'second',
  ),
  3 => 
  array (
    'answers' => 
    array (
      'paramname' => 'first thingy 3',
      'paramname2' => 'second thingy 3',
      'first::paramname' => 'first thingy 2',
      'first::paramname2' => 'second thingy 2',
    ),
    'section' => 'third',
  ),
  4 => 
  array (
    'answers' => 
    array (
      'paramname' => 'first thingy 4',
      'paramname2' => 'second thingy 4',
      'first::paramname' => 'first thingy 2',
      'first::paramname2' => 'second thingy 2',
      'third::paramname' => 'first thingy 3',
      'third::paramname2' => 'second thingy 3',
    ),
    'section' => 'fourth',
  ),
), fake::$captured, 'script info passed in');
$test->assertEquals(array (
  0 => 'testing
this thing',
  1 => 
  array (
    0 => 
    array (
      'name' => 'paramname',
      'prompt' => 'paramname',
      'type' => 'string',
    ),
    1 => 
    array (
      'name' => 'paramname2',
      'prompt' => 'paramname2',
      'type' => 'string',
    ),
  ),
  2 => 
  array (
    0 => 
    array (
      'name' => 'paramname',
      'prompt' => 'paramname',
      'type' => 'string',
    ),
    1 => 
    array (
      'name' => 'paramname2',
      'prompt' => 'paramname',
      'type' => 'string',
    ),
  ),
  3 => 
  array (
    0 => 
    array (
      'name' => 'paramname',
      'prompt' => 'paramname',
      'type' => 'string',
    ),
    1 => 
    array (
      'name' => 'paramname2',
      'prompt' => 'paramname',
      'type' => 'string',
    ),
  ),
), fakefrontend::$displayed, 'stuff displayed');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include __DIR__ . '/../test_framework.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit', __DIR__ . '/testit/pearconfig.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();

mkdir(__DIR__ . '/testit/php');
file_put_contents(__DIR__ . '/testit/php/foobar', '<?php
class foobar_postinstall extends fake {}');
$pf->name = 'testing2';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');
$pf->files['foobar'] = array(
    'attribs' => array('role' => 'php'),
    'tasks:replace' => array('attribs' =>
                             array('from' => '@blah@', 'to' => 'version', 'type' => 'package-info'))
);
$pf->files['glooby'] = array('role' => 'php');
$pf->setPackagefile(__DIR__ . '/testit/package.xml');

$package = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/testit/package.xml', $package, $xmlcontainer);
$package->setInternalPackage($xml);

class fake
{
    public static $captured = array();

    static function reset()
    {
        self::$captured = array();
    }

    function run(array $answers, $section)
    {
        self::$captured[] = array('answers' => $answers, 'section' => $section);
    }

    function init($pkg, $lastversion)
    {
        self::$captured[] = array('init' => array($pkg->channel . '/' . $pkg->name, $lastversion));
    }
}

class fakefrontend
{
    static $promptmap = array();
    static $displayed = array();

    static function reset()
    {
        self::$promptmap = array();
        self::$displayed = array();
    }

    static function addPrompts($answers)
    {
        self::$promptmap[] = $answers;
    }

    function display($stuff)
    {
        self::$displayed[] = $stuff;
    }

    function confirmDialog($prompts)
    {
        self::$displayed[] = $prompts;
        return next(self::$promptmap);
    }
}--TEST--
PEAR2_Pyrus_Task_Replace::startSession()
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';

$taskxml = array('attribs' =>
              array('name' => 'foo.php', 'role' => 'src'),
'tasks:replace' => array(
                array('attribs' => array('from' => '@DIR@', 'to' => 'DIRECTORY_SEPARATOR', 'type' => 'php-const')),
                array('attribs' => array('from' => '@data_dir@', 'to' => 'data_dir', 'type' => 'pear-config')),
                array('attribs' => array('from' => '@version@', 'to' => 'version', 'type' => 'package-info')),
                        ));

file_put_contents(__DIR__ . '/testit/foo.php', "@DIR@\n@data_dir@\n@version@");

$iterator = new PEAR2_Pyrus_Package_Creator_TaskIterator($taskxml, $package, PEAR2_Pyrus_Task_Common::INSTALL, null);

$fp = fopen(__DIR__ . '/testit/foo.php', 'rb+');
$runcount = 0;
foreach ($iterator as $task) {
    ++$runcount;
    $task->startSession($fp, 'foo.php');
    rewind($fp);
}
$test->assertEquals(1, $runcount, 'Iterator did not run replace install');
$contents = stream_get_contents($fp);
$result = DIRECTORY_SEPARATOR . "\n" . PEAR2_Pyrus_Config::current()->data_dir . "\n" .$package->version['release'];
$test->assertEquals($result, $contents, 'contents differ install');
fclose($fp);

file_put_contents(__DIR__ . '/testit/foo.php', "@DIR@\n@data_dir@\n@version@");

$iterator = new PEAR2_Pyrus_Package_Creator_TaskIterator($taskxml, $package, PEAR2_Pyrus_Task_Common::PACKAGE, null);

$fp = fopen(__DIR__ . '/testit/foo.php', 'rb+');
$runcount = 0;
foreach ($iterator as $task) {
    ++$runcount;
    $task->startSession($fp, 'foo.php');
    rewind($fp);
}
$test->assertEquals(1, $runcount, 'Iterator did not run replace packaging');
$contents = stream_get_contents($fp);
$result = "@DIR@\n@data_dir@\n" .$package->version['release'];
$test->assertEquals($result, $contents, 'contents differ packaging');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Replace::validateXml() failures
--FILE--
<?php
include dirname(__DIR__) . '/setup.minimal.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Replace::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

$xmltest(array(), array(), 'task <replace> has no attributes in file filename', 'PEAR2_Pyrus_Task_Exception_NoAttributes');

$errs = $xmltest(array('attribs' => array()), array(),
         'Invalid replace task, multiple missing attributes', 'PEAR2_Pyrus_Task_Exception');
$test->assertEquals(3, count($errs->getCause()), 'right number of missing attributes');
$causetest('task <replace> is missing attribute "type" in file filename', 'E_ERROR',
           'PEAR2_Pyrus_Task_Exception_MissingAttribute', 0, $errs);
$causetest('task <replace> is missing attribute "to" in file filename', 'E_ERROR',
           'PEAR2_Pyrus_Task_Exception_MissingAttribute', 1, $errs);
$causetest('task <replace> is missing attribute "from" in file filename', 'E_ERROR',
           'PEAR2_Pyrus_Task_Exception_MissingAttribute', 2, $errs);

$errs = $xmltest(array('attribs' => array('type' => 'package-info')), array(),
         'Invalid replace task, multiple missing attributes', 'PEAR2_Pyrus_Task_Exception');
$test->assertEquals(2, count($errs->getCause()), 'right number of missing attributes');
$causetest('task <replace> is missing attribute "to" in file filename', 'E_ERROR',
           'PEAR2_Pyrus_Task_Exception_MissingAttribute', 0, $errs);
$causetest('task <replace> is missing attribute "from" in file filename', 'E_ERROR',
           'PEAR2_Pyrus_Task_Exception_MissingAttribute', 1, $errs);

$errs = $xmltest(array('attribs' => array('to' => 'package-info')), array(),
         'Invalid replace task, multiple missing attributes', 'PEAR2_Pyrus_Task_Exception');
$test->assertEquals(2, count($errs->getCause()), 'right number of missing attributes');
$causetest('task <replace> is missing attribute "type" in file filename', 'E_ERROR',
           'PEAR2_Pyrus_Task_Exception_MissingAttribute', 0, $errs);
$causetest('task <replace> is missing attribute "from" in file filename', 'E_ERROR',
           'PEAR2_Pyrus_Task_Exception_MissingAttribute', 1, $errs);

$xmltest(array('attribs' => array('type' => 'package-info', 'to' => 'package-info')), array(),
         'task <replace> is missing attribute "from" in file filename', 'PEAR2_Pyrus_Task_Exception_MissingAttribute');

$xmltest(array('attribs' => array('type' => 'pear-config', 'from' => 'poop', 'to' => 'package-info')), array(),
         'task <replace> attribute "to" has the wrong value "package-info" in file filename, expecting one of "php_dir, ext_dir, cfg_dir, doc_dir, bin_dir, data_dir, www_dir, test_dir, src_dir, php_bin, php_ini, php_prefix, php_suffix"', 'PEAR2_Pyrus_Task_Exception_WrongAttributeValue');

$xmltest(array('attribs' => array('type' => 'php-const', 'from' => 'poop', 'to' => 'package-info')), array(),
         'task <replace> attribute "to" has the wrong value "package-info" in file filename, expecting one of "valid PHP constant"', 'PEAR2_Pyrus_Task_Exception_WrongAttributeValue');

$xmltest(array('attribs' => array('type' => 'package-info', 'from' => 'poop', 'to' => 'package-info')), array(),
         'task <replace> attribute "to" has the wrong value "package-info" in file filename, expecting one of "name, summary, channel, notes, extends, description, release_notes, license, release-license, license-uri, version, api-version, state, api-state, release_date, date, time"', 'PEAR2_Pyrus_Task_Exception_WrongAttributeValue');

$xmltest(array('attribs' => array('type' => 'blurp', 'from' => 'poop', 'to' => 'package-info')), array(),
         'task <replace> attribute "type" has the wrong value "blurp" in file filename, expecting one of "pear-config, package-info, php-const"', 'PEAR2_Pyrus_Task_Exception_WrongAttributeValue');
?>
===DONE===
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;

$pf->name = 'testing2';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');
$pf->files['foobar'] = array(
    'attribs' => array('role' => 'php'),
    'tasks:replace' => array('attribs' =>
                             array('from' => '@blah@', 'to' => 'version', 'type' => 'package-info'))
);
$pf->files['glooby'] = array('role' => 'php');
$pf->release[0]->installAs('foobar', 'blah/blah');
$pf->release[0]->ignore('glooby');
$pf->setPackagefile(__DIR__ . '/testit/package.xml');

$package = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/testit/package.xml', $package, $xmlcontainer);
$package->setInternalPackage($xml);
--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 15
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

file_put_contents(__DIR__ . '/testit/glooby', '<?php
class glooby_postinstall {
    function init(){}
    function run(){}
}
');

$xmltest(array('tasks:paramgroup' => array(
               array('tasks:id' => 'foo',
                     'tasks:param' => array(
                            'tasks:name' => 'bar',
                            'tasks:prompt' => 'h',
                            'tasks:type' => 'string',
                        )
                     ),
               array('tasks:id' => 'hi'),
               array('tasks:id' => 'another',
                     'tasks:param' => array(
                        'tasks:name' => '*&',
                            )))), array('role' => 'php', 'name' => 'glooby'), 'task <postinstallscript> in file filename is invalid because of "Post-install script "glooby" parameter "*&" for <paramgroup> id "another" is not a valid name.  Must contain only alphanumeric characters"', 'PEAR2_Pyrus_Task_Exception_Invalidtask');


?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 12
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

file_put_contents(__DIR__ . '/testit/glooby', '<?php
class glooby_postinstall {
    function init(){}
    function run(){}
}
');

$xmltest(array('tasks:paramgroup' => array(
               array('tasks:id' => 'foo',
                     'tasks:param' => array(
                            'tasks:name' => 'bar',
                            'tasks:prompt' => 'h',
                            'tasks:type' => 'string',
                        )
                     ),
               array('tasks:id' => 'hi',
                     'tasks:name' => 'foo::bar',
                     'tasks:conditiontype' => 'blah'))), array('role' => 'php', 'name' => 'glooby'), 'task <postinstallscript> in file filename is invalid because of "Post-install script "glooby" <paramgroup> id "hi" must have a <conditiontype> tag containing either "=", "!=", or "preg_match""', 'PEAR2_Pyrus_Task_Exception_Invalidtask');


?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 3
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

file_put_contents(__DIR__ . '/testit/glooby', '<?php
class oops {
class oops2 {
interface::$hla;
    }
}
');

$xmltest(array(), array('role' => 'php', 'name' => 'glooby'), 'task <postinstallscript> in file filename is invalid because of "Analysis of post-install script "glooby" failed: Parser error: invalid PHP found in file"', 'PEAR2_Pyrus_Task_Exception_Invalidtask');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript: setting paramgroup condition
--FILE--
<?php
include __DIR__ . '/setup.php.inc';
$postinstall = $package->files['foobar']->postinstallscript->add();

$test->assertFalse(isset($postinstall->paramgroup['foo']->conditiontype), 'isset(foo->conditiontype)');
$test->assertFalse(isset($postinstall->paramgroup['foo']->name), 'isset(foo->name)');
$test->assertFalse(isset($postinstall->paramgroup['foo']->value), 'isset(foo->value)');
$test->assertEquals(null, $postinstall->paramgroup['foo']->conditiontype, 'conditiontype value');
$test->assertEquals(null, $postinstall->paramgroup['foo']->name, 'conditiontype value');
$test->assertEquals(null, $postinstall->paramgroup['foo']->value, 'conditiontype value');

$postinstall->paramgroup['previous']->param['first']->prompt = 'my prompt';
$postinstall->paramgroup['foo']->condition($postinstall->paramgroup['previous']->param['first'],
                                                 '!=', '5');

$test->assertTrue(isset($postinstall->paramgroup['foo']->conditiontype), 'isset(foo->conditiontype) after');
$test->assertTrue(isset($postinstall->paramgroup['foo']->name), 'isset(foo->name) after');
$test->assertTrue(isset($postinstall->paramgroup['foo']->value), 'isset(foo->value) after');
$test->assertEquals('!=', $postinstall->paramgroup['foo']->conditiontype, 'conditiontype value after');
$test->assertEquals('previous::first', $postinstall->paramgroup['foo']->name, 'conditiontype value after');
$test->assertEquals('5', $postinstall->paramgroup['foo']->value, 'conditiontype value after');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript: accessing paramgroups
--FILE--
<?php
include __DIR__ . '/setup.php.inc';
$postinstall = $package->files['foobar']->postinstallscript->add();
$test->assertIsa('PEAR2_Pyrus_Task_Postinstallscript', $postinstall, 'retrieved postinstallscript');

$test->assertIsa('PEAR2_Pyrus_Task_Postinstallscript_Paramgroup', $postinstall->paramgroup, 'retrieved paramgroup');
$test->assertEquals(0, count($postinstall->paramgroup), 'number of params');

$test->assertIsa('PEAR2_Pyrus_Task_Postinstallscript_Paramgroup', $postinstall->paramgroup['foo'],
                 'retrieved named paramgroup');

$test->assertIsa('PEAR2_Pyrus_Task_Postinstallscript_Paramgroup_Param', $postinstall->paramgroup['foo']->param,
                 'retrieved param');

$test->assertFalse(isset($postinstall->paramgroup['foo']), 'isset(foo)');

$test->assertEquals('foo', $postinstall->paramgroup['foo']->id, '__get id');
$test->assertTrue(isset($postinstall->paramgroup['foo']->id), 'isset(foo->id)');
$test->assertFalse(isset($postinstall->paramgroup['foo']->instructions), 'isset(foo->instructions)');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript: paramgroup matchesConditionType()
--FILE--
<?php
include __DIR__ . '/setup.php.inc';
$postinstall = $package->files['foobar']->postinstallscript->add();

$postinstall->paramgroup['first']->param['paramname']->type('string')->prompt('paramname');
$postinstall->paramgroup['first']->param['paramname2']->type('string')->prompt('paramname2');

$postinstall->paramgroup['second']->param['paramname']->type('string')->prompt('paramname');
$postinstall->paramgroup['second']->param['paramname2']->type('string')->prompt('paramname2');

$postinstall->paramgroup['third']->param['paramname']->type('string')->prompt('paramname');
$postinstall->paramgroup['third']->param['paramname2']->type('string')->prompt('paramname');

$postinstall->paramgroup['fourth']->param['paramname']->type('string')->prompt('paramname');
$postinstall->paramgroup['fourth']->param['paramname2']->type('string')->prompt('paramname');

$postinstall->paramgroup['third']->condition($postinstall->paramgroup['first']->param['paramname'],
                                             '=', 'hi');

$test->assertTrue($postinstall->paramgroup['third']->matchesConditionType(
                          array('first::paramname' => 'hi')),
                    'first test');

$test->assertFalse($postinstall->paramgroup['third']->matchesConditionType(
                          array('first::paramname' => 'bye')),
                    'first test failure');

$postinstall->paramgroup['third']->condition($postinstall->paramgroup['first']->param['paramname'],
                                             '!=', 'hi');

$test->assertTrue($postinstall->paramgroup['third']->matchesConditionType(
                          array('first::paramname' => 'bye')),
                    'second test');

$test->assertFalse($postinstall->paramgroup['third']->matchesConditionType(
                          array('first::paramname' => 'hi')),
                    'second test failure');

$postinstall->paramgroup['third']->condition($postinstall->paramgroup['first']->param['paramname'],
                                             'preg_match', 'h[iI]');

$test->assertTrue($postinstall->paramgroup['third']->matchesConditionType(
                          array('first::paramname' => 'hi')),
                    'third test 1');

$test->assertTrue($postinstall->paramgroup['third']->matchesConditionType(
                          array('first::paramname' => 'hI')),
                    'third test 2');

$test->assertFalse($postinstall->paramgroup['third']->matchesConditionType(
                          array('first::paramname' => 'HI')),
                    'third test failure');

$test->assertTrue($postinstall->paramgroup['second']->matchesConditionType(
                          array('first::paramname' => 'hi')),
                    'test no condition set');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript: accessing params
--FILE--
<?php
include __DIR__ . '/setup.php.inc';
$postinstall = $package->files['foobar']->postinstallscript->add();

$test->assertFalse(isset($postinstall->paramgroup['foo']->param), 'isset(foo->param)');
$test->assertEquals(0, count($postinstall->paramgroup['foo']->param), 'count(foo->param)');
$test->assertFalse(isset($postinstall->paramgroup['foo']->param['first']), 'isset(foo->param[first])');
$test->assertFalse(isset($postinstall->paramgroup['foo']->param['first']->prompt), 'isset(foo->param[first])');
$test->assertEquals('first', $postinstall->paramgroup['foo']->param['first']->name, 'name value');
$test->assertEquals(null, $postinstall->paramgroup['foo']->param['first']->prompt, 'prompt value');

$postinstall->paramgroup['foo']->param['first']->prompt = 'my prompt';

$test->assertTrue(isset($postinstall->paramgroup['foo']->param), 'isset(foo->param) after');
$test->assertEquals(1, count($postinstall->paramgroup['foo']->param), 'count(foo->param) after');
$test->assertTrue(isset($postinstall->paramgroup['foo']->param['first']), 'isset(foo->param[first]) after');
$test->assertTrue(isset($postinstall->paramgroup['foo']->param['first']->prompt), 'isset(foo->param[first]) after');
$test->assertEquals('first', $postinstall->paramgroup['foo']->param['first']->name, 'name value after');
$test->assertEquals('my prompt', $postinstall->paramgroup['foo']->param['first']->prompt, 'prompt value after');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript: accessing paramgroups 2
--FILE--
<?php
include __DIR__ . '/setup.php.inc';
$postinstall = $package->files['foobar']->postinstallscript->add();

$test->assertFalse(isset($postinstall->paramgroup['foo']), 'isset(foo)');
$test->assertFalse(isset($postinstall->paramgroup['foo']->instructions), 'isset(foo->instructions)');
$test->assertEquals(null, $postinstall->paramgroup['foo']->instructions, 'instructions value');

$postinstall->paramgroup['foo']->instructions = 'hi';

$test->assertTrue(isset($package->files['foobar']->postinstallscript[0]->paramgroup['foo']), 'isset(foo) after');
$test->assertTrue(isset($postinstall->paramgroup['foo']->instructions), 'isset(foo->instructions) after');
$test->assertEquals('hi', $postinstall->paramgroup['foo']->instructions, 'instructions value after');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include __DIR__ . '/../../../test_framework.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;

$pf->name = 'testing2';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');
$pf->files['foobar'] = array(
    'attribs' => array('role' => 'php'),
    'tasks:replace' => array('attribs' =>
                             array('from' => '@blah@', 'to' => 'version', 'type' => 'package-info'))
);
$pf->files['glooby'] = array('role' => 'php');
$pf->release[0]->installAs('foobar', 'blah/blah');
$pf->release[0]->ignore('glooby');
$pf->setPackagefile(__DIR__ . '/testit/package.xml');

$package = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/testit/package.xml', $package, $xmlcontainer);
$package->setInternalPackage($xml);
--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 7
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

file_put_contents(__DIR__ . '/testit/glooby', '<?php
class glooby_postinstall {
    function init(){}
}
');

$xmltest(array(), array('role' => 'php', 'name' => 'glooby'), 'task <postinstallscript> in file filename is invalid because of "Post-install script "glooby" must declare methods init() and run()"', 'PEAR2_Pyrus_Task_Exception_Invalidtask');

file_put_contents(__DIR__ . '/testit/glooby', '<?php
class glooby_postinstall {
    function run(){}
}
');

$xmltest(array(), array('role' => 'php', 'name' => 'glooby'), 'task <postinstallscript> in file filename is invalid because of "Post-install script "glooby" must declare methods init() and run()"', 'PEAR2_Pyrus_Task_Exception_Invalidtask');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 8
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

file_put_contents(__DIR__ . '/testit/glooby', '<?php
class glooby_postinstall {
    function init(){}
    function run(){}
}
');

$xmltest(array('tasks:paramgroup' =>
               array()), array('role' => 'php', 'name' => 'glooby'), 'task <postinstallscript> in file filename is invalid because of "Post-install script "glooby" <paramgroup> must have an <id> tag"', 'PEAR2_Pyrus_Task_Exception_Invalidtask');


?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 4
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

file_put_contents(__DIR__ . '/testit/glooby', '<?php
$a = 1;
');

$xmltest(array(), array('role' => 'php', 'name' => 'glooby'), 'task <postinstallscript> in file filename is invalid because of "Post-install script "glooby" must declare exactly 1 class"', 'PEAR2_Pyrus_Task_Exception_Invalidtask');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 16
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

file_put_contents(__DIR__ . '/testit/glooby', '<?php
class glooby_postinstall {
    function init(){}
    function run(){}
}
');

$xmltest(array('tasks:paramgroup' => array(
               array('tasks:id' => 'foo',
                     'tasks:param' => array(
                            'tasks:name' => 'bar',
                            'tasks:prompt' => 'h',
                            'tasks:type' => 'string',
                        )
                     ),
               array('tasks:id' => 'hi'),
               array('tasks:id' => 'another',
                     'tasks:param' => array(
                        'tasks:name' => 'ok',
                            )))), array('role' => 'php', 'name' => 'glooby'), 'task <postinstallscript> in file filename is invalid because of "Post-install script "glooby" parameter "ok" for <paramgroup> id "another" must have a <prompt> tag"', 'PEAR2_Pyrus_Task_Exception_Invalidtask');


?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 13
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

file_put_contents(__DIR__ . '/testit/glooby', '<?php
class glooby_postinstall {
    function init(){}
    function run(){}
}
');

$xmltest(array('tasks:paramgroup' => array(
               array('tasks:id' => 'foo',
                     'tasks:param' => array(
                            'tasks:name' => 'bar',
                            'tasks:prompt' => 'h',
                            'tasks:type' => 'string',
                        )
                     ),
               array('tasks:id' => 'hi',
                     'tasks:name' => 'foo::bar',
                     'tasks:conditiontype' => '='))), array('role' => 'php', 'name' => 'glooby'), 'task <postinstallscript> in file filename is invalid because of "Post-install script "glooby" <paramgroup> id "hi" must have a <value> tag containing expected parameter value"', 'PEAR2_Pyrus_Task_Exception_Invalidtask');


?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 17
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

file_put_contents(__DIR__ . '/testit/glooby', '<?php
class glooby_postinstall {
    function init(){}
    function run(){}
}
');

$xmltest(array('tasks:paramgroup' => array(
               array('tasks:id' => 'foo',
                     'tasks:param' => array(
                            'tasks:name' => 'bar',
                            'tasks:prompt' => 'h',
                            'tasks:type' => 'string',
                        )
                     ),
               array('tasks:id' => 'hi'),
               array('tasks:id' => 'another',
                     'tasks:param' => array(
                        'tasks:name' => 'ok',
                        'tasks:prompt' => 'hi',
                            )))), array('role' => 'php', 'name' => 'glooby'), 'task <postinstallscript> in file filename is invalid because of "Post-install script "glooby" parameter "ok" for <paramgroup> id "another" must have a <type> tag"', 'PEAR2_Pyrus_Task_Exception_Invalidtask');


?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 11
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

file_put_contents(__DIR__ . '/testit/glooby', '<?php
class glooby_postinstall {
    function init(){}
    function run(){}
}
');

$xmltest(array('tasks:paramgroup' => array(
               array('tasks:id' => 'foo',
                     'tasks:param' => array(
                            'tasks:name' => 'bar',
                            'tasks:prompt' => 'h',
                            'tasks:type' => 'string',
                        )
                     ),
               array('tasks:id' => 'hi',
                     'tasks:name' => 'foo::bar'))), array('role' => 'php', 'name' => 'glooby'), 'task <postinstallscript> in file filename is invalid because of "Post-install script "glooby" <paramgroup> id "hi" must have a <conditiontype> tag containing either "=", "!=", or "preg_match""', 'PEAR2_Pyrus_Task_Exception_Invalidtask');


?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 2
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

$xmltest(array(), array('role' => 'php', 'name' => 'foo'), 'task <postinstallscript> in file filename is invalid because of ' .
         '"Post-install script "foo" is not valid: file foo is not in this package"', 'PEAR2_Pyrus_Task_Exception_Invalidtask');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 6
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

file_put_contents(__DIR__ . '/testit/glooby', '<?php
class glooby_postinstall {}
');

$xmltest(array(), array('role' => 'php', 'name' => 'glooby'), 'task <postinstallscript> in file filename is invalid because of "Post-install script "glooby" must declare methods init() and run()"', 'PEAR2_Pyrus_Task_Exception_Invalidtask');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml()
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

file_put_contents(__DIR__ . '/testit/glooby', '<?php
class glooby_postinstall {
    function init(){}
    function run(){}
}
');

$test->assertTrue(PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, array('tasks:paramgroup' => array(
               array('tasks:id' => 'foo',
                     'tasks:param' => array(
                            'tasks:name' => 'bar',
                            'tasks:prompt' => 'h',
                            'tasks:type' => 'string',
                        )
                     ),
               array('tasks:id' => 'hi'),
               array('tasks:id' => 'another',
                     'tasks:param' => array(
                        'tasks:name' => 'ok',
                        'tasks:prompt' => 'hi',
                        'tasks:type' => 'string',
                            )))), array('role' => 'php', 'name' => 'glooby'), 'filename'), 'success 1');

$test->assertTrue(PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, array(), array('role' => 'php', 'name' => 'glooby'), 'filename'), 'success 2');


?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 10
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

file_put_contents(__DIR__ . '/testit/glooby', '<?php
class glooby_postinstall {
    function init(){}
    function run(){}
}
');

$xmltest(array('tasks:paramgroup' =>
               array('tasks:id' => 'hi',
                     'tasks:name' => 'foo::bar')), array('role' => 'php', 'name' => 'glooby'), 'task <postinstallscript> in file filename is invalid because of "Post-install script "glooby" <paramgroup> id "hi" conditiontype parameter "foo::bar" has not been previously defined"', 'PEAR2_Pyrus_Task_Exception_Invalidtask');


?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 5
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

file_put_contents(__DIR__ . '/testit/glooby', '<?php
class poo {}
');

$xmltest(array(), array('role' => 'php', 'name' => 'glooby'), 'task <postinstallscript> in file filename is invalid because of "Post-install script "glooby" class "poo" must be named "glooby_postinstall""', 'PEAR2_Pyrus_Task_Exception_Invalidtask');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 1
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

$xmltest(array(), array('role' => 'src', 'name' => 'foo'), 'task <postinstallscript> in file filename is invalid because of "' .
         'Post-install script "foo" must be role="php""', 'PEAR2_Pyrus_Task_Exception_Invalidtask');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 9
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

file_put_contents(__DIR__ . '/testit/glooby', '<?php
class glooby_postinstall {
    function init(){}
    function run(){}
}
');

$xmltest(array('tasks:paramgroup' =>
               array('tasks:id' => 'hi',
                     'tasks:instructions' => array('foo', 'blah'))), array('role' => 'php', 'name' => 'glooby'), 'task <postinstallscript> in file filename is invalid because of "Post-install script "glooby" <paramgroup> id "hi" <instructions> must be simple text"', 'PEAR2_Pyrus_Task_Exception_Invalidtask');


?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Postinstallscript::validateXml() failures 14
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Postinstallscript::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};
$causetest = function($message, $severity, $exception, $index, $errs) use ($test)
{
    $errs = $errs->getCause();
    $test->assertIsa($exception, $errs->{$severity}[$index], 'right class');
    $test->assertEquals($message, $errs->{$severity}[$index]->getMessage(), 'right message');
};

file_put_contents(__DIR__ . '/testit/glooby', '<?php
class glooby_postinstall {
    function init(){}
    function run(){}
}
');

$xmltest(array('tasks:paramgroup' => array(
               array('tasks:id' => 'foo',
                     'tasks:param' => array(
                            'tasks:name' => 'bar',
                            'tasks:prompt' => 'h',
                            'tasks:type' => 'string',
                        )
                     ),
               array('tasks:id' => 'hi'),
               array('tasks:id' => 'another',
                     'tasks:param' => array(
                        'tasks:oops' => '1',
                            )))), array('role' => 'php', 'name' => 'glooby'), 'task <postinstallscript> in file filename is invalid because of "Post-install script "glooby" parameter for <paramgroup> id "another" must have a <name> tag"', 'PEAR2_Pyrus_Task_Exception_Invalidtask');


?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Unixeol::startSession()
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';

$taskxml = array('attribs' =>
              array('name' => 'foo.php', 'role' => 'src'),
'tasks:unixeol' => '');

file_put_contents(__DIR__ . '/testit/foo.php', "\r\nhi\r\n\r\nthere");

$iterator = new PEAR2_Pyrus_Package_Creator_TaskIterator($taskxml, $package, PEAR2_Pyrus_Task_Common::INSTALL, null);

$fp = fopen(__DIR__ . '/testit/foo.php', 'rb+');
$runcount = 0;
foreach ($iterator as $task) {
    ++$runcount;
    $task->startSession($fp, 'foo.php');
    rewind($fp);
}
$test->assertEquals(1, $runcount, 'Iterator did not run unixeol 1');
$contents = stream_get_contents($fp);
$test->assertTrue("\nhi\n\nthere" === $contents, 'contents differ 1');
if ($contents != "\nhi\n\nthere") {
    var_dump(str_replace(array("\r", "\n"), array('\\r', '\\n'), $contents));
}
fclose($fp);

file_put_contents(__DIR__ . '/testit/foo.php', "\r\nhi\r\n\r\nthere");

$iterator = new PEAR2_Pyrus_Package_Creator_TaskIterator($taskxml, $package, PEAR2_Pyrus_Task_Common::PACKAGE, null);

$fp = fopen(__DIR__ . '/testit/foo.php', 'rb+');
$runcount = 0;
foreach ($iterator as $task) {
    ++$runcount;
    $task->startSession($fp, 'foo.php');
    rewind($fp);
}
$test->assertEquals(1, $runcount, 'Iterator did not run unixeol 2');
$test->assertTrue("\nhi\n\nthere" === stream_get_contents($fp), 'contents differ 2');
fclose($fp);
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Unixeol::validateXml() failures
--FILE--
<?php
include dirname(__DIR__) . '/setup.minimal.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Unixeol::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};

$xmltest(array('attribs' => array()), array(), 'task <unixeol> in file filename is invalid because of "no attributes allowed"', 'PEAR2_Pyrus_Task_Exception_Invalidtask');
?>
===DONE===
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
@mkdir(MYDIR . DIRECTORY_SEPARATOR . 'testit');
set_include_path(MYDIR . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(MYDIR.'/testit');
$c->bin_dir = MYDIR . '/testit/bin';
restore_include_path();
$c->saveConfig();

$pf = new PEAR2_Pyrus_PackageFile_v2;

$pf->name = 'testing2';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');
$pf->files['foobar'] = array(
    'attribs' => array('role' => 'php'),
    'tasks:replace' => array('attribs' =>
                             array('from' => '@blah@', 'to' => 'version', 'type' => 'package-info'))
);
$pf->files['glooby'] = array('role' => 'php');
$pf->release[0]->installAs('foobar', 'blah/blah');
$pf->release[0]->ignore('glooby');
$pf->setPackagefile(MYDIR . '/testit/package.xml');

$package = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(MYDIR . '/testit/package.xml', $package, $xmlcontainer);
$package->setInternalPackage($xml);
--TEST--
PEAR2_Pyrus_Task_Windowseol::startSession()
--FILE--
<?php
define('MYDIR', __DIR__);
include dirname(__DIR__) . '/setup.php.inc';

$taskxml = array('attribs' =>
              array('name' => 'foo.php', 'role' => 'src'),
'tasks:windowseol' => '');

file_put_contents(__DIR__ . '/testit/foo.php', "\rhi\n\r\nthere");

$iterator = new PEAR2_Pyrus_Package_Creator_TaskIterator($taskxml, $package, PEAR2_Pyrus_Task_Common::INSTALL, null);

$fp = fopen(__DIR__ . '/testit/foo.php', 'rb+');
$runcount = 0;
foreach ($iterator as $task) {
    ++$runcount;
    $task->startSession($fp, 'foo.php');
    rewind($fp);
}
$test->assertEquals(1, $runcount, 'Iterator did not run unixeol 1');
$contents = stream_get_contents($fp);
$test->assertTrue("\r\nhi\r\n\r\nthere" === $contents, 'contents differ 1');
if ($contents != "\r\nhi\r\n\r\nthere") {
    var_dump(str_replace(array("\r", "\n"), array('\\r', '\\n'), $contents));
}
fclose($fp);

file_put_contents(__DIR__ . '/testit/foo.php', "\rhi\n\r\nthere");

$iterator = new PEAR2_Pyrus_Package_Creator_TaskIterator($taskxml, $package, PEAR2_Pyrus_Task_Common::PACKAGE, null);

$fp = fopen(__DIR__ . '/testit/foo.php', 'rb+');
$runcount = 0;
foreach ($iterator as $task) {
    ++$runcount;
    $task->startSession($fp, 'foo.php');
    rewind($fp);
}
$test->assertEquals(1, $runcount, 'Iterator did not run unixeol 2');
$test->assertTrue("\r\nhi\r\n\r\nthere" === stream_get_contents($fp), 'contents differ 2');
fclose($fp);
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Task_Windowseol::validateXml() failures
--FILE--
<?php
include dirname(__DIR__) . '/setup.minimal.php.inc';
$xmltest = function($xml, $filexml, $message, $exception) use ($package, $test)
{
    try {
        PEAR2_Pyrus_Task_Windowseol::validateXml($package, $xml, $filexml, 'filename');
        throw new Exception('should have failed');
    } catch (Exception $e) {
        $test->assertIsa($exception, $e, 'wrong exception class ' . $message);
        $test->assertEquals($message, $e->getMessage(), 'wrong message');
        return $e;
    }
};

$xmltest(array('attribs' => array()), array(), 'task <windowseol> in file filename is invalid because of "no attributes allowed"', 'PEAR2_Pyrus_Task_Exception_InvalidTask');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
packagefile parser for package.xml 2.1
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$pxml = dirname(__FILE__) . '/packages/package.xml';
$ret = $parser->parse(file_get_contents($pxml), $pxml, 'Mockv2');
$test->assertEquals(array (
  'filelist' => 
  array (
    'data/channel-1.0.xsd' => 
    array (
      'attribs' => 
      array (
        'role' => 'data',
        'name' => 'data/channel-1.0.xsd',
      ),
    ),
    'data/package-2.0.xsd' => 
    array (
      'attribs' => 
      array (
        'role' => 'data',
        'name' => 'data/package-2.0.xsd',
      ),
    ),
    'data/package-2.1.xsd' => 
    array (
      'attribs' => 
      array (
        'role' => 'data',
        'name' => 'data/package-2.1.xsd',
      ),
    ),
    'src/Pyrus/Channel/Base.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Channel/Base.php',
      ),
    ),
    'src/Pyrus/Channel/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Channel/Exception.php',
      ),
    ),
    'src/Pyrus/Channel/IMirror.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Channel/IMirror.php',
      ),
    ),
    'src/Pyrus/Channel/Mirror.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Channel/Mirror.php',
      ),
    ),
    'src/Pyrus/ChannelRegistry/Channel/Sqlite.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/ChannelRegistry/Channel/Sqlite.php',
      ),
    ),
    'src/Pyrus/ChannelRegistry/Channel/Xml.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/ChannelRegistry/Channel/Xml.php',
      ),
    ),
    'src/Pyrus/ChannelRegistry/Mirror/Sqlite.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/ChannelRegistry/Mirror/Sqlite.php',
      ),
    ),
    'src/Pyrus/ChannelRegistry/Mirror/Xml.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/ChannelRegistry/Mirror/Xml.php',
      ),
    ),
    'src/Pyrus/ChannelRegistry/Channel/Xml.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/ChannelRegistry/Channel/Xml.php',
      ),
    ),
    'src/Pyrus/ChannelRegistry/Base.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/ChannelRegistry/Base.php',
      ),
    ),
    'src/Pyrus/ChannelRegistry/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/ChannelRegistry/Exception.php',
      ),
    ),
    'src/Pyrus/ChannelRegistry/Sqlite.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/ChannelRegistry/Sqlite.php',
      ),
    ),
    'src/Pyrus/ChannelRegistry/Xml.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/ChannelRegistry/Xml.php',
      ),
    ),
    'src/Pyrus/Config/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Config/Exception.php',
      ),
    ),
    'src/Pyrus/Dependency/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Dependency/Exception.php',
      ),
    ),
    'src/Pyrus/Dependency/Validator.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Dependency/Validator.php',
      ),
    ),
    'src/Pyrus/DirectedGraph/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/DirectedGraph/Exception.php',
      ),
    ),
    'src/Pyrus/DirectedGraph/Vertex.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/DirectedGraph/Vertex.php',
      ),
    ),
    'src/Pyrus/FileTransactions/Installedas.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/FileTransactions/Installedas.php',
      ),
    ),
    'src/Pyrus/FileTransactions/Rename.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/FileTransactions/Rename.php',
      ),
    ),
    'src/Pyrus/FileTransactions/Rmdir.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/FileTransactions/Rmdir.php',
      ),
    ),
    'src/Pyrus/Installer/Role/Common.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Common.php',
      ),
    ),
    'src/Pyrus/Installer/Role/Data.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Data.php',
      ),
    ),
    'src/Pyrus/Installer/Role/Data.xml' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Data.xml',
      ),
    ),
    'src/Pyrus/Installer/Role/Doc.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Doc.php',
      ),
    ),
    'src/Pyrus/Installer/Role/Doc.xml' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Doc.xml',
      ),
    ),
    'src/Pyrus/Installer/Role/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Exception.php',
      ),
    ),
    'src/Pyrus/Installer/Role/Ext.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Ext.php',
      ),
    ),
    'src/Pyrus/Installer/Role/Ext.xml' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Ext.xml',
      ),
    ),
    'src/Pyrus/Installer/Role/Php.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Php.php',
      ),
    ),
    'src/Pyrus/Installer/Role/Php.xml' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Php.xml',
      ),
    ),
    'src/Pyrus/Installer/Role/Script.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Script.php',
      ),
    ),
    'src/Pyrus/Installer/Role/Script.xml' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Script.xml',
      ),
    ),
    'src/Pyrus/Installer/Role/Src.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Src.php',
      ),
    ),
    'src/Pyrus/Installer/Role/Src.xml' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Src.xml',
      ),
    ),
    'src/Pyrus/Installer/Role/Test.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Test.php',
      ),
    ),
    'src/Pyrus/Installer/Role/Test.xml' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Test.xml',
      ),
    ),
    'src/Pyrus/Installer/Role/Www.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Www.php',
      ),
    ),
    'src/Pyrus/Installer/Role/Www.xml' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role/Www.xml',
      ),
    ),
    'src/Pyrus/Installer/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Exception.php',
      ),
    ),
    'src/Pyrus/Installer/Role.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer/Role.php',
      ),
    ),
    'src/Pyrus/Package/Creator/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package/Creator/Exception.php',
      ),
    ),
    'src/Pyrus/Package/Creator/TaskIterator.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package/Creator/TaskIterator.php',
      ),
    ),
    'src/Pyrus/Package/Phar/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package/Phar/Exception.php',
      ),
    ),
    'src/Pyrus/Package/Tar/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package/Tar/Exception.php',
      ),
    ),
    'src/Pyrus/Package/Zip/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package/Zip/Exception.php',
      ),
    ),
    'src/Pyrus/Package/Base.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package/Base.php',
      ),
    ),
    'src/Pyrus/Package/Creator.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package/Creator.php',
      ),
    ),
    'src/Pyrus/Package/Dependency.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package/Dependency.php',
      ),
    ),
    'src/Pyrus/Package/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package/Exception.php',
      ),
    ),
    'src/Pyrus/Package/ICreator.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package/ICreator.php',
      ),
    ),
    'src/Pyrus/Package/InstalledException.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package/InstalledException.php',
      ),
    ),
    'src/Pyrus/Package/Phar.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package/Phar.php',
      ),
    ),
    'src/Pyrus/Package/Remote.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package/Remote.php',
      ),
    ),
    'src/Pyrus/Package/Tar.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package/Tar.php',
      ),
    ),
    'src/Pyrus/Package/Xml.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package/Xml.php',
      ),
    ),
    'src/Pyrus/Package/Zip.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package/Zip.php',
      ),
    ),
    'src/Pyrus/PackageFile/Parser/v2.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/Parser/v2.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2/Compatible/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2/Compatible/Exception.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2/Dependencies/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2/Dependencies/Exception.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2/Developer/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2/Developer/Exception.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2/Files/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2/Files/Exception.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2/Release/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2/Release/Exception.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2/Compatible.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2/Compatible.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2/Dependencies.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2/Dependencies.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2/Developer.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2/Developer.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2/Files.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2/Files.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2/Release.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2/Release.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2/Remote.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2/Remote.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2/Validator.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2/Validator.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2Iterator/File.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2Iterator/File.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2Iterator/FileAttribsFilter.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2Iterator/FileAttribsFilter.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2Iterator/FileContents.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2Iterator/FileContents.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2Iterator/FileContentsMulti.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2Iterator/FileContentsMulti.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2Iterator/FileInstallationFilter.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2Iterator/FileInstallationFilter.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2Iterator/FileTag.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2Iterator/FileTag.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2Iterator/PackagingIterator.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2Iterator/PackagingIterator.php',
      ),
    ),
    'src/Pyrus/PackageFile/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/Exception.php',
      ),
    ),
    'src/Pyrus/PackageFile/IValidator.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/IValidator.php',
      ),
    ),
    'src/Pyrus/PackageFile/v2.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile/v2.php',
      ),
    ),
    'src/Pyrus/Registry/Sqlite/Channel/Mirror.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Registry/Sqlite/Channel/Mirror.php',
      ),
    ),
    'src/Pyrus/Registry/Sqlite/Channel/Mirrors.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Registry/Sqlite/Channel/Mirrors.php',
      ),
    ),
    'src/Pyrus/Registry/Sqlite/Creator.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Registry/Sqlite/Creator.php',
      ),
    ),
    'src/Pyrus/Registry/Sqlite/Package.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Registry/Sqlite/Package.php',
      ),
    ),
    'src/Pyrus/Registry/Base.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Registry/Base.php',
      ),
    ),
    'src/Pyrus/Registry/Channel.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Registry/Channel.php',
      ),
    ),
    'src/Pyrus/Registry/Config.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Registry/Config.php',
      ),
    ),
    'src/Pyrus/Registry/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Registry/Exception.php',
      ),
    ),
    'src/Pyrus/Registry/Package.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Registry/Package.php',
      ),
    ),
    'src/Pyrus/Registry/Sqlite.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Registry/Sqlite.php',
      ),
    ),
    'src/Pyrus/Registry/Xml.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Registry/Xml.php',
      ),
    ),
    'src/Pyrus/REST/10.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/REST/10.php',
      ),
    ),
    'src/Pyrus/REST/11.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/REST/11.php',
      ),
    ),
    'src/Pyrus/REST/13.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/REST/13.php',
      ),
    ),
    'src/Pyrus/REST/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/REST/Exception.php',
      ),
    ),
    'src/Pyrus/REST/HTTPException.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/REST/HTTPException.php',
      ),
    ),
    'src/Pyrus/ScriptFrontend/Commands.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/ScriptFrontend/Commands.php',
      ),
    ),
    'src/Pyrus/Task/Postinstallscript/rw.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Task/Postinstallscript/rw.php',
      ),
    ),
    'src/Pyrus/Task/Replace/rw.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Task/Replace/rw.php',
      ),
    ),
    'src/Pyrus/Task/Unixeol/rw.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Task/Unixeol/rw.php',
      ),
    ),
    'src/Pyrus/Task/Windowseol/rw.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Task/Windowseol/rw.php',
      ),
    ),
    'src/Pyrus/Task/Common.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Task/Common.php',
      ),
    ),
    'src/Pyrus/Task/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Task/Exception.php',
      ),
    ),
    'src/Pyrus/Task/Postinstallscript.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Task/Postinstallscript.php',
      ),
    ),
    'src/Pyrus/Task/Replace.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Task/Replace.php',
      ),
    ),
    'src/Pyrus/Task/Unixeol.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Task/Unixeol.php',
      ),
    ),
    'src/Pyrus/Task/Windowseol.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Task/Windowseol.php',
      ),
    ),
    'src/Pyrus/Validate/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Validate/Exception.php',
      ),
    ),
    'src/Pyrus/Validator/PECL.php' => 
     array (
       'attribs' => 
       array (
         'role' => 'php',
         'name' => 'src/Pyrus/Validator/PECL.php',
      ),
    ),
    'src/Pyrus/XMLParser/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/XMLParser/Exception.php',
      ),
    ),
    'src/Pyrus/XMLWriter/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/XMLWriter/Exception.php',
      ),
    ),
    'src/Pyrus/Channel.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Channel.php',
      ),
    ),
    'src/Pyrus/ChannelRegistry.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/ChannelRegistry.php',
      ),
    ),
    'src/Pyrus/Config.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Config.php',
      ),
    ),
    'src/Pyrus/DirectedGraph.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/DirectedGraph.php',
      ),
    ),
    'src/Pyrus/Downloader.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Downloader.php',
      ),
    ),
    'src/Pyrus/Exception.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Exception.php',
      ),
    ),
    'src/Pyrus/FileTransactions.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/FileTransactions.php',
      ),
    ),
    'src/Pyrus/IChannel.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/IChannel.php',
      ),
    ),
    'src/Pyrus/IChannelRegistry.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/IChannelRegistry.php',
      ),
    ),
    'src/Pyrus/IFileTransaction.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/IFileTransaction.php',
      ),
    ),
    'src/Pyrus/Installer.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Installer.php',
      ),
    ),
    'src/Pyrus/IPackage.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/IPackage.php',
      ),
    ),
    'src/Pyrus/IRegistry.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/IRegistry.php',
      ),
    ),
    'src/Pyrus/Log.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Log.php',
      ),
    ),
    'src/Pyrus/OSGuess.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/OSGuess.php',
      ),
    ),
    'src/Pyrus/Package.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Package.php',
      ),
    ),
    'src/Pyrus/PackageFile.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/PackageFile.php',
      ),
    ),
    'src/Pyrus/Registry.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Registry.php',
      ),
    ),
    'src/Pyrus/REST.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/REST.php',
      ),
    ),
    'src/Pyrus/Validate.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/Validate.php',
      ),
    ),
    'src/Pyrus/XMLParser.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/XMLParser.php',
      ),
    ),
    'src/Pyrus/XMLWriter.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus/XMLWriter.php',
      ),
    ),
    'src/Pyrus.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/Pyrus.php',
      ),
    ),
  ),
  'baseinstalls' => 
  array (
    'data' => '/',
    'src' => 'PEAR2',
  ),
  'packagefile' => dirname(__FILE__) . '/packages/package.xml',
  'packageinfo' => 
  array (
    'attribs' => 
    array (
      'xmlns' => 'http://pear.php.net/dtd/package-2.1',
      'xmlns:tasks' => 'http://pear.php.net/dtd/tasks-1.0',
      'xmlns:xsi' => 'http://www.w3.org/2001/XMLSchema-instance',
      'version' => '2.1',
      'xsi:schemaLocation' => 'http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd',
    ),
    'name' => 'PEAR2_Pyrus',
    'channel' => 'pear2.php.net',
    'summary' => 'Pyrus is the package manager and installer for PHP 5.2 or newer
',
    'description' => '
Pyrus provides the means to install and manage installations for
packages built using package.xml version 2.0 or newer.  Pyrus is
redesigned from the ground up for PHP 5.2 or newer, and provides
significant improvements over the older PEAR Installer.

To use Pyrus, in this development series of releases, you need to
instantiate a simple script that creates a package and installs it:

<?php
// use full path if include_path is not set up
include \'PEAR2/Autoload.php\';
require_once \'Net/URL2.php\'; // PEAR package needed for PEAR2_HTTP_Request dep
$config = PEAR2_Pyrus_Config::singleton(\'/where/to/install\');
// this can be a url to a remote package, a local .tgz, .zip or package.xml
$p = new PEAR2_Pyrus_Package(\'thingtoinstall\');
try {
    PEAR2_Pyrus_Installer::begin();
    PEAR2_Pyrus_Installer::prepare($p);
    PEAR2_Pyrus_Installer::commit();
} catch (Exception $e) {
    PEAR2_Pyrus_Installer::rollback();
    echo $e;
}
?>',
    'lead' => 
    array (
      'name' => 'Gregory Beaver',
      'user' => 'cellog',
      'email' => 'cellog@php.net',
      'active' => 'yes',
    ),
    'date' => '2007-10-06',
    'version' => 
    array (
      'release' => '2.0.0a1',
      'api' => '0.1.0',
    ),
    'stability' => 
    array (
      'release' => 'alpha',
      'api' => 'alpha',
    ),
    'license' => 
    array (
      'attribs' => 
      array (
        'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
      ),
      '_content' => 'New BSD License',
    ),
    'notes' => 'Initial development release, no frontend is included',
    'contents' => 
    array (
      'dir' => 
      array (
        'attribs' => 
        array (
          'name' => '/',
        ),
        'dir' => 
        array (
          0 => 
          array (
            'attribs' => 
            array (
              'name' => 'data',
              'baseinstalldir' => '/',
            ),
            'file' => 
            array (
              0 => 
              array (
                'attribs' => 
                array (
                  'role' => 'data',
                  'name' => 'channel-1.0.xsd',
                ),
              ),
              1 => 
              array (
                'attribs' => 
                array (
                  'role' => 'data',
                  'name' => 'package-2.0.xsd',
                ),
              ),
              2 => 
              array (
                'attribs' => 
                array (
                  'role' => 'data',
                  'name' => 'package-2.1.xsd',
                ),
              ),
            ),
          ),
          1 => 
          array (
            'attribs' => 
            array (
              'name' => 'src',
              'baseinstalldir' => 'PEAR2',
            ),
            'dir' => 
            array (
              'attribs' => 
              array (
                'name' => 'Pyrus',
              ),
              'dir' => 
              array (
                0 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'Channel',
                  ),
                  'file' => 
                  array (
                    0 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Base.php',
                      ),
                    ),
                    1 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Exception.php',
                      ),
                    ),
                    2 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'IMirror.php',
                      ),
                    ),
                    3 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Mirror.php',
                      ),
                    ),
                  ),
                ),
                1 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'ChannelRegistry',
                  ),
                  'dir' => 
                  array (
                    0 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Channel',
                      ),
                      'file' => 
                      array (
                        0 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'Sqlite.php',
                          ),
                        ),
                        1 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'Xml.php',
                          ),
                        ),
                      ),
                    ),
                    1 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Mirror',
                      ),
                      'file' => 
                      array (
                        0 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'Sqlite.php',
                          ),
                        ),
                        1 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'Xml.php',
                          ),
                        ),
                      ),
                    ),
                  ),
                  'file' => 
                  array (
                    0 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Base.php',
                      ),
                    ),
                    1 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Exception.php',
                      ),
                    ),
                    2 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Sqlite.php',
                      ),
                    ),
                    3 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Xml.php',
                      ),
                    ),
                  ),
                ),
                2 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'Config',
                  ),
                  'file' => 
                  array (
                    'attribs' => 
                    array (
                      'role' => 'php',
                      'name' => 'Exception.php',
                    ),
                  ),
                ),
                3 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'Dependency',
                  ),
                  'file' => 
                  array (
                    0 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Exception.php',
                      ),
                    ),
                    1 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Validator.php',
                      ),
                    ),
                  ),
                ),
                4 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'DirectedGraph',
                  ),
                  'file' => 
                  array (
                    0 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Exception.php',
                      ),
                    ),
                    1 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Vertex.php',
                      ),
                    ),
                  ),
                ),
                5 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'FileTransactions',
                  ),
                  'file' => 
                  array (
                    0 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Installedas.php',
                      ),
                    ),
                    1 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Rename.php',
                      ),
                    ),
                    2 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Rmdir.php',
                      ),
                    ),
                  ),
                ),
                6 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'Installer',
                  ),
                  'dir' => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Role',
                    ),
                    'file' => 
                    array (
                      0 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Common.php',
                        ),
                      ),
                      1 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Data.php',
                        ),
                      ),
                      2 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Data.xml',
                        ),
                      ),
                      3 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Doc.php',
                        ),
                      ),
                      4 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Doc.xml',
                        ),
                      ),
                      5 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Exception.php',
                        ),
                      ),
                      6 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Ext.php',
                        ),
                      ),
                      7 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Ext.xml',
                        ),
                      ),
                      8 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Php.php',
                        ),
                      ),
                      9 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Php.xml',
                        ),
                      ),
                      10 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Script.php',
                        ),
                      ),
                      11 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Script.xml',
                        ),
                      ),
                      12 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Src.php',
                        ),
                      ),
                      13 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Src.xml',
                        ),
                      ),
                      14 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Test.php',
                        ),
                      ),
                      15 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Test.xml',
                        ),
                      ),
                      16 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Www.php',
                        ),
                      ),
                      17 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Www.xml',
                        ),
                      ),
                    ),
                  ),
                  'file' => 
                  array (
                    0 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Exception.php',
                      ),
                    ),
                    1 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Role.php',
                      ),
                    ),
                  ),
                ),
                7 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'Package',
                  ),
                  'dir' => 
                  array (
                    0 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Creator',
                      ),
                      'file' => 
                      array (
                        0 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'Exception.php',
                          ),
                        ),
                        1 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'TaskIterator.php',
                          ),
                        ),
                      ),
                    ),
                    1 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Phar',
                      ),
                      'file' => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Exception.php',
                        ),
                      ),
                    ),
                    2 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Tar',
                      ),
                      'file' => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Exception.php',
                        ),
                      ),
                    ),
                    3 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Zip',
                      ),
                      'file' => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Exception.php',
                        ),
                      ),
                    ),
                  ),
                  'file' => 
                  array (
                    0 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Base.php',
                      ),
                    ),
                    1 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Creator.php',
                      ),
                    ),
                    2 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Dependency.php',
                      ),
                    ),
                    3 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Exception.php',
                      ),
                    ),
                    4 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'ICreator.php',
                      ),
                    ),
                    5 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'InstalledException.php',
                      ),
                    ),
                    6 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Phar.php',
                      ),
                    ),
                    7 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Remote.php',
                      ),
                    ),
                    8 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Tar.php',
                      ),
                    ),
                    9 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Xml.php',
                      ),
                    ),
                    10 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Zip.php',
                      ),
                    ),
                  ),
                ),
                8 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'PackageFile',
                  ),
                  'dir' => 
                  array (
                    0 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Parser',
                      ),
                      'file' => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'v2.php',
                        ),
                      ),
                    ),
                    1 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'v2',
                      ),
                      'dir' => 
                      array (
                        0 => 
                        array (
                          'attribs' => 
                          array (
                            'name' => 'Compatible',
                          ),
                          'file' => 
                          array (
                            'attribs' => 
                            array (
                              'role' => 'php',
                              'name' => 'Exception.php',
                            ),
                          ),
                        ),
                        1 => 
                        array (
                          'attribs' => 
                          array (
                            'name' => 'Dependencies',
                          ),
                          'file' => 
                          array (
                            'attribs' => 
                            array (
                              'role' => 'php',
                              'name' => 'Exception.php',
                            ),
                          ),
                        ),
                        2 => 
                        array (
                          'attribs' => 
                          array (
                            'name' => 'Developer',
                          ),
                          'file' => 
                          array (
                            'attribs' => 
                            array (
                              'role' => 'php',
                              'name' => 'Exception.php',
                            ),
                          ),
                        ),
                        3 => 
                        array (
                          'attribs' => 
                          array (
                            'name' => 'Files',
                          ),
                          'file' => 
                          array (
                            'attribs' => 
                            array (
                              'role' => 'php',
                              'name' => 'Exception.php',
                            ),
                          ),
                        ),
                        4 => 
                        array (
                          'attribs' => 
                          array (
                            'name' => 'Release',
                          ),
                          'file' => 
                          array (
                            'attribs' => 
                            array (
                              'role' => 'php',
                              'name' => 'Exception.php',
                            ),
                          ),
                        ),
                      ),
                      'file' => 
                      array (
                        0 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'Compatible.php',
                          ),
                        ),
                        1 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'Dependencies.php',
                          ),
                        ),
                        2 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'Developer.php',
                          ),
                        ),
                        3 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'Files.php',
                          ),
                        ),
                        4 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'Release.php',
                          ),
                        ),
                        5 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'Remote.php',
                          ),
                        ),
                        6 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'Validator.php',
                          ),
                        ),
                      ),
                    ),
                    2 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'v2Iterator',
                      ),
                      'file' => 
                      array (
                        0 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'File.php',
                          ),
                        ),
                        1 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'FileAttribsFilter.php',
                          ),
                        ),
                        2 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'FileContents.php',
                          ),
                        ),
                        3 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'FileContentsMulti.php',
                          ),
                        ),
                        4 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'FileInstallationFilter.php',
                          ),
                        ),
                        5 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'FileTag.php',
                          ),
                        ),
                        6 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'PackagingIterator.php',
                          ),
                        ),
                      ),
                    ),
                  ),
                  'file' => 
                  array (
                    0 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Exception.php',
                      ),
                    ),
                    1 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'IValidator.php',
                      ),
                    ),
                    2 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'v2.php',
                      ),
                    ),
                  ),
                ),
                9 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'Registry',
                  ),
                  'dir' => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Sqlite',
                    ),
                    'dir' => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Channel',
                      ),
                      'file' => 
                      array (
                        0 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'Mirror.php',
                          ),
                        ),
                        1 => 
                        array (
                          'attribs' => 
                          array (
                            'role' => 'php',
                            'name' => 'Mirrors.php',
                          ),
                        ),
                      ),
                    ),
                    'file' => 
                    array (
                      0 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Creator.php',
                        ),
                      ),
                      1 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Package.php',
                        ),
                      ),
                    ),
                  ),
                  'file' => 
                  array (
                    0 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Base.php',
                      ),
                    ),
                    1 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Channel.php',
                      ),
                    ),
                    2 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Config.php',
                      ),
                    ),
                    3 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Exception.php',
                      ),
                    ),
                    4 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Package.php',
                      ),
                    ),
                    5 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Sqlite.php',
                      ),
                    ),
                    6 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Xml.php',
                      ),
                    ),
                  ),
                ),
                10 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'REST',
                  ),
                  'file' => 
                  array (
                    0 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => '10.php',
                      ),
                    ),
                    1 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => '11.php',
                      ),
                    ),
                    2 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => '13.php',
                      ),
                    ),
                    3 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Exception.php',
                      ),
                    ),
                    4 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'HTTPException.php',
                      ),
                    ),
                  ),
                ),
                11 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'ScriptFrontend',
                  ),
                  'file' => 
                  array (
                    'attribs' => 
                    array (
                      'role' => 'php',
                      'name' => 'Commands.php',
                    ),
                  ),
                ),
                12 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'Task',
                  ),
                  'dir' => 
                  array (
                    0 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Postinstallscript',
                      ),
                      'file' => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'rw.php',
                        ),
                      ),
                    ),
                    1 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Replace',
                      ),
                      'file' => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'rw.php',
                        ),
                      ),
                    ),
                    2 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Unixeol',
                      ),
                      'file' => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'rw.php',
                        ),
                      ),
                    ),
                    3 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Windowseol',
                      ),
                      'file' => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'rw.php',
                        ),
                      ),
                    ),
                  ),
                  'file' => 
                  array (
                    0 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Common.php',
                      ),
                    ),
                    1 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Exception.php',
                      ),
                    ),
                    2 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Postinstallscript.php',
                      ),
                    ),
                    3 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Replace.php',
                      ),
                    ),
                    4 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Unixeol.php',
                      ),
                    ),
                    5 => 
                    array (
                      'attribs' => 
                      array (
                        'role' => 'php',
                        'name' => 'Windowseol.php',
                      ),
                    ),
                  ),
                ),
                13 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'Validate',
                  ),
                  'file' => 
                  array (
                    'attribs' => 
                    array (
                      'role' => 'php',
                      'name' => 'Exception.php',
                    ),
                  ),
                ),
                14 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'Validator',
                  ),
                  'file' => 
                  array (
                    'attribs' => 
                    array (
                      'role' => 'php',
                      'name' => 'PECL.php',
                    ),
                  ),
                ),
                15 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'XMLParser',
                  ),
                  'file' => 
                  array (
                    'attribs' => 
                    array (
                      'role' => 'php',
                      'name' => 'Exception.php',
                    ),
                  ),
                ),
                16 => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'XMLWriter',
                  ),
                  'file' => 
                  array (
                    'attribs' => 
                    array (
                      'role' => 'php',
                      'name' => 'Exception.php',
                    ),
                  ),
                ),
              ),
              'file' => 
              array (
                0 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'Channel.php',
                  ),
                ),
                1 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'ChannelRegistry.php',
                  ),
                ),
                2 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'Config.php',
                  ),
                ),
                3 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'DirectedGraph.php',
                  ),
                ),
                4 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'Downloader.php',
                  ),
                ),
                5 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'Exception.php',
                  ),
                ),
                6 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'FileTransactions.php',
                  ),
                ),
                7 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'IChannel.php',
                  ),
                ),
                8 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'IChannelRegistry.php',
                  ),
                ),
                9 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'IFileTransaction.php',
                  ),
                ),
                10 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'Installer.php',
                  ),
                ),
                11 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'IPackage.php',
                  ),
                ),
                12 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'IRegistry.php',
                  ),
                ),
                13 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'Log.php',
                  ),
                ),
                14 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'OSGuess.php',
                  ),
                ),
                15 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'Package.php',
                  ),
                ),
                16 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'PackageFile.php',
                  ),
                ),
                17 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'Registry.php',
                  ),
                ),
                18 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'REST.php',
                  ),
                ),
                19 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'Validate.php',
                  ),
                ),
                20 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'XMLParser.php',
                  ),
                ),
                21 => 
                array (
                  'attribs' => 
                  array (
                    'role' => 'php',
                    'name' => 'XMLWriter.php',
                  ),
                ),
              ),
            ),
            'file' => 
            array (
              'attribs' => 
              array (
                'role' => 'php',
                'name' => 'Pyrus.php',
              ),
            ),
          ),
        ),
      ),
    ),
    'dependencies' => 
    array (
      'required' => 
      array (
        'php' => 
        array (
          'min' => '5.2.0',
        ),
        'pearinstaller' => 
        array (
          'min' => '2.0.0a1',
        ),
      ),
    ),
    'phprelease' => '',
  ),
), $ret->getThingy(), 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
packagefile parser for package.xml 2.0
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$pxml = dirname(__FILE__) . '/packages/package2.xml';
$ret = $parser->parse(file_get_contents($pxml), $pxml, 'Mockv2');
$test->assertEquals(array (
  'filelist' => 
  array (
    'OS/Guess.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'OS/Guess.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/ChannelFile/Parser.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/ChannelFile/Parser.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Command/Auth.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Auth.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Command/Auth.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Auth.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Command/Build.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Build.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Command/Build.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Build.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Command/Channels.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Channels.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Command/Channels.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Channels.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Command/Common.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Common.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Command/Config.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Config.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Command/Config.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Config.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Command/Install.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Install.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Command/Install.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Install.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Command/Mirror.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Mirror.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Command/Mirror.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Mirror.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Command/Package.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Package.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Command/Package.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Package.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        0 => 
        array (
          'attribs' => 
          array (
            'from' => '@DATA-DIR@',
            'to' => 'data_dir',
            'type' => 'pear-config',
          ),
        ),
        1 => 
        array (
          'attribs' => 
          array (
            'from' => '@package_version@',
            'to' => 'version',
            'type' => 'package-info',
          ),
        ),
      ),
    ),
    'PEAR/Command/Pickle.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Pickle.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Command/Pickle.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Pickle.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Command/Registry.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Registry.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Command/Registry.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Registry.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Command/Remote.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Remote.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Command/Remote.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Remote.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Command/Test.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Test.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Command/Test.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command/Test.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Downloader/Package.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Downloader/Package.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@PEAR-VER@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Frontend/CLI.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Frontend/CLI.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Installer/Role/Common.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Common.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Installer/Role/Data.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Data.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Installer/Role/Data.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Data.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Installer/Role/Doc.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Doc.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Installer/Role/Doc.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Doc.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Installer/Role/Ext.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Ext.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Installer/Role/Ext.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Ext.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Installer/Role/Php.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Php.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Installer/Role/Php.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Php.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Installer/Role/Script.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Script.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Installer/Role/Script.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Script.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Installer/Role/Src.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Src.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Installer/Role/Src.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Src.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Installer/Role/Test.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Test.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Installer/Role/Test.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Test.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Installer/Role/Www.xml' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Www.xml',
        'role' => 'php',
      ),
    ),
    'PEAR/Installer/Role/Www.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role/Www.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Installer/Role.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer/Role.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/PackageFile/Generator/v1.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/PackageFile/Generator/v1.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@PEAR-VER@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/PackageFile/Generator/v2.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/PackageFile/Generator/v2.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@PEAR-VER@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/PackageFile/Parser/v1.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/PackageFile/Parser/v1.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/PackageFile/Parser/v2.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/PackageFile/Parser/v2.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/PackageFile/v2/rw.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'PEAR/PackageFile/v2/rw.php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/PackageFile/v2/Validator.php' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'PEAR/PackageFile/v2/Validator.php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/PackageFile/v1.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/PackageFile/v1.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/PackageFile/v2.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/PackageFile/v2.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/REST/10.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/REST/10.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/REST/11.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/REST/11.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/REST/13.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/REST/13.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Task/Postinstallscript/rw.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Task/Postinstallscript/rw.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Task/Replace/rw.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Task/Replace/rw.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Task/Unixeol/rw.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Task/Unixeol/rw.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Task/Windowseol/rw.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Task/Windowseol/rw.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Task/Common.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Task/Common.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Task/Postinstallscript.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Task/Postinstallscript.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Task/Replace.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Task/Replace.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Task/Unixeol.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Task/Unixeol.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Task/Windowseol.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Task/Windowseol.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Validator/PECL.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Validator/PECL.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Autoloader.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Autoloader.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Builder.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Builder.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@PEAR-VER@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/ChannelFile.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/ChannelFile.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Command.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Command.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Common.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Common.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Config.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Config.php',
         'role' => 'php',
       ),
       'tasks:replace' => 
       array (
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Dependency.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Dependency.php',
        'role' => 'php',
      ),
    ),
    'PEAR/DependencyDB.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/DependencyDB.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Dependency2.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Dependency2.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@PEAR-VER@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Downloader.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Downloader.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/ErrorStack.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/ErrorStack.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Exception.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Exception.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Frontend.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Frontend.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Installer.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Installer.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/PackageFile.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/PackageFile.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@PEAR-VER@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Packager.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Packager.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Registry.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Registry.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Remote.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Remote.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/REST.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/REST.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/RunTest.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/RunTest.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/Validate.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/Validate.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'PEAR/XMLParser.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR/XMLParser.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'scripts/pear.bat' => 
    array (
      'attribs' => 
      array (
        'name' => 'scripts/pear.bat',
        'role' => 'script',
      ),
      'tasks:replace' => 
      array (
        0 => 
        array (
          'attribs' => 
          array (
            'from' => '@bin_dir@',
            'to' => 'bin_dir',
            'type' => 'pear-config',
          ),
        ),
        1 => 
        array (
          'attribs' => 
          array (
            'from' => '@php_bin@',
            'to' => 'php_bin',
            'type' => 'pear-config',
          ),
        ),
        2 => 
        array (
          'attribs' => 
          array (
            'from' => '@include_path@',
            'to' => 'php_dir',
            'type' => 'pear-config',
          ),
        ),
      ),
      'tasks:windowseol' => '',
    ),
    'scripts/peardev.bat' => 
    array (
      'attribs' => 
      array (
        'name' => 'scripts/peardev.bat',
        'role' => 'script',
      ),
      'tasks:replace' => 
      array (
        0 => 
        array (
          'attribs' => 
          array (
            'from' => '@bin_dir@',
            'to' => 'bin_dir',
            'type' => 'pear-config',
          ),
        ),
        1 => 
        array (
          'attribs' => 
          array (
            'from' => '@php_bin@',
            'to' => 'php_bin',
            'type' => 'pear-config',
          ),
        ),
        2 => 
        array (
          'attribs' => 
          array (
            'from' => '@include_path@',
            'to' => 'php_dir',
            'type' => 'pear-config',
          ),
        ),
      ),
      'tasks:windowseol' => '',
    ),
    'scripts/pecl.bat' => 
    array (
      'attribs' => 
      array (
        'name' => 'scripts/pecl.bat',
        'role' => 'script',
      ),
      'tasks:replace' => 
      array (
        0 => 
        array (
          'attribs' => 
          array (
            'from' => '@bin_dir@',
            'to' => 'bin_dir',
            'type' => 'pear-config',
          ),
        ),
        1 => 
        array (
          'attribs' => 
          array (
            'from' => '@php_bin@',
            'to' => 'php_bin',
            'type' => 'pear-config',
          ),
        ),
        2 => 
        array (
          'attribs' => 
          array (
            'from' => '@include_path@',
            'to' => 'php_dir',
            'type' => 'pear-config',
          ),
        ),
      ),
      'tasks:windowseol' => '',
    ),
    'scripts/pear.sh' => 
    array (
      'attribs' => 
      array (
        'name' => 'scripts/pear.sh',
        'role' => 'script',
      ),
      'tasks:replace' => 
      array (
        0 => 
        array (
          'attribs' => 
          array (
            'from' => '@php_bin@',
            'to' => 'php_bin',
            'type' => 'pear-config',
          ),
        ),
        1 => 
        array (
          'attribs' => 
          array (
            'from' => '@php_dir@',
            'to' => 'php_dir',
            'type' => 'pear-config',
          ),
        ),
        2 => 
        array (
          'attribs' => 
          array (
            'from' => '@pear_version@',
            'to' => 'version',
            'type' => 'package-info',
          ),
        ),
        3 => 
        array (
          'attribs' => 
          array (
            'from' => '@include_path@',
            'to' => 'php_dir',
            'type' => 'pear-config',
          ),
        ),
      ),
      'tasks:unixeol' => '',
    ),
    'scripts/peardev.sh' => 
    array (
      'attribs' => 
      array (
        'name' => 'scripts/peardev.sh',
        'role' => 'script',
      ),
      'tasks:replace' => 
      array (
        0 => 
        array (
          'attribs' => 
          array (
            'from' => '@php_bin@',
            'to' => 'php_bin',
            'type' => 'pear-config',
          ),
        ),
        1 => 
        array (
          'attribs' => 
          array (
            'from' => '@php_dir@',
            'to' => 'php_dir',
            'type' => 'pear-config',
          ),
        ),
        2 => 
        array (
          'attribs' => 
          array (
            'from' => '@pear_version@',
            'to' => 'version',
            'type' => 'package-info',
          ),
        ),
        3 => 
        array (
          'attribs' => 
          array (
            'from' => '@include_path@',
            'to' => 'php_dir',
            'type' => 'pear-config',
          ),
        ),
      ),
      'tasks:unixeol' => '',
    ),
    'scripts/pecl.sh' => 
    array (
      'attribs' => 
      array (
        'name' => 'scripts/pecl.sh',
        'role' => 'script',
      ),
      'tasks:replace' => 
      array (
        0 => 
        array (
          'attribs' => 
          array (
            'from' => '@php_bin@',
            'to' => 'php_bin',
            'type' => 'pear-config',
          ),
        ),
        1 => 
        array (
          'attribs' => 
          array (
            'from' => '@php_dir@',
            'to' => 'php_dir',
            'type' => 'pear-config',
          ),
        ),
        2 => 
        array (
          'attribs' => 
          array (
            'from' => '@pear_version@',
            'to' => 'version',
            'type' => 'package-info',
          ),
        ),
        3 => 
        array (
          'attribs' => 
          array (
            'from' => '@include_path@',
            'to' => 'php_dir',
            'type' => 'pear-config',
          ),
        ),
      ),
      'tasks:unixeol' => '',
    ),
    'scripts/pearcmd.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'scripts/pearcmd.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        0 => 
        array (
          'attribs' => 
          array (
            'from' => '@php_bin@',
            'to' => 'php_bin',
            'type' => 'pear-config',
          ),
        ),
        1 => 
        array (
          'attribs' => 
          array (
            'from' => '@php_dir@',
            'to' => 'php_dir',
            'type' => 'pear-config',
          ),
        ),
        2 => 
        array (
          'attribs' => 
          array (
            'from' => '@pear_version@',
            'to' => 'version',
            'type' => 'package-info',
          ),
        ),
        3 => 
        array (
          'attribs' => 
          array (
            'from' => '@include_path@',
            'to' => 'php_dir',
            'type' => 'pear-config',
          ),
        ),
      ),
    ),
    'scripts/peclcmd.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'scripts/peclcmd.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        0 => 
        array (
          'attribs' => 
          array (
            'from' => '@php_bin@',
            'to' => 'php_bin',
            'type' => 'pear-config',
          ),
        ),
        1 => 
        array (
          'attribs' => 
          array (
            'from' => '@php_dir@',
            'to' => 'php_dir',
            'type' => 'pear-config',
          ),
        ),
        2 => 
        array (
          'attribs' => 
          array (
            'from' => '@pear_version@',
            'to' => 'version',
            'type' => 'package-info',
          ),
        ),
        3 => 
        array (
          'attribs' => 
          array (
            'from' => '@include_path@',
            'to' => 'php_dir',
            'type' => 'pear-config',
          ),
        ),
      ),
    ),
    'INSTALL' => 
    array (
      'attribs' => 
      array (
        'name' => 'INSTALL',
        'role' => 'doc',
      ),
    ),
    'package.dtd' => 
    array (
      'attribs' => 
      array (
        'name' => 'package.dtd',
        'role' => 'data',
      ),
    ),
    'PEAR.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'PEAR.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'README' => 
    array (
      'attribs' => 
      array (
        'name' => 'README',
        'role' => 'doc',
      ),
    ),
    'System.php' => 
    array (
      'attribs' => 
      array (
        'name' => 'System.php',
        'role' => 'php',
      ),
      'tasks:replace' => 
      array (
        'attribs' => 
        array (
          'from' => '@package_version@',
          'to' => 'version',
          'type' => 'package-info',
        ),
      ),
    ),
    'template.spec' => 
    array (
      'attribs' => 
      array (
        'name' => 'template.spec',
        'role' => 'data',
      ),
    ),
  ),
  'baseinstalls' => 
  array (
    'scripts' => '/',
  ),
  'packagefile' => dirname(__FILE__) . '/packages/package2.xml',
  'packageinfo' => 
  array (
    'attribs' => 
    array (
      'xmlns' => 'http://pear.php.net/dtd/package-2.0',
      'xmlns:tasks' => 'http://pear.php.net/dtd/tasks-1.0',
      'xmlns:xsi' => 'http://www.w3.org/2001/XMLSchema-instance',
      'version' => '2.0',
      'xsi:schemaLocation' => 'http://pear.php.net/dtd/tasks-1.0 http://pear.php.net/dtd/tasks-1.0.xsd http://pear.php.net/dtd/package-2.0 http://pear.php.net/dtd/package-2.0.xsd',
    ),
    'name' => 'PEAR',
    'channel' => 'pear.php.net',
    'summary' => 'PEAR Base System',
    'description' => 'The PEAR package contains:
 * the PEAR installer, for creating, distributing
   and installing packages
 * the PEAR_Exception PHP5 error handling mechanism
 * the PEAR_ErrorStack advanced error handling mechanism
 * the PEAR_Error error handling mechanism
 * the OS_Guess class for retrieving info about the OS
   where PHP is running on
 * the System class for quick handling of common operations
   with files and directories
 * the PEAR base class

  Features in a nutshell:
  * full support for channels
  * pre-download dependency validation
  * new package.xml 2.0 format allows tremendous flexibility while maintaining BC
  * support for optional dependency groups and limited support for sub-packaging
  * robust dependency support
  * full dependency validation on uninstall
  * remote install for hosts with only ftp access - no more problems with
    restricted host installation
  * full support for mirroring
  * support for bundling several packages into a single tarball
  * support for static dependencies on a url-based package
  * support for custom file roles and installation tasks
 ',
    'lead' => 
    array (
      0 => 
      array (
        'name' => 'Greg Beaver',
        'user' => 'cellog',
        'email' => 'cellog@php.net',
        'active' => 'yes',
      ),
      1 => 
      array (
        'name' => 'Pierre-Alain Joye',
        'user' => 'pajoye',
        'email' => 'pierre@php.net',
        'active' => 'no',
      ),
      2 => 
      array (
        'name' => 'Stig Bakken',
        'user' => 'ssb',
        'email' => 'stig@php.net',
        'active' => 'no',
      ),
      3 => 
      array (
        'name' => 'Tomas V.V.Cox',
        'user' => 'cox',
        'email' => 'cox@idecnet.com',
        'active' => 'no',
      ),
    ),
    'developer' => 
    array (
      0 => 
      array (
        'name' => 'Helgi Thormar',
        'user' => 'dufuz',
        'email' => 'dufuz@php.net',
        'active' => 'yes',
      ),
      1 => 
      array (
        'name' => 'Tias Guns',
        'user' => 'tias',
        'email' => 'tias@php.net',
        'active' => 'yes',
      ),
    ),
    'helper' => 
    array (
      0 => 
      array (
        'name' => 'Tim Jackson',
        'user' => 'timj',
        'email' => 'timj@php.net',
        'active' => 'no',
      ),
      1 => 
      array (
        'name' => 'Bertrand Gugger',
        'user' => 'toggg',
        'email' => 'toggg@php.net',
        'active' => 'no',
      ),
      2 => 
      array (
        'name' => 'Martin Jansen',
        'user' => 'mj',
        'email' => 'mj@php.net',
        'active' => 'no',
      ),
    ),
    'date' => '2007-10-01',
    'version' => 
    array (
      'release' => '1.7.0',
      'api' => '1.7.0',
    ),
    'stability' => 
    array (
      'release' => 'stable',
      'api' => 'stable',
    ),
    'license' => 
    array (
      'attribs' => 
      array (
        'uri' => 'http://www.php.net/license',
      ),
      '_content' => 'PHP License',
    ),
    'notes' => '
  * implement Request #11964: introduce www role, www_dir config variable [cellog]
 ',
    'contents' => 
    array (
      'dir' => 
      array (
        'attribs' => 
        array (
          'name' => '/',
        ),
        'dir' => 
        array (
          0 => 
          array (
            'attribs' => 
            array (
              'name' => 'OS',
            ),
            'file' => 
            array (
              'attribs' => 
              array (
                'name' => 'Guess.php',
                'role' => 'php',
              ),
              'tasks:replace' => 
              array (
                'attribs' => 
                array (
                  'from' => '@package_version@',
                  'to' => 'version',
                  'type' => 'package-info',
                ),
              ),
            ),
          ),
          1 => 
          array (
            'attribs' => 
            array (
              'name' => 'PEAR',
            ),
            'dir' => 
            array (
              0 => 
              array (
                'attribs' => 
                array (
                  'name' => 'ChannelFile',
                ),
                'file' => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'Parser.php',
                    'role' => 'php',
                  ),
                  'tasks:replace' => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@package_version@',
                      'to' => 'version',
                      'type' => 'package-info',
                    ),
                  ),
                ),
              ),
              1 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Command',
                ),
                'file' => 
                array (
                  0 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Auth.xml',
                      'role' => 'php',
                    ),
                  ),
                  1 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Auth.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  2 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Build.xml',
                      'role' => 'php',
                    ),
                  ),
                  3 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Build.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  4 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Channels.xml',
                      'role' => 'php',
                    ),
                  ),
                  5 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Channels.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  6 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Common.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  7 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Config.xml',
                      'role' => 'php',
                    ),
                  ),
                  8 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Config.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  9 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Install.xml',
                      'role' => 'php',
                    ),
                  ),
                  10 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Install.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  11 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Mirror.xml',
                      'role' => 'php',
                    ),
                  ),
                  12 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Mirror.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  13 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Package.xml',
                      'role' => 'php',
                    ),
                  ),
                  14 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Package.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      0 => 
                      array (
                        'attribs' => 
                        array (
                          'from' => '@DATA-DIR@',
                          'to' => 'data_dir',
                          'type' => 'pear-config',
                        ),
                      ),
                      1 => 
                      array (
                        'attribs' => 
                        array (
                          'from' => '@package_version@',
                          'to' => 'version',
                          'type' => 'package-info',
                        ),
                      ),
                    ),
                  ),
                  15 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Pickle.xml',
                      'role' => 'php',
                    ),
                  ),
                  16 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Pickle.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  17 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Registry.xml',
                      'role' => 'php',
                    ),
                  ),
                  18 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Registry.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  19 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Remote.xml',
                      'role' => 'php',
                    ),
                  ),
                  20 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Remote.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  21 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Test.xml',
                      'role' => 'php',
                    ),
                  ),
                  22 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Test.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                ),
              ),
              2 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Downloader',
                ),
                'file' => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'Package.php',
                    'role' => 'php',
                  ),
                  'tasks:replace' => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@PEAR-VER@',
                      'to' => 'version',
                      'type' => 'package-info',
                    ),
                  ),
                ),
              ),
              3 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Frontend',
                ),
                'file' => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'CLI.php',
                    'role' => 'php',
                  ),
                  'tasks:replace' => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@package_version@',
                      'to' => 'version',
                      'type' => 'package-info',
                    ),
                  ),
                ),
              ),
              4 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Installer',
                ),
                'dir' => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'Role',
                  ),
                  'file' => 
                  array (
                    0 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Common.php',
                        'role' => 'php',
                      ),
                      'tasks:replace' => 
                      array (
                        'attribs' => 
                        array (
                          'from' => '@package_version@',
                          'to' => 'version',
                          'type' => 'package-info',
                        ),
                      ),
                    ),
                    1 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Data.xml',
                        'role' => 'php',
                      ),
                    ),
                    2 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Data.php',
                        'role' => 'php',
                      ),
                      'tasks:replace' => 
                      array (
                        'attribs' => 
                        array (
                          'from' => '@package_version@',
                          'to' => 'version',
                          'type' => 'package-info',
                        ),
                      ),
                    ),
                    3 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Doc.xml',
                        'role' => 'php',
                      ),
                    ),
                    4 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Doc.php',
                        'role' => 'php',
                      ),
                      'tasks:replace' => 
                      array (
                        'attribs' => 
                        array (
                          'from' => '@package_version@',
                          'to' => 'version',
                          'type' => 'package-info',
                        ),
                      ),
                    ),
                    5 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Ext.xml',
                        'role' => 'php',
                      ),
                    ),
                    6 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Ext.php',
                        'role' => 'php',
                      ),
                      'tasks:replace' => 
                      array (
                        'attribs' => 
                        array (
                          'from' => '@package_version@',
                          'to' => 'version',
                          'type' => 'package-info',
                        ),
                      ),
                    ),
                    7 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Php.xml',
                        'role' => 'php',
                      ),
                    ),
                    8 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Php.php',
                        'role' => 'php',
                      ),
                      'tasks:replace' => 
                      array (
                        'attribs' => 
                        array (
                          'from' => '@package_version@',
                          'to' => 'version',
                          'type' => 'package-info',
                        ),
                      ),
                    ),
                    9 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Script.xml',
                        'role' => 'php',
                      ),
                    ),
                    10 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Script.php',
                        'role' => 'php',
                      ),
                      'tasks:replace' => 
                      array (
                        'attribs' => 
                        array (
                          'from' => '@package_version@',
                          'to' => 'version',
                          'type' => 'package-info',
                        ),
                      ),
                    ),
                    11 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Src.xml',
                        'role' => 'php',
                      ),
                    ),
                    12 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Src.php',
                        'role' => 'php',
                      ),
                      'tasks:replace' => 
                      array (
                        'attribs' => 
                        array (
                          'from' => '@package_version@',
                          'to' => 'version',
                          'type' => 'package-info',
                        ),
                      ),
                    ),
                    13 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Test.xml',
                        'role' => 'php',
                      ),
                    ),
                    14 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Test.php',
                        'role' => 'php',
                      ),
                      'tasks:replace' => 
                      array (
                        'attribs' => 
                        array (
                          'from' => '@package_version@',
                          'to' => 'version',
                          'type' => 'package-info',
                        ),
                      ),
                    ),
                    15 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Www.xml',
                        'role' => 'php',
                      ),
                    ),
                    16 => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'Www.php',
                        'role' => 'php',
                      ),
                      'tasks:replace' => 
                      array (
                        'attribs' => 
                        array (
                          'from' => '@package_version@',
                          'to' => 'version',
                          'type' => 'package-info',
                        ),
                      ),
                    ),
                  ),
                ),
                'file' => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'Role.php',
                    'role' => 'php',
                  ),
                  'tasks:replace' => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@package_version@',
                      'to' => 'version',
                      'type' => 'package-info',
                    ),
                  ),
                ),
              ),
              5 => 
              array (
                'attribs' => 
                array (
                  'name' => 'PackageFile',
                ),
                'dir' => 
                array (
                  0 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Generator',
                    ),
                    'file' => 
                    array (
                      0 => 
                      array (
                        'attribs' => 
                        array (
                          'name' => 'v1.php',
                          'role' => 'php',
                        ),
                        'tasks:replace' => 
                        array (
                          'attribs' => 
                          array (
                            'from' => '@PEAR-VER@',
                            'to' => 'version',
                            'type' => 'package-info',
                          ),
                        ),
                      ),
                      1 => 
                      array (
                        'attribs' => 
                        array (
                          'name' => 'v2.php',
                          'role' => 'php',
                        ),
                        'tasks:replace' => 
                        array (
                          'attribs' => 
                          array (
                            'from' => '@PEAR-VER@',
                            'to' => 'version',
                            'type' => 'package-info',
                          ),
                        ),
                      ),
                    ),
                  ),
                  1 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Parser',
                    ),
                    'file' => 
                    array (
                      0 => 
                      array (
                        'attribs' => 
                        array (
                          'name' => 'v1.php',
                          'role' => 'php',
                        ),
                        'tasks:replace' => 
                        array (
                          'attribs' => 
                          array (
                            'from' => '@package_version@',
                            'to' => 'version',
                            'type' => 'package-info',
                          ),
                        ),
                      ),
                      1 => 
                      array (
                        'attribs' => 
                        array (
                          'name' => 'v2.php',
                          'role' => 'php',
                        ),
                        'tasks:replace' => 
                        array (
                          'attribs' => 
                          array (
                            'from' => '@package_version@',
                            'to' => 'version',
                            'type' => 'package-info',
                          ),
                        ),
                      ),
                    ),
                  ),
                  2 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'v2',
                    ),
                    'file' => 
                    array (
                      0 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'rw.php',
                        ),
                        'tasks:replace' => 
                        array (
                          'attribs' => 
                          array (
                            'from' => '@package_version@',
                            'to' => 'version',
                            'type' => 'package-info',
                          ),
                        ),
                      ),
                      1 => 
                      array (
                        'attribs' => 
                        array (
                          'role' => 'php',
                          'name' => 'Validator.php',
                        ),
                        'tasks:replace' => 
                        array (
                          'attribs' => 
                          array (
                            'from' => '@package_version@',
                            'to' => 'version',
                            'type' => 'package-info',
                          ),
                        ),
                      ),
                    ),
                  ),
                ),
                'file' => 
                array (
                  0 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'v1.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  1 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'v2.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                ),
              ),
              6 => 
              array (
                'attribs' => 
                array (
                  'name' => 'REST',
                ),
                'file' => 
                array (
                  0 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => '10.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  1 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => '11.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  2 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => '13.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                ),
              ),
              7 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Task',
                ),
                'dir' => 
                array (
                  0 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Postinstallscript',
                    ),
                    'file' => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'rw.php',
                        'role' => 'php',
                      ),
                      'tasks:replace' => 
                      array (
                        'attribs' => 
                        array (
                          'from' => '@package_version@',
                          'to' => 'version',
                          'type' => 'package-info',
                        ),
                      ),
                    ),
                  ),
                  1 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Replace',
                    ),
                    'file' => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'rw.php',
                        'role' => 'php',
                      ),
                      'tasks:replace' => 
                      array (
                        'attribs' => 
                        array (
                          'from' => '@package_version@',
                          'to' => 'version',
                          'type' => 'package-info',
                        ),
                      ),
                    ),
                  ),
                  2 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Unixeol',
                    ),
                    'file' => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'rw.php',
                        'role' => 'php',
                      ),
                      'tasks:replace' => 
                      array (
                        'attribs' => 
                        array (
                          'from' => '@package_version@',
                          'to' => 'version',
                          'type' => 'package-info',
                        ),
                      ),
                    ),
                  ),
                  3 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Windowseol',
                    ),
                    'file' => 
                    array (
                      'attribs' => 
                      array (
                        'name' => 'rw.php',
                        'role' => 'php',
                      ),
                      'tasks:replace' => 
                      array (
                        'attribs' => 
                        array (
                          'from' => '@package_version@',
                          'to' => 'version',
                          'type' => 'package-info',
                        ),
                      ),
                    ),
                  ),
                ),
                'file' => 
                array (
                  0 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Common.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  1 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Postinstallscript.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  2 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Replace.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  3 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Unixeol.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                  4 => 
                  array (
                    'attribs' => 
                    array (
                      'name' => 'Windowseol.php',
                      'role' => 'php',
                    ),
                    'tasks:replace' => 
                    array (
                      'attribs' => 
                      array (
                        'from' => '@package_version@',
                        'to' => 'version',
                        'type' => 'package-info',
                      ),
                    ),
                  ),
                ),
              ),
              8 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Validator',
                ),
                'file' => 
                array (
                  'attribs' => 
                  array (
                    'name' => 'PECL.php',
                    'role' => 'php',
                  ),
                  'tasks:replace' => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@package_version@',
                      'to' => 'version',
                      'type' => 'package-info',
                    ),
                  ),
                ),
              ),
            ),
            'file' => 
            array (
              0 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Autoloader.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              1 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Builder.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@PEAR-VER@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              2 => 
              array (
                'attribs' => 
                array (
                  'name' => 'ChannelFile.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              3 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Command.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              4 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Common.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              5 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Config.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              6 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Dependency.php',
                  'role' => 'php',
                ),
              ),
              7 => 
              array (
                'attribs' => 
                array (
                  'name' => 'DependencyDB.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              8 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Dependency2.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@PEAR-VER@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              9 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Downloader.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              10 => 
              array (
                'attribs' => 
                array (
                  'name' => 'ErrorStack.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              11 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Exception.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              12 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Frontend.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              13 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Installer.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              14 => 
              array (
                'attribs' => 
                array (
                  'name' => 'PackageFile.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@PEAR-VER@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              15 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Packager.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              16 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Registry.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              17 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Remote.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              18 => 
              array (
                'attribs' => 
                array (
                  'name' => 'REST.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              19 => 
              array (
                'attribs' => 
                array (
                  'name' => 'RunTest.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              20 => 
              array (
                'attribs' => 
                array (
                  'name' => 'Validate.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
              21 => 
              array (
                'attribs' => 
                array (
                  'name' => 'XMLParser.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  'attribs' => 
                  array (
                    'from' => '@package_version@',
                    'to' => 'version',
                    'type' => 'package-info',
                  ),
                ),
              ),
            ),
          ),
          2 => 
          array (
            'attribs' => 
            array (
              'name' => 'scripts',
              'baseinstalldir' => '/',
            ),
            'file' => 
            array (
              0 => 
              array (
                'attribs' => 
                array (
                  'name' => 'pear.bat',
                  'role' => 'script',
                ),
                'tasks:replace' => 
                array (
                  0 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@bin_dir@',
                      'to' => 'bin_dir',
                      'type' => 'pear-config',
                    ),
                  ),
                  1 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@php_bin@',
                      'to' => 'php_bin',
                      'type' => 'pear-config',
                    ),
                  ),
                  2 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@include_path@',
                      'to' => 'php_dir',
                      'type' => 'pear-config',
                    ),
                  ),
                ),
                'tasks:windowseol' => '',
              ),
              1 => 
              array (
                'attribs' => 
                array (
                  'name' => 'peardev.bat',
                  'role' => 'script',
                ),
                'tasks:replace' => 
                array (
                  0 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@bin_dir@',
                      'to' => 'bin_dir',
                      'type' => 'pear-config',
                    ),
                  ),
                  1 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@php_bin@',
                      'to' => 'php_bin',
                      'type' => 'pear-config',
                    ),
                  ),
                  2 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@include_path@',
                      'to' => 'php_dir',
                      'type' => 'pear-config',
                    ),
                  ),
                ),
                'tasks:windowseol' => '',
              ),
              2 => 
              array (
                'attribs' => 
                array (
                  'name' => 'pecl.bat',
                  'role' => 'script',
                ),
                'tasks:replace' => 
                array (
                  0 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@bin_dir@',
                      'to' => 'bin_dir',
                      'type' => 'pear-config',
                    ),
                  ),
                  1 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@php_bin@',
                      'to' => 'php_bin',
                      'type' => 'pear-config',
                    ),
                  ),
                  2 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@include_path@',
                      'to' => 'php_dir',
                      'type' => 'pear-config',
                    ),
                  ),
                ),
                'tasks:windowseol' => '',
              ),
              3 => 
              array (
                'attribs' => 
                array (
                  'name' => 'pear.sh',
                  'role' => 'script',
                ),
                'tasks:replace' => 
                array (
                  0 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@php_bin@',
                      'to' => 'php_bin',
                      'type' => 'pear-config',
                    ),
                  ),
                  1 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@php_dir@',
                      'to' => 'php_dir',
                      'type' => 'pear-config',
                    ),
                  ),
                  2 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@pear_version@',
                      'to' => 'version',
                      'type' => 'package-info',
                    ),
                  ),
                  3 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@include_path@',
                      'to' => 'php_dir',
                      'type' => 'pear-config',
                    ),
                  ),
                ),
                'tasks:unixeol' => '',
              ),
              4 => 
              array (
                'attribs' => 
                array (
                  'name' => 'peardev.sh',
                  'role' => 'script',
                ),
                'tasks:replace' => 
                array (
                  0 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@php_bin@',
                      'to' => 'php_bin',
                      'type' => 'pear-config',
                    ),
                  ),
                  1 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@php_dir@',
                      'to' => 'php_dir',
                      'type' => 'pear-config',
                    ),
                  ),
                  2 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@pear_version@',
                      'to' => 'version',
                      'type' => 'package-info',
                    ),
                  ),
                  3 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@include_path@',
                      'to' => 'php_dir',
                      'type' => 'pear-config',
                    ),
                  ),
                ),
                'tasks:unixeol' => '',
              ),
              5 => 
              array (
                'attribs' => 
                array (
                  'name' => 'pecl.sh',
                  'role' => 'script',
                ),
                'tasks:replace' => 
                array (
                  0 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@php_bin@',
                      'to' => 'php_bin',
                      'type' => 'pear-config',
                    ),
                  ),
                  1 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@php_dir@',
                      'to' => 'php_dir',
                      'type' => 'pear-config',
                    ),
                  ),
                  2 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@pear_version@',
                      'to' => 'version',
                      'type' => 'package-info',
                    ),
                  ),
                  3 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@include_path@',
                      'to' => 'php_dir',
                      'type' => 'pear-config',
                    ),
                  ),
                ),
                'tasks:unixeol' => '',
              ),
              6 => 
              array (
                'attribs' => 
                array (
                  'name' => 'pearcmd.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  0 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@php_bin@',
                      'to' => 'php_bin',
                      'type' => 'pear-config',
                    ),
                  ),
                  1 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@php_dir@',
                      'to' => 'php_dir',
                      'type' => 'pear-config',
                    ),
                  ),
                  2 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@pear_version@',
                      'to' => 'version',
                      'type' => 'package-info',
                    ),
                  ),
                  3 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@include_path@',
                      'to' => 'php_dir',
                      'type' => 'pear-config',
                    ),
                  ),
                ),
              ),
              7 => 
              array (
                'attribs' => 
                array (
                  'name' => 'peclcmd.php',
                  'role' => 'php',
                ),
                'tasks:replace' => 
                array (
                  0 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@php_bin@',
                      'to' => 'php_bin',
                      'type' => 'pear-config',
                    ),
                  ),
                  1 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@php_dir@',
                      'to' => 'php_dir',
                      'type' => 'pear-config',
                    ),
                  ),
                  2 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@pear_version@',
                      'to' => 'version',
                      'type' => 'package-info',
                    ),
                  ),
                  3 => 
                  array (
                    'attribs' => 
                    array (
                      'from' => '@include_path@',
                      'to' => 'php_dir',
                      'type' => 'pear-config',
                    ),
                  ),
                ),
              ),
            ),
          ),
        ),
        'file' => 
        array (
          0 => 
          array (
            'attribs' => 
            array (
              'name' => 'INSTALL',
              'role' => 'doc',
            ),
          ),
          1 => 
          array (
            'attribs' => 
            array (
              'name' => 'package.dtd',
              'role' => 'data',
            ),
          ),
          2 => 
          array (
            'attribs' => 
            array (
              'name' => 'PEAR.php',
              'role' => 'php',
            ),
            'tasks:replace' => 
            array (
              'attribs' => 
              array (
                'from' => '@package_version@',
                'to' => 'version',
                'type' => 'package-info',
              ),
            ),
          ),
          3 => 
          array (
            'attribs' => 
            array (
              'name' => 'README',
              'role' => 'doc',
            ),
          ),
          4 => 
          array (
            'attribs' => 
            array (
              'name' => 'System.php',
              'role' => 'php',
            ),
            'tasks:replace' => 
            array (
              'attribs' => 
              array (
                'from' => '@package_version@',
                'to' => 'version',
                'type' => 'package-info',
              ),
            ),
          ),
          5 => 
          array (
            'attribs' => 
            array (
              'name' => 'template.spec',
              'role' => 'data',
            ),
          ),
        ),
      ),
    ),
    'dependencies' => 
    array (
      'required' => 
      array (
        'php' => 
        array (
          'min' => '4.3.0',
        ),
        'pearinstaller' => 
        array (
          'min' => '1.4.3',
        ),
        'package' => 
        array (
          0 => 
          array (
            'name' => 'Archive_Tar',
            'channel' => 'pear.php.net',
            'min' => '1.1',
            'recommended' => '1.3.2',
            'exclude' => '1.3.0',
          ),
          1 => 
          array (
            'name' => 'Structures_Graph',
            'channel' => 'pear.php.net',
            'min' => '1.0.2',
            'recommended' => '1.0.2',
          ),
          2 => 
          array (
            'name' => 'Console_Getopt',
            'channel' => 'pear.php.net',
            'min' => '1.2',
            'recommended' => '1.2.3',
          ),
          3 => 
          array (
            'name' => 'PEAR_Frontend_Web',
            'channel' => 'pear.php.net',
            'max' => '0.4',
            'conflicts' => '',
          ),
          4 => 
          array (
            'name' => 'PEAR_Frontend_Gtk',
            'channel' => 'pear.php.net',
            'max' => '0.4.0',
            'exclude' => '0.4.0',
            'conflicts' => '',
          ),
        ),
        'extension' => 
        array (
          0 => 
          array (
            'name' => 'xml',
          ),
          1 => 
          array (
            'name' => 'pcre',
          ),
        ),
      ),
      'optional' => 
      array (
        'package' => 
        array (
          'name' => 'XML_RPC',
          'channel' => 'pear.php.net',
          'min' => '1.4.0',
        ),
      ),
      'group' => 
      array (
        0 => 
        array (
          'attribs' => 
          array (
            'name' => 'webinstaller',
            'hint' => 'PEAR\'s web-based installer',
          ),
          'package' => 
          array (
            'name' => 'PEAR_Frontend_Web',
            'channel' => 'pear.php.net',
            'min' => '0.5.1',
          ),
        ),
        1 => 
        array (
          'attribs' => 
          array (
            'name' => 'gtkinstaller',
            'hint' => 'PEAR\'s PHP-GTK-based installer',
          ),
          'package' => 
          array (
            'name' => 'PEAR_Frontend_Gtk',
            'channel' => 'pear.php.net',
            'min' => '0.4.0',
          ),
        ),
        2 => 
        array (
          'attribs' => 
          array (
            'name' => 'gtk2installer',
            'hint' => 'PEAR\'s PHP-GTK2-based installer',
          ),
          'package' => 
          array (
            'name' => 'PEAR_Frontend_Gtk2',
            'channel' => 'pear.php.net',
          ),
        ),
      ),
    ),
    'phprelease' => 
    array (
      0 => 
      array (
        'installconditions' => 
        array (
          'os' => 
          array (
            'name' => 'windows',
          ),
        ),
        'filelist' => 
        array (
          'install' => 
          array (
            0 => 
            array (
              'attribs' => 
              array (
                'as' => 'pear.bat',
                'name' => 'scripts/pear.bat',
              ),
            ),
            1 => 
            array (
              'attribs' => 
              array (
                'as' => 'peardev.bat',
                'name' => 'scripts/peardev.bat',
              ),
            ),
            2 => 
            array (
              'attribs' => 
              array (
                'as' => 'pecl.bat',
                'name' => 'scripts/pecl.bat',
              ),
            ),
            3 => 
            array (
              'attribs' => 
              array (
                'as' => 'pearcmd.php',
                'name' => 'scripts/pearcmd.php',
              ),
            ),
            4 => 
            array (
              'attribs' => 
              array (
                'as' => 'peclcmd.php',
                'name' => 'scripts/peclcmd.php',
              ),
            ),
          ),
          'ignore' => 
          array (
            0 => 
            array (
              'attribs' => 
              array (
                'name' => 'scripts/peardev.sh',
              ),
            ),
            1 => 
            array (
              'attribs' => 
              array (
                'name' => 'scripts/pear.sh',
              ),
            ),
            2 => 
            array (
              'attribs' => 
              array (
                'name' => 'scripts/pecl.sh',
              ),
            ),
          ),
        ),
      ),
      1 => 
      array (
        'filelist' => 
        array (
          'install' => 
          array (
            0 => 
            array (
              'attribs' => 
              array (
                'as' => 'pear',
                'name' => 'scripts/pear.sh',
              ),
            ),
            1 => 
            array (
              'attribs' => 
              array (
                'as' => 'peardev',
                'name' => 'scripts/peardev.sh',
              ),
            ),
            2 => 
            array (
              'attribs' => 
              array (
                'as' => 'pecl',
                'name' => 'scripts/pecl.sh',
              ),
            ),
            3 => 
            array (
              'attribs' => 
              array (
                'as' => 'pearcmd.php',
                'name' => 'scripts/pearcmd.php',
              ),
            ),
            4 => 
            array (
              'attribs' => 
              array (
                'as' => 'peclcmd.php',
                'name' => 'scripts/peclcmd.php',
              ),
            ),
          ),
          'ignore' => 
          array (
            0 => 
            array (
              'attribs' => 
              array (
                'name' => 'scripts/pear.bat',
              ),
            ),
            1 => 
            array (
              'attribs' => 
              array (
                'name' => 'scripts/peardev.bat',
              ),
            ),
            2 => 
            array (
              'attribs' => 
              array (
                'name' => 'scripts/pecl.bat',
              ),
            ),
          ),
        ),
      ),
    ),
    'changelog' => 
    array (
      'release' => 
      array (
        'version' => 
        array (
          'release' => '1.6.2',
          'api' => '1.6.0',
        ),
        'stability' => 
        array (
          'release' => 'stable',
          'api' => 'stable',
        ),
        'date' => '2007-09-09',
        'license' => 
        array (
          'attribs' => 
          array (
            'uri' => 'http://www.php.net/license',
          ),
          '_content' => 'PHP License',
        ),
        'notes' => '
  Minor bugfix release
  * fix Bug #11420: warning on pecl (un)install with --register-only option [cellog]
  * fix Bug #11481: PEAR_PackageFile_Parser_v1 skips single-char directories [pmjones]
  * fix Bug #11517: Error : download directory "/var/cache/php-pear"
    is not writeable. [remicollet]
  * fix Bug #11616: Incorrect equality operator used when comparing md5 check sums [robham]
  * fix Bug #11642: PEAR fails to authenticate when downloading deps from non-default
    channels [timj]
  * fix Bug #11657: Installer generate bad "dirtree" using INSTALL_ROOT [remicollet]
  * fix Bug #11678: Registry.php getChannel() deadlocks [cellog]
  * fix Bug #11703: pear convert and package.xml with optional dependencies fails [cellog]
  * fix Bug #11754: Error at upgrade-all command run [cellog]
  * fix Bug #11861: uninstall of package did not delete directory created during install
    of package [cellog]
  * fix Bug #11862: Notice: Array to string conversion in PEAR/PackageFile.php on line 433
    [cellog]
  * fix Bug #11883: run-tests -u -p SomePackage should run the topmost
    "AllTests.php" file [cellog]
  * fix Bug #11936: run-tests fails to preserve SYSTEMROOT environment variable [cellog]
   ',
      ),
    ),
  ),
), $ret->getThingy(), 'test');
?>
===DONE===
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
$parser = new PEAR2_Pyrus_PackageFile_Parser_v2;
class Mockv2 extends PEAR2_Pyrus_PackageFile_v2
{
    public $arr;
    public $filelist;
    public $baseinstalls;
    public $packagefile;

    function setFilelist($list)
    {
        $this->filelist = $list;
    }

    function setBaseInstallDirs($dirs)
    {
        $this->baseinstalls = $dirs;
    }

    function setPackageFile($file)
    {
        $this->packagefile = $file;
    }

    function getThingy()
    {
        return array(
            'filelist' => $this->filelist,
            'baseinstalls' => $this->baseinstalls,
            'packagefile' => $this->packagefile,
            'packageinfo' => $this->packageInfo);
    }
}<?xml version="1.0" encoding="UTF-8"?>
<package version="2.1" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.1     http://pear.php.net/dtd/package-2.1.xsd">
 <name>PEAR2_Pyrus</name>
 <channel>pear2.php.net</channel>
 <summary>Pyrus is the package manager and installer for PHP 5.2 or newer
</summary>
 <description>
Pyrus provides the means to install and manage installations for
packages built using package.xml version 2.0 or newer.  Pyrus is
redesigned from the ground up for PHP 5.2 or newer, and provides
significant improvements over the older PEAR Installer.

To use Pyrus, in this development series of releases, you need to
instantiate a simple script that creates a package and installs it:

&lt;?php
// use full path if include_path is not set up
include 'PEAR2/Autoload.php';
require_once 'Net/URL2.php'; // PEAR package needed for PEAR2_HTTP_Request dep
$config = PEAR2_Pyrus_Config::singleton('/where/to/install');
// this can be a url to a remote package, a local .tgz, .zip or package.xml
$p = new PEAR2_Pyrus_Package('thingtoinstall');
try {
    PEAR2_Pyrus_Installer::begin();
    PEAR2_Pyrus_Installer::prepare($p);
    PEAR2_Pyrus_Installer::commit();
} catch (Exception $e) {
    PEAR2_Pyrus_Installer::rollback();
    echo $e;
}
?&gt;</description>
 <lead>
  <name>Gregory Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2007-10-06</date>
 <version>
  <release>2.0.0a1</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>alpha</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>Initial development release, no frontend is included</notes>
 <contents>
  <dir name="/">
   <dir name="data" baseinstalldir="/">
    <file role="data" name="channel-1.0.xsd"/>
    <file role="data" name="package-2.0.xsd"/>
    <file role="data" name="package-2.1.xsd"/>
   </dir>
   <dir name="src" baseinstalldir="PEAR2">
    <dir name="Pyrus">
     <dir name="Channel">
      <file role="php" name="Base.php"/>
      <file role="php" name="Exception.php"/>
      <file role="php" name="IMirror.php"/>
      <file role="php" name="Mirror.php"/>
     </dir>
     <dir name="ChannelRegistry">
      <dir name="Channel">
       <file role="php" name="Sqlite.php"/>
       <file role="php" name="Xml.php"/>
      </dir>
      <dir name="Mirror">
       <file role="php" name="Sqlite.php"/>
       <file role="php" name="Xml.php"/>
      </dir>
      <file role="php" name="Base.php"/>
      <file role="php" name="Exception.php"/>
      <file role="php" name="Sqlite.php"/>
      <file role="php" name="Xml.php"/>
     </dir>
     <dir name="Config">
      <file role="php" name="Exception.php"/>
     </dir>
     <dir name="Dependency">
      <file role="php" name="Exception.php"/>
      <file role="php" name="Validator.php"/>
     </dir>
     <dir name="DirectedGraph">
      <file role="php" name="Exception.php"/>
      <file role="php" name="Vertex.php"/>
     </dir>
     <dir name="FileTransactions">
      <file role="php" name="Installedas.php"/>
      <file role="php" name="Rename.php"/>
      <file role="php" name="Rmdir.php"/>
     </dir>
     <dir name="Installer">
      <dir name="Role">
       <file role="php" name="Common.php"/>
       <file role="php" name="Data.php"/>
       <file role="php" name="Data.xml"/>
       <file role="php" name="Doc.php"/>
       <file role="php" name="Doc.xml"/>
       <file role="php" name="Exception.php"/>
       <file role="php" name="Ext.php"/>
       <file role="php" name="Ext.xml"/>
       <file role="php" name="Php.php"/>
       <file role="php" name="Php.xml"/>
       <file role="php" name="Script.php"/>
       <file role="php" name="Script.xml"/>
       <file role="php" name="Src.php"/>
       <file role="php" name="Src.xml"/>
       <file role="php" name="Test.php"/>
       <file role="php" name="Test.xml"/>
       <file role="php" name="Www.php"/>
       <file role="php" name="Www.xml"/>
      </dir>
      <file role="php" name="Exception.php"/>
      <file role="php" name="Role.php"/>
     </dir>
     <dir name="Package">
      <dir name="Creator">
       <file role="php" name="Exception.php"/>
       <file role="php" name="TaskIterator.php"/>
      </dir>
      <dir name="Phar">
       <file role="php" name="Exception.php"/>
      </dir>
      <dir name="Tar">
       <file role="php" name="Exception.php"/>
      </dir>
      <dir name="Zip">
       <file role="php" name="Exception.php"/>
      </dir>
      <file role="php" name="Base.php"/>
      <file role="php" name="Creator.php"/>
      <file role="php" name="Dependency.php"/>
      <file role="php" name="Exception.php"/>
      <file role="php" name="ICreator.php"/>
      <file role="php" name="InstalledException.php"/>
      <file role="php" name="Phar.php"/>
      <file role="php" name="Remote.php"/>
      <file role="php" name="Tar.php"/>
      <file role="php" name="Xml.php"/>
      <file role="php" name="Zip.php"/>
     </dir>
     <dir name="PackageFile">
      <dir name="Parser">
       <file role="php" name="v2.php"/>
      </dir>
      <dir name="v2">
       <dir name="Compatible">
        <file role="php" name="Exception.php"/>
       </dir>
       <dir name="Dependencies">
        <file role="php" name="Exception.php"/>
       </dir>
       <dir name="Developer">
        <file role="php" name="Exception.php"/>
       </dir>
       <dir name="Files">
        <file role="php" name="Exception.php"/>
       </dir>
       <dir name="Release">
        <file role="php" name="Exception.php"/>
       </dir>
       <file role="php" name="Compatible.php"/>
       <file role="php" name="Dependencies.php"/>
       <file role="php" name="Developer.php"/>
       <file role="php" name="Files.php"/>
       <file role="php" name="Release.php"/>
       <file role="php" name="Remote.php"/>
       <file role="php" name="Validator.php"/>
      </dir>
      <dir name="v2Iterator">
       <file role="php" name="File.php"/>
       <file role="php" name="FileAttribsFilter.php"/>
       <file role="php" name="FileContents.php"/>
       <file role="php" name="FileContentsMulti.php"/>
       <file role="php" name="FileInstallationFilter.php"/>
       <file role="php" name="FileTag.php"/>
       <file role="php" name="PackagingIterator.php"/>
      </dir>
      <file role="php" name="Exception.php"/>
      <file role="php" name="IValidator.php"/>
      <file role="php" name="v2.php"/>
     </dir>
     <dir name="Registry">
      <dir name="Sqlite">
       <dir name="Channel">
        <file role="php" name="Mirror.php"/>
        <file role="php" name="Mirrors.php"/>
       </dir>
       <file role="php" name="Creator.php"/>
       <file role="php" name="Package.php"/>
      </dir>
      <file role="php" name="Base.php"/>
      <file role="php" name="Channel.php"/>
      <file role="php" name="Config.php"/>
      <file role="php" name="Exception.php"/>
      <file role="php" name="Package.php"/>
      <file role="php" name="Sqlite.php"/>
      <file role="php" name="Xml.php"/>
     </dir>
     <dir name="REST">
      <file role="php" name="10.php"/>
      <file role="php" name="11.php"/>
      <file role="php" name="13.php"/>
      <file role="php" name="Exception.php"/>
      <file role="php" name="HTTPException.php"/>
     </dir>
     <dir name="ScriptFrontend">
      <file role="php" name="Commands.php"/>
     </dir>
     <dir name="Task">
      <dir name="Postinstallscript">
       <file role="php" name="rw.php"/>
      </dir>
      <dir name="Replace">
       <file role="php" name="rw.php"/>
      </dir>
      <dir name="Unixeol">
       <file role="php" name="rw.php"/>
      </dir>
      <dir name="Windowseol">
       <file role="php" name="rw.php"/>
      </dir>
      <file role="php" name="Common.php"/>
      <file role="php" name="Exception.php"/>
      <file role="php" name="Postinstallscript.php"/>
      <file role="php" name="Replace.php"/>
      <file role="php" name="Unixeol.php"/>
      <file role="php" name="Windowseol.php"/>
     </dir>
     <dir name="Validate">
      <file role="php" name="Exception.php"/>
     </dir>
     <dir name="Validator">
      <file role="php" name="PECL.php"/>
     </dir>
     <dir name="XMLParser">
      <file role="php" name="Exception.php"/>
     </dir>
     <dir name="XMLWriter">
      <file role="php" name="Exception.php"/>
     </dir>
     <file role="php" name="Channel.php"/>
     <file role="php" name="ChannelRegistry.php"/>
     <file role="php" name="Config.php"/>
     <file role="php" name="DirectedGraph.php"/>
     <file role="php" name="Downloader.php"/>
     <file role="php" name="Exception.php"/>
     <file role="php" name="FileTransactions.php"/>
     <file role="php" name="IChannel.php"/>
     <file role="php" name="IChannelRegistry.php"/>
     <file role="php" name="IFileTransaction.php"/>
     <file role="php" name="Installer.php"/>
     <file role="php" name="IPackage.php"/>
     <file role="php" name="IRegistry.php"/>
     <file role="php" name="Log.php"/>
     <file role="php" name="OSGuess.php"/>
     <file role="php" name="Package.php"/>
     <file role="php" name="PackageFile.php"/>
     <file role="php" name="Registry.php"/>
     <file role="php" name="REST.php"/>
     <file role="php" name="Validate.php"/>
     <file role="php" name="XMLParser.php"/>
     <file role="php" name="XMLWriter.php"/>
    </dir>
    <file role="php" name="Pyrus.php"/>
   </dir>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease></phprelease>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<package version="2.0" xmlns="http://pear.php.net/dtd/package-2.0" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0
http://pear.php.net/dtd/tasks-1.0.xsd
http://pear.php.net/dtd/package-2.0
http://pear.php.net/dtd/package-2.0.xsd">
 <name>PEAR</name>
 <channel>pear.php.net</channel>
 <summary>PEAR Base System</summary>
 <description>The PEAR package contains:
 * the PEAR installer, for creating, distributing
   and installing packages
 * the PEAR_Exception PHP5 error handling mechanism
 * the PEAR_ErrorStack advanced error handling mechanism
 * the PEAR_Error error handling mechanism
 * the OS_Guess class for retrieving info about the OS
   where PHP is running on
 * the System class for quick handling of common operations
   with files and directories
 * the PEAR base class

  Features in a nutshell:
  * full support for channels
  * pre-download dependency validation
  * new package.xml 2.0 format allows tremendous flexibility while maintaining BC
  * support for optional dependency groups and limited support for sub-packaging
  * robust dependency support
  * full dependency validation on uninstall
  * remote install for hosts with only ftp access - no more problems with
    restricted host installation
  * full support for mirroring
  * support for bundling several packages into a single tarball
  * support for static dependencies on a url-based package
  * support for custom file roles and installation tasks
 </description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <lead>
  <name>Pierre-Alain Joye</name>
  <user>pajoye</user>
  <email>pierre@php.net</email>
  <active>no</active>
 </lead>
 <lead>
  <name>Stig Bakken</name>
  <user>ssb</user>
  <email>stig@php.net</email>
  <active>no</active>
 </lead>
 <lead>
  <name>Tomas V.V.Cox</name>
  <user>cox</user>
  <email>cox@idecnet.com</email>
  <active>no</active>
 </lead>
 <developer>
  <name>Helgi Thormar</name>
  <user>dufuz</user>
  <email>dufuz@php.net</email>
  <active>yes</active>
 </developer>
 <developer>
  <name>Tias Guns</name>
  <user>tias</user>
  <email>tias@php.net</email>
  <active>yes</active>
 </developer>
 <helper>
  <name>Tim Jackson</name>
  <user>timj</user>
  <email>timj@php.net</email>
  <active>no</active>
 </helper>
 <helper>
  <name>Bertrand Gugger</name>
  <user>toggg</user>
  <email>toggg@php.net</email>
  <active>no</active>
 </helper>
 <helper>
  <name>Martin Jansen</name>
  <user>mj</user>
  <email>mj@php.net</email>
  <active>no</active>
 </helper>
 <date>2007-10-01</date>
 <version>
  <release>1.7.0</release>
  <api>1.7.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>stable</api>
 </stability>
 <license uri="http://www.php.net/license">PHP License</license>
 <notes>
  * implement Request #11964: introduce www role, www_dir config variable [cellog]
 </notes>
 <contents>
  <dir name="/">
   <dir name="OS">
    <file name="Guess.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
   </dir> <!-- /OS -->
   <dir name="PEAR">
    <dir name="ChannelFile">
     <file name="Parser.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
    </dir> <!-- /PEAR/ChannelFile -->
    <dir name="Command">
     <file name="Auth.xml" role="php"/>
     <file name="Auth.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="Build.xml" role="php"/>
     <file name="Build.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="Channels.xml" role="php"/>
     <file name="Channels.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="Common.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="Config.xml" role="php"/>
     <file name="Config.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="Install.xml" role="php"/>
     <file name="Install.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="Mirror.xml" role="php"/>
     <file name="Mirror.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="Package.xml" role="php"/>
     <file name="Package.php" role="php">
      <tasks:replace from="@DATA-DIR@" to="data_dir" type="pear-config" />
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="Pickle.xml" role="php"/>
     <file name="Pickle.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="Registry.xml" role="php"/>
     <file name="Registry.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="Remote.xml" role="php"/>
     <file name="Remote.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="Test.xml" role="php"/>
     <file name="Test.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
    </dir> <!-- /PEAR/Command -->
    <dir name="Downloader">
     <file name="Package.php" role="php">
      <tasks:replace from="@PEAR-VER@" to="version" type="package-info" />
     </file>
    </dir> <!-- /PEAR/Downloader -->
    <dir name="Frontend">
     <file name="CLI.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
    </dir> <!-- /PEAR/Frontend -->
    <dir name="Installer">
     <dir name="Role">
      <file name="Common.php" role="php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
      <file name="Data.xml" role="php"/>
      <file name="Data.php" role="php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
      <file name="Doc.xml" role="php"/>
      <file name="Doc.php" role="php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
      <file name="Ext.xml" role="php"/>
      <file name="Ext.php" role="php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
      <file name="Php.xml" role="php"/>
      <file name="Php.php" role="php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
      <file name="Script.xml" role="php"/>
      <file name="Script.php" role="php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
      <file name="Src.xml" role="php"/>
      <file name="Src.php" role="php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
      <file name="Test.xml" role="php"/>
      <file name="Test.php" role="php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
      <file name="Www.xml" role="php"/>
      <file name="Www.php" role="php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
     </dir> <!-- /PEAR/Installer/Role -->
     <file name="Role.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
    </dir> <!-- /PEAR/Installer -->
    <dir name="PackageFile">
     <dir name="Generator">
      <file name="v1.php" role="php">
       <tasks:replace from="@PEAR-VER@" to="version" type="package-info" />
      </file>
      <file name="v2.php" role="php">
       <tasks:replace from="@PEAR-VER@" to="version" type="package-info" />
      </file>
     </dir> <!-- /PEAR/PackageFile/Generator -->
     <dir name="Parser">
      <file name="v1.php" role="php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
      <file name="v2.php" role="php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
     </dir> <!-- /PEAR/PackageFile/Parser -->
     <dir name="v2">
      <file role="php" name="rw.php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
      <file role="php" name="Validator.php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
     </dir> <!-- /PEAR/PackageFile/v2 -->
     <file name="v1.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="v2.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
    </dir> <!-- /PEAR/PackageFile -->
    <dir name="REST">
     <file name="10.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="11.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="13.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
    </dir> <!-- /PEAR/REST -->
    <dir name="Task">
     <dir name="Postinstallscript">
      <file name="rw.php" role="php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
     </dir> <!-- /PEAR/Task/Postinstallscript -->
     <dir name="Replace">
      <file name="rw.php" role="php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
     </dir> <!-- /PEAR/Task/Replace -->
     <dir name="Unixeol">
      <file name="rw.php" role="php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
     </dir> <!-- /PEAR/Task/Unixeol -->
     <dir name="Windowseol">
      <file name="rw.php" role="php">
       <tasks:replace from="@package_version@" to="version" type="package-info" />
      </file>
     </dir> <!-- /PEAR/Task/Windowseol -->
     <file name="Common.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="Postinstallscript.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="Replace.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="Unixeol.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
     <file name="Windowseol.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
    </dir> <!-- /PEAR/Task -->
    <dir name="Validator">
     <file name="PECL.php" role="php">
      <tasks:replace from="@package_version@" to="version" type="package-info" />
     </file>
    </dir> <!-- /PEAR/Validator -->
    <file name="Autoloader.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="Builder.php" role="php">
     <tasks:replace from="@PEAR-VER@" to="version" type="package-info"/>
    </file>
    <file name="ChannelFile.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="Command.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="Common.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="Config.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="Dependency.php" role="php" />
    <file name="DependencyDB.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="Dependency2.php" role="php">
     <tasks:replace from="@PEAR-VER@" to="version" type="package-info"/>
    </file>
    <file name="Downloader.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="ErrorStack.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="Exception.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="Frontend.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="Installer.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="PackageFile.php" role="php">
     <tasks:replace from="@PEAR-VER@" to="version" type="package-info" />
    </file>
    <file name="Packager.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="Registry.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="Remote.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="REST.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="RunTest.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="Validate.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
    <file name="XMLParser.php" role="php">
     <tasks:replace from="@package_version@" to="version" type="package-info" />
    </file>
   </dir> <!-- /PEAR -->
   <dir name="scripts" baseinstalldir="/">
    <file name="pear.bat" role="script">
     <tasks:replace from="@bin_dir@" to="bin_dir" type="pear-config" />
     <tasks:replace from="@php_bin@" to="php_bin" type="pear-config" />
     <tasks:replace from="@include_path@" to="php_dir" type="pear-config" />
     <tasks:windowseol/>
    </file>
    <file name="peardev.bat" role="script">
     <tasks:replace from="@bin_dir@" to="bin_dir" type="pear-config" />
     <tasks:replace from="@php_bin@" to="php_bin" type="pear-config" />
     <tasks:replace from="@include_path@" to="php_dir" type="pear-config" />
     <tasks:windowseol/>
    </file>
    <file name="pecl.bat" role="script">
     <tasks:replace from="@bin_dir@" to="bin_dir" type="pear-config" />
     <tasks:replace from="@php_bin@" to="php_bin" type="pear-config" />
     <tasks:replace from="@include_path@" to="php_dir" type="pear-config" />
     <tasks:windowseol/>
    </file>
    <file name="pear.sh" role="script">
     <tasks:replace from="@php_bin@" to="php_bin" type="pear-config" />
     <tasks:replace from="@php_dir@" to="php_dir" type="pear-config" />
     <tasks:replace from="@pear_version@" to="version" type="package-info" />
     <tasks:replace from="@include_path@" to="php_dir" type="pear-config" />
     <tasks:unixeol/>
    </file>
    <file name="peardev.sh" role="script">
     <tasks:replace from="@php_bin@" to="php_bin" type="pear-config" />
     <tasks:replace from="@php_dir@" to="php_dir" type="pear-config" />
     <tasks:replace from="@pear_version@" to="version" type="package-info" />
     <tasks:replace from="@include_path@" to="php_dir" type="pear-config" />
     <tasks:unixeol/>
    </file>
    <file name="pecl.sh" role="script">
     <tasks:replace from="@php_bin@" to="php_bin" type="pear-config" />
     <tasks:replace from="@php_dir@" to="php_dir" type="pear-config" />
     <tasks:replace from="@pear_version@" to="version" type="package-info" />
     <tasks:replace from="@include_path@" to="php_dir" type="pear-config" />
     <tasks:unixeol/>
    </file>
    <file name="pearcmd.php" role="php">
     <tasks:replace from="@php_bin@" to="php_bin" type="pear-config" />
     <tasks:replace from="@php_dir@" to="php_dir" type="pear-config" />
     <tasks:replace from="@pear_version@" to="version" type="package-info" />
     <tasks:replace from="@include_path@" to="php_dir" type="pear-config" />
    </file>
    <file name="peclcmd.php" role="php">
     <tasks:replace from="@php_bin@" to="php_bin" type="pear-config" />
     <tasks:replace from="@php_dir@" to="php_dir" type="pear-config" />
     <tasks:replace from="@pear_version@" to="version" type="package-info" />
     <tasks:replace from="@include_path@" to="php_dir" type="pear-config" />
    </file>
   </dir> <!-- /scripts -->
   <file name="INSTALL" role="doc" />
   <file name="package.dtd" role="data" />
   <file name="PEAR.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file name="README" role="doc" />
   <file name="System.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file name="template.spec" role="data" />
  </dir> <!-- / -->
 </contents>
 <dependencies>
  <required>
   <php>
    <min>4.3.0</min>
   </php>
   <pearinstaller>
    <min>1.4.3</min>
   </pearinstaller>
   <package>
    <name>Archive_Tar</name>
    <channel>pear.php.net</channel>
    <min>1.1</min>
    <recommended>1.3.2</recommended>
    <exclude>1.3.0</exclude>
   </package>
   <package>
    <name>Structures_Graph</name>
    <channel>pear.php.net</channel>
    <min>1.0.2</min>
    <recommended>1.0.2</recommended>
   </package>
   <package>
    <name>Console_Getopt</name>
    <channel>pear.php.net</channel>
    <min>1.2</min>
    <recommended>1.2.3</recommended>
   </package>
   <package>
    <name>PEAR_Frontend_Web</name>
    <channel>pear.php.net</channel>
    <max>0.4</max>
    <conflicts/>
   </package>
   <package>
    <name>PEAR_Frontend_Gtk</name>
    <channel>pear.php.net</channel>
    <max>0.4.0</max>
    <exclude>0.4.0</exclude>
    <conflicts/>
   </package>
   <extension>
    <name>xml</name>
   </extension>
   <extension>
    <name>pcre</name>
   </extension>
  </required>
  <optional>
   <package>
    <name>XML_RPC</name>
    <channel>pear.php.net</channel>
    <min>1.4.0</min>
   </package>
  </optional>
<!--  <group name="remoteinstall" hint="adds the ability to install packages to a remote ftp server">
   <subpackage>
    <name>PEAR_RemoteInstaller</name>
    <channel>pear.php.net</channel>
    <min>0.1.0</min>
    <recommended>0.1.0</recommended>
   </subpackage>
  </group> -->
  <group name="webinstaller" hint="PEAR's web-based installer">
   <package>
    <name>PEAR_Frontend_Web</name>
    <channel>pear.php.net</channel>
    <min>0.5.1</min>
   </package>
  </group>
  <group name="gtkinstaller" hint="PEAR's PHP-GTK-based installer">
   <package>
    <name>PEAR_Frontend_Gtk</name>
    <channel>pear.php.net</channel>
    <min>0.4.0</min>
   </package>
  </group>
  <group name="gtk2installer" hint="PEAR's PHP-GTK2-based installer">
   <package>
    <name>PEAR_Frontend_Gtk2</name>
    <channel>pear.php.net</channel>
   </package>
  </group>
 </dependencies>
 <phprelease>
  <installconditions>
   <os>
    <name>windows</name>
   </os>
  </installconditions>
  <filelist>
   <install as="pear.bat" name="scripts/pear.bat" />
   <install as="peardev.bat" name="scripts/peardev.bat" />
   <install as="pecl.bat" name="scripts/pecl.bat" />
   <install as="pearcmd.php" name="scripts/pearcmd.php" />
   <install as="peclcmd.php" name="scripts/peclcmd.php" />
   <ignore name="scripts/peardev.sh" />
   <ignore name="scripts/pear.sh" />
   <ignore name="scripts/pecl.sh" />
  </filelist>
 </phprelease>
 <phprelease>
  <filelist>
   <install as="pear" name="scripts/pear.sh" />
   <install as="peardev" name="scripts/peardev.sh" />
   <install as="pecl" name="scripts/pecl.sh" />
   <install as="pearcmd.php" name="scripts/pearcmd.php" />
   <install as="peclcmd.php" name="scripts/peclcmd.php" />
   <ignore name="scripts/pear.bat" />
   <ignore name="scripts/peardev.bat" />
   <ignore name="scripts/pecl.bat" />
  </filelist>
 </phprelease>
 <changelog>
  <release>
   <version>
    <release>1.6.2</release>
    <api>1.6.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2007-09-09</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>
  Minor bugfix release
  * fix Bug #11420: warning on pecl (un)install with --register-only option [cellog]
  * fix Bug #11481: PEAR_PackageFile_Parser_v1 skips single-char directories [pmjones]
  * fix Bug #11517: Error : download directory &quot;/var/cache/php-pear&quot;
    is not writeable. [remicollet]
  * fix Bug #11616: Incorrect equality operator used when comparing md5 check sums [robham]
  * fix Bug #11642: PEAR fails to authenticate when downloading deps from non-default
    channels [timj]
  * fix Bug #11657: Installer generate bad "dirtree" using INSTALL_ROOT [remicollet]
  * fix Bug #11678: Registry.php getChannel() deadlocks [cellog]
  * fix Bug #11703: pear convert and package.xml with optional dependencies fails [cellog]
  * fix Bug #11754: Error at upgrade-all command run [cellog]
  * fix Bug #11861: uninstall of package did not delete directory created during install
    of package [cellog]
  * fix Bug #11862: Notice: Array to string conversion in PEAR/PackageFile.php on line 433
    [cellog]
  * fix Bug #11883: run-tests -u -p SomePackage should run the topmost
    &quot;AllTests.php&quot; file [cellog]
  * fix Bug #11936: run-tests fails to preserve SYSTEMROOT environment variable [cellog]
   </notes>
  </release>
 </changelog>
</package>
--TEST--
PEAR2_Pyrus_Channel Create new channel
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';

$channel_array = array(
                    'attribs' => array('version'=>'1.0',
                                       'xmlns'=>'http://pear.php.net/channel-1.0',
                                       'xmlns:xsi' => 'http://www.w3.org/2001/XMLSchema-instance',
                                       'xsi:schemaLocation' => 'http://pear.php.net/channel-1.0 
http://pear.php.net/dtd/channel-1.0.xsd'),
                    'name'    => 'foo.example.com',
                    'summary' => 'bar');
$channelinfo = new PEAR2_Pyrus_ChannelFile_v1;
$channelinfo->fromArray($channel_array);

try {
    $channel = new PEAR2_Pyrus_Channel($channelinfo);
    $channel->validate();
    throw new Exception('Was able to create channel with no server details.');
} catch (Exception $e) {
    $test->assertEquals('Invalid channel.xml', $e->getMessage(), 'Invalid channel array');
}

$channel_array['servers'] = array('primary'=>array('rest'=>array('baseurl'=>array('attribs'=>array('type'=>'REST1.0'),
                                                                                  'http://foo.example.com/rest/'))));

$channelinfo = new PEAR2_Pyrus_ChannelFile_v1;
$channelinfo->fromArray($channel_array);
$channel = new PEAR2_Pyrus_Channel($channelinfo);

$test->assertEquals($channel_array, $channel->getArray(), 'getArray');

$channel->name = 'pear.example.com';
$test->assertEquals('pear.example.com', $channel->name, 'getName');

$channel->summary = 'Test channel summary';
$test->assertEquals('Test channel summary', $channel->summary, 'getSummary');
try {
    $channel->summary = '';
    throw new Exception('Was able to set empty summary');
} catch(Exception $e) {
    $test->assertEquals('Channel summary cannot be empty', $e->getMessage(), 'Channel summary cannot be empty');
}

$test->assertEquals('pear.example.com', $channel->alias, 'Alias defaults to channel name');
$channel->alias = 'myalias';
$test->assertEquals('myalias', $channel->alias, 'setAlias');

$test->assertEquals(false, $channel->ssl, 'SSL defaults to false');
$channel->ssl = true;
$test->assertEquals(true, $channel->ssl, 'setSSL(true)');
$test->assertEquals(443, $channel->port, 'When SSL is set, port defaults to 443');
$channel->ssl = false;
$test->assertEquals(false, $channel->ssl, 'setSSL(false)');

$test->assertEquals(80, $channel->port, 'Port defaults to 80');
$channel->port = 1337;
$test->assertEquals(1337, $channel->port, 'set/getPort');

$test->assertIsa('PEAR2_Pyrus_ChannelFile_v1_Servers', $channel->mirrors, 'Wrong mirrors class');
$test->assertEquals(0, count($channel->mirrors), 'only primary server');

try {
    $channel->name = '';
    throw new Exception('Was able to set channel to empty name');
} catch(Exception $e) {
    $test->assertEquals('Primary server must be non-empty', $e->getMessage(), 'Primary server must be non-empty');
}

try {
    $channel->name = '?limmozeen';
    throw new Exception('Was able to set channel to invalid name');
} catch(Exception $e) {
    $test->assertEquals('Primary server "?limmozeen" is not a valid channel server', $e->getMessage(), 'Setting invalid channel name');
}

try {
    $channel->alias = '?limmozeen';
    throw new Exception('Was able to set channel alias to invalid name');
} catch(Exception $e) {
    $test->assertEquals('Alias "?limmozeen" is not a valid channel alias', $e->getMessage(), 'Setting invalid channel alias');
}

$test->assertEquals(true, ($channel->lastModified()>=time()), 'Last modified date is current time by default');

require __DIR__ . '/rest_creation.template';

$test->assertIsa('PEAR2_Pyrus_ChannelFile_v1_Mirror', $channel->mirrors['pear.mirror.com'], 'Mirror was set');
$test->assertIsa('PEAR2_Pyrus_ChannelFile_v1_Mirror', $channel->mirrors['pear.mirror2.com'], 'Mirror #2 was set');
$test->assertIsa('PEAR2_Pyrus_ChannelFile_v1_Mirror', $channel->mirrors['pear.mirror.com'], 'Mirror #1 still exists');

$channel->mirrors['pear.mirror3.com']->port = 999;
$test->assertEquals(999, $channel->mirrors['pear.mirror3.com']->port, 'Mirror #3 added with specific port number');


?>
===DONE===
--EXPECT--
===DONE===<?php
// Use this template to test REST basics, set $channel to the channel object,
// Set $restbase to the base for the rest dirs
$test->assertEquals(true, $channel->supportsREST(), 'supportsREST');
$exp_rest = array();
$exp_rest[] = array (
        'attribs'  => array ('type' => 'REST1.0'),
        '_content' => $restbase.'rest1.0/');
$exp_rest[] = array (
        'attribs'  => array ('type' => 'REST1.1'),
        '_content' => $restbase.'rest1.1/');
$exp_rest[] = array (
        'attribs'  => array ('type' => 'REST1.2'),
        '_content' => $restbase.'rest1.2/');
$exp_rest[] = array (
        'attribs'  => array ('type' => 'REST1.3'),
        '_content' => $restbase.'rest1.3/');

$rest = $channel->protocols->rest;
$test->assertIsa('PEAR2_Pyrus_ChannelFile_v1_Servers_Protocols_REST',
                 $rest, 'correct REST object returned');
$test->assertEquals($restbase . 'rest1.0/', $rest['REST1.0']->baseurl, 'REST 1.0');
$test->assertEquals($restbase . 'rest1.1/', $rest['REST1.1']->baseurl, 'REST 1.1');
$test->assertEquals($restbase . 'rest1.2/', $rest['REST1.2']->baseurl, 'REST 1.2');
$test->assertEquals($restbase . 'rest1.3/', $rest['REST1.3']->baseurl, 'REST 1.3');

$test->assertEquals(false, isset($channel->protocols->rest['REST99.9']),
                    'Invalid resourceType, when baseURLs are set');

$channel->resetREST();
$test->assertEquals(0, count($channel->protocols->rest), 'resetREST');

$channel->protocols->rest['REST1.0']->baseurl = $restbase . 'rest1.0/';
$test->assertEquals($restbase . 'rest1.0/', $channel->protocols->rest['REST1.0']->baseurl, 'REST 1.0');

$fake = new PEAR2_Pyrus_ChannelFile_v1;
$test->assertEquals(0, count($fake->protocols->rest), 'before');
$fake->protocols->rest = $channel->protocols->rest;
$test->assertEquals(1, count($fake->protocols->rest), 'after');
$test->assertEquals($restbase . 'rest1.0/', $fake->protocols->rest['REST1.0']->baseurl, 'REST 1.0');
$test->assertEquals(true, isset($fake->protocols->rest['REST1.0']), 'REST 1.0 isset');

$channel->protocols->rest = null;
$test->assertEquals(0, count($channel->protocols->rest), 'resetREST');

$fake->protocols->rest = $channel->protocols->rest;
$test->assertEquals(0, count($fake->protocols->rest), 'after 0');

try {
    $channel->protocols->rest = 'hi';
    throw new Exception('set to hi should not work and did');
} catch (PEAR2_Pyrus_ChannelFile_Exception $e) {
    $test->assertEquals('Can only set REST to ' .
                        'PEAR2_Pyrus_ChannelFile_v1_Servers_Protocols_REST object', $e->getMessage(), 'error');
}
<?php
$channel->resetREST();

$channel->protocols->rest['REST1.0']->baseurl = 'http://pear.example.com/rest1.0/';
$test->assertEquals('http://pear.example.com/rest1.0/', $channel->protocols->rest['REST1.0']->baseurl, 'setBaseURL');

$channel->protocols->rest['REST1.1']->baseurl = 'http://pear.example.com/rest1.1/';
$test->assertEquals('http://pear.example.com/rest1.1/', $channel->protocols->rest['REST1.1']->baseurl, 'setBaseURL #2 adding second baseurl');

$channel->protocols->rest['REST1.0']->baseurl = 'http://pear.example.com/rest1.00/';
$test->assertEquals('http://pear.example.com/rest1.00/', $channel->protocols->rest['REST1.0']->baseurl, 'setBaseURL #3 Update URL of existing baseurl');

try {
    $channel->protocols->llama;
    throw new Exception('Was able to get the llama functions');
} catch(Exception $e) {
    $test->assertEquals('Unknown protocol: llama', $e->getMessage(), 'Get invalid protocol functions');
}

unset($channel->protocols->rest['REST1.0']);
$test->assertEquals(null, $channel->protocols->rest['REST1.0']->baseurl, 'after unset');
--TEST--
PEAR2_Pyrus_Channel_Mirror unset
--FILE--
<?php
$thrown = false;
require dirname(__FILE__) . '/setup.php.inc';

$channel = new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/ChannelRegistry/sample_channel_complex.xml');
$test->assertEquals(true, isset($channel->mirror['us.pear.php.net']), 'before');
unset($channel->mirror['us.pear.php.net']);
$test->assertEquals(false, isset($channel->mirror['us.pear.php.net']), 'after');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Channel_Mirror set
--FILE--
<?php
$thrown = false;
require dirname(__FILE__) . '/setup.php.inc';

$fake = new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/ChannelRegistry/sample_channel_complex.xml');
$fake->mirror['ugly.pear.php.net']->ssl = true;
$fake->mirror['ugly.pear.php.net']->port = 5;
$channel = new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/ChannelRegistry/sample_channel_complex.xml');

// test setting to null
$test->assertEquals(true, isset($channel->mirror['us.pear.php.net']), 'before');
$channel->mirror['us.pear.php.net'] = null;
$test->assertEquals(false, isset($channel->mirror['us.pear.php.net']), 'after');

try {
    $channel->mirror['us.pear.php.net'] = 'hi';
    throw new Exception('setting to hi should have failed and did not');
} catch (PEAR2_Pyrus_ChannelFile_Exception $e) {
    $test->assertEquals('Can only set mirror to a ' .
                        'PEAR2_Pyrus_ChannelFile_v1_Mirror object', $e->getMessage(), 'error');
}

$channel->mirror['us.pear.php.net'] = $fake->mirror['ugly.pear.php.net'];
$test->assertEquals(5, $channel->mirror['us.pear.php.net']->port, 'verify setting worked');

// test setting existing mirror

$fake->mirror['ugly.pear.php.net']->port = 82;

$channel->mirror['us.pear.php.net'] = $fake->mirror['ugly.pear.php.net'];
$test->assertEquals(82, $channel->mirror['us.pear.php.net']->port, 'verify 2');

unset($channel->mirror['us.pear.php.net']);
unset($channel->mirror['de.pear.php.net']);
unset($channel->mirror['us.pear.php.net']);
$test->assertEquals(0, count($channel->mirrors), 'after all removed');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Channel::__construct() basic test
--FILE--
<?php
$thrown = false;
require dirname(__FILE__) . '/setup.php.inc';
try {
    $channel = new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/ChannelRegistry/sample_channel_complex.xml');
    try {
        $channel->validate();
    } catch (Exception $e) {
        $thrown = true;
        $test->assertEquals(false, $thrown, 'validate channel file '.$e->getMessage());
    }
    $test->assertEquals('pear.php.net', $channel->name, 'getChannel');
    $test->assertEquals('PHP Extension and Application Repository', $channel->summary, 'getSummary');
    $test->assertEquals('pear', $channel->alias, 'getAlias');
    $test->assertEquals('pear', $channel->suggestedalias, 'getSuggestedAlias');
    $test->assertEquals(false, $channel->ssl, 'getSSL');
    $test->assertEquals(80, $channel->port, 'getPort');
    
    $restbase = 'http://pear.php.net/';
    require __DIR__ . '/rest.template';

    try {
        $a = $channel->protocols->poop['oops'];
        throw new Exception('poop protocol should not work and did');
    } catch (PEAR2_Pyrus_ChannelFile_Exception $e) {
        $test->assertEquals('Unknown protocol: poop', $e->getMessage(), 'error');
    }

    try {
        $channel->protocols->poop = 'oops';
        throw new Exception('poop protocol set should not work and did');
    } catch (PEAR2_Pyrus_ChannelFile_Exception $e) {
        $test->assertEquals('Unknown protocol: poop', $e->getMessage(), 'error set');
    }
    
    $mirrors = $channel->mirrors;
    $test->assertIsa('PEAR2_Pyrus_ChannelFile_v1_Servers', $mirrors, 'Mirrors returns object');
    $test->assertEquals(2, count($mirrors), 'Two mirrors returned');
    $test->assertIsa('PEAR2_Pyrus_ChannelFile_v1_Mirror', $mirrors['us.pear.php.net'], 'Mirror returned is PEAR2_Pyrus_ChannelFile_v1_Mirror object');
    $test->assertIsa('PEAR2_Pyrus_ChannelFile_v1_Mirror', $mirrors['de.pear.php.net'], 'Mirror returned is PEAR2_Pyrus_ChannelFile_v1_Mirror object');
    
    $test->assertEquals(array('attribs'=>array(
                                'version' => 'default'),
                                '_content'=>'PEAR2_Pyrus_Validate'), $channel->getValidationPackage(), 'getValidationPackage');
    
    $test->assertEquals(true, $channel->getValidationObject() instanceof PEAR2_Pyrus_Validate, 'getValidationObject');
    
    // should be moved to a separate test?
    $test->assertEquals(true, $channel->validChannelServer('__uri'), 'validChannelServer(__uri)');
    $test->assertEquals(true, $channel->validChannelServer('pear.php.net'), 'validChannelServer(pear.php.net)');
    
} catch(Exception $e) {
    echo $e;
    $thrown = true;
}
$test->assertEquals(false, $thrown, 'parsed channel.xml file fine, no exceptions thrown');



?>
===DONE===
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Channel URI Channel tests
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';

$channel_array = array(
                    'attribs' => array('version'=>'1.0', 'xmlns'=>'http://pear.php.net/channel-1.0'),
                    'name'    => '__uri',
                    'summary' => 'URI Channel');
$channel_array['servers'] = array('primary'=>array('rest'=>array('baseurl'=>array('attribs'=>array('type'=>'REST1.0'),
                                                                                  'http://foo.example.com/rest/'))));

$channelinfo = new PEAR2_Pyrus_ChannelFile_v1;
$channelinfo->fromArray($channel_array);
$channel = new PEAR2_Pyrus_Channel($channelinfo);

try {
    $channel->mirrors['foo.example.com'];
    throw new Exception('should not have worked');
} catch (PEAR2_Pyrus_Channel_Exception $e) {
    $test->assertEquals('__uri pseudo-channel cannot have mirrors', $e->getMessage(), 'rest message');
}
try {
    $test->assertEquals(false, $channel->protocols, 'getFunctions returns false for __uri');
} catch (PEAR2_Pyrus_Channel_Exception $e) {
    $test->assertEquals('__uri pseudo-channel has no protocols', $e->getMessage(), 'rest message');
}

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Channel Remote channel retrieval
--SKIPIF--
<?php
$connection = @file_get_contents('http://pear.php.net/channel.xml');
if (!$connection) {
	echo 'Must have Internet access to test remote channel info retrieval.';
}
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';

// From file_get_contents
$channel = new PEAR2_Pyrus_ChannelFile('http://pear.php.net/channel.xml');
// $channel should be set up!
require __DIR__ . '/../ChannelRegistry/AllRegistries/info/basic.template';

// From channel.xml url
$channel = new PEAR2_Pyrus_ChannelFile('http://pear.php.net/channel.xml', false);
// $channel should be set up!
require __DIR__ . '/../ChannelRegistry/AllRegistries/info/basic.template';

// From channel.xml with is_remote = true
$channel = new PEAR2_Pyrus_ChannelFile('http://pear.php.net/channel.xml', false, true);
// $channel should be set up!
require __DIR__ . '/../ChannelRegistry/AllRegistries/info/basic.template';

// From channel name, with is_remote = true
$channel = new PEAR2_Pyrus_ChannelFile('pear.php.net', false, true);
// $channel should be set up!
require __DIR__ . '/../ChannelRegistry/AllRegistries/info/basic.template';

?>
===DONE===
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
--TEST--
PEAR2_Pyrus_Channel_Mirror basic tests
--FILE--
<?php
$thrown = false;
require dirname(__FILE__) . '/setup.php.inc';

$channel = new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/ChannelRegistry/sample_channel_complex.xml');

$test->assertEquals(false, isset($channel->mirror['ugly.pear.php.net']), 'test offsetExists false');
$test->assertEquals('pear.php.net', $channel->mirrors['ugly.pear.php.net']->channel, 'getChannel ugly');

$test->assertEquals(true, isset($channel->mirror['us.pear.php.net']), 'test offsetExists');
$test->assertEquals('pear.php.net', $channel->mirrors['us.pear.php.net']->channel, 'getChannel');
$test->assertEquals('us.pear.php.net', $channel->mirrors['us.pear.php.net']->name, 'getName');
$test->assertEquals(80, $channel->mirrors['us.pear.php.net']->port, 'getPort (default)');
$test->assertEquals(false, $channel->mirrors['us.pear.php.net']->ssl, 'getSSL (default)');
$channel->mirrors['us.pear.php.net']->setSSL(true);
$test->assertEquals(true, $channel->mirrors['us.pear.php.net']->ssl, 'set and get SSL(true)');
$test->assertEquals(443, $channel->mirrors['us.pear.php.net']->port, 'getPort (ssl default)');
$channel->mirrors['us.pear.php.net']->setSSL(false);
$test->assertEquals(false, $channel->mirrors['us.pear.php.net']->ssl, 'set and get SSL(false)');
$test->assertEquals(80, $channel->mirrors['us.pear.php.net']->port, 'getPort (reset to 80)');
$test->assertEquals(3452, $channel->mirrors['de.pear.php.net']->port, 'getPort (non-standard)');
$channel->mirrors['de.pear.php.net']->setPort(999);
$test->assertEquals(999, $channel->mirrors['de.pear.php.net']->port, 'setPort');

$test->assertEquals(true, $channel->mirrors['de.pear.php.net']->ssl, 'getSSL (non-standard port)');
$test->assertEquals(true, $channel->mirrors['us.pear.php.net']->supportsREST(), 'supportsREST');

try {
    $channel->mirrors['de.pear.php.net']->setName('');
    throw new Exception('Was able to set mirror host to empty name');
} catch(Exception $e) {
    $test->assertEquals('Mirror server must be non-empty', $e->getMessage(), 'Mirror server must be non-empty');
}

try {
    $channel->mirrors['de.pear.php.net']->setName('?limmozeen');
    throw new Exception('Was able to set mirror host to invalid name');
} catch(Exception $e) {
    $test->assertEquals('Mirror server "?limmozeen" for channel "pear.php.net" is not a valid channel server', $e->getMessage(), 'Setting invalid mirror name');
}

$channel->mirrors['de.pear.php.net']->setName('pear.php.net.de');
$test->assertEquals('pear.php.net.de', $channel->mirrors['pear.php.net.de']->name, 'setName');

$channel = $channel->mirrors['us.pear.php.net'];

$restbase = 'http://us.pear.php.net/';
require __DIR__ . '/rest.template';

require __DIR__ . '/rest_creation.template';
?>
===DONE===
--EXPECT--
===DONE===<?php
include dirname(__DIR__) . '/setup.php.inc';
@mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit', __DIR__ . '/pearconfig.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
--TEST--
PEAR2_Pyrus_Channel: iteration over remote REST information, package list
--FILE--
<?php

include __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../../Mocks/Internet/installer.prepare.dep.versionconflict',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
$chan = PEAR2_Pyrus_Config::current()->channelregistry['pear2.php.net'];
$names = array();
foreach ($chan->remotepackages as $package) {
    $names[] = $package->name;
}
sort($names);

$test->assertEquals(array('P1', 'P2', 'P3', 'P4', 'P5'), $names, 'package names');
$releases = array();
foreach ($chan->remotepackage['P2'] as $version => $release) {
    $releases[$version] = $release;
}
$test->assertEquals(array('1.2.3' => array(
                                           'stability' => 'stable',
                                           'minimumphp' => '5.2.0'),
                          '1.2.2' => array(
                                           'stability' => 'stable',
                                           'minimumphp' => '5.2.0'),
                          '0.9.0' => array(
                                           'stability' => 'beta',
                                           'minimumphp' => '5.2.0')
                          ),
                    $releases, 'release information');

$names = array();
foreach ($chan->remotepackages['stable'] as $package) {
    if ($package->name == 'P2') {
        $testp = $package;
    }
    $names[] = $package->name;
}
sort($names);

$test->assertEquals(array('P1', 'P2', 'P3', 'P4'), $names, 'package names stable');

$releases = array();
foreach ($testp as $version => $release) {
    $releases[$version] = $release;
}
$test->assertEquals(array('1.2.3' => array(
                                           'stability' => 'stable',
                                           'minimumphp' => '5.2.0'),
                          '1.2.2' => array(
                                           'stability' => 'stable',
                                           'minimumphp' => '5.2.0'),
                          ),
                    $releases, 'release stable information');


$names = array();
foreach ($chan->remotepackages['beta'] as $package) {
    if ($package->name == 'P2') {
        $testp = $package;
    }
    $names[] = $package->name;
}
sort($names);

$test->assertEquals(array('P1', 'P2', 'P3', 'P4', 'P5'), $names, 'package names beta');

$releases = array();
foreach ($testp as $version => $release) {
    $releases[$version] = $release;
}

$releases = array();
foreach ($testp as $version => $release) {
    $releases[$version] = $release;
}
$test->assertEquals(array('1.2.3' => array(
                                           'stability' => 'stable',
                                           'minimumphp' => '5.2.0'),
                          '1.2.2' => array(
                                           'stability' => 'stable',
                                           'minimumphp' => '5.2.0'),
                          '0.9.0' => array(
                                           'stability' => 'beta',
                                           'minimumphp' => '5.2.0')
                          ),
                    $releases, 'release beta information');

$releases = array();
foreach ($chan->remotepackages['stable']->getPackage('P2') as $version => $release) {
    $releases[$version] = $release;
}
$test->assertEquals(array('1.2.3' => array(
                                           'stability' => 'stable',
                                           'minimumphp' => '5.2.0'),
                          '1.2.2' => array(
                                           'stability' => 'stable',
                                           'minimumphp' => '5.2.0'),
                          ),
                    $releases, 'getPackage release stable information');

$releases = array();
foreach ($chan->remotepackages['beta']->getPackage('P2') as $version => $release) {
    $releases[$version] = $release;
}
$test->assertEquals(array('1.2.3' => array(
                                           'stability' => 'stable',
                                           'minimumphp' => '5.2.0'),
                          '1.2.2' => array(
                                           'stability' => 'stable',
                                           'minimumphp' => '5.2.0'),
                          '0.9.0' => array(
                                           'stability' => 'beta',
                                           'minimumphp' => '5.2.0')
                          ),
                    $releases, 'getPackage release beta information');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?xml version="1.0"?>
<pearconfig version="1.0"><default_channel>pear2.php.net</default_channel><preferred_mirror>pear2.php.net</preferred_mirror><auto_discover>0</auto_discover><http_proxy></http_proxy><cache_dir>/home/user/workspace/all/Pyrus/tests/Channel/remoteiteration/testit/cache</cache_dir><temp_dir>/home/user/workspace/all/Pyrus/tests/Channel/remoteiteration/testit/temp</temp_dir><download_dir>/home/user/workspace/all/Pyrus/tests/Channel/remoteiteration/testit/downloads</download_dir><username></username><password></password><verbose>1</verbose><preferred_state>stable</preferred_state><umask>0022</umask><cache_ttl>3600</cache_ttl><sig_type></sig_type><sig_bin></sig_bin><sig_keyid></sig_keyid><sig_keydir></sig_keydir><my_pear_path>/home/user/workspace/all/Pyrus/tests/Channel/remoteiteration/testit</my_pear_path><plugins_dir>/home/user/workspace/all/Pyrus/tests/Channel/remoteiteration</plugins_dir></pearconfig>
--TEST--
PEAR2_Pyrus_Channel Validation tests
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';

$channel_array = array(
                    'attribs' => array('version'=>'1.0', 'xmlns'=>'http://pear.php.net/channel-1.0'),
                    'name'    => '__uri',
                    'summary' => 'URI Channel');
$channel_array['servers'] = array('primary'=>array('rest'=>array('baseurl'=>array('attribs'=>array('type'=>'REST1.0'),
                                                                                  'http://foo.example.com/rest/'))));

$channelobject = new PEAR2_Pyrus_ChannelFile_v1($channel_array);
$channel = new PEAR2_Pyrus_Channel($channelobject);
$test->assertEquals(array('attribs' => array('version' => 'default'),
                          '_content' => 'PEAR2_Pyrus_Validate'), $channel->getValidationPackage(), 'Get default validation package');

$channel->setValidationPackage('PEAR2_Pyrus_Validator_PECL', '1.0');

$test->assertEquals(array('_content' => 'PEAR2_Pyrus_Validator_PECL',
                          'attribs' => array('version' => '1.0')), $channel->getValidationPackage(), 'Set custom validation package');

$test->assertEquals(true, $channel->getValidationObject() instanceof PEAR2_Pyrus_Validator_PECL, 'getValidationObject returns what is set');
$test->assertEquals(true, $channel->getValidationObject('PEAR2_Pyrus_Validator_PECL') instanceof PEAR2_Pyrus_Validate, 'getValidationObject Channel validation packages are all checked by PEAR2_Pyrus_Validate');

$channel->setValidationPackage('PEAR2_Bogus_Validation', '6.0');
try {
    $channel->getValidationObject();
    throw new Exception('succeeded and should fail');
} catch (PEAR2_Pyrus_ChannelFile_Exception $e) {
    $test->assertEquals($e->getMessage(), 'Validation object PEAR2_Bogus_Validation cannot be instantiated', 'bogus');
}

$channel->setValidationPackage(null, '1.0');
$test->assertEquals(true, $channel->getValidationObject() instanceof PEAR2_Pyrus_Validate, 'setValidationPackage resets to default');


?>
===DONE===
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ChannelFile_v1_REST errors
--FILE--
<?php
require dirname(__FILE__) . '/setup.php.inc';
$channel = new PEAR2_Pyrus_ChannelFile_v1;
$getassert = function($message) use ($channel, $test) {
    return function($action, $type) use ($channel, $test, $message) {
        try {
            $action();
            throw new Exception($type . ' worked and should not');
        } catch (PEAR2_Pyrus_ChannelFile_Exception $e) {
            $test->assertEquals($message, $e->getMessage(), $type);
        }    
    };
};

$assert = $getassert('Cannot use [] to access '
                    . 'baseurl, use ->');

$assert(function() use ($channel) {$a = $channel->protocols->rest['REST1.0']['oops'];},
        'offsetGet');

$assert(function() use ($channel) {$channel->protocols->rest['REST1.0']['oops'] = 1;},
        'offsetSet');

$assert(function() use ($channel) {isset($channel->protocols->rest['REST1.0']['oops']);},
        'offsetExists');

$assert(function() use ($channel) {unset($channel->protocols->rest['REST1.0']['oops']);},
        'offsetUnset');

$assert = $getassert('Cannot use -> to access '
                    . 'REST protocols, use []');

$assert(function() use ($channel) {$a = $channel->protocols->rest->oops;},
        '__get');

$assert(function() use ($channel) {$channel->protocols->rest->oops = 1;},
        '__set');

$assert = $getassert('Unknown variable oops');

$assert(function() use ($channel) {$a = $channel->protocols->rest['REST1.0']->oops;},
        '__get oops');

$assert(function() use ($channel) {$channel->protocols->rest['REST1.0']->oops = 1;},
        '__set oops');

$assert = $getassert('Can only set REST protocol ' .
                        ' to a PEAR2_Pyrus_ChannelFile_v1_Servers_Protocol_REST object');

$assert(function() use ($channel) {$channel->protocols->rest['REST1.0'] = 1;},
        'offsetSet non-self');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_Channel::__construct() test basics for ssl channels
--FILE--
<?php
$thrown = false;
require dirname(__FILE__) . '/setup.php.inc';
try {
    $chan = new PEAR2_Pyrus_ChannelFile(dirname(__DIR__).'/ChannelRegistry/sample_ssl_channel.xml');
    try {
        $chan->validate();
    } catch (Exception $e) {
        $thrown = true;
        $test->assertEquals(false, $thrown, 'validate channel file '.$e->getMessage());
    }
    $test->assertEquals(true, $chan->ssl, 'getSSL');
    $test->assertEquals(443, $chan->port, 'getPort');
} catch(Exception $e) {
    $thrown = true;
}
$test->assertEquals(false, $thrown, 'parsed channel.xml file fine, no exceptions thrown');



?>
===DONE===
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_UnInstaller::rollback() test
--FILE--
<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
$package = new PEAR2_Pyrus_Package(__DIR__.'/../../../sandbox/SimpleChannelServer/package.xml');
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare($package);
PEAR2_Pyrus_Installer::commit();
$test->assertFileExists(__DIR__ . '/testit/bin/pearscs', 'bin/pearscs');
$test->assertEquals(decoct(0755), decoct(0777 & fileperms(__DIR__ . '/testit/bin/pearscs')), 'bin/pearscs perms');
$test->assertFileExists(__DIR__ . '/testit/php/PEAR2/SimpleChannelServer.php', 'php/PEAR2/SimpleChannelServer.php');
$test->assertEquals(file_get_contents(__DIR__.'/../../../sandbox/SimpleChannelServer/src/SimpleChannelServer.php'),
                    file_get_contents(__DIR__ . '/testit/php/PEAR2/SimpleChannelServer.php'), 'files match');

PEAR2_Pyrus_Uninstaller::begin();
PEAR2_Pyrus_Uninstaller::prepare('pear2.php.net/PEAR2_SimpleChannelServer');
PEAR2_Pyrus_Uninstaller::rollback();

$test->assertFileExists(__DIR__ . '/testit/bin/pearscs', 'bin/pearscs after');
$test->assertFileExists(__DIR__ . '/testit/php/PEAR2/SimpleChannelServer.php', 'php/PEAR2/SimpleChannelServer.php after');
$test->assertEquals(true, isset(PEAR2_Pyrus_Config::current()->registry->package['pear2.php.net/PEAR2_SimpleChannelServer']), 'verify uninstalled');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_UnInstaller::uninstall() basic test
--FILE--
<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
$package = new PEAR2_Pyrus_Package(__DIR__.'/../../../sandbox/SimpleChannelServer/package.xml');
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare($package);
PEAR2_Pyrus_Installer::commit();
$test->assertFileExists(__DIR__ . '/testit/bin/pearscs', 'bin/pearscs');
$test->assertEquals(decoct(0755), decoct(0777 & fileperms(__DIR__ . '/testit/bin/pearscs')), 'bin/pearscs perms');
$test->assertFileExists(__DIR__ . '/testit/php/PEAR2/SimpleChannelServer.php', 'php/PEAR2/SimpleChannelServer.php');
$test->assertEquals(file_get_contents(__DIR__.'/../../../sandbox/SimpleChannelServer/src/SimpleChannelServer.php'),
                    file_get_contents(__DIR__ . '/testit/php/PEAR2/SimpleChannelServer.php'), 'files match');

PEAR2_Pyrus_Uninstaller::begin();
PEAR2_Pyrus_Uninstaller::prepare('pear2.php.net/PEAR2_SimpleChannelServer');
PEAR2_Pyrus_Uninstaller::commit();

$test->assertFileNotExists(__DIR__ . '/testit/bin/pearscs', 'bin/pearscs after');
$test->assertFileNotExists(__DIR__ . '/testit/php/PEAR2/SimpleChannelServer.php', 'php/PEAR2/SimpleChannelServer.php after');
$test->assertEquals(false, isset(PEAR2_Pyrus_Config::current()->registry->package['pear2.php.net/PEAR2_SimpleChannelServer']), 'verify uninstalled');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
$test->assertEquals(array(), $reg->listPackages($info->channel), 'before');
$reg->install($info);
$info = new PEAR2_Pyrus_PackageFile_v2;
$info->name = 'HooHa';
$info->channel = 'pear2.php.net';
$info->files['one'] = array('role' => 'php');
$reg->install($info);
$info = new PEAR2_Pyrus_PackageFile_v2;
$info->name = 'HooHa2';
$info->channel = 'pear2.php.net';
$info->files['two'] = array('role' => 'php');
$reg->install($info);
$packages = $reg->listPackages($info->channel);
sort($packages);
$test->assertEquals(array('HooHa', 'HooHa2', 'PEAR2_SimpleChannelServer'), $packages, 'after');
?><?php
$test->assertEquals(array(), $reg->listPackages('pear2.php.net'), 'before pear2');
$test->assertEquals(array(), $reg->listPackages('pear.php.net'), 'before pear');
$reg->install($info);
$info = new PEAR2_Pyrus_PackageFile_v2;
$info->name = 'HooHa';
$info->channel = 'pear2.php.net';
$info->files['one'] = array('role' => 'php');
$reg->install($info);
$info = new PEAR2_Pyrus_PackageFile_v2;
$info->name = 'HooHa2';
$info->channel = 'pear2.php.net';
$info->files['two'] = array('role' => 'php');
$reg->install($info);
$info = new PEAR2_Pyrus_PackageFile_v2;
$info->name = 'HooHa2';
$info->channel = 'pear.php.net';
$info->files['three'] = array('role' => 'php');
$reg->install($info);
$packages = $reg->listPackages('pear2.php.net');
sort($packages);
$test->assertEquals(array('HooHa', 'HooHa2', 'PEAR2_SimpleChannelServer'), $packages, 'after pear2');
$packages = $reg->listPackages('pear.php.net');
sort($packages);
$test->assertEquals(array('HooHa2'), $packages, 'after pear');
?><?php
$test->assertEquals(array(), $reg->listPackages($info->channel), 'before');
$test->assertEquals(false, (bool)$reg->exists($info->name, $info->channel), 'package does not exist');
$reg->install($info);
$test->assertEquals(true, (bool)$reg->exists($info->name, $info->channel), 'package was installed');
$test->assertEquals(array($info->name), $reg->listPackages($info->channel), 'after');
?><?php
$package = new PEAR2_Pyrus_Package(__DIR__.'/package.xml');

$info = $package->getInternalPackage()->getPackageFile()->info;
// set up some fake dependencies so we can test this too

$deps = $info->dependencies;
$deps['required']->package['pear.php.net/File']->min('1.2.0');
$deps['required']->subpackage['pear2.php.net/Foo']->min('1.0.0')->max('2.0.0')
                                        ->recommended('1.2.0')->exclude('1.1.0')->exclude('1.1.1');
$deps['required']->package['pear.php.net/Other']->conflicts();

$deps['optional']->package['pear.php.net/PEAR']->min('1.7.0');
$deps['optional']->subpackage['pear2.php.net/Bar']->min('1.5.0');
$deps['required']->package['pecl.php.net/PackageName']->min('1.1.0')->max('1.2.0')->recommended('1.1.1')
            ->exclude('1.1.0a1')->exclude('1.1.0a2')->providesextension('packagename');

$deps['required']->extension['phar']->min('2.0.0')->exclude('2.0.1');
$deps['required']->os['windows'] = true;
$deps['required']->os['vista'] = false;
$deps['required']->arch['i386'] = true;
$deps['required']->php->exclude('5.2.8');

$group = $deps['group']->name;
$group->hint = 'Install optional stuff as a group';
$group->package['pear2.php.net/PackageName1']->save();
$group->package['pear2.php.net/PackageName2']->min('1.2.0');
$group->subpackage['pear2.php.net/PackageName3']->recommended('1.2.1');
$group->extension['extension']->exclude('5.2.8')->exclude('5.2.9');
$group->package['pecl.php.net/PackageName']->min('1.1.0')->max('1.2.0')->recommended('1.1.1')
            ->exclude('1.1.0a1')->exclude('1.1.0a2')->providesextension('packagename');
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for regular arch deps
$fake = new PEAR2_Pyrus_PackageFile_v2;
$required = $fake->dependencies['required'];
$required->os['windows'] = false;

$test->assertEquals(null, $reg->dependencies['required']->os['windows'], 'windows before');

$reg->dependencies['required'] = $required;

$test->assertEquals(false, $reg->dependencies['required']->os['windows'], 'windows after');
<?php
// all registry tests must pass this (as must PackageFile objects)

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->compatible['test/test']->min('1.2.3')->max('1.4.5');
$fake->compatible['test/test2']->min('1.2.4')->max('1.4.3');

$test->assertEquals(false, isset($reg->compatible['test/test']), 'isset before');

$test->assertEquals(0, count($reg->compatible), 'count 0');

$test->assertEquals(false, isset($reg->compatible['test/test']), 'isset before');
$test->assertEquals(false, isset($reg->compatible['test/test2']), 'isset before 2');

$reg->compatible['test/test'] = $fake->compatible['test/test'];

$test->assertEquals(true, isset($reg->compatible['test/test']), 'isset after');
$test->assertEquals('1.2.3', $reg->compatible['test/test']->min, 'min test/test');
$test->assertEquals('1.4.5', $reg->compatible['test/test']->max, 'max test/test');

$test->assertEquals(1, count($reg->compatible), 'count 1');

$reg->compatible[] = $fake->compatible['test/test2'];

$test->assertEquals(true, isset($reg->compatible['test/test2']), 'isset after 2');
$test->assertEquals(2, count($reg->compatible), 'count 2');
$test->assertEquals('1.2.3', $reg->compatible['test/test']->min, 'min test/test 2');
$test->assertEquals('1.4.5', $reg->compatible['test/test']->max, 'max test/test 2');
$test->assertEquals('1.2.4', $reg->compatible['test/test2']->min, 'min test/test2');
$test->assertEquals('1.4.3', $reg->compatible['test/test2']->max, 'max test/test2');

$reg->compatible[] = $fake->compatible['test/test2'];

$test->assertEquals(2, count($reg->compatible), 'count 3');
$test->assertEquals('1.2.3', $reg->compatible['test/test']->min, 'min test/test 2.1');
$test->assertEquals('1.4.5', $reg->compatible['test/test']->max, 'max test/test 2.1');
$test->assertEquals('1.2.4', $reg->compatible['test/test2']->min, 'min test/test2 2');
$test->assertEquals('1.4.3', $reg->compatible['test/test2']->max, 'max test/test2 2');

$names = array();
foreach ($reg->compatible as $name => $obj) {
    $names[] = $name;
}
$test->assertEquals(array('test/test', 'test/test2'), $names, 'names');
<?php
// all registry tests must pass this (as must PackageFile objects)

$reg->release[0]->installconditions['php'] = '5.2.0';

$test->assertEquals(array (
  'package' => 
  array (
    'attribs' => 
    array (
      'xmlns' => 'http://pear.php.net/dtd/package-2.0',
      'xmlns:tasks' => 'http://pear.php.net/dtd/tasks-1.0',
      'xmlns:xsi' => 'http://www.w3.org/2001/XMLSchema-instance',
      'version' => '2.0',
      'xsi:schemaLocation' => 'http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.0     http://pear.php.net/dtd/package-2.0.xsd',
    ),
    'name' => 'PEAR2_SimpleChannelServer',
    'channel' => 'pear2.php.net',
    'summary' => 'A Simple Channel Server for PEAR2 compatible channels
',
    'description' => '
This package contains a set of scripts to create a simple PEAR compatible
channel server. Included with the package is the pearscs command which you
can use for the command line to manage a pear channel.

The pearscs utility will be installed in the directory configured by the
bin_dir setting within Pyrus.
',
    'lead' => 
    array (
      0 => 
      array (
        'name' => 'Gregory Beaver',
        'user' => 'cellog',
        'email' => 'cellog@php.net',
        'active' => 'yes',
      ),
      1 => 
      array (
        'name' => 'Brett Bieber',
        'user' => 'saltybeagle',
        'email' => 'brett.bieber@gmail.com',
        'active' => 'yes',
      ),
    ),
    'date' => '2008-12-15',
    'time' => '11:51:01',
    'version' => 
    array (
      'release' => '0.1.0',
      'api' => '0.1.0',
    ),
    'stability' => 
    array (
      'release' => 'devel',
      'api' => 'alpha',
    ),
    'license' => 
    array (
      'attribs' => 
      array (
        'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
      ),
      '_content' => 'New BSD License',
    ),
    'notes' => 'First attempt.
',
    'contents' => 
    array (
      'dir' => 
      array (
        'attribs' => 
        array (
          'name' => '/',
        ),
        'file' => 
        array (
          0 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Release.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          1 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Package.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          2 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Manager.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          3 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Maintainer.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          4 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Category.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          5 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Get.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          6 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Exception.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          7 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/CLI.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          8 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Channel.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          9 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Categories/Exception.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          10 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Categories.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          11 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          12 => 
          array (
            'attribs' => 
            array (
              'role' => 'script',
              'name' => 'script/pearscs',
            ),
          ),
          13 => 
          array (
            'attribs' => 
            array (
              'role' => 'doc',
              'name' => 'doc/pear2.php.net/PEAR2_SimpleChannelServer/examples/examples/update_channel.php',
            ),
          ),
        ),
      ),
    ),
    'dependencies' => 
    array (
      'required' => 
      array (
        'php' => 
        array (
          'min' => '5.2.0',
          'exclude' => '5.2.8',
        ),
        'pearinstaller' => 
        array (
          'min' => '2.0.0a1',
        ),
        'package' => 
        array (
          0 => 
          array (
            'name' => 'File',
            'channel' => 'pear.php.net',
            'min' => '1.2.0',
          ),
          1 => 
          array (
            'name' => 'Other',
            'channel' => 'pear.php.net',
            'conflicts' => '',
          ),
          2 => 
          array (
            'name' => 'PackageName',
            'channel' => 'pecl.php.net',
            'min' => '1.1.0',
            'max' => '1.2.0',
            'recommended' => '1.1.1',
            'exclude' => 
            array (
              0 => '1.1.0a1',
              1 => '1.1.0a2',
            ),
            'providesextension' => 'packagename',
          ),
        ),
        'subpackage' => 
        array (
          'name' => 'Foo',
          'channel' => 'pear2.php.net',
          'min' => '1.0.0',
          'max' => '2.0.0',
          'recommended' => '1.2.0',
          'exclude' => 
          array (
            0 => '1.1.0',
            1 => '1.1.1',
          ),
        ),
        'extension' => 
        array (
          'name' => 'phar',
          'min' => '2.0.0',
          'exclude' => '2.0.1',
        ),
        'os' => 
        array (
          0 => 
          array (
            'name' => 'windows',
          ),
          1 => 
          array (
            'name' => 'vista',
            'conflicts' => '',
          ),
        ),
        'arch' => 
        array (
          'pattern' => 'i386',
        ),
      ),
      'optional' => 
      array (
        'package' => 
        array (
          'name' => 'PEAR',
          'channel' => 'pear.php.net',
          'min' => '1.7.0',
        ),
        'subpackage' => 
        array (
          'name' => 'Bar',
          'channel' => 'pear2.php.net',
          'min' => '1.5.0',
        ),
      ),
      'group' => 
      array (
        'attribs' => 
        array (
          'hint' => 'Install optional stuff as a group',
          'name' => 'name',
        ),
        'package' => 
        array (
          0 => 
          array (
            'name' => 'PackageName1',
            'channel' => 'pear2.php.net',
          ),
          1 => 
          array (
            'name' => 'PackageName2',
            'channel' => 'pear2.php.net',
            'min' => '1.2.0',
          ),
          2 => 
          array (
            'name' => 'PackageName',
            'channel' => 'pecl.php.net',
            'min' => '1.1.0',
            'max' => '1.2.0',
            'recommended' => '1.1.1',
            'exclude' => 
            array (
              0 => '1.1.0a1',
              1 => '1.1.0a2',
            ),
            'providesextension' => 'packagename',
          ),
        ),
        'subpackage' => 
        array (
          'name' => 'PackageName3',
          'channel' => 'pear2.php.net',
          'recommended' => '1.2.1',
        ),
        'extension' => 
        array (
          'name' => 'extension',
          'exclude' => array('5.2.8','5.2.9'),
        ),
      ),
    ),
    'phprelease' => 
    array (
      'installcondition' => 
      array (
        'php' => 
        array (
          'min' => '5.2.0',
        ),
      ),
    ),
  ),
), $reg->toArray(true), 'toArray');<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// dependency group setup
$group = $reg->dependencies['group']->groupname;

$test->assertEquals(false, isset($reg->dependencies['group']->groupname->package['channel/PackageName1']), 'before group package isset 1');
$test->assertEquals(false, isset($group->package['channel/PackageName1']), 'before group package isset 2');
$test->assertEquals(false, isset($reg->dependencies['group']->groupname->package), 'before group package isset 3');
$test->assertEquals(false, isset($group->package), 'before group package isset 4');
$group->package['channel/PackageName1']->save();
$test->assertEquals(true, isset($reg->dependencies['group']->groupname->package['channel/PackageName1']), 'after group package isset 1');
$test->assertEquals(true, isset($group->package['channel/PackageName1']), 'after group package isset 2');
$test->assertEquals(true, isset($reg->dependencies['group']->groupname->package), 'after group package isset 3');
$test->assertEquals(true, isset($group->package), 'after group package isset 4');

$group->package = null;

$test->assertEquals(false, isset($group->package), 'isset 1');
$test->assertEquals(false, isset($reg->dependencies['group']->groupname->package), 'isset 2');<?php
// all registry tests must pass this (as must PackageFile objects)

$test->assertEquals('usesrole', $reg->usesrole['foo']->type, 'type');

$test->assertEquals(0, count($reg->usesrole), 'none yet');
$test->assertEquals(false, isset($reg->usesrole['foo']), 'isset before');
$test->assertEquals(false, isset($reg->usesrole['foo']->package), 'isset package before');
$test->assertEquals(false, isset($reg->usesrole['foo']->channel), 'isset channel before');
$test->assertEquals(false, isset($reg->usesrole['foo']->uri), 'isset uri before');

$reg->usesrole['foo']->package('Foo')->channel('pear.example.com');

$test->assertEquals(1, count($reg->usesrole), '1 now');
$test->assertEquals(true, isset($reg->usesrole['foo']), 'isset after');
$test->assertEquals(true, isset($reg->usesrole['foo']->package), 'isset package after');
$test->assertEquals('Foo', $reg->usesrole['foo']->package, 'package after');
$test->assertEquals(true, isset($reg->usesrole['foo']->channel), 'isset channel after');
$test->assertEquals('pear.example.com', $reg->usesrole['foo']->channel, 'channel after');
$test->assertEquals(false, isset($reg->usesrole['foo']->uri), 'isset uri after');

$reg->usesrole['foo']->uri('http://poo.example.com');

$test->assertEquals(null, $reg->usesrole['foo']->channel, 'channel after uri');
$test->assertEquals(null, $reg->usesrole['foo']->package, 'package after uri');
$test->assertEquals(true, isset($reg->usesrole['foo']->uri), 'isset uri after set');
$test->assertEquals('http://poo.example.com', $reg->usesrole['foo']->uri, 'uri');

$reg->usesrole['foo']->channel('pear.example.com');

$test->assertEquals('pear.example.com', $reg->usesrole['foo']->channel, 'channel after uri');
$test->assertEquals(false, isset($reg->usesrole['foo']->uri), 'isset uri after set');
$test->assertEquals(null, $reg->usesrole['foo']->uri, 'uri');

$reg->usesrole['foo']->channel = 'localhost';
$test->assertEquals('localhost', $reg->usesrole['foo']->channel, 'channel after localhost');

$reg->usesrole['foo']->channel = null;
$test->assertEquals(null, $reg->usesrole['foo']->channel, 'channel after null');

$reg->usesrole['foo']->channel = 'localhost';
unset($reg->usesrole['foo']->channel);
$test->assertEquals(null, $reg->usesrole['foo']->channel, 'channel after unset');

$test->assertEquals(false, isset($reg->usesrole['notset']), 'notset before');
unset($reg->usesrole['notset']);
$test->assertEquals(false, isset($reg->usesrole['notset']), 'notset after');

$test->assertEquals(true, isset($reg->usesrole['foo']), 'foo before');
unset($reg->usesrole['foo']);
$test->assertEquals(false, isset($reg->usesrole['foo']), 'foo after');

$reg->usesrole['one']->channel('pear2.php.net')->package('Hi');
$reg->usesrole['two']->channel('pear2.php.net')->package('Hi2');

$testarr = array();
foreach ($reg->usesrole as $name => $info) {
    $test->assertIsa('PEAR2_Pyrus_PackageFile_v2_UsesRoleTask', $info, 'check class');
    $testarr[$name] = $info->getInfo();
}
$test->assertEquals(array(
    'one' => array(
        'role' => 'one',
        'package' => 'Hi',
        'channel' => 'pear2.php.net',
        'uri' => null,
    ),
    'two' => array(
        'role' => 'two',
        'package' => 'Hi2',
        'channel' => 'pear2.php.net',
        'uri' => null,
    ),
), $testarr, 'test iteration');
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for PEAR Installer dep
// defaults to min
$test->assertEquals(null, $reg->dependencies['required']->pearinstaller->max, 'before pearinstaller max set');
$reg->dependencies['required']->pearinstaller->min('2.0.1')->max('3.0.0');
$test->assertEquals('2.0.1', $reg->dependencies['required']->pearinstaller->min, 'after pearinstaller min set');
$test->assertEquals('3.0.0', $reg->dependencies['required']->pearinstaller->max, 'after pearinstaller max set');
<?php
// all registry tests must pass this (as must PackageFile objects)

$fake = new PEAR2_Pyrus_PackageFile_v2;
$task = $fake->usesrole['boo']->channel('pear2.php.net')->package('Boo');

$test->assertEquals(false, isset($reg->usesrole['boo']), 'isset before');
$test->assertEquals(0, count($reg->usesrole), 'count before');

$reg->usesrole['boo'] = $task;

$test->assertEquals(true, isset($reg->usesrole['boo']), 'isset after');
$test->assertEquals(1, count($reg->usesrole), 'count after');
$test->assertEquals('pear2.php.net', $reg->usesrole['boo']->channel, 'channel');
$test->assertEquals('Boo', $reg->usesrole['boo']->package, 'package');
$test->assertEquals(null, $reg->usesrole['boo']->uri, 'uri');

$task->uri('http://localhost/Boo.phar');

$reg->usesrole['boo'] = $task;

$test->assertEquals(true, isset($reg->usesrole['boo']), 'isset after 2');
$test->assertEquals(1, count($reg->usesrole), 'count after 2');
$test->assertEquals(null, $reg->usesrole['boo']->channel, 'channel 2');
$test->assertEquals(null, $reg->usesrole['boo']->package, 'package 2');
$test->assertEquals('http://localhost/Boo.phar', $reg->usesrole['boo']->uri, 'uri 2');
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// dependency group setup
$group = $reg->dependencies['group']->groupname;

$test->assertEquals(false, isset($reg->dependencies['group']->groupname->extension['extension']), 'before group extension isset 1');
$test->assertEquals(false, isset($group->extension['extension']), 'before group extension isset 2');
$test->assertEquals(false, isset($reg->dependencies['group']->groupname->extension), 'before group extension isset 3');
$test->assertEquals(false, isset($group->extension), 'before group extension isset 4');
$group->extension['extension']->save();
$test->assertEquals(true, isset($reg->dependencies['group']->groupname->extension['extension']), 'after group extension isset 1');
$test->assertEquals(true, isset($group->extension['extension']), 'after group extension isset 2');
$test->assertEquals(true, isset($reg->dependencies['group']->groupname->extension), 'after group extension isset 3');
$test->assertEquals(true, isset($group->extension), 'after group extension isset 4');

$group->extension = null;

$test->assertEquals(false, isset($group->extension), 'isset 1');
$test->assertEquals(false, isset($reg->dependencies['group']->groupname->extension), 'isset 2');<?php
// all registry tests must pass this (as must PackageFile objects)

$reg->type = 'extsrc';

$test->assertEquals(false, isset($reg->release[0]->configureoption), 'isset before');
$test->assertEquals(false, isset($reg->release[0]->configureoption['hi']), 'isset hi before');
$test->assertEquals(false, isset($reg->release[0]->configureoption['hi']->prompt), 'isset hi->prompt before');
$test->assertEquals(false, isset($reg->release[0]->configureoption['hi']->default), 'isset hi->default before');
$test->assertEquals(null, $reg->release[0]->configureoption['hi']->prompt, 'hi->prompt before');
$test->assertEquals(null, $reg->release[0]->configureoption['hi']->default, 'hi->default before');
$test->assertEquals(0, count($reg->release[0]->configureoption), 'count 0');

$reg->release[0]->configureoption['hi']->prompt('choose me! choose me!')->default('foo');

$test->assertEquals(true, isset($reg->release[0]->configureoption), 'isset after');
$test->assertEquals(true, isset($reg->release[0]->configureoption['hi']), 'isset hi after');
$test->assertEquals(true, isset($reg->release[0]->configureoption['hi']->prompt), 'isset hi->prompt after');
$test->assertEquals(true, isset($reg->release[0]->configureoption['hi']->default), 'isset hi->default after');
$test->assertEquals('choose me! choose me!', $reg->release[0]->configureoption['hi']->prompt, 'hi->prompt after');
$test->assertEquals('foo', $reg->release[0]->configureoption['hi']->default, 'hi->default after');
$test->assertEquals(1, count($reg->release[0]->configureoption), 'count 1');

unset($reg->release[0]->configureoption['hi']->prompt);

$test->assertEquals(null, $reg->release[0]->configureoption['hi']->prompt, 'hi->prompt after unset');

$reg->release[0]->configureoption['hi']->default(null);

$test->assertEquals(null, $reg->release[0]->configureoption['hi']->default, 'hi->default after = null');

$reg->release[0]->configureoption['hi']->prompt = 'another prompt';

$test->assertEquals('another prompt', $reg->release[0]->configureoption['hi']->prompt, 'hi->prompt another');

$test->assertEquals(false, isset($reg->release[0]->configureoption['notset']), 'notset before');

unset($reg->release[0]->configureoption['notset']);

$test->assertEquals(false, isset($reg->release[0]->configureoption['notset']), 'notset after');

$reg->release[0]->configureoption['hi2']->prompt('choose me! choose me!')->default('foo');

$stuff = array();
foreach ($reg->release[0]->configureoption as $key => $option) {
    $test->assertIsa('PEAR2_Pyrus_PackageFile_v2_Release_ConfigureOption', $option, 'right class');
    $stuff[$key] = $option->getInfo();
}
$test->assertEquals(array (
  'hi' => 
  array (
    'name' => 'hi',
    'prompt' => 'another prompt',
    'default' => NULL,
  ),
  'hi2' => 
  array (
    'name' => 'hi2',
    'default' => 'foo',
    'prompt' => 'choose me! choose me!',
  ),
), $stuff, 'info stuff');

unset($reg->release[0]->configureoption['hi']);

$test->assertEquals(false, isset($reg->release[0]->configureoption['hi']), 'after hi unset');
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;
// for PHP dep
// defaults to min
$test->assertEquals(false, isset($reg->dependencies['required']->php), 'before php isset');
$test->assertEquals(null, $reg->dependencies['required']->php->min, 'before php set');
$reg->dependencies['required']->php = '5.3.0';
$test->assertEquals('5.3.0', $reg->dependencies['required']->php->min, 'after php set');
$test->assertEquals(true, isset($reg->dependencies['required']->php), 'after php isset');<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// dependency group setup
$group = $reg->dependencies['group']->groupname;

$test->assertEquals(false, isset($reg->dependencies['group']->groupname->package['channel/PackageName2']), 'before group package min isset');
$test->assertEquals(false, isset($group->package['channel/PackageName2']), 'before group package min isset 2');
$test->assertEquals(null, $reg->dependencies['group']->groupname->package['channel/PackageName2']->min, 'before group package min');
$test->assertEquals(null, $group->package['channel/PackageName2']->min, 'before group package min 2');
$group->package['channel/PackageName2']->min('1.2.0');
$test->assertEquals(true, isset($reg->dependencies['group']->groupname->package['channel/PackageName2']), 'after group package min isset');
$test->assertEquals(true, isset($group->package['channel/PackageName2']), 'after group package min isset 2');
$test->assertEquals('1.2.0', $reg->dependencies['group']->groupname->package['channel/PackageName2']->min, 'after group package min');
$test->assertEquals('1.2.0', $group->package['channel/PackageName2']->min, 'after group package min 2');
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// dependency group setup
$group = $reg->dependencies['group']->groupname;

$test->assertEquals(false, isset($reg->dependencies['group']->groupname->subpackage['channel/PackageName2']), 'before group package min isset');
$test->assertEquals(false, isset($group->subpackage['channel/PackageName2']), 'before group package min isset 2');
$test->assertEquals(null, $reg->dependencies['group']->groupname->subpackage['channel/PackageName2']->min, 'before group package min');
$test->assertEquals(null, $group->subpackage['channel/PackageName2']->min, 'before group package min 2');
$group->subpackage['channel/PackageName2']->min('1.2.0');
$test->assertEquals(true, isset($reg->dependencies['group']->groupname->subpackage['channel/PackageName2']), 'after group package min isset');
$test->assertEquals(true, isset($group->subpackage['channel/PackageName2']), 'after group package min isset 2');
$test->assertEquals('1.2.0', $reg->dependencies['group']->groupname->subpackage['channel/PackageName2']->min, 'after group package min');
$test->assertEquals('1.2.0', $group->subpackage['channel/PackageName2']->min, 'after group package min 2');

$group->subpackage = null;

$test->assertEquals(false, isset($group->subpackage), 'isset 1');
$test->assertEquals(false, isset($reg->dependencies['group']->groupname->subpackage), 'isset 2');

$group->subpackage['channel/PackageName2']->min('1.2.0');

$test->assertEquals(true, isset($group->subpackage), 'isset subpackage');
unset($group->subpackage);
$test->assertEquals(false, isset($group->subpackage), 'isset subpackage after');
$test->assertEquals(false, isset($reg->dependencies['group']->groupname->subpackage), 'isset subpackage after');
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for regular arch deps
$fake = new PEAR2_Pyrus_PackageFile_v2;
$optional = $fake->dependencies['optional'];
$optional->extension['foo']->save();

$test->assertEquals(false, isset($reg->dependencies['optional']->extension['foo']), 'foo before');

$reg->dependencies['optional'] = $optional;

$test->assertEquals(true, isset($reg->dependencies['optional']->extension['foo']), 'foo after');
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for regular arch deps
$fake = new PEAR2_Pyrus_PackageFile_v2;
$package = $fake->dependencies['required']->subpackage;
$package['channel/Package1']->save();
$package['channel/Package2']->min('1.0.0');
$package['channel/Package3']->conflicts();

$test->assertEquals(false, isset($reg->dependencies['required']->subpackage['channel/Package1']), 'Package1 required before');
$test->assertEquals(false, isset($reg->dependencies['optional']->subpackage['channel/Package1']), 'Package1 optional before');
$test->assertEquals(false, isset($reg->dependencies['group']->groupname->subpackage['channel/Package1']), 'Package1 group before');

$test->assertEquals(null, $reg->dependencies['required']->subpackage['channel/Package2']->min, 'Package2 required before');
$test->assertEquals(null, $reg->dependencies['optional']->subpackage['channel/Package2']->min, 'Package2 optional before');
$test->assertEquals(null, $reg->dependencies['group']->groupname->subpackage['channel/Package2']->min, 'Package2 group before');

$test->assertEquals(false, $reg->dependencies['required']->subpackage['channel/Package3']->conflicts, 'Package3 required before');
$test->assertEquals(null, $reg->dependencies['optional']->subpackage['channel/Package3']->max, 'Package3 optional before');
$test->assertEquals(null, $reg->dependencies['group']->groupname->subpackage['channel/Package3']->max, 'Package3 group before');

$reg->dependencies['required']->subpackage = $package;
unset($package['channel/Package3']);
$package['channel/Package3']->max('2.0.0');
$reg->dependencies['optional']->subpackage = $package;
$reg->dependencies['group']->groupname->subpackage = $package;

$test->assertEquals(true, isset($reg->dependencies['required']->subpackage['channel/Package1']), 'Package1 required after');
$test->assertEquals(true, isset($reg->dependencies['optional']->subpackage['channel/Package1']), 'Package1 optional after');
$test->assertEquals(true, isset($reg->dependencies['group']->groupname->subpackage['channel/Package1']), 'Package1 group after');

$test->assertEquals('1.0.0', $reg->dependencies['required']->subpackage['channel/Package2']->min, 'Package2 required after');
$test->assertEquals('1.0.0', $reg->dependencies['optional']->subpackage['channel/Package2']->min, 'Package2 optional after');
$test->assertEquals('1.0.0', $reg->dependencies['group']->groupname->subpackage['channel/Package2']->min, 'Package2 group after');

$test->assertEquals(true, $reg->dependencies['required']->subpackage['channel/Package3']->conflicts, 'Package3 required after');
$test->assertEquals('2.0.0', $reg->dependencies['optional']->subpackage['channel/Package3']->max, 'Package3 optional after');
$test->assertEquals('2.0.0', $reg->dependencies['group']->groupname->subpackage['channel/Package3']->max, 'Package3 group after');
<?php
// all registry tests must pass this (as must PackageFile objects)

$reg->release[0]->installAs('src/SimpleChannelServer/REST/Release.php', 'php/PEAR2/SimpleChannelServer/REST/Release1.php');
$reg->release[0]->installAs('src/SimpleChannelServer/REST/Package.php', 'php/PEAR2/SimpleChannelServer/REST/Package1.php');
$reg->release[0]->ignore('src/SimpleChannelServer/REST/Package.php');
$reg->release[0]->ignore('src/SimpleChannelServer/REST/Category.php');

$test->assertEquals(array (
  'package' => 
  array (
    'attribs' => 
    array (
      'xmlns' => 'http://pear.php.net/dtd/package-2.0',
      'xmlns:tasks' => 'http://pear.php.net/dtd/tasks-1.0',
      'xmlns:xsi' => 'http://www.w3.org/2001/XMLSchema-instance',
      'version' => '2.0',
      'xsi:schemaLocation' => 'http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.0     http://pear.php.net/dtd/package-2.0.xsd',
    ),
    'name' => 'PEAR2_SimpleChannelServer',
    'channel' => 'pear2.php.net',
    'summary' => 'A Simple Channel Server for PEAR2 compatible channels
',
    'description' => '
This package contains a set of scripts to create a simple PEAR compatible
channel server. Included with the package is the pearscs command which you
can use for the command line to manage a pear channel.

The pearscs utility will be installed in the directory configured by the
bin_dir setting within Pyrus.
',
    'lead' => 
    array (
      0 => 
      array (
        'name' => 'Gregory Beaver',
        'user' => 'cellog',
        'email' => 'cellog@php.net',
        'active' => 'yes',
      ),
      1 => 
      array (
        'name' => 'Brett Bieber',
        'user' => 'saltybeagle',
        'email' => 'brett.bieber@gmail.com',
        'active' => 'yes',
      ),
    ),
    'date' => '2008-12-15',
    'time' => '11:51:01',
    'version' => 
    array (
      'release' => '0.1.0',
      'api' => '0.1.0',
    ),
    'stability' => 
    array (
      'release' => 'devel',
      'api' => 'alpha',
    ),
    'license' => 
    array (
      'attribs' => 
      array (
        'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
      ),
      '_content' => 'New BSD License',
    ),
    'notes' => 'First attempt.
',
    'contents' => 
    array (
      'dir' => 
      array (
        'attribs' => 
        array (
          'name' => '/',
        ),
        'file' => 
        array (
          0 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Release.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          1 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Package.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          2 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Manager.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          3 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Maintainer.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          4 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Category.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          5 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Get.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          6 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Exception.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          7 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/CLI.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          8 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Channel.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          9 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Categories/Exception.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          10 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Categories.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          11 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          12 => 
          array (
            'attribs' => 
            array (
              'role' => 'script',
              'name' => 'script/pearscs',
            ),
          ),
          13 => 
          array (
            'attribs' => 
            array (
              'role' => 'doc',
              'name' => 'doc/pear2.php.net/PEAR2_SimpleChannelServer/examples/examples/update_channel.php',
            ),
          ),
        ),
      ),
    ),
    'dependencies' => 
    array (
      'required' => 
      array (
        'php' => 
        array (
          'min' => '5.2.0',
          'exclude' => '5.2.8',
        ),
        'pearinstaller' => 
        array (
          'min' => '2.0.0a1',
        ),
        'package' => 
        array (
          0 => 
          array (
            'name' => 'File',
            'channel' => 'pear.php.net',
            'min' => '1.2.0',
          ),
          1 => 
          array (
            'name' => 'Other',
            'channel' => 'pear.php.net',
            'conflicts' => '',
          ),
          2 => 
          array (
            'name' => 'PackageName',
            'channel' => 'pecl.php.net',
            'min' => '1.1.0',
            'max' => '1.2.0',
            'recommended' => '1.1.1',
            'exclude' => 
            array (
              0 => '1.1.0a1',
              1 => '1.1.0a2',
            ),
            'providesextension' => 'packagename',
          ),
        ),
        'subpackage' => 
        array (
          'name' => 'Foo',
          'channel' => 'pear2.php.net',
          'min' => '1.0.0',
          'max' => '2.0.0',
          'recommended' => '1.2.0',
          'exclude' => 
          array (
            0 => '1.1.0',
            1 => '1.1.1',
          ),
        ),
        'extension' => 
        array (
          'name' => 'phar',
          'min' => '2.0.0',
          'exclude' => '2.0.1',
        ),
        'os' => 
        array (
          0 => 
          array (
            'name' => 'windows',
          ),
          1 => 
          array (
            'name' => 'vista',
            'conflicts' => '',
          ),
        ),
        'arch' => 
        array (
          'pattern' => 'i386',
        ),
      ),
      'optional' => 
      array (
        'package' => 
        array (
          'name' => 'PEAR',
          'channel' => 'pear.php.net',
          'min' => '1.7.0',
        ),
        'subpackage' => 
        array (
          'name' => 'Bar',
          'channel' => 'pear2.php.net',
          'min' => '1.5.0',
        ),
      ),
      'group' => 
      array (
        'attribs' => 
        array (
          'hint' => 'Install optional stuff as a group',
          'name' => 'name',
        ),
        'package' => 
        array (
          0 => 
          array (
            'name' => 'PackageName1',
            'channel' => 'pear2.php.net',
          ),
          1 => 
          array (
            'name' => 'PackageName2',
            'channel' => 'pear2.php.net',
            'min' => '1.2.0',
          ),
          2 => 
          array (
            'name' => 'PackageName',
            'channel' => 'pecl.php.net',
            'min' => '1.1.0',
            'max' => '1.2.0',
            'recommended' => '1.1.1',
            'exclude' => 
            array (
              0 => '1.1.0a1',
              1 => '1.1.0a2',
            ),
            'providesextension' => 'packagename',
          ),
        ),
        'subpackage' => 
        array (
          'name' => 'PackageName3',
          'channel' => 'pear2.php.net',
          'recommended' => '1.2.1',
        ),
        'extension' => 
        array (
          'name' => 'extension',
          'exclude' => array('5.2.8','5.2.9'),
        ),
      ),
    ),
    'phprelease' => 
    array (
      'filelist' => 
      array (
        'install' => 
        array (
          0 => 
          array (
            'attribs' => 
            array (
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Package.php',
              'as' => 'php/PEAR2/SimpleChannelServer/REST/Package1.php',
            ),
          ),
          1 => 
          array (
            'attribs' => 
            array (
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Release.php',
              'as' => 'php/PEAR2/SimpleChannelServer/REST/Release1.php',
            ),
          ),
        ),
        'ignore' => 
        array (
          0 => 
          array (
            'attribs' => 
            array (
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Category.php',
            ),
          ),
          1 => 
          array (
            'attribs' => 
            array (
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Package.php',
            ),
          ),
        ),
      ),
    ),
  ),
), $reg->toArray(true), 'toArray');<?php
// all registry tests must pass this (as must PackageFile objects)

$reg->release[0]->installAs('src/SimpleChannelServer/REST/Release.php', 'php/PEAR2/SimpleChannelServer/REST/Release1.php');
$reg->release[0]->installAs('src/SimpleChannelServer/REST/Package.php', 'php/PEAR2/SimpleChannelServer/REST/Package1.php');
$reg->release[0]->ignore('src/SimpleChannelServer/REST/Package.php');
$reg->release[0]->ignore('src/SimpleChannelServer/REST/Category.php');
$reg->release[1]->installconditions['php'] = '5.2.0';

$test->assertEquals(array (
  'package' => 
  array (
    'attribs' => 
    array (
      'xmlns' => 'http://pear.php.net/dtd/package-2.0',
      'xmlns:tasks' => 'http://pear.php.net/dtd/tasks-1.0',
      'xmlns:xsi' => 'http://www.w3.org/2001/XMLSchema-instance',
      'version' => '2.0',
      'xsi:schemaLocation' => 'http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.0     http://pear.php.net/dtd/package-2.0.xsd',
    ),
    'name' => 'PEAR2_SimpleChannelServer',
    'channel' => 'pear2.php.net',
    'summary' => 'A Simple Channel Server for PEAR2 compatible channels
',
    'description' => '
This package contains a set of scripts to create a simple PEAR compatible
channel server. Included with the package is the pearscs command which you
can use for the command line to manage a pear channel.

The pearscs utility will be installed in the directory configured by the
bin_dir setting within Pyrus.
',
    'lead' => 
    array (
      0 => 
      array (
        'name' => 'Gregory Beaver',
        'user' => 'cellog',
        'email' => 'cellog@php.net',
        'active' => 'yes',
      ),
      1 => 
      array (
        'name' => 'Brett Bieber',
        'user' => 'saltybeagle',
        'email' => 'brett.bieber@gmail.com',
        'active' => 'yes',
      ),
    ),
    'date' => '2008-12-15',
    'time' => '11:51:01',
    'version' => 
    array (
      'release' => '0.1.0',
      'api' => '0.1.0',
    ),
    'stability' => 
    array (
      'release' => 'devel',
      'api' => 'alpha',
    ),
    'license' => 
    array (
      'attribs' => 
      array (
        'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
      ),
      '_content' => 'New BSD License',
    ),
    'notes' => 'First attempt.
',
    'contents' => 
    array (
      'dir' => 
      array (
        'attribs' => 
        array (
          'name' => '/',
        ),
        'file' => 
        array (
          0 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Release.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          1 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Package.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          2 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Manager.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          3 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Maintainer.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          4 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Category.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          5 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Get.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          6 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Exception.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          7 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/CLI.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          8 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Channel.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          9 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Categories/Exception.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          10 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Categories.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          11 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          12 => 
          array (
            'attribs' => 
            array (
              'role' => 'script',
              'name' => 'script/pearscs',
            ),
          ),
          13 => 
          array (
            'attribs' => 
            array (
              'role' => 'doc',
              'name' => 'doc/pear2.php.net/PEAR2_SimpleChannelServer/examples/examples/update_channel.php',
            ),
          ),
        ),
      ),
    ),
    'dependencies' => 
    array (
      'required' => 
      array (
        'php' => 
        array (
          'min' => '5.2.0',
          'exclude' => '5.2.8',
        ),
        'pearinstaller' => 
        array (
          'min' => '2.0.0a1',
        ),
        'package' => 
        array (
          0 => 
          array (
            'name' => 'File',
            'channel' => 'pear.php.net',
            'min' => '1.2.0',
          ),
          1 => 
          array (
            'name' => 'Other',
            'channel' => 'pear.php.net',
            'conflicts' => '',
          ),
          2 => 
          array (
            'name' => 'PackageName',
            'channel' => 'pecl.php.net',
            'min' => '1.1.0',
            'max' => '1.2.0',
            'recommended' => '1.1.1',
            'exclude' => 
            array (
              0 => '1.1.0a1',
              1 => '1.1.0a2',
            ),
            'providesextension' => 'packagename',
          ),
        ),
        'subpackage' => 
        array (
          'name' => 'Foo',
          'channel' => 'pear2.php.net',
          'min' => '1.0.0',
          'max' => '2.0.0',
          'recommended' => '1.2.0',
          'exclude' => 
          array (
            0 => '1.1.0',
            1 => '1.1.1',
          ),
        ),
        'extension' => 
        array (
          'name' => 'phar',
          'min' => '2.0.0',
          'exclude' => '2.0.1',
        ),
        'os' => 
        array (
          0 => 
          array (
            'name' => 'windows',
          ),
          1 => 
          array (
            'name' => 'vista',
            'conflicts' => '',
          ),
        ),
        'arch' => 
        array (
          'pattern' => 'i386',
        ),
      ),
      'optional' => 
      array (
        'package' => 
        array (
          'name' => 'PEAR',
          'channel' => 'pear.php.net',
          'min' => '1.7.0',
        ),
        'subpackage' => 
        array (
          'name' => 'Bar',
          'channel' => 'pear2.php.net',
          'min' => '1.5.0',
        ),
      ),
      'group' => 
      array (
        'attribs' => 
        array (
          'hint' => 'Install optional stuff as a group',
          'name' => 'name',
        ),
        'package' => 
        array (
          0 => 
          array (
            'name' => 'PackageName1',
            'channel' => 'pear2.php.net',
          ),
          1 => 
          array (
            'name' => 'PackageName2',
            'channel' => 'pear2.php.net',
            'min' => '1.2.0',
          ),
          2 => 
          array (
            'name' => 'PackageName',
            'channel' => 'pecl.php.net',
            'min' => '1.1.0',
            'max' => '1.2.0',
            'recommended' => '1.1.1',
            'exclude' => 
            array (
              0 => '1.1.0a1',
              1 => '1.1.0a2',
            ),
            'providesextension' => 'packagename',
          ),
        ),
        'subpackage' => 
        array (
          'name' => 'PackageName3',
          'channel' => 'pear2.php.net',
          'recommended' => '1.2.1',
        ),
        'extension' => 
        array (
          'name' => 'extension',
          'exclude' => array('5.2.8','5.2.9'),
        ),
      ),
    ),
    'phprelease' => 
    array (
      0 => 
      array (
        'filelist' => 
        array (
          'install' => 
          array (
            0 => 
            array (
              'attribs' => 
              array (
                'name' => 'php/PEAR2/SimpleChannelServer/REST/Package.php',
                'as' => 'php/PEAR2/SimpleChannelServer/REST/Package1.php',
              ),
            ),
            1 => 
            array (
              'attribs' => 
              array (
                'name' => 'php/PEAR2/SimpleChannelServer/REST/Release.php',
                'as' => 'php/PEAR2/SimpleChannelServer/REST/Release1.php',
              ),
            ),
          ),
          'ignore' => 
          array (
            0 => 
            array (
              'attribs' => 
              array (
                'name' => 'php/PEAR2/SimpleChannelServer/REST/Category.php',
              ),
            ),
            1 => 
            array (
              'attribs' => 
              array (
                'name' => 'php/PEAR2/SimpleChannelServer/REST/Package.php',
              ),
            ),
          ),
        ),
      ),
      1 => 
      array (
        'installcondition' => 
        array (
          'php' => 
          array (
            'min' => '5.2.0',
          ),
        ),
      ),
    ),
  ),
), $reg->toArray(true), 'toArray');<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for conflicting package dep
$test->assertEquals(false, $reg->dependencies['required']->subpackage['channel/PackageName']->conflicts, 'before conflicts required');
$reg->dependencies['required']->subpackage['channel/PackageName']->conflicts();
$test->assertEquals(true, $reg->dependencies['required']->subpackage['channel/PackageName']->conflicts, 'after conflicts required 1');
$reg->dependencies['required']->subpackage['channel/PackageName']->conflicts(false);
$test->assertEquals(false, $reg->dependencies['required']->subpackage['channel/PackageName']->conflicts, 'after conflicts required 2');<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for regular arch deps
$fake = new PEAR2_Pyrus_PackageFile_v2;
$group = $fake->dependencies['group']->groupname;
$group->extension['foo']->save();

$test->assertEquals(false, isset($reg->dependencies['group']->groupname->extension['foo']), 'foo before');

$reg->dependencies['group'] = $group;

$test->assertEquals(true, isset($reg->dependencies['group']->groupname->extension['foo']), 'foo after');
<?php
// all registry tests must pass this (as must PackageFile objects)

// for code coverage
unset($reg->dependencies['group']->name->extension);

$test->assertEquals(array (
  'package' => 
  array (
    'attribs' => 
    array (
      'xmlns' => 'http://pear.php.net/dtd/package-2.0',
      'xmlns:tasks' => 'http://pear.php.net/dtd/tasks-1.0',
      'xmlns:xsi' => 'http://www.w3.org/2001/XMLSchema-instance',
      'version' => '2.0',
      'xsi:schemaLocation' => 'http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.0     http://pear.php.net/dtd/package-2.0.xsd',
    ),
    'name' => 'PEAR2_SimpleChannelServer',
    'channel' => 'pear2.php.net',
    'summary' => 'A Simple Channel Server for PEAR2 compatible channels
',
    'description' => '
This package contains a set of scripts to create a simple PEAR compatible
channel server. Included with the package is the pearscs command which you
can use for the command line to manage a pear channel.

The pearscs utility will be installed in the directory configured by the
bin_dir setting within Pyrus.
',
    'lead' => 
    array (
      0 => 
      array (
        'name' => 'Gregory Beaver',
        'user' => 'cellog',
        'email' => 'cellog@php.net',
        'active' => 'yes',
      ),
      1 => 
      array (
        'name' => 'Brett Bieber',
        'user' => 'saltybeagle',
        'email' => 'brett.bieber@gmail.com',
        'active' => 'yes',
      ),
    ),
    'date' => '2008-12-15',
    'time' => '11:51:01',
    'version' => 
    array (
      'release' => '0.1.0',
      'api' => '0.1.0',
    ),
    'stability' => 
    array (
      'release' => 'devel',
      'api' => 'alpha',
    ),
    'license' => 
    array (
      'attribs' => 
      array (
        'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
      ),
      '_content' => 'New BSD License',
    ),
    'notes' => 'First attempt.
',
    'contents' => 
    array (
      'dir' => 
      array (
        'attribs' => 
        array (
          'name' => '/',
        ),
        'file' => 
        array (
          0 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/REST/Release.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          1 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/REST/Package.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          2 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/REST/Manager.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          3 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/REST/Maintainer.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          4 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/REST/Category.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          5 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/Get.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          6 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/Exception.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          7 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/CLI.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          8 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/Channel.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          9 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/Categories/Exception.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          10 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/Categories.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          11 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          12 => 
          array (
            'attribs' => 
            array (
              'role' => 'script',
              'name' => 'scripts/pearscs',
            ),
          ),
          13 => 
          array (
            'attribs' => 
            array (
              'role' => 'doc',
              'name' => 'examples/update_channel.php',
            ),
          ),
        ),
      ),
    ),
    'dependencies' => 
    array (
      'required' => 
      array (
        'php' => 
        array (
          'min' => '5.2.0',
          'exclude' => '5.2.8',
        ),
        'pearinstaller' => 
        array (
          'min' => '2.0.0a1',
        ),
        'package' => 
        array (
          0 => 
          array (
            'name' => 'File',
            'channel' => 'pear.php.net',
            'min' => '1.2.0',
          ),
          1 => 
          array (
            'name' => 'Other',
            'channel' => 'pear.php.net',
            'conflicts' => '',
          ),
          2 => 
          array (
            'name' => 'PackageName',
            'channel' => 'pecl.php.net',
            'min' => '1.1.0',
            'max' => '1.2.0',
            'recommended' => '1.1.1',
            'exclude' => 
            array (
              0 => '1.1.0a1',
              1 => '1.1.0a2',
            ),
            'providesextension' => 'packagename',
          ),
        ),
        'subpackage' => 
        array (
          'name' => 'Foo',
          'channel' => 'pear2.php.net',
          'min' => '1.0.0',
          'max' => '2.0.0',
          'recommended' => '1.2.0',
          'exclude' => 
          array (
            0 => '1.1.0',
            1 => '1.1.1',
          ),
        ),
        'extension' => 
        array (
          'name' => 'phar',
          'min' => '2.0.0',
          'exclude' => '2.0.1',
        ),
        'os' => 
        array (
          0 => 
          array (
            'name' => 'windows',
          ),
          1 => 
          array (
            'name' => 'vista',
            'conflicts' => '',
          ),
        ),
        'arch' => 
        array (
          'pattern' => 'i386',
        ),
      ),
      'optional' => 
      array (
        'package' => 
        array (
          'name' => 'PEAR',
          'channel' => 'pear.php.net',
          'min' => '1.7.0',
        ),
        'subpackage' => 
        array (
          'name' => 'Bar',
          'channel' => 'pear2.php.net',
          'min' => '1.5.0',
        ),
      ),
      'group' => 
      array (
        'attribs' => 
        array (
          'hint' => 'Install optional stuff as a group',
          'name' => 'name',
        ),
        'package' => 
        array (
          0 => 
          array (
            'name' => 'PackageName1',
            'channel' => 'pear2.php.net',
          ),
          1 => 
          array (
            'name' => 'PackageName2',
            'channel' => 'pear2.php.net',
            'min' => '1.2.0',
          ),
          2 => 
          array (
            'name' => 'PackageName',
            'channel' => 'pecl.php.net',
            'min' => '1.1.0',
            'max' => '1.2.0',
            'recommended' => '1.1.1',
            'exclude' => 
            array (
              0 => '1.1.0a1',
              1 => '1.1.0a2',
            ),
            'providesextension' => 'packagename',
          ),
        ),
        'subpackage' => 
        array (
          'name' => 'PackageName3',
          'channel' => 'pear2.php.net',
          'recommended' => '1.2.1',
        ),
      ),
    ),
    'phprelease' => '',
  ),
), $reg->toArray(), 'toArray');<?php
// all registry tests must pass this (as must PackageFile objects)

$reg->type = 'extsrc';

try {
    $a = $reg->release[0]->configureoption['hi']['name'];
    throw new Exception ('[hi][name] worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('use -> operator to access properties of a configureoption', $e->getMessage(), '[hi][name]');
}

try {
    $reg->release[0]->configureoption['hi']['name'] = $reg->release[0]->configureoption['hi'];
    throw new Exception ('[hi][name] = worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('use -> operator to access properties of a configureoption', $e->getMessage(), '[hi][name] =');
}

try {
    isset($reg->release[0]->configureoption['hi']['name']);
    throw new Exception ('isset([hi][name]) worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('use -> operator to access properties of a configureoption', $e->getMessage(), 'isset([hi][name])');
}

try {
    unset($reg->release[0]->configureoption['hi']['name']);
    throw new Exception ('unset([hi][name]) worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('use -> operator to access properties of a configureoption', $e->getMessage(), 'unset([hi][name])');
}

try {
    $a = $reg->release[0]->configureoption->hi;
    throw new Exception ('->hi worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('use [] operator to access configureoptions', $e->getMessage(), '->hi');
}

try {
    $reg->release[0]->configureoption->hi = '';
    throw new Exception ('->hi = worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('use [] operator to access configureoptions', $e->getMessage(), '->hi =');
}

try {
    isset($reg->release[0]->configureoption->hi);
    throw new Exception ('isset(->hi) = worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('use [] operator to access configureoptions', $e->getMessage(), 'isset(->hi)');
}

try {
    unset($reg->release[0]->configureoption->hi);
    throw new Exception ('unset(->hi) = worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('use [] operator to access configureoptions', $e->getMessage(), 'unset(->hi)');
}

try {
    $reg->release[0]->configureoption->hi();
    throw new Exception ('->hi() = worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('use [] operator to access configureoptions', $e->getMessage(), '->hi()');
}

try {
    $reg->release[0]->configureoption['hi'] = $reg->release[0]->configureoption['bye'];
    throw new Exception ('hi = bye worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('use [] or [\'bye\'] to set this configureoption', $e->getMessage(), 'hi = bye');
}

try {
    $reg->release[0]->configureoption['hi'] = 1;
    throw new Exception ('hi = 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Can only set configureoption to a PEAR2_Pyrus_PackageFile_v2_Release_ConfigureOption object', $e->getMessage(), 'hi = 1');
}


try {
    unset($reg->release[0]->configureoption['hi']->hi);
    throw new Exception ('unset([hi]->hi) = worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Unknown variable hi, must be one of name, default, prompt', $e->getMessage(), 'unset([hi]->hi)');
}

try {
    isset($reg->release[0]->configureoption['hi']->hi);
    throw new Exception ('isset([hi]->hi) = worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Unknown variable hi, must be one of name, default, prompt', $e->getMessage(), 'isset([hi]->hi)');
}

try {
    $reg->release[0]->configureoption['hi']->hi = '';
    throw new Exception ('[hi]->hi = worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Unknown variable hi, must be one of name, default, prompt', $e->getMessage(), '[hi]->hi =');
}

try {
    $a = $reg->release[0]->configureoption['hi']->hi;
    throw new Exception ('[hi]->hi worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Unknown variable hi, must be one of name, default, prompt', $e->getMessage(), '[hi]->hi');
}

try {
    $a = $reg->release[0]->configureoption['hi']->hi();
    throw new Exception ('[hi]->hi() worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Unknown variable hi, must be one of name, default, prompt', $e->getMessage(), '[hi]->hi()');
}

<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for PEAR Installer dep
// defaults to min
$test->assertEquals(false, isset($reg->dependencies['required']->pearinstaller), 'before pearinstaller isset');
$test->assertEquals(null, $reg->dependencies['required']->pearinstaller->min, 'before pearinstaller set');
$reg->dependencies['required']->pearinstaller = '2.0.0';
$test->assertEquals('2.0.0', $reg->dependencies['required']->pearinstaller->min, 'after pearinstaller set');
$test->assertEquals(true, isset($reg->dependencies['required']->pearinstaller), 'after pearinstaller isset');
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for required/optional package deps or subpackage deps
$test->assertEquals(false, isset($reg->dependencies['required']->package), 'before package isset 1');
$test->assertEquals(false, isset($reg->dependencies['required']->package['channel/PackageName']), 'before package isset 2');
$test->assertEquals(null, $reg->dependencies['required']->package['channel/PackageName']->min, 'before package required min set');
$test->assertEquals(null, $reg->dependencies['required']->package['channel/PackageName']->max, 'before package required max set');
$test->assertEquals(null, $reg->dependencies['required']->package['channel/PackageName']->recommended, 'before package required recommended set');
$test->assertEquals(null, $reg->dependencies['required']->package['channel/PackageName']->exclude, 'before package required exclude set');
$reg->dependencies['required']->package['channel/PackageName']->min('1.1.0')->max('1.2.0')->recommended('1.1.1')
    ->exclude('1.1.0a1')->exclude('1.1.0a2');
$test->assertEquals('1.1.0', $reg->dependencies['required']->package['channel/PackageName']->min, 'after package required min set');
$test->assertEquals('1.2.0', $reg->dependencies['required']->package['channel/PackageName']->max, 'after package required max set');
$test->assertEquals('1.1.1', $reg->dependencies['required']->package['channel/PackageName']->recommended, 'after package required recommended set');
$test->assertEquals(array('1.1.0a1', '1.1.0a2'), $reg->dependencies['required']->package['channel/PackageName']->exclude, 'after package required exclude set');
$test->assertEquals(true, isset($reg->dependencies['required']->package), 'after package isset 1');
$test->assertEquals(true, isset($reg->dependencies['required']->package['channel/PackageName']), 'after package isset 2');

foreach ($reg->dependencies['required']->package as $name => $obj) {
    $test->assertEquals('channel/PackageName', $name, 'iteration key test');
}<?php
// all registry tests must pass this (as must PackageFile objects)

// for code coverage
unset($reg->dependencies['group']->name->extension);

$reg->setFilelist(array(
    'onefile.php' => array('attribs' => array('name' => 'onefile.php', 'role' => 'php'))
));

$test->assertEquals(array (
  'package' => 
  array (
    'attribs' => 
    array (
      'xmlns' => 'http://pear.php.net/dtd/package-2.0',
      'xmlns:tasks' => 'http://pear.php.net/dtd/tasks-1.0',
      'xmlns:xsi' => 'http://www.w3.org/2001/XMLSchema-instance',
      'version' => '2.0',
      'xsi:schemaLocation' => 'http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.0     http://pear.php.net/dtd/package-2.0.xsd',
    ),
    'name' => 'PEAR2_SimpleChannelServer',
    'channel' => 'pear2.php.net',
    'summary' => 'A Simple Channel Server for PEAR2 compatible channels
',
    'description' => '
This package contains a set of scripts to create a simple PEAR compatible
channel server. Included with the package is the pearscs command which you
can use for the command line to manage a pear channel.

The pearscs utility will be installed in the directory configured by the
bin_dir setting within Pyrus.
',
    'lead' => 
    array (
      0 => 
      array (
        'name' => 'Gregory Beaver',
        'user' => 'cellog',
        'email' => 'cellog@php.net',
        'active' => 'yes',
      ),
      1 => 
      array (
        'name' => 'Brett Bieber',
        'user' => 'saltybeagle',
        'email' => 'brett.bieber@gmail.com',
        'active' => 'yes',
      ),
    ),
    'date' => '2008-12-15',
    'time' => '11:51:01',
    'version' => 
    array (
      'release' => '0.1.0',
      'api' => '0.1.0',
    ),
    'stability' => 
    array (
      'release' => 'devel',
      'api' => 'alpha',
    ),
    'license' => 
    array (
      'attribs' => 
      array (
        'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
      ),
      '_content' => 'New BSD License',
    ),
    'notes' => 'First attempt.
',
    'contents' => 
    array (
      'dir' => 
      array (
        'attribs' => 
        array (
          'name' => '/',
        ),
        'file' => 
        array (
          'attribs' => 
          array (
            'name' => 'onefile.php',
            'role' => 'php',
          ),
        ),
      ),
    ),
    'dependencies' => 
    array (
      'required' => 
      array (
        'php' => 
        array (
          'min' => '5.2.0',
          'exclude' => '5.2.8',
        ),
        'pearinstaller' => 
        array (
          'min' => '2.0.0a1',
        ),
        'package' => 
        array (
          0 => 
          array (
            'name' => 'File',
            'channel' => 'pear.php.net',
            'min' => '1.2.0',
          ),
          1 => 
          array (
            'name' => 'Other',
            'channel' => 'pear.php.net',
            'conflicts' => '',
          ),
          2 => 
          array (
            'name' => 'PackageName',
            'channel' => 'pecl.php.net',
            'min' => '1.1.0',
            'max' => '1.2.0',
            'recommended' => '1.1.1',
            'exclude' => 
            array (
              0 => '1.1.0a1',
              1 => '1.1.0a2',
            ),
            'providesextension' => 'packagename',
          ),
        ),
        'subpackage' => 
        array (
          'name' => 'Foo',
          'channel' => 'pear2.php.net',
          'min' => '1.0.0',
          'max' => '2.0.0',
          'recommended' => '1.2.0',
          'exclude' => 
          array (
            0 => '1.1.0',
            1 => '1.1.1',
          ),
        ),
        'extension' => 
        array (
          'name' => 'phar',
          'min' => '2.0.0',
          'exclude' => '2.0.1',
        ),
        'os' => 
        array (
          0 => 
          array (
            'name' => 'windows',
          ),
          1 => 
          array (
            'name' => 'vista',
            'conflicts' => '',
          ),
        ),
        'arch' => 
        array (
          'pattern' => 'i386',
        ),
      ),
      'optional' => 
      array (
        'package' => 
        array (
          'name' => 'PEAR',
          'channel' => 'pear.php.net',
          'min' => '1.7.0',
        ),
        'subpackage' => 
        array (
          'name' => 'Bar',
          'channel' => 'pear2.php.net',
          'min' => '1.5.0',
        ),
      ),
      'group' => 
      array (
        'attribs' => 
        array (
          'hint' => 'Install optional stuff as a group',
          'name' => 'name',
        ),
        'package' => 
        array (
          0 => 
          array (
            'name' => 'PackageName1',
            'channel' => 'pear2.php.net',
          ),
          1 => 
          array (
            'name' => 'PackageName2',
            'channel' => 'pear2.php.net',
            'min' => '1.2.0',
          ),
          2 => 
          array (
            'name' => 'PackageName',
            'channel' => 'pecl.php.net',
            'min' => '1.1.0',
            'max' => '1.2.0',
            'recommended' => '1.1.1',
            'exclude' => 
            array (
              0 => '1.1.0a1',
              1 => '1.1.0a2',
            ),
            'providesextension' => 'packagename',
          ),
        ),
        'subpackage' => 
        array (
          'name' => 'PackageName3',
          'channel' => 'pear2.php.net',
          'recommended' => '1.2.1',
        ),
      ),
    ),
    'phprelease' => '',
  ),
), $reg->toArray(), 'toArray');<?php
// all registry tests must pass this (as must PackageFile objects)

$reg->type = 'extsrc';

$test->assertEquals(false, isset($reg->release[0]->binarypackage), 'isset before');
$test->assertEquals(false, isset($reg->release[0]->binarypackage['hi']), 'test hi isset before');
$test->assertEquals(null, $reg->release[0]->binarypackage['hi'], 'hi value before');
$test->assertEquals(0, count($reg->release[0]->binarypackage), 'count 0');

$reg->release[0]->binarypackage[] = 'hi';

$test->assertEquals(true, isset($reg->release[0]->binarypackage), 'isset after');
$test->assertEquals(true, isset($reg->release[0]->binarypackage['hi']), 'test hi isset');
$test->assertEquals('hi', $reg->release[0]->binarypackage['hi'], 'hi value');
$test->assertEquals(1, count($reg->release[0]->binarypackage), 'count 1');

$reg->release[0]->binarypackage[] = 'two';

$test->assertEquals(true, isset($reg->release[0]->binarypackage['two']), 'test two isset');
$test->assertEquals(2, count($reg->release[0]->binarypackage), 'count 2');

$testarr = array();
foreach ($reg->release[0]->binarypackage as $name => $p) {
    $testarr[$name] = $p;
}
$test->assertEquals(array('hi' => 'hi', 'two' => 'two'), $testarr, 'testarr');

unset($reg->release[0]->binarypackage['hi']);
$test->assertEquals(false, isset($reg->release[0]->binarypackage['hi']), 'test hi isset after');

try {
    $reg->release[0]->binarypackage[] = 1;
    throw new Exception('= 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Can only set binarypackage to string', $e->getMessage(), 'message');
}
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for regular arch deps
$fake = new PEAR2_Pyrus_PackageFile_v2;
$os = $fake->dependencies['required']->os;
$os['windows'] = false;
$os['OS/2'] = false;
$os['linux'] = true;

$test->assertEquals(null, $reg->dependencies['required']->os['windows'], 'windows before');
$test->assertEquals(null, $reg->dependencies['required']->os['OS/2'], 'OS/2 before');
$test->assertEquals(null, $reg->dependencies['required']->os['linux'], 'linux before');

$reg->dependencies['required']->os = $os;

$test->assertEquals(false, $reg->dependencies['required']->os['windows'], 'windows after');
$test->assertEquals(false, $reg->dependencies['required']->os['OS/2'], 'OS/2 after');
$test->assertEquals(true, $reg->dependencies['required']->os['linux'], 'linux after');
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;
// for PHP dep

$test->assertEquals(null, $reg->dependencies['required']->php->max, 'before php max set');
$test->assertEquals(null, $reg->dependencies['required']->php->min, 'before php min set');
$test->assertEquals(null, $reg->dependencies['required']->php->exclude, 'before php exclude set');
$reg->dependencies['required']->php->min('5.3.1')->max('7.0.0')->exclude('6.1.2');
$test->assertEquals('7.0.0', $reg->dependencies['required']->php->max, 'after php max set');
$test->assertEquals('5.3.1', $reg->dependencies['required']->php->min, 'after php min set');
$test->assertEquals(array('6.1.2'), $reg->dependencies['required']->php->exclude, 'after php exclude set');

$reg->dependencies['required']->php = null;
$test->assertEquals(null, $reg->dependencies['required']->php->max, 'after reset max');
$test->assertEquals(null, $reg->dependencies['required']->php->min, 'after reset min');
$test->assertEquals(null, $reg->dependencies['required']->php->exclude, 'after reset exclude');<?php
// all registry tests must pass this (as must PackageFile objects)

$reg->type = 'extsrc';

$fake = new PEAR2_Pyrus_PackageFile_v2;

$fake->type = 'extsrc';

$reg->release[0]->configureoption['foo'] = $fake->release[0]->configureoption['foo']->prompt('hi there')->default('bar');

$test->assertEquals('hi there', $reg->release[0]->configureoption['foo']->prompt, 'prompt');
$test->assertEquals('bar', $reg->release[0]->configureoption['foo']->default, 'default');
$test->assertEquals(1, count($reg->release[0]->configureoption), 'count 1');

$reg->release[0]->configureoption['foo'] = $fake->release[0]->configureoption['foo']->prompt('hi there')->default('bar');

$test->assertEquals('hi there', $reg->release[0]->configureoption['foo']->prompt, 'prompt 2');
$test->assertEquals('bar', $reg->release[0]->configureoption['foo']->default, 'default ');
$test->assertEquals(1, count($reg->release[0]->configureoption), 'count 1.1');
<?php
// all registry tests must pass this (as must PackageFile objects)

$test->assertEquals(false, isset($reg->compatible['test/test']), 'isset before');
$reg->compatible['test/test']->min('1.2.3')->max('1.4.5')->exclude('1.2.1');
$test->assertEquals(true, isset($reg->compatible['test/test']), 'isset after');
$test->assertEquals('1.2.3', $reg->compatible['test/test']->min, 'min');
$test->assertEquals('1.4.5', $reg->compatible['test/test']->max, 'max');
$test->assertEquals(array('1.2.1'), $reg->compatible['test/test']->exclude, 'exclude');

$reg->compatible['test/test']->exclude('1.2.2');
$test->assertEquals(array('1.2.1', '1.2.2'), $reg->compatible['test/test']->exclude, 'exclude');

$reg->compatible['test/test']->min('1.3.4');
$test->assertEquals('1.3.4', $reg->compatible['test/test']->min, 'min 2');
$reg->compatible['test/test']->min = null;
$test->assertEquals(null, $reg->compatible['test/test']->min, 'min null');

unset($reg->compatible['test/test']);
$test->assertEquals(false, isset($reg->compatible['test/test']), 'unset');
unset($reg->compatible['test/test']);
$test->assertEquals(false, isset($reg->compatible['test/test']), 'unset 2');

foreach ($reg->compatible as $name => $obj) {
    $test->assertEquals('test/test', $name, 'iteration test');
    $test->assertIsa('PEAR2_Pyrus_PackageFile_v2_Compatible', $obj, 'right class');
}
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for regular arch deps
$fake = new PEAR2_Pyrus_PackageFile_v2;
$subpackage = $fake->dependencies['required']->subpackage;
$subpackage['channel/Subpackage1']->save();
$subpackage['channel/Subpackage2']->min('1.0.0');

$test->assertEquals(false, isset($reg->dependencies['required']->subpackage['channel/Subpackage1']), 'Subpackage1 required before');
$test->assertEquals(false, isset($reg->dependencies['optional']->subpackage['channel/Subpackage1']), 'Subpackage1 optional before');
$test->assertEquals(false, isset($reg->dependencies['group']->groupname->subpackage['channel/Subpackage1']), 'Subpackage1 group before');

$test->assertEquals(null, $reg->dependencies['required']->subpackage['channel/Subpackage2']->min, 'Subpackage2 required before');
$test->assertEquals(null, $reg->dependencies['optional']->subpackage['channel/Subpackage2']->min, 'Subpackage2 optional before');
$test->assertEquals(null, $reg->dependencies['group']->groupname->subpackage['channel/Subpackage2']->min, 'Subpackage2 group before');

$test->assertEquals(false, $reg->dependencies['required']->subpackage['channel/Subpackage3']->conflicts, 'Subpackage3 required before');
$test->assertEquals(null, $reg->dependencies['optional']->subpackage['channel/Subpackage3']->max, 'Subpackage3 optional before');
$test->assertEquals(null, $reg->dependencies['group']->groupname->subpackage['channel/Subpackage3']->max, 'Subpackage3 group before');

$reg->dependencies['required']->subpackage['channel/Subpackage1'] = $subpackage['channel/Subpackage1'];
$reg->dependencies['required']->subpackage[] = $subpackage['channel/Subpackage2'];
$reg->dependencies['optional']->subpackage['channel/Subpackage1'] = $subpackage['channel/Subpackage1'];
$reg->dependencies['optional']->subpackage[] = $subpackage['channel/Subpackage2'];
$reg->dependencies['group']->groupname->subpackage['channel/Subpackage1'] = $subpackage['channel/Subpackage1'];
$reg->dependencies['group']->groupname->subpackage[] = $subpackage['channel/Subpackage2'];

$test->assertEquals(true, isset($reg->dependencies['required']->subpackage['channel/Subpackage1']), 'Subpackage1 required after');
$test->assertEquals(true, isset($reg->dependencies['optional']->subpackage['channel/Subpackage1']), 'Subpackage1 optional after');
$test->assertEquals(true, isset($reg->dependencies['group']->groupname->subpackage['channel/Subpackage1']), 'Subpackage1 group after');

$test->assertEquals('1.0.0', $reg->dependencies['required']->subpackage['channel/Subpackage2']->min, 'Subpackage2 required after');
$test->assertEquals('1.0.0', $reg->dependencies['optional']->subpackage['channel/Subpackage2']->min, 'Subpackage2 optional after');
$test->assertEquals('1.0.0', $reg->dependencies['group']->groupname->subpackage['channel/Subpackage2']->min, 'Subpackage2 group after');<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for required/optional package deps or subpackage deps

$test->assertEquals(false, isset($reg->dependencies['required']->package['__uri/test']), 'isset before');
$test->assertEquals(null, $reg->dependencies['required']->package['__uri/test']->min, 'min before');

$reg->dependencies['required']->package['__uri/test']->min('1.0.0');

$test->assertEquals(true, isset($reg->dependencies['required']->package['__uri/test']), 'isset after');
$test->assertEquals('1.0.0', $reg->dependencies['required']->package['__uri/test']->min, 'min after');
$test->assertEquals('__uri', $reg->dependencies['required']->package['__uri/test']->uri, 'uri after');

foreach ($reg->dependencies['required']->package as $name => $obj) {
    $test->assertEquals('__uri/test', $name, 'key test');
}

$reg->dependencies['required']->package['__uri/test']->uri = 'http://localhost';
$test->assertEquals('http://localhost', $reg->dependencies['required']->package['__uri/test']->uri, 'uri after set');
$test->assertEquals('__uri', $reg->dependencies['required']->package['__uri/test']->channel, 'channel after set');

$reg->dependencies['required']->package['__uri/test']->channel = 'pear2.php.net';
$test->assertEquals(false, isset($reg->dependencies['required']->package['__uri/test']), 'isset after channel');
$test->assertEquals(true, isset($reg->dependencies['required']->package['pear2.php.net/test']), 'isset 2 after channel');
$test->assertEquals(null, $reg->dependencies['required']->package['pear2.php.net/test']->uri, 'uri after set 2');
$test->assertEquals('pear2.php.net', $reg->dependencies['required']->package['pear2.php.net/test']->channel, 'channel after set 2');

$reg->dependencies['required']->package['pear2.php.net/test']->uri = 'http://example.com';

$test->assertEquals(true, isset($reg->dependencies['required']->package['__uri/test']), 'isset after uri');
$test->assertEquals(false, isset($reg->dependencies['required']->package['pear2.php.net/test']), 'isset 2 after uri');
$test->assertEquals('http://example.com', $reg->dependencies['required']->package['__uri/test']->uri, 'uri after set 3');
$test->assertEquals('__uri', $reg->dependencies['required']->package['__uri/test']->channel, 'channel after set 3');
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for regular arch deps
$fake = new PEAR2_Pyrus_PackageFile_v2;
$package = $fake->dependencies['required']->package;
$package['channel/Package1']->save();
$package['channel/Package2']->min('1.0.0');

$test->assertEquals(false, isset($reg->dependencies['required']->package['channel/Package1']), 'Package1 required before');
$test->assertEquals(false, isset($reg->dependencies['optional']->package['channel/Package1']), 'Package1 optional before');
$test->assertEquals(false, isset($reg->dependencies['group']->groupname->package['channel/Package1']), 'Package1 group before');

$test->assertEquals(null, $reg->dependencies['required']->package['channel/Package2']->min, 'Package2 required before');
$test->assertEquals(null, $reg->dependencies['optional']->package['channel/Package2']->min, 'Package2 optional before');
$test->assertEquals(null, $reg->dependencies['group']->groupname->package['channel/Package2']->min, 'Package2 group before');

$test->assertEquals(false, $reg->dependencies['required']->package['channel/Package3']->conflicts, 'Package3 required before');
$test->assertEquals(null, $reg->dependencies['optional']->package['channel/Package3']->max, 'Package3 optional before');
$test->assertEquals(null, $reg->dependencies['group']->groupname->package['channel/Package3']->max, 'Package3 group before');

$reg->dependencies['required']->package['channel/Package1'] = $package['channel/Package1'];
$reg->dependencies['required']->package[] = $package['channel/Package2'];
$reg->dependencies['optional']->package['channel/Package1'] = $package['channel/Package1'];
$reg->dependencies['optional']->package[] = $package['channel/Package2'];
$reg->dependencies['group']->groupname->package['channel/Package1'] = $package['channel/Package1'];
$reg->dependencies['group']->groupname->package[] = $package['channel/Package2'];

$test->assertEquals(true, isset($reg->dependencies['required']->package['channel/Package1']), 'Package1 required after');
$test->assertEquals(true, isset($reg->dependencies['optional']->package['channel/Package1']), 'Package1 optional after');
$test->assertEquals(true, isset($reg->dependencies['group']->groupname->package['channel/Package1']), 'Package1 group after');

$test->assertEquals('1.0.0', $reg->dependencies['required']->package['channel/Package2']->min, 'Package2 required after');
$test->assertEquals('1.0.0', $reg->dependencies['optional']->package['channel/Package2']->min, 'Package2 optional after');
$test->assertEquals('1.0.0', $reg->dependencies['group']->groupname->package['channel/Package2']->min, 'Package2 group after');<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for regular arch deps
$fake = new PEAR2_Pyrus_PackageFile_v2;
$package = $fake->dependencies['required']->package;
$package['channel/Package1']->save();
$package['channel/Package2']->min('1.0.0');
$package['channel/Package3']->conflicts();

$test->assertEquals(false, isset($reg->dependencies['required']->package['channel/Package1']), 'Package1 required before');
$test->assertEquals(false, isset($reg->dependencies['optional']->package['channel/Package1']), 'Package1 optional before');
$test->assertEquals(false, isset($reg->dependencies['group']->groupname->package['channel/Package1']), 'Package1 group before');

$test->assertEquals(null, $reg->dependencies['required']->package['channel/Package2']->min, 'Package2 required before');
$test->assertEquals(null, $reg->dependencies['optional']->package['channel/Package2']->min, 'Package2 optional before');
$test->assertEquals(null, $reg->dependencies['group']->groupname->package['channel/Package2']->min, 'Package2 group before');

$test->assertEquals(false, $reg->dependencies['required']->package['channel/Package3']->conflicts, 'Package3 required before');
$test->assertEquals(null, $reg->dependencies['optional']->package['channel/Package3']->max, 'Package3 optional before');
$test->assertEquals(null, $reg->dependencies['group']->groupname->package['channel/Package3']->max, 'Package3 group before');

$reg->dependencies['required']->package = $package;
unset($package['channel/Package3']);
$package['channel/Package3']->max('2.0.0');
$reg->dependencies['optional']->package = $package;
$reg->dependencies['group']->groupname->package = $package;

$test->assertEquals(true, isset($reg->dependencies['required']->package['channel/Package1']), 'Package1 required after');
$test->assertEquals(true, isset($reg->dependencies['optional']->package['channel/Package1']), 'Package1 optional after');
$test->assertEquals(true, isset($reg->dependencies['group']->groupname->package['channel/Package1']), 'Package1 group after');

$test->assertEquals('1.0.0', $reg->dependencies['required']->package['channel/Package2']->min, 'Package2 required after');
$test->assertEquals('1.0.0', $reg->dependencies['optional']->package['channel/Package2']->min, 'Package2 optional after');
$test->assertEquals('1.0.0', $reg->dependencies['group']->groupname->package['channel/Package2']->min, 'Package2 group after');

$test->assertEquals(true, $reg->dependencies['required']->package['channel/Package3']->conflicts, 'Package3 required after');
$test->assertEquals('2.0.0', $reg->dependencies['optional']->package['channel/Package3']->max, 'Package3 optional after');
$test->assertEquals('2.0.0', $reg->dependencies['group']->groupname->package['channel/Package3']->max, 'Package3 group after');
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for conflicting OS deps
$test->assertEquals(null, $reg->dependencies['required']->os['freebsd'], 'before os conflicts');
$reg->dependencies['required']->os['freebsd'] = false; // doesn't work on FreeBSD
$test->assertEquals(false, $reg->dependencies['required']->os['freebsd'], 'after os conflicts');<?php
// all registry tests must pass this (as must PackageFile objects)

$test->assertEquals('usestask', $reg->usestask['foo']->type, 'type');

$test->assertEquals(0, count($reg->usestask), 'none yet');
$test->assertEquals(false, isset($reg->usestask['foo']), 'isset before');
$test->assertEquals(false, isset($reg->usestask['foo']->package), 'isset package before');
$test->assertEquals(false, isset($reg->usestask['foo']->channel), 'isset channel before');
$test->assertEquals(false, isset($reg->usestask['foo']->uri), 'isset uri before');

$reg->usestask['foo']->package('Foo')->channel('pear.example.com');

$test->assertEquals(1, count($reg->usestask), '1 now');
$test->assertEquals(true, isset($reg->usestask['foo']), 'isset after');
$test->assertEquals(true, isset($reg->usestask['foo']->package), 'isset package after');
$test->assertEquals('Foo', $reg->usestask['foo']->package, 'package after');
$test->assertEquals(true, isset($reg->usestask['foo']->channel), 'isset channel after');
$test->assertEquals('pear.example.com', $reg->usestask['foo']->channel, 'channel after');
$test->assertEquals(false, isset($reg->usestask['foo']->uri), 'isset uri after');

$reg->usestask['foo']->uri('http://poo.example.com');

$test->assertEquals(null, $reg->usestask['foo']->channel, 'channel after uri');
$test->assertEquals(null, $reg->usestask['foo']->package, 'package after uri');
$test->assertEquals(true, isset($reg->usestask['foo']->uri), 'isset uri after set');
$test->assertEquals('http://poo.example.com', $reg->usestask['foo']->uri, 'uri');

$reg->usestask['foo']->channel('pear.example.com');

$test->assertEquals('pear.example.com', $reg->usestask['foo']->channel, 'channel after uri');
$test->assertEquals(false, isset($reg->usestask['foo']->uri), 'isset uri after set');
$test->assertEquals(null, $reg->usestask['foo']->uri, 'uri');

$reg->usestask['foo']->channel = 'localhost';
$test->assertEquals('localhost', $reg->usestask['foo']->channel, 'channel after localhost');

$reg->usestask['foo']->channel = null;
$test->assertEquals(null, $reg->usestask['foo']->channel, 'channel after null');

$reg->usestask['foo']->channel = 'localhost';
unset($reg->usestask['foo']->channel);
$test->assertEquals(null, $reg->usestask['foo']->channel, 'channel after unset');

$test->assertEquals(false, isset($reg->usestask['notset']), 'notset before');
unset($reg->usestask['notset']);
$test->assertEquals(false, isset($reg->usestask['notset']), 'notset after');

$test->assertEquals(true, isset($reg->usestask['foo']), 'foo before');
unset($reg->usestask['foo']);
$test->assertEquals(false, isset($reg->usestask['foo']), 'foo after');

$reg->usestask['one']->channel('pear2.php.net')->package('Hi');
$reg->usestask['two']->channel('pear2.php.net')->package('Hi2');

$testarr = array();
foreach ($reg->usestask as $name => $info) {
    $test->assertIsa('PEAR2_Pyrus_PackageFile_v2_UsesRoleTask', $info, 'check class');
    $testarr[$name] = $info->getInfo();
}
$test->assertEquals(array(
    'one' => array(
        'task' => 'one',
        'package' => 'Hi',
        'channel' => 'pear2.php.net',
        'uri' => null,
    ),
    'two' => array(
        'task' => 'two',
        'package' => 'Hi2',
        'channel' => 'pear2.php.net',
        'uri' => null,
    ),
), $testarr, 'test iteration');
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for PECL extension deps (optional or required same as packages)
$test->assertEquals(null, $reg->dependencies['required']->package['channel/PackageName']->providesextension, 'before providesextension');
$reg->dependencies['required']->package['channel/PackageName']->providesextension('packagename');
$test->assertEquals('packagename', $reg->dependencies['required']->package['channel/PackageName']->providesextension, 'after providesextension');<?php
// all registry tests must pass this (as must PackageFile objects)

$fake = new PEAR2_Pyrus_PackageFile_v2;
$task = $fake->usestask['boo']->channel('pear2.php.net')->package('Boo');

$test->assertEquals(false, isset($reg->usestask['boo']), 'isset before');
$test->assertEquals(0, count($reg->usestask), 'count before');

$reg->usestask['boo'] = $task;

$test->assertEquals(true, isset($reg->usestask['boo']), 'isset after');
$test->assertEquals(1, count($reg->usestask), 'count after');
$test->assertEquals('pear2.php.net', $reg->usestask['boo']->channel, 'channel');
$test->assertEquals('Boo', $reg->usestask['boo']->package, 'package');
$test->assertEquals(null, $reg->usestask['boo']->uri, 'uri');

$task->uri('http://localhost/Boo.phar');

$reg->usestask['boo'] = $task;

$test->assertEquals(true, isset($reg->usestask['boo']), 'isset after 2');
$test->assertEquals(1, count($reg->usestask), 'count after 2');
$test->assertEquals(null, $reg->usestask['boo']->channel, 'channel 2');
$test->assertEquals(null, $reg->usestask['boo']->package, 'package 2');
$test->assertEquals('http://localhost/Boo.phar', $reg->usestask['boo']->uri, 'uri 2');
<?php
// all registry tests must pass this (as must PackageFile objects)

$reg->dependencies['group']->anothergroup->hint = 'My Hint';
$reg->dependencies['group']->anothergroup->package['mychannel.example.com/Package']->save();

$test->assertEquals(array (
  'package' => 
  array (
    'attribs' => 
    array (
      'xmlns' => 'http://pear.php.net/dtd/package-2.0',
      'xmlns:tasks' => 'http://pear.php.net/dtd/tasks-1.0',
      'xmlns:xsi' => 'http://www.w3.org/2001/XMLSchema-instance',
      'version' => '2.0',
      'xsi:schemaLocation' => 'http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.0     http://pear.php.net/dtd/package-2.0.xsd',
    ),
    'name' => 'PEAR2_SimpleChannelServer',
    'channel' => 'pear2.php.net',
    'summary' => 'A Simple Channel Server for PEAR2 compatible channels
',
    'description' => '
This package contains a set of scripts to create a simple PEAR compatible
channel server. Included with the package is the pearscs command which you
can use for the command line to manage a pear channel.

The pearscs utility will be installed in the directory configured by the
bin_dir setting within Pyrus.
',
    'lead' => 
    array (
      0 => 
      array (
        'name' => 'Gregory Beaver',
        'user' => 'cellog',
        'email' => 'cellog@php.net',
        'active' => 'yes',
      ),
      1 => 
      array (
        'name' => 'Brett Bieber',
        'user' => 'saltybeagle',
        'email' => 'brett.bieber@gmail.com',
        'active' => 'yes',
      ),
    ),
    'date' => '2008-12-15',
    'time' => '11:51:01',
    'version' => 
    array (
      'release' => '0.1.0',
      'api' => '0.1.0',
    ),
    'stability' => 
    array (
      'release' => 'devel',
      'api' => 'alpha',
    ),
    'license' => 
    array (
      'attribs' => 
      array (
        'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
      ),
      '_content' => 'New BSD License',
    ),
    'notes' => 'First attempt.
',
    'contents' => 
    array (
      'dir' => 
      array (
        'attribs' => 
        array (
          'name' => '/',
        ),
        'file' => 
        array (
          0 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/REST/Release.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          1 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/REST/Package.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          2 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/REST/Manager.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          3 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/REST/Maintainer.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          4 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/REST/Category.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          5 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/Get.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          6 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/Exception.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          7 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/CLI.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          8 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/Channel.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          9 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/Categories/Exception.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          10 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer/Categories.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          11 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'src/SimpleChannelServer.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          12 => 
          array (
            'attribs' => 
            array (
              'role' => 'script',
              'name' => 'scripts/pearscs',
            ),
          ),
          13 => 
          array (
            'attribs' => 
            array (
              'role' => 'doc',
              'name' => 'examples/update_channel.php',
            ),
          ),
        ),
      ),
    ),
    'dependencies' => 
    array (
      'required' => 
      array (
        'php' => 
        array (
          'min' => '5.2.0',
          'exclude' => '5.2.8',
        ),
        'pearinstaller' => 
        array (
          'min' => '2.0.0a1',
        ),
        'package' => 
        array (
          0 => 
          array (
            'name' => 'File',
            'channel' => 'pear.php.net',
            'min' => '1.2.0',
          ),
          1 => 
          array (
            'name' => 'Other',
            'channel' => 'pear.php.net',
            'conflicts' => '',
          ),
          2 => 
          array (
            'name' => 'PackageName',
            'channel' => 'pecl.php.net',
            'min' => '1.1.0',
            'max' => '1.2.0',
            'recommended' => '1.1.1',
            'exclude' => 
            array (
              0 => '1.1.0a1',
              1 => '1.1.0a2',
            ),
            'providesextension' => 'packagename',
          ),
        ),
        'subpackage' => 
        array (
          'name' => 'Foo',
          'channel' => 'pear2.php.net',
          'min' => '1.0.0',
          'max' => '2.0.0',
          'recommended' => '1.2.0',
          'exclude' => 
          array (
            0 => '1.1.0',
            1 => '1.1.1',
          ),
        ),
        'extension' => 
        array (
          'name' => 'phar',
          'min' => '2.0.0',
          'exclude' => '2.0.1',
        ),
        'os' => 
        array (
          0 => 
          array (
            'name' => 'windows',
          ),
          1 => 
          array (
            'name' => 'vista',
            'conflicts' => '',
          ),
        ),
        'arch' => 
        array (
          'pattern' => 'i386',
        ),
      ),
      'optional' => 
      array (
        'package' => 
        array (
          'name' => 'PEAR',
          'channel' => 'pear.php.net',
          'min' => '1.7.0',
        ),
        'subpackage' => 
        array (
          'name' => 'Bar',
          'channel' => 'pear2.php.net',
          'min' => '1.5.0',
        ),
      ),
      'group' => 
      array (
        0 => 
        array (
          'attribs' => 
          array (
            'hint' => 'Install optional stuff as a group',
            'name' => 'name',
          ),
          'package' => 
          array (
            0 => 
            array (
              'name' => 'PackageName1',
              'channel' => 'pear2.php.net',
            ),
            1 => 
            array (
              'name' => 'PackageName2',
              'channel' => 'pear2.php.net',
              'min' => '1.2.0',
            ),
            2 => 
            array (
              'name' => 'PackageName',
              'channel' => 'pecl.php.net',
              'min' => '1.1.0',
              'max' => '1.2.0',
              'recommended' => '1.1.1',
              'exclude' => 
              array (
                0 => '1.1.0a1',
                1 => '1.1.0a2',
              ),
              'providesextension' => 'packagename',
            ),
          ),
          'subpackage' => 
          array (
            'name' => 'PackageName3',
            'channel' => 'pear2.php.net',
            'recommended' => '1.2.1',
          ),
          'extension' => 
          array (
            'name' => 'extension',
            'exclude' => array('5.2.8','5.2.9'),
          ),
        ),
        1 => 
        array (
          'attribs' => 
          array (
            'hint' => 'My Hint',
            'name' => 'anothergroup',
          ),
          'package' => 
          array (
            'name' => 'Package',
            'channel' => 'mychannel.example.com',
          ),
        ),
      ),
    ),
    'phprelease' => '',
  ),
), $reg->toArray(), 'toArray');<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for extension deps (required or optional same as packages)
$test->assertEquals(false, isset($reg->dependencies['required']->extension), 'before extension isset');
$test->assertEquals(false, isset($reg->dependencies['required']->extension['extname']), 'before extension isset 2');
$test->assertEquals(null, $reg->dependencies['required']->extension['extname']->min, 'before extension min set');
$test->assertEquals(null, $reg->dependencies['required']->extension['extname']->max, 'before extension max set');
$test->assertEquals(null, $reg->dependencies['required']->extension['extname']->recommended, 'before extension recommended set');
$reg->dependencies['required']->extension['extname']->min('1.0.0')->max('1.2.0')->recommended('1.1.1');
$test->assertEquals('1.0.0', $reg->dependencies['required']->extension['extname']->min, 'after extension min set');
$test->assertEquals('1.2.0', $reg->dependencies['required']->extension['extname']->max, 'after extension max set');
$test->assertEquals('1.1.1', $reg->dependencies['required']->extension['extname']->recommended, 'after extension recommended set');
$test->assertEquals(true, isset($reg->dependencies['required']->extension), 'after extension isset');
$test->assertEquals(true, isset($reg->dependencies['required']->extension['extname']), 'after extension isset 2');

foreach ($reg->dependencies['required']->extension as $name => $obj) {
    $test->assertEquals('extname', $name, 'iteration key test');
}<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// dependency group setup
$test->assertEquals(false, isset($reg->dependencies['group']), 'before group isset');
$test->assertEquals(false, isset($reg->dependencies['group']->groupname), 'before group isset 2');
$group = $reg->dependencies['group']->groupname;
$group->hint = 'Install optional stuff as a group';
$test->assertEquals('Install optional stuff as a group', $reg->dependencies['group']->groupname->hint, 'hint 1');
$test->assertEquals('Install optional stuff as a group', $group->hint, 'hint 2');
$test->assertEquals(true, isset($reg->dependencies['group']), 'after group isset');
$test->assertEquals(true, isset($reg->dependencies['group']->groupname), 'after group isset 2');
foreach ($reg->dependencies['group'] as $name => $g) {
    $test->assertEquals($name, $g->name, 'group name');
}
unset($group->hint);
$test->assertEquals(null, $reg->dependencies['group']->groupname->hint, 'hint unset 1');
$test->assertEquals(null, $group->hint, 'hint unset 2');

$group->hint = 'Install optional stuff as a group';

$test->assertEquals(true, isset($group->hint), 'group hint isset');
$group->hint = null;
$test->assertEquals(false, isset($group->hint), 'group hint isset after');
$test->assertEquals(null, $reg->dependencies['group']->groupname->hint, 'hint unset 3');
$test->assertEquals(null, $group->hint, 'hint unset 4');
$group->hint = null;
$test->assertEquals(null, $reg->dependencies['group']->groupname->hint, 'hint unset 5');
$test->assertEquals(null, $group->hint, 'hint unset 6');

$g = new PEAR2_Pyrus_PackageFile_v2_Dependencies_Group(null, array(), 'foo');
$test->assertEquals(null, $g->name, 'null name');

$test->assertEquals(true, isset($reg->dependencies['group']->groupname), 'groupname isset');
unset($reg->dependencies['group']->groupname);
$test->assertEquals(false, isset($reg->dependencies['group']->groupname), 'groupname isset after');
<?php
// all registry tests must pass this (as must PackageFile objects)

$reg->license = 'PHP';
$test->assertEquals('PHP', $reg->license['name'], 'php 1');
$test->assertEquals('http://www.php.net/license', $reg->license['uri'], 'php 1 uri');


$reg->license = 'PHP License';
$test->assertEquals('PHP License', $reg->license['name'], 'php 2');
$test->assertEquals('http://www.php.net/license', $reg->license['uri'], 'php 2 uri');

$reg->license = 'LGPL';
$test->assertEquals('LGPL', $reg->license['name'], 'lgpl');
$test->assertEquals('http://www.gnu.org/copyleft/lesser.html', $reg->license['uri'], 'lgpl uri');

$reg->license = 'BSD';
$test->assertEquals('BSD', $reg->license['name'], 'bsd');
$test->assertEquals('http://www.opensource.org/licenses/bsd-license.php', $reg->license['uri'], 'bsd uri');

$reg->license = 'BSD style';
$test->assertEquals('BSD style', $reg->license['name'], 'bsd 2');
$test->assertEquals('http://www.opensource.org/licenses/bsd-license.php', $reg->license['uri'], 'bsd 2 uri');

$reg->license = 'BSD-style';
$test->assertEquals('BSD-style', $reg->license['name'], 'bsd 3');
$test->assertEquals('http://www.opensource.org/licenses/bsd-license.php', $reg->license['uri'], 'bsd 3 uri');

$reg->license = 'MIT';
$test->assertEquals('MIT', $reg->license['name'], 'mit');
$test->assertEquals('http://www.opensource.org/licenses/mit-license.php', $reg->license['uri'], 'mit uri');

$reg->license = 'GPL';
$test->assertEquals('GPL', $reg->license['name'], 'gpl');
$test->assertEquals('http://www.gnu.org/copyleft/gpl.html', $reg->license['uri'], 'gpl uri');

$reg->license = 'Apache';
$test->assertEquals('Apache', $reg->license['name'], 'apache');
$test->assertEquals('http://www.opensource.org/licenses/apache2.0.php', $reg->license['uri'], 'apache uri');

$reg->license = 'bogus';
$test->assertEquals('bogus', $reg->license['name'], 'bogus');
$test->assertEquals(null, $reg->license['uri'], 'bogus uri');

$fake = new PEAR2_Pyrus_PackageFile_v2;
$fake->license['name'] = 'booboo';
$fake->license['uri'] = 'http://localhost';

$reg->license = $fake->license;
$test->assertEquals('booboo', $reg->license['name'], 'booboo');
$test->assertEquals('http://localhost', $reg->license['uri'], 'booboo uri');<?php
// all registry tests must pass this (as must PackageFile objects)

$reg->release[0]->installAs('src/SimpleChannelServer/REST/Release.php', 'php/PEAR2/SimpleChannelServer/REST/Release1.php');
$reg->release[0]->ignore('src/SimpleChannelServer/REST/Package.php');

$test->assertEquals(array (
  'package' => 
  array (
    'attribs' => 
    array (
      'xmlns' => 'http://pear.php.net/dtd/package-2.0',
      'xmlns:tasks' => 'http://pear.php.net/dtd/tasks-1.0',
      'xmlns:xsi' => 'http://www.w3.org/2001/XMLSchema-instance',
      'version' => '2.0',
      'xsi:schemaLocation' => 'http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.0     http://pear.php.net/dtd/package-2.0.xsd',
    ),
    'name' => 'PEAR2_SimpleChannelServer',
    'channel' => 'pear2.php.net',
    'summary' => 'A Simple Channel Server for PEAR2 compatible channels
',
    'description' => '
This package contains a set of scripts to create a simple PEAR compatible
channel server. Included with the package is the pearscs command which you
can use for the command line to manage a pear channel.

The pearscs utility will be installed in the directory configured by the
bin_dir setting within Pyrus.
',
    'lead' => 
    array (
      0 => 
      array (
        'name' => 'Gregory Beaver',
        'user' => 'cellog',
        'email' => 'cellog@php.net',
        'active' => 'yes',
      ),
      1 => 
      array (
        'name' => 'Brett Bieber',
        'user' => 'saltybeagle',
        'email' => 'brett.bieber@gmail.com',
        'active' => 'yes',
      ),
    ),
    'date' => '2008-12-15',
    'time' => '11:51:01',
    'version' => 
    array (
      'release' => '0.1.0',
      'api' => '0.1.0',
    ),
    'stability' => 
    array (
      'release' => 'devel',
      'api' => 'alpha',
    ),
    'license' => 
    array (
      'attribs' => 
      array (
        'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
      ),
      '_content' => 'New BSD License',
    ),
    'notes' => 'First attempt.
',
    'contents' => 
    array (
      'dir' => 
      array (
        'attribs' => 
        array (
          'name' => '/',
        ),
        'file' => 
        array (
          0 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Release.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          1 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Package.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          2 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Manager.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          3 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Maintainer.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          4 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/REST/Category.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          5 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Get.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          6 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Exception.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          7 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/CLI.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          8 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Channel.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          9 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Categories/Exception.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          10 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer/Categories.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          11 => 
          array (
            'attribs' => 
            array (
              'role' => 'php',
              'name' => 'php/PEAR2/SimpleChannelServer.php',
              'baseinstalldir' => 'PEAR2',
            ),
          ),
          12 => 
          array (
            'attribs' => 
            array (
              'role' => 'script',
              'name' => 'script/pearscs',
            ),
          ),
          13 => 
          array (
            'attribs' => 
            array (
              'role' => 'doc',
              'name' => 'doc/pear2.php.net/PEAR2_SimpleChannelServer/examples/examples/update_channel.php',
            ),
          ),
        ),
      ),
    ),
    'dependencies' => 
    array (
      'required' => 
      array (
        'php' => 
        array (
          'min' => '5.2.0',
          'exclude' => '5.2.8',
        ),
        'pearinstaller' => 
        array (
          'min' => '2.0.0a1',
        ),
        'package' => 
        array (
          0 => 
          array (
            'name' => 'File',
            'channel' => 'pear.php.net',
            'min' => '1.2.0',
          ),
          1 => 
          array (
            'name' => 'Other',
            'channel' => 'pear.php.net',
            'conflicts' => '',
          ),
          2 => 
          array (
            'name' => 'PackageName',
            'channel' => 'pecl.php.net',
            'min' => '1.1.0',
            'max' => '1.2.0',
            'recommended' => '1.1.1',
            'exclude' => 
            array (
              0 => '1.1.0a1',
              1 => '1.1.0a2',
            ),
            'providesextension' => 'packagename',
          ),
        ),
        'subpackage' => 
        array (
          'name' => 'Foo',
          'channel' => 'pear2.php.net',
          'min' => '1.0.0',
          'max' => '2.0.0',
          'recommended' => '1.2.0',
          'exclude' => 
          array (
            0 => '1.1.0',
            1 => '1.1.1',
          ),
        ),
        'extension' => 
        array (
          'name' => 'phar',
          'min' => '2.0.0',
          'exclude' => '2.0.1',
        ),
        'os' => 
        array (
          0 => 
          array (
            'name' => 'windows',
          ),
          1 => 
          array (
            'name' => 'vista',
            'conflicts' => '',
          ),
        ),
        'arch' => 
        array (
          'pattern' => 'i386',
        ),
      ),
      'optional' => 
      array (
        'package' => 
        array (
          'name' => 'PEAR',
          'channel' => 'pear.php.net',
          'min' => '1.7.0',
        ),
        'subpackage' => 
        array (
          'name' => 'Bar',
          'channel' => 'pear2.php.net',
          'min' => '1.5.0',
        ),
      ),
      'group' => 
      array (
        'attribs' => 
        array (
          'hint' => 'Install optional stuff as a group',
          'name' => 'name',
        ),
        'package' => 
        array (
          0 => 
          array (
            'name' => 'PackageName1',
            'channel' => 'pear2.php.net',
          ),
          1 => 
          array (
            'name' => 'PackageName2',
            'channel' => 'pear2.php.net',
            'min' => '1.2.0',
          ),
          2 => 
          array (
            'name' => 'PackageName',
            'channel' => 'pecl.php.net',
            'min' => '1.1.0',
            'max' => '1.2.0',
            'recommended' => '1.1.1',
            'exclude' => 
            array (
              0 => '1.1.0a1',
              1 => '1.1.0a2',
            ),
            'providesextension' => 'packagename',
          ),
        ),
        'subpackage' => 
        array (
          'name' => 'PackageName3',
          'channel' => 'pear2.php.net',
          'recommended' => '1.2.1',
        ),
        'extension' => 
        array (
          'name' => 'extension',
          'exclude' => array('5.2.8','5.2.9'),
        ),
      ),
    ),
    'phprelease' => 
    array (
      'filelist' => 
      array (
        'install' => 
        array (
          'attribs' => 
          array (
            'name' => 'php/PEAR2/SimpleChannelServer/REST/Release.php',
            'as' => 'php/PEAR2/SimpleChannelServer/REST/Release1.php',
          ),
        ),
        'ignore' => 
        array (
          'attribs' => 
          array (
            'name' => 'php/PEAR2/SimpleChannelServer/REST/Package.php',
          ),
        ),
      ),
    ),
  ),
), $reg->toArray(true), 'toArray');<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for required/optional package deps or subpackage deps

$test->assertEquals(false, isset($reg->dependencies['required']->subpackage), 'before subpackage isset 3');
$test->assertEquals(false, isset($reg->dependencies['required']->subpackage['channel/subpackageName']), 'before subpackage isset 4');
$test->assertEquals(null, $reg->dependencies['required']->subpackage['channel/subpackageName']->min, 'before subpackage required min set');
$test->assertEquals(null, $reg->dependencies['required']->subpackage['channel/subpackageName']->max, 'before subpackage required max set');
$test->assertEquals(null, $reg->dependencies['required']->subpackage['channel/subpackageName']->recommended, 'before subpackage required recommended set');
$test->assertEquals(null, $reg->dependencies['required']->subpackage['channel/subpackageName']->exclude, 'before subpackage required exclude set');
$reg->dependencies['required']->subpackage['channel/subpackageName']->min('1.1.0')->max('1.2.0')->recommended('1.1.1')
    ->exclude('1.1.0a1')->exclude('1.1.0a2');
$test->assertEquals('1.1.0', $reg->dependencies['required']->subpackage['channel/subpackageName']->min, 'after subpackage required min set');
$test->assertEquals('1.2.0', $reg->dependencies['required']->subpackage['channel/subpackageName']->max, 'after subpackage required max set');
$test->assertEquals('1.1.1', $reg->dependencies['required']->subpackage['channel/subpackageName']->recommended, 'after subpackage required recommended set');
$test->assertEquals(array('1.1.0a1', '1.1.0a2'), $reg->dependencies['required']->subpackage['channel/subpackageName']->exclude, 'after subpackage required exclude set');
$test->assertEquals(true, isset($reg->dependencies['required']->subpackage), 'after subpackage isset 3');
$test->assertEquals(true, isset($reg->dependencies['required']->subpackage['channel/subpackageName']), 'after subpackage isset 4');
<?php
// all registry tests must pass this (as must PackageFile objects)

try {
    $a = $package->compatible['test/test']['oops'];
    throw new Exception('$a = [oops] worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Compatible_Exception $e) {
    $test->assertEquals('Use -> operator to access compatible package properties',
                        $e->getMessage(), '$a = [oops]');
}

try {
    $a = $package->compatible['test'];
    throw new Exception('[test] worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Compatible_Exception $e) {
    $test->assertEquals('Cannot access "test", must use "channel/package" to specify a compatible package to access',
                        $e->getMessage(), '[test]');
}

try {
    $package->compatible['test/test']['oops'] = 1;
    throw new Exception('[oops] = 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Compatible_Exception $e) {
    $test->assertEquals('Use -> operator to access compatible package properties',
                        $e->getMessage(), '[oops] = 1');
}

try {
    $package->compatible['test'] = 1;
    throw new Exception('[test] = 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Compatible_Exception $e) {
    $test->assertEquals('Can only set $pf->compatible[\'test\'] to PEAR2_Pyrus_PackageFile_v2_Compatible object',
                        $e->getMessage(), '[test] = 1');
}

try {
    $package->compatible['test'] = $package->compatible['test/test'];
    throw new Exception('[test] = test/test worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Compatible_Exception $e) {
    $test->assertEquals('Cannot set "test", must use "channel/package" to specify a compatible package to set',
                        $e->getMessage(), '[test] = test/test');
}

try {
    $package->compatible['test/test'] = $package->compatible['test/test1'];
    throw new Exception('[test/test] = test/test1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Compatible_Exception $e) {
    $test->assertEquals('Cannot set test/test to test/test1, use $pf->compatible[] to set a new value',
                        $e->getMessage(), '[test/test] = test/test1');
}

try {
    isset($package->compatible['test/test']['oops']);
    throw new Exception('isset([oops]) worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Compatible_Exception $e) {
    $test->assertEquals('Use -> operator to access compatible package properties',
                        $e->getMessage(), 'isset([oops])');
}

try {
    unset($package->compatible['test/test']['oops']);
    throw new Exception('unset([oops]) worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Compatible_Exception $e) {
    $test->assertEquals('Use -> operator to access compatible package properties',
                        $e->getMessage(), 'unset([oops])');
}

try {
    $a = $package->compatible->test;
    throw new Exception('->test worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Compatible_Exception $e) {
    $test->assertEquals('Use [] operator to access compatible packages',
                        $e->getMessage(), '->test');
}

try {
    $package->compatible->test();
    throw new Exception('->test() worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Compatible_Exception $e) {
    $test->assertEquals('Use [] operator to access compatible packages',
                        $e->getMessage(), '->test()');
}

try {
    $package->compatible['test/test']->foo();
    throw new Exception('->foo() worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Compatible_Exception $e) {
    $test->assertEquals('Unknown variable foo, should be one of name, channel, min, max, exclude',
                        $e->getMessage(), '->foo()');
}

try {
    $package->compatible['test/test']->name();
    throw new Exception('->name() worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Compatible_Exception $e) {
    $test->assertEquals('Cannot change compatible package name, use unset() to remove the old compatible package'
,
                        $e->getMessage(), '->name()');
}

try {
    $package->compatible['test/test']->channel();
    throw new Exception('->channel() worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Compatible_Exception $e) {
    $test->assertEquals('Cannot change compatible package name, use unset() to remove the old compatible package'
,
                        $e->getMessage(), '->channel()');
}

try {
    isset($package->compatible->oops);
    throw new Exception('isset(->oops) worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Compatible_Exception $e) {
    $test->assertEquals('Use [] operator to access compatible packages',
                        $e->getMessage(), 'isset(->oops)');
}
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for regular arch deps
$fake = new PEAR2_Pyrus_PackageFile_v2;
$arch = $fake->dependencies['required']->arch;
$arch['i386'] = true;
$arch['ppc'] = false;
$arch['*ix'] = true;

$test->assertEquals(null, $reg->dependencies['required']->arch['i386'], 'i386 before');
$test->assertEquals(null, $reg->dependencies['required']->arch['ppc'], 'ppc before');
$test->assertEquals(null, $reg->dependencies['required']->arch['*ix'], '*ix before');

$reg->dependencies['required']->arch = $arch;

$test->assertEquals(true, $reg->dependencies['required']->arch['i386'], 'i386 after');
$test->assertEquals(false, $reg->dependencies['required']->arch['ppc'], 'ppc after');
$test->assertEquals(true, $reg->dependencies['required']->arch['*ix'], '*ix after');

unset($reg->dependencies['required']->arch['i386']);
unset($reg->dependencies['required']->arch['foo']); // show it works

$test->assertEquals(null, $reg->dependencies['required']->arch['i386'], 'i386 after unset');
$test->assertEquals(null, $reg->dependencies['required']->arch['foo'], 'foo after unset');
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for regular arch deps
$fake = new PEAR2_Pyrus_PackageFile_v2;
$extension = $fake->dependencies['required']->extension;
$extension['Extension1']->save();
$extension['Extension2']->min('1.0.0');

$test->assertEquals(false, isset($reg->dependencies['required']->extension['Extension1']), 'Extension1 required before');
$test->assertEquals(false, isset($reg->dependencies['optional']->extension['Extension1']), 'Extension1 optional before');
$test->assertEquals(false, isset($reg->dependencies['group']->groupname->extension['Extension1']), 'Extension1 group before');

$test->assertEquals(null, $reg->dependencies['required']->extension['Extension2']->min, 'Extension2 required before');
$test->assertEquals(null, $reg->dependencies['optional']->extension['Extension2']->min, 'Extension2 optional before');
$test->assertEquals(null, $reg->dependencies['group']->groupname->extension['Extension2']->min, 'Extension2 group before');

$test->assertEquals(false, $reg->dependencies['required']->extension['Extension3']->conflicts, 'Extension3 required before');
$test->assertEquals(null, $reg->dependencies['optional']->extension['Extension3']->max, 'Extension3 optional before');
$test->assertEquals(null, $reg->dependencies['group']->groupname->extension['Extension3']->max, 'Extension3 group before');

$reg->dependencies['required']->extension['Extension1'] = $extension['Extension1'];
$reg->dependencies['required']->extension[] = $extension['Extension2'];
$reg->dependencies['optional']->extension['Extension1'] = $extension['Extension1'];
$reg->dependencies['optional']->extension[] = $extension['Extension2'];
$reg->dependencies['group']->groupname->extension['Extension1'] = $extension['Extension1'];
$reg->dependencies['group']->groupname->extension[] = $extension['Extension2'];

$test->assertEquals(true, isset($reg->dependencies['required']->extension['Extension1']), 'Extension1 required after');
$test->assertEquals(true, isset($reg->dependencies['optional']->extension['Extension1']), 'Extension1 optional after');
$test->assertEquals(true, isset($reg->dependencies['group']->groupname->extension['Extension1']), 'Extension1 group after');

$test->assertEquals('1.0.0', $reg->dependencies['required']->extension['Extension2']->min, 'Extension2 required after');
$test->assertEquals('1.0.0', $reg->dependencies['optional']->extension['Extension2']->min, 'Extension2 optional after');
$test->assertEquals('1.0.0', $reg->dependencies['group']->groupname->extension['Extension2']->min, 'Extension2 group after');<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for conflicting arch deps
$test->assertEquals(null, $reg->dependencies['required']->arch['*(ix|ux)'], 'before arch conflict');
$reg->dependencies['required']->arch['*(ix|ux)'] = false; // doesn't work on unix/linux
$test->assertEquals(false, $reg->dependencies['required']->arch['*(ix|ux)'], 'after arch conflict');
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for regular arch deps
$test->assertEquals(false, isset($reg->dependencies['required']->arch), 'before arch isset');
$test->assertEquals(false, isset($reg->dependencies['required']->arch['i386']), 'before arch isset 2');
$test->assertEquals(null, $reg->dependencies['required']->arch['i386'], 'before arch');
$reg->dependencies['required']->arch['i386'] = true; // only works on i386
$test->assertEquals(true, $reg->dependencies['required']->arch['i386'], 'after arch');
$test->assertEquals(true, isset($reg->dependencies['required']->arch), 'after arch isset');
$test->assertEquals(true, isset($reg->dependencies['required']->arch['i386']), 'after arch isset 2');<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;
// for PHP dep

$test->assertEquals(null, $reg->dependencies['required']->php->max, 'before php max set');
$test->assertEquals(null, $reg->dependencies['required']->php->min, 'before php min set');
$test->assertEquals(null, $reg->dependencies['required']->php->exclude, 'before php exclude set');
$reg->dependencies['required']->php->min('5.3.1')->max('7.0.0')->exclude('6.1.2');
$test->assertEquals('7.0.0', $reg->dependencies['required']->php->max, 'after php max set');
$test->assertEquals('5.3.1', $reg->dependencies['required']->php->min, 'after php min set');
$test->assertEquals(array('6.1.2'), $reg->dependencies['required']->php->exclude, 'after php exclude set');<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for required/optional package deps or subpackage deps

$test->assertEquals(false, isset($reg->dependencies['optional']->package), 'before package isset 3');
$test->assertEquals(false, isset($reg->dependencies['optional']->package['channel/PackageName']), 'before package isset 4');
$test->assertEquals(null, $reg->dependencies['optional']->package['channel/PackageName']->min, 'before package optional min set');
$test->assertEquals(null, $reg->dependencies['optional']->package['channel/PackageName']->max, 'before package optional max set');
$test->assertEquals(null, $reg->dependencies['optional']->package['channel/PackageName']->recommended, 'before package optional recommended set');
$test->assertEquals(null, $reg->dependencies['optional']->package['channel/PackageName']->exclude, 'before package optional exclude set');
$reg->dependencies['optional']->package['channel/PackageName']->min('1.1.0')->max('1.2.0')->recommended('1.1.1')
    ->exclude('1.1.0a1')->exclude('1.1.0a2');
$test->assertEquals('1.1.0', $reg->dependencies['optional']->package['channel/PackageName']->min, 'after package optional min set');
$test->assertEquals('1.2.0', $reg->dependencies['optional']->package['channel/PackageName']->max, 'after package optional max set');
$test->assertEquals('1.1.1', $reg->dependencies['optional']->package['channel/PackageName']->recommended, 'after package optional recommended set');
$test->assertEquals(array('1.1.0a1', '1.1.0a2'), $reg->dependencies['optional']->package['channel/PackageName']->exclude, 'after package optional exclude set');
$test->assertEquals(true, isset($reg->dependencies['optional']->package), 'after package isset 3');
$test->assertEquals(true, isset($reg->dependencies['optional']->package['channel/PackageName']), 'after package isset 4');<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;
// for PHP dep

$reg->dependencies['required']->php->exclude('6.1.2')->exclude('6.1.3');
$test->assertEquals(array('6.1.2', '6.1.3'), $reg->dependencies['required']->php->exclude, 'after reset exclude');
$reg->dependencies['required']->php->exclude(null);
$test->assertEquals(null, $reg->dependencies['required']->php->exclude, 'after exclude reset');<?php
// all registry tests must pass this (as must extFile objects)

// reset deps
$reg->dependencies = null;

// for regular arch deps
$fake = new PEAR2_Pyrus_PackageFile_v2;
$ext = $fake->dependencies['required']->extension;
$ext['ext1']->save();
$ext['ext2']->min('1.0.0');
$ext['ext3']->conflicts();

$test->assertEquals(false, isset($reg->dependencies['required']->extension['ext1']), 'ext1 required before');
$test->assertEquals(false, isset($reg->dependencies['optional']->extension['ext1']), 'ext1 optional before');
$test->assertEquals(false, isset($reg->dependencies['group']->groupname->extension['ext1']), 'ext1 group before');

$test->assertEquals(null, $reg->dependencies['required']->extension['ext2']->min, 'ext2 required before');
$test->assertEquals(null, $reg->dependencies['optional']->extension['ext2']->min, 'ext2 optional before');
$test->assertEquals(null, $reg->dependencies['group']->groupname->extension['ext2']->min, 'ext2 group before');

$test->assertEquals(false, $reg->dependencies['required']->extension['ext3']->conflicts, 'ext3 required before');
$test->assertEquals(null, $reg->dependencies['optional']->extension['ext3']->max, 'ext3 optional before');
$test->assertEquals(null, $reg->dependencies['group']->groupname->extension['ext3']->max, 'ext3 group before');

$reg->dependencies['required']->extension = $ext;
unset($ext['ext3']);
$ext['ext3']->max('2.0.0');
$reg->dependencies['optional']->extension = $ext;
$reg->dependencies['group']->groupname->extension = $ext;

$test->assertEquals(true, isset($reg->dependencies['required']->extension['ext1']), 'ext1 required after');
$test->assertEquals(true, isset($reg->dependencies['optional']->extension['ext1']), 'ext1 optional after');
$test->assertEquals(true, isset($reg->dependencies['group']->groupname->extension['ext1']), 'ext1 group after');

$test->assertEquals('1.0.0', $reg->dependencies['required']->extension['ext2']->min, 'ext2 required after');
$test->assertEquals('1.0.0', $reg->dependencies['optional']->extension['ext2']->min, 'ext2 optional after');
$test->assertEquals('1.0.0', $reg->dependencies['group']->groupname->extension['ext2']->min, 'ext2 group after');

$test->assertEquals(true, $reg->dependencies['required']->extension['ext3']->conflicts, 'ext3 required after');
$test->assertEquals('2.0.0', $reg->dependencies['optional']->extension['ext3']->max, 'ext3 optional after');
$test->assertEquals('2.0.0', $reg->dependencies['group']->groupname->extension['ext3']->max, 'ext3 group after');
<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for regular OS deps
$test->assertEquals(false, isset($reg->dependencies['required']->os), 'before os isset');
$test->assertEquals(false, isset($reg->dependencies['required']->os['windows']), 'before os isset 2');
$test->assertEquals(null, $reg->dependencies['required']->os['windows'], 'before os');
$reg->dependencies['required']->os['windows'] = true; // only works on windows
$test->assertEquals(true, $reg->dependencies['required']->os['windows'], 'after os');
$test->assertEquals(true, isset($reg->dependencies['required']->os), 'after os isset');
$test->assertEquals(true, isset($reg->dependencies['required']->os['windows']), 'after os isset 2');<?php
// all registry tests must pass this (as must PackageFile objects)

// reset deps
$reg->dependencies = null;

// for required/optional package deps or subpackage deps

$test->assertEquals(false, isset($reg->dependencies['optional']->subpackage), 'before subpackage isset 5');
$test->assertEquals(false, isset($reg->dependencies['optional']->subpackage['channel/subpackageName']), 'before subpackage isset 6');
$test->assertEquals(null, $reg->dependencies['optional']->subpackage['channel/subpackageName']->min, 'before subpackage optional min set');
$test->assertEquals(null, $reg->dependencies['optional']->subpackage['channel/subpackageName']->max, 'before subpackage optional max set');
$test->assertEquals(null, $reg->dependencies['optional']->subpackage['channel/subpackageName']->recommended, 'before subpackage optional recommended set');
$test->assertEquals(null, $reg->dependencies['optional']->subpackage['channel/subpackageName']->exclude, 'before subpackage optional exclude set');
$reg->dependencies['optional']->subpackage['channel/subpackageName']->min('1.1.0')->max('1.2.0')->recommended('1.1.1')
    ->exclude('1.1.0a1')->exclude('1.1.0a2');
$test->assertEquals('1.1.0', $reg->dependencies['optional']->subpackage['channel/subpackageName']->min, 'after subpackage optional min set');
$test->assertEquals('1.2.0', $reg->dependencies['optional']->subpackage['channel/subpackageName']->max, 'after subpackage optional max set');
$test->assertEquals('1.1.1', $reg->dependencies['optional']->subpackage['channel/subpackageName']->recommended, 'after subpackage optional recommended set');
$test->assertEquals(array('1.1.0a1', '1.1.0a2'), $reg->dependencies['optional']->subpackage['channel/subpackageName']->exclude, 'after subpackage optional exclude set');
$test->assertEquals(true, isset($reg->dependencies['optional']->subpackage), 'after subpackage isset 5');
$test->assertEquals(true, isset($reg->dependencies['optional']->subpackage['channel/subpackageName']), 'after subpackage isset 6');<?php
// all registry tests must pass this (as must PackageFile objects)
$test->assertEquals('PEAR2_SimpleChannelServer', $reg->name, 'name');
$test->assertEquals('pear2.php.net', $reg->channel, 'channel');
$test->assertEquals('A Simple Channel Server for PEAR2 compatible channels', $reg->summary, 'summary');
$test->assertEquals('This package contains a set of scripts to create a simple PEAR compatible
channel server. Included with the package is the pearscs command which you
can use for the command line to manage a pear channel.

The pearscs utility will be installed in the directory configured by the
bin_dir setting within Pyrus.', $reg->description, 'description');
$test->assertEquals('2008-12-15', $reg->date, 'date');
$test->assertEquals('11:51:01', $reg->time, 'time');
$test->assertEquals('First attempt.', $reg->notes, 'notes');
$test->assertEquals('alpha', $reg->{'api-state'}, 'api-state');
$test->assertEquals('devel', $reg->state, 'state');
$test->assertEquals('0.1.0', $reg->{'release-version'}, 'release-version');
$test->assertEquals('0.1.0', $reg->{'api-version'}, 'api-version');
$test->assertEquals(false, $reg->sourcepackage, 'sourcepackage');
$test->assertEquals('', $reg->releases, 'releases');

$rawdeps = $reg->rawdeps;

usort($rawdeps['required']['os'], function($a, $b){return strnatcasecmp($b['name'], $a['name']);});
$test->assertEquals(array (
  'required' => 
  array (
    'php' => 
    array (
      'min' => '5.2.0',
      'exclude' => '5.2.8',
    ),
    'pearinstaller' => 
    array (
      'min' => '2.0.0a1',
    ),
    'package' => 
    array (
      0 => 
      array (
        'name' => 'File',
        'channel' => 'pear.php.net',
        'min' => '1.2.0',
      ),
      1 => 
      array (
        'name' => 'Other',
        'channel' => 'pear.php.net',
        'conflicts' => '',
      ),
      2 => 
      array (
        'name' => 'PackageName',
        'channel' => 'pecl.php.net',
        'min' => '1.1.0',
        'max' => '1.2.0',
        'recommended' => '1.1.1',
        'exclude' => 
        array (
          0 => '1.1.0a1',
          1 => '1.1.0a2',
        ),
        'providesextension' => 'packagename',
      ),
    ),
    'subpackage' => 
    array (
      'name' => 'Foo',
      'channel' => 'pear2.php.net',
      'min' => '1.0.0',
      'max' => '2.0.0',
      'recommended' => '1.2.0',
      'exclude' => 
      array (
        0 => '1.1.0',
        1 => '1.1.1',
      ),
    ),
    'extension' => 
    array (
      'name' => 'phar',
      'min' => '2.0.0',
      'exclude' => '2.0.1',
    ),
    'os' => 
    array (
      0 => 
      array (
        'name' => 'windows',
      ),
      1 => 
      array (
        'name' => 'vista',
        'conflicts' => '',
      ),
    ),
    'arch' => 
    array (
      'pattern' => 'i386',
    ),
  ),
  'optional' => 
  array (
    'package' => 
    array (
      'name' => 'PEAR',
      'channel' => 'pear.php.net',
      'min' => '1.7.0',
    ),
    'subpackage' => 
    array (
      'name' => 'Bar',
      'channel' => 'pear2.php.net',
      'min' => '1.5.0',
    ),
  ),
  'group' => 
  array (
    'attribs' => 
    array (
      'hint' => 'Install optional stuff as a group',
      'name' => 'name',
    ),
    'package' => 
    array (
      0 => 
      array (
        'name' => 'PackageName1',
        'channel' => 'pear2.php.net',
      ),
      1 => 
      array (
        'name' => 'PackageName2',
        'channel' => 'pear2.php.net',
        'min' => '1.2.0',
      ),
      2 => 
      array (
        'name' => 'PackageName',
        'channel' => 'pecl.php.net',
        'min' => '1.1.0',
        'max' => '1.2.0',
        'recommended' => '1.1.1',
        'exclude' => 
        array (
          0 => '1.1.0a1',
          1 => '1.1.0a2',
        ),
        'providesextension' => 'packagename',
      ),
    ),
    'subpackage' => 
    array (
      'name' => 'PackageName3',
      'channel' => 'pear2.php.net',
      'recommended' => '1.2.1',
    ),
    'extension' => 
    array (
      'name' => 'extension',
      'exclude' => array('5.2.8','5.2.9'),
    ),
  ),
), $rawdeps, 'rawdeps');
$test->assertEquals(true, $reg->schemaOK, 'schemaOK');<?php
// all registry tests must pass this (as must PackageFile objects)

$test->assertEquals('http://www.opensource.org/licenses/bsd-license.php', $reg->license['uri'], 'license uri');
$test->assertEquals('New BSD License', $reg->license['name'], 'license content');
$test->assertEquals(null, $reg->license['path'], 'license path');
$reg->license['uri'] = 'foobar';
$reg->license['name'] = 'hi';
$reg->license['path'] = 'boo';
$test->assertEquals('foobar', $reg->license['uri'], 'license uri 2');
$test->assertEquals('hi', $reg->license['name'], 'license name 2');
$test->assertEquals('boo', $reg->license['path'], 'license path 2');

$test->assertTrue(isset($reg->license['name']), 'name set');
unset($reg->license['name']);
$test->assertfalse(isset($reg->license['name']), 'name unset');
$test->assertEquals(null, $reg->license['name'], 'license name 3');
$test->assertTrue(isset($reg->license['uri']), 'uri set');
unset($reg->license['uri']);
$test->assertFalse(isset($reg->license['uri']), 'uri unset');
$test->assertEquals(null, $reg->license['uri'], 'license uri 3');
$test->assertTrue(isset($reg->license['path']), 'path set');
unset($reg->license['path']);
$test->assertFalse(isset($reg->license['path']), 'path unset');
$test->assertEquals(null, $reg->license['path'], 'license path 3');
$reg->license['name'] = 'test';
$test->assertTrue(isset($reg->license['name']), 'name set 2');

$newguy = new PEAR2_Pyrus_PackageFile_v2;
$test->assertEquals('New BSD License', $newguy->license['name'], 'newguy name');
$test->assertEquals('http://www.opensource.org/licenses/bsd-license.php', $newguy->license['uri'], 'newguy uri');
$test->assertEquals(null, $newguy->license['path'], 'newguy path');

unset($newguy->license['uri']);
$newguy->license['name'] = 'foobar'; // test name without path
$test->assertEquals('foobar', $newguy->license['name'], 'newguy name');
$test->assertEquals('foobar', $newguy->license->getInfo(), 'array test');

$newguy->license['uri'] = 'hello';
$test->assertEquals('hello', $newguy->license['uri'], 'newguy uri');
$test->assertEquals(array( '_content' => 'foobar', 'attribs' => array('uri' => 'hello'),), $newguy->license->getInfo(), 'array test 2');

$newguy->license['path'] = 'hello2';
$test->assertEquals('hello2', $newguy->license['path'], 'newguy path');
$test->assertEquals(array('_content' => 'foobar', 'attribs' => array('uri' => 'hello', 'path' => 'hello2')), $newguy->license->getInfo(), 'array test 3');

try {
    $newguy->license['oops'] = 'hi';
    throw new Exception('oops should have failed');
} catch (PEAR2_Pyrus_PackageFile_v2_License_Exception $e) {
    $test->assertEquals('Unknown license trait oops, cannot set value', $e->getMessage(), 'message');
}

try {
    $newguy->license['name'] = array('uri' => 'sneaky');
    throw new Exception('non-string should have failed');
} catch (PEAR2_Pyrus_PackageFile_v2_License_Exception $e) {
    $test->assertEquals('Can only set license to string', $e->getMessage(), 'message');
}

$p = new PEAR2_Pyrus_PackageFile_v2;
$p->fromArray(array('package' => array('license' => 'PHP License')));
$test->assertEquals('PHP License', $p->license['name'], 'name 1');
unset($p->license['name']);
$test->assertEquals(null, $p->license['name'], 'name 2');
$test->assertEquals(false, isset($p->license['foo']), 'foo isset');
<?php
// all registry tests must pass this (as must PackageFile objects)

$test->assertEquals(array (
  'attribs' => 
  array (
    'role' => 'doc',
    'name' => 'examples/update_channel.php',
  ),
), $reg->files['examples/update_channel.php']->getArrayCopy(), 'first');
unset($reg->files['examples/update_channel.php']);
$test->assertEquals(null, $reg->files['examples/update_channel.php'], 'second');

$test->assertEquals(null, $reg->files['poop'], 'non-existing');
$test->assertEquals(false, isset($reg->files['poop']), 'isset 1');
$test->assertEquals(true, isset($reg->files['src/SimpleChannelServer.php']), 'isset 1');
try {
    $reg->files['poop'] = new stdClass;
    throw new Exception('setting non-array should not happen');
} catch (PEAR2_Pyrus_PackageFile_v2_Files_Exception $e) {
    $test->assertEquals('File must be an array of '
                . 'attributes and tasks', $e->getMessage(), 'message');
}
try {
    $reg->files['poop'] = array('oops');
    throw new Exception('setting array with non-attribs should not happen');
} catch (PEAR2_Pyrus_PackageFile_v2_Files_Exception $e) {
    $test->assertEquals('File role must be set for' .
                ' file poop', $e->getMessage(), 'message 2');
}
$reg->files['poop'] = new ArrayObject(array('role' => 'php'));
$test->assertEquals(array('attribs' => array('role' => 'php', 'name' => 'poop')), $reg->files['poop']->getArrayCopy(), 'after setting');<?php
// all registry tests must pass this (as must PackageFile objects)

$test->assertIsa('PEAR2_Pyrus_PackageFile_v2_Release', $reg->release, 'right class');

$foo = new PEAR2_Pyrus_PackageFile_v2_Release_InstallCondition(false, array(), 'extension');
$foo = $foo['PDO'];
$foo->min('1.0')->conflicts();

$reg->release[0]->installconditions['extension']['PDO'] = $foo;
$test->assertEquals('PDO', $reg->release[0]->installconditions['extension']['PDO']->name, 'PDO 1');
$test->assertEquals('1.0', $reg->release[0]->installconditions['extension']['PDO']->min, 'PDO min');

$foo->min('2.0.0');
$test->assertEquals(false, isset($reg->release[0]->installconditions['extension']['phar']), 'phar isset 1');
$reg->release[0]->installconditions['extension']['phar'] = $foo;
$test->assertEquals(true, isset($reg->release[0]->installconditions['extension']['phar']), 'phar isset 2');
$test->assertEquals('PDO', $reg->release[0]->installconditions['extension']['PDO']->name, 'PDO 2');
$test->assertEquals('1.0', $reg->release[0]->installconditions['extension']['PDO']->min, 'PDO min 2');
$test->assertEquals('phar', $reg->release[0]->installconditions['extension']['phar']->name, 'phar');
$test->assertEquals('2.0.0', $reg->release[0]->installconditions['extension']['phar']->min, 'phar min');

try {
    $reg->release[0]->installconditions['extension']['phar'] = 2;
    throw new Exception('phar 2 didn\'t fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Cannot set extension to anything but a' .
                        ' PEAR2_Pyrus_PackageFile_v2_Release_InstallCondition object', $e->getMessage(), 'phar 2 message');
}

try {
    $reg->release[0]->installconditions['foo'] = 2;
    throw new Exception('foo didn\'t fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Unknown install condition foo', $e->getMessage(), 'foo message');
}

try {
    $reg->release[0]->installconditions['extension'] = 2;
    throw new Exception('extension 2 didn\'t fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Set extension install condition by name', $e->getMessage(), 'extension 2 message');
}

$foo = new PEAR2_Pyrus_PackageFile_v2_Release_InstallCondition(false, array('min' => null), 'php');

try {
    $reg->release[0]->installconditions['extension']['phar'] = $foo;
    throw new Exception('phar php didn\'t fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Cannot set extension phar to another install condition (php)', $e->getMessage(), 'phar php message');
}

try {
    $reg->release[0]->installconditions['arch'] = $foo;
    throw new Exception('arch php didn\'t fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Cannot set arch to another install condition (php)', $e->getMessage(), 'arch php message');
}

$test->assertEquals(false, isset($reg->release[0]->installconditions['php']), 'php isset 1');
$test->assertEquals(false, isset($reg->release[0]->installconditions['arch']), 'arch isset 1');
$test->assertEquals(false, isset($reg->release[0]->installconditions['os']), 'os isset 1');

$foo->min('5.1.0');
$reg->release[0]->installconditions['php'] = $foo;
$test->assertEquals('5.1.0', $reg->release[0]->installconditions['php']->min, 'php min');

$foo = new PEAR2_Pyrus_PackageFile_v2_Release_InstallCondition(false, array('pattern' => null), 'arch');
$foo->pattern('hi');
$reg->release[0]->installconditions['arch'] = $foo;
$test->assertEquals('hi', $reg->release[0]->installconditions['arch']->pattern, 'arch pattern');

$foo = new PEAR2_Pyrus_PackageFile_v2_Release_InstallCondition(false, array('name' => null), 'os');
$foo->name('boo');
$reg->release[0]->installconditions['os'] = $foo;
$test->assertEquals('boo', $reg->release[0]->installconditions['os']->name, 'os name');

$test->assertEquals(true, isset($reg->release[0]->installconditions['php']), 'php isset 2');
$test->assertEquals(true, isset($reg->release[0]->installconditions['arch']), 'arch isset 2');
$test->assertEquals(true, isset($reg->release[0]->installconditions['os']), 'os isset 2');

unset($reg->release[0]->installconditions['os']);
$test->assertEquals(false, isset($reg->release[0]->installconditions['os']), 'os isset 3');<?php
// all registry tests must pass this (as must PackageFile objects)

$greg = $reg->maintainer['cellog'];

$test->assertIsa('PEAR2_Pyrus_PackageFile_v2_Developer', $greg, 'check class');
$test->assertEquals('cellog', $greg->user, 'user');
$test->assertEquals('Gregory Beaver', $greg->name, 'name');
$test->assertEquals('cellog@php.net', $greg->email, 'email');
$test->assertEquals('yes', $greg->active, 'active');
$test->assertEquals('lead', $greg->role, 'role');

$test->assertEquals(true, isset($reg->maintainer['cellog']), 'isset 1');
unset($reg->maintainer['cellog']);
$test->assertEquals(false, isset($reg->maintainer['cellog']), 'isset 2');
unset($reg->maintainer['cellog']);
$test->assertEquals(false, isset($reg->maintainer['cellog']), 'isset 3');

$test->assertEquals(true, isset($reg->maintainer['saltybeagle']), 'isset 4');
unset($reg->maintainer['saltybeagle']);
$test->assertEquals(false, isset($reg->maintainer['saltybeagle']), 'isset 5');

$reg->maintainer['cellog'] = $greg;

$greg2 = $reg->maintainer['cellog'];
$test->assertIsa('PEAR2_Pyrus_PackageFile_v2_Developer', $greg2, 'check class 2');
$test->assertEquals('cellog', $greg2->user, 'user 2');
$test->assertEquals('Gregory Beaver', $greg2->name, 'name 2');
$test->assertEquals('cellog@php.net', $greg2->email, 'email 2');
$test->assertEquals('yes', $greg2->active, 'active 2');
$test->assertEquals('lead', $greg2->role, 'role 2');

$greg2->role('developer');
$test->assertEquals('developer', $greg2->role, 'role after');

$reg->maintainer['cellog'] = $greg2;

$greg3 = $reg->maintainer['cellog'];
$test->assertEquals('cellog', $greg3->user, 'user 3');
$test->assertEquals('Gregory Beaver', $greg3->name, 'name 3');
$test->assertEquals('cellog@php.net', $greg3->email, 'email 3');
$test->assertEquals('yes', $greg3->active, 'active 3');
$test->assertEquals('developer', $greg3->role, 'role 3');

$reg->maintainer['foo'] = new PEAR2_Pyrus_PackageFile_v2_Developer(null, array('name' => 'Foo Bar', 'email' => 'foo@example.com', 'active' => 'yes'), 'lead');

$foo = $reg->maintainer['foo'];
$test->assertEquals('foo', $foo->user, 'user 4');
$test->assertEquals('Foo Bar', $foo->name, 'name 4');
$test->assertEquals('foo@example.com', $foo->email, 'email 4');
$test->assertEquals('yes', $foo->active, 'active 4');
$test->assertEquals('lead', $foo->role, 'role 4');

$reg->maintainer['doink'] = new PEAR2_Pyrus_PackageFile_v2_Developer(null, array('name' => 'Foo Doink', 'email' => 'foo1@example.com', 'active' => 'no'), 'developer');;

$doink = $reg->maintainer['doink'];
$test->assertEquals('doink', $doink->user, 'user 5');
$test->assertEquals('Foo Doink', $doink->name, 'name 5');
$test->assertEquals('foo1@example.com', $doink->email, 'email 5');
$test->assertEquals('no', $doink->active, 'active 5');
$test->assertEquals('developer', $doink->role, 'role 5');

try {
    $reg->maintainer['oops'] = array('blah' => 'blah');
    throw new Exception('oops 1');
} catch (PEAR2_Pyrus_PackageFile_v2_Developer_Exception $e) {
    $test->assertEquals('Can only set a developer to a PEAR2_Pyrus_PackageFile_v2_Developer object', $e->getMessage(), 'oops 1');
}
<?php
// all registry tests must pass this (as must PackageFile objects)

$a = $reg->files['examples/update_channel.php'];
$a['attribs']['md5sum'] = 'should not be there';
$reg->files['examples/update_channel.php'] = $a;

$arr = array();
foreach ($reg->packagingcontents as $name => $file) {
    $arr[] = array('name' => $name, 'file' => $file);
}
usort($arr, function($a,$b) {return strnatcasecmp($a['name'], $b['name']);});
$test->assertEquals(array (
  0 => 
  array (
    'name' => 'doc/pear2.php.net/PEAR2_SimpleChannelServer/examples/examples/update_channel.php',
    'file' => 
    array (
      'attribs' => 
      array (
        'role' => 'doc',
        'name' => 'examples/update_channel.php',
      ),
    ),
  ),
  1 =>
  array (
    'name' => 'php/PEAR2/SimpleChannelServer.php',
    'file' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/SimpleChannelServer.php',
        'baseinstalldir' => 'PEAR2',
      ),
    ),
  ),
  2 => 
  array (
    'name' => 'php/PEAR2/SimpleChannelServer/Categories.php',
    'file' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/Categories.php',
        'baseinstalldir' => 'PEAR2',
      ),
    ),
  ),
  3 => 
  array (
    'name' => 'php/PEAR2/SimpleChannelServer/Categories/Exception.php',
    'file' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/Categories/Exception.php',
        'baseinstalldir' => 'PEAR2',
      ),
    ),
  ),
  4 => 
  array (
    'name' => 'php/PEAR2/SimpleChannelServer/Channel.php',
    'file' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/Channel.php',
        'baseinstalldir' => 'PEAR2',
      ),
    ),
  ),
  5 => 
  array (
    'name' => 'php/PEAR2/SimpleChannelServer/CLI.php',
    'file' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/CLI.php',
        'baseinstalldir' => 'PEAR2',
      ),
    ),
  ),
  6 => 
  array (
    'name' => 'php/PEAR2/SimpleChannelServer/Exception.php',
    'file' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/Exception.php',
        'baseinstalldir' => 'PEAR2',
      ),
    ),
  ),
  7 => 
  array (
    'name' => 'php/PEAR2/SimpleChannelServer/Get.php',
    'file' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/Get.php',
        'baseinstalldir' => 'PEAR2',
      ),
    ),
  ),
  8 => 
  array (
    'name' => 'php/PEAR2/SimpleChannelServer/REST/Category.php',
    'file' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/REST/Category.php',
        'baseinstalldir' => 'PEAR2',
      ),
    ),
  ),
  9 => 
  array (
    'name' => 'php/PEAR2/SimpleChannelServer/REST/Maintainer.php',
    'file' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/REST/Maintainer.php',
        'baseinstalldir' => 'PEAR2',
      ),
    ),
  ),
  10 => 
  array (
    'name' => 'php/PEAR2/SimpleChannelServer/REST/Manager.php',
    'file' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/REST/Manager.php',
        'baseinstalldir' => 'PEAR2',
      ),
    ),
  ),
  11 => 
  array (
    'name' => 'php/PEAR2/SimpleChannelServer/REST/Package.php',
    'file' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/REST/Package.php',
        'baseinstalldir' => 'PEAR2',
      ),
    ),
  ),
  12 => 
  array (
    'name' => 'php/PEAR2/SimpleChannelServer/REST/Release.php',
    'file' => 
    array (
      'attribs' => 
      array (
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/REST/Release.php',
        'baseinstalldir' => 'PEAR2',
      ),
    ),
  ),
  13 => 
  array (
    'name' => 'script/pearscs',
    'file' => 
    array (
      'attribs' => 
      array (
        'role' => 'script',
        'name' => 'scripts/pearscs',
      ),
    ),
  ),
), $arr, 'packaging contents');<?php
// all registry tests must pass this (as must PackageFile objects)

$test->assertIsa('PEAR2_Pyrus_PackageFile_v2_Release', $reg->release, 'right class');

try {
    $reg->release[] = 5;
    throw new Exception('setting to non-object succeeded');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Cannot set 0 to non-PEAR2_Pyrus_PackageFile_v2_Release', $e->getMessage(), '[] = 5');
}

try {
    $reg->release['foo'] = 5;
    throw new Exception('setting to non-object succeeded');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Cannot set foo', $e->getMessage(), '[foo] = 5');
}

$a = new PEAR2_Pyrus_PackageFile_v2_Release($reg, array(), array());
$reg->release[] = $a;
$a = $reg->release[0];

$test->assertEquals(false, $a->getInstallCondition(), 'installcondition');
$test->assertEquals(false, $a->getInstallAs(), 'installas');
$test->assertEquals(false, $a->getIgnore(), 'ignore');
$a->installconditions['php'] = '5.2.0';

try {
    $reg->release->ignore('oops');
    throw new Exception('ignore without index succeeded');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Cannot ignore ' .
                            'file oops without specifying which release section to ignore it in', $e->getMessage(), 'ignore without index');
}

try {
    $reg->release->installAs('oops', 'ie');
    throw new Exception('installas without index succeeded');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Cannot install ' .
                            'file oops to ie' .
                            ' without specifying which release section to install it in', $e->getMessage(), 'installas without index');
}

$reg->release[0]->ignore('src/SimpleChannelServer.php');
$test->assertEquals(array('attribs' => array('name' => 'src/SimpleChannelServer.php')), $reg->release[0]->getIgnore(), 'ignore 1');
$reg->release[0]->ignore('src/SimpleChannelServer/Get.php');
$test->assertEquals(array(array('attribs' => array('name' => 'src/SimpleChannelServer.php')),
                        array('attribs' => array('name' => 'src/SimpleChannelServer/Get.php'))), $reg->release[0]->getIgnore(), 'ignore 2');

$reg->release[0]->installAs('src/SimpleChannelServer.php', 'foo');
$test->assertEquals(array('attribs' => array('name' => 'src/SimpleChannelServer.php', 'as' => 'foo')), $reg->release[0]->getInstallAs(), 'install-as 1');
$reg->release[0]->installAs('src/SimpleChannelServer/Get.php', 'foo1');
$test->assertEquals(array(array('attribs' => array('name' => 'src/SimpleChannelServer.php', 'as' => 'foo')),
                        array('attribs' => array('name' => 'src/SimpleChannelServer/Get.php', 'as' => 'foo1'))), $reg->release[0]->getInstallAs(), 'install-as 2');

$reg->release[0]->installconditions['extension']['foo']->name(null);
$reg->release[0]->installAs('src/SimpleChannelServer.php', 'boo');
$test->assertEquals(array (
  'php' => 
  array (
    'min' => '5.2.0',
  ),
), $reg->release[0]->getInstallCondition(), 'after extension unset');
$reg->release[0]->installconditions['php']->min(null);
$test->assertEquals(false, $reg->release[0]->getInstallCondition(), 'after php unset');
$test->assertEquals('php', $reg->release[0]->installconditions['php']->installcondition, 'installcondition var');

try {
    $reg->release[0]->installconditions->min('oops');
    throw new Exception('min oops did not fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Cannot set variables for unknown install condition', $e->getMessage(), 'min oops');
}

try {
    $a = $reg->release[0]->installconditions['extension'][0];
    throw new Exception('extension 0 did not fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Access extension installconditions by name, not number', $e->getMessage(), 'extension 0');
}

$a = $reg->release[0]->installconditions['extension']['foo'];
$a->name('foo');
$test->assertEquals('foo', $reg->release[0]->installconditions['extension']['foo']->name, '1 name');

try {
    $a = $reg->release[0]->installconditions[50];
    throw new Exception('installconditions 50 did not fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Cannot access numeric index', $e->getMessage(), 'installconditions 50');
}
$reg->release = null;
$reg->release[0]->installconditions['os']->name('windows');
$test->assertEquals('windows', $reg->release[0]->installconditions['os']->name, 'os name');
$reg->release[1]->installconditions['arch']->pattern('i386');
$test->assertEquals('i386', $reg->release[1]->installconditions['arch']->pattern, 'arch pattern');

try {
    $a = $reg->release[0]->installconditions['foobar'];
    throw new Exception('installconditions foobar did not fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Cannot access unknown install condition foobar', $e->getMessage(), 'installconditions foobar');
}
<?php
// all registry tests must pass this (as must PackageFile objects)

$test->assertIsa('PEAR2_Pyrus_PackageFile_v2_Release', $reg->release, 'right class');
$test->assertEquals(false, $reg->release[0]->getInstallCondition(), 'release 0, no conditions yet');
$reg->release[0]->installconditions['php']->min('5.2.0');
$test->assertEquals('5.2.0', $reg->release[0]->installconditions['php']->min, '5.2.0');
$test->assertEquals(array('php' => array('min' => '5.2.0')), $reg->release[0]->getInstallCondition(), 'release 0, php condition');
// defaults to "min"
$reg->release[0]->installconditions['php'] = '5.2.1';
$test->assertEquals('5.2.1', $reg->release[0]->installconditions['php']->min, '5.2.1');
// defaults to "pattern"
$reg->release[0]->installconditions['arch'] = 'i386';
$test->assertEquals('i386', $reg->release[0]->installconditions['arch']->pattern, 'i386');
$test->assertFalse($reg->release[0]->installconditions['arch']->conflicts, 'i386 conflicts');
$reg->release[0]->installconditions['arch']->pattern('i486')->conflicts();
$test->assertEquals('i486', $reg->release[0]->installconditions['arch']->pattern, 'i486');
$test->assertTrue($reg->release[0]->installconditions['arch']->conflicts, 'i486 conflicts');
// defaults to "name"
$reg->release[0]->installconditions['os'] = 'windows';
$test->assertEquals('windows', $reg->release[0]->installconditions['os']->name, 'windows');
// defaults to existing
$reg->release[0]->installconditions['extension']['PDO']->save();
$test->assertEquals('PDO', $reg->release[0]->installconditions['extension']['PDO']->name, 'PDO');
$test->assertEquals(null, $reg->release[0]->installconditions['extension']['PDO']->min, 'PDO min 1');
$reg->release[0]->installconditions['extension']['PDO']->name('PDO')->min('1.0');
$test->assertEquals('PDO', $reg->release[0]->installconditions['extension']['PDO']->name, 'PDO');
$test->assertEquals('1.0', $reg->release[0]->installconditions['extension']['PDO']->min, 'PDO min 2');
try {
    $reg->release[0]->ignore('path/to/file.ext');
    throw new Exception('did not fail path/to/file.ext');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Unknown file path/to/file.ext - add to filelist before ignoring', $e->getMessage(), 'unknown file');
}
$test->assertEquals(false, $reg->release[0]->getIgnore(), 'ignore should be empty');
$test->assertFalse($reg->release[0]->ignores('path/to/file.ext'), 'double check ignoring');
$reg->release[0]->ignore('src/SimpleChannelServer.php');
$test->assertEquals(array('attribs' => array('name' => 'src/SimpleChannelServer.php')), $reg->release[0]->getIgnore(), 'ignore should not be empty');
$test->assertTrue($reg->release[0]->ignores('src/SimpleChannelServer.php'), 'double check ignoring 2');
try {
    $reg->release[0]->installAs('path/to/anotherfile.ext', 'new/name.php');
    throw new Exception('did not fail path/to/anotherfile.ext');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Unknown file path/to/anotherfile.ext - add to filelist before adding install as tag', $e->getMessage(), 'unknown file');
}
$test->assertEquals(false, $reg->release[0]->getInstallAs(), 'install-as should be empty');
$test->assertEquals('path/to/anotherfile.ext', $reg->release[0]->installsAs('path/to/anotherfile.ext'), 'double check install-as');
$reg->release[0]->installAs('src/SimpleChannelServer/Get.php', 'new/name.php');
$test->assertEquals(array('attribs' => array('name' => 'src/SimpleChannelServer/Get.php', 'as' => 'new/name.php')), $reg->release[0]->getInstallAs(), 'install-as should not be empty');
$test->assertEquals('new/name.php', $reg->release[0]->installsAs('src/SimpleChannelServer/Get.php'), 'double check installing as 2');
$test->assertTrue($reg->release[0]->ignores('src/SimpleChannelServer.php'), 'double check ignoring 3');
// add another release
$i = count($reg->release);
$test->assertFalse(isset($reg->release[1]), 'isset 1');
$reg->release[$i]->ignore('src/SimpleChannelServer/Get.php');
$test->assertTrue(isset($reg->release[1]), 'isset 2');
$reg->release[$i]->installAs('src/SimpleChannelServer.php', 'new/name.php');

try {
    $a = $reg->release[0]->notfound;
    throw new Exception('notfound succeeded');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Unknown variable notfound' .
        ', installconditions is the only supported variable', $e->getMessage(), 'notfound message');
}
$test->assertEquals(1, count($reg->release[0]), 'count of release with index');
$test->assertTrue($reg->release[0]->ignores('src/SimpleChannelServer.php'), 'double check ignoring 4');
$test->assertFalse($reg->release[1]->ignores('src/SimpleChannelServer.php'), 'double check ignoring 5');
$test->assertEquals('new/name.php', $reg->release[0]->installsAs('src/SimpleChannelServer/Get.php'), 'double check installing as 3');
$test->assertEquals('new/name.php', $reg->release[1]->installsAs('src/SimpleChannelServer.php'), 'double check installing as 4');
// remove release
$test->assertEquals('foo.php', $reg->release[1]->installsAs('foo.php'), 'install-as with non-existing file');
unset($reg->release[1]);
$test->assertFalse(isset($reg->release[1]), 'isset 3');
$test->assertTrue(isset($reg->release[0]), 'isset 4');
// remove all releases
$reg->release = null;
$test->assertFalse(isset($reg->release[1]), 'isset 5');
$test->assertFalse(isset($reg->release[0]), 'isset 6');
$test->assertEquals(null, $reg->release->getInstallAs(), 'install-as no index');
$test->assertEquals(null, $reg->release->getIgnore(), 'ignore no index');
$test->assertEquals(null, $reg->release->getInstallCondition(), 'installcondition, no index');

try {
    $a = $reg->release[24];
    throw new Exception('24 succeeded');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Can only set the next highest release index 0, not 24', $e->getMessage(), '24 1');
}
$a = $reg->release[0]->ignore('src/SimpleChannelServer.php');

try {
    $a = $reg->release[24];
    throw new Exception('24 succeeded 2');
} catch (PEAR2_Pyrus_PackageFile_v2_Release_Exception $e) {
    $test->assertEquals('Can only set the next highest release index 1, not 24', $e->getMessage(), '24 2');
}
<?php
// all registry tests must pass this (as must PackageFile objects)
$testit = array();
foreach ($reg->contents as $file) {
    $testit[] = (array) $file;
    if ($file->name == 'src/SimpleChannelServer.php') {
        $testthis = $file;
    }
}
$file = $testthis;
usort($testit, function($a,$b) {return strnatcasecmp($a['attribs']['name'],$b['attribs']['name']);});
$test->assertEquals(array (
  0 => 
  array (
    'attribs' => 
    array (
      'role' => 'doc',
      'name' => 'examples/update_channel.php',
    ),
  ),
  1 => 
  array (
    'attribs' => 
    array (
      'role' => 'script',
      'name' => 'scripts/pearscs',
    ),
  ),
  2 => 
  array (
    'attribs' => 
    array (
      'role' => 'php',
      'name' => 'src/SimpleChannelServer.php',
      'baseinstalldir' => 'PEAR2',
    ),
  ),
  3 => 
  array (
    'attribs' => 
    array (
      'role' => 'php',
      'name' => 'src/SimpleChannelServer/Categories.php',
      'baseinstalldir' => 'PEAR2',
    ),
  ),
  4 => 
  array (
    'attribs' => 
    array (
      'role' => 'php',
      'name' => 'src/SimpleChannelServer/Categories/Exception.php',
      'baseinstalldir' => 'PEAR2',
    ),
  ),
  5 => 
  array (
    'attribs' => 
    array (
      'role' => 'php',
      'name' => 'src/SimpleChannelServer/Channel.php',
      'baseinstalldir' => 'PEAR2',
    ),
  ),
  6 => 
  array (
    'attribs' => 
    array (
      'role' => 'php',
      'name' => 'src/SimpleChannelServer/CLI.php',
      'baseinstalldir' => 'PEAR2',
    ),
  ),
  7 => 
  array (
    'attribs' => 
    array (
      'role' => 'php',
      'name' => 'src/SimpleChannelServer/Exception.php',
      'baseinstalldir' => 'PEAR2',
    ),
  ),
  8 => 
  array (
    'attribs' => 
    array (
      'role' => 'php',
      'name' => 'src/SimpleChannelServer/Get.php',
      'baseinstalldir' => 'PEAR2',
    ),
  ),
  9 => 
  array (
    'attribs' => 
    array (
      'role' => 'php',
      'name' => 'src/SimpleChannelServer/REST/Category.php',
      'baseinstalldir' => 'PEAR2',
    ),
  ),
  10 => 
  array (
    'attribs' => 
    array (
      'role' => 'php',
      'name' => 'src/SimpleChannelServer/REST/Maintainer.php',
      'baseinstalldir' => 'PEAR2',
    ),
  ),
  11 => 
  array (
    'attribs' => 
    array (
      'role' => 'php',
      'name' => 'src/SimpleChannelServer/REST/Manager.php',
      'baseinstalldir' => 'PEAR2',
    ),
  ),
  12 => 
  array (
    'attribs' => 
    array (
      'role' => 'php',
      'name' => 'src/SimpleChannelServer/REST/Package.php',
      'baseinstalldir' => 'PEAR2',
    ),
  ),
  13 => 
  array (
    'attribs' => 
    array (
      'role' => 'php',
      'name' => 'src/SimpleChannelServer/REST/Release.php',
      'baseinstalldir' => 'PEAR2',
    ),
  ),
), $testit, 'output');

$test->assertEquals('php', $file->role, 'php 1');
$test->assertEquals('src/SimpleChannelServer.php', $file->name, 'verify name is as expected');
$test->assertEquals($file->name, $reg->files['src/SimpleChannelServer.php']['attribs']['name'], 'verify we have the same thing');
$test->assertEquals('php', $reg->files['src/SimpleChannelServer.php']['attribs']['role'], 'again verify');
$file->role = 'oog';
$test->assertEquals('oog', $file->role, 'php 2');
$test->assertEquals('oog', $reg->files['src/SimpleChannelServer.php']['attribs']['role'], 'again verify 2');

$temp = new PEAR2_Pyrus_PackageFile_v2Iterator_FileTag(array('attribs' => array('name' => 'SimpleChannelServer.php',
                                                   'role' => 'php',
                                                   'install-as' => 'poop')), 'src', $reg);
$test->assertEquals(array('name' => 'SimpleChannelServer.php', 'role' => 'php'), $temp['attribs'], 'attribs with install-as');
$test->assertEquals('poop', $temp['install-as'], 'install-as');
$test->assertEquals('poop', $temp->{'install-as'}, 'install-as __get');
$test->assertEquals('poop', $temp->name, 'magic name install-as returned instead of name');

$replace = new PEAR2_Pyrus_Task_Replace($reg, PEAR2_Pyrus_Task_Common::PACKAGE,
                                        array('attribs' => array('from' => '@' . 'PACKAGE_VERSION@',
                          'to' => 'version',
                          'type' => 'package-info')), array('from' => '@' . 'PACKAGE_VERSION@',
                          'to' => 'version',
                          'type' => 'package-info'), '2.0.0');

$temp->{'tasks:replace'} = $replace;
try {
    $temp->{'tasks:replace'} = 1;
    throw new Exception('invalid task setting succeeded');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Cannot set tasks:replace to non-' .
                'PEAR2_Pyrus_Task_Common object in file src/SimpleChannelServer.php', $e->getMessage(), 'invalid tasks setting');
}
try {
    $temp->{'tasks:replace'} = $replace;
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    throw $e;
}
try {
    $temp->grooplebooble = 1;
    throw new Exception('invalid attribute setting succeeded');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Cannot set invalid attribute grooplebooble for file src/SimpleChannelServer.php', $e->getMessage(), 'invalid attribute setting');
}
<?php
// all registry tests must pass this (as must PackageFile objects)

try {
    $foo = array();
    $oops = new PEAR2_Pyrus_PackageFile_v2_Developer(null, $foo);
    $a = $oops->name;
    throw new Exception('oops did not fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Developer_Exception $e) {
    $test->assertEquals('Cannot access developer info for unknown developer', $e->getMessage(), 'no dev set');
}

try {
    $oops->name('hi');
    throw new Exception('oops 3 did not fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Developer_Exception $e) {
    $test->assertEquals('Cannot set developer info for unknown developer', $e->getMessage(), 'no dev set 3');
}

$greg = $reg->maintainer['cellog'];
try {
    $test->assertEquals(null, $greg->nonexisting, 'non-existing');
    throw new Exception('nonexisting did not fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Developer_Exception $e) {
    $test->assertEquals('Unknown variable nonexisting, should be one of name, email, active', $e->getMessage(), 'nonexisting');
}

try {
    $a = $reg->maintainer['cellog']['greg'];
    throw new Exception('double did not fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Developer_Exception $e) {
    $test->assertEquals('Use -> to access properties of a developer', $e->getMessage(), 'double dev set');
}

try {
    $a = $reg->maintainer[0];
    throw new Exception('numeric did not fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Developer_Exception $e) {
    $test->assertEquals('Developer handle cannot be numeric', $e->getMessage(), 'numeric');
}

try {
    $reg->maintainer[0] = array();
    throw new Exception('numeric 2 did not fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Developer_Exception $e) {
    $test->assertEquals('Developer handle cannot be numeric', $e->getMessage(), 'numeric 2');
}

try {
    $greg->flurb('blah');
    throw new Exception('flurb did not fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Developer_Exception $e) {
    $test->assertEquals('Cannot set unknown value flurb', $e->getMessage(), 'flurb');
}

try {
    $greg->name('blah', 'foo');
    throw new Exception('double name did not fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Developer_Exception $e) {
    $test->assertEquals('Can only set name to 1 value', $e->getMessage(), 'double name');
}

try {
    $greg->name(array());
    throw new Exception('array name did not fail');
} catch (PEAR2_Pyrus_PackageFile_v2_Developer_Exception $e) {
    $test->assertEquals('Invalid value for name, must be a string', $e->getMessage(), 'array name');
}

$a = $greg->name('Foo Bar');
$test->assertIsa('PEAR2_Pyrus_PackageFile_v2_Developer', $a, 'right class');
$test->assertEquals('Foo Bar', $greg->name, 'after setting name');

$reg->maintainer['foo']->name('Blah Blah');
// we don't save unless we know the role
$test->assertEquals(null, $reg->maintainer['foo']->name, 'after name change');

$reg->maintainer['foo']->role('lead');
$test->assertEquals(null, $reg->maintainer['foo']->name, 'after name change 2');
$reg->maintainer['foo']->name('Blah Blah');
$test->assertEquals('Blah Blah', $reg->maintainer['foo']->name, 'after name change 3');

$reg->maintainer['bar']->role('helper');
$test->assertEquals('helper', $reg->maintainer['bar']->role, 'after role change');
$reg->maintainer['bar']->name('Blah Blah');
$reg->maintainer['foobar']->role('lead');
$reg->maintainer['cellog']->role('helper');
$test->assertEquals('helper', $reg->maintainer['cellog']->role, 'after role change 2');
$reg->maintainer['saltybeagle']->role('helper');
$test->assertEquals('helper', $reg->maintainer['saltybeagle']->role, 'after role change 3');
$reg->maintainer['foobar']->role('helper');
$test->assertEquals('helper', $reg->maintainer['foobar']->role, 'after role change 4');

<?php
// all registry tests must pass this (as must PackageFile objects)

$greg = $reg->maintainer['cellog']->name('Foo Bar');
$allmaintainers = $reg->allmaintainers;
$testarr = array();
foreach (array_keys($allmaintainers) as $role) {
    $testarr[$role] = array();
    foreach ($allmaintainers[$role] as $i => $obj) {
        $test->assertIsa('PEAR2_Pyrus_PackageFile_v2_Developer', $obj, $role . ' ' . $i . ' allmaintainers');
        $testarr[$role][] = $obj->toArray();
    }
}
$test->assertEquals(array (
  'lead' => 
  array (
    0 => 
    array (
      'name' => 'Foo Bar',
      'user' => 'cellog',
      'email' => 'cellog@php.net',
      'active' => 'yes',
    ),
    1 => 
    array (
      'name' => 'Brett Bieber',
      'user' => 'saltybeagle',
      'email' => 'brett.bieber@gmail.com',
      'active' => 'yes',
    ),
  ),
  'developer' => 
  array (
  ),
  'helper' => 
  array (
  ),
  'contributor' => 
  array (
  ),
), $testarr, 'allmaintainers');

$reg->maintainer['foo']->name('Blah Blah')->role('lead');
$reg->maintainer['bar']->role('helper')->name('Blah Blah');
$reg->maintainer['foobar']->role('lead');
$reg->maintainer['cellog']->role('helper');
$reg->maintainer['saltybeagle']->role('helper');
$reg->maintainer['foobar']->role('helper');
$reg->maintainer['foobar']->role('contributor');
$reg->maintainer['bar']->role('developer');

$allmaintainers = $reg->allmaintainers;
$testarr = array();
foreach (array_keys($allmaintainers) as $role) {
    $testarr[$role] = array();
    foreach ($allmaintainers[$role] as $i => $obj) {
        $test->assertIsa('PEAR2_Pyrus_PackageFile_v2_Developer', $obj, $role . ' ' . $i . ' allmaintainers');
        $testarr[$role][] = $obj->toArray();
    }
}
$test->assertEquals(array (
  'lead' => 
  array (
    0 => 
    array (
      'name' => 'Blah Blah',
      'user' => 'foo',
      'email' => null,
      'active' => 'yes',
    ),
  ),
  'developer' => 
  array (
    0 => 
    array (
      'name' => 'Blah Blah',
      'user' => 'bar',
      'email' => null,
      'active' => 'yes',
    ),
  ),
  'helper' => 
  array (
    0 => 
    array (
      'name' => 'Foo Bar',
      'user' => 'cellog',
      'email' => 'cellog@php.net',
      'active' => 'yes',
    ),
    1 => 
    array (
      'name' => 'Brett Bieber',
      'user' => 'saltybeagle',
      'email' => 'brett.bieber@gmail.com',
      'active' => 'yes',
    ),
  ),
  'contributor' => 
  array (
    0 => 
    array (
      'name' => null,
      'user' => 'foobar',
      'email' => null,
      'active' => 'yes',
    ),
  ),
), $testarr, 'allmaintainers');

$reg->maintainer['cellog']->role('lead');

$allmaintainers = $reg->allmaintainers;
$testarr = array();
foreach (array_keys($allmaintainers) as $role) {
    $testarr[$role] = array();
    foreach ($allmaintainers[$role] as $i => $obj) {
        $testarr[$role][] = $obj->toArray();
    }
}
$test->assertEquals(array (
  'lead' => 
  array (
    0 => 
    array (
      'name' => 'Blah Blah',
      'user' => 'foo',
      'email' => null,
      'active' => 'yes',
    ),
    1 => 
    array (
      'name' => 'Foo Bar',
      'user' => 'cellog',
      'email' => 'cellog@php.net',
      'active' => 'yes',
    ),
  ),
  'developer' => 
  array (
    0 => 
    array (
      'name' => 'Blah Blah',
      'user' => 'bar',
      'email' => null,
      'active' => 'yes',
    ),
  ),
  'helper' => 
  array (
    0 => 
    array (
      'name' => 'Brett Bieber',
      'user' => 'saltybeagle',
      'email' => 'brett.bieber@gmail.com',
      'active' => 'yes',
    ),
  ),
  'contributor' => 
  array (
    0 => 
    array (
      'name' => null,
      'user' => 'foobar',
      'email' => null,
      'active' => 'yes',
    ),
  ),
), $testarr, 'allmaintainers 1');

$reg->maintainer['cellog']->role('developer');

$allmaintainers = $reg->allmaintainers;
$testarr = array();
foreach (array_keys($allmaintainers) as $role) {
    $testarr[$role] = array();
    foreach ($allmaintainers[$role] as $i => $obj) {
        $testarr[$role][] = $obj->toArray();
    }
}
$test->assertEquals(array (
  'lead' => 
  array (
    0 => 
    array (
      'name' => 'Blah Blah',
      'user' => 'foo',
      'email' => null,
      'active' => 'yes',
    ),
  ),
  'developer' => 
  array (
    0 => 
    array (
      'name' => 'Blah Blah',
      'user' => 'bar',
      'email' => null,
      'active' => 'yes',
    ),
    1 => 
    array (
      'name' => 'Foo Bar',
      'user' => 'cellog',
      'email' => 'cellog@php.net',
      'active' => 'yes',
    ),
  ),
  'helper' => 
  array (
    0 => 
    array (
      'name' => 'Brett Bieber',
      'user' => 'saltybeagle',
      'email' => 'brett.bieber@gmail.com',
      'active' => 'yes',
    ),
  ),
  'contributor' => 
  array (
    0 => 
    array (
      'name' => null,
      'user' => 'foobar',
      'email' => null,
      'active' => 'yes',
    ),
  ),
), $testarr, 'allmaintainers 2');

$reg->maintainer['cellog']->role('contributor');

$allmaintainers = $reg->allmaintainers;
$testarr = array();
foreach (array_keys($allmaintainers) as $role) {
    $testarr[$role] = array();
    foreach ($allmaintainers[$role] as $i => $obj) {
        $testarr[$role][] = $obj->toArray();
    }
}
$test->assertEquals(array (
  'lead' => 
  array (
    0 => 
    array (
      'name' => 'Blah Blah',
      'user' => 'foo',
      'email' => null,
      'active' => 'yes',
    ),
  ),
  'developer' => 
  array (
    0 => 
    array (
      'name' => 'Blah Blah',
      'user' => 'bar',
      'email' => null,
      'active' => 'yes',
    ),
  ),
  'helper' => 
  array (
    0 => 
    array (
      'name' => 'Brett Bieber',
      'user' => 'saltybeagle',
      'email' => 'brett.bieber@gmail.com',
      'active' => 'yes',
    ),
  ),
  'contributor' => 
  array (
    0 => 
    array (
      'name' => null,
      'user' => 'foobar',
      'email' => null,
      'active' => 'yes',
    ),
    1 => 
    array (
      'name' => 'Foo Bar',
      'user' => 'cellog',
      'email' => 'cellog@php.net',
      'active' => 'yes',
    ),
  ),
), $testarr, 'allmaintainers 3');
<?php
$test->assertEquals(array(), $reg->listPackages('pear2.php.net'), 'before pear2');
$test->assertEquals(array(), $reg->listPackages('pear.php.net'), 'before pear');
$reg->install($info);
$template = new PEAR2_Pyrus_PackageFile_v2;
$template->summary = 'hi';
$template->description = 'hi';
$template->maintainer['cellog']->role('lead')->name('Greg')->active('yes')->email('cellog@php.net');
$template->date = '2009-03-29';
$template->notes = 'hi';
$info = clone $template;
$info->name = 'HooHa';
$info->channel = 'pear2.php.net';
$info->files['one'] = array('role' => 'php');
$info->dependencies['required']->package['pear2.php.net/PEAR2_SimpleChannelServer']->min('0.1.0');
$reg->install($info);
$info = clone $template;
$info->name = 'HooHa2';
$info->channel = 'pear2.php.net';
$info->files['two'] = array('role' => 'php');
$info->dependencies['optional']->package['pear2.php.net/PEAR2_SimpleChannelServer']->min('0.1.0');
$reg->install($info);
$info = clone $template;
$info->name = 'HooHa2';
$info->channel = 'pear.php.net';
$info->files['three'] = array('role' => 'php');
$info->dependencies['group']->groupone->hint = 'hi';
$info->dependencies['group']->groupone->package['pear2.php.net/PEAR2_SimpleChannelServer']->min('0.1.0');
$reg->install($info);
$info->channel = 'pear2.php.net';
$info->name = 'PEAR2_SimpleChannelServer';
$packages = $reg->getDependentPackages($info);
$names = array();
foreach ($packages as $i => $package) {
    $test->assertIsa('PEAR2_Pyrus_IPackageFile', $package, 'class ' . $i);
    $names[] = $package->channel . '/' . $package->name;
}
sort($names);
$test->assertEquals(array('pear.php.net/HooHa2', 'pear2.php.net/HooHa', 'pear2.php.net/HooHa2'), $names, 'names');
?><?php
$reg->install($info);
$template = new PEAR2_Pyrus_PackageFile_v2;
$template->summary = 'hi';
$template->description = 'hi';
$template->maintainer['cellog']->role('lead')->name('Greg')->active('yes')->email('cellog@php.net');
$template->date = '2009-03-29';
$template->notes = 'hi';
$info = clone $template;
$info->name = 'HooHa';
$info->channel = 'pear2.php.net';
$info->files['one'] = array('role' => 'php');
$info->dependencies['required']->package['pear2.php.net/PEAR2_SimpleChannelServer']->min('0.1.0');
$reg->install($info);
$info = clone $template;
$info->name = 'HooHa2';
$info->channel = 'pear2.php.net';
$info->files['two'] = array('role' => 'php');
$info->dependencies['optional']->package['pear2.php.net/PEAR2_SimpleChannelServer']->min('0.1.0');
$reg->install($info);
$info = clone $template;
$info->name = 'HooHa2';
$info->channel = 'pear.php.net';
$info->files['three'] = array('role' => 'php');
$info->dependencies['group']->groupone->hint = 'hi';
$info->dependencies['group']->groupone->package['pear2.php.net/PEAR2_SimpleChannelServer']->min('0.1.0');
$reg->install($info);

$info->uri = 'http://blah.example.com';
$info->name = 'PEAR2_SimpleChannelServer';
$test->assertEquals(array (
  0 => 
  array (
    'three' => 'pear.php.net/HooHa2',
  ),
), $reg->detectFileConflicts($info), 'test 1');

$info->files['two'] = array('role' => 'php');
$info->files['ok'] = array('role' => 'php');
$info->files['one'] = array('role' => 'data');

$test->assertEquals(array (
  0 => 
  array (
    'three' => 'pear.php.net/HooHa2',
  ),
  1 => 
  array (
    'two' => 'pear2.php.net/HooHa2',
  ),
), $reg->detectFileConflicts($info), 'test 2');
?><?xml version="1.0" encoding="UTF-8"?>
<package version="2.0" xmlns="http://pear.php.net/dtd/package-2.0" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.0     http://pear.php.net/dtd/package-2.0.xsd">
 <name>PEAR2_SimpleChannelServer</name>
 <channel>pear2.php.net</channel>
 <summary>A Simple Channel Server for PEAR2 compatible channels
</summary>
 <description>
This package contains a set of scripts to create a simple PEAR compatible
channel server. Included with the package is the pearscs command which you
can use for the command line to manage a pear channel.

The pearscs utility will be installed in the directory configured by the
bin_dir setting within Pyrus.
</description>
 <lead>
  <name>Gregory Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <lead>
  <name>Brett Bieber</name>
  <user>saltybeagle</user>
  <email>brett.bieber@gmail.com</email>
  <active>yes</active>
 </lead>
 <date>2008-12-15</date>
 <time>11:51:01</time>
 <version>
  <release>0.1.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>devel</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">New BSD License</license>
 <notes>First attempt.
</notes>
 <contents>
  <dir name="/">
   <file role="php" name="src/SimpleChannelServer/REST/Release.php" baseinstalldir="PEAR2"/>
   <file role="php" name="src/SimpleChannelServer/REST/Package.php" baseinstalldir="PEAR2"/>
   <file role="php" name="src/SimpleChannelServer/REST/Manager.php" baseinstalldir="PEAR2"/>
   <file role="php" name="src/SimpleChannelServer/REST/Maintainer.php" baseinstalldir="PEAR2"/>
   <file role="php" name="src/SimpleChannelServer/REST/Category.php" baseinstalldir="PEAR2"/>
   <file role="php" name="src/SimpleChannelServer/Get.php" baseinstalldir="PEAR2"/>
   <file role="php" name="src/SimpleChannelServer/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="src/SimpleChannelServer/CLI.php" baseinstalldir="PEAR2"/>
   <file role="php" name="src/SimpleChannelServer/Channel.php" baseinstalldir="PEAR2"/>
   <file role="php" name="src/SimpleChannelServer/Categories/Exception.php" baseinstalldir="PEAR2"/>
   <file role="php" name="src/SimpleChannelServer/Categories.php" baseinstalldir="PEAR2"/>
   <file role="php" name="src/SimpleChannelServer.php" baseinstalldir="PEAR2"/>
   <file role="script" name="scripts/pearscs"/>
   <file role="doc" name="examples/update_channel.php"/>
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
   </php>
   <pearinstaller>
    <min>2.0.0a1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease/>
</package>
<?php
$test->assertEquals(false, (bool)$reg->exists($info->name, $info->channel), 'package does not exist');
// set up some values so we can verify things were actually retrieved correctly
$info->stability['api'] = 'beta';
$info->stability['release'] = 'stable';
$info->version['api'] = '1.2.3';
// use replace so date/time is not modified
$reg->replace($info);
$test->assertEquals(true, (bool)$reg->exists($info->name, $info->channel), 'package was installed');

// info stuff here
$test->assertEquals('PEAR2_SimpleChannelServer', $reg->info($info->name, $info->channel, 'name'), 'name');
$test->assertEquals('pear2.php.net', $reg->info($info->name, $info->channel, 'channel'), 'channel');
$test->assertEquals('A Simple Channel Server for PEAR2 compatible channels',
                    $reg->info($info->name, $info->channel, 'summary'), 'summary');
$test->assertEquals('This package contains a set of scripts to create a simple PEAR compatible
channel server. Included with the package is the pearscs command which you
can use for the command line to manage a pear channel.

The pearscs utility will be installed in the directory configured by the
bin_dir setting within Pyrus.', $reg->info($info->name, $info->channel, 'description'), 'description');
$test->assertEquals('beta', $reg->info($info->name, $info->channel, 'api-state'), 'api-state');
$test->assertEquals('stable', $reg->info($info->name, $info->channel, 'state'), 'state');
$test->assertEquals('0.1.0', $reg->info($info->name, $info->channel, 'release-version'), 'release-version');
$test->assertEquals('0.1.0', $reg->info($info->name, $info->channel, 'release-version'), 'version');
$test->assertEquals('1.2.3', $reg->info($info->name, $info->channel, 'api-version'), 'api-version');
$test->assertEquals('First attempt.', $reg->info($info->name, $info->channel, 'notes'), 'notes');
$test->assertEquals('2008-12-15', $reg->info($info->name, $info->channel, 'date'), 'date');
$test->assertEquals('11:51:01', $reg->info($info->name, $info->channel, 'time'), 'time');
?><?php
$test->assertEquals(false, (bool)$reg->exists($info->name, $info->channel), 'package does not exist');
$reg->install($info);
$test->assertEquals(true, (bool)$reg->exists($info->name, $info->channel), 'package was installed');

// info stuff here
$result = $reg->info($info->name, $info->channel, 'dirtree');

if (substr(PHP_OS, 0, 3) == 'WIN') {
    
} else {
    // $dir must be set to __DIR__ . '/testit' in the test itself
    $test->assertEquals(array (
      $dir . 'php/PEAR2/SimpleChannelServer/REST',
      $dir . 'php/PEAR2/SimpleChannelServer/Categories',
      $dir . 'php/PEAR2/SimpleChannelServer',
      $dir . 'php/PEAR2',
      $dir . 'php',
      $dir . 'docs/pear2.php.net/PEAR2_SimpleChannelServer/examples',
      $dir . 'docs/pear2.php.net/PEAR2_SimpleChannelServer',
      $dir . 'docs/pear2.php.net',
      $dir . 'docs',
      $dir . 'bin',
    ), $result, 'dirtree');
}
<?php
$test->assertEquals(false, (bool)$reg->exists($info->name, $info->channel), 'package does not exist');
$reg->install($info);
$test->assertEquals(true, (bool)$reg->exists($info->name, $info->channel), 'package was installed');

// info stuff here
$result = $reg->info($info->name, $info->channel, 'installedfiles');
asort($result);

if (substr(PHP_OS, 0, 3) == 'WIN') {
    
} else {
    // $dir must be set to __DIR__ . '/testit' in the test itself
    $test->assertEquals(array (
      $dir . 'docs/pear2.php.net/PEAR2_SimpleChannelServer/examples/update_channel.php' =>
      array(
        'role' => 'doc',
        'name' => 'examples/update_channel.php',
        'installed_as' => $dir . 'docs/pear2.php.net/PEAR2_SimpleChannelServer/examples/update_channel.php',
        'relativepath' => 'pear2.php.net/PEAR2_SimpleChannelServer/examples/update_channel.php',
        'configpath' => $dir . 'docs',
           ),
      $dir . 'bin/pearscs' =>
      array(
        'role' => 'script',
        'name' => 'scripts/pearscs',
        'installed_as' => $dir . 'bin/pearscs',
        'relativepath' => 'pearscs',
        'configpath' => $dir . 'bin',
           ),
      $dir . 'php/PEAR2/SimpleChannelServer.php' =>
      array(
        'role' => 'php',
        'name' => 'src/SimpleChannelServer.php',
        'baseinstalldir' => 'PEAR2',
        'installed_as' => $dir . 'php/PEAR2/SimpleChannelServer.php',
        'relativepath' => 'PEAR2/SimpleChannelServer.php',
        'configpath' => $dir . 'php',

           ),
      $dir . 'php/PEAR2/SimpleChannelServer/CLI.php' =>
      array(
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/CLI.php',
        'baseinstalldir' => 'PEAR2',
        'installed_as' => $dir . 'php/PEAR2/SimpleChannelServer/CLI.php',
        'relativepath' => 'PEAR2/SimpleChannelServer/CLI.php',
        'configpath' => $dir . 'php',

           ),
      $dir . 'php/PEAR2/SimpleChannelServer/Categories.php' =>
      array(
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/Categories.php',
        'baseinstalldir' => 'PEAR2',
        'installed_as' => $dir . 'php/PEAR2/SimpleChannelServer/Categories.php',
        'relativepath' => 'PEAR2/SimpleChannelServer/Categories.php',
        'configpath' => $dir . 'php',

           ),
      $dir . 'php/PEAR2/SimpleChannelServer/Categories/Exception.php' =>
      array(
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/Categories/Exception.php',
        'baseinstalldir' => 'PEAR2',
        'installed_as' => $dir . 'php/PEAR2/SimpleChannelServer/Categories/Exception.php',
        'relativepath' => 'PEAR2/SimpleChannelServer/Categories/Exception.php',
        'configpath' => $dir . 'php',

           ),
      $dir . 'php/PEAR2/SimpleChannelServer/Channel.php' =>
      array(
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/Channel.php',
        'baseinstalldir' => 'PEAR2',
        'installed_as' => $dir . 'php/PEAR2/SimpleChannelServer/Channel.php',
        'relativepath' => 'PEAR2/SimpleChannelServer/Channel.php',
        'configpath' => $dir . 'php',

           ),
      $dir . 'php/PEAR2/SimpleChannelServer/Exception.php' =>
      array(
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/Exception.php',
        'baseinstalldir' => 'PEAR2',
        'installed_as' => $dir . 'php/PEAR2/SimpleChannelServer/Exception.php',
        'relativepath' => 'PEAR2/SimpleChannelServer/Exception.php',
        'configpath' => $dir . 'php',

           ),
      $dir . 'php/PEAR2/SimpleChannelServer/Get.php' =>
      array(
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/Get.php',
        'baseinstalldir' => 'PEAR2',
        'installed_as' => $dir . 'php/PEAR2/SimpleChannelServer/Get.php',
        'relativepath' => 'PEAR2/SimpleChannelServer/Get.php',
        'configpath' => $dir . 'php',

           ),
      $dir . 'php/PEAR2/SimpleChannelServer/REST/Category.php' =>
      array(
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/REST/Category.php',
        'baseinstalldir' => 'PEAR2',
        'installed_as' => $dir . 'php/PEAR2/SimpleChannelServer/REST/Category.php',
        'relativepath' => 'PEAR2/SimpleChannelServer/REST/Category.php',
        'configpath' => $dir . 'php',

           ),
      $dir . 'php/PEAR2/SimpleChannelServer/REST/Maintainer.php' =>
      array(
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/REST/Maintainer.php',
        'baseinstalldir' => 'PEAR2',
        'installed_as' => $dir . 'php/PEAR2/SimpleChannelServer/REST/Maintainer.php',
        'relativepath' => 'PEAR2/SimpleChannelServer/REST/Maintainer.php',
        'configpath' => $dir . 'php',

           ),
      $dir . 'php/PEAR2/SimpleChannelServer/REST/Manager.php' =>
      array(
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/REST/Manager.php',
        'baseinstalldir' => 'PEAR2',
        'installed_as' => $dir . 'php/PEAR2/SimpleChannelServer/REST/Manager.php',
        'relativepath' => 'PEAR2/SimpleChannelServer/REST/Manager.php',
        'configpath' => $dir . 'php',

           ),
      $dir . 'php/PEAR2/SimpleChannelServer/REST/Package.php' =>
      array(
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/REST/Package.php',
        'baseinstalldir' => 'PEAR2',
        'installed_as' => $dir . 'php/PEAR2/SimpleChannelServer/REST/Package.php',
        'relativepath' => 'PEAR2/SimpleChannelServer/REST/Package.php',
        'configpath' => $dir . 'php',

           ),
      $dir . 'php/PEAR2/SimpleChannelServer/REST/Release.php' =>
      array(
        'role' => 'php',
        'name' => 'src/SimpleChannelServer/REST/Release.php',
        'baseinstalldir' => 'PEAR2',
        'installed_as' => $dir . 'php/PEAR2/SimpleChannelServer/REST/Release.php',
        'relativepath' => 'PEAR2/SimpleChannelServer/REST/Release.php',
        'configpath' => $dir . 'php',

           ),
    ), $result, 'installedfiles');
}
<?php
$test->assertEquals(false, (bool)$reg->exists($info->name, $info->channel), 'package does not exist');
$reg->install($info);
$test->assertEquals(true, (bool)$reg->exists($info->name, $info->channel), 'package was installed');

$reg->uninstall($info->name, $info->channel);
$test->assertEquals(false, (bool)$reg->exists($info->name, $info->channel), 'post-uninstall');
try {
    $a = $reg->package[$info->channel . '/' . $info->name];
    throw new Exception('package acquisition should have failed');
} catch (PEAR2_Pyrus_Registry_Exception $e) {
    $test->assertEquals('Cannot retrieve package file object ' .
                'for package pear2.php.net/PEAR2_SimpleChannelServer, it is not installed', $e->getMessage(), 'message');
}
?><?php
$test->assertEquals(false, (bool)$reg->exists($info->name, $info->channel), 'package does not exist');
$reg->install($info);
$test->assertEquals(true, (bool)$reg->exists($info->name, $info->channel), 'package was installed');

$package = $reg->package[$info->channel . '/' . $info->name];

$test->assertEquals($info->name, $package->name, 'name');
$test->assertEquals($info->summary, $package->summary, 'summary');
$test->assertEquals($info->description, $package->description, 'description');
$test->assertEquals($info->notes, $package->notes, 'notes');
?>--TEST--
Registry: test toPackageFile, cascading registries
--FILE--
<?php
require __DIR__ . '/../setup.cascade.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
$reg2->replace($info);

$package = $reg->toPackageFile('PEAR2_SimpleChannelServer', 'pear2.php.net');
$test->assertEquals('PEAR2_SimpleChannelServer', $package->name, 'ensure we got package');
?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
$dir = dirname(__DIR__) . '/testit2';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Registry: test detectFileConflicts
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../detectfileconflicts/basic.template';

?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Registry: test listPackages, multiple packages, multiple channels
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../listpackages/multiple.channels.template';
$packages = $reg->listPackages('pear2.php.net', true);
sort($packages);
$test->assertEquals(array('HooHa', 'HooHa2', 'PEAR2_SimpleChannelServer'), $packages, 'after pear2 2');

?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Registry: test listPackages, cascading registries
--FILE--
<?php
require __DIR__ . '/../setup.cascade.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
$reg2->replace($info);
$packages = $reg->listPackages('pear2.php.net', false);
sort($packages);
$test->assertEquals(array('PEAR2_SimpleChannelServer'), $packages, 'test cascade');
$packages = $reg->listPackages('pear2.php.net', true);
sort($packages);
$test->assertEquals(array(), $packages, 'test cascade onlyMain');

?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
$dir = dirname(__DIR__) . '/testit2';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit2');
$reg2 = new PEAR2_Pyrus_Registry(__DIR__.'/testit2');
set_include_path(__DIR__ . DIRECTORY_SEPARATOR . 'testit' . PATH_SEPARATOR .
                 __DIR__ . DIRECTORY_SEPARATOR . 'testit2');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit', __DIR__. '/testit/notused.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry(__DIR__.'/testit');
$reg->setParent($reg2);
<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry(__DIR__.'/testit');
--TEST--
Registry: test getDependentPackages
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../getdependentpackages/basic.template';

?>
===DONE===
--CLEAN--
<?php
$dir = dirname(__DIR__) . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===This folder contains tests and supporting files that all registries must pass
Specifically, the Registry package object (PEAR2_Pyrus_Registry_Sqlite3_Package)
must conform to these tests--TEST--
Pear1 registry: test listPackages, multiple packages
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/listpackages/multiple.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Pear1 registry: test listPackages, multiple packages, multiple channels
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/listpackages/multiple.channels.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Pear1(__DIR__.'/testit');
--TEST--
Pear1 registry: test listPackages
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/listpackages/simple.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Pear1 PackageFile v2: test basic package.xml properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/license.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Pear1 PackageFile v2: test package.xml packagingcontents property
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/packagingcontents.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Pear1 PackageFile v2: test package.xml release properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/release.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Pear1 PackageFile v2: test package.xml allmaintainers property
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/allmaintainers.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Pear1 PackageFile v2: test package.xml file access properties (2)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/file2.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Pear1 PackageFile v2: test package.xml maintainer properties (2)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/maintainer2.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Pear1 PackageFile v2: test basic package.xml properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/basic.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Pear1 PackageFile v2: test package.xml file access properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/file.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Pear1(__DIR__.'/testit');
$reg->replace($info); // use replace to preserve date/time
$reg = $reg->package[$package->channel . '/' . $package->name];
--TEST--
Pear1 PackageFile v2: test package.xml release properties (3)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/release3.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Pear1 PackageFile v2: test package.xml maintainer properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/maintainer.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Pear1 PackageFile v2: test package.xml release properties (2)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/release2.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Pear1 registry: test getDependentPackages
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/getdependentpackages/basic.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Pear1(__DIR__.'/testit');
--TEST--
Pear1 registry: test detectFileConflicts
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/detectfileconflicts/basic.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Pear1(__DIR__.'/testit');
--TEST--
Pear1 registry: test dirtree info property
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/info/dirtree.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Pear1 registry: test basic info properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../AllRegistries/info/simple.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Pear1 registry: test installedfiles info property
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/info/installedfiles.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Pear1(__DIR__.'/testit');
--TEST--
Sqlite3 registry: uninstall 1
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
include __DIR__ . '/../../AllRegistries/uninstall/test.template';
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require dirname(__FILE__) . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
include __DIR__ . '/../../AllRegistries/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Pear1(__DIR__.'/testit');--TEST--
Pear1 registry: install 1
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
include __DIR__ . '/../../AllRegistries/install/test.template';
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require dirname(__FILE__) . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
include __DIR__ . '/../../AllRegistries/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Pear1(__DIR__.'/testit');--TEST--
Xml registry: test listPackages, multiple packages
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/listpackages/multiple.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Xml registry: test listPackages, multiple packages, multiple channels
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/listpackages/multiple.channels.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
$c->configSnapshot();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Xml(__DIR__.'/testit');
--TEST--
Xml registry: test listPackages
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/listpackages/simple.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Xml PackageFile v2: test basic package.xml properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/license.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Xml PackageFile v2: test package.xml packagingcontents property
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/packagingcontents.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Xml PackageFile v2: test package.xml release properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/release.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Xml PackageFile v2: test package.xml allmaintainers property
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/allmaintainers.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Xml PackageFile v2: test package.xml file access properties (2)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/file2.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Xml PackageFile v2: test package.xml maintainer properties (2)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/maintainer2.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Xml PackageFile v2: test basic package.xml properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/basic.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Xml PackageFile v2: test package.xml file access properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/file.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Xml(__DIR__.'/testit');
$reg->replace($info); // use replace to preserve date/time
$reg = $reg->package[$package->channel . '/' . $package->name];
--TEST--
Xml PackageFile v2: test package.xml release properties (3)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/release3.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Xml PackageFile v2: test package.xml maintainer properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/maintainer.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Xml PackageFile v2: test package.xml release properties (2)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/release2.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Xml registry: test getDependentPackages
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/getdependentpackages/basic.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
$c->configSnapshot();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Xml(__DIR__.'/testit');
--TEST--
Xml registry: test detectFileConflicts
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/detectfileconflicts/basic.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
$c->configSnapshot();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Xml(__DIR__.'/testit');
--TEST--
Xml registry: test dirtree info property
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/info/dirtree.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Xml registry: test basic info properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../AllRegistries/info/simple.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Xml registry: test installedfiles info property
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/info/installedfiles.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
$c->configSnapshot();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Xml(__DIR__.'/testit');
--TEST--
Sqlite3 registry: uninstall 1
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
include __DIR__ . '/../../AllRegistries/uninstall/test.template';
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require dirname(__FILE__) . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
include __DIR__ . '/../../AllRegistries/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Xml(__DIR__.'/testit');--TEST--
Xml registry: install 1
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
include __DIR__ . '/../../AllRegistries/install/test.template';
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require dirname(__FILE__) . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
include __DIR__ . '/../../AllRegistries/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Xml(__DIR__.'/testit');--TEST--
Registry base: test cloneRegistry() for Pear1 -> Sqlite3 registry
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/listpackages/multiple.channels.template';


$packages = $reg2->listPackages('pear2.php.net');
sort($packages);
$test->assertEquals(array(), $packages, 'before pear2');
$packages = $reg2->listPackages('pear.php.net');
sort($packages);
$test->assertEquals(array(), $packages, 'before pear');

// $reg has 4 installed packages
$reg2->cloneRegistry($reg);

$packages = $reg2->listPackages('pear2.php.net');
sort($packages);
$test->assertEquals(array('HooHa', 'HooHa2', 'PEAR2_SimpleChannelServer'), $packages, 'after pear2');
$packages = $reg2->listPackages('pear.php.net');
sort($packages);
$test->assertEquals(array('HooHa2'), $packages, 'after pear');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg2 = new PEAR2_Pyrus_Registry_Sqlite3(__DIR__.'/testit');
$reg = new PEAR2_Pyrus_Registry_Pear1(__DIR__.'/testit');--TEST--
Registry base: test makeUninstallConnections()
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/listpackages/multiple.channels.template';

$package = $reg->package['pear2.php.net/HooHa'];
$graph = new PEAR2_Pyrus_DirectedGraph;

$packages = array();
$info = new PEAR2_Pyrus_PackageFile_v2;
$info->name = 'foo';
$info->channel = 'bar.poo';
$packages['bar.poo/foo'] = clone $info;
$info->name = 'fra';
$info->uri = 'http://bar';
$packages['__uri/fra'] = clone $info;
$info->name = 'boop';
$info->channel = 'is.used';
$packages['is.used/boop'] = clone $info;
$info->name = 'boo';
$info->channel = 'not.used';
$packages['not.used/boo'] = clone $info;
$package->dependencies['required']->package['bar.poo/foo']->min('1.0');
$package->dependencies['optional']->subpackage['__uri/fra']->uri('http://bar');
$package->dependencies['group']->boo->package['is.used/boop']->min('1.0');
$package->dependencies['required']->subpackage['not.used/boo']->conflicts();
$package->makeUninstallConnections($graph, $packages);
$result = array();
foreach ($graph as $pack) {
    $result[] = $pack->channel . '/' . $pack->name;
}
sort($result);

$test->assertEquals(array(
    '__uri/fra',
    'bar.poo/foo',
    'is.used/boop',
    'pear2.php.net/HooHa',
), $result, 'result');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Sqlite3(__DIR__.'/testit');--TEST--
Registry base: test validateUninstallDependenices()
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;

$p1 = new PEAR2_Pyrus_PackageFile_v2;
$p1->name = 'foo';
$p1->channel = 'pear2.php.net';
$p1->version['release'] = '1.2.3';
$p1->files['foo'] = array('role' => 'php');
$p1->notes = 'hi';
$p1->summary = 'hi';
$p1->description = 'hi';
$p1->dependencies['required']->package['pear2.php.net/test']->min('1.2.4');

$reg->install($p1);

$p2 = new PEAR2_Pyrus_PackageFile_v2;
$p2->name = 'foo2';
$p2->channel = 'pear2.php.net';
$p2->version['release'] = '1.2.3';
$p2->files['foo2'] = array('role' => 'php');
$p2->notes = 'hi';
$p2->summary = 'hi';
$p2->description = 'hi';
$p2->dependencies['required']->subpackage['pear2.php.net/test']->min('1.2.4');

$reg->install($p2);

$p3 = new PEAR2_Pyrus_PackageFile_v2;
$p3->name = 'test';
$p3->channel = 'pear2.php.net';
$p3->version['release'] = '1.2.3';
$p3->files['test'] = array('role' => 'php');
$p3->notes = 'hi';
$p3->summary = 'hi';
$p3->description = 'hi';

$reg->install($p3);

$package = $reg->package['pear2.php.net/test'];

$test->assertEquals(true, $package->validateUninstallDependencies(array($package), $errs), 'test');
$test->assertEquals(0, count($errs), 'test error count');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Registry base: test validateUninstallDependenices(), success because parent package uninstalled also
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;

$p1 = new PEAR2_Pyrus_PackageFile_v2;
$p1->name = 'test';
$p1->channel = 'pear2.php.net';
$p1->version['release'] = '1.2.3';
$p1->files['foo'] = array('role' => 'php');
$p1->notes = 'hi';
$p1->summary = 'hi';
$p1->description = 'hi';
$p1->dependencies['required']->package['pear2.php.net/foo']->min('1.2.3');

$reg->install($p1);

$p2 = new PEAR2_Pyrus_PackageFile_v2;
$p2->name = 'foo2';
$p2->channel = 'pear2.php.net';
$p2->version['release'] = '1.2.3';
$p2->files['foo2'] = array('role' => 'php');
$p2->notes = 'hi';
$p2->summary = 'hi';
$p2->description = 'hi';
$p2->dependencies['optional']->subpackage['pear2.php.net/foo']->min('1.2.4');

$reg->install($p2);

$p3 = new PEAR2_Pyrus_PackageFile_v2;
$p3->name = 'foo';
$p3->channel = 'pear2.php.net';
$p3->version['release'] = '1.2.3';
$p3->files['test'] = array('role' => 'php');
$p3->notes = 'hi';
$p3->summary = 'hi';
$p3->description = 'hi';

$reg->install($p3);

$package = $reg->package['pear2.php.net/foo'];

$test->assertEquals(true, $package->validateUninstallDependencies(array($package, $p1), $errs), 'test');
$test->assertEquals(0, count($errs), 'test error count 2');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Registry base: test validateUninstallDependenices() failure
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;

$p1 = new PEAR2_Pyrus_PackageFile_v2;
$p1->name = 'test';
$p1->channel = 'pear2.php.net';
$p1->version['release'] = '1.2.3';
$p1->files['foo'] = array('role' => 'php');
$p1->notes = 'hi';
$p1->summary = 'hi';
$p1->description = 'hi';
$p1->dependencies['required']->package['pear2.php.net/foo']->min('1.2.3');

$reg->install($p1);

$p2 = new PEAR2_Pyrus_PackageFile_v2;
$p2->name = 'foo2';
$p2->channel = 'pear2.php.net';
$p2->version['release'] = '1.2.3';
$p2->files['foo2'] = array('role' => 'php');
$p2->notes = 'hi';
$p2->summary = 'hi';
$p2->description = 'hi';
$p2->dependencies['required']->subpackage['pear2.php.net/foo']->min('1.2.4');

$reg->install($p2);

$p3 = new PEAR2_Pyrus_PackageFile_v2;
$p3->name = 'foo';
$p3->channel = 'pear2.php.net';
$p3->version['release'] = '1.2.3';
$p3->files['test'] = array('role' => 'php');
$p3->notes = 'hi';
$p3->summary = 'hi';
$p3->description = 'hi';

$reg->install($p3);

$package = $reg->package['pear2.php.net/foo'];

$test->assertEquals(false, $package->validateUninstallDependencies(array($package), $errs), 'test');
$test->assertEquals(1, count($errs->E_ERROR), 'test error count');
$test->assertEquals(1, count($errs), 'test error count 2');
$test->assertEquals('channel://pear2.php.net/foo (version >= 1.2.3) is required by installed package "channel://pear2.php.net/test"', $errs->E_ERROR[0]->getMessage(), 'error 1');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
$reg = new PEAR2_Pyrus_Registry_Sqlite3(__DIR__.'/testit');
$errs = new PEAR2_MultiErrors;--TEST--
Registry base: test ArrayAccess
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/listpackages/multiple.channels.template';

$test->assertEquals(true, isset($reg->package['pear2.php.net/HooHa']), 'offsetExists');
$test->assertEquals(true, isset($reg->package['pear/HooHa2']), 'short offsetExists');
$test->assertEquals(false, isset($reg->package['pear2/Nonexisting']), 'non-existing offsetExists');

$package = $reg->package['pear2.php.net/HooHa'];
unset($reg->package['pear2.php.net/HooHa']);
$test->assertEquals(false, isset($reg->package['pear2.php.net/HooHa']), 'offsetUnset');
$reg->package[] = $package;
$test->assertEquals(true, isset($reg->package['pear2.php.net/HooHa']), 'offsetSet');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Sqlite3(__DIR__.'/testit');--TEST--
Sqlite3 registry: test listPackages, multiple packages
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/listpackages/multiple.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Sqlite3 registry: test listPackages, multiple packages, multiple channels
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/listpackages/multiple.channels.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Sqlite3(__DIR__.'/testit');--TEST--
Sqlite3 registry: test listPackages
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/listpackages/simple.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Sqlite3 PackageFile v2: test basic package.xml properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/license.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Sqlite3 PackageFile v2: test package.xml packagingcontents property
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/packagingcontents.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Sqlite3 PackageFile v2: test package.xml release properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/release.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Sqlite3 PackageFile v2: test package.xml allmaintainers property
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/allmaintainers.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Sqlite3 PackageFile v2: test package.xml file access properties (2)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/file2.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Sqlite3 PackageFile v2: test package.xml maintainer properties (2)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/maintainer2.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Sqlite3 PackageFile v2: test basic package.xml properties
--FILE--
<?php
require __DIR__ . '/../../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Sqlite3(__DIR__.'/testit');
$reg->replace($info); // use replace to preserve date/time
$reg = $reg->package[$package->channel . '/' . $package->name];

require __DIR__ . '/../../../AllRegistries/package/basic/basic.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Sqlite3 PackageFile v2: test package.xml file access properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/file.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Sqlite3(__DIR__.'/testit');
$reg->replace($info); // use replace to preserve date/time
$reg = $reg->package[$package->channel . '/' . $package->name];
--TEST--
Sqlite3 PackageFile v2: test package.xml release properties (3)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/release3.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Sqlite3 PackageFile v2: test package.xml maintainer properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/maintainer.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Sqlite3 PackageFile v2: test package.xml release properties (2)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../../AllRegistries/package/basic/release2.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Sqlite3 registry: test getDependentPackages
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/getdependentpackages/basic.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Sqlite3(__DIR__.'/testit');--TEST--
Sqlite3 registry: test detectFileConflicts
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/detectfileconflicts/basic.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Sqlite3(__DIR__.'/testit');--TEST--
Sqlite3: init
--FILE--
<?php
require dirname(__FILE__) . '/../../setup.php.inc';
try {
    $a = new PEAR2_Pyrus_Registry_Sqlite3(false, true);
    throw new Exception('should fail, didn\'t');
} catch (PEAR2_Pyrus_Registry_Exception $e) {
    $test->assertEquals('Cannot create SQLite3 registry, registry is read-only', $e->getMessage(), 'message');
}

class r extends PEAR2_Pyrus_Registry_Sqlite3
{
    static public $databases = array();
}

$a = new r(false);
$b = new r(false);
$test->assertEquals($a::$databases, $b::$databases, 'ensure they the same');
$test->assertEquals($a->getDatabase(), $b->getDatabase(), 'another test');
$test->assertEquals(':memory:', $a->getDatabase(), 'last one');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
test Registry __construct error
--FILE--
<?php
require dirname(__FILE__) . '/../../setup.php.inc';

try {
    $a = new $registryclass(__DIR__, array('b#b#b#'));
    throw new Exception('did not fail');
} catch (PEAR2_Pyrus_Registry_Exception $e) {
    $test->assertEquals('Unable to initialize registry for path "' . __DIR__ . '"', $e->getMessage(), 'message');
    $test->assertEquals(1, count($e->getCause()), 'cause');
}

?>
===DONE===
--EXPECT--
===DONE===--TEST--
Sqlite3 registry: test dirtree info property
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/info/dirtree.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Sqlite3 registry: test basic info properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../AllRegistries/info/simple.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
Sqlite3 registry: test installedfiles info property
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$dir = __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR;
require __DIR__ . '/../../AllRegistries/info/installedfiles.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../../../PackageFile_v2/setupFiles/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Sqlite3(__DIR__.'/testit');--TEST--
Sqlite3 registry: uninstall 1
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
include __DIR__ . '/../../AllRegistries/uninstall/test.template';
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require dirname(__FILE__) . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
include __DIR__ . '/../../AllRegistries/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Sqlite3(__DIR__.'/testit');--TEST--
Sqlite3 registry: install 1
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
include __DIR__ . '/../../AllRegistries/install/test.template';
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require dirname(__FILE__) . '/../../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
include __DIR__ . '/../../AllRegistries/setupPackageFile.php.inc';
$reg = new PEAR2_Pyrus_Registry_Sqlite3(__DIR__.'/testit');<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
$registryclass = 'PEAR2_Pyrus_Registry';
--TEST--
PEAR2_Pyrus_Package: test array access for accessing files
--FILE--
<?php
define('MYDIR', __DIR__);
include __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;

$pf->name = 'testing2';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');
$pf->files['foobar'] = array(
    'attribs' => array('role' => 'php'),
    'tasks:replace' => array('attribs' =>
                             array('from' => '@blah@', 'to' => 'version', 'type' => 'package-info'))
);
$pf->files['glooby'] = array('role' => 'php');
$pf->setPackagefile(__DIR__ . '/testit/package.xml');

$package = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/testit/package.xml', $package, $xmlcontainer);
$package->setInternalPackage($xml);

file_put_contents(__DIR__ . '/testit/foobar', 'hi there');

// does nothing
$package['blah'] = 1;
// does nothing
unset($package['blah']);

$test->assertTrue(isset($package['foobar']), 'isset(foobar)');
$test->assertFalse(isset($package['notset']), 'isset(notset)');
$test->assertEquals(array (
  'attribs' => 
  array (
    'role' => 'php',
    'name' => 'foobar',
  ),
  'tasks:replace' => 
  array (
    'attribs' => 
    array (
      'from' => '@blah@',
      'to' => 'version',
      'type' => 'package-info',
    ),
  ),
)
, $package['foobar'], 'contents');
$test->assertEquals('hi there', $package['contents://foobar'], 'contents://foobar');
$test->assertFalse($package->isRemote(), 'isRemote');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
@mkdir(MYDIR . DIRECTORY_SEPARATOR . 'testit');
set_include_path(MYDIR . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(MYDIR.'/testit');
$c->bin_dir = MYDIR . '/testit/bin';
restore_include_path();
$c->saveConfig();
--TEST--
PEAR2_Pyrus_Package::parsePackageDescription()
--FILE--
<?php
include __DIR__ . '/setup.minimal.php.inc';
mkdir($d = __DIR__ . '/testit');
file_put_contents($d . '/foob', '<?xml version="1.0" ?>
                  <package version="2.0">');

$test->assertEquals('PEAR2_Pyrus_Package_Xml', PEAR2_Pyrus_Package::parsePackageDescription($d . '/foob'),
                    'no extension, xml');

file_put_contents($d . '/foob', 'not xml');

$test->assertEquals('PEAR2_Pyrus_Package_Phar', PEAR2_Pyrus_Package::parsePackageDescription($d . '/foob'),
                    'no extension, not xml');

$test->assertEquals('PEAR2_Pyrus_Package_Remote', PEAR2_Pyrus_Package::parsePackageDescription('http://blah'),
                    'http');

$test->assertEquals('PEAR2_Pyrus_Package_Remote', PEAR2_Pyrus_Package::parsePackageDescription('https://blah'),
                    'https');

$test->assertEquals('PEAR2_Pyrus_Package_Remote', PEAR2_Pyrus_Package::parsePackageDescription('foob', true),
                    'force remote');

try {
    PEAR2_Pyrus_Package::parsePackageDescription('Yorng/$%#');
    throw new Exception('should have failed');
} catch (PEAR2_Pyrus_Package_Exception $e) {
    $test->assertEquals('package "Yorng/$%#" is unknown', $e->getMessage(), 'Yorng/$%%#');
    $test->assertEquals('Unable to process package name', $e->getCause()->getMessage(), 'name parse error');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::begin(), journal dir exists
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

mkdir(__DIR__ . '/testit/.journal-src');

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

$test->assertFileNotExists(__DIR__ . '/testit/src/', 'before');
$test->assertFileExists(__DIR__ . '/testit/.journal-src/', 'before');

$atomic->begin();

$test->assertFileNotExists(__DIR__ . '/testit/src/', 'after');
$test->assertFileExists(__DIR__ . '/testit/.journal-src/', 'after');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::begin()
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';
$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

$test->assertFileNotExists(__DIR__ . '/testit/src/', 'before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/', 'before');

$atomic->begin();

$test->assertFileNotExists(__DIR__ . '/testit/src/', 'after');
$test->assertFileExists(__DIR__ . '/testit/.journal-src/', 'after');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::begin(), journal dir exists as file
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

touch(__DIR__ . '/testit/.journal-src');

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

try {
    PEAR2_Pyrus_AtomicFileTransaction::begin();
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Unable to begin transaction', $e->getMessage(), 'main message');
    $causes = array();
    $e->getCauseMessage($causes);
    $test->assertEquals('unrecoverable transaction error: journal path ' .
                        __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR .
                        '.journal-src exists and is not a directory', $causes[0]['message'], 'error message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::begin() failure, in transaction
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

$atomic->begin();
try {
    $atomic->begin();
    die('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Cannot begin - already in a transaction', $e->getMessage(), 'error');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::begin(), journal dir exists as file 2
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

touch(__DIR__ . '/testit/.journal-src');


PEAR2_Pyrus_AtomicFileTransaction::begin();

try {
    $atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Unable to begin transaction for ' . __DIR__ . '/testit/src', $e->getMessage(), 'main message');
    $causes = array();
    $e->getCauseMessage($causes);
    $test->assertEquals('unrecoverable transaction error: journal path ' .
                        __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR .
                        '.journal-src exists and is not a directory', $causes[1]['message'], 'error message');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::begin() with copy to journal directory
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.php.inc';
mkdir(__DIR__ . '/testit/php');
touch(__DIR__ . '/testit/php/foo', 1234567);
touch(__DIR__ . '/testit/php/another');
umask(0);
mkdir(__DIR__ . '/testit/php/sub/deep/deep/thing', 0777, true);
mkdir(__DIR__ . '/testit/php/anothernew/dir', 0777, true);
umask(022);
touch(__DIR__ . '/testit/php/anothernew/dir/file');

$test->assertFileExists(__DIR__ . '/testit/php', __DIR__ . '/testit/php');
$test->assertFileExists(__DIR__ . '/testit/php/foo', __DIR__ . '/testit/php/foo');
$test->assertFileExists(__DIR__ . '/testit/php/another', __DIR__ . '/testit/php/another');
$test->assertFileExists(__DIR__ . '/testit/php/sub/deep/deep/thing', __DIR__ . '/testit/php/sub/deep/deep/thing');
$test->assertFileExists(__DIR__ . '/testit/php/anothernew/dir', __DIR__ . '/testit/php/another/dir');
$test->assertFileExists(__DIR__ . '/testit/php/anothernew/dir/file', __DIR__ . '/testit/php/another/dir/file');

$test->assertFileNotExists(__DIR__ . '/testit/.journal-php', __DIR__ . '/testit/.journal-php before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-php/foo', __DIR__ . '/testit/.journal-php/foo before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-php/another', __DIR__ . '/testit/.journal-php/another before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-php/sub/deep/deep/thing', __DIR__ . '/testit/.journal-php/sub/deep/deep/thing before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-php/anothernew/dir', __DIR__ . '/testit/.journal-php/another/dir before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-php/anothernew/dir/file', __DIR__ . '/testit/.journal-php/another/dir/file before');

$role = new PEAR2_Pyrus_Installer_Role_Php(PEAR2_Pyrus_Config::current(), PEAR2_Pyrus_Installer_Role::getInfo('php'));
$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject($role);

PEAR2_Pyrus_AtomicFileTransaction::begin();

$test->assertFileExists(__DIR__ . '/testit/php', __DIR__ . '/testit/php after');
$test->assertFileExists(__DIR__ . '/testit/php/foo', __DIR__ . '/testit/php/foo after');
$test->assertFileExists(__DIR__ . '/testit/php/another', __DIR__ . '/testit/php/another after');
$test->assertFileExists(__DIR__ . '/testit/php/sub/deep/deep/thing', __DIR__ . '/testit/php/sub/deep/deep/thing after');
$test->assertFileExists(__DIR__ . '/testit/php/anothernew/dir', __DIR__ . '/testit/php/another/dir after');
$test->assertFileExists(__DIR__ . '/testit/php/anothernew/dir/file', __DIR__ . '/testit/php/another/dir/file after');

$test->assertFileExists(__DIR__ . '/testit/.journal-php', __DIR__ . '/testit/.journal-php after');
$test->assertFileExists(__DIR__ . '/testit/.journal-php/foo', __DIR__ . '/testit/.journal-php/foo after');
$test->assertFileExists(__DIR__ . '/testit/.journal-php/another', __DIR__ . '/testit/.journal-php/another after');
$test->assertFileExists(__DIR__ . '/testit/.journal-php/sub/deep/deep/thing', __DIR__ . '/testit/.journal-php/sub/deep/deep/thing after');
$test->assertFileExists(__DIR__ . '/testit/.journal-php/anothernew/dir', __DIR__ . '/testit/.journal-php/another/dir after');
$test->assertFileExists(__DIR__ . '/testit/.journal-php/anothernew/dir/file', __DIR__ . '/testit/.journal-php/another/dir/file after');

$test->assertEquals(decoct(0777), decoct(0777 & fileperms(__DIR__ . '/testit/.journal-php/sub/deep/deep/thing')), 'perms ' . __DIR__ . '/testit/.journal-php/sub/deep/deep/thing');
$test->assertEquals(decoct(0755), decoct(0755 & fileperms(__DIR__ . '/testit/.journal-php/anothernew')), 'perms ' . __DIR__ . '/testit/.journal-php/anothernew');
$test->assertEquals(decoct(0777), decoct(0777 & fileperms(__DIR__ . '/testit/.journal-php/anothernew/dir')), 'perms ' . __DIR__ . '/testit/.journal-php/anothernew/dir');

$test->assertEquals(filemtime(__DIR__ . '/testit/php/another'), filemtime(__DIR__ . '/testit/.journal-php/another'), 'mtime 1');
$test->assertEquals(1234567, filemtime(__DIR__ . '/testit/.journal-php/foo'), 'foo mtime');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::removeBackups() failure, not in transaction
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

try {
    PEAR2_Pyrus_AtomicFileTransaction::removeBackups();
    die('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Cannot remove backups - not in a transaction', $e->getMessage(), 'error');
}

try {
    $atomic->backupAndCommit();
    die('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Cannot commit - not in a transaction', $e->getMessage(), 'error');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::removePath(), path doesn't exist
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

PEAR2_Pyrus_AtomicFileTransaction::begin();

$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/foo', 'before');
$atomic->removePath('foo');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/foo', 'should still exist');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::removePath() failure, not strict
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

PEAR2_Pyrus_AtomicFileTransaction::begin();
mkdir(__DIR__ . '/testit/.journal-src/foo/bar', 0777, true);
$test->assertFileExists(__DIR__ . '/testit/.journal-src/foo', 'before');
$atomic->removePath('foo', false);
$test->assertFileExists(__DIR__ . '/testit/.journal-src/foo', 'should still exist');
PEAR2_Pyrus_AtomicFileTransaction::rollback();
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::removePath() failure, strict
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

PEAR2_Pyrus_AtomicFileTransaction::begin();
mkdir(__DIR__ . '/testit/.journal-src/foo/bar', 0777, true);
$test->assertFileExists(__DIR__ . '/testit/.journal-src/foo', 'before');
try {
    $atomic->removePath('foo');
    die('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Cannot remove directory foo in ' . __DIR__ . DIRECTORY_SEPARATOR .
                        'testit' . DIRECTORY_SEPARATOR . '.journal-src', $e->getMessage(), 'error');
}
$test->assertFileExists(__DIR__ . '/testit/.journal-src/foo', 'should still exist');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::removePath() failure, not in transaction
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

try {
    $atomic->removePath('foo');
    die('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Cannot remove foo - not in a transaction', $e->getMessage(), 'error');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include __DIR__ . '/../test_framework.php.inc';
mkdir(MYDIR . DIRECTORY_SEPARATOR . 'testit');
--TEST--
PEAR2_Pyrus_AtomicFileTransaction::rollback() failure, not in transaction
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

try {
    PEAR2_Pyrus_AtomicFileTransaction::rollback();
    die('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Cannot rollback - not in a transaction', $e->getMessage(), 'error');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::rollback() 2
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';
mkdir(__DIR__ . '/testit/src');
touch(__DIR__ . '/testit/src/foo');
touch(__DIR__ . '/testit/src/another');
mkdir(__DIR__ . '/testit/src/sub/deep/deep/thing', 0777, true);
mkdir(__DIR__ . '/testit/src/anothernew/dir', 0777, true);
touch(__DIR__ . '/testit/src/anothernew/dir/file');

$test->assertFileExists(__DIR__ . '/testit/src', __DIR__ . '/testit/src');
$test->assertFileExists(__DIR__ . '/testit/src/foo', __DIR__ . '/testit/src/foo');
$test->assertFileExists(__DIR__ . '/testit/src/another', __DIR__ . '/testit/src/another');
$test->assertFileExists(__DIR__ . '/testit/src/sub/deep/deep/thing', __DIR__ . '/testit/src/sub/deep/deep/thing');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir', __DIR__ . '/testit/src/another/dir');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir/file', __DIR__ . '/testit/src/another/dir/file');

$test->assertFileNotExists(__DIR__ . '/testit/.journal-src', __DIR__ . '/testit/.journal-src before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/foo', __DIR__ . '/testit/.journal-src/foo before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/another', __DIR__ . '/testit/.journal-src/another before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/sub/deep/deep/thing', __DIR__ . '/testit/.journal-src/sub/deep/deep/thing before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/anothernew/dir', __DIR__ . '/testit/.journal-src/another/dir before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/anothernew/dir/file', __DIR__ . '/testit/.journal-src/another/dir/file before');

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

PEAR2_Pyrus_AtomicFileTransaction::begin();
PEAR2_Pyrus_AtomicFileTransaction::commit();
PEAR2_Pyrus_AtomicFileTransaction::rollback();

$test->assertFileExists(__DIR__ . '/testit/src', __DIR__ . '/testit/src after');
$test->assertFileExists(__DIR__ . '/testit/src/foo', __DIR__ . '/testit/src/foo after');
$test->assertFileExists(__DIR__ . '/testit/src/another', __DIR__ . '/testit/src/another after');
$test->assertFileExists(__DIR__ . '/testit/src/sub/deep/deep/thing', __DIR__ . '/testit/src/sub/deep/deep/thing after');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir', __DIR__ . '/testit/src/another/dir after');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir/file', __DIR__ . '/testit/src/another/dir/file after');

$test->assertFileNotExists(__DIR__ . '/testit/.journal-src', __DIR__ . '/testit/.journal-src after');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/foo', __DIR__ . '/testit/.journal-src/foo after');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/another', __DIR__ . '/testit/.journal-src/another after');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/sub/deep/deep/thing', __DIR__ . '/testit/.journal-src/sub/deep/deep/thing after');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/anothernew/dir', __DIR__ . '/testit/.journal-src/another/dir after');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/anothernew/dir/file', __DIR__ . '/testit/.journal-src/another/dir/file after');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::rollback()
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';
mkdir(__DIR__ . '/testit/src');
touch(__DIR__ . '/testit/src/foo');
touch(__DIR__ . '/testit/src/another');
mkdir(__DIR__ . '/testit/src/sub/deep/deep/thing', 0777, true);
mkdir(__DIR__ . '/testit/src/anothernew/dir', 0777, true);
touch(__DIR__ . '/testit/src/anothernew/dir/file');

$test->assertFileExists(__DIR__ . '/testit/src', __DIR__ . '/testit/src');
$test->assertFileExists(__DIR__ . '/testit/src/foo', __DIR__ . '/testit/src/foo');
$test->assertFileExists(__DIR__ . '/testit/src/another', __DIR__ . '/testit/src/another');
$test->assertFileExists(__DIR__ . '/testit/src/sub/deep/deep/thing', __DIR__ . '/testit/src/sub/deep/deep/thing');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir', __DIR__ . '/testit/src/another/dir');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir/file', __DIR__ . '/testit/src/another/dir/file');

$test->assertFileNotExists(__DIR__ . '/testit/.journal-src', __DIR__ . '/testit/.journal-src before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/foo', __DIR__ . '/testit/.journal-src/foo before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/another', __DIR__ . '/testit/.journal-src/another before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/sub/deep/deep/thing', __DIR__ . '/testit/.journal-src/sub/deep/deep/thing before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/anothernew/dir', __DIR__ . '/testit/.journal-src/another/dir before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/anothernew/dir/file', __DIR__ . '/testit/.journal-src/another/dir/file before');

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

PEAR2_Pyrus_AtomicFileTransaction::begin();
PEAR2_Pyrus_AtomicFileTransaction::rollback();

$test->assertFileExists(__DIR__ . '/testit/src', __DIR__ . '/testit/src after');
$test->assertFileExists(__DIR__ . '/testit/src/foo', __DIR__ . '/testit/src/foo after');
$test->assertFileExists(__DIR__ . '/testit/src/another', __DIR__ . '/testit/src/another after');
$test->assertFileExists(__DIR__ . '/testit/src/sub/deep/deep/thing', __DIR__ . '/testit/src/sub/deep/deep/thing after');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir', __DIR__ . '/testit/src/another/dir after');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir/file', __DIR__ . '/testit/src/another/dir/file after');

$test->assertFileNotExists(__DIR__ . '/testit/.journal-src', __DIR__ . '/testit/.journal-src after');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/foo', __DIR__ . '/testit/.journal-src/foo after');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/another', __DIR__ . '/testit/.journal-src/another after');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/sub/deep/deep/thing', __DIR__ . '/testit/.journal-src/sub/deep/deep/thing after');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/anothernew/dir', __DIR__ . '/testit/.journal-src/another/dir after');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/anothernew/dir/file', __DIR__ . '/testit/.journal-src/another/dir/file after');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::repair() fail
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.php.inc';
PEAR2_Pyrus_Config::current()->ext_dir = __DIR__ . '/testit/ext';
mkdir(__DIR__ . '/testit/.old-ext');
touch(__DIR__ . '/testit/php');
mkdir(__DIR__ . '/testit/.old-php');
touch(__DIR__ . '/testit/.old-php/foo');

PEAR2_Pyrus_AtomicFileTransaction::begin();
try {
    PEAR2_Pyrus_AtomicFileTransaction::repair();
    throw new Exception('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Cannot repair while in a transaction', $e->getMessage(), 'error transaction');
}
PEAR2_Pyrus_AtomicFileTransaction::rollback();

try {
    PEAR2_Pyrus_AtomicFileTransaction::repair();
    throw new Exception('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Repair failed - php_dir path ' . __DIR__ . DIRECTORY_SEPARATOR .
                        'testit' . DIRECTORY_SEPARATOR . 'php is not a directory.  ' .
                        'Move this file out of the way and try the repair again', $e->getMessage(), 'error');
}

$test->assertFileNotExists(__DIR__ . '/testit/php/foo', __DIR__ . '/testit/php/foo');
$test->assertFileNotExists(__DIR__ . '/testit/ext', __DIR__ . '/testit/ext');
$test->assertFileExists(__DIR__ . '/testit/.old-ext', __DIR__ . '/testit/.old-ext');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-php', __DIR__ . '/testit/.journal-php');
$test->assertFileExists(__DIR__ . '/testit/.old-php', __DIR__ . '/testit/.old-php');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::repair()
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.php.inc';
PEAR2_Pyrus_Config::current()->ext_dir = __DIR__ . '/testit/ext';
mkdir(__DIR__ . '/testit/.old-ext');
mkdir(__DIR__ . '/testit/src');
mkdir(__DIR__ . '/testit/.old-src');
touch(__DIR__ . '/testit/.old-src/foo');

PEAR2_Pyrus_AtomicFileTransaction::repair();

$test->assertFileExists(__DIR__ . '/testit/src/foo', __DIR__ . '/testit/src/foo');
$test->assertFileExists(__DIR__ . '/testit/ext', __DIR__ . '/testit/ext');
$test->assertFileNotExists(__DIR__ . '/testit/.old-ext', __DIR__ . '/testit/.old-ext');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-ext', __DIR__ . '/testit/src/.journal-ext');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/foo', __DIR__ . '/testit/.journal-src/foo');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src', __DIR__ . '/testit/.journal-src');
$test->assertFileNotExists(__DIR__ . '/testit/.old-src', __DIR__ . '/testit/.old-src');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::createOrOpenPath(), path can't be opened, contents is string
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

PEAR2_Pyrus_AtomicFileTransaction::begin();

mkdir(__DIR__ . '/testit/.journal-src/foo/bar', 0777, true);
try {
    $atomic->createOrOpenPath('foo', 'hi', 'wb');
    die('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Unable to write to foo in ' . __DIR__ .
                        DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR .
                        '.journal-src', $e->getMessage(), 'error msg');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::createOrOpenPath() failure, not in transaction
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

try {
    $atomic->createOrOpenPath('foo');
    die('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Cannot create foo - not in a transaction', $e->getMessage(), 'error');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::createOrOpenPath(), path can't be opened
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

PEAR2_Pyrus_AtomicFileTransaction::begin();

mkdir(__DIR__ . '/testit/.journal-src/foo/bar', 0777, true);
try {
    $atomic->createOrOpenPath('foo', null, 'wb');
    die('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Unable to open foo for writing in ' . __DIR__ .
                        DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR .
                        '.journal-src', $e->getMessage(), 'error msg');
}

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::createOrOpenPath(), failure, contents is empty stream
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

PEAR2_Pyrus_AtomicFileTransaction::begin();

file_put_contents(__DIR__ . '/testit/blah', 'blah');
$fp = fopen(__DIR__ . '/testit/blah', 'rb');
fread($fp, 55);
try {
    $atomic->createOrOpenPath('foo', $fp, 0664);
    fclose($fp);
    die('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Unable to copy to foo in ' . __DIR__ . DIRECTORY_SEPARATOR .
                        'testit' . DIRECTORY_SEPARATOR . '.journal-src', $e->getMessage(), 'error message');
}
fclose($fp);
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::createOrOpenPath(), path can't be opened, contents is stream
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

PEAR2_Pyrus_AtomicFileTransaction::begin();

mkdir(__DIR__ . '/testit/.journal-src/foo/bar', 0777, true);
file_put_contents(__DIR__ . '/testit/blah', 'blah');
$fp = fopen(__DIR__ . '/testit/blah', 'rb');
try {
    $atomic->createOrOpenPath('foo', $fp, 'wb');
    die('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Unable to open foo for writing in ' . __DIR__ .
                        DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR .
                        '.journal-src', $e->getMessage(), 'error msg');
}
fclose($fp);
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::createOrOpenPath(), return open file pointer
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

PEAR2_Pyrus_AtomicFileTransaction::begin();

$fp = $atomic->createOrOpenPath('foo', false, 0646);
fwrite($fp, 'hi');
fclose($fp);
$test->assertEquals('hi', file_get_contents(__DIR__ . '/testit/.journal-src/foo'), 'foo contents');
$test->assertEquals(decoct(0646), decoct(0777 & fileperms(__DIR__ . '/testit/.journal-src/foo')), 'perms set');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::createOrOpenPath(), contents is stream
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

PEAR2_Pyrus_AtomicFileTransaction::begin();

file_put_contents(__DIR__ . '/testit/blah', 'blah');
$fp = fopen(__DIR__ . '/testit/blah', 'rb');
$atomic->createOrOpenPath('foo', $fp, 0664);
fclose($fp);
$test->assertEquals('blah', file_get_contents(__DIR__ . '/testit/.journal-src/foo'), 'blah contents');
$test->assertEquals(decoct(0664), decoct(0777 & fileperms(__DIR__ . '/testit/.journal-src/foo')), 'perms set');
PEAR2_Pyrus_AtomicFileTransaction::rollback();
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include __DIR__ . '/../test_framework.php.inc';
@mkdir(MYDIR . DIRECTORY_SEPARATOR . 'testit');
set_include_path(MYDIR . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(MYDIR.'/testit');
restore_include_path();
$c->saveConfig();

--TEST--
PEAR2_Pyrus_AtomicFileTransaction::rmrf()
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';
touch(__DIR__ . '/testit/foo');
touch(__DIR__ . '/testit/another');
mkdir(__DIR__ . '/testit/sub/deep/deep/thing', 0777, true);
mkdir(__DIR__ . '/testit/anothernew/dir', 0777, true);
touch(__DIR__ . '/testit/anothernew/dir/file');

$test->assertFileExists(__DIR__ . '/testit', __DIR__ . '/testit');
$test->assertFileExists(__DIR__ . '/testit/foo', __DIR__ . '/testit/foo');
$test->assertFileExists(__DIR__ . '/testit/another', __DIR__ . '/testit/another');
$test->assertFileExists(__DIR__ . '/testit/sub/deep/deep/thing', __DIR__ . '/testit/sub/deep/deep/thing');
$test->assertFileExists(__DIR__ . '/testit/anothernew/dir', __DIR__ . '/testit/another/dir');
$test->assertFileExists(__DIR__ . '/testit/anothernew/dir/file', __DIR__ . '/testit/another/dir/file');

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

$atomic->rmrf(__DIR__ . '/testit');

$test->assertFileNotExists(__DIR__ . '/testit', __DIR__ . '/testit');
$test->assertFileNotExists(__DIR__ . '/testit/foo', __DIR__ . '/testit/foo');
$test->assertFileNotExists(__DIR__ . '/testit/another', __DIR__ . '/testit/another');
$test->assertFileNotExists(__DIR__ . '/testit/sub/deep/deep/thing', __DIR__ . '/testit/sub/deep/deep/thing');
$test->assertFileNotExists(__DIR__ . '/testit/anothernew/dir', __DIR__ . '/testit/another/dir');
$test->assertFileNotExists(__DIR__ . '/testit/anothernew/dir/file', __DIR__ . '/testit/another/dir/file');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::mkdir() failure, not in transaction
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

try {
    $atomic->mkdir('oops');
    die('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Cannot create directory oops - not in a transaction', $e->getMessage(), 'error');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::removeJournalPath() failure, not in transaction
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

try {
    $atomic->removeJournalPath();
    die('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Cannot remove journal path - not in a transaction', $e->getMessage(), 'error');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::mkdir() failure, directory exists and is a file
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');
PEAR2_Pyrus_AtomicFileTransaction::begin();

$atomic->createOrOpenPath('oops', 'hi');

try {
    $atomic->mkdir('oops');
    die('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Cannot create directory oops, it is a file', $e->getMessage(), 'error');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::mkdir(), use default mode
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

PEAR2_Pyrus_Config::current()->umask = 0775;
$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');
PEAR2_Pyrus_AtomicFileTransaction::begin();

$atomic->mkdir('good');

PEAR2_Pyrus_AtomicFileTransaction::commit();

$test->assertFileExists(__DIR__ . '/testit/src/good', __DIR__ . '/testit/src/good should exist');
$test->assertEquals(decoct(0775), decoct(0777 & fileperms(__DIR__ . '/testit/src/good')), 'permissions should work');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::commit() failure, not in transaction
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

try {
    PEAR2_Pyrus_AtomicFileTransaction::commit();
    die('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $test->assertEquals('Cannot commit - not in a transaction', $e->getMessage(), 'error');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::commit() failure, can't create backup dir
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';
mkdir(__DIR__ . '/testit/src');
touch(__DIR__ . '/testit/src/foo', 1234567);
touch(__DIR__ . '/testit/src/another');
umask(0);
mkdir(__DIR__ . '/testit/src/sub/deep/deep/thing', 0777, true);
mkdir(__DIR__ . '/testit/src/anothernew/dir', 0777, true);
umask(022);
touch(__DIR__ . '/testit/src/anothernew/dir/file');

$test->assertFileExists(__DIR__ . '/testit/src', __DIR__ . '/testit/src');
$test->assertFileExists(__DIR__ . '/testit/src/foo', __DIR__ . '/testit/src/foo');
$test->assertFileExists(__DIR__ . '/testit/src/another', __DIR__ . '/testit/src/another');
$test->assertFileExists(__DIR__ . '/testit/src/sub/deep/deep/thing', __DIR__ . '/testit/src/sub/deep/deep/thing');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir', __DIR__ . '/testit/src/another/dir');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir/file', __DIR__ . '/testit/src/another/dir/file');

$test->assertFileNotExists(__DIR__ . '/testit/.journal-src', __DIR__ . '/testit/.journal-src before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/foo', __DIR__ . '/testit/.journal-src/foo before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/another', __DIR__ . '/testit/.journal-src/another before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/sub/deep/deep/thing', __DIR__ . '/testit/.journal-src/sub/deep/deep/thing before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/anothernew/dir', __DIR__ . '/testit/.journal-src/another/dir before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/anothernew/dir/file', __DIR__ . '/testit/.journal-src/another/dir/file before');

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

$atomic->begin();

$test->assertFileExists(__DIR__ . '/testit/src', __DIR__ . '/testit/src after');
$test->assertFileExists(__DIR__ . '/testit/src/foo', __DIR__ . '/testit/src/foo after');
$test->assertFileExists(__DIR__ . '/testit/src/another', __DIR__ . '/testit/src/another after');
$test->assertFileExists(__DIR__ . '/testit/src/sub/deep/deep/thing', __DIR__ . '/testit/src/sub/deep/deep/thing after');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir', __DIR__ . '/testit/src/another/dir after');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir/file', __DIR__ . '/testit/src/another/dir/file after');

$test->assertFileExists(__DIR__ . '/testit/.journal-src', __DIR__ . '/testit/.journal-src after');
$test->assertFileExists(__DIR__ . '/testit/.journal-src/foo', __DIR__ . '/testit/.journal-src/foo after');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/newfile', __DIR__ . '/testit/.journal-src/newfile before');
$test->assertFileExists(__DIR__ . '/testit/.journal-src/another', __DIR__ . '/testit/.journal-src/another after');
$test->assertFileExists(__DIR__ . '/testit/.journal-src/sub/deep/deep/thing', __DIR__ . '/testit/.journal-src/sub/deep/deep/thing after');
$test->assertFileExists(__DIR__ . '/testit/.journal-src/anothernew/dir', __DIR__ . '/testit/.journal-src/another/dir after');
$test->assertFileExists(__DIR__ . '/testit/.journal-src/anothernew/dir/file', __DIR__ . '/testit/.journal-src/another/dir/file after');

$test->assertEquals(decoct(0777), decoct(0777 & fileperms(__DIR__ . '/testit/.journal-src/sub/deep/deep/thing')), 'perms ' . __DIR__ . '/testit/.journal-src/sub/deep/deep/thing');
$test->assertEquals(decoct(0755), decoct(0755 & fileperms(__DIR__ . '/testit/.journal-src/anothernew')), 'perms ' . __DIR__ . '/testit/.journal-src/anothernew');
$test->assertEquals(decoct(0777), decoct(0777 & fileperms(__DIR__ . '/testit/.journal-src/anothernew/dir')), 'perms ' . __DIR__ . '/testit/.journal-src/anothernew/dir');

$test->assertEquals(filemtime(__DIR__ . '/testit/src/another'), filemtime(__DIR__ . '/testit/.journal-src/another'), 'mtime 1');
$test->assertEquals(1234567, filemtime(__DIR__ . '/testit/.journal-src/foo'), 'foo mtime');

$atomic->removePath('foo');
$atomic->createOrOpenPath('newfile', 'hithere');

$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/foo', __DIR__ . '/testit/.journal-src/foo after erase');
$test->assertFileExists(__DIR__ . '/testit/.journal-src/newfile', __DIR__ . '/testit/.journal-src/newfile after create');

$test->assertFileExists(__DIR__ . '/testit/src/foo', __DIR__ . '/testit/.journal-src/foo after erase 2');
$test->assertFileNotExists(__DIR__ . '/testit/src/newfile', __DIR__ . '/testit/.journal-src/newfile after create 2');

mkdir(__DIR__ . '/testit/.old-src');
try {
    PEAR2_Pyrus_AtomicFileTransaction::commit();
    die('should have failed');
} catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
    $cause = array();
    $e->getCauseMessage($cause);
    $test->assertEquals('CRITICAL - unable to complete transaction, rename of actual to backup path failed', $cause[1]['message'], 'error');
    $test->assertEquals('ERROR: commit failed', $e->getMessage(), 'error');
}
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src', 'verify transaction cancelled');
$test->assertFileExists(__DIR__ . '/testit/src', 'verify transaction cancelled and source not deleted');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_AtomicFileTransaction::commit()
--FILE--
<?php
define('MYDIR', __DIR__);
require dirname(__DIR__) . '/setup.empty.php.inc';
mkdir(__DIR__ . '/testit/src');
touch(__DIR__ . '/testit/src/foo', 1234567);
touch(__DIR__ . '/testit/src/another');
umask(0);
mkdir(__DIR__ . '/testit/src/sub/deep/deep/thing', 0777, true);
mkdir(__DIR__ . '/testit/src/anothernew/dir', 0777, true);
umask(022);
touch(__DIR__ . '/testit/src/anothernew/dir/file');

$test->assertFileExists(__DIR__ . '/testit/src', __DIR__ . '/testit/src');
$test->assertFileExists(__DIR__ . '/testit/src/foo', __DIR__ . '/testit/src/foo');
$test->assertFileExists(__DIR__ . '/testit/src/another', __DIR__ . '/testit/src/another');
$test->assertFileExists(__DIR__ . '/testit/src/sub/deep/deep/thing', __DIR__ . '/testit/src/sub/deep/deep/thing');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir', __DIR__ . '/testit/src/another/dir');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir/file', __DIR__ . '/testit/src/another/dir/file');

$test->assertFileNotExists(__DIR__ . '/testit/.journal-src', __DIR__ . '/testit/.journal-src before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/foo', __DIR__ . '/testit/.journal-src/foo before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/another', __DIR__ . '/testit/.journal-src/another before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/sub/deep/deep/thing', __DIR__ . '/testit/.journal-src/sub/deep/deep/thing before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/anothernew/dir', __DIR__ . '/testit/.journal-src/another/dir before');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/anothernew/dir/file', __DIR__ . '/testit/.journal-src/another/dir/file before');

PEAR2_Pyrus_AtomicFileTransaction::begin();

$atomic = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject(__DIR__ . '/testit/src');

$test->assertFileExists(__DIR__ . '/testit/src', __DIR__ . '/testit/src after');
$test->assertFileExists(__DIR__ . '/testit/src/foo', __DIR__ . '/testit/src/foo after');
$test->assertFileExists(__DIR__ . '/testit/src/another', __DIR__ . '/testit/src/another after');
$test->assertFileExists(__DIR__ . '/testit/src/sub/deep/deep/thing', __DIR__ . '/testit/src/sub/deep/deep/thing after');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir', __DIR__ . '/testit/src/another/dir after');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir/file', __DIR__ . '/testit/src/another/dir/file after');

$test->assertFileExists(__DIR__ . '/testit/.journal-src', __DIR__ . '/testit/.journal-src after');
$test->assertFileExists(__DIR__ . '/testit/.journal-src/foo', __DIR__ . '/testit/.journal-src/foo after');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/newfile', __DIR__ . '/testit/.journal-src/newfile before');
$test->assertFileExists(__DIR__ . '/testit/.journal-src/another', __DIR__ . '/testit/.journal-src/another after');
$test->assertFileExists(__DIR__ . '/testit/.journal-src/sub/deep/deep/thing', __DIR__ . '/testit/.journal-src/sub/deep/deep/thing after');
$test->assertFileExists(__DIR__ . '/testit/.journal-src/anothernew/dir', __DIR__ . '/testit/.journal-src/another/dir after');
$test->assertFileExists(__DIR__ . '/testit/.journal-src/anothernew/dir/file', __DIR__ . '/testit/.journal-src/another/dir/file after');

$test->assertEquals(decoct(0777), decoct(0777 & fileperms(__DIR__ . '/testit/.journal-src/sub/deep/deep/thing')), 'perms ' . __DIR__ . '/testit/.journal-src/sub/deep/deep/thing');
$test->assertEquals(decoct(0755), decoct(0755 & fileperms(__DIR__ . '/testit/.journal-src/anothernew')), 'perms ' . __DIR__ . '/testit/.journal-src/anothernew');
$test->assertEquals(decoct(0777), decoct(0777 & fileperms(__DIR__ . '/testit/.journal-src/anothernew/dir')), 'perms ' . __DIR__ . '/testit/.journal-src/anothernew/dir');

$test->assertEquals(filemtime(__DIR__ . '/testit/src/another'), filemtime(__DIR__ . '/testit/.journal-src/another'), 'mtime 1');
$test->assertEquals(1234567, filemtime(__DIR__ . '/testit/.journal-src/foo'), 'foo mtime');

$atomic->removePath('foo');
$atomic->createOrOpenPath('newfile', 'hithere');

$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/foo', __DIR__ . '/testit/.journal-src/foo after erase');
$test->assertFileExists(__DIR__ . '/testit/.journal-src/newfile', __DIR__ . '/testit/.journal-src/newfile after create');

$test->assertFileExists(__DIR__ . '/testit/src/foo', __DIR__ . '/testit/.journal-src/foo after erase 2');
$test->assertFileNotExists(__DIR__ . '/testit/src/newfile', __DIR__ . '/testit/.journal-src/newfile after create 2');

PEAR2_Pyrus_AtomicFileTransaction::commit();

$test->assertFileExists(__DIR__ . '/testit/src', __DIR__ . '/testit/src after commit');
$test->assertFileNotExists(__DIR__ . '/testit/src/foo', __DIR__ . '/testit/src/foo after commit');
$test->assertFileExists(__DIR__ . '/testit/src/newfile', __DIR__ . '/testit/src/newfile after commit');
$test->assertFileExists(__DIR__ . '/testit/src/another', __DIR__ . '/testit/src/another after commit');
$test->assertFileExists(__DIR__ . '/testit/src/sub/deep/deep/thing', __DIR__ . '/testit/src/sub/deep/deep/thing after commit');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir', __DIR__ . '/testit/src/another/dir after commit');
$test->assertFileExists(__DIR__ . '/testit/src/anothernew/dir/file', __DIR__ . '/testit/src/another/dir/file after commit');

$test->assertFileExists(__DIR__ . '/testit/.old-src', __DIR__ . '/testit/.old-src after commit');
$test->assertFileExists(__DIR__ . '/testit/.old-src/foo', __DIR__ . '/testit/.old-src/foo after commit');
$test->assertFileNotExists(__DIR__ . '/testit/.old-src/newfile', __DIR__ . '/testit/.old-src/newfile after commit');
$test->assertFileExists(__DIR__ . '/testit/.old-src/another', __DIR__ . '/testit/.old-src/another after commit');
$test->assertFileExists(__DIR__ . '/testit/.old-src/sub/deep/deep/thing', __DIR__ . '/testit/.old-src/sub/deep/deep/thing after commit');
$test->assertFileExists(__DIR__ . '/testit/.old-src/anothernew/dir', __DIR__ . '/testit/.old-src/another/dir after commit');
$test->assertFileExists(__DIR__ . '/testit/.old-src/anothernew/dir/file', __DIR__ . '/testit/.old-src/another/dir/file after commit');

$test->assertFileNotExists(__DIR__ . '/testit/.journal-src', __DIR__ . '/testit/.journal-src after commit');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/foo', __DIR__ . '/testit/.journal-src/foo after commit');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/newfile', __DIR__ . '/testit/.journal-src/newfile after commit');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/another', __DIR__ . '/testit/.journal-src/another after commit');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/sub/deep/deep/thing', __DIR__ . '/testit/.journal-src/sub/deep/deep/thing after commit');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/anothernew/dir', __DIR__ . '/testit/.journal-src/another/dir after commit');
$test->assertFileNotExists(__DIR__ . '/testit/.journal-src/anothernew/dir/file', __DIR__ . '/testit/.journal-src/another/dir/file after commit');

PEAR2_Pyrus_AtomicFileTransaction::removeBackups();

$test->assertFileNotExists(__DIR__ . '/testit/.old-src', __DIR__ . '/testit/.old-src after commit');
$test->assertFileNotExists(__DIR__ . '/testit/.old-src/foo', __DIR__ . '/testit/.old-src/foo after commit');
$test->assertFileNotExists(__DIR__ . '/testit/.old-src/newfile', __DIR__ . '/testit/.old-src/newfile after commit');
$test->assertFileNotExists(__DIR__ . '/testit/.old-src/another', __DIR__ . '/testit/.old-src/another after commit');
$test->assertFileNotExists(__DIR__ . '/testit/.old-src/sub/deep/deep/thing', __DIR__ . '/testit/.old-src/sub/deep/deep/thing after commit');
$test->assertFileNotExists(__DIR__ . '/testit/.old-src/anothernew/dir', __DIR__ . '/testit/.old-src/another/dir after commit');
$test->assertFileNotExists(__DIR__ . '/testit/.old-src/anothernew/dir/file', __DIR__ . '/testit/.old-src/another/dir/file after commit');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::install(), basic test
--FILE--
<?php
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
require __DIR__ . '/setup.php.inc';
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();

ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'install', __DIR__.'/../../../../sandbox/SimpleChannelServer/package.xml'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . 'Installed pear2.php.net/PEAR2_SimpleChannelServer-0.1.0' . "\n",
                    $contents,
                    'list packages');

$test->assertFileExists(__DIR__ . '/testit/bin/pearscs', 'bin/pearscs');
$test->assertEquals(decoct(0755), decoct(0777 & fileperms(__DIR__ . '/testit/bin/pearscs')), 'bin/pearscs perms');
$test->assertFileExists(__DIR__ . '/testit/php/PEAR2/SimpleChannelServer.php', 'php/PEAR2/SimpleChannelServer.php');
$test->assertEquals(file_get_contents(__DIR__.'/../../../../sandbox/SimpleChannelServer/src/SimpleChannelServer.php'),
                    file_get_contents(__DIR__ . '/testit/php/PEAR2/SimpleChannelServer.php'), 'files match');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::channelAdd()
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
mkdir(__DIR__ . '/testit');
$chan = PEAR2_Pyrus_Config::current()->channelregistry['pecl.php.net'];
$newchan = $chan->toChannelFile();
$newchan->name = 'foobar';
$newchan->alias = 'fb';
file_put_contents(__DIR__ . '/testit/blah.xml', $newchan);
ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'channel-add', __DIR__ . '/testit/blah.xml'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . "Adding channel from channel.xml:\n"
                    . "Adding channel foobar successful\n",
                    $contents,
                    'delete channel');
$chan = PEAR2_Pyrus_Config::current()->channelregistry['foobar'];
$test->assertEquals('fb', $chan->alias, 'verify we got back what we added');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::_findPEAR test 2: no userfile detected
--FILE--
<?php
require __DIR__ . '/setup.minimal.php.inc';
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
touch(__DIR__ . '/testfoo');

test_scriptfrontend::$stdin = array(
    'yes', // answer to "It appears you have not used Pyrus before, welcome!  Initialize install?"
    __DIR__ . '/testfoo', // answer to "Where would you like to install packages by default?"
    __DIR__ . '/testit2', // answer to "Where would you like to install packages by default?"
    'no',  // answer to "Create it?"
    __DIR__ . '/testit', // answer to "Where would you like to install packages by default?"
    'yes', // answer to "Create it?"
    ''     // continue
);
$cli = new test_scriptfrontend();

set_include_path(__DIR__ . '/testit');
ob_start();
$cli->run($args = array ());
$contents = ob_get_contents();
ob_end_clean();
restore_include_path();

$help1 = "Pyrus: No user configuration file detected\n" .
"It appears you have not used Pyrus before, welcome!  Initialize install?\n" .
"Please choose:\n" .
"  yes\n" .
"  no\n" .
"[yes] : yes\n" .
"Great.  We will store your configuration in:\n" .
'  ' . __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR . "foo.xml\n" .
"Where would you like to install packages by default?\n" .
'[' . getcwd() . "] : " . __DIR__ . DIRECTORY_SEPARATOR . "testfoo\n" .
"You have chosen:\n" .
__DIR__ . DIRECTORY_SEPARATOR . "testfoo\n" .
__DIR__ . DIRECTORY_SEPARATOR . "testfoo exists, and is not a directory\n" .
"Where would you like to install packages by default?\n" .
'[' . getcwd() . "] : " . __DIR__ . DIRECTORY_SEPARATOR . "testit2\n" .
"You have chosen:\n" .
__DIR__ . DIRECTORY_SEPARATOR . "testit2\n" .
" this path does not yet exist\n" .
"Create it?\n" .
"Please choose:\n" .
"  yes\n" .
"  no\n" .
"[yes] : no\n" .
"Where would you like to install packages by default?\n" .
'[' . getcwd() . "] : " . __DIR__ . DIRECTORY_SEPARATOR . "testit\n" .
"You have chosen:\n" .
__DIR__ . DIRECTORY_SEPARATOR . "testit\n" .
" this path does not yet exist\n" .
"Create it?\n" .
"Please choose:\n" .
"  yes\n" .
"  no\n" .
"[yes] : yes\n" .
'Automatically cascading include_path components ' . __DIR__ . DIRECTORY_SEPARATOR . "testit\n" .
"Thank you, enjoy using Pyrus\n" .
"Documentation is at http://pear.php.net\n" .
'Using PEAR installation found at ' . __DIR__ . DIRECTORY_SEPARATOR . 'testit' . "\n" 
;
$help2 =
'
Pyrus, the installer for PEAR2

Usage:
  php findpear2.php [/path/to/pear] [options]
  php findpear2.php [/path/to/pear] [options] <command> [options] [args]

Options:
  -v, --verbose  increase verbosity
  -h, --help     show this help message and exit
  --version      show the program version and exit

Commands:
  install           Install a package.  Use install --plugin to install
                    plugins
  upgrade           Upgrade a package.  Use upgrade --plugin to upgrade
                    plugins
  uninstall         Uninstall a package.  Use uninstall --plugin to
                    uninstall plugins
  build             Build a PHP extension package from source and install
                    the compiled extension
  download          Download a remote package to the current directory
  list-packages     List all installed packages in all channels
  list-channels     List all discovered channels
  channel-discover  Discover a new channel
  channel-add       Add a new channel to the registry
  channel-del       Remove a channel from the registry
  upgrade-registry  Upgrade an old PEAR installation to the new registry
                    format
  run-scripts       Run all post-install scripts for a package
  config-show       Show all configuration values
  set               Set a configuration value
  mypear            Set a configuration value
  help              Get help on a particular command, or all commands

';
$test->assertEquals($help1 . $help2,
                    $contents,
                    'initialize choice');
?>
===DONE===
--CLEAN--
<?php
unlink(__DIR__ . '/testfoo');
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::help() with specific command help requested
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
set_include_path(__DIR__ . '/testit');
ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (0 => 'help', 'install'));

$contents = ob_get_contents();
ob_end_clean();
restore_include_path();
$help1 = 'Using PEAR installation found at ' . __DIR__ . DIRECTORY_SEPARATOR . 'testit' . "\n";
$help2 =
'
Install a package.  Use install --plugin to install plugins

Usage:
  php help.command.php [options] install [options] <package...>

Options:
  -p plugin, --plugin=plugin                       Manage plugin
                                                   installation only
  -r packagingroot, --packagingroot=packagingroot  Install the package in a
                                                   directory in preparation
                                                   for packaging with tools
                                                   like RPM
  -o, --optionaldeps                               Automatically download
                                                   and install all optional
                                                   dependencies
  -f, --force                                      Force the installation
                                                   to proceed independent
                                                   of errors.  USE
                                                   SPARINGLY.

Arguments:
  package  package.xml, local package archive, remove package archive, or
           abstract package.


Installs listed packages.

local package.xml example:
php pyrus.phar install package.xml

local package archive example:
php pyrus.phar install PackageName-1.2.0.tar

remote package archive example:
php pyrus.phar install http://www.example.com/PackageName-1.2.0.tgz

Examples of an abstract package:
php pyrus.phar install PackageName
 installs PackageName from the default channel with stability preferred_state
php pyrus.phar pear/PackageName
 installs PackageName from the pear.php.net channel with stability preferred_state
php pyrus.phar install channel://doc.php.net/PackageName
 installs PackageName from the doc.php.net channel with stability preferred_state
php pyrus.phar install PackageName-beta
 installs PackageName from the default channel, beta or stable stability
php pyrus.phar install PackageName-1.2.0
 installs PackageName from the default channel, version 1.2.0

';
$test->assertEquals($help1 . $help2,
                    $contents,
                    'help output');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::help()
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
set_include_path(__DIR__ . '/testit');
ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (0 => 'help'));

$contents = ob_get_contents();
ob_end_clean();
restore_include_path();
$help1 = 'Using PEAR installation found at ' . __DIR__ . DIRECTORY_SEPARATOR . 'testit' . "\n";
$help2 =
'
Pyrus, the installer for PEAR2

Usage:
  php help.php [/path/to/pear] [options]
  php help.php [/path/to/pear] [options] <command> [options] [args]

Options:
  -v, --verbose  increase verbosity
  -h, --help     show this help message and exit
  --version      show the program version and exit

Commands:
  install           Install a package.  Use install --plugin to install
                    plugins
  upgrade           Upgrade a package.  Use upgrade --plugin to upgrade
                    plugins
  uninstall         Uninstall a package.  Use uninstall --plugin to
                    uninstall plugins
  build             Build a PHP extension package from source and install
                    the compiled extension
  download          Download a remote package to the current directory
  list-packages     List all installed packages in all channels
  list-channels     List all discovered channels
  channel-discover  Discover a new channel
  channel-add       Add a new channel to the registry
  channel-del       Remove a channel from the registry
  upgrade-registry  Upgrade an old PEAR installation to the new registry
                    format
  run-scripts       Run all post-install scripts for a package
  config-show       Show all configuration values
  set               Set a configuration value
  mypear            Set a configuration value
  help              Get help on a particular command, or all commands

';
$test->assertEquals($help1 . $help2,
                    $contents,
                    'help output');

ob_start();
$cli->run($args = array ());

$contents = ob_get_contents();
ob_end_clean();

$test->assertEquals($help1 . $help2, $contents, 'no args help');
ob_start();
$cli->run($args = array ('fooburp'));

$contents = ob_get_contents();
ob_end_clean();

$test->assertEquals($help1 .
                    'Unknown command: fooburp' . "\n" . $help2, $contents, 'unknown command help');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::build(), basic test (this actually builds an extension)
--SKIPIF--
<?php
if (substr(PHP_OS, 0, 3) === 'WIN') {
    die('skip requires unix to work');
}
?>
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit', __DIR__ . '/testit/pearconfig.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
$c->ext_dir = __DIR__ . '/testit/ext';
restore_include_path();
$c->saveConfig();

ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'install', __DIR__.'/build/docblock-0.2.0.tar'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . 'Installed pecl.php.net/docblock-0.2.0' . "\n"
                    . " ==> To build this PECL package, use the build command\n",
                    $contents,
                    'installation');
$testpackage = new PEAR2_Pyrus_Package(__DIR__.'/build/docblock-0.2.0.tar');
$test->assertEquals('1.4.3', $testpackage->dependencies['required']->pearinstaller->min, 'tar pearinstaller dep');
$test->assertEquals('1.4.3', PEAR2_Pyrus_Config::current()->registry->package['pecl/docblock']
                               ->dependencies['required']->pearinstaller->min, 'same after installation');

ob_start();
$cli->run($args = array (__DIR__ . '/testit', 'build', 'pecl/docblock'));
$contents = ob_get_contents();
ob_end_clean();

$start = 'Using PEAR installation found at ' . __DIR__ . '/testit
Building PECL extensions
cleaning build directory ' . __DIR__ . '/testit/src/docblock
running: phpize --clean 2>&1
Cleaning..
building in ' . __DIR__ . '/testit/src/docblock
running: phpize 2>&1
Configuring for:';

$end = '@running: make INSTALL_ROOT="' . __DIR__ . '/testit/src/docblock/\.install" install 2>&1
Installing shared extensions:     ' . __DIR__ . '/testit/src/docblock/\.install' .
    PEAR2_Pyrus_Config::current()->defaultValue('ext_dir') . '/
\d+   4 drwxr\-xr\-x 3 user user       4096 \d{4}\-\d{2}\-\d{2} \d{2}:\d{2} ' . __DIR__ .
    '/testit/src/docblock/\.install/usr
\d+   4 drwxr\-xr\-x 3 user user       4096 \d{4}\-\d{2}\-\d{2} \d{2}:\d{2} ' . __DIR__ .
    '/testit/src/docblock/\.install/usr/local
\d+   4 drwxr\-xr\-x 3 user user       4096 \d{4}\-\d{2}\-\d{2} \d{2}:\d{2} ' . __DIR__ .
    '/testit/src/docblock/\.install/usr/local/lib
\d+   4 drwxr\-xr\-x 3 user user       4096 \d{4}\-\d{2}\-\d{2} \d{2}:\d{2} ' . __DIR__ .
    '/testit/src/docblock/\.install/usr/local/lib/php
\d+   4 drwxr\-xr\-x 3 user user       4096 \d{4}\-\d{2}\-\d{2} \d{2}:\d{2} ' . __DIR__ .
    '/testit/src/docblock/\.install/usr/local/lib/php/extensions
\d+   4 drwxr\-xr\-x 2 user user       4096 \d{4}\-\d{2}\-\d{2} \d{2}:\d{2} ' . __DIR__ .
    '/testit/src/docblock/\.install/usr/local/lib/php/extensions/[^/]+
\d+ 156 \-rwxr\-xr\-x 1 user user\s+\d+ \d{4}\-\d{2}\-\d{2} \d{2}:\d{2} ' . __DIR__ .
    '/testit/src/docblock/\.install/usr/local/lib/php/extensions/[^/]+/docblock\.so
Installing \'' . __DIR__ . '/testit/ext/docblock\.so\'
@';

$test->assertEquals($start, substr($contents, 0, strlen($start)), 'beginning of contents');
$test->assertRegex($end, substr($contents, strpos($contents, 'running: make INSTALL_ROOT')), 'end of contents');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::download()
--FILE--
<?php
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
require __DIR__ . '/setup.php.inc';
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit', __DIR__ . '/testit/pearconfig.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();

require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../../Mocks/Internet/install.prepare.explicitstate',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
PEAR2_Pyrus_Package_Remote::$downloadClass = 'Internet';

mkdir(__DIR__ . '/testit/oksavehere');
chdir(__DIR__ . '/testit/oksavehere');
ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'download', __DIR__ .
                                '/../../Mocks/Internet/install.prepare.explicitstate/get/P1-1.1.0RC1.tar',
                                'P2-beta', 'P1', 'unknown', 'P3-1.1.0RC2'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . "failed to init unknown for download (package unknown does not exist)\n"
                    . 'Downloading ' . __DIR__ .
                                '/../../Mocks/Internet/install.prepare.explicitstate/get/P1-1.1.0RC1.tar...' .
                                "done (" . __DIR__ . DIRECTORY_SEPARATOR . 'testit' .
                                DIRECTORY_SEPARATOR . 'oksavehere' . DIRECTORY_SEPARATOR . "P1-1.1.0RC1.tar)\n"
                    . 'Downloading P2-beta...' .
                                "done (" . __DIR__ . DIRECTORY_SEPARATOR . 'testit' .
                                DIRECTORY_SEPARATOR . 'oksavehere' . DIRECTORY_SEPARATOR . "P2-1.1.0RC3.tgz)\n"
                    . 'Downloading P1...' .
                                "done (" . __DIR__ . DIRECTORY_SEPARATOR . 'testit' .
                                DIRECTORY_SEPARATOR . 'oksavehere' . DIRECTORY_SEPARATOR . "P1-1.0.0.tgz)\n"
                    . 'Downloading P3-1.1.0RC2...' .
                                "failed! (Could not download abstract package pear2.php.net/P3)\n",
                     $contents,
                    'list packages');

$test->assertFileExists(__DIR__ . '/testit/oksavehere/P1-1.1.0RC1.tar', 'P1 tarball');
$test->assertFileExists(__DIR__ . '/testit/oksavehere/P2-1.1.0RC3.tgz', 'P2-beta');
$test->assertFileExists(__DIR__ . '/testit/oksavehere/P1-1.0.0.tgz', 'P1');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::channelDiscover() https
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit', __DIR__ . '/testit/pearconfig.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();

require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/testit',
                       'https://pear.unl.edu/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
PEAR2_Pyrus_ScriptFrontend_Commands::$downloadClass = 'Internet';
file_put_contents(__DIR__ . '/testit/channel.xml', '<?xml version="1.0" encoding="UTF-8"?>
<channel version="1.0" xmlns="http://pear.php.net/channel-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/channel-1.0 http://pear.php.net/dtd/channel-1.0.xsd">
 <name>pear.unl.edu</name>
 <suggestedalias>salty</suggestedalias>
 <summary>Simple PEAR Channel</summary>
 <servers>
  <primary>
   <rest>
    <baseurl type="REST1.0">http://foo/rest/</baseurl>
    <baseurl type="REST1.1">http://foo/rest/</baseurl>
    <baseurl type="REST1.3">http://foo/rest/</baseurl>
   </rest>
  </primary>
 </servers>
</channel>');
$test->assertEquals(false, isset(PEAR2_Pyrus_Config::current()->channelregistry['pear.unl.edu']),
                    'before discover of pear.unl.edu');
ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'channel-discover', 'pear.unl.edu'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . "Discovery of channel pear.unl.edu successful\n",
                     $contents,
                    'list packages');

$test->assertEquals(true, isset(PEAR2_Pyrus_Config::current()->channelregistry['pear.unl.edu']),
                    'after discover of pear.unl.edu');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::upgradeRegistry()
--SKIPIF--
<?php
if (!($f = @fopen('PEAR.php', 'r', true))) {
    die('SKIP - PEAR is required');
}
fclose($f);
?>
--FILE--
<?php
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}

define('MYDIR', __DIR__);
require __DIR__ . '/setup.minimal.php.inc';

include __DIR__ . '/setup.pearinstall.php.inc';

$test->assertEquals(array('Pear1'), PEAR2_Pyrus_Registry::detectRegistries(__DIR__ . '/testit'),
                    'after install, verify Pear1 registry exists');

// now for the Pyrus portion of this test
set_include_path(dirname(__FILE__).'/testit');

$a = PEAR2_Pyrus_Config::singleton(__DIR__ . '/testit', __DIR__ . '/testit/foo.xml');
$a->ext_dir = __DIR__ . '/testit/ext';
$a->bin_dir = __DIR__ . '/testit/bin';
file_put_contents(__DIR__ . '/testit/foo.xml', '<pearconfig version="1.0"></pearconfig>');
restore_include_path();

ob_start();
$cli = new test_scriptfrontend();
$cli->run($args = array (0 => 'upgrade-registry', __DIR__ . '/testit'));

$contents = ob_get_contents();
ob_end_clean();
$help1 = 'Using PEAR installation found at ' . __DIR__ . DIRECTORY_SEPARATOR . 'testit' . "\n";
$d = DIRECTORY_SEPARATOR;
$help2 = "Upgrading registry at path " . __DIR__ . '/testit' . "\n";
   

$test->assertEquals($help1 . $help2,
                    $contents,
                    'upgrade-registries output');


$test->assertEquals(array('Sqlite3', 'Xml', 'Pear1'), PEAR2_Pyrus_Registry::detectRegistries(__DIR__ . '/testit'),
                    'verify registry upgrade');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include __DIR__ . '/../../test_framework.php.inc';

class test_Config extends PEAR2_Pyrus_Config
{
    static function getDefaultUserConfigFile()
    {
        return __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR . 'foo.xml';
    }
}

class test_scriptfrontend extends PEAR2_Pyrus_ScriptFrontend_Commands
{
    public static $configclass = 'test_Config';
    public static $stdin = array();
    public static $index = 0;
    function _readStdin($amount = 1024)
    {
        $ret = self::$stdin[self::$index];
        echo $ret,"\n";
        if (++self::$index >= count(self::$stdin)) {
            throw new Exception('ran out of input, add more to test');
        }
        return $ret;
    }
}--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::channelDel()
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
mkdir(__DIR__ . '/testit');
$chan = PEAR2_Pyrus_Config::current()->channelregistry['pecl.php.net'];
$newchan = $chan->toChannelFile();
$newchan->name = 'foobar';
$newchan->alias = 'fb';
PEAR2_Pyrus_Config::current()->channelregistry[] = $newchan;
$test->assertTrue(isset(PEAR2_Pyrus_Config::current()->channelregistry['foobar']), 'verify we added it');

ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'channel-del', 'foobar'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . "Deleting channel foobar successful\n",
                    $contents,
                    'delete channel');
$test->assertFalse(isset(PEAR2_Pyrus_Config::current()->channelregistry['foobar']), 'verify we removed it');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::listPackages(), packages installed
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();

ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'install', __DIR__.'/../../../../sandbox/SimpleChannelServer/package.xml'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . 'Installed pear2.php.net/PEAR2_SimpleChannelServer-0.1.0' . "\n",
                    $contents,
                    'list packages');

$test->assertFileExists(__DIR__ . '/testit/bin/pearscs', 'bin/pearscs');
$test->assertEquals(decoct(0755), decoct(0777 & fileperms(__DIR__ . '/testit/bin/pearscs')), 'bin/pearscs perms');
$test->assertFileExists(__DIR__ . '/testit/php/PEAR2/SimpleChannelServer.php', 'src/PEAR2/SimpleChannelServer.php');
$test->assertEquals(file_get_contents(__DIR__.'/../../../../sandbox/SimpleChannelServer/src/SimpleChannelServer.php'),
                    file_get_contents(__DIR__ . '/testit/php/PEAR2/SimpleChannelServer.php'), 'files match');
ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'list-packages'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . 'Listing installed packages [' . __DIR__ . DIRECTORY_SEPARATOR . 'testit' . ']:' . "\n"
                    . "[channel pear2.php.net]:\n"
                    . " PEAR2_SimpleChannelServer\n",
                    $contents,
                    'list packages');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
// first, install the package using PEAR
$temp_path = __DIR__ . '/testit';
mkdir($temp_path);
if (!is_dir($temp_path . DIRECTORY_SEPARATOR . 'php')) {
    mkdir($php_dir = $temp_path . DIRECTORY_SEPARATOR . 'php');
}
if (!is_dir($temp_path . DIRECTORY_SEPARATOR . 'data')) {
    mkdir($temp_path . DIRECTORY_SEPARATOR . 'data');
}
if (!is_dir($cfg_dir = $temp_path . DIRECTORY_SEPARATOR . 'cfg')) {
    mkdir($temp_path . DIRECTORY_SEPARATOR . 'cfg');
}
if (!is_dir($temp_path . DIRECTORY_SEPARATOR . 'doc')) {
    mkdir($temp_path . DIRECTORY_SEPARATOR . 'doc');
}
if (!is_dir($temp_path . DIRECTORY_SEPARATOR . 'test')) {
    mkdir($temp_path . DIRECTORY_SEPARATOR . 'test');
}
if (!is_dir($temp_path . DIRECTORY_SEPARATOR . 'ext')) {
    mkdir($temp_path . DIRECTORY_SEPARATOR . 'ext');
    $ext_dir = $temp_path . DIRECTORY_SEPARATOR . 'ext';
}
if (!is_dir($temp_path . DIRECTORY_SEPARATOR . 'script')) {
    mkdir($temp_path . DIRECTORY_SEPARATOR . 'script');
}
if (!is_dir($tmp_dir = $temp_path . DIRECTORY_SEPARATOR . 'tmp')) {
    mkdir($temp_path . DIRECTORY_SEPARATOR . 'tmp');
}
if (!is_dir($temp_path . DIRECTORY_SEPARATOR . 'bin')) {
    mkdir($temp_path . DIRECTORY_SEPARATOR . 'bin');
}
if (!is_dir($temp_path . DIRECTORY_SEPARATOR . 'cache')) {
    mkdir($temp_path . DIRECTORY_SEPARATOR . 'cache');
}
// make the fake configuration - we'll use one of these and it should work
$config = serialize(array(
    'preferred_state' => 'stable',
    'cache_dir' => $temp_path . DIRECTORY_SEPARATOR . 'cache',
    'php_dir' => $temp_path . DIRECTORY_SEPARATOR . 'php',
    'cfg_dir' => $temp_path . DIRECTORY_SEPARATOR . 'cfg',
    'ext_dir' => $temp_path . DIRECTORY_SEPARATOR . 'ext',
    'data_dir' => $temp_path . DIRECTORY_SEPARATOR . 'data',
    'www_dir' => $temp_path . DIRECTORY_SEPARATOR . 'www',
    'doc_dir' => $temp_path . DIRECTORY_SEPARATOR . 'doc',
    'test_dir' => $temp_path . DIRECTORY_SEPARATOR . 'test',
    'download_dir' => $temp_path . DIRECTORY_SEPARATOR . 'tmp',
    'temp_dir' => $temp_path . DIRECTORY_SEPARATOR . 'tmp',
    'bin_dir' => $temp_path . DIRECTORY_SEPARATOR . 'bin',));
touch($temp_path . DIRECTORY_SEPARATOR . 'pear.conf');
$fp = fopen($temp_path . DIRECTORY_SEPARATOR . 'pear.conf', 'w');
fwrite($fp, $config);
fclose($fp);
touch($temp_path . DIRECTORY_SEPARATOR . 'pear.ini');
$fp = fopen($temp_path . DIRECTORY_SEPARATOR . 'pear.ini', 'w');
fwrite($fp, $config);
fclose($fp);

putenv('PHP_PEAR_SYSCONF_DIR='.$temp_path);
$home = getenv('HOME');
if (!empty($home)) {
    // for PEAR_Config initialization
    putenv('HOME="'.$temp_path);
}
require_once "PEAR/Installer.php";
require_once 'PEAR/Frontend/CLI.php';
$config = &PEAR_Config::singleton($temp_path . '/pear.ini');

// now install the package
$pathtopackagexml = dirname(__FILE__) . DIRECTORY_SEPARATOR .
    'packages'. DIRECTORY_SEPARATOR . 'Net_URL-1.0.15.tar';
$ui = new PEAR_Frontend_CLI;
$dp = new PEAR_Downloader($ui, array('offline' => true), $config);
$result = $dp->download(array($pathtopackagexml));
$installer = new PEAR_Installer($ui);

$installer->setOptions($dp->getOptions());
$installer->sortPackagesForInstall($result);
$installer->setDownloadedPackages($result);
$ret = $installer->install($result[0], $dp->getOptions());
unset($ret['dirtree']);
$test->assertEquals(array (
  'attribs' =>
  array (
    'packagerversion' => '1.6.0',
    'version' => '2.0',
    'xmlns' => 'http://pear.php.net/dtd/package-2.0',
    'xmlns:tasks' => 'http://pear.php.net/dtd/tasks-1.0',
    'xmlns:xsi' => 'http://www.w3.org/2001/XMLSchema-instance',
    'xsi:schemaLocation' => 'http://pear.php.net/dtd/tasks-1.0 http://pear.php.net/dtd/tasks-1.0.xsd http://pear.php.net/dtd/package-2.0 http://pear.php.net/dtd/package-2.0.xsd',
  ),
  'name' => 'Net_URL',
  'channel' => 'pear.php.net',
  'summary' => 'Easy parsing of Urls',
  'description' => 'Provides easy parsing of URLs and their constituent parts.',
  'lead' =>
  array (
    0 =>
    array (
      'name' => 'Richard heyes',
      'user' => 'richard',
      'email' => 'richard@php.net',
      'active' => 'no',
    ),
    1 =>
    array (
      'name' => 'David Coallier',
      'user' => 'davidc',
      'email' => 'davidc@php.net',
      'active' => 'yes',
    ),
  ),
  'date' => $ret['date'],
  'time' => $ret['time'],
  'version' =>
  array (
    'release' => '1.0.15',
    'api' => '1.0.15',
  ),
  'stability' =>
  array (
    'release' => 'stable',
    'api' => 'stable',
  ),
  'license' =>
  array (
    'attribs' =>
    array (
      'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
    ),
    '_content' => 'BSD',
  ),
  'notes' => '- Fixed Bug #11385 $url was defined.
- Fixed Doc #11017 Fixed docblock problem (cweiske) 
- Fixed Bug #11008 (Override object properties in initialize())
- Fixed Bug #6338 Wrong query string handling
- Fixed Bug #704  Fixed hardcoded value and use ini_get(arg_separator)
- Fixed Bug #1036 Improper default port number detection
- Fixed Bug #1447 use $_SERVER instead of HTTP_SERVER_VARS
- Fixed Bug #1558 _parseRawQueryString failed if arg_sep.input was more than 1 char.
- Fixed Bug #1682 File was in DOC format rather than Unix
- Fixed Bug #2334 Sqare brackets in var names were encoded
- Fixed Bug #2824 Better error handling support.
- Fixed bug #3159 setProtocol was calling getStandardPort incorrectly',
  'contents' =>
  array (
    'dir' =>
    array (
      'attribs' =>
      array (
        'name' => '/',
      ),
      'file' =>
      array (
        0 =>
        array (
          'attribs' =>
          array (
            'baseinstalldir' => 'Net',
            'md5sum' => 'af793351a5f00e31a2df697b54cfbc02',
            'name' => 'docs/example.php',
            'role' => 'doc',
          ),
        ),
        1 =>
        array (
          'attribs' =>
          array (
            'baseinstalldir' => 'Net',
            'md5sum' => '0488b5531c31332113100971be7ba2d9',
            'name' => 'docs/6470.php',
            'role' => 'doc',
          ),
        ),
        2 =>
        array (
          'attribs' =>
          array (
            'baseinstalldir' => 'Net',
            'md5sum' => 'c7e690d656b56cc48a12399331a35b27',
            'name' => 'URL.php',
            'role' => 'php',
          ),
        ),
      ),
    ),
  ),
  'dependencies' =>
  array (
    'required' =>
    array (
      'php' =>
      array (
        'min' => '4.0.0',
      ),
      'pearinstaller' =>
      array (
        'min' => '1.4.0b1',
      ),
    ),
  ),
  'phprelease' => '',
  'changelog' =>
  array (
    'release' =>
    array (
      0 =>
      array (
        'version' =>
        array (
          'release' => '1.0.14',
          'api' => '1.0.14',
        ),
        'stability' =>
        array (
          'release' => 'stable',
          'api' => 'stable',
        ),
        'date' => '2004-06-19',
        'license' =>
        array (
          'attribs' =>
          array (
            'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
          ),
          '_content' => 'BSD',
        ),
        'notes' => 'Whitespace',
      ),
      1 =>
      array (
        'version' =>
        array (
          'release' => '1.0.13',
          'api' => '1.0.13',
        ),
        'stability' =>
        array (
          'release' => 'stable',
          'api' => 'stable',
        ),
        'date' => '2004-06-05',
        'license' =>
        array (
          'attribs' =>
          array (
            'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
          ),
          '_content' => 'BSD',
        ),
        'notes' => 'Fix bug 1558',
      ),
      2 =>
      array (
        'version' =>
        array (
          'release' => '1.0.12',
          'api' => '1.0.12',
        ),
        'stability' =>
        array (
          'release' => 'stable',
          'api' => 'stable',
        ),
        'date' => '2004-05-08',
        'license' =>
        array (
          'attribs' =>
          array (
            'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
          ),
          '_content' => 'BSD',
        ),
        'notes' => 'Bug fixes release (#704 and #1036)',
      ),
      3 =>
      array (
        'version' =>
        array (
          'release' => '1.0.11',
          'api' => '1.0.11',
        ),
        'stability' =>
        array (
          'release' => 'stable',
          'api' => 'stable',
        ),
        'date' => '2004-01-17',
        'license' =>
        array (
          'attribs' =>
          array (
            'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
          ),
          '_content' => 'BSD',
        ),
        'notes' => 'Bug fixes release (#83 and #471)',
      ),
      4 =>
      array (
        'version' =>
        array (
          'release' => '1.0.10',
          'api' => '1.0.10',
        ),
        'stability' =>
        array (
          'release' => 'stable',
          'api' => 'stable',
        ),
        'date' => '2002-04-06',
        'license' =>
        array (
          'attribs' =>
          array (
            'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
          ),
          '_content' => 'BSD',
        ),
        'notes' => 'Be more flexible in what constitutes a scheme',
      ),
      5 =>
      array (
        'version' =>
        array (
          'release' => '1.0.9',
          'api' => '1.0.9',
        ),
        'stability' =>
        array (
          'release' => 'stable',
          'api' => 'stable',
        ),
        'date' => '2002-04-05',
        'license' =>
        array (
          'attribs' =>
          array (
            'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
          ),
          '_content' => 'BSD',
        ),
        'notes' => 'Fix couple of absolute URL bugs.',
      ),
      6 =>
      array (
        'version' =>
        array (
          'release' => '1.0.8',
          'api' => '1.0.8',
        ),
        'stability' =>
        array (
          'release' => 'stable',
          'api' => 'stable',
        ),
        'date' => '2002-03-06',
        'license' =>
        array (
          'attribs' =>
          array (
            'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
          ),
          '_content' => 'BSD',
        ),
        'notes' => 'Various bugs. Remove auto setting of default url to \'/\' if a url is supplied
to the constructor. May cause BC issues.',
      ),
      7 =>
      array (
        'version' =>
        array (
          'release' => '1.0.7',
          'api' => '1.0.7',
        ),
        'stability' =>
        array (
          'release' => 'stable',
          'api' => 'stable',
        ),
        'date' => '2002-12-07',
        'license' =>
        array (
          'attribs' =>
          array (
            'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
          ),
          '_content' => 'BSD',
        ),
        'notes' => 'Added method to resolve URL paths of //, ../ and ./',
      ),
      8 =>
      array (
        'version' =>
        array (
          'release' => '1.0.6',
          'api' => '1.0.6',
        ),
        'stability' =>
        array (
          'release' => 'stable',
          'api' => 'stable',
        ),
        'date' => '2002-12-07',
        'license' =>
        array (
          'attribs' =>
          array (
            'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
          ),
          '_content' => 'BSD',
        ),
        'notes' => 'Make usage of [] optional',
      ),
      9 =>
      array (
        'version' =>
        array (
          'release' => '1.0.5',
          'api' => '1.0.5',
        ),
        'stability' =>
        array (
          'release' => 'stable',
          'api' => 'stable',
        ),
        'date' => '2002-11-14',
        'license' =>
        array (
          'attribs' =>
          array (
            'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
          ),
          '_content' => 'BSD',
        ),
        'notes' => 'Allow for URLS such as ...?foo',
      ),
      10 =>
      array (
        'version' =>
        array (
          'release' => '1.0.4',
          'api' => '1.0.4',
        ),
        'stability' =>
        array (
          'release' => 'stable',
          'api' => 'stable',
        ),
        'date' => '2002-07-27',
        'license' =>
        array (
          'attribs' =>
          array (
            'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
          ),
          '_content' => 'BSD',
        ),
        'notes' => 'License change',
      ),
      11 =>
      array (
        'version' =>
        array (
          'release' => '1.0.3',
          'api' => '1.0.3',
        ),
        'stability' =>
        array (
          'release' => 'stable',
          'api' => 'stable',
        ),
        'date' => '2002-06-20',
        'license' =>
        array (
          'attribs' =>
          array (
            'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
          ),
          '_content' => 'BSD',
        ),
        'notes' => 'Now uses HTTP_HOST if available.',
      ),
      12 =>
      array (
        'version' =>
        array (
          'release' => '1.0.2',
          'api' => '1.0.2',
        ),
        'stability' =>
        array (
          'release' => 'stable',
          'api' => 'stable',
        ),
        'date' => '2002-04-28',
        'license' =>
        array (
          'attribs' =>
          array (
            'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
          ),
          '_content' => 'BSD',
        ),
        'notes' => 'updated to fix a minor irritation when running on windows',
      ),
      13 =>
      array (
        'version' =>
        array (
          'release' => '1.0.1',
          'api' => '1.0.1',
        ),
        'stability' =>
        array (
          'release' => 'stable',
          'api' => 'stable',
        ),
        'date' => '2002-04-28',
        'license' =>
        array (
          'attribs' =>
          array (
            'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
          ),
          '_content' => 'BSD',
        ),
        'notes' => 'Maintenance release. Bugs fixed with path detection and defaults.',
      ),
      14 =>
      array (
        'version' =>
        array (
          'release' => '1.0',
          'api' => '1.0',
        ),
        'stability' =>
        array (
          'release' => 'stable',
          'api' => 'stable',
        ),
        'date' => '2002-02-17',
        'license' =>
        array (
          'attribs' =>
          array (
            'uri' => 'http://www.opensource.org/licenses/bsd-license.php',
          ),
          '_content' => 'BSD',
        ),
        'notes' => 'This is the initial release of the Net_URL package.',
      ),
    ),
  ),
  'filelist' =>
  array (
    'docs/example.php' =>
    array (
      'baseinstalldir' => 'Net',
      'md5sum' => 'af793351a5f00e31a2df697b54cfbc02',
      'name' => 'docs/example.php',
      'role' => 'doc',
      'installed_as' => __DIR__ . '/testit/doc/Net_URL/docs/example.php',
    ),
    'docs/6470.php' =>
    array (
      'baseinstalldir' => 'Net',
      'md5sum' => '0488b5531c31332113100971be7ba2d9',
      'name' => 'docs/6470.php',
      'role' => 'doc',
      'installed_as' => __DIR__ . '/testit/doc/Net_URL/docs/6470.php',
    ),
    'URL.php' =>
    array (
      'baseinstalldir' => 'Net',
      'md5sum' => 'c7e690d656b56cc48a12399331a35b27',
      'name' => 'URL.php',
      'role' => 'php',
      'installed_as' => __DIR__ . '/testit/php/Net/URL.php',
    ),
  ),
  '_lastversion' => NULL,
  'old' =>
  array (
    'version' => '1.0.15',
    'release_date' => '2007-06-28',
    'release_state' => 'stable',
    'release_license' => 'BSD',
    'release_notes' => '- Fixed Bug #11385 $url was defined.
- Fixed Doc #11017 Fixed docblock problem (cweiske) 
- Fixed Bug #11008 (Override object properties in initialize())
- Fixed Bug #6338 Wrong query string handling
- Fixed Bug #704  Fixed hardcoded value and use ini_get(arg_separator)
- Fixed Bug #1036 Improper default port number detection
- Fixed Bug #1447 use $_SERVER instead of HTTP_SERVER_VARS
- Fixed Bug #1558 _parseRawQueryString failed if arg_sep.input was more than 1 char.
- Fixed Bug #1682 File was in DOC format rather than Unix
- Fixed Bug #2334 Sqare brackets in var names were encoded
- Fixed Bug #2824 Better error handling support.
- Fixed bug #3159 setProtocol was calling getStandardPort incorrectly',
    'release_deps' =>
    array (
      0 =>
      array (
        'type' => 'php',
        'rel' => 'ge',
        'version' => '4.0.0',
        'optional' => 'no',
      ),
      1 =>
      array (
        'type' => 'pkg',
        'channel' => 'pear.php.net',
        'name' => 'PEAR',
        'rel' => 'ge',
        'version' => '1.4.0b1',
        'optional' => 'no',
      ),
    ),
    'maintainers' =>
    array (
      0 =>
      array (
        'name' => 'Richard heyes',
        'email' => 'richard@php.net',
        'active' => 'no',
        'handle' => 'richard',
        'role' => 'lead',
      ),
      1 =>
      array (
        'name' => 'David Coallier',
        'email' => 'davidc@php.net',
        'active' => 'yes',
        'handle' => 'davidc',
        'role' => 'lead',
      ),
    ),
  ),
  'xsdversion' => '2.0',
), $ret, 'PEAR setup failed');
--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::upgrade(), upgrade of dependency
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit', __DIR__ . '/testit/pearconfig.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();

require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../../Mocks/Internet/install.prepare.explicitstate',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
PEAR2_Pyrus_Package_Remote::$downloadClass = 'Internet';
PEAR2_Pyrus_Config::current()->preferred_state = 'beta';

PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package(__DIR__ .
                                '/../../Mocks/Internet/install.prepare.explicitstate/get/P2-1.0.0.tar'));
PEAR2_Pyrus_Installer::commit();

$test->assertEquals(true, isset(PEAR2_Pyrus_Config::current()->registry->package['pear2.php.net/P2']),
    'ensure setup install of P2 worked');

ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'upgrade', __DIR__ .
                                '/../../Mocks/Internet/install.prepare.explicitstate/get/P1-1.1.0RC1.tar'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . 'Installed pear2.php.net/P1-1.1.0RC1' . "\n"
                    . 'Installed pear2.php.net/P2-1.1.0RC3' . "\n",
                    $contents,
                    'list packages');

$test->assertFileExists(__DIR__ . '/testit/php/glooby2', 'glooby2');
$test->assertEquals('hi',
                    file_get_contents(__DIR__ . '/testit/php/glooby2'), 'files match');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::listPackages(), no packages installed
--FILE--
<?php
require __DIR__ . '/setup.minimal.php.inc';
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
mkdir(__DIR__ . '/testit');
set_include_path(__DIR__ . '/testit' . PATH_SEPARATOR . __DIR__ . '/listPackages.pear1');
PEAR2_Pyrus_Config::singleton(__DIR__ . '/testit', __DIR__ . '/noconfig.xml');
restore_include_path();
ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'list-packages'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . 'Listing installed packages [' . __DIR__ . DIRECTORY_SEPARATOR . 'testit' . ']:' . "\n"
                    . 'Listing installed packages [' . __DIR__ . DIRECTORY_SEPARATOR . 'listPackages.pear1' . ']:' . "\n"
                    . "[channel pear.php.net]:\n"
                    . " PEAR\n"
                    . " PHP_Archive\n"
                    . " Console_Getopt\n"
                    . " xdebug\n"
                    . " Structures_Graph\n"
                    . " Archive_Tar\n"
                    . " XML_Util\n"
                    . " Text_Diff\n",
                    $contents,
                    'list packages');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::install(), basic test
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
restore_include_path();

ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'install', __DIR__ . '/packages/Net_URL-1.0.15.tar'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . 'Installed pear.php.net/Net_URL-1.0.15' . "\n",
                    $contents,
                    'list packages');
                    
$test->assertFileExists(__DIR__ . '/testit/docs/Net_URL/Net/docs/example.php', 'Docs installed to old doc directory.');


?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::_findPEAR test 3: no userfile detected, decline creation
--FILE--
<?php
define('MYDIR', __DIR__);
require __DIR__ . '/setup.minimal.php.inc';
test_scriptfrontend::$stdin = array(
    'no', // answer to "It appears you have not used Pyrus before, welcome!  Initialize install?"
    '', // conclusion
);
$cli = new test_scriptfrontend();
$cli->run($args = array ());

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
Pyrus: No user configuration file detected
It appears you have not used Pyrus before, welcome!  Initialize install?
Please choose:
  yes
  no
[yes] : no
OK, thank you, finishing execution now--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::channelDiscover() failure
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit', __DIR__ . '/testit/pearconfig.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();

require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/testit',
                       'http://pear.unl.edu/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
PEAR2_Pyrus_ScriptFrontend_Commands::$downloadClass = 'Internet';
$test->assertEquals(false, isset(PEAR2_Pyrus_Config::current()->channelregistry['pear.unl.edu']),
                    'before discover of pear.unl.edu');
ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'channel-discover', 'pear.unl.edu'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . "Discovery of channel pear.unl.edu failed: Download of channel.xml failed\n",
                     $contents,
                    'list packages');

$test->assertEquals(false, isset(PEAR2_Pyrus_Config::current()->channelregistry['pear.unl.edu']),
                    'after discover of pear.unl.edu');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::set()
--FILE--
<?php
set_include_path(dirname(__FILE__).'/testit');
define('MYDIR', __DIR__);
require __DIR__ . '/setup.php.inc';

$a = PEAR2_Pyrus_Config::singleton(__DIR__ . '/testit', __DIR__ . '/testit/foo.xml');
$a->ext_dir = __DIR__ . '/testit/ext';
$a->bin_dir = __DIR__ . '/testit/bin';
file_put_contents(__DIR__ . '/testit/foo.xml', '<pearconfig version="1.0"></pearconfig>');

ob_start();
$cli = new test_scriptfrontend();
$cli->run($args = array (0 => 'set', 'ext_dir', 'poo'));

$contents = ob_get_contents();
ob_end_clean();
$help1 = 'Using PEAR installation found at ' . __DIR__ . DIRECTORY_SEPARATOR . 'testit' . "\n";
$d = DIRECTORY_SEPARATOR;
$help2 = "Setting ext_dir in system paths\n";
   

$test->assertEquals($help1 . $help2,
                    $contents,
                    'set output');
$test->assertEquals('poo', PEAR2_Pyrus_Config::current()->ext_dir, 'confirm value changed');
$a = simplexml_load_file(__DIR__ . '/testit/.config');
$test->assertEquals('poo', (string)$a->ext_dir, 'confirm value saved');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
define('MYDIR', __DIR__);
require __DIR__ . '/setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;

mkdir(__DIR__ . '/testit/php');
file_put_contents(__DIR__ . '/testit/php/foobar', '<?php
class foobar_postinstall extends fake {}');
$pf->name = 'testing2';
$pf->channel = 'pear2.php.net';
$pf->summary = 'testing';
$pf->description = 'hi description';
$pf->notes = 'my notes';
$pf->maintainer['cellog']->role('lead')->email('cellog@php.net')->active('yes')->name('Greg Beaver');
$pf->files['foobar'] = array(
    'attribs' => array('role' => 'php'),
    'tasks:replace' => array('attribs' =>
                             array('from' => '@blah@', 'to' => 'version', 'type' => 'package-info'))
);
$pf->files['glooby'] = array('role' => 'php');
$pf->setPackagefile(__DIR__ . '/testit/package.xml');

$package = new PEAR2_Pyrus_Package(false);
$xmlcontainer = new PEAR2_Pyrus_PackageFile($pf);
$xml = new PEAR2_Pyrus_Package_Xml(__DIR__ . '/testit/package.xml', $package, $xmlcontainer);
$package->setInternalPackage($xml);

class fake
{
    public static $captured = array();

    static function reset()
    {
        self::$captured = array();
    }

    function run(array $answers, $section)
    {
        self::$captured[] = array('answers' => $answers, 'section' => $section);
    }

    function init($pkg, $lastversion)
    {
        self::$captured[] = array('init' => array($pkg->channel . '/' . $pkg->name, $lastversion));
    }
}

$postinstall = $package->files['foobar']->postinstallscript->add();

$postinstall->paramgroup['first']->param['paramname']->type('string')->prompt('paramname');
$postinstall->paramgroup['first']->param['paramname2']->type('string')->prompt('paramname2')->default('foo');
$postinstall->paramgroup['first']->instructions = "testing\nthis thing";

$postinstall->paramgroup['second']->save();

$postinstall->paramgroup['third']->param['paramname']->type('string')->prompt('2 paramname');
$postinstall->paramgroup['third']->param['paramname2']->type('string')->prompt('2 paramname2');

$postinstall->paramgroup['fourth']->param['paramname']->type('string')->prompt('3 paramname');
$postinstall->paramgroup['fourth']->param['paramname2']->type('string')->prompt('3 paramname2');

PEAR2_Pyrus_Config::current()->registry->package[] = $package;
--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::listPackages(), existing PEAR1 registry, packages installed
--FILE--
<?php
require __DIR__ . '/setup.minimal.php.inc';
set_include_path(__DIR__ . DIRECTORY_SEPARATOR . 'listPackages.pear1');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/listPackages.pear1', __DIR__ . '/dontloadme.xml');
restore_include_path();

$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();

ob_start();
$cli->run($args = array (__DIR__.'/listPackages.pear1', 'list-packages'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'listPackages.pear1' . "\n"
                    . 'Listing installed packages [' . __DIR__ . DIRECTORY_SEPARATOR . 'listPackages.pear1]:' . "\n"
                    . "[channel pear.php.net]:\n"
                    . " PEAR\n"
                    . " PHP_Archive\n"
                    . " Console_Getopt\n"
                    . " xdebug\n"
                    . " Structures_Graph\n"
                    . " Archive_Tar\n"
                    . " XML_Util\n"
                    . " Text_Diff\n",
                    $contents,
                    'list packages');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::runScripts
--FILE--
<?php
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
require __DIR__ . '/setup.runscripts.php.inc';

test_scriptfrontend::$stdin = array(
    '1', // answer for first prompt
    'myfunnyfoo', // answer for value of paramname
    '', // Enter to continue
    '', // Enter to continue, but values needed
    'all', // enter all values, answer for 2nd prompt
    'val1', // value for 2 paramname
    'val2', // value for 2 paramname2
    '', // Enter to continue
    '2', // answer for 3rd prompt
    '3 val2', // value for 3 paramname2
    '', // Enter to continue
    '1', // answer for 3rd prompt #2
    'my thing', // value for 3 paramname
    '', // Enter to continue
    '', // Enter to continue
);
$cli = new test_scriptfrontend();

ob_start();
$cli->run($args = array ('run-scripts', 'testing2'));
$contents = ob_get_contents();
ob_end_clean();

$d = DIRECTORY_SEPARATOR;
$output = 'Using PEAR installation found at ' . __DIR__ . DIRECTORY_SEPARATOR . 'testit
Including external post-installation script "' . __DIR__ . DIRECTORY_SEPARATOR . 'testit'.$d.'php'.$d.
'foobar" - any errors are in this script
Inclusion succeeded
running post-install script "foobar_postinstall->init()"
init succeeded
testing
this thing
 1. paramname  : 
 2. paramname2 : foo

1-2, \'all\', \'abort\', or Enter to continue: 1
paramname [] : myfunnyfoo
 1. paramname  : myfunnyfoo
 2. paramname2 : foo

1-2, \'all\', \'abort\', or Enter to continue: 
 1. 2 paramname  : 
 2. 2 paramname2 : 

1-2, \'all\', \'abort\', or Enter to continue: 
* ENTER AN ANSWER FOR #1: (2 PARAMNAME)
* ENTER AN ANSWER FOR #2: (2 PARAMNAME2)
 1. 2 paramname  : 
 2. 2 paramname2 : 

1-2, \'all\', \'abort\', or Enter to continue: all
2 paramname [] : val1
2 paramname2 [] : val2
 1. 2 paramname  : val1
 2. 2 paramname2 : val2

1-2, \'all\', \'abort\', or Enter to continue: 
 1. 3 paramname  : 
 2. 3 paramname2 : 

1-2, \'all\', \'abort\', or Enter to continue: 2
3 paramname2 [] : 3 val2
 1. 3 paramname  : 
 2. 3 paramname2 : 3 val2

1-2, \'all\', \'abort\', or Enter to continue: 
* ENTER AN ANSWER FOR #1: (3 PARAMNAME)
 1. 3 paramname  : 
 2. 3 paramname2 : 3 val2

1-2, \'all\', \'abort\', or Enter to continue: 1
3 paramname [] : my thing
 1. 3 paramname  : my thing
 2. 3 paramname2 : 3 val2

1-2, \'all\', \'abort\', or Enter to continue: 
';
$test->assertEquals($output,
                    $contents,
                    'post-install output');

$test->assertEquals(array (
  0 => 
  array (
    'init' => 
    array (
      0 => 'pear2.php.net/testing2',
      1 => NULL,
    ),
  ),
  1 => 
  array (
    'answers' => 
    array (
      'paramname' => 'myfunnyfoo',
      'paramname2' => 'foo',
    ),
    'section' => 'first',
  ),
  2 => 
  array (
    'answers' => 
    array (
      'first::paramname' => 'myfunnyfoo',
      'first::paramname2' => 'foo',
    ),
    'section' => 'second',
  ),
  3 => 
  array (
    'answers' => 
    array (
      'paramname' => 'val1',
      'paramname2' => 'val2',
      'first::paramname' => 'myfunnyfoo',
      'first::paramname2' => 'foo',
    ),
    'section' => 'third',
  ),
  4 => 
  array (
    'answers' => 
    array (
      'paramname' => 'my thing',
      'paramname2' => '3 val2',
      'first::paramname' => 'myfunnyfoo',
      'first::paramname2' => 'foo',
      'third::paramname' => 'val1',
      'third::paramname2' => 'val2',
    ),
    'section' => 'fourth',
  ),
), fake::$captured, 'script info passed in');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::listChannels()
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (0 => 'mypear',
                         1 => __DIR__ . '/testit'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__ . DIRECTORY_SEPARATOR . 'testit' . "\n" .
                    'Setting my pear repositories to:' . "\n" . __DIR__ . DIRECTORY_SEPARATOR . 'testit',
                    $contents,
                    'set my pear path');
ob_start();

$cli->run($args = array (0 => 'list-channels'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . 'Listing channels [' . __DIR__ . DIRECTORY_SEPARATOR . 'testit' . ']:' . "\n"
                    . '__uri (__uri)' . "\n"
                    . 'pear.php.net (pear)' . "\n"
                    . 'pear2.php.net (pear2)' . "\n"
                    . 'pecl.php.net (pecl)' . "\n",
                    $contents,
                    'list channels');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::listPackages(), no packages installed
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
mkdir(__DIR__ . '/testit');
set_include_path(__DIR__ . '/testit');
PEAR2_Pyrus_Config::singleton(__DIR__ . '/testit', __DIR__ . '/noconfig.xml');
restore_include_path();
ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'list-packages'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . 'Listing installed packages [' . __DIR__ . DIRECTORY_SEPARATOR . 'testit' . ']:' . "\n",
                    $contents,
                    'list packages');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::channelDiscover()
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit', __DIR__ . '/testit/pearconfig.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();

require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/testit',
                       'http://pear.unl.edu/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
PEAR2_Pyrus_ScriptFrontend_Commands::$downloadClass = 'Internet';
file_put_contents(__DIR__ . '/testit/channel.xml', '<?xml version="1.0" encoding="UTF-8"?>
<channel version="1.0" xmlns="http://pear.php.net/channel-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://pear.php.net/dtd/channel-1.0 http://pear.php.net/dtd/channel-1.0.xsd">
 <name>pear.unl.edu</name>
 <suggestedalias>salty</suggestedalias>
 <summary>Simple PEAR Channel</summary>
 <servers>
  <primary>
   <rest>
    <baseurl type="REST1.0">http://foo/rest/</baseurl>
    <baseurl type="REST1.1">http://foo/rest/</baseurl>
    <baseurl type="REST1.3">http://foo/rest/</baseurl>
   </rest>
  </primary>
 </servers>
</channel>');
$test->assertEquals(false, isset(PEAR2_Pyrus_Config::current()->channelregistry['pear.unl.edu']),
                    'before discover of pear.unl.edu');
ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'channel-discover', 'pear.unl.edu'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . "Discovery of channel pear.unl.edu successful\n",
                     $contents,
                    'list packages');

$test->assertEquals(true, isset(PEAR2_Pyrus_Config::current()->channelregistry['pear.unl.edu']),
                    'after discover of pear.unl.edu');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include __DIR__ . '/../../test_framework.php.inc';
mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__ . '/testit', __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR . 'foo.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();

class test_Config extends PEAR2_Pyrus_Config
{
    static function getDefaultUserConfigFile()
    {
        return __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR . 'foo.xml';
    }
}

class test_scriptfrontend extends PEAR2_Pyrus_ScriptFrontend_Commands
{
    public static $configclass = 'test_Config';
    public static $stdin = array();
    public static $index = 0;
    function _readStdin($amount = 1024)
    {
        $ret = self::$stdin[self::$index];
        echo $ret,"\n";
        if (++self::$index >= count(self::$stdin)) {
            throw new Exception('ran out of input, add more to test');
        }
        return $ret;
    }
}a:6:{s:7:"attribs";a:4:{s:7:"version";s:3:"1.0";s:5:"xmlns";s:31:"http://pear.php.net/channel-1.0";s:9:"xmlns:xsi";s:41:"http://www.w3.org/2001/XMLSchema-instance";s:18:"xsi:schemaLocation";s:71:"http://pear.php.net/channel-1.0 http://pear.php.net/dtd/channel-1.0.xsd";}s:4:"name";s:12:"pear.foo.com";s:14:"suggestedalias";s:3:"foo";s:7:"summary";s:23:"Auto-discovered channel";s:7:"servers";a:1:{s:7:"primary";a:2:{s:7:"attribs";a:1:{s:4:"host";s:12:"pear.foo.com";}s:4:"rest";a:1:{s:7:"baseurl";a:4:{i:0;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.0";}s:8:"_content";s:25:"http://pear.foo.com/rest/";}i:1;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.1";}s:8:"_content";s:25:"http://pear.foo.com/rest/";}i:2;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.2";}s:8:"_content";s:25:"http://pear.foo.com/rest/";}i:3;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.3";}s:8:"_content";s:25:"http://pear.foo.com/rest/";}}}}}s:13:"_lastmodified";s:31:"Sat, 18 Apr 2009 10:04:32 -0500";}a:4:{s:4:"name";s:5:"__uri";s:7:"servers";a:1:{s:7:"primary";a:1:{s:6:"xmlrpc";a:1:{s:8:"function";a:2:{s:7:"attribs";a:1:{s:7:"version";s:3:"1.0";}s:8:"_content";s:4:"****";}}}}s:7:"summary";s:34:"Pseudo-channel for static packages";s:13:"_lastmodified";s:31:"Thu, 14 Aug 2008 13:34:24 -0400";}a:6:{s:7:"attribs";a:4:{s:7:"version";s:3:"1.0";s:5:"xmlns";s:31:"http://pear.php.net/channel-1.0";s:9:"xmlns:xsi";s:41:"http://www.w3.org/2001/XMLSchema-instance";s:18:"xsi:schemaLocation";s:71:"http://pear.php.net/channel-1.0 http://pear.php.net/dtd/channel-1.0.xsd";}s:4:"name";s:12:"pear.php.net";s:14:"suggestedalias";s:4:"pear";s:7:"summary";s:40:"PHP Extension and Application Repository";s:7:"servers";a:2:{s:7:"primary";a:1:{s:4:"rest";a:1:{s:7:"baseurl";a:4:{i:0;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.0";}s:8:"_content";s:25:"http://pear.php.net/rest/";}i:1;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.1";}s:8:"_content";s:25:"http://pear.php.net/rest/";}i:2;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.2";}s:8:"_content";s:25:"http://pear.php.net/rest/";}i:3;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.3";}s:8:"_content";s:25:"http://pear.php.net/rest/";}}}}s:6:"mirror";a:2:{i:0;a:2:{s:7:"attribs";a:1:{s:4:"host";s:15:"us.pear.php.net";}s:4:"rest";a:1:{s:7:"baseurl";a:4:{i:0;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.0";}s:8:"_content";s:28:"http://us.pear.php.net/rest/";}i:1;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.1";}s:8:"_content";s:28:"http://us.pear.php.net/rest/";}i:2;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.2";}s:8:"_content";s:28:"http://us.pear.php.net/rest/";}i:3;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.3";}s:8:"_content";s:28:"http://us.pear.php.net/rest/";}}}}i:1;a:2:{s:7:"attribs";a:3:{s:4:"host";s:15:"de.pear.php.net";s:3:"ssl";s:3:"yes";s:4:"port";s:4:"3452";}s:4:"rest";a:1:{s:7:"baseurl";a:4:{i:0;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.0";}s:8:"_content";s:34:"https://de.pear.php.net:3452/rest/";}i:1;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.1";}s:8:"_content";s:34:"https://de.pear.php.net:3452/rest/";}i:2;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.2";}s:8:"_content";s:34:"https://de.pear.php.net:3452/rest/";}i:3;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.3";}s:8:"_content";s:34:"https://de.pear.php.net:3452/rest/";}}}}}}s:13:"_lastmodified";a:2:{s:4:"ETag";s:20:""2fb30-59a-7ae3ee80"";s:13:"Last-Modified";s:29:"Wed, 08 Apr 2009 10:20:26 GMT";}}pear.foo.compecl.php.netpear.php.neta:6:{s:4:"name";s:12:"pecl.php.net";s:14:"suggestedalias";s:4:"pecl";s:7:"summary";s:31:"PHP Extension Community Library";s:7:"servers";a:1:{s:7:"primary";a:2:{s:6:"xmlrpc";a:1:{s:8:"function";a:10:{i:0;a:2:{s:7:"attribs";a:1:{s:7:"version";s:3:"1.0";}s:8:"_content";s:9:"logintest";}i:1;a:2:{s:7:"attribs";a:1:{s:7:"version";s:3:"1.0";}s:8:"_content";s:26:"package.listLatestReleases";}i:2;a:2:{s:7:"attribs";a:1:{s:7:"version";s:3:"1.0";}s:8:"_content";s:15:"package.listAll";}i:3;a:2:{s:7:"attribs";a:1:{s:7:"version";s:3:"1.0";}s:8:"_content";s:12:"package.info";}i:4;a:2:{s:7:"attribs";a:1:{s:7:"version";s:3:"1.0";}s:8:"_content";s:22:"package.getDownloadURL";}i:5;a:2:{s:7:"attribs";a:1:{s:7:"version";s:3:"1.1";}s:8:"_content";s:22:"package.getDownloadURL";}i:6;a:2:{s:7:"attribs";a:1:{s:7:"version";s:3:"1.0";}s:8:"_content";s:25:"package.getDepDownloadURL";}i:7;a:2:{s:7:"attribs";a:1:{s:7:"version";s:3:"1.1";}s:8:"_content";s:25:"package.getDepDownloadURL";}i:8;a:2:{s:7:"attribs";a:1:{s:7:"version";s:3:"1.0";}s:8:"_content";s:14:"package.search";}i:9;a:2:{s:7:"attribs";a:1:{s:7:"version";s:3:"1.0";}s:8:"_content";s:15:"channel.listAll";}}}s:4:"rest";a:1:{s:7:"baseurl";a:2:{i:0;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.0";}s:8:"_content";s:25:"http://pecl.php.net/rest/";}i:1;a:2:{s:7:"attribs";a:1:{s:4:"type";s:7:"REST1.1";}s:8:"_content";s:25:"http://pecl.php.net/rest/";}}}}}s:15:"validatepackage";a:2:{s:8:"_content";s:19:"PEAR_Validator_PECL";s:7:"attribs";a:1:{s:7:"version";s:3:"1.0";}}s:13:"_lastmodified";s:31:"Thu, 14 Aug 2008 13:34:24 -0400";}a:23:{s:7:"attribs";a:5:{s:7:"version";s:3:"2.0";s:5:"xmlns";s:35:"http://pear.php.net/dtd/package-2.0";s:11:"xmlns:tasks";s:33:"http://pear.php.net/dtd/tasks-1.0";s:9:"xmlns:xsi";s:41:"http://www.w3.org/2001/XMLSchema-instance";s:18:"xsi:schemaLocation";s:147:"http://pear.php.net/dtd/tasks-1.0 http://pear.php.net/dtd/tasks-1.0.xsd http://pear.php.net/dtd/package-2.0 http://pear.php.net/dtd/package-2.0.xsd";}s:4:"name";s:4:"PEAR";s:7:"channel";s:12:"pear.php.net";s:7:"summary";s:16:"PEAR Base System";s:11:"description";s:1100:"The PEAR package contains:
 * the PEAR installer, for creating, distributing
   and installing packages
 * the PEAR_Exception PHP5 error handling mechanism
 * the PEAR_ErrorStack advanced error handling mechanism
 * the PEAR_Error error handling mechanism
 * the OS_Guess class for retrieving info about the OS
   where PHP is running on
 * the System class for quick handling of common operations
   with files and directories
 * the PEAR base class
  Features in a nutshell:
  * full support for channels
  * pre-download dependency validation
  * new package.xml 2.0 format allows tremendous flexibility while maintaining BC
  * support for optional dependency groups and limited support for sub-packaging
  * robust dependency support
  * full dependency validation on uninstall
  * remote install for hosts with only ftp access - no more problems with
    restricted host installation
  * full support for mirroring
  * support for bundling several packages into a single tarball
  * support for static dependencies on a url-based package
  * support for custom file roles and installation tasks";s:4:"lead";a:5:{i:0;a:4:{s:4:"name";s:11:"Greg Beaver";s:4:"user";s:6:"cellog";s:5:"email";s:14:"cellog@php.net";s:6:"active";s:2:"no";}i:1;a:4:{s:4:"name";s:17:"Pierre-Alain Joye";s:4:"user";s:6:"pajoye";s:5:"email";s:14:"pierre@php.net";s:6:"active";s:2:"no";}i:2;a:4:{s:4:"name";s:11:"Stig Bakken";s:4:"user";s:3:"ssb";s:5:"email";s:12:"stig@php.net";s:6:"active";s:2:"no";}i:3;a:4:{s:4:"name";s:13:"Tomas V.V.Cox";s:4:"user";s:3:"cox";s:5:"email";s:15:"cox@idecnet.com";s:6:"active";s:2:"no";}i:4;a:4:{s:4:"name";s:13:"Helgi Thormar";s:4:"user";s:5:"dufuz";s:5:"email";s:13:"dufuz@php.net";s:6:"active";s:3:"yes";}}s:9:"developer";a:4:{s:4:"name";s:9:"Tias Guns";s:4:"user";s:4:"tias";s:5:"email";s:12:"tias@php.net";s:6:"active";s:3:"yes";}s:6:"helper";a:3:{i:0;a:4:{s:4:"name";s:11:"Tim Jackson";s:4:"user";s:4:"timj";s:5:"email";s:12:"timj@php.net";s:6:"active";s:2:"no";}i:1;a:4:{s:4:"name";s:15:"Bertrand Gugger";s:4:"user";s:5:"toggg";s:5:"email";s:13:"toggg@php.net";s:6:"active";s:2:"no";}i:2;a:4:{s:4:"name";s:13:"Martin Jansen";s:4:"user";s:2:"mj";s:5:"email";s:10:"mj@php.net";s:6:"active";s:2:"no";}}s:4:"date";s:10:"2009-04-15";s:7:"version";a:2:{s:7:"release";s:5:"1.8.2";s:3:"api";s:5:"1.8.2";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:62:"http://opensource.org/licenses/bsd-license.php New BSD License";}s:8:"_content";s:15:"New BSD License";}s:5:"notes";s:254:"* Fix Bug #16108: PEAR_PackageFile_Generator_v2 PHP4 parse error when running upgrade-all [dufuz]
* Fix Bug #16113: Installing certain packages fails due incorrect encoding handling [dufuz]
* Fix Bug #16122: PEAR RunTest failed to run as expected [dufuz]";s:8:"contents";a:1:{s:3:"dir";a:2:{s:7:"attribs";a:1:{s:4:"name";s:1:"/";}s:4:"file";a:105:{i:0;a:2:{s:7:"attribs";a:2:{s:4:"name";s:12:"OS/Guess.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:1;a:2:{s:7:"attribs";a:2:{s:4:"name";s:27:"PEAR/ChannelFile/Parser.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:2;a:1:{s:7:"attribs";a:2:{s:4:"name";s:21:"PEAR/Command/Auth.xml";s:4:"role";s:3:"php";}}i:3;a:2:{s:7:"attribs";a:2:{s:4:"name";s:21:"PEAR/Command/Auth.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:4;a:1:{s:7:"attribs";a:2:{s:4:"name";s:22:"PEAR/Command/Build.xml";s:4:"role";s:3:"php";}}i:5;a:2:{s:7:"attribs";a:2:{s:4:"name";s:22:"PEAR/Command/Build.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:6;a:1:{s:7:"attribs";a:2:{s:4:"name";s:25:"PEAR/Command/Channels.xml";s:4:"role";s:3:"php";}}i:7;a:2:{s:7:"attribs";a:2:{s:4:"name";s:25:"PEAR/Command/Channels.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:8;a:2:{s:7:"attribs";a:2:{s:4:"name";s:23:"PEAR/Command/Common.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:9;a:1:{s:7:"attribs";a:2:{s:4:"name";s:23:"PEAR/Command/Config.xml";s:4:"role";s:3:"php";}}i:10;a:2:{s:7:"attribs";a:2:{s:4:"name";s:23:"PEAR/Command/Config.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:11;a:1:{s:7:"attribs";a:2:{s:4:"name";s:24:"PEAR/Command/Install.xml";s:4:"role";s:3:"php";}}i:12;a:2:{s:7:"attribs";a:2:{s:4:"name";s:24:"PEAR/Command/Install.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:13;a:1:{s:7:"attribs";a:2:{s:4:"name";s:23:"PEAR/Command/Mirror.xml";s:4:"role";s:3:"php";}}i:14;a:2:{s:7:"attribs";a:2:{s:4:"name";s:23:"PEAR/Command/Mirror.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:15;a:1:{s:7:"attribs";a:2:{s:4:"name";s:24:"PEAR/Command/Package.xml";s:4:"role";s:3:"php";}}i:16;a:2:{s:7:"attribs";a:2:{s:4:"name";s:24:"PEAR/Command/Package.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:2:{i:0;a:1:{s:7:"attribs";a:3:{s:4:"from";s:10:"@DATA-DIR@";s:2:"to";s:8:"data_dir";s:4:"type";s:11:"pear-config";}}i:1;a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}}i:17;a:1:{s:7:"attribs";a:2:{s:4:"name";s:23:"PEAR/Command/Pickle.xml";s:4:"role";s:3:"php";}}i:18;a:2:{s:7:"attribs";a:2:{s:4:"name";s:23:"PEAR/Command/Pickle.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:19;a:1:{s:7:"attribs";a:2:{s:4:"name";s:25:"PEAR/Command/Registry.xml";s:4:"role";s:3:"php";}}i:20;a:2:{s:7:"attribs";a:2:{s:4:"name";s:25:"PEAR/Command/Registry.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:21;a:1:{s:7:"attribs";a:2:{s:4:"name";s:23:"PEAR/Command/Remote.xml";s:4:"role";s:3:"php";}}i:22;a:2:{s:7:"attribs";a:2:{s:4:"name";s:23:"PEAR/Command/Remote.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:23;a:1:{s:7:"attribs";a:2:{s:4:"name";s:21:"PEAR/Command/Test.xml";s:4:"role";s:3:"php";}}i:24;a:2:{s:7:"attribs";a:2:{s:4:"name";s:21:"PEAR/Command/Test.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:25;a:2:{s:7:"attribs";a:2:{s:4:"name";s:27:"PEAR/Downloader/Package.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:10:"@PEAR-VER@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:26;a:2:{s:7:"attribs";a:2:{s:4:"name";s:21:"PEAR/Frontend/CLI.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:27;a:2:{s:7:"attribs";a:2:{s:4:"name";s:30:"PEAR/Installer/Role/Common.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:28;a:1:{s:7:"attribs";a:2:{s:4:"name";s:27:"PEAR/Installer/Role/Cfg.xml";s:4:"role";s:3:"php";}}i:29;a:2:{s:7:"attribs";a:2:{s:4:"name";s:27:"PEAR/Installer/Role/Cfg.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:30;a:1:{s:7:"attribs";a:2:{s:4:"name";s:28:"PEAR/Installer/Role/Data.xml";s:4:"role";s:3:"php";}}i:31;a:2:{s:7:"attribs";a:2:{s:4:"name";s:28:"PEAR/Installer/Role/Data.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:32;a:1:{s:7:"attribs";a:2:{s:4:"name";s:27:"PEAR/Installer/Role/Doc.xml";s:4:"role";s:3:"php";}}i:33;a:2:{s:7:"attribs";a:2:{s:4:"name";s:27:"PEAR/Installer/Role/Doc.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:34;a:1:{s:7:"attribs";a:2:{s:4:"name";s:27:"PEAR/Installer/Role/Ext.xml";s:4:"role";s:3:"php";}}i:35;a:2:{s:7:"attribs";a:2:{s:4:"name";s:27:"PEAR/Installer/Role/Ext.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:36;a:1:{s:7:"attribs";a:2:{s:4:"name";s:27:"PEAR/Installer/Role/Php.xml";s:4:"role";s:3:"php";}}i:37;a:2:{s:7:"attribs";a:2:{s:4:"name";s:27:"PEAR/Installer/Role/Php.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:38;a:1:{s:7:"attribs";a:2:{s:4:"name";s:30:"PEAR/Installer/Role/Script.xml";s:4:"role";s:3:"php";}}i:39;a:2:{s:7:"attribs";a:2:{s:4:"name";s:30:"PEAR/Installer/Role/Script.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:40;a:1:{s:7:"attribs";a:2:{s:4:"name";s:27:"PEAR/Installer/Role/Src.xml";s:4:"role";s:3:"php";}}i:41;a:2:{s:7:"attribs";a:2:{s:4:"name";s:27:"PEAR/Installer/Role/Src.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:42;a:1:{s:7:"attribs";a:2:{s:4:"name";s:28:"PEAR/Installer/Role/Test.xml";s:4:"role";s:3:"php";}}i:43;a:2:{s:7:"attribs";a:2:{s:4:"name";s:28:"PEAR/Installer/Role/Test.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:44;a:1:{s:7:"attribs";a:2:{s:4:"name";s:27:"PEAR/Installer/Role/Www.xml";s:4:"role";s:3:"php";}}i:45;a:2:{s:7:"attribs";a:2:{s:4:"name";s:27:"PEAR/Installer/Role/Www.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:46;a:2:{s:7:"attribs";a:2:{s:4:"name";s:23:"PEAR/Installer/Role.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:47;a:2:{s:7:"attribs";a:2:{s:4:"name";s:33:"PEAR/PackageFile/Generator/v1.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:10:"@PEAR-VER@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:48;a:2:{s:7:"attribs";a:2:{s:4:"name";s:33:"PEAR/PackageFile/Generator/v2.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:10:"@PEAR-VER@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:49;a:2:{s:7:"attribs";a:2:{s:4:"name";s:30:"PEAR/PackageFile/Parser/v1.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:50;a:2:{s:7:"attribs";a:2:{s:4:"name";s:30:"PEAR/PackageFile/Parser/v2.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:51;a:2:{s:7:"attribs";a:2:{s:4:"role";s:3:"php";s:4:"name";s:26:"PEAR/PackageFile/v2/rw.php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:52;a:2:{s:7:"attribs";a:2:{s:4:"role";s:3:"php";s:4:"name";s:33:"PEAR/PackageFile/v2/Validator.php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:53;a:2:{s:7:"attribs";a:2:{s:4:"name";s:23:"PEAR/PackageFile/v1.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:54;a:2:{s:7:"attribs";a:2:{s:4:"name";s:23:"PEAR/PackageFile/v2.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:55;a:2:{s:7:"attribs";a:2:{s:4:"name";s:16:"PEAR/REST/10.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:56;a:2:{s:7:"attribs";a:2:{s:4:"name";s:16:"PEAR/REST/11.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:57;a:2:{s:7:"attribs";a:2:{s:4:"name";s:16:"PEAR/REST/13.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:58;a:2:{s:7:"attribs";a:2:{s:4:"name";s:34:"PEAR/Task/Postinstallscript/rw.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:59;a:2:{s:7:"attribs";a:2:{s:4:"name";s:24:"PEAR/Task/Replace/rw.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:60;a:2:{s:7:"attribs";a:2:{s:4:"name";s:24:"PEAR/Task/Unixeol/rw.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:61;a:2:{s:7:"attribs";a:2:{s:4:"name";s:27:"PEAR/Task/Windowseol/rw.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:62;a:2:{s:7:"attribs";a:2:{s:4:"name";s:20:"PEAR/Task/Common.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:63;a:2:{s:7:"attribs";a:2:{s:4:"name";s:31:"PEAR/Task/Postinstallscript.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:64;a:2:{s:7:"attribs";a:2:{s:4:"name";s:21:"PEAR/Task/Replace.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:65;a:2:{s:7:"attribs";a:2:{s:4:"name";s:21:"PEAR/Task/Unixeol.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:66;a:2:{s:7:"attribs";a:2:{s:4:"name";s:24:"PEAR/Task/Windowseol.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:67;a:2:{s:7:"attribs";a:2:{s:4:"name";s:23:"PEAR/Validator/PECL.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:68;a:2:{s:7:"attribs";a:2:{s:4:"name";s:19:"PEAR/Autoloader.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:69;a:2:{s:7:"attribs";a:2:{s:4:"name";s:16:"PEAR/Builder.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:10:"@PEAR-VER@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:70;a:2:{s:7:"attribs";a:2:{s:4:"name";s:20:"PEAR/ChannelFile.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:71;a:2:{s:7:"attribs";a:2:{s:4:"name";s:16:"PEAR/Command.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:72;a:2:{s:7:"attribs";a:2:{s:4:"name";s:15:"PEAR/Common.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:73;a:2:{s:7:"attribs";a:2:{s:4:"name";s:15:"PEAR/Config.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:74;a:2:{s:7:"attribs";a:2:{s:4:"name";s:21:"PEAR/DependencyDB.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:75;a:2:{s:7:"attribs";a:2:{s:4:"name";s:20:"PEAR/Dependency2.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:10:"@PEAR-VER@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:76;a:2:{s:7:"attribs";a:2:{s:4:"name";s:19:"PEAR/Downloader.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:77;a:2:{s:7:"attribs";a:2:{s:4:"name";s:19:"PEAR/ErrorStack.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:78;a:2:{s:7:"attribs";a:2:{s:4:"name";s:18:"PEAR/Exception.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:79;a:1:{s:7:"attribs";a:2:{s:4:"name";s:28:"PEAR/FixPHP5PEARWarnings.php";s:4:"role";s:3:"php";}}i:80;a:2:{s:7:"attribs";a:2:{s:4:"name";s:17:"PEAR/Frontend.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:81;a:2:{s:7:"attribs";a:2:{s:4:"name";s:18:"PEAR/Installer.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:82;a:2:{s:7:"attribs";a:2:{s:4:"name";s:20:"PEAR/PackageFile.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:10:"@PEAR-VER@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:83;a:2:{s:7:"attribs";a:2:{s:4:"name";s:17:"PEAR/Packager.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:84;a:2:{s:7:"attribs";a:2:{s:4:"name";s:17:"PEAR/Registry.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:85;a:2:{s:7:"attribs";a:2:{s:4:"name";s:13:"PEAR/REST.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:86;a:2:{s:7:"attribs";a:2:{s:4:"name";s:16:"PEAR/RunTest.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:87;a:2:{s:7:"attribs";a:2:{s:4:"name";s:17:"PEAR/Validate.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:88;a:2:{s:7:"attribs";a:2:{s:4:"name";s:18:"PEAR/XMLParser.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:89;a:3:{s:7:"attribs";a:3:{s:4:"name";s:16:"scripts/pear.bat";s:4:"role";s:6:"script";s:14:"baseinstalldir";s:1:"/";}s:13:"tasks:replace";a:3:{i:0;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@bin_dir@";s:2:"to";s:7:"bin_dir";s:4:"type";s:11:"pear-config";}}i:1;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@php_bin@";s:2:"to";s:7:"php_bin";s:4:"type";s:11:"pear-config";}}i:2;a:1:{s:7:"attribs";a:3:{s:4:"from";s:14:"@include_path@";s:2:"to";s:7:"php_dir";s:4:"type";s:11:"pear-config";}}}s:16:"tasks:windowseol";s:0:"";}i:90;a:3:{s:7:"attribs";a:3:{s:4:"name";s:19:"scripts/peardev.bat";s:4:"role";s:6:"script";s:14:"baseinstalldir";s:1:"/";}s:13:"tasks:replace";a:3:{i:0;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@bin_dir@";s:2:"to";s:7:"bin_dir";s:4:"type";s:11:"pear-config";}}i:1;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@php_bin@";s:2:"to";s:7:"php_bin";s:4:"type";s:11:"pear-config";}}i:2;a:1:{s:7:"attribs";a:3:{s:4:"from";s:14:"@include_path@";s:2:"to";s:7:"php_dir";s:4:"type";s:11:"pear-config";}}}s:16:"tasks:windowseol";s:0:"";}i:91;a:3:{s:7:"attribs";a:3:{s:4:"name";s:16:"scripts/pecl.bat";s:4:"role";s:6:"script";s:14:"baseinstalldir";s:1:"/";}s:13:"tasks:replace";a:3:{i:0;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@bin_dir@";s:2:"to";s:7:"bin_dir";s:4:"type";s:11:"pear-config";}}i:1;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@php_bin@";s:2:"to";s:7:"php_bin";s:4:"type";s:11:"pear-config";}}i:2;a:1:{s:7:"attribs";a:3:{s:4:"from";s:14:"@include_path@";s:2:"to";s:7:"php_dir";s:4:"type";s:11:"pear-config";}}}s:16:"tasks:windowseol";s:0:"";}i:92;a:3:{s:7:"attribs";a:3:{s:4:"name";s:15:"scripts/pear.sh";s:4:"role";s:6:"script";s:14:"baseinstalldir";s:1:"/";}s:13:"tasks:replace";a:4:{i:0;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@php_bin@";s:2:"to";s:7:"php_bin";s:4:"type";s:11:"pear-config";}}i:1;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@php_dir@";s:2:"to";s:7:"php_dir";s:4:"type";s:11:"pear-config";}}i:2;a:1:{s:7:"attribs";a:3:{s:4:"from";s:14:"@pear_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}i:3;a:1:{s:7:"attribs";a:3:{s:4:"from";s:14:"@include_path@";s:2:"to";s:7:"php_dir";s:4:"type";s:11:"pear-config";}}}s:13:"tasks:unixeol";s:0:"";}i:93;a:3:{s:7:"attribs";a:3:{s:4:"name";s:18:"scripts/peardev.sh";s:4:"role";s:6:"script";s:14:"baseinstalldir";s:1:"/";}s:13:"tasks:replace";a:4:{i:0;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@php_bin@";s:2:"to";s:7:"php_bin";s:4:"type";s:11:"pear-config";}}i:1;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@php_dir@";s:2:"to";s:7:"php_dir";s:4:"type";s:11:"pear-config";}}i:2;a:1:{s:7:"attribs";a:3:{s:4:"from";s:14:"@pear_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}i:3;a:1:{s:7:"attribs";a:3:{s:4:"from";s:14:"@include_path@";s:2:"to";s:7:"php_dir";s:4:"type";s:11:"pear-config";}}}s:13:"tasks:unixeol";s:0:"";}i:94;a:3:{s:7:"attribs";a:3:{s:4:"name";s:15:"scripts/pecl.sh";s:4:"role";s:6:"script";s:14:"baseinstalldir";s:1:"/";}s:13:"tasks:replace";a:4:{i:0;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@php_bin@";s:2:"to";s:7:"php_bin";s:4:"type";s:11:"pear-config";}}i:1;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@php_dir@";s:2:"to";s:7:"php_dir";s:4:"type";s:11:"pear-config";}}i:2;a:1:{s:7:"attribs";a:3:{s:4:"from";s:14:"@pear_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}i:3;a:1:{s:7:"attribs";a:3:{s:4:"from";s:14:"@include_path@";s:2:"to";s:7:"php_dir";s:4:"type";s:11:"pear-config";}}}s:13:"tasks:unixeol";s:0:"";}i:95;a:2:{s:7:"attribs";a:3:{s:4:"name";s:19:"scripts/pearcmd.php";s:4:"role";s:3:"php";s:14:"baseinstalldir";s:1:"/";}s:13:"tasks:replace";a:4:{i:0;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@php_bin@";s:2:"to";s:7:"php_bin";s:4:"type";s:11:"pear-config";}}i:1;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@php_dir@";s:2:"to";s:7:"php_dir";s:4:"type";s:11:"pear-config";}}i:2;a:1:{s:7:"attribs";a:3:{s:4:"from";s:14:"@pear_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}i:3;a:1:{s:7:"attribs";a:3:{s:4:"from";s:14:"@include_path@";s:2:"to";s:7:"php_dir";s:4:"type";s:11:"pear-config";}}}}i:96;a:2:{s:7:"attribs";a:3:{s:4:"name";s:19:"scripts/peclcmd.php";s:4:"role";s:3:"php";s:14:"baseinstalldir";s:1:"/";}s:13:"tasks:replace";a:4:{i:0;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@php_bin@";s:2:"to";s:7:"php_bin";s:4:"type";s:11:"pear-config";}}i:1;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@php_dir@";s:2:"to";s:7:"php_dir";s:4:"type";s:11:"pear-config";}}i:2;a:1:{s:7:"attribs";a:3:{s:4:"from";s:14:"@pear_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}i:3;a:1:{s:7:"attribs";a:3:{s:4:"from";s:14:"@include_path@";s:2:"to";s:7:"php_dir";s:4:"type";s:11:"pear-config";}}}}i:97;a:1:{s:7:"attribs";a:2:{s:4:"name";s:7:"LICENSE";s:4:"role";s:3:"doc";}}i:98;a:1:{s:7:"attribs";a:2:{s:4:"name";s:7:"INSTALL";s:4:"role";s:3:"doc";}}i:99;a:1:{s:7:"attribs";a:2:{s:4:"name";s:11:"package.dtd";s:4:"role";s:4:"data";}}i:100;a:1:{s:7:"attribs";a:2:{s:4:"name";s:9:"PEAR5.php";s:4:"role";s:3:"php";}}i:101;a:2:{s:7:"attribs";a:2:{s:4:"name";s:8:"PEAR.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:102;a:1:{s:7:"attribs";a:2:{s:4:"name";s:6:"README";s:4:"role";s:3:"doc";}}i:103;a:2:{s:7:"attribs";a:2:{s:4:"name";s:10:"System.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:17:"@package_version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}i:104;a:1:{s:7:"attribs";a:2:{s:4:"name";s:13:"template.spec";s:4:"role";s:4:"data";}}}}}s:12:"dependencies";a:2:{s:8:"required";a:4:{s:3:"php";a:2:{s:3:"min";s:5:"4.4.0";s:7:"exclude";a:7:{i:0;s:3:"5.0";i:1;s:5:"5.1.0";i:2;s:5:"5.1.1";i:3;s:5:"5.1.2";i:4;s:5:"5.1.3";i:5;s:5:"5.1.4";i:6;s:5:"5.1.5";}}s:13:"pearinstaller";a:1:{s:3:"min";s:5:"1.4.3";}s:7:"package";a:6:{i:0;a:5:{s:4:"name";s:11:"Archive_Tar";s:7:"channel";s:12:"pear.php.net";s:3:"min";s:3:"1.1";s:11:"recommended";s:5:"1.3.3";s:7:"exclude";s:5:"1.3.0";}i:1;a:4:{s:4:"name";s:16:"Structures_Graph";s:7:"channel";s:12:"pear.php.net";s:3:"min";s:5:"1.0.2";s:11:"recommended";s:5:"1.0.2";}i:2;a:4:{s:4:"name";s:14:"Console_Getopt";s:7:"channel";s:12:"pear.php.net";s:3:"min";s:3:"1.2";s:11:"recommended";s:5:"1.2.3";}i:3;a:4:{s:4:"name";s:8:"XML_Util";s:7:"channel";s:12:"pear.php.net";s:3:"min";s:5:"1.2.0";s:11:"recommended";s:5:"1.2.1";}i:4;a:4:{s:4:"name";s:17:"PEAR_Frontend_Web";s:7:"channel";s:12:"pear.php.net";s:3:"max";s:3:"0.4";s:9:"conflicts";s:0:"";}i:5;a:5:{s:4:"name";s:17:"PEAR_Frontend_Gtk";s:7:"channel";s:12:"pear.php.net";s:3:"max";s:5:"0.4.0";s:7:"exclude";s:5:"0.4.0";s:9:"conflicts";s:0:"";}}s:9:"extension";a:2:{i:0;a:1:{s:4:"name";s:3:"xml";}i:1;a:1:{s:4:"name";s:4:"pcre";}}}s:5:"group";a:3:{i:0;a:2:{s:7:"attribs";a:2:{s:4:"name";s:12:"webinstaller";s:4:"hint";s:26:"PEAR's web-based installer";}s:7:"package";a:3:{s:4:"name";s:17:"PEAR_Frontend_Web";s:7:"channel";s:12:"pear.php.net";s:3:"min";s:5:"0.5.1";}}i:1;a:2:{s:7:"attribs";a:2:{s:4:"name";s:12:"gtkinstaller";s:4:"hint";s:30:"PEAR's PHP-GTK-based installer";}s:7:"package";a:3:{s:4:"name";s:17:"PEAR_Frontend_Gtk";s:7:"channel";s:12:"pear.php.net";s:3:"min";s:5:"0.4.0";}}i:2;a:2:{s:7:"attribs";a:2:{s:4:"name";s:13:"gtk2installer";s:4:"hint";s:31:"PEAR's PHP-GTK2-based installer";}s:7:"package";a:2:{s:4:"name";s:18:"PEAR_Frontend_Gtk2";s:7:"channel";s:12:"pear.php.net";}}}}s:10:"phprelease";a:2:{i:0;a:2:{s:17:"installconditions";a:1:{s:2:"os";a:1:{s:4:"name";s:7:"windows";}}s:8:"filelist";a:2:{s:7:"install";a:5:{i:0;a:1:{s:7:"attribs";a:2:{s:2:"as";s:8:"pear.bat";s:4:"name";s:16:"scripts/pear.bat";}}i:1;a:1:{s:7:"attribs";a:2:{s:2:"as";s:11:"peardev.bat";s:4:"name";s:19:"scripts/peardev.bat";}}i:2;a:1:{s:7:"attribs";a:2:{s:2:"as";s:8:"pecl.bat";s:4:"name";s:16:"scripts/pecl.bat";}}i:3;a:1:{s:7:"attribs";a:2:{s:2:"as";s:11:"pearcmd.php";s:4:"name";s:19:"scripts/pearcmd.php";}}i:4;a:1:{s:7:"attribs";a:2:{s:2:"as";s:11:"peclcmd.php";s:4:"name";s:19:"scripts/peclcmd.php";}}}s:6:"ignore";a:3:{i:0;a:1:{s:7:"attribs";a:1:{s:4:"name";s:18:"scripts/peardev.sh";}}i:1;a:1:{s:7:"attribs";a:1:{s:4:"name";s:15:"scripts/pear.sh";}}i:2;a:1:{s:7:"attribs";a:1:{s:4:"name";s:15:"scripts/pecl.sh";}}}}}i:1;a:1:{s:8:"filelist";a:2:{s:7:"install";a:5:{i:0;a:1:{s:7:"attribs";a:2:{s:2:"as";s:4:"pear";s:4:"name";s:15:"scripts/pear.sh";}}i:1;a:1:{s:7:"attribs";a:2:{s:2:"as";s:7:"peardev";s:4:"name";s:18:"scripts/peardev.sh";}}i:2;a:1:{s:7:"attribs";a:2:{s:2:"as";s:4:"pecl";s:4:"name";s:15:"scripts/pecl.sh";}}i:3;a:1:{s:7:"attribs";a:2:{s:2:"as";s:11:"pearcmd.php";s:4:"name";s:19:"scripts/pearcmd.php";}}i:4;a:1:{s:7:"attribs";a:2:{s:2:"as";s:11:"peclcmd.php";s:4:"name";s:19:"scripts/peclcmd.php";}}}s:6:"ignore";a:3:{i:0;a:1:{s:7:"attribs";a:1:{s:4:"name";s:16:"scripts/pear.bat";}}i:1;a:1:{s:7:"attribs";a:1:{s:4:"name";s:19:"scripts/peardev.bat";}}i:2;a:1:{s:7:"attribs";a:1:{s:4:"name";s:16:"scripts/pecl.bat";}}}}}}s:9:"changelog";a:1:{s:7:"release";a:4:{i:0;a:5:{s:7:"version";a:2:{s:7:"release";s:11:"1.8.0alpha1";s:3:"api";s:5:"1.8.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2009-03-09";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:62:"http://opensource.org/licenses/bsd-license.php New BSD License";}s:8:"_content";s:15:"New BSD License";}s:5:"notes";s:4876:"* Implement Request #10373: if pref_state=stable and installed package=beta, allow up to latest beta version [dufuz]
* Implement Request #10581: login / logout should map to channel-login / channel-logout [dufuz]
* Implement Request #10825: Only display the "invalid or missing package file"-error if it makes sense [dufuz]
* Implement Request #11170: script to generate Command/[command].xml [dufuz]
* Implement Request #11176: improve channel ... has updated its protocols message [dufuz]
* Implement Request #12706: pear list -a hard to read [dufuz]
* Implement Request #11353: upgrade-all and upgrade commands to upgrade within the same stability level [dufuz]
* Implement Request #13015: Add https discovery for channel.xml [dufuz / initial patch by Martin Roos]
* Implement Request #13927: install-pear.php should have option to set www_dir [timj]
* Implement Request #14324: Make the pear install command behave similar to apt-get [dufuz]
* Implement Request #14325: make pear upgrade with no params behave like pear upgrade-all [dufuz]
  - upgrade-all can be considered deprecated in favor of calling upgrade with no parameters to replicate
    better what other package managers are doing. upgrade-all will still work as intended.
* Implement Request #14504: add a channel parameter support to the upgrade function [dufuz]
  - Options -c ezc and --channel=ezc got added to upgrade and upgrade-all to allow for
    channel specific upgrades
* Implement Request #14556: install-pear-nozlib.phar should get download_dir config and other options [cweiske]
* Implement Request #15566: Add doc.php.net as a default channel [dufuz / saltybeagle]

* Fix PHP Bug #43857: --program-suffix not always reflected everywhere [cellog]
* Fix PHP Bug #47323: strotime warnings in make install [dufuz]

* Fix Bug #13908: pear info command and maintainers inactive not mentioned [dufuz]
* Fix Bug #13926: install-pear.php does not set cfg_dir if -d option set with no -c option [timj]
* Fix Bug #13943: tests fail when php.exe path contains spaces [dufuz / jorrit]
* Fix Bug #13953: config-set/config-show with channel alias fail [cellog]
* Fix Bug #13958: When a phpt tests exit() or die() xdebug coverage is not generated, patch by izi (David Jean Louis) [izi / dufuz]
* Fix Bug #14041: Unpredictable unit test processing sequence [dufuz]
* Fix Bug #14140: Strict warning not suppressed in the shutdown function [dufuz]
* Fix Bug #14210: pear list -ia brings warnings [dufuz]
* Fix Bug #14274: PEAR packager mangles package.xml encoding, then complains about it [dufuz]
* Fix Bug #14287: cannot upgrade from stable to beta via -beta when config is set to stable [dufuz]
* Fix Bug #14300: Package files themselves can not be served over https [dufuz / initial patch by Martin Roos]
* Fix Bug #14437: openbasedir warning when loading config [dufuz]
* Fix Bug #14558: PackageFile.php creates tmp directory outside configured temp_dir [cweiske]
* Fix Bug #14947: downloadHttp() is missing Host part of the HTTP Request when using Proxy [ifeghali]
* Fix Bug #14977: PEAR/Frontend.php doesn't require_once PEAR.php [dufuz]
* Fix Bug #15750: Unreachable code in PEAR_Downloader [dufuz]
* Fix Bug #15979: Package files incorrectly removed when splitting a package into multiple pkgs [dufuz]
* Fix Bug #15914: pear upgrade installs different version if desired version not found [dufuz]

NOTE!
Functions that have been deprecated for 3+ years in PEAR_Common, please take a moment
to migrate over to one of the alternatives that have ben provided:
* PEAR_Common->downloadHttp (use PEAR_Downloader->downloadHttp instead)
* PEAR_Common->infoFromTgzFile (use PEAR_PackageFile->fromTgzFile instead)
* PEAR_Common->infoFromDescriptionFile (use PEAR_PackageFile->fromPackageFile instead)
* PEAR_Common->infoFromString (use PEAR_PackageFile->fromXmlstring instead)
* PEAR_Common->infoFromArray (use PEAR_PackageFile->fromAnyFile instead)
* PEAR_Common->xmlFromInfo (use a PEAR_PackageFile_v* object's generator instead)
* PEAR_Common->validatePackageInfo (use the validation of PEAR_PackageFile objects)
* PEAR_Common->analyzeSourceCode (use a PEAR_PackageFile_v* object instead)
* PEAR_Common->detectDependencies (use PEAR_Downloader_Package->detectDependencies instead)
* PEAR_Common->buildProvidesArray (use PEAR_PackageFile_v1->_buildProvidesArray or
  PEAR_PackageFile_v2_Validator->_buildProvidesArray)

PHP 4.4 and 5.1.6 are now the minimum PHP requirements, for brave souls
pear upgrade -f PEAR will allow people with lower versions
to upgrade to this release but no guarantees will be made that it will work properly.

Support for XML RPC channels has been dropped - The only ones that used it
(pear.php.net and pecl.php.net) have used the REST interface for years now.
SOAP support also removed as it was only proof of concept.

Move codebase from the PHP License to New BSD 2 clause license";}i:1;a:5:{s:4:"date";s:10:"2009-03-27";s:7:"version";a:2:{s:7:"release";s:8:"1.8.0RC1";s:3:"api";s:5:"1.8.0";}s:9:"stability";a:2:{s:7:"release";s:4:"beta";s:3:"api";s:6:"stable";}s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:62:"http://opensource.org/licenses/bsd-license.php New BSD License";}s:8:"_content";s:15:"New BSD License";}s:5:"notes";s:347:"* Fix Bug #14331: pear cvstag only works from inside the package directory [dufuz]
* Fix Bug #16045: E_Notice: Undefined index: channel in PEAR/DependencyDB.php [dufuz]

* Implemented Request #11230: better error message when mirror not in channel.xml file [dufuz]
* Implemented Request #13150: Add support for following HTTP 302 redirects [dufuz]";}i:2;a:5:{s:4:"date";s:10:"2009-04-10";s:7:"version";a:2:{s:7:"release";s:5:"1.8.0";s:3:"api";s:5:"1.8.0";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:62:"http://opensource.org/licenses/bsd-license.php New BSD License";}s:8:"_content";s:15:"New BSD License";}s:5:"notes";s:5737:"Changes since RC1:
  * Fix Bug #14792: Bad md5sum for files with replaced content [dufuz]
  * Fix Bug #16057:-r is limited to 4 directories in depth [dufuz]
  * Fix Bug #16077: PEAR5::getStaticProperty does not return a reference to the property [dufuz]

  Remove custom XML_Util class in favor of using upstream XML_Util package as dependency

RC1 Release Notes:
  * Fix Bug #14331: pear cvstag only works from inside the package directory [dufuz]
  * Fix Bug #16045: E_Notice: Undefined index: channel in PEAR/DependencyDB.php [dufuz]

  * Implemented Request #11230: better error message when mirror not in channel.xml file [dufuz]
  * Implemented Request #13150: Add support for following HTTP 302 redirects [dufuz]

Alpha1 Release Notes:
  * Implement Request #10373: if pref_state=stable and installed package=beta, allow up to latest beta version [dufuz]
  * Implement Request #10581: login / logout should map to channel-login / channel-logout [dufuz]
  * Implement Request #10825: Only display the "invalid or missing package file"-error if it makes sense [dufuz]
  * Implement Request #11170: script to generate Command/[command].xml [dufuz]
  * Implement Request #11176: improve channel ... has updated its protocols message [dufuz]
  * Implement Request #12706: pear list -a hard to read [dufuz]
  * Implement Request #11353: upgrade-all and upgrade commands to upgrade within the same stability level [dufuz]
  * Implement Request #13015: Add https discovery for channel.xml [dufuz / initial patch by Martin Roos]
  * Implement Request #13927: install-pear.php should have option to set www_dir [timj]
  * Implement Request #14324: Make the pear install command behave similar to apt-get [dufuz]
  * Implement Request #14325: make pear upgrade with no params behave like pear upgrade-all [dufuz]
    - upgrade-all can be considered deprecated in favor of calling upgrade with no parameters to replicate
      better what other package managers are doing. upgrade-all will still work as intended.
  * Implement Request #14504: add a channel parameter support to the upgrade function [dufuz]
    - Options -c ezc and --channel=ezc got added to upgrade and upgrade-all to allow for
      channel specific upgrades
  * Implement Request #14556: install-pear-nozlib.phar should get download_dir config and other options [cweiske]
  * Implement Request #15566: Add doc.php.net as a default channel [dufuz / saltybeagle]

  * Fix PHP Bug #43857: --program-suffix not always reflected everywhere [cellog]
  * Fix PHP Bug #47323: strotime warnings in make install [dufuz]

  * Fix Bug #13908: pear info command and maintainers inactive not mentioned [dufuz]
  * Fix Bug #13926: install-pear.php does not set cfg_dir if -d option set with no -c option [timj]
  * Fix Bug #13943: tests fail when php.exe path contains spaces [dufuz / jorrit]
  * Fix Bug #13953: config-set/config-show with channel alias fail [cellog]
  * Fix Bug #13958: When a phpt tests exit() or die() xdebug coverage is not generated, patch by izi (David Jean Louis) [izi / dufuz]
  * Fix Bug #14041: Unpredictable unit test processing sequence [dufuz]
  * Fix Bug #14140: Strict warning not suppressed in the shutdown function [dufuz]
  * Fix Bug #14210: pear list -ia brings warnings [dufuz]
  * Fix Bug #14274: PEAR packager mangles package.xml encoding, then complains about it [dufuz]
  * Fix Bug #14287: cannot upgrade from stable to beta via -beta when config is set to stable [dufuz]
  * Fix Bug #14300: Package files themselves can not be served over https [dufuz / initial patch by Martin Roos]
  * Fix Bug #14437: openbasedir warning when loading config [dufuz]
  * Fix Bug #14558: PackageFile.php creates tmp directory outside configured temp_dir [cweiske]
  * Fix Bug #14947: downloadHttp() is missing Host part of the HTTP Request when using Proxy [ifeghali]
  * Fix Bug #14977: PEAR/Frontend.php doesn't require_once PEAR.php [dufuz]
  * Fix Bug #15750: Unreachable code in PEAR_Downloader [dufuz]
  * Fix Bug #15979: Package files incorrectly removed when splitting a package into multiple pkgs [dufuz]
  * Fix Bug #15914: pear upgrade installs different version if desired version not found [dufuz]

  NOTE!
  Functions that have been deprecated for 3+ years in PEAR_Common, please take a moment
  to migrate over to one of the alternatives that have ben provided:
  * PEAR_Common->downloadHttp (use PEAR_Downloader->downloadHttp instead)
  * PEAR_Common->infoFromTgzFile (use PEAR_PackageFile->fromTgzFile instead)
  * PEAR_Common->infoFromDescriptionFile (use PEAR_PackageFile->fromPackageFile instead)
  * PEAR_Common->infoFromString (use PEAR_PackageFile->fromXmlstring instead)
  * PEAR_Common->infoFromArray (use PEAR_PackageFile->fromAnyFile instead)
  * PEAR_Common->xmlFromInfo (use a PEAR_PackageFile_v* object's generator instead)
  * PEAR_Common->validatePackageInfo (use the validation of PEAR_PackageFile objects)
  * PEAR_Common->analyzeSourceCode (use a PEAR_PackageFile_v* object instead)
  * PEAR_Common->detectDependencies (use PEAR_Downloader_Package->detectDependencies instead)
  * PEAR_Common->buildProvidesArray (use PEAR_PackageFile_v1->_buildProvidesArray or
    PEAR_PackageFile_v2_Validator->_buildProvidesArray)

  PHP 4.4 and 5.1.6 are now the minimum PHP requirements, for brave souls
  pear upgrade -f PEAR will allow people with lower versions
  to upgrade to this release but no guarantees will be made that it will work properly.

  Support for XML RPC channels has been dropped - The only ones that used it
  (pear.php.net and pecl.php.net) have used the REST interface for years now.
  SOAP support also removed as it was only proof of concept.

  Move codebase from the PHP License to New BSD 2 clause license";}i:3;a:5:{s:4:"date";s:10:"2009-04-15";s:7:"version";a:2:{s:7:"release";s:5:"1.8.1";s:3:"api";s:5:"1.8.1";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:62:"http://opensource.org/licenses/bsd-license.php New BSD License";}s:8:"_content";s:15:"New BSD License";}s:5:"notes";s:58:"* Fix Bug #16099 	PEAR crash on PHP4 (parse error) [dufuz]";}}}s:8:"filelist";a:102:{s:12:"OS/Guess.php";a:4:{s:4:"name";s:12:"OS/Guess.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"1e7e0bee2fd38cc4d31f4ef08c0efccc";s:12:"installed_as";s:31:"/usr/local/lib/php/OS/Guess.php";}s:27:"PEAR/ChannelFile/Parser.php";a:4:{s:4:"name";s:27:"PEAR/ChannelFile/Parser.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"50f95af6f9d55f1c64fc481a62dff0f0";s:12:"installed_as";s:46:"/usr/local/lib/php/PEAR/ChannelFile/Parser.php";}s:21:"PEAR/Command/Auth.xml";a:4:{s:4:"name";s:21:"PEAR/Command/Auth.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"8fd87e64002e11fd86eb2f3fbfee6599";s:12:"installed_as";s:40:"/usr/local/lib/php/PEAR/Command/Auth.xml";}s:21:"PEAR/Command/Auth.php";a:4:{s:4:"name";s:21:"PEAR/Command/Auth.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"2f7ee90dbd47083491ca7860f644f494";s:12:"installed_as";s:40:"/usr/local/lib/php/PEAR/Command/Auth.php";}s:22:"PEAR/Command/Build.xml";a:4:{s:4:"name";s:22:"PEAR/Command/Build.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"483dd90056453bc93314472a66388057";s:12:"installed_as";s:41:"/usr/local/lib/php/PEAR/Command/Build.xml";}s:22:"PEAR/Command/Build.php";a:4:{s:4:"name";s:22:"PEAR/Command/Build.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"22322b2d5b359220d3e2d486ab036d50";s:12:"installed_as";s:41:"/usr/local/lib/php/PEAR/Command/Build.php";}s:25:"PEAR/Command/Channels.xml";a:4:{s:4:"name";s:25:"PEAR/Command/Channels.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"dec008667dd7c3cb3740b5aa7d3ac619";s:12:"installed_as";s:44:"/usr/local/lib/php/PEAR/Command/Channels.xml";}s:25:"PEAR/Command/Channels.php";a:4:{s:4:"name";s:25:"PEAR/Command/Channels.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"a0de79a29f1ea83fee500fe511d443d7";s:12:"installed_as";s:44:"/usr/local/lib/php/PEAR/Command/Channels.php";}s:23:"PEAR/Command/Common.php";a:4:{s:4:"name";s:23:"PEAR/Command/Common.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"e3ba0dcbe59a9ae6af0d14add5050a8f";s:12:"installed_as";s:42:"/usr/local/lib/php/PEAR/Command/Common.php";}s:23:"PEAR/Command/Config.xml";a:4:{s:4:"name";s:23:"PEAR/Command/Config.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"91f189cb9423b5e87ee0abc5ea1a2be3";s:12:"installed_as";s:42:"/usr/local/lib/php/PEAR/Command/Config.xml";}s:23:"PEAR/Command/Config.php";a:4:{s:4:"name";s:23:"PEAR/Command/Config.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"af0aae6b3867525d505f28bda3c0990b";s:12:"installed_as";s:42:"/usr/local/lib/php/PEAR/Command/Config.php";}s:24:"PEAR/Command/Install.xml";a:4:{s:4:"name";s:24:"PEAR/Command/Install.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"54c542190627909c2ccabdc844dbd5e9";s:12:"installed_as";s:43:"/usr/local/lib/php/PEAR/Command/Install.xml";}s:24:"PEAR/Command/Install.php";a:4:{s:4:"name";s:24:"PEAR/Command/Install.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"07529e8ecad56192cf3a766ab628305d";s:12:"installed_as";s:43:"/usr/local/lib/php/PEAR/Command/Install.php";}s:23:"PEAR/Command/Mirror.xml";a:4:{s:4:"name";s:23:"PEAR/Command/Mirror.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"5cb62a04c0a268f4edd64a49a3895c92";s:12:"installed_as";s:42:"/usr/local/lib/php/PEAR/Command/Mirror.xml";}s:23:"PEAR/Command/Mirror.php";a:4:{s:4:"name";s:23:"PEAR/Command/Mirror.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"f4ae959e87b74f62e80da6085bfd3e9e";s:12:"installed_as";s:42:"/usr/local/lib/php/PEAR/Command/Mirror.php";}s:24:"PEAR/Command/Package.xml";a:4:{s:4:"name";s:24:"PEAR/Command/Package.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"fedae0702f3bdc32c37a9912dc8fe171";s:12:"installed_as";s:43:"/usr/local/lib/php/PEAR/Command/Package.xml";}s:24:"PEAR/Command/Package.php";a:4:{s:4:"name";s:24:"PEAR/Command/Package.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"97747993d1854734c88e6b2ba7ca6a2a";s:12:"installed_as";s:43:"/usr/local/lib/php/PEAR/Command/Package.php";}s:23:"PEAR/Command/Pickle.xml";a:4:{s:4:"name";s:23:"PEAR/Command/Pickle.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"28dc842ea725d8787b9f9c3dbca5aa22";s:12:"installed_as";s:42:"/usr/local/lib/php/PEAR/Command/Pickle.xml";}s:23:"PEAR/Command/Pickle.php";a:4:{s:4:"name";s:23:"PEAR/Command/Pickle.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"4e5d93bfa01a793ca19e5d8c6ab30670";s:12:"installed_as";s:42:"/usr/local/lib/php/PEAR/Command/Pickle.php";}s:25:"PEAR/Command/Registry.xml";a:4:{s:4:"name";s:25:"PEAR/Command/Registry.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"49b046cfc14747f0365e02e9c3f0e6dc";s:12:"installed_as";s:44:"/usr/local/lib/php/PEAR/Command/Registry.xml";}s:25:"PEAR/Command/Registry.php";a:4:{s:4:"name";s:25:"PEAR/Command/Registry.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"d2b1fceb60950a2f3d43218317640413";s:12:"installed_as";s:44:"/usr/local/lib/php/PEAR/Command/Registry.php";}s:23:"PEAR/Command/Remote.xml";a:4:{s:4:"name";s:23:"PEAR/Command/Remote.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"29c02e823879b4e3e291f6b36fb339f1";s:12:"installed_as";s:42:"/usr/local/lib/php/PEAR/Command/Remote.xml";}s:23:"PEAR/Command/Remote.php";a:4:{s:4:"name";s:23:"PEAR/Command/Remote.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"0bd555df719629088d2fd3adb0aca199";s:12:"installed_as";s:42:"/usr/local/lib/php/PEAR/Command/Remote.php";}s:21:"PEAR/Command/Test.xml";a:4:{s:4:"name";s:21:"PEAR/Command/Test.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"ff80fba20e3637a1d53a68b9fa017197";s:12:"installed_as";s:40:"/usr/local/lib/php/PEAR/Command/Test.xml";}s:21:"PEAR/Command/Test.php";a:4:{s:4:"name";s:21:"PEAR/Command/Test.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"2bde6c18e7e2e33ddce133587b71fb4f";s:12:"installed_as";s:40:"/usr/local/lib/php/PEAR/Command/Test.php";}s:27:"PEAR/Downloader/Package.php";a:4:{s:4:"name";s:27:"PEAR/Downloader/Package.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"999a8ddca4c42d5d826d4d13c0c72705";s:12:"installed_as";s:46:"/usr/local/lib/php/PEAR/Downloader/Package.php";}s:21:"PEAR/Frontend/CLI.php";a:4:{s:4:"name";s:21:"PEAR/Frontend/CLI.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"446ba4f92a8aa8e955bf9401b19725a3";s:12:"installed_as";s:40:"/usr/local/lib/php/PEAR/Frontend/CLI.php";}s:30:"PEAR/Installer/Role/Common.php";a:4:{s:4:"name";s:30:"PEAR/Installer/Role/Common.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"51f1f327600f2f232f2bc98b62094ef3";s:12:"installed_as";s:49:"/usr/local/lib/php/PEAR/Installer/Role/Common.php";}s:27:"PEAR/Installer/Role/Cfg.xml";a:4:{s:4:"name";s:27:"PEAR/Installer/Role/Cfg.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"d8c62e6275e3aaa7784290912406092c";s:12:"installed_as";s:46:"/usr/local/lib/php/PEAR/Installer/Role/Cfg.xml";}s:27:"PEAR/Installer/Role/Cfg.php";a:4:{s:4:"name";s:27:"PEAR/Installer/Role/Cfg.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"7f755be5bdbf0136b84b3bb2a2801c1e";s:12:"installed_as";s:46:"/usr/local/lib/php/PEAR/Installer/Role/Cfg.php";}s:28:"PEAR/Installer/Role/Data.xml";a:4:{s:4:"name";s:28:"PEAR/Installer/Role/Data.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"89a4a2a286e842d45a98974f40a0565c";s:12:"installed_as";s:47:"/usr/local/lib/php/PEAR/Installer/Role/Data.xml";}s:28:"PEAR/Installer/Role/Data.php";a:4:{s:4:"name";s:28:"PEAR/Installer/Role/Data.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"5518700686a102cc508b3687b733eef9";s:12:"installed_as";s:47:"/usr/local/lib/php/PEAR/Installer/Role/Data.php";}s:27:"PEAR/Installer/Role/Doc.xml";a:4:{s:4:"name";s:27:"PEAR/Installer/Role/Doc.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"b1ce0fe105251c3b75209d6518ee69ac";s:12:"installed_as";s:46:"/usr/local/lib/php/PEAR/Installer/Role/Doc.xml";}s:27:"PEAR/Installer/Role/Doc.php";a:4:{s:4:"name";s:27:"PEAR/Installer/Role/Doc.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"4a6e9dca98363215124f094408becfd2";s:12:"installed_as";s:46:"/usr/local/lib/php/PEAR/Installer/Role/Doc.php";}s:27:"PEAR/Installer/Role/Ext.xml";a:4:{s:4:"name";s:27:"PEAR/Installer/Role/Ext.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"af71c0ad42d16a323afe24a4f884ef15";s:12:"installed_as";s:46:"/usr/local/lib/php/PEAR/Installer/Role/Ext.xml";}s:27:"PEAR/Installer/Role/Ext.php";a:4:{s:4:"name";s:27:"PEAR/Installer/Role/Ext.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"7f23dc9c6b88569d64c5980712135fbe";s:12:"installed_as";s:46:"/usr/local/lib/php/PEAR/Installer/Role/Ext.php";}s:27:"PEAR/Installer/Role/Php.xml";a:4:{s:4:"name";s:27:"PEAR/Installer/Role/Php.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"ef88f0321d3e481c2130c95122cf76d8";s:12:"installed_as";s:46:"/usr/local/lib/php/PEAR/Installer/Role/Php.xml";}s:27:"PEAR/Installer/Role/Php.php";a:4:{s:4:"name";s:27:"PEAR/Installer/Role/Php.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"0a039947c14de85c0bb7bf882768514f";s:12:"installed_as";s:46:"/usr/local/lib/php/PEAR/Installer/Role/Php.php";}s:30:"PEAR/Installer/Role/Script.xml";a:4:{s:4:"name";s:30:"PEAR/Installer/Role/Script.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"746461dc3b48af6d24094cb0211608f2";s:12:"installed_as";s:49:"/usr/local/lib/php/PEAR/Installer/Role/Script.xml";}s:30:"PEAR/Installer/Role/Script.php";a:4:{s:4:"name";s:30:"PEAR/Installer/Role/Script.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"521a54c647627ed97ef13402c3ac2903";s:12:"installed_as";s:49:"/usr/local/lib/php/PEAR/Installer/Role/Script.php";}s:27:"PEAR/Installer/Role/Src.xml";a:4:{s:4:"name";s:27:"PEAR/Installer/Role/Src.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"e147d63f168ea156fc2be38caaa63804";s:12:"installed_as";s:46:"/usr/local/lib/php/PEAR/Installer/Role/Src.xml";}s:27:"PEAR/Installer/Role/Src.php";a:4:{s:4:"name";s:27:"PEAR/Installer/Role/Src.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"7f0662d19dba3de9e88d435cba9a9613";s:12:"installed_as";s:46:"/usr/local/lib/php/PEAR/Installer/Role/Src.php";}s:28:"PEAR/Installer/Role/Test.xml";a:4:{s:4:"name";s:28:"PEAR/Installer/Role/Test.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"a24b596ec987aa5688fc19e8ed4e97ea";s:12:"installed_as";s:47:"/usr/local/lib/php/PEAR/Installer/Role/Test.xml";}s:28:"PEAR/Installer/Role/Test.php";a:4:{s:4:"name";s:28:"PEAR/Installer/Role/Test.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"0a9099254280302fc035186d09698e79";s:12:"installed_as";s:47:"/usr/local/lib/php/PEAR/Installer/Role/Test.php";}s:27:"PEAR/Installer/Role/Www.xml";a:4:{s:4:"name";s:27:"PEAR/Installer/Role/Www.xml";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"7641e71c5785bb33a4261ebe25ed0fd7";s:12:"installed_as";s:46:"/usr/local/lib/php/PEAR/Installer/Role/Www.xml";}s:27:"PEAR/Installer/Role/Www.php";a:4:{s:4:"name";s:27:"PEAR/Installer/Role/Www.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"2db232560a10501ad8696fc71fc46971";s:12:"installed_as";s:46:"/usr/local/lib/php/PEAR/Installer/Role/Www.php";}s:23:"PEAR/Installer/Role.php";a:4:{s:4:"name";s:23:"PEAR/Installer/Role.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"1f6ca4e560fab5448a57743cb80fb7c3";s:12:"installed_as";s:42:"/usr/local/lib/php/PEAR/Installer/Role.php";}s:33:"PEAR/PackageFile/Generator/v1.php";a:4:{s:4:"name";s:33:"PEAR/PackageFile/Generator/v1.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"60430c834e1dc0920c758f969b61e3d1";s:12:"installed_as";s:52:"/usr/local/lib/php/PEAR/PackageFile/Generator/v1.php";}s:33:"PEAR/PackageFile/Generator/v2.php";a:4:{s:4:"name";s:33:"PEAR/PackageFile/Generator/v2.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"e48ef574bee2e5416345383931858bc7";s:12:"installed_as";s:52:"/usr/local/lib/php/PEAR/PackageFile/Generator/v2.php";}s:30:"PEAR/PackageFile/Parser/v1.php";a:4:{s:4:"name";s:30:"PEAR/PackageFile/Parser/v1.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"50058789604936483b9e82c5990f5751";s:12:"installed_as";s:49:"/usr/local/lib/php/PEAR/PackageFile/Parser/v1.php";}s:30:"PEAR/PackageFile/Parser/v2.php";a:4:{s:4:"name";s:30:"PEAR/PackageFile/Parser/v2.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"eb78e5f34b4e0ae993fe2f43830ca367";s:12:"installed_as";s:49:"/usr/local/lib/php/PEAR/PackageFile/Parser/v2.php";}s:26:"PEAR/PackageFile/v2/rw.php";a:4:{s:4:"role";s:3:"php";s:4:"name";s:26:"PEAR/PackageFile/v2/rw.php";s:6:"md5sum";s:32:"b05228fd98485c45ca54bf6d686d463f";s:12:"installed_as";s:45:"/usr/local/lib/php/PEAR/PackageFile/v2/rw.php";}s:33:"PEAR/PackageFile/v2/Validator.php";a:4:{s:4:"role";s:3:"php";s:4:"name";s:33:"PEAR/PackageFile/v2/Validator.php";s:6:"md5sum";s:32:"6c3d4dd94fcd3b1ce7294a6dfb70a7bf";s:12:"installed_as";s:52:"/usr/local/lib/php/PEAR/PackageFile/v2/Validator.php";}s:23:"PEAR/PackageFile/v1.php";a:4:{s:4:"name";s:23:"PEAR/PackageFile/v1.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"70f2dc178983583fde2b46f39cf407aa";s:12:"installed_as";s:42:"/usr/local/lib/php/PEAR/PackageFile/v1.php";}s:23:"PEAR/PackageFile/v2.php";a:4:{s:4:"name";s:23:"PEAR/PackageFile/v2.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"0cf75ec1191182793c5e8ee6743b03f9";s:12:"installed_as";s:42:"/usr/local/lib/php/PEAR/PackageFile/v2.php";}s:16:"PEAR/REST/10.php";a:4:{s:4:"name";s:16:"PEAR/REST/10.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"7f6259b5a70caf1200beba1d96b2e399";s:12:"installed_as";s:35:"/usr/local/lib/php/PEAR/REST/10.php";}s:16:"PEAR/REST/11.php";a:4:{s:4:"name";s:16:"PEAR/REST/11.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"09858e6a8b5c48084397c4a70f0454e1";s:12:"installed_as";s:35:"/usr/local/lib/php/PEAR/REST/11.php";}s:16:"PEAR/REST/13.php";a:4:{s:4:"name";s:16:"PEAR/REST/13.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"3a1040c66e23d5bc352d6fbd3c8a6efe";s:12:"installed_as";s:35:"/usr/local/lib/php/PEAR/REST/13.php";}s:34:"PEAR/Task/Postinstallscript/rw.php";a:4:{s:4:"name";s:34:"PEAR/Task/Postinstallscript/rw.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"6da6e16f262c6e56e0431cd8caf463fb";s:12:"installed_as";s:53:"/usr/local/lib/php/PEAR/Task/Postinstallscript/rw.php";}s:24:"PEAR/Task/Replace/rw.php";a:4:{s:4:"name";s:24:"PEAR/Task/Replace/rw.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"31596f73873759faa5b42c8d6e2c1af9";s:12:"installed_as";s:43:"/usr/local/lib/php/PEAR/Task/Replace/rw.php";}s:24:"PEAR/Task/Unixeol/rw.php";a:4:{s:4:"name";s:24:"PEAR/Task/Unixeol/rw.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"57f2252ad031b1e1f5dfae661483cb46";s:12:"installed_as";s:43:"/usr/local/lib/php/PEAR/Task/Unixeol/rw.php";}s:27:"PEAR/Task/Windowseol/rw.php";a:4:{s:4:"name";s:27:"PEAR/Task/Windowseol/rw.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"99fcd42227227ac005d36ec45551c492";s:12:"installed_as";s:46:"/usr/local/lib/php/PEAR/Task/Windowseol/rw.php";}s:20:"PEAR/Task/Common.php";a:4:{s:4:"name";s:20:"PEAR/Task/Common.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"a66ca113f14dd86cfa82070ae92c744e";s:12:"installed_as";s:39:"/usr/local/lib/php/PEAR/Task/Common.php";}s:31:"PEAR/Task/Postinstallscript.php";a:4:{s:4:"name";s:31:"PEAR/Task/Postinstallscript.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"b3052a4926c1536c67ec466bc73b1a57";s:12:"installed_as";s:50:"/usr/local/lib/php/PEAR/Task/Postinstallscript.php";}s:21:"PEAR/Task/Replace.php";a:4:{s:4:"name";s:21:"PEAR/Task/Replace.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"102212ddcf142401e852e537d0a136b1";s:12:"installed_as";s:40:"/usr/local/lib/php/PEAR/Task/Replace.php";}s:21:"PEAR/Task/Unixeol.php";a:4:{s:4:"name";s:21:"PEAR/Task/Unixeol.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"307540c342f5c8d214869a47da335f58";s:12:"installed_as";s:40:"/usr/local/lib/php/PEAR/Task/Unixeol.php";}s:24:"PEAR/Task/Windowseol.php";a:4:{s:4:"name";s:24:"PEAR/Task/Windowseol.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"497962b51cb8955d80deae0786bdec77";s:12:"installed_as";s:43:"/usr/local/lib/php/PEAR/Task/Windowseol.php";}s:23:"PEAR/Validator/PECL.php";a:4:{s:4:"name";s:23:"PEAR/Validator/PECL.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"c6824a13ba1c84eb9875b1b726b6df68";s:12:"installed_as";s:42:"/usr/local/lib/php/PEAR/Validator/PECL.php";}s:19:"PEAR/Autoloader.php";a:4:{s:4:"name";s:19:"PEAR/Autoloader.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"e0806c569df4890f7d7d0b6a4f37631c";s:12:"installed_as";s:38:"/usr/local/lib/php/PEAR/Autoloader.php";}s:16:"PEAR/Builder.php";a:4:{s:4:"name";s:16:"PEAR/Builder.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"0bbdb01c7d86f443884af64f0ba1d66a";s:12:"installed_as";s:35:"/usr/local/lib/php/PEAR/Builder.php";}s:20:"PEAR/ChannelFile.php";a:4:{s:4:"name";s:20:"PEAR/ChannelFile.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"725b8305c9c1357009b3b4bdd5721edc";s:12:"installed_as";s:39:"/usr/local/lib/php/PEAR/ChannelFile.php";}s:16:"PEAR/Command.php";a:4:{s:4:"name";s:16:"PEAR/Command.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"fc64e9b5a73305371ca6844e09a1fb95";s:12:"installed_as";s:35:"/usr/local/lib/php/PEAR/Command.php";}s:15:"PEAR/Common.php";a:4:{s:4:"name";s:15:"PEAR/Common.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"16a59f518a2ef60fe44b710d8d6ccdfd";s:12:"installed_as";s:34:"/usr/local/lib/php/PEAR/Common.php";}s:15:"PEAR/Config.php";a:4:{s:4:"name";s:15:"PEAR/Config.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"00b54fae7cfb64fea4f6599678d92107";s:12:"installed_as";s:34:"/usr/local/lib/php/PEAR/Config.php";}s:21:"PEAR/DependencyDB.php";a:4:{s:4:"name";s:21:"PEAR/DependencyDB.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"dfa8e37dfd6b7929d71a4582241dc133";s:12:"installed_as";s:40:"/usr/local/lib/php/PEAR/DependencyDB.php";}s:20:"PEAR/Dependency2.php";a:4:{s:4:"name";s:20:"PEAR/Dependency2.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"2c3ab389197655a7c85953e818206cad";s:12:"installed_as";s:39:"/usr/local/lib/php/PEAR/Dependency2.php";}s:19:"PEAR/Downloader.php";a:4:{s:4:"name";s:19:"PEAR/Downloader.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"cff10694bf518002d28972517a0ad30b";s:12:"installed_as";s:38:"/usr/local/lib/php/PEAR/Downloader.php";}s:19:"PEAR/ErrorStack.php";a:4:{s:4:"name";s:19:"PEAR/ErrorStack.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"c3fa0bcab7fdc5497235ae295d6f8484";s:12:"installed_as";s:38:"/usr/local/lib/php/PEAR/ErrorStack.php";}s:18:"PEAR/Exception.php";a:4:{s:4:"name";s:18:"PEAR/Exception.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"31c2e4d0db116e61b0f2f255890cd1e7";s:12:"installed_as";s:37:"/usr/local/lib/php/PEAR/Exception.php";}s:28:"PEAR/FixPHP5PEARWarnings.php";a:4:{s:4:"name";s:28:"PEAR/FixPHP5PEARWarnings.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"e0e4cbcec4a972fbad779d0f9d323120";s:12:"installed_as";s:47:"/usr/local/lib/php/PEAR/FixPHP5PEARWarnings.php";}s:17:"PEAR/Frontend.php";a:4:{s:4:"name";s:17:"PEAR/Frontend.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"5fc32cdc93ad88582ef16f4bb48bd3a5";s:12:"installed_as";s:36:"/usr/local/lib/php/PEAR/Frontend.php";}s:18:"PEAR/Installer.php";a:4:{s:4:"name";s:18:"PEAR/Installer.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"fd52b3dfabbdf8dd2ebcedabf37000ac";s:12:"installed_as";s:37:"/usr/local/lib/php/PEAR/Installer.php";}s:20:"PEAR/PackageFile.php";a:4:{s:4:"name";s:20:"PEAR/PackageFile.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"fed71d0cf71706d0f7e1c77260910463";s:12:"installed_as";s:39:"/usr/local/lib/php/PEAR/PackageFile.php";}s:17:"PEAR/Packager.php";a:4:{s:4:"name";s:17:"PEAR/Packager.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"ffb3644f41ec76b687c48a1d9eea605c";s:12:"installed_as";s:36:"/usr/local/lib/php/PEAR/Packager.php";}s:17:"PEAR/Registry.php";a:4:{s:4:"name";s:17:"PEAR/Registry.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"3eb5eb62a4bda5b7b45561efcdd0aa4e";s:12:"installed_as";s:36:"/usr/local/lib/php/PEAR/Registry.php";}s:13:"PEAR/REST.php";a:4:{s:4:"name";s:13:"PEAR/REST.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"2b696ca5ba297c7f1dcb656af3052ebd";s:12:"installed_as";s:32:"/usr/local/lib/php/PEAR/REST.php";}s:16:"PEAR/RunTest.php";a:4:{s:4:"name";s:16:"PEAR/RunTest.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"a8a0af5b5a9526d49d42e08e3dbfef26";s:12:"installed_as";s:35:"/usr/local/lib/php/PEAR/RunTest.php";}s:17:"PEAR/Validate.php";a:4:{s:4:"name";s:17:"PEAR/Validate.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"9ca97d51e11b84de4596bd25126ac749";s:12:"installed_as";s:36:"/usr/local/lib/php/PEAR/Validate.php";}s:18:"PEAR/XMLParser.php";a:4:{s:4:"name";s:18:"PEAR/XMLParser.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"a8fb4bb608574c0e59152c3259ccc749";s:12:"installed_as";s:37:"/usr/local/lib/php/PEAR/XMLParser.php";}s:15:"scripts/pear.sh";a:6:{s:4:"name";s:15:"scripts/pear.sh";s:4:"role";s:6:"script";s:14:"baseinstalldir";s:1:"/";s:10:"install-as";s:4:"pear";s:6:"md5sum";s:32:"2d69edf442dcca3060db99d586adc9e6";s:12:"installed_as";s:19:"/usr/local/bin/pear";}s:18:"scripts/peardev.sh";a:6:{s:4:"name";s:18:"scripts/peardev.sh";s:4:"role";s:6:"script";s:14:"baseinstalldir";s:1:"/";s:10:"install-as";s:7:"peardev";s:6:"md5sum";s:32:"eb5a9b38a47b9491306af2a1052908c8";s:12:"installed_as";s:22:"/usr/local/bin/peardev";}s:15:"scripts/pecl.sh";a:6:{s:4:"name";s:15:"scripts/pecl.sh";s:4:"role";s:6:"script";s:14:"baseinstalldir";s:1:"/";s:10:"install-as";s:4:"pecl";s:6:"md5sum";s:32:"b5cbd2e74d2aec84ed4fcc467d786d64";s:12:"installed_as";s:19:"/usr/local/bin/pecl";}s:19:"scripts/pearcmd.php";a:6:{s:4:"name";s:19:"scripts/pearcmd.php";s:4:"role";s:3:"php";s:14:"baseinstalldir";s:1:"/";s:10:"install-as";s:11:"pearcmd.php";s:6:"md5sum";s:32:"19f33f363dfdf6e622ae12b1d5ec6616";s:12:"installed_as";s:30:"/usr/local/lib/php/pearcmd.php";}s:19:"scripts/peclcmd.php";a:6:{s:4:"name";s:19:"scripts/peclcmd.php";s:4:"role";s:3:"php";s:14:"baseinstalldir";s:1:"/";s:10:"install-as";s:11:"peclcmd.php";s:6:"md5sum";s:32:"47634115224f41d07d00bf53f6c2613b";s:12:"installed_as";s:30:"/usr/local/lib/php/peclcmd.php";}s:7:"LICENSE";a:4:{s:4:"name";s:7:"LICENSE";s:4:"role";s:3:"doc";s:6:"md5sum";s:32:"45b44486d8090de17b2a8b4211fab247";s:12:"installed_as";s:35:"/usr/local/lib/php/doc/PEAR/LICENSE";}s:7:"INSTALL";a:4:{s:4:"name";s:7:"INSTALL";s:4:"role";s:3:"doc";s:6:"md5sum";s:32:"671e6690634062ee521d2027a9971f22";s:12:"installed_as";s:35:"/usr/local/lib/php/doc/PEAR/INSTALL";}s:11:"package.dtd";a:4:{s:4:"name";s:11:"package.dtd";s:4:"role";s:4:"data";s:6:"md5sum";s:32:"ca444da9174e05f8a0dc71d8ee47900f";s:12:"installed_as";s:40:"/usr/local/lib/php/data/PEAR/package.dtd";}s:9:"PEAR5.php";a:4:{s:4:"name";s:9:"PEAR5.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"1a8f67d58009372a6cbcddd638b128cf";s:12:"installed_as";s:28:"/usr/local/lib/php/PEAR5.php";}s:8:"PEAR.php";a:4:{s:4:"name";s:8:"PEAR.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"bd4bfe6e88a9bb5fe0b8552a63f14f7d";s:12:"installed_as";s:27:"/usr/local/lib/php/PEAR.php";}s:6:"README";a:4:{s:4:"name";s:6:"README";s:4:"role";s:3:"doc";s:6:"md5sum";s:32:"ae70dd96347165e048bd37521d6437f2";s:12:"installed_as";s:34:"/usr/local/lib/php/doc/PEAR/README";}s:10:"System.php";a:4:{s:4:"name";s:10:"System.php";s:4:"role";s:3:"php";s:6:"md5sum";s:32:"99f8cd7c904346694276b377ae0cb547";s:12:"installed_as";s:29:"/usr/local/lib/php/System.php";}s:13:"template.spec";a:4:{s:4:"name";s:13:"template.spec";s:4:"role";s:4:"data";s:6:"md5sum";s:32:"acd010e3bc43c0f72df584acde7b9158";s:12:"installed_as";s:42:"/usr/local/lib/php/data/PEAR/template.spec";}}s:12:"_lastversion";s:5:"1.8.2";s:7:"dirtree";a:23:{s:21:"/usr/local/lib/php/OS";b:1;s:35:"/usr/local/lib/php/PEAR/ChannelFile";b:1;s:23:"/usr/local/lib/php/PEAR";b:1;s:31:"/usr/local/lib/php/PEAR/Command";b:1;s:34:"/usr/local/lib/php/PEAR/Downloader";b:1;s:32:"/usr/local/lib/php/PEAR/Frontend";b:1;s:38:"/usr/local/lib/php/PEAR/Installer/Role";b:1;s:33:"/usr/local/lib/php/PEAR/Installer";b:1;s:45:"/usr/local/lib/php/PEAR/PackageFile/Generator";b:1;s:35:"/usr/local/lib/php/PEAR/PackageFile";b:1;s:42:"/usr/local/lib/php/PEAR/PackageFile/Parser";b:1;s:38:"/usr/local/lib/php/PEAR/PackageFile/v2";b:1;s:28:"/usr/local/lib/php/PEAR/REST";b:1;s:46:"/usr/local/lib/php/PEAR/Task/Postinstallscript";b:1;s:28:"/usr/local/lib/php/PEAR/Task";b:1;s:36:"/usr/local/lib/php/PEAR/Task/Replace";b:1;s:36:"/usr/local/lib/php/PEAR/Task/Unixeol";b:1;s:39:"/usr/local/lib/php/PEAR/Task/Windowseol";b:1;s:33:"/usr/local/lib/php/PEAR/Validator";b:1;s:14:"/usr/local/bin";b:1;s:18:"/usr/local/lib/php";b:1;s:27:"/usr/local/lib/php/doc/PEAR";b:1;s:28:"/usr/local/lib/php/data/PEAR";b:1;}s:3:"old";a:7:{s:7:"version";s:5:"1.8.2";s:12:"release_date";s:10:"2009-04-15";s:13:"release_state";s:6:"stable";s:15:"release_license";s:15:"New BSD License";s:13:"release_notes";s:254:"* Fix Bug #16108: PEAR_PackageFile_Generator_v2 PHP4 parse error when running upgrade-all [dufuz]
* Fix Bug #16113: Installing certain packages fails due incorrect encoding handling [dufuz]
* Fix Bug #16122: PEAR RunTest failed to run as expected [dufuz]";s:12:"release_deps";a:10:{i:0;a:4:{s:4:"type";s:3:"php";s:3:"rel";s:2:"ge";s:7:"version";s:5:"4.4.0";s:8:"optional";s:2:"no";}i:1;a:6:{s:4:"type";s:3:"pkg";s:7:"channel";s:12:"pear.php.net";s:4:"name";s:4:"PEAR";s:3:"rel";s:2:"ge";s:7:"version";s:5:"1.4.3";s:8:"optional";s:2:"no";}i:2;a:6:{s:4:"type";s:3:"pkg";s:7:"channel";s:12:"pear.php.net";s:4:"name";s:11:"Archive_Tar";s:3:"rel";s:2:"ge";s:7:"version";s:3:"1.1";s:8:"optional";s:2:"no";}i:3;a:6:{s:4:"type";s:3:"pkg";s:7:"channel";s:12:"pear.php.net";s:4:"name";s:16:"Structures_Graph";s:3:"rel";s:2:"ge";s:7:"version";s:5:"1.0.2";s:8:"optional";s:2:"no";}i:4;a:6:{s:4:"type";s:3:"pkg";s:7:"channel";s:12:"pear.php.net";s:4:"name";s:14:"Console_Getopt";s:3:"rel";s:2:"ge";s:7:"version";s:3:"1.2";s:8:"optional";s:2:"no";}i:5;a:6:{s:4:"type";s:3:"pkg";s:7:"channel";s:12:"pear.php.net";s:4:"name";s:8:"XML_Util";s:3:"rel";s:2:"ge";s:7:"version";s:5:"1.2.0";s:8:"optional";s:2:"no";}i:6;a:4:{s:4:"type";s:3:"pkg";s:7:"channel";s:12:"pear.php.net";s:4:"name";s:17:"PEAR_Frontend_Web";s:3:"rel";s:3:"not";}i:7;a:4:{s:4:"type";s:3:"pkg";s:7:"channel";s:12:"pear.php.net";s:4:"name";s:17:"PEAR_Frontend_Gtk";s:3:"rel";s:3:"not";}i:8;a:4:{s:4:"type";s:3:"ext";s:4:"name";s:3:"xml";s:3:"rel";s:3:"has";s:8:"optional";s:2:"no";}i:9;a:4:{s:4:"type";s:3:"ext";s:4:"name";s:4:"pcre";s:3:"rel";s:3:"has";s:8:"optional";s:2:"no";}}s:11:"maintainers";a:9:{i:0;a:5:{s:4:"name";s:11:"Greg Beaver";s:5:"email";s:14:"cellog@php.net";s:6:"active";s:2:"no";s:6:"handle";s:6:"cellog";s:4:"role";s:4:"lead";}i:1;a:5:{s:4:"name";s:17:"Pierre-Alain Joye";s:5:"email";s:14:"pierre@php.net";s:6:"active";s:2:"no";s:6:"handle";s:6:"pajoye";s:4:"role";s:4:"lead";}i:2;a:5:{s:4:"name";s:11:"Stig Bakken";s:5:"email";s:12:"stig@php.net";s:6:"active";s:2:"no";s:6:"handle";s:3:"ssb";s:4:"role";s:4:"lead";}i:3;a:5:{s:4:"name";s:13:"Tomas V.V.Cox";s:5:"email";s:15:"cox@idecnet.com";s:6:"active";s:2:"no";s:6:"handle";s:3:"cox";s:4:"role";s:4:"lead";}i:4;a:5:{s:4:"name";s:13:"Helgi Thormar";s:5:"email";s:13:"dufuz@php.net";s:6:"active";s:3:"yes";s:6:"handle";s:5:"dufuz";s:4:"role";s:4:"lead";}i:5;a:5:{s:4:"name";s:9:"Tias Guns";s:5:"email";s:12:"tias@php.net";s:6:"active";s:3:"yes";s:6:"handle";s:4:"tias";s:4:"role";s:9:"developer";}i:6;a:5:{s:4:"name";s:11:"Tim Jackson";s:5:"email";s:12:"timj@php.net";s:6:"active";s:2:"no";s:6:"handle";s:4:"timj";s:4:"role";s:6:"helper";}i:7;a:5:{s:4:"name";s:15:"Bertrand Gugger";s:5:"email";s:13:"toggg@php.net";s:6:"active";s:2:"no";s:6:"handle";s:5:"toggg";s:4:"role";s:6:"helper";}i:8;a:5:{s:4:"name";s:13:"Martin Jansen";s:5:"email";s:10:"mj@php.net";s:6:"active";s:2:"no";s:6:"handle";s:2:"mj";s:4:"role";s:6:"helper";}}}s:10:"xsdversion";s:3:"2.0";s:13:"_lastmodified";i:1241955198;}a:22:{s:7:"attribs";a:6:{s:15:"packagerversion";s:5:"1.7.2";s:7:"version";s:3:"2.0";s:5:"xmlns";s:35:"http://pear.php.net/dtd/package-2.0";s:11:"xmlns:tasks";s:33:"http://pear.php.net/dtd/tasks-1.0";s:9:"xmlns:xsi";s:41:"http://www.w3.org/2001/XMLSchema-instance";s:18:"xsi:schemaLocation";s:147:"http://pear.php.net/dtd/tasks-1.0 http://pear.php.net/dtd/tasks-1.0.xsd http://pear.php.net/dtd/package-2.0 http://pear.php.net/dtd/package-2.0.xsd";}s:4:"name";s:11:"PHP_Archive";s:7:"channel";s:12:"pear.php.net";s:7:"summary";s:32:"Create and Use PHP Archive files";s:11:"description";s:86:"PHP_Archive allows you to create a single .phar file containing an entire application.";s:4:"lead";a:3:{i:0;a:4:{s:4:"name";s:11:"Greg Beaver";s:4:"user";s:6:"cellog";s:5:"email";s:14:"cellog@php.net";s:6:"active";s:3:"yes";}i:1;a:4:{s:4:"name";s:14:"Marcus Boerger";s:4:"user";s:5:"helly";s:5:"email";s:13:"helly@php.net";s:6:"active";s:3:"yes";}i:2;a:4:{s:4:"name";s:12:"Davey Shafik";s:4:"user";s:5:"davey";s:5:"email";s:13:"davey@php.net";s:6:"active";s:2:"no";}}s:4:"date";s:10:"2008-05-19";s:4:"time";s:8:"10:18:27";s:7:"version";a:2:{s:7:"release";s:6:"0.11.4";s:3:"api";s:5:"1.0.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:6:"stable";}s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:61:"minor bugfix release
* E_STRICT/E_DEPRECATED errors displayed";s:8:"contents";a:1:{s:3:"dir";a:2:{s:7:"attribs";a:2:{s:14:"baseinstalldir";s:3:"PHP";s:4:"name";s:1:"/";}s:4:"file";a:44:{i:0;a:2:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"9c9a31619f0a588a4e7ac47203287ea0";s:4:"name";s:19:"Archive/Creator.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:2:{i:0;a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@API-VER@";s:2:"to";s:11:"api-version";s:4:"type";s:12:"package-info";}}i:1;a:1:{s:7:"attribs";a:3:{s:4:"from";s:10:"@data_dir@";s:2:"to";s:8:"data_dir";s:4:"type";s:11:"pear-config";}}}}i:1;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"b897caba6449472068f791eacd3f6b7b";s:4:"name";s:21:"Archive/Exception.php";s:4:"role";s:3:"php";}}i:2;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"274b86f8ee3955725ca195d3c4f56a34";s:4:"name";s:19:"Archive/Manager.php";s:4:"role";s:3:"php";}}i:3;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"3d27cf41aefb02f6eff85c1f01d37762";s:4:"name";s:29:"data/phar_frontcontroller.tpl";s:4:"role";s:4:"data";}}i:4;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"25425f2edc6fa1dd1c966b7aecc445d8";s:4:"name";s:36:"tests/filenotfound/filenotfound.phar";s:4:"role";s:4:"test";}}i:5;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"608d895b6c52e1e27d4139dbd15fe794";s:4:"name";s:47:"tests/filenotfound/makefilenotfoundphar.php.inc";s:4:"role";s:4:"test";}}i:6;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"7b54b83e55941acbcb0f49bb1d461edd";s:4:"name";s:32:"tests/longfilename/longphar.phar";s:4:"role";s:4:"test";}}i:7;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"683aa97ea9b76948eb914d6791256168";s:4:"name";s:39:"tests/longfilename/makelongphar.php.inc";s:4:"role";s:4:"test";}}i:8;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"6de1925dbdca56925413d66a996e7923";s:4:"name";s:37:"tests/opendir/makeopendirphar.php.inc";s:4:"role";s:4:"test";}}i:9;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"5e19fa7257609233c05ef901a918544c";s:4:"name";s:26:"tests/opendir/opendir.phar";s:4:"role";s:4:"test";}}i:10;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"18aaf3891d467f5ef7f7cb2592bc5a8d";s:4:"name";s:33:"tests/planet_php/default_phar.php";s:4:"role";s:4:"test";}}i:11;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"9f6e1886b3acdb33ecdd8574347b4df2";s:4:"name";s:47:"tests/require_once/makerequire_oncephar.php.inc";s:4:"role";s:4:"test";}}i:12;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"dd34cdfcb64d7c32543a1a655f2a08a8";s:4:"name";s:36:"tests/require_once/require_once.phar";s:4:"role";s:4:"test";}}i:13;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"22307d9ee401c8af4f2cd5f5bc9ef41b";s:4:"name";s:14:"tests/eof.phpt";s:4:"role";s:4:"test";}}i:14;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"40c6c6aea179f6c7319c430d19d10f53";s:4:"name";s:23:"tests/filenotfound.phpt";s:4:"role";s:4:"test";}}i:15;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"e52c41f13730cb5be74d2ca670aa47c7";s:4:"name";s:26:"tests/filenotfoundtest.php";s:4:"role";s:4:"test";}}i:16;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"2d8c1c83e01eb4bdb254de9f86cb47e0";s:4:"name";s:28:"tests/filenotfound_phar.phpt";s:4:"role";s:4:"test";}}i:17;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"b3bff0efc0079eab22f974b567a9d174";s:4:"name";s:24:"tests/gopearphar.php.inc";s:4:"role";s:4:"test";}}i:18;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"93d6537a79634d5f0b1dd09722da7552";s:4:"name";s:23:"tests/longfilename.phpt";s:4:"role";s:4:"test";}}i:19;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"1aeea2d41c6d0b80faffcbefd91dd571";s:4:"name";s:26:"tests/makepearphar.php.inc";s:4:"role";s:4:"test";}}i:20;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"21899e6aa7b2b630ed11f51c88d6f60e";s:4:"name";s:27:"tests/maketestphars.php.inc";s:4:"role";s:4:"test";}}i:21;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"80e1f8b84de01a74411d8c320b0f04eb";s:4:"name";s:19:"tests/new_phar.phar";s:4:"role";s:4:"test";}}i:22;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"e16cb196802e73eafd5492d47407a10a";s:4:"name";s:21:"tests/normalstat.phpt";s:4:"role";s:4:"test";}}i:23;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"7d161472a2dd0dc77baeab520e393721";s:4:"name";s:26:"tests/normalstat_phar.phpt";s:4:"role";s:4:"test";}}i:24;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"533b401c195337aeb02fba22a401a8e1";s:4:"name";s:18:"tests/opendir.phpt";s:4:"role";s:4:"test";}}i:25;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"db75c1ed0bd55dcc18f394fdd9484317";s:4:"name";s:19:"tests/pearindex.php";s:4:"role";s:4:"test";}}i:26;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"7215ee9c7d9dc229d2921a40e899ec5f";s:4:"name";s:14:"tests/phar.log";s:4:"role";s:4:"test";}}i:27;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"a4be2b5082e436b8600632c3a89aa5d8";s:4:"name";s:23:"tests/phpt_test.php.inc";s:4:"role";s:4:"test";}}i:28;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"64beb6f1934b355e81ed6113e5eda6df";s:4:"name";s:23:"tests/require_once.phpt";s:4:"role";s:4:"test";}}i:29;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"e01afdfe1a44095176c7c758662b7c27";s:4:"name";s:28:"tests/require_once_phar.phpt";s:4:"role";s:4:"test";}}i:30;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"92241c073e939bf5791faff5212fbbfe";s:4:"name";s:18:"tests/savetest.php";s:4:"role";s:4:"test";}}i:31;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"ce3d49ffdb82bfc3a1c2cfafd95b2467";s:4:"name";s:15:"tests/seek.phpt";s:4:"role";s:4:"test";}}i:32;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"bc979ba8d1a559f5f55798cff99b3db5";s:4:"name";s:20:"tests/seek_phar.phpt";s:4:"role";s:4:"test";}}i:33;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"031dce6b24444eb09bf18d3685c5e5b8";s:4:"name";s:21:"tests/streamstat.phpt";s:4:"role";s:4:"test";}}i:34;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"301ef22083acf47871813d1ba8065622";s:4:"name";s:26:"tests/streamstat_phar.phpt";s:4:"role";s:4:"test";}}i:35;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"68f3f5138a457118a30e7f82448d1f3b";s:4:"name";s:14:"tests/test.php";s:4:"role";s:4:"test";}}i:36;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"d0181dd1230cc531379de96b4d8e39f0";s:4:"name";s:15:"tests/test1.php";s:4:"role";s:4:"test";}}i:37;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"5914439a67fe47d756302cd5b9ab30d0";s:4:"name";s:19:"tests/test_path.php";s:4:"role";s:4:"test";}}i:38;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"0504ac5122c6ea5ba9cb50bfddc1cd34";s:4:"name";s:20:"tests/test_phar.phar";s:4:"role";s:4:"test";}}i:39;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"116ca0152e11b9b06f15d3d29b66b181";s:4:"name";s:21:"tests/test_phar2.phar";s:4:"role";s:4:"test";}}i:40;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"8d410e534625c23941e6e03da0d4864a";s:4:"name";s:22:"tests/test_require.php";s:4:"role";s:4:"test";}}i:41;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"75a612e75fec0e55bd1a01789ff5b8af";s:4:"name";s:18:"tests/test_tar.tar";s:4:"role";s:4:"test";}}i:42;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"32bec765b4bcedfdb8883b67f9a28f02";s:4:"name";s:19:"tests/twophars.phpt";s:4:"role";s:4:"test";}}i:43;a:2:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"82046b3952eed14af8aaf6276362c309";s:4:"name";s:11:"Archive.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@API-VER@";s:2:"to";s:11:"api-version";s:4:"type";s:12:"package-info";}}}}}}s:12:"dependencies";a:1:{s:8:"required";a:3:{s:3:"php";a:1:{s:3:"min";s:5:"5.1.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:5:"1.4.3";}s:7:"package";a:3:{s:4:"name";s:4:"PEAR";s:7:"channel";s:12:"pear.php.net";s:3:"min";s:5:"1.4.3";}}}s:10:"phprelease";s:0:"";s:9:"changelog";a:1:{s:7:"release";a:18:{i:0;a:5:{s:7:"version";a:2:{s:7:"release";s:6:"0.11.4";s:3:"api";s:5:"1.0.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2008-05-19";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:61:"minor bugfix release
* E_STRICT/E_DEPRECATED errors displayed";}i:1;a:5:{s:7:"version";a:2:{s:7:"release";s:6:"0.11.3";s:3:"api";s:5:"1.0.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2007-09-01";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:107:"minor bugfix release
* introspection cannot use exit within stream wrapper, PHP destabilizes, this is fixed";}i:2;a:5:{s:7:"version";a:2:{s:7:"release";s:6:"0.11.2";s:3:"api";s:5:"1.0.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2007-08-18";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:253:"major bugfix release
* fix 64-bit/32-bit compatibility of phars (Brian Shire)
* fix Bug #11858: seek to SEEK_END fails
* fix Bug #11859: mapPhar fails for all phars internally loaded
* fix Bug #11860: missing constant in PHP_Archive_Exception UNKNOWNSIG";}i:3;a:5:{s:7:"version";a:2:{s:7:"release";s:6:"0.11.1";s:3:"api";s:5:"1.0.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2007-05-29";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:45:"Remove potential notice in directory rewind()";}i:4;a:5:{s:7:"version";a:2:{s:7:"release";s:6:"0.11.0";s:3:"api";s:5:"1.0.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2007-05-29";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:198:"Add support for introspection (web) and front controller (web)
Synchronize PHP_Archive class mapPhar() and loadPhar() with API of phar extension
fix url_stat() for non-existing directories/files
fix";}i:5;a:5:{s:7:"version";a:2:{s:7:"release";s:6:"0.10.0";s:3:"api";s:5:"1.0.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2007-02-05";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:355:"Update to match phar extension

Final API for 1.0.0 is set

Add support for:

 * Phar metadata - any serialized value
 * file-specific metadata - any serialized value
 * bzip2 compression of files
 * SHA1/MD5 signature creation (Phar extension can use this,
   PHP_Archive does not on open for performance reasons)
 * file permissions (always set to 0555)";}i:6;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.9.2";s:3:"api";s:5:"0.8.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2007-01-06";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:243:"another major 32-bit/64-bit issue in PHP 5.1 where crc32() returns different values
was causing some phars to fail.

This is *not* fixed in PHP 5.2, and won't be.  This only affects CRCs.  The workaround
found is to sprintf("%u", crc32($data))";}i:7;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.9.1";s:3:"api";s:5:"0.8.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2007-01-05";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:444:"fix API version so that Phar extension can also open PHP_Archive-generated archives

major 32-bit/64-bit issue in PHP 5.1 where unpack() returns different values
was causing some phars to fail.  For instance:

$a = pack("V", 3068571189);
var_dump(unpack("Va", $a));

reports
int(3068571189) on 32 bit and
int(-1226396107) on 64 bit

in PHP 5.1.  This is fixed in PHP 5.2.  This only affects CRCs.  The workaround
found is to sprintf("%u", $crc)";}i:8;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.9.0";s:3:"api";s:5:"0.9.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2006-12-15";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:164:"This release is fully compatible with the phar extension

Minor feature addition:
* implement Request #7362: Add archive collapsing to greatly reduce phar base size";}i:9;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.8.0";s:3:"api";s:5:"0.8.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2006-07-18";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:474:"This release is fully compatible with the phar extension

Major BC breaks:
* the entire structure of an internal phar's manifest has changed
* mapPhar now only takes 2 parameters

Small BC breaks:
* PHP_Archive::processFile() was public static and is now private static

Feature additions:
* creating .phars that are reliant on the .phar extension is now possible
* new PHP_Archive_Manager is available for debugging phars

Bug fixes:
* fix bug #7110: mapPhar security error";}i:10;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.7.0";s:3:"api";s:5:"0.7.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2005-11-30";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:138:"major refactoring - .tar file format is no longer used
DRAMATIC improvement in efficiency of disk use, memory usage,
and processing speed.";}i:11;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.6.1";s:3:"api";s:5:"0.6.1";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2005-09-05";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:132:"Bugfix release
 * fix faulty dependency on unreleased Archive_Tar
 * fix version_compare()'s bungling of versioning ending with -dev";}i:12;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.6.0";s:3:"api";s:5:"0.6.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2005-08-14";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:375:"Bugfix release
 * change error_reporting to E_ALL.  Was stupidly using
   E_ERROR | E_WARNING | E_PARSE | E_NOTICE
 * change __HALT_PHP_PARSER__ to __HALT_COMPILER()
 * rework fread() usage to avoid all potential bugs with chunks
   larger than 8192
 * drop support for PHP 4.3.x and 5.0.x.  Streams are impossible to
   fully support due to bugs in all PHP versions < 5.1.0.";}i:13;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.5.0";s:3:"api";s:5:"0.5.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2005-05-03";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:476:"* Full support for multiple .phars! phar://pharname.phar/file
   and phar://phar2.phar/anotherfile will work now
 * Fix gz compression
 * remove Archive_Tar dep for non-creation
 * remove preg dep for non-creation
 * bundle PHP_Archive in all created .phars - standalone! Only
   compressed .phars have a dep on zlib
 * Add support for filenames > 100 characters in length and unit test
 * Add full support for stat()/is_file()/is_dir()/is_readable() etc., opendir()/readdir()";}i:14;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.4.0";s:3:"api";s:5:"0.4.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2004-11-29";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:32:"Made PHP_Archive_Creator smarter";}i:15;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.3.0";s:3:"api";s:5:"0.3.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2004-07-06";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:17:"Added Stream Seek";}i:16;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.2.0";s:3:"api";s:5:"0.2.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2004-06-14";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:18:"First PEPr Release";}i:17;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.1.0";s:3:"api";s:5:"0.1.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2004-06-13";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:13:"First Package";}}}s:8:"filelist";a:44:{s:19:"Archive/Creator.php";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"9c9a31619f0a588a4e7ac47203287ea0";s:4:"name";s:19:"Archive/Creator.php";s:4:"role";s:3:"php";s:12:"installed_as";s:42:"/usr/local/lib/php/PHP/Archive/Creator.php";}s:21:"Archive/Exception.php";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"b897caba6449472068f791eacd3f6b7b";s:4:"name";s:21:"Archive/Exception.php";s:4:"role";s:3:"php";s:12:"installed_as";s:44:"/usr/local/lib/php/PHP/Archive/Exception.php";}s:19:"Archive/Manager.php";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"274b86f8ee3955725ca195d3c4f56a34";s:4:"name";s:19:"Archive/Manager.php";s:4:"role";s:3:"php";s:12:"installed_as";s:42:"/usr/local/lib/php/PHP/Archive/Manager.php";}s:29:"data/phar_frontcontroller.tpl";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"3d27cf41aefb02f6eff85c1f01d37762";s:4:"name";s:29:"data/phar_frontcontroller.tpl";s:4:"role";s:4:"data";s:12:"installed_as";s:65:"/usr/local/lib/php/data/PHP_Archive/data/phar_frontcontroller.tpl";}s:36:"tests/filenotfound/filenotfound.phar";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"25425f2edc6fa1dd1c966b7aecc445d8";s:4:"name";s:36:"tests/filenotfound/filenotfound.phar";s:4:"role";s:4:"test";s:12:"installed_as";s:72:"/usr/local/lib/php/test/PHP_Archive/tests/filenotfound/filenotfound.phar";}s:47:"tests/filenotfound/makefilenotfoundphar.php.inc";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"608d895b6c52e1e27d4139dbd15fe794";s:4:"name";s:47:"tests/filenotfound/makefilenotfoundphar.php.inc";s:4:"role";s:4:"test";s:12:"installed_as";s:83:"/usr/local/lib/php/test/PHP_Archive/tests/filenotfound/makefilenotfoundphar.php.inc";}s:32:"tests/longfilename/longphar.phar";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"7b54b83e55941acbcb0f49bb1d461edd";s:4:"name";s:32:"tests/longfilename/longphar.phar";s:4:"role";s:4:"test";s:12:"installed_as";s:68:"/usr/local/lib/php/test/PHP_Archive/tests/longfilename/longphar.phar";}s:39:"tests/longfilename/makelongphar.php.inc";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"683aa97ea9b76948eb914d6791256168";s:4:"name";s:39:"tests/longfilename/makelongphar.php.inc";s:4:"role";s:4:"test";s:12:"installed_as";s:75:"/usr/local/lib/php/test/PHP_Archive/tests/longfilename/makelongphar.php.inc";}s:37:"tests/opendir/makeopendirphar.php.inc";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"6de1925dbdca56925413d66a996e7923";s:4:"name";s:37:"tests/opendir/makeopendirphar.php.inc";s:4:"role";s:4:"test";s:12:"installed_as";s:73:"/usr/local/lib/php/test/PHP_Archive/tests/opendir/makeopendirphar.php.inc";}s:26:"tests/opendir/opendir.phar";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"5e19fa7257609233c05ef901a918544c";s:4:"name";s:26:"tests/opendir/opendir.phar";s:4:"role";s:4:"test";s:12:"installed_as";s:62:"/usr/local/lib/php/test/PHP_Archive/tests/opendir/opendir.phar";}s:33:"tests/planet_php/default_phar.php";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"18aaf3891d467f5ef7f7cb2592bc5a8d";s:4:"name";s:33:"tests/planet_php/default_phar.php";s:4:"role";s:4:"test";s:12:"installed_as";s:69:"/usr/local/lib/php/test/PHP_Archive/tests/planet_php/default_phar.php";}s:47:"tests/require_once/makerequire_oncephar.php.inc";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"9f6e1886b3acdb33ecdd8574347b4df2";s:4:"name";s:47:"tests/require_once/makerequire_oncephar.php.inc";s:4:"role";s:4:"test";s:12:"installed_as";s:83:"/usr/local/lib/php/test/PHP_Archive/tests/require_once/makerequire_oncephar.php.inc";}s:36:"tests/require_once/require_once.phar";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"dd34cdfcb64d7c32543a1a655f2a08a8";s:4:"name";s:36:"tests/require_once/require_once.phar";s:4:"role";s:4:"test";s:12:"installed_as";s:72:"/usr/local/lib/php/test/PHP_Archive/tests/require_once/require_once.phar";}s:14:"tests/eof.phpt";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"22307d9ee401c8af4f2cd5f5bc9ef41b";s:4:"name";s:14:"tests/eof.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:50:"/usr/local/lib/php/test/PHP_Archive/tests/eof.phpt";}s:23:"tests/filenotfound.phpt";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"40c6c6aea179f6c7319c430d19d10f53";s:4:"name";s:23:"tests/filenotfound.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:59:"/usr/local/lib/php/test/PHP_Archive/tests/filenotfound.phpt";}s:26:"tests/filenotfoundtest.php";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"e52c41f13730cb5be74d2ca670aa47c7";s:4:"name";s:26:"tests/filenotfoundtest.php";s:4:"role";s:4:"test";s:12:"installed_as";s:62:"/usr/local/lib/php/test/PHP_Archive/tests/filenotfoundtest.php";}s:28:"tests/filenotfound_phar.phpt";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"2d8c1c83e01eb4bdb254de9f86cb47e0";s:4:"name";s:28:"tests/filenotfound_phar.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:64:"/usr/local/lib/php/test/PHP_Archive/tests/filenotfound_phar.phpt";}s:24:"tests/gopearphar.php.inc";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"b3bff0efc0079eab22f974b567a9d174";s:4:"name";s:24:"tests/gopearphar.php.inc";s:4:"role";s:4:"test";s:12:"installed_as";s:60:"/usr/local/lib/php/test/PHP_Archive/tests/gopearphar.php.inc";}s:23:"tests/longfilename.phpt";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"93d6537a79634d5f0b1dd09722da7552";s:4:"name";s:23:"tests/longfilename.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:59:"/usr/local/lib/php/test/PHP_Archive/tests/longfilename.phpt";}s:26:"tests/makepearphar.php.inc";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"1aeea2d41c6d0b80faffcbefd91dd571";s:4:"name";s:26:"tests/makepearphar.php.inc";s:4:"role";s:4:"test";s:12:"installed_as";s:62:"/usr/local/lib/php/test/PHP_Archive/tests/makepearphar.php.inc";}s:27:"tests/maketestphars.php.inc";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"21899e6aa7b2b630ed11f51c88d6f60e";s:4:"name";s:27:"tests/maketestphars.php.inc";s:4:"role";s:4:"test";s:12:"installed_as";s:63:"/usr/local/lib/php/test/PHP_Archive/tests/maketestphars.php.inc";}s:19:"tests/new_phar.phar";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"80e1f8b84de01a74411d8c320b0f04eb";s:4:"name";s:19:"tests/new_phar.phar";s:4:"role";s:4:"test";s:12:"installed_as";s:55:"/usr/local/lib/php/test/PHP_Archive/tests/new_phar.phar";}s:21:"tests/normalstat.phpt";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"e16cb196802e73eafd5492d47407a10a";s:4:"name";s:21:"tests/normalstat.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:57:"/usr/local/lib/php/test/PHP_Archive/tests/normalstat.phpt";}s:26:"tests/normalstat_phar.phpt";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"7d161472a2dd0dc77baeab520e393721";s:4:"name";s:26:"tests/normalstat_phar.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:62:"/usr/local/lib/php/test/PHP_Archive/tests/normalstat_phar.phpt";}s:18:"tests/opendir.phpt";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"533b401c195337aeb02fba22a401a8e1";s:4:"name";s:18:"tests/opendir.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:54:"/usr/local/lib/php/test/PHP_Archive/tests/opendir.phpt";}s:19:"tests/pearindex.php";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"db75c1ed0bd55dcc18f394fdd9484317";s:4:"name";s:19:"tests/pearindex.php";s:4:"role";s:4:"test";s:12:"installed_as";s:55:"/usr/local/lib/php/test/PHP_Archive/tests/pearindex.php";}s:14:"tests/phar.log";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"7215ee9c7d9dc229d2921a40e899ec5f";s:4:"name";s:14:"tests/phar.log";s:4:"role";s:4:"test";s:12:"installed_as";s:50:"/usr/local/lib/php/test/PHP_Archive/tests/phar.log";}s:23:"tests/phpt_test.php.inc";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"a4be2b5082e436b8600632c3a89aa5d8";s:4:"name";s:23:"tests/phpt_test.php.inc";s:4:"role";s:4:"test";s:12:"installed_as";s:59:"/usr/local/lib/php/test/PHP_Archive/tests/phpt_test.php.inc";}s:23:"tests/require_once.phpt";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"64beb6f1934b355e81ed6113e5eda6df";s:4:"name";s:23:"tests/require_once.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:59:"/usr/local/lib/php/test/PHP_Archive/tests/require_once.phpt";}s:28:"tests/require_once_phar.phpt";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"e01afdfe1a44095176c7c758662b7c27";s:4:"name";s:28:"tests/require_once_phar.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:64:"/usr/local/lib/php/test/PHP_Archive/tests/require_once_phar.phpt";}s:18:"tests/savetest.php";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"92241c073e939bf5791faff5212fbbfe";s:4:"name";s:18:"tests/savetest.php";s:4:"role";s:4:"test";s:12:"installed_as";s:54:"/usr/local/lib/php/test/PHP_Archive/tests/savetest.php";}s:15:"tests/seek.phpt";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"ce3d49ffdb82bfc3a1c2cfafd95b2467";s:4:"name";s:15:"tests/seek.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:51:"/usr/local/lib/php/test/PHP_Archive/tests/seek.phpt";}s:20:"tests/seek_phar.phpt";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"bc979ba8d1a559f5f55798cff99b3db5";s:4:"name";s:20:"tests/seek_phar.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:56:"/usr/local/lib/php/test/PHP_Archive/tests/seek_phar.phpt";}s:21:"tests/streamstat.phpt";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"031dce6b24444eb09bf18d3685c5e5b8";s:4:"name";s:21:"tests/streamstat.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:57:"/usr/local/lib/php/test/PHP_Archive/tests/streamstat.phpt";}s:26:"tests/streamstat_phar.phpt";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"301ef22083acf47871813d1ba8065622";s:4:"name";s:26:"tests/streamstat_phar.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:62:"/usr/local/lib/php/test/PHP_Archive/tests/streamstat_phar.phpt";}s:14:"tests/test.php";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"68f3f5138a457118a30e7f82448d1f3b";s:4:"name";s:14:"tests/test.php";s:4:"role";s:4:"test";s:12:"installed_as";s:50:"/usr/local/lib/php/test/PHP_Archive/tests/test.php";}s:15:"tests/test1.php";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"d0181dd1230cc531379de96b4d8e39f0";s:4:"name";s:15:"tests/test1.php";s:4:"role";s:4:"test";s:12:"installed_as";s:51:"/usr/local/lib/php/test/PHP_Archive/tests/test1.php";}s:19:"tests/test_path.php";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"5914439a67fe47d756302cd5b9ab30d0";s:4:"name";s:19:"tests/test_path.php";s:4:"role";s:4:"test";s:12:"installed_as";s:55:"/usr/local/lib/php/test/PHP_Archive/tests/test_path.php";}s:20:"tests/test_phar.phar";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"0504ac5122c6ea5ba9cb50bfddc1cd34";s:4:"name";s:20:"tests/test_phar.phar";s:4:"role";s:4:"test";s:12:"installed_as";s:56:"/usr/local/lib/php/test/PHP_Archive/tests/test_phar.phar";}s:21:"tests/test_phar2.phar";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"116ca0152e11b9b06f15d3d29b66b181";s:4:"name";s:21:"tests/test_phar2.phar";s:4:"role";s:4:"test";s:12:"installed_as";s:57:"/usr/local/lib/php/test/PHP_Archive/tests/test_phar2.phar";}s:22:"tests/test_require.php";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"8d410e534625c23941e6e03da0d4864a";s:4:"name";s:22:"tests/test_require.php";s:4:"role";s:4:"test";s:12:"installed_as";s:58:"/usr/local/lib/php/test/PHP_Archive/tests/test_require.php";}s:18:"tests/test_tar.tar";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"75a612e75fec0e55bd1a01789ff5b8af";s:4:"name";s:18:"tests/test_tar.tar";s:4:"role";s:4:"test";s:12:"installed_as";s:54:"/usr/local/lib/php/test/PHP_Archive/tests/test_tar.tar";}s:19:"tests/twophars.phpt";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"32bec765b4bcedfdb8883b67f9a28f02";s:4:"name";s:19:"tests/twophars.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:55:"/usr/local/lib/php/test/PHP_Archive/tests/twophars.phpt";}s:11:"Archive.php";a:5:{s:14:"baseinstalldir";s:3:"PHP";s:6:"md5sum";s:32:"82046b3952eed14af8aaf6276362c309";s:4:"name";s:11:"Archive.php";s:4:"role";s:3:"php";s:12:"installed_as";s:34:"/usr/local/lib/php/PHP/Archive.php";}}s:12:"_lastversion";N;s:7:"dirtree";a:11:{s:30:"/usr/local/lib/php/PHP/Archive";b:1;s:22:"/usr/local/lib/php/PHP";b:1;s:40:"/usr/local/lib/php/data/PHP_Archive/data";b:1;s:35:"/usr/local/lib/php/data/PHP_Archive";b:1;s:54:"/usr/local/lib/php/test/PHP_Archive/tests/filenotfound";b:1;s:41:"/usr/local/lib/php/test/PHP_Archive/tests";b:1;s:35:"/usr/local/lib/php/test/PHP_Archive";b:1;s:54:"/usr/local/lib/php/test/PHP_Archive/tests/longfilename";b:1;s:49:"/usr/local/lib/php/test/PHP_Archive/tests/opendir";b:1;s:52:"/usr/local/lib/php/test/PHP_Archive/tests/planet_php";b:1;s:54:"/usr/local/lib/php/test/PHP_Archive/tests/require_once";b:1;}s:3:"old";a:7:{s:7:"version";s:6:"0.11.4";s:12:"release_date";s:10:"2008-05-19";s:13:"release_state";s:5:"alpha";s:15:"release_license";s:11:"PHP License";s:13:"release_notes";s:61:"minor bugfix release
* E_STRICT/E_DEPRECATED errors displayed";s:12:"release_deps";a:3:{i:0;a:4:{s:4:"type";s:3:"php";s:3:"rel";s:2:"ge";s:7:"version";s:5:"5.1.0";s:8:"optional";s:2:"no";}i:1;a:6:{s:4:"type";s:3:"pkg";s:7:"channel";s:12:"pear.php.net";s:4:"name";s:4:"PEAR";s:3:"rel";s:2:"ge";s:7:"version";s:5:"1.4.3";s:8:"optional";s:2:"no";}i:2;a:6:{s:4:"type";s:3:"pkg";s:7:"channel";s:12:"pear.php.net";s:4:"name";s:4:"PEAR";s:3:"rel";s:2:"ge";s:7:"version";s:5:"1.4.3";s:8:"optional";s:2:"no";}}s:11:"maintainers";a:3:{i:0;a:5:{s:4:"name";s:11:"Greg Beaver";s:5:"email";s:14:"cellog@php.net";s:6:"active";s:3:"yes";s:6:"handle";s:6:"cellog";s:4:"role";s:4:"lead";}i:1;a:5:{s:4:"name";s:14:"Marcus Boerger";s:5:"email";s:13:"helly@php.net";s:6:"active";s:3:"yes";s:6:"handle";s:5:"helly";s:4:"role";s:4:"lead";}i:2;a:5:{s:4:"name";s:12:"Davey Shafik";s:5:"email";s:13:"davey@php.net";s:6:"active";s:2:"no";s:6:"handle";s:5:"davey";s:4:"role";s:4:"lead";}}}s:10:"xsdversion";s:3:"2.0";s:13:"_lastmodified";i:1222444907;}a:25:{s:7:"attribs";a:6:{s:15:"packagerversion";s:5:"1.6.1";s:7:"version";s:3:"2.0";s:5:"xmlns";s:35:"http://pear.php.net/dtd/package-2.0";s:11:"xmlns:tasks";s:33:"http://pear.php.net/dtd/tasks-1.0";s:9:"xmlns:xsi";s:41:"http://www.w3.org/2001/XMLSchema-instance";s:18:"xsi:schemaLocation";s:147:"http://pear.php.net/dtd/tasks-1.0 http://pear.php.net/dtd/tasks-1.0.xsd http://pear.php.net/dtd/package-2.0 http://pear.php.net/dtd/package-2.0.xsd";}s:4:"name";s:14:"Console_Getopt";s:7:"channel";s:12:"pear.php.net";s:7:"summary";s:26:"Command-line option parser";s:11:"description";s:80:"This is a PHP implementation of "getopt" supporting both
short and long options.";s:4:"lead";a:4:{s:4:"name";s:15:"Andrei Zmievski";s:4:"user";s:6:"andrei";s:5:"email";s:14:"andrei@php.net";s:6:"active";s:3:"yes";}s:9:"developer";a:4:{s:4:"name";s:11:"Stig Bakken";s:4:"user";s:3:"ssb";s:5:"email";s:12:"stig@php.net";s:6:"active";s:2:"no";}s:6:"helper";a:4:{s:4:"name";s:11:"Greg Beaver";s:4:"user";s:6:"cellog";s:5:"email";s:14:"cellog@php.net";s:6:"active";s:3:"yes";}s:4:"date";s:10:"2007-06-12";s:4:"time";s:8:"14:52:39";s:7:"version";a:2:{s:7:"release";s:5:"1.2.3";s:3:"api";s:5:"1.2.1";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:58:"* fix Bug #11068: No way to read plain "-" option [cardoe]";s:8:"contents";a:1:{s:3:"dir";a:2:{s:7:"attribs";a:1:{s:4:"name";s:1:"/";}s:4:"file";a:1:{s:7:"attribs";a:3:{s:6:"md5sum";s:32:"f2175a45c5e5bc7c97e174bdae55b671";s:4:"name";s:18:"Console/Getopt.php";s:4:"role";s:3:"php";}}}}s:10:"compatible";a:4:{s:4:"name";s:4:"PEAR";s:7:"channel";s:12:"pear.php.net";s:3:"min";s:5:"1.4.0";s:3:"max";s:5:"1.6.0";}s:12:"dependencies";a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"4.3.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:5:"1.4.3";}}}s:10:"phprelease";s:0:"";s:9:"changelog";a:1:{s:7:"release";a:7:{i:0;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"1.2.2";s:3:"api";s:5:"1.2.1";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2007-02-17";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:165:"* fix Bug #4475: An ambiguous error occurred when specifying similar longoption name.
* fix Bug #10055: Not failing properly on short options missing required values";}i:1;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"1.2.1";s:3:"api";s:5:"1.2.1";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2006-12-08";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:126:"Fixed bugs #4448 (Long parameter values truncated with longoption parameter) and #7444 (Trailing spaces after php closing tag)";}i:2;a:5:{s:7:"version";a:2:{s:7:"release";s:3:"1.2";s:3:"api";s:3:"1.2";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2003-12-11";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:69:"Fix to preserve BC with 1.0 and allow correct behaviour for new users";}i:3;a:5:{s:7:"version";a:2:{s:7:"release";s:3:"1.0";s:3:"api";s:3:"1.0";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2002-09-13";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:14:"Stable release";}i:4;a:5:{s:7:"version";a:2:{s:7:"release";s:4:"0.11";s:3:"api";s:4:"0.11";}s:9:"stability";a:2:{s:7:"release";s:4:"beta";s:3:"api";s:4:"beta";}s:4:"date";s:10:"2002-05-26";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:89:"POSIX getopt compatibility fix: treat first element of args
        array as command name";}i:5;a:5:{s:7:"version";a:2:{s:7:"release";s:4:"0.10";s:3:"api";s:4:"0.10";}s:9:"stability";a:2:{s:7:"release";s:4:"beta";s:3:"api";s:4:"beta";}s:4:"date";s:10:"2002-05-12";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:13:"Packaging fix";}i:6;a:5:{s:7:"version";a:2:{s:7:"release";s:3:"0.9";s:3:"api";s:3:"0.9";}s:9:"stability";a:2:{s:7:"release";s:4:"beta";s:3:"api";s:4:"beta";}s:4:"date";s:10:"2002-05-12";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:15:"Initial release";}}}s:8:"filelist";a:1:{s:18:"Console/Getopt.php";a:4:{s:6:"md5sum";s:32:"f2175a45c5e5bc7c97e174bdae55b671";s:4:"name";s:18:"Console/Getopt.php";s:4:"role";s:3:"php";s:12:"installed_as";s:37:"/usr/local/lib/php/Console/Getopt.php";}}s:12:"_lastversion";N;s:7:"dirtree";a:1:{s:26:"/usr/local/lib/php/Console";b:1;}s:3:"old";a:7:{s:7:"version";s:5:"1.2.3";s:12:"release_date";s:10:"2007-06-12";s:13:"release_state";s:6:"stable";s:15:"release_license";s:11:"PHP License";s:13:"release_notes";s:58:"* fix Bug #11068: No way to read plain "-" option [cardoe]";s:12:"release_deps";a:2:{i:0;a:4:{s:4:"type";s:3:"php";s:3:"rel";s:2:"ge";s:7:"version";s:5:"4.3.0";s:8:"optional";s:2:"no";}i:1;a:6:{s:4:"type";s:3:"pkg";s:7:"channel";s:12:"pear.php.net";s:4:"name";s:4:"PEAR";s:3:"rel";s:2:"ge";s:7:"version";s:5:"1.4.3";s:8:"optional";s:2:"no";}}s:11:"maintainers";a:3:{i:0;a:5:{s:4:"name";s:15:"Andrei Zmievski";s:5:"email";s:14:"andrei@php.net";s:6:"active";s:3:"yes";s:6:"handle";s:6:"andrei";s:4:"role";s:4:"lead";}i:1;a:5:{s:4:"name";s:11:"Stig Bakken";s:5:"email";s:12:"stig@php.net";s:6:"active";s:2:"no";s:6:"handle";s:3:"ssb";s:4:"role";s:9:"developer";}i:2;a:5:{s:4:"name";s:11:"Greg Beaver";s:5:"email";s:14:"cellog@php.net";s:6:"active";s:3:"yes";s:6:"handle";s:6:"cellog";s:4:"role";s:6:"helper";}}}s:10:"xsdversion";s:3:"2.0";s:13:"_lastmodified";i:1218735264;}a:17:{s:8:"provides";a:0:{}s:8:"filelist";a:7:{s:7:"CREDITS";a:2:{s:4:"role";s:3:"doc";s:12:"installed_as";s:37:"/usr/local/lib/php/doc/xdebug/CREDITS";}s:9:"Changelog";a:2:{s:4:"role";s:3:"doc";s:12:"installed_as";s:39:"/usr/local/lib/php/doc/xdebug/Changelog";}s:7:"LICENSE";a:2:{s:4:"role";s:3:"doc";s:12:"installed_as";s:37:"/usr/local/lib/php/doc/xdebug/LICENSE";}s:4:"NEWS";a:2:{s:4:"role";s:3:"doc";s:12:"installed_as";s:34:"/usr/local/lib/php/doc/xdebug/NEWS";}s:6:"README";a:2:{s:4:"role";s:3:"doc";s:12:"installed_as";s:36:"/usr/local/lib/php/doc/xdebug/README";}s:6:"xt.vim";a:2:{s:4:"role";s:3:"doc";s:12:"installed_as";s:36:"/usr/local/lib/php/doc/xdebug/xt.vim";}s:9:"xdebug.so";a:6:{s:4:"role";s:3:"src";s:4:"name";s:9:"xdebug.so";s:12:"installed_as";s:62:"/usr/local/lib/php/extensions/debug-non-zts-20090115/xdebug.so";s:7:"php_api";i:0;s:12:"zend_mod_api";i:0;s:12:"zend_ext_api";i:0;}}s:10:"xsdversion";s:3:"1.0";s:7:"package";s:6:"xdebug";s:7:"summary";s:52:"Provides functions for function traces and profiling";s:11:"maintainers";a:1:{i:0;a:4:{s:6:"handle";s:6:"derick";s:4:"name";s:14:"Derick Rethans";s:5:"email";s:17:"derick@xdebug.org";s:4:"role";s:4:"lead";}}s:11:"description";s:631:"The Xdebug extension helps you debugging your script by providing a lot of
valuable debug information. The debug information that Xdebug can provide
includes the following:

    * stack and function traces in error messages with:
          o full parameter display for user defined functions
          o function name, file name and line indications
          o support for member functions
    * memory allocation
    * protection for infinite recursions

Xdebug also provides:

    * profiling information for PHP scripts
    * code coverage analysis
    * capabilities to debug your scripts interactively with a debug client
  
";s:15:"release_license";s:9:"BSD style";s:13:"release_state";s:6:"stable";s:7:"version";s:5:"2.0.0";s:12:"release_date";s:10:"2007-07-18";s:13:"release_notes";s:1434:"Wed, Jul 18, 2007 - xdebug 2.0.0

+ Changes:
	- Put back the disabling of stack traces - apperently people were relying
	  on this. This brings back xdebug_enable(), xdebug_disable() and
	  xdebug_is_enabled().
	- xdebug.collect_params is no longer a boolean setting. Although it worked
	  fine, phpinfo() showed only just On or Off here.
	- Fixed the Xdebug version of raw_url_encode to not encode : and \. This is
	  not necessary according to the RFCs and it makes debug breakpoints work
	  on Windows.

= Fixed bugs:
	- Fixed bug #291: Tests that use SPL do not skip when SPL is not available.
	- Fixed bug #290: Function calls leak memory.
	- Fixed bug #289: Xdebug terminates connection when eval() is run in the
	  init stage.
	- Fixed bug #284: Step_over on breakpointed line made Xdebug break twice.
	- Fixed bug #283: Xdebug always returns $this with the value of last stack
	  frame.
	- Fixed bug #282: %s is not usable for xdebug.profiler_output_name on
	  Windows in all stack frames.
	- Fixed bug #280: var_dump() doesn't display key of array as expected.
	- Fixed bug #278: Code Coverage Issue.
	- Fixed bug #273: Remote debugging: context_get does not return context id.
	- Fixed bug #270: Debugger aborts when PHP's eval() is encountered. 
	- Fixed bug #265: XDebug breaks error_get_last() .
	- Fixed bug #261: Code coverage issues by overloading zend_assign_dim.

+ DBGP:
	- Added support for "breakpoint_languages".";s:12:"release_deps";a:1:{i:1;a:3:{s:4:"type";s:3:"php";s:3:"rel";s:2:"ge";s:7:"version";s:5:"4.3.0";}}s:9:"changelog";a:24:{i:0;a:4:{s:13:"release_state";s:6:"stable";s:7:"version";s:5:"2.0.0";s:12:"release_date";s:10:"2007-07-18";s:13:"release_notes";s:1434:"Wed, Jul 18, 2007 - xdebug 2.0.0

+ Changes:
	- Put back the disabling of stack traces - apperently people were relying
	  on this. This brings back xdebug_enable(), xdebug_disable() and
	  xdebug_is_enabled().
	- xdebug.collect_params is no longer a boolean setting. Although it worked
	  fine, phpinfo() showed only just On or Off here.
	- Fixed the Xdebug version of raw_url_encode to not encode : and \. This is
	  not necessary according to the RFCs and it makes debug breakpoints work
	  on Windows.

= Fixed bugs:
	- Fixed bug #291: Tests that use SPL do not skip when SPL is not available.
	- Fixed bug #290: Function calls leak memory.
	- Fixed bug #289: Xdebug terminates connection when eval() is run in the
	  init stage.
	- Fixed bug #284: Step_over on breakpointed line made Xdebug break twice.
	- Fixed bug #283: Xdebug always returns $this with the value of last stack
	  frame.
	- Fixed bug #282: %s is not usable for xdebug.profiler_output_name on
	  Windows in all stack frames.
	- Fixed bug #280: var_dump() doesn't display key of array as expected.
	- Fixed bug #278: Code Coverage Issue.
	- Fixed bug #273: Remote debugging: context_get does not return context id.
	- Fixed bug #270: Debugger aborts when PHP's eval() is encountered. 
	- Fixed bug #265: XDebug breaks error_get_last() .
	- Fixed bug #261: Code coverage issues by overloading zend_assign_dim.

+ DBGP:
	- Added support for "breakpoint_languages".";}i:1;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:8:"2.0.0RC4";s:12:"release_date";s:10:"2007-05-17";s:13:"release_notes";s:1798:"Wed, May 17, 2007 - xdebug 2.0.0rc4
+ Changes:
	- Use √Ç¬µ seconds instead of a tenths of √Ç¬µ seconds to avoid confusion in
	  profile information.
	- Changed xdebug.profiler_output_name and xdebug.trace_output_name to use
	  modifier tags:
	  %c = crc32 of the current working directory
	  %p = pid
	  %r = random number
	  %s = script name
	  %t = timestamp (seconds)
	  %u = timestamp (microseconds)
	  %H = $_SERVER['HTTP_HOST']
	  %R = $_SERVER['REQUEST_URI']
	  %S = session_id (from $_COOKIE if set)
	  %% = literal %

= Fixed bugs:
	- Fixed bug #255: Call Stack Table doesn't show Location on Windows.
	- Fixed bug #251: Using the source command with an invalid filename returns
	  unexpected result.
	- Fixed bug #243: show_exception_trace="0" ignored.
	- Fixed bug #241: Crash in xdebug_get_function_stack().
	- Fixed bug #240: Crash with xdebug.remote_log on Windows.
	- Fixed a segfault in rendering stack traces to error logs.
	- Fixed a bug that prevented variable names from being recorded for remote
	  debug session while xdebug.collect_vars was turned off.
	- Fixed xdebug_dump_superglobals() in case no super globals were
	  configured.

- Removed functions:
	- Removed support for Memory profiling as that didn't work properly.
	- Get rid of xdebug.default_enable setting and associated functions:
	  xdebug_disable() and xdebug_enable().

+ Added features:
	- Implemented support for four different xdebug.collect_params settings for
	  stack traces and function traces.
	- Allow to trigger profiling by the XDEBUG_PROFILE cookie.

+ DBGP:
	- Correctly add namespace definitions to XML.
	- Added the xdebug namespace that adds extra information to breakpoints if
	  available.
	- Stopped the use of >error> elements for exception breakpoints, as that
	  violates the protocol.";}i:2;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:8:"2.0.0RC3";s:12:"release_date";s:10:"2007-01-31";s:13:"release_notes";s:779:"Wed, Jan 31, 2007 - xdebug 2.0.0rc3
+ Changes:
	- Removed the bogus "xdebug.allowed_clients" setting - it was not
	  implemented.
	- Optimized used variable collection by switching to a linked list instead
	  of a hash. This is about 30% faster, but it needed a quick conversion to
	  hash in the case the information had to be shown to remove duplicate
	  variable names.

= Fixed bugs:
	- Fixed bug #232: PHP log_errors functionality lost after enabling xdebug
	  error handler when CLI is used.
	- Fixed problems with opening files - the filename could cause double free
	  issues.
	- Fixed memory tracking as memory_limit is always enabled in PHP 5.2.1 and
	  later.
	- Fixed a segfault that occurred when creating printable stack traces and
	  collect_params was turned off.";}i:3;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:8:"2.0.0RC2";s:12:"release_date";s:10:"2006-12-24";s:13:"release_notes";s:2939:"Sun, Dec 24, 2006 - xdebug 2.0.0rc2
+ Added new features:
	- Implemented the "xdebug.var_display_max_children" setting. The default is
	  set to 128 children.
	- Added types to fancy var dumping function.
	- Implemented FR #210: Add a way to stop the debug session without having
	  to execute a script. The GET/POST parameter "XDEBUG_SESSION_STOP_NO_EXEC"
	  works in the same way as XDEBUG_SESSION_STOP, except that the script will
	  not be executed.
	- DBGP: Allow postmortem analysis.
	- DBGP: Added the non-standard function xcmd_profiler_name_get.

+ Changes:
	- Fixed the issue where xdebug_get_declared_vars() did not know about
	  variables there are in the declared function header, but were not used in
	  the code. Due to this change expected arguments that were not send to a
	  function will now show up as ??? in stack and function traces in PHP 5.1
	  and PHP 5.2.
	- Allow xdebug.var_display_max_data and xdebug.var_display_max_depth
	  settings of -1 which will unlimit those settings.
	- DBGP: Sort super globals in Globals overview.
	- DBGP: Fixed a bug where error messages where not added upon errors in the
	  protocol.
	- DBGP: Change context 1 from globals (superglobals + vars in bottom most
	  stack frame) to just superglobals.

= Fixed bugs:
	- Fixed linking error on AIX by adding libm.
	- Fixed dead code analysis for THROW.
	- Fixed oparray prefill caching for code coverage.
	- Fixed the xdebug.remote_log feature work.
	- DBGP: Fixed a bug where $this did not appear in the local scoped context.
	- DBGP: Reimplemented property_set to use the same symbol fetching function
	  as property_get. We now only use eval in case no type (-t) argument was
	  given.
	- DBGP: Fixed some issues with finding out the classname, which is
	  important for fetching private properties.
	- DBGP: Fixed usage of uninitialized memory that prevented looking up
	  numerical array keys while fetching array elements not work properly.
	- Fixed bug #228: Binary safety for stream output and property fetches.
	- Fixed bug #227: The SESSION super global does not show up in the Globals
	  scope.
	- Fixed bug #225: xdebug dumps core when protocol is GDB.
	- Fixed bug #224: Compile failure on Solaris.
	- Fixed bug #219: Memory usage delta in traces don't work on PHP 5.2.0.
	- Fixed bug #215: Cannot retrieve nested arrays when the array key is a
	  numeric index.
	- Fixed bug #214: The depth level of arrays was incorrectly checked so it
	  would show the first page of a level too deep as well.
	- Fixed bug #213: Dead code analysis doesn't take catches for throws into
	  account.
	- Fixed bug #211: When starting a new session with a different idekey, the
	  cookie is not updated.
	- Fixed bug #209: Additional remote debugging session started when
	  triggering shutdown function.
	- Fixed bug #208: Socket connection attempted when XDEBUG_SESSION_STOP.
	- Fixed PECL bug #8989: Compile error with PHP 5 and GCC 2.95.";}i:4;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:8:"2.0.0rc1";s:12:"release_date";s:10:"2006-10-08";s:13:"release_notes";s:2571:"+ Added new features:
    - Implemented FR #70: Provide optional depth on xdebug_call_* functions.
    - Partially implemented FR #50: Resource limiting for variable display. By
      default only two levels of nested variables and max string lengths of 512
      are shown. This can be changed by setting the ini settings
      xdebug.var_display_max_depth and xdebug.var_display_max_data.
    - Implemented breakpoints for different types of PHP errors. You can now
      set an 'exception' breakpoint on "Fatal error", "Warning", "Notice" etc.
      This is related to bug #187.
    - Added the xdebug_print_function_trace() function to display a stack trace on
      demand.
    - Reintroduce HTML tracing by adding a new tracing option "XDEBUG_TRACE_HTML"
      (4).
    - Made xdebug_stop_trace() return the trace file name, so that the
      following works: <?php echo file_get_contents( xdebug_stop_trace() ); ?>
    - Added the xdebug.collect_vars setting to tell Xdebug to collect
      information about which variables are used in a scope. Now you don't need
      to show variables with xdebug.show_local_vars anymore for
      xdebug_get_declared_vars() to work.
    - Make the filename parameter to the xdebug_start_trace() function
      optional. If left empty it will use the same algorithm to pick a filename
      as when you are using the xdebug.auto_trace setting.

+ Changes:
    - Implemented dead code analysis during code coverage for:
      * abstract methods.
      * dead code after return, throw and exit.
      * implicit returns when a normal return is present.
    - Improved readability of stack traces.
    - Use PG(html_errors) instead of checking whether we run with CLI when
      deciding when to use HTML messages or plain text messages.

= Fixed bugs:
    - Fixed bug #203: PHP errors with HTML content processed incorrectly. This
      patch backs out the change that was made to fix bug #182.
    - Fixed bug #198: Segfault when trying to use a non-existing debug handler.
    - Fixed bug #197: Race condition fixes created too many files.
    - Fixed bug #196: Profile timing on Windows does not work.
    - Fixed bug #195: CLI Error after debugging session.
    - Fixed bug #193: Compile problems with PHP 5.2.
    - Fixed bug #191: File/line breakpoints are case-sensitive on Windows.
    - Fixed bug #181: Xdebug doesn't handle uncaught exception output
      correctly.
    - Fixed bug #173: Coverage produces wrong coverage.
    - Fixed a typo that prevented the XDEBUG_CONFIG option "profiler_enable"
      from working.";}i:5;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:10:"2.0.0beta6";s:12:"release_date";s:10:"2006-06-30";s:13:"release_notes";s:3062:"+ Added new features:
    - Implemented FR #137: feature_get for general commands doesn't have a text field.
    - Implemented FR #131: XDebug needs to implement paged child object requests.
    - Implemented FR #124: Add backtrace dumping information when exception thrown.
    - Implemented FR #70: Add feature_get breakpoint_types.
    - Added profiling aggregation functions (patch by Andrei Zmievski)
    - Implemented the "timestamp" option for the xdebug.trace_output_name and
      xdebug.profiler_output_name settings.
    - Added the xdebug.remote_log setting that allows you to log debugger
      communication to a log file for debugging. This can also be set through
      the "remote_log" element in the XDEBUG_CONFIG environment variable.
    - Added a "script" value to the profiler_output_name option.  This will write
      the profiler output to a filename that consists of the script's full path
      (using underscores). ie: /var/www/index.php becomes
      var_www_index_php_cachegrind.out. (Patch by Brian Shire).
    - DBGp: Implemented support for hit conditions for breakpoints.
    - DBGp: Added support for conditions for file/line breakpoints.
    - DBGp: Added support for hit value checking to file/line breakpoints.
    - DBGp: Added support for "exception" breakpoints.
+ Performance improvements:
    - Added a cache that prevents the code coverage functionality from running a
      "which code is executable check" on every function call, even if they
      were executed multiple times. This should speed up code coverage a lot.
    - Speedup Xdebug but only gathering information about variables in scopes when
      either remote debugging is used, or show_local_vars is enabled.
= Fixed bugs:
    - Fixed bug #184: problem with control chars in code traces
    - Fixed bug #183: property_get -n $this->somethingnonexistent crashes the
      debugger.
    - Fixed bug #182: Errors are not html escaped when being displayed.
    - Fixed bug #180: collected includes not shown in trace files. (Patch by
      Cristian Rodriguez)
    - Fixed bug #178: $php_errormsg and Track errors unavailable.
    - Fixed bug #177: debugclient fails to compile due to Bison.
    - Fixed bug #176: Segfault using SplTempFileObject.
    - Fixed bug #173: Xdebug segfaults using SPL ArrayIterator.
    - Fixed bug #171: set_time_limit stack overflow on 2nd request.
    - Fixed bug #168: Xdebug's DBGp crashes on an eval command where the
      result is an array.
    - Fixed bug #125: show_mem_delta does not calculate correct negative values on
      64bit machines.
    - Fixed bug #121: property_get -n $r[2] returns the whole hash.
    - Fixed bug #111: xdebug does not ignore set_time_limit() function during debug
      session.
    - Fixed bug #87: Warning about headers when "register_shutdown_function" used.
    - Fixed PECL bug #6940 (XDebug ignores set_time_limit)
    - Fixed Komodo bug 45484: no member data for objects in PHP debugger.
    - Suppress NOP/EXT_NOP from being marked as executable code with Code
      Coverage.";}i:6;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:10:"2.0.0beta5";s:12:"release_date";s:10:"2005-12-31";s:13:"release_notes";s:640:"+ Added new features:
    - Implemented FR #161: var_dump doesn't show lengths for strings.
    - Implemented FR #158: Function calls from the {main} scope always have the
      line number 0. 
    - Implemented FR #156: it's impossible to know the time taken by the last
      func call in xdebug trace mode 0.
    - Implemented FR #153: xdebug_get_declared_vars().
    
= Fixed bugs:
    - Fixed shutdown crash with ZTS on Win32
    - Fixed bad memory leak when a E_ERROR of exceeding memory_limit was
      thrown.
    - Fixed bug #154: GCC 4.0.2 optimizes too much out with -O2.
    - Fixed bug #141: Remote context_get causes segfault.";}i:7;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:10:"2.0.0beta4";s:12:"release_date";s:10:"2005-09-24";s:13:"release_notes";s:862:"+ Added new features:
    - Added xdebug_debug_zval_stdout().
    - Added xdebug_get_profile_filename() function which returns the current
      profiler dump file.
    - Updated for latest 5.1 and 6.0 CVS versions of PHP.
    - Added FR #148: Option to append to cachegrind files, instead of
      overwriting.
    - Implemented FR #114: Rename tests/*.php to tests/*.inc

- Changed features:
    - Allow "xdebug.default_enable" to be set everywhere.

= Fixed bugs:
    - DBGP: Xdebug should return "array" with property get, which is defined
      in the typemap to the common type "hash".
    - Fixed bug #142: xdebug crashes with implicit destructor calls.
    - Fixed bug #136: The "type" attribute is missing from stack_get returns.
    - Fixed bug #133: PHP scripts exits with 0 on PHP error.
    - Fixed bug #132: use of eval causes a segmentation fault.";}i:8;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:10:"2.0.0beta3";s:12:"release_date";s:10:"2005-05-12";s:13:"release_notes";s:916:"+ Added new features:
    - Added the possibility to trigger the profiler by setting
      "xdebug.profiler_enable_trigger" to 1 and using XDEBUG_PROFILE as a get
      parameter.

= Fixed bugs:
    - Fixed a segfault for when an attribute value is NULL on XML string
      generation.
    - Fixed bug #118: Segfault with exception when remote debugging.
    - Fixed bug #117: var_dump dows not work with "private".
    - Fixed bug #109: DBGP's eval will abort the script when the eval statement
      is invalid.
    - Fixed bug #108: log_only still displays some text for errors in included
      files.
    - Fixed bug #107: Code Coverage only detects executable code in used
      functions and classes.
    - Fixed bug #103: crash when running the DBGp command 'eval' on a global
      variable
    - Fixed bug #95: Segfault when deinitializing Xdebug module.
      (Patch by Maxim Poltarak <demiurg@gmail.com>)";}i:9;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:10:"2.0.0beta2";s:12:"release_date";s:10:"2004-11-28";s:13:"release_notes";s:1605:"+ Added new features:
    - DBGP: Added error messages to returned errors (in most cases)
  
+ Added new functions:
    - xdebug_debug_zval() to debug zvals by printing its refcounts and is_ref
      values.
  
= Changed features:
    - xdebug_code_coverage_stop() will now clean up the code coverage array,
      unless you specify FALSE as parameter.
    - The proper Xdebug type is "hash" for associative arrays.
    - Extended the code-coverage functionality by returning lines with
      executable code on them, but where not executed with a count value of -1.

= Fixed bugs:
    - DBGP: Make property_get and property_value finally work as they should,
      including retrieving information from different depths then the most top
      stack frame.
    - DBGP: Fix eval'ed $varnames in property_get.
    - DBGP: Support the -d option for property_get.
    - Fixed the exit handler hook to use the new "5.1" way of handling it;
      which fortunately also works with PHP 5.0.
    - Fixed bug #102: Problems with configure for automake 1.8.
    - Fixed bug #101: crash with set_exeception_handler() and uncatched exceptions.
    - Fixed bug #99: unset variables return the name as a string with property_get.
    - Fixed bug #98: 'longname' attribute not returned for unintialized
      property in context_get request.
    - Fixed bug #94: xdebug_sprintf misbehaves with x86_64/glibc-2.3.3
    - Fixed bug #93: Crash in lookup_hostname on x86_64
    - Fixed bug #92: xdebug_disable() doesn't disable the exception handler.
    - Fixed bug #68: Summary not written when script ended with "exit()".";}i:10;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:10:"2.0.0beta1";s:12:"release_date";s:10:"2004-09-15";s:13:"release_notes";s:5643:"+ Added new features:
    - Added support for the new DBGp protocol for communicating with the debug
      engine.
    - A computerized trace format for easier parsing by external programs.
    - The ability to set remote debugging features via the environment.  This
      allows an IDE to emulate CGI and still pass the configuration through to
      the debugger.  In CGI mode, PHP does not allow -d arguments.
    - Reimplementation of the tracing code, you can now only trace to file; this greatly
      enhances performance as no string representation of variables need to be
      kept in memory any more.
    - Re-implemented profiling support. Xdebug outputs information the same way
      that cachegrind does so it is possible to use Kcachegrind as front-end.
    - Xdebug emits warnings when it was not loaded as a Zend extension.
    - Added showing private, protected and public to the fancy var_dump()
      replacement function.
    - Added the setting of the TCP_NODELAY socket option to stop delays in
      transferring data to the remote debugger client. (Patch by Christof J.  Reetz)
    + DebugClient: Added setting for port to listen on and implemented running
      the previous command when pressing just enter.

+ Added new functions:
    - xdebug_get_stack_depth() to return the current stack depth level.
    - xdebug_get_tracefile_name() to retrieve the name of the tracefile. This
      is useful in case auto trace is enabled and you want to clean the trace
      file.
    - xdebug_peak_memory_usage() which returns the peak memory
      used in a script. (Only works when --enable-memory-limit was enabled)

+ Added feature requests:
    - FR #5: xdebug_break() function which interupts the script for the debug
      engine.
    - FR #30: Dump current scope information in stack traces on error.
    - FR #88: Make the url parameter XDEBUG_SESSION_START optional. So it can
      be disabled and the user does not need to add it.

+ Added new php.ini settings:
    - xdebug.auto_trace_file: to configure a trace file to write to as addition
      to the xdebug.auto_trace setting which just turns on tracing.
    - xdebug.collect_includes: separates collecting
      names of include files from the xdebug.collect_params setting.
    - xdebug.collect_return: showing return values in traces.
    - xdebug.dump_global: with which you can turn off dumping of super globals
      even in you have that configured.
    - xdebug.extended_info: turns off the generation of extended opcodes that
      are needed for stepping and breakpoints for the remote debugger. This is
      useful incase you want to profile memory usage as the generation of this
      extended info increases memory usage of oparrrays by about 33%. 
    - xdebug.profiler_output_dir: profiler output directory.
    - xdebug.profiler_enable: enable the profiler.
    - xdebug.show_local_vars: turn off the showing of local variables in the
      top most stack frame on errors.
    - xdebug.show_mem_delta: show differences between current and previous
      memory usage on a function call level.
    - xdebug.trace_options: to configure extra
      options for trace dumping:
        o XDEBUG_TRACE_APPEND option (1)

= Changed features:
    - xdebug_start_trace() now returns the filename of the tracefile (.xt is
      added to the requested name).
    - Changed default debugging protocol to dbgp instead of gdb.
    - Changed default debugger port from 17869 to 9000.
    - Changed trace file naming: xdebug.trace_output_dir is now used to
      configure a directory to dump automatic traces; the trace file name now
      also includes the pid (xdebug.trace_output_name=pid) or a crc32 checksum
      of the current working dir (xdebug.trace_output_name=crc32) and traces
      are not being appended to an existing file anymore, but simply
      overwritten.
    - Removed $this and $GLOBALS from showing variables in the local scope.

- Removed functions:
    - xdebug_get_function_trace/xdebug_dump_function_trace() because of the new
      idea of tracing.

= Fixed bugs:
    - Fixed bug #89: var_dump shows empty strings garbled.
    - Fixed bug #85: Xdebug segfaults when no idekey is set.
    - Fixed bug #83: More than 32 parameters functions make xdebug crash.
    - Fixed bug #75: xdebug's var_dump implementation is not binary safe.
    - Fixed bug #73: komodo beta 4.3.7 crash.
    - Fixed bug #72: breakpoint_get returns wrong structure.
    - Fixed bug #69: Integer overflow in cachegrind summary.
    - Fixed bug #67: Filenames in Xdebug break URI RFC with spaces.
    - Fixed bug #64: Missing include of xdebug_compat.h.
    - Fixed bug #57: Crash with overloading functions.
    - Fixed bug #54: source command did not except missing -f parameter.
    - Fixed bug #53: Feature get misusing the supported attribute.
    - Fixed bug #51: Only start a debug session if XDEBUG_SESSION_START is
      passed as GET or POST parameter, or the DBGP_COOKIE is send to the server.
      Passing XDEBUG_SESSION_STOP as GET/POST parameter will end the debug
      session and removes the cookie again. The cookie is also passed to the
      remote handler backends; for DBGp it is added to the <init> packet.
    - Fixed bug #49: Included file's names should not be stored by address.
    - Fixed bug #44: Script time-outs should be disabled when debugging.
    = Fixed bug #36: GDB handler using print causes segfault with wrong syntax
    - Fixed bug #33: Implemented the use of the ZEND_POST_DEACTIVATE hook. Now we
      can handle destructors safely too.
    - Fixed bug #32: Unusual dynamic variables cause xdebug to crash.";}i:11;a:4:{s:13:"release_state";s:6:"stable";s:7:"version";s:5:"1.3.1";s:12:"release_date";s:10:"2004-04-06";s:13:"release_notes";s:263:"= Fixed profiler to aggregate class/method calls correctly. (Robert Beenen)
= Fixed debugclient to initialize socket structure correctly. (Brandon Philips
  and David Sklar)
= GDB: Fixed bug where the source file wasn't closed after a "source" command.
  (Derick)";}i:12;a:4:{s:13:"release_state";s:6:"stable";s:7:"version";s:5:"1.3.0";s:12:"release_date";s:10:"2003-09-17";s:13:"release_notes";s:223:"= Fixed segfault where a function name didn't exist in case of a
 "call_user_function". (Derick)
= Fixed reading a filename in case of an callback to a PHP function from an
  internal function (like "array_map()"). (Derick)";}i:13;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:8:"1.3.0rc1";s:12:"release_date";s:10:"2003-09-17";s:13:"release_notes";s:1498:"= Fixed bug with wrong file names for functions called from call_user_*().
  (Derick)
+ Added the option "dump_superglobals" to the remote debugger. If you set this
  option to 0 the "show-local" and similar commands will not return any data
  from superglobals anymore. (Derick)
= Fixed bug #2: "pear package" triggers a segfault. (Derick)
= Fixed crash bug when a function had sprintf style parameters (ie.
  strftime()). (Derick)
+ Added "id" attribute to <var /> elements in responses from the remove
  debugger when the response method is XML. This makes it possible to
  distinguish between unique elements by use of recursion for example. (Derick)
= Improved performance greatly by doing lazy folding of variables outside
  trace mode. (Derick)
= Fixed a bug with "quit", if it was used it disabled the extension for the
  current process. (Derick)
+ Added the "full" argument to the remote command "backtrace". When this
  argument is passed, the local variables will be returned to for each frame in
  the stack. (Derick)
+ Implemented xdebug_time_index() which returns the time passed since the
  start of the script. This change also changes the output of the tracing
  functions as the start time will no longer be the first function call, but
  the real start time of the script. (Derick)
+ Implemented the "show-local" command (shows all local variables in the
  current scope including all contents). (Derick)
+ Implemented conditions for breakpoints in the "break" command. (Derick)";}i:14;a:4:{s:13:"release_state";s:6:"stable";s:7:"version";s:5:"1.2.0";s:12:"release_date";s:10:"2003-04-21";s:13:"release_notes";s:39:"= Fixed compilation on MacOSX. (Derick)";}i:15;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:8:"1.2.0rc2";s:12:"release_date";s:10:"2003-04-15";s:13:"release_notes";s:109:"= Fixed handling Windows paths in the debugger. (Derick)
= Fixed getting zvals out of Zend Engine 2. (Derick)";}i:16;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:8:"1.2.0rc1";s:12:"release_date";s:10:"2003-04-06";s:13:"release_notes";s:862:"+ Added code coverage functions to check which lines and how often they were
  touched during execution. (Derick)
+ Made Xdebug compatible with Zend Engine 2. (Derick)
+ Added dumping of super globals on errors. (Harald Radi)
+ Added XML protocol for the debugger client. (Derick)
= Fixed handling of "continue" (so that it also continues with the script).
  (Derick)
+ Additions to the remote debugger: "eval" (evaluate any PHP code from the
  debugger client). (Derick)
+ Added profiling support to xdebug. This introduces 3 new functions,
  xdebug_start_profiling() that begins profiling process, 
  xdebug_stop_profiling() that ends the profiling process and
  xdebug_dump_function_trace() that dumps the profiling data. (Ilia)
+ Implemented the "kill" (kills the running script) and "delete" (removes
  a breakpoint on a specified element) command. (Derick)";}i:17;a:4:{s:13:"release_state";s:6:"stable";s:7:"version";s:5:"1.1.0";s:12:"release_date";s:10:"2002-11-11";s:13:"release_notes";s:357:"+ Implemented the "list" (source listing), "print" (printing variable
  contents), "show" (show all variables in the scope), "step" (step through
  execution), "pwd" (print working directory), "next" (step over) and "finish"
  (step out) commands for the remote debugger. (Derick)
= Fixed lots of small bugs, under them memory leaks and crash bugs. (Derick)";}i:18;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:9:"1.1.0pre2";s:12:"release_date";s:10:"2002-10-29";s:13:"release_notes";s:346:"+ Implemented class::method, object->method and file.ext:line style
  breakpoints. (Derick)
+ Added xdebug.collect_params setting. If this setting is on (the default)
  then Xdebug collects all parameters passed to functions, otherwise they
  are not collected at all. (Derick)
+ Implemented correct handling of include/require and eval. (Derick)";}i:19;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:9:"1.1.0pre1";s:12:"release_date";s:10:"2002-10-22";s:13:"release_notes";s:556:"+ Added automatic starting of function traces (xdebug.auto_trace, defaulting to
  "off"). (Derick)
- Xdebug no longer supports PHP versions below PHP 4.3.0pre1. (Derick)
+ Added gdb compatible debugger handler with support for simple (function only)
  breakpoints. (Derick)
= Implemented a new way to get class names and file names. (Derick, Thies C.
  Arntzen <thies@thieso.net>)
+ Added time-index and memory footprint to CLI dumps. (Derick)
+ Implemented remote debugger handler abstraction. (Derick)
+ Added a php3 compatible debugger handler. (Derick)";}i:20;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:8:"1.0.0rc1";s:12:"release_date";s:10:"2002-09-01";s:13:"release_notes";s:382:"+ Implemented gathering of parameters to internal functions (only available
  in combination with PHP 4.3.0-dev). (Derick)
= Implemented a new way to get class names and file names. (Derick, Thies C.
  Arntzen >thies@thieso.net<)
+ Added support for error messages with stack trace in syslog. (Sergio
  Ballestrero >s.ballestrero@planetweb.it<)
= Windows compilation fixes. (Derick)";}i:21;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:5:"0.9.0";s:12:"release_date";s:10:"2002-06-16";s:13:"release_notes";s:663:"= Fixed a memory leak in delayed included files. (Derick)
- Added support for PHP 4.1.2. (Derick)
= Rewrote xdebug_get_function_stack() and xdebug_get_function_trace() to return
  data in multidimensional arrays. (Derick)
= Fixed compiling without memory limit enabled (Sander Roobol, Derick)
- Add support for classnames, variable include files and variable
  function names. (Derick)
- Implemented links to the PHP Manual in traces. (Derick)
- Added timestamps and memory usage to function traces. (Derick)
= Fixed crash when using an user defined session handler. (Derick)
+ Implemented variable function names ($a = 'foo'; $f();) for use in
  traces. (Derick)";}i:22;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:5:"0.8.0";s:12:"release_date";s:10:"2002-05-26";s:13:"release_notes";s:932:"+ Implemented much better parameter tracing for user defined
  functions. (Derick)
= Renamed xdebug_get_function_trace() to xdebug_dump_function_trace().
  (Derick)
= Implemented new xdebug_get_function_trace() to return the function trace in
  an array. (Derick)
+ Added a parameter to xdebug_start_trace(). When this parameter is used,
  xdebug will dump a function trace to the filename which this parameter
  speficies. (Derick)
- Fix a problem with nested member functions. (Derick)
= Make configure scripts work with PHP 4.2.x. (Derick)
+ Implemented handling single-dimensional constant arrays passed to a
  function. (Derick)
= Fix function traces in windows. (Derick)
+ Implemented function traces, which you can start and stop with
  xdebug_start_trace() and xdebug_stop_trace(). You can view the trace by using
  the return array from xdebug_get_function_trace(). (Derick)
= Fixed segfaults with xdebug_call_*(). (Derick)";}i:23;a:4:{s:13:"release_state";s:4:"beta";s:7:"version";s:5:"0.7.0";s:12:"release_date";s:10:"2002-05-08";s:13:"release_notes";s:551:"+ Implemented handling of static method calls (foo::bar). (Derick)
+ Added correct handling of include(_once)/require(_once) and eval().
  (Derick)
+ Added ini setting to change the default setting for enabling showing
  enhanced error messages. (Defaults to "On"). (Derick)
+ Added the functions xdebug_enable() and xdebug_disable() to change the
  showing of stack traces from within your code. (Derick)
= Fixed the extension to show all errors. (Derick)
+ Implemented xdebug_memory_usage() which returns the memory in use by PHPs
  engine. (Derick)";}}s:12:"_lastversion";N;s:7:"dirtree";a:1:{s:29:"/usr/local/lib/php/doc/xdebug";b:1;}s:13:"_lastmodified";i:1233812111;}a:22:{s:7:"attribs";a:6:{s:15:"packagerversion";s:5:"1.5.0";s:7:"version";s:3:"2.0";s:5:"xmlns";s:35:"http://pear.php.net/dtd/package-2.0";s:11:"xmlns:tasks";s:33:"http://pear.php.net/dtd/tasks-1.0";s:9:"xmlns:xsi";s:41:"http://www.w3.org/2001/XMLSchema-instance";s:18:"xsi:schemaLocation";s:159:"http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.0     http://pear.php.net/dtd/package-2.0.xsd";}s:4:"name";s:16:"Structures_Graph";s:7:"channel";s:12:"pear.php.net";s:7:"summary";s:40:"Graph datastructure manipulation library";s:11:"description";s:293:"Structures_Graph is a package for creating and manipulating graph datastructures. It allows building of directed
and undirected graphs, with data and metadata stored in nodes. The library provides functions for graph traversing
as well as for characteristic extraction from the graph topology.";s:4:"lead";a:4:{s:4:"name";s:16:"S√©rgio Carvalho";s:4:"user";s:9:"sergiosgc";s:5:"email";s:32:"sergio.carvalho@portugalmail.com";s:6:"active";s:3:"yes";}s:4:"date";s:10:"2007-02-01";s:4:"time";s:8:"17:45:32";s:7:"version";a:2:{s:7:"release";s:5:"1.0.2";s:3:"api";s:5:"1.0.0";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:47:"http://opensource.org/licenses/lgpl-license.php";}s:8:"_content";s:4:"LGPL";}s:5:"notes";s:130:"- Bug #9682 only variables can be returned by reference
- fix Bug #9661 notice in Structures_Graph_Manipulator_Topological::sort()";s:8:"contents";a:1:{s:3:"dir";a:2:{s:7:"attribs";a:2:{s:14:"baseinstalldir";s:0:"";s:4:"name";s:1:"/";}s:4:"file";a:32:{i:0;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"039cb8781dae7b5f5661dc2892fb53b5";s:4:"name";s:26:"docs/html/media/banner.css";s:4:"role";s:3:"doc";}}i:1;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"8ff124484e8a009f94a8d0b4d9b8b1cd";s:4:"name";s:30:"docs/html/media/stylesheet.css";s:4:"role";s:3:"doc";}}i:2;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"a17210dd27171316f5cb446a5bef59ab";s:4:"name";s:48:"docs/html/Structures_Graph/Structures_Graph.html";s:4:"role";s:3:"doc";}}i:3;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"1ed0ac55530b7504c00df35f335e7ef3";s:4:"name";s:72:"docs/html/Structures_Graph/Structures_Graph_Manipulator_AcyclicTest.html";s:4:"role";s:3:"doc";}}i:4;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"fefb65755d57a87d2736e058a1095b03";s:4:"name";s:78:"docs/html/Structures_Graph/Structures_Graph_Manipulator_TopologicalSorter.html";s:4:"role";s:3:"doc";}}i:5;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"afb0e3afb91beafd1bc16a07ac31c826";s:4:"name";s:53:"docs/html/Structures_Graph/Structures_Graph_Node.html";s:4:"role";s:3:"doc";}}i:6;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"3fa477998b281061361c4d98fb78c3a8";s:4:"name";s:61:"docs/html/Structures_Graph/tutorial_Structures_Graph.pkg.html";s:4:"role";s:3:"doc";}}i:7;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"c46e6566be5249811667ddc7decf405f";s:4:"name";s:77:"docs/html/Structures_Graph/_Structures_Graph_Manipulator_AcyclicTest_php.html";s:4:"role";s:3:"doc";}}i:8;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"c45890d45dd42dc56adb71988c3a45c1";s:4:"name";s:83:"docs/html/Structures_Graph/_Structures_Graph_Manipulator_TopologicalSorter_php.html";s:4:"role";s:3:"doc";}}i:9;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"09cb6d17f96553bfb66b99c502676844";s:4:"name";s:58:"docs/html/Structures_Graph/_Structures_Graph_Node_php.html";s:4:"role";s:3:"doc";}}i:10;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"78e1e7ec43a6e754cf4d5dace48fe18c";s:4:"name";s:53:"docs/html/Structures_Graph/_Structures_Graph_php.html";s:4:"role";s:3:"doc";}}i:11;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"d0ada99c3b7e95b23461cc3e713f0c3d";s:4:"name";s:42:"docs/html/classtrees_Structures_Graph.html";s:4:"role";s:3:"doc";}}i:12;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"898dd26ccc1c1572d36e9879afcb5d39";s:4:"name";s:27:"docs/html/elementindex.html";s:4:"role";s:3:"doc";}}i:13;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"19dd287d44163d2abde1a1d8d52521f8";s:4:"name";s:44:"docs/html/elementindex_Structures_Graph.html";s:4:"role";s:3:"doc";}}i:14;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"ae809f6ebbf632351648c340d2d6acd4";s:4:"name";s:21:"docs/html/errors.html";s:4:"role";s:3:"doc";}}i:15;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"db3206e7d176ae78fd04f22acead5ffa";s:4:"name";s:20:"docs/html/index.html";s:4:"role";s:3:"doc";}}i:16;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"4ec087627323546610b64d69a6aafca6";s:4:"name";s:34:"docs/html/li_Structures_Graph.html";s:4:"role";s:3:"doc";}}i:17;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"005081a4c5d60afcbabc1f4909ebfcad";s:4:"name";s:23:"docs/html/packages.html";s:4:"role";s:3:"doc";}}i:18;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"a7a1b748bbda6dfa1632bf6078fc8bb6";s:4:"name";s:23:"docs/html/todolist.html";s:4:"role";s:3:"doc";}}i:19;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"628eb6532a8047bf5962fe24c1c245df";s:4:"name";s:52:"docs/tutorials/Structures_Graph/Structures_Graph.pkg";s:4:"role";s:3:"doc";}}i:20;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"ce2da39dbb75e21074eb5e96231a3379";s:4:"name";s:16:"docs/generate.sh";s:4:"role";s:3:"doc";}}i:21;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"f0aff5a1efd188d63b4b8b9e9e840b97";s:4:"name";s:44:"Structures/Graph/Manipulator/AcyclicTest.php";s:4:"role";s:3:"php";}}i:22;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"0492e677436d29228df93dca23629e06";s:4:"name";s:50:"Structures/Graph/Manipulator/TopologicalSorter.php";s:4:"role";s:3:"php";}}i:23;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"7e28e01ebfa273e5df2eb1ef7a356635";s:4:"name";s:25:"Structures/Graph/Node.php";s:4:"role";s:3:"php";}}i:24;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"4f25a6275af156f6f8e7b4309cb9f40d";s:4:"name";s:20:"Structures/Graph.php";s:4:"role";s:3:"php";}}i:25;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"63dfc6f0f14e18c13d8a8415c3fe049d";s:4:"name";s:29:"tests/testCase/BasicGraph.php";s:4:"role";s:4:"test";}}i:26;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"1b9e35896d229b84601e6754cd44e339";s:4:"name";s:19:"tests/all-tests.php";s:4:"role";s:4:"test";}}i:27;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"d41d8cd98f00b204e9800998ecf8427e";s:4:"name";s:12:"tests/README";s:4:"role";s:4:"test";}}i:28;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"ab23406ec7bfbb2029ca536378ff57db";s:4:"name";s:17:"genpackage.xml.pl";s:4:"role";s:4:"data";}}i:29;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"7fbc338309ac38fefcd64b04bb903e34";s:4:"name";s:7:"LICENSE";s:4:"role";s:4:"data";}}i:30;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"6e782f281c7d0ce27e54b574247073cb";s:4:"name";s:10:"package.sh";s:4:"role";s:4:"data";}}i:31;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"b81f67f7b5600231735243be73625e54";s:4:"name";s:10:"publish.sh";s:4:"role";s:4:"data";}}}}}s:12:"dependencies";a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"4.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:5:"1.4.3";}}}s:10:"phprelease";s:0:"";s:9:"changelog";a:1:{s:7:"release";a:5:{s:7:"version";a:2:{s:7:"release";s:5:"1.0.2";s:3:"api";s:5:"1.0.0";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2007-01-07";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:47:"http://opensource.org/licenses/lgpl-license.php";}s:8:"_content";s:4:"LGPL";}s:5:"notes";s:130:"- Bug #9682 only variables can be returned by reference
- fix Bug #9661 notice in Structures_Graph_Manipulator_Topological::sort()";}}s:8:"filelist";a:32:{s:26:"docs/html/media/banner.css";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"039cb8781dae7b5f5661dc2892fb53b5";s:4:"name";s:26:"docs/html/media/banner.css";s:4:"role";s:3:"doc";s:12:"installed_as";s:66:"/usr/local/lib/php/doc/Structures_Graph/docs/html/media/banner.css";}s:30:"docs/html/media/stylesheet.css";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"8ff124484e8a009f94a8d0b4d9b8b1cd";s:4:"name";s:30:"docs/html/media/stylesheet.css";s:4:"role";s:3:"doc";s:12:"installed_as";s:70:"/usr/local/lib/php/doc/Structures_Graph/docs/html/media/stylesheet.css";}s:48:"docs/html/Structures_Graph/Structures_Graph.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"a17210dd27171316f5cb446a5bef59ab";s:4:"name";s:48:"docs/html/Structures_Graph/Structures_Graph.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:88:"/usr/local/lib/php/doc/Structures_Graph/docs/html/Structures_Graph/Structures_Graph.html";}s:72:"docs/html/Structures_Graph/Structures_Graph_Manipulator_AcyclicTest.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"1ed0ac55530b7504c00df35f335e7ef3";s:4:"name";s:72:"docs/html/Structures_Graph/Structures_Graph_Manipulator_AcyclicTest.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:112:"/usr/local/lib/php/doc/Structures_Graph/docs/html/Structures_Graph/Structures_Graph_Manipulator_AcyclicTest.html";}s:78:"docs/html/Structures_Graph/Structures_Graph_Manipulator_TopologicalSorter.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"fefb65755d57a87d2736e058a1095b03";s:4:"name";s:78:"docs/html/Structures_Graph/Structures_Graph_Manipulator_TopologicalSorter.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:118:"/usr/local/lib/php/doc/Structures_Graph/docs/html/Structures_Graph/Structures_Graph_Manipulator_TopologicalSorter.html";}s:53:"docs/html/Structures_Graph/Structures_Graph_Node.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"afb0e3afb91beafd1bc16a07ac31c826";s:4:"name";s:53:"docs/html/Structures_Graph/Structures_Graph_Node.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:93:"/usr/local/lib/php/doc/Structures_Graph/docs/html/Structures_Graph/Structures_Graph_Node.html";}s:61:"docs/html/Structures_Graph/tutorial_Structures_Graph.pkg.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"3fa477998b281061361c4d98fb78c3a8";s:4:"name";s:61:"docs/html/Structures_Graph/tutorial_Structures_Graph.pkg.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:101:"/usr/local/lib/php/doc/Structures_Graph/docs/html/Structures_Graph/tutorial_Structures_Graph.pkg.html";}s:77:"docs/html/Structures_Graph/_Structures_Graph_Manipulator_AcyclicTest_php.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"c46e6566be5249811667ddc7decf405f";s:4:"name";s:77:"docs/html/Structures_Graph/_Structures_Graph_Manipulator_AcyclicTest_php.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:117:"/usr/local/lib/php/doc/Structures_Graph/docs/html/Structures_Graph/_Structures_Graph_Manipulator_AcyclicTest_php.html";}s:83:"docs/html/Structures_Graph/_Structures_Graph_Manipulator_TopologicalSorter_php.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"c45890d45dd42dc56adb71988c3a45c1";s:4:"name";s:83:"docs/html/Structures_Graph/_Structures_Graph_Manipulator_TopologicalSorter_php.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:123:"/usr/local/lib/php/doc/Structures_Graph/docs/html/Structures_Graph/_Structures_Graph_Manipulator_TopologicalSorter_php.html";}s:58:"docs/html/Structures_Graph/_Structures_Graph_Node_php.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"09cb6d17f96553bfb66b99c502676844";s:4:"name";s:58:"docs/html/Structures_Graph/_Structures_Graph_Node_php.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:98:"/usr/local/lib/php/doc/Structures_Graph/docs/html/Structures_Graph/_Structures_Graph_Node_php.html";}s:53:"docs/html/Structures_Graph/_Structures_Graph_php.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"78e1e7ec43a6e754cf4d5dace48fe18c";s:4:"name";s:53:"docs/html/Structures_Graph/_Structures_Graph_php.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:93:"/usr/local/lib/php/doc/Structures_Graph/docs/html/Structures_Graph/_Structures_Graph_php.html";}s:42:"docs/html/classtrees_Structures_Graph.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"d0ada99c3b7e95b23461cc3e713f0c3d";s:4:"name";s:42:"docs/html/classtrees_Structures_Graph.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:82:"/usr/local/lib/php/doc/Structures_Graph/docs/html/classtrees_Structures_Graph.html";}s:27:"docs/html/elementindex.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"898dd26ccc1c1572d36e9879afcb5d39";s:4:"name";s:27:"docs/html/elementindex.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:67:"/usr/local/lib/php/doc/Structures_Graph/docs/html/elementindex.html";}s:44:"docs/html/elementindex_Structures_Graph.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"19dd287d44163d2abde1a1d8d52521f8";s:4:"name";s:44:"docs/html/elementindex_Structures_Graph.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:84:"/usr/local/lib/php/doc/Structures_Graph/docs/html/elementindex_Structures_Graph.html";}s:21:"docs/html/errors.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"ae809f6ebbf632351648c340d2d6acd4";s:4:"name";s:21:"docs/html/errors.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:61:"/usr/local/lib/php/doc/Structures_Graph/docs/html/errors.html";}s:20:"docs/html/index.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"db3206e7d176ae78fd04f22acead5ffa";s:4:"name";s:20:"docs/html/index.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:60:"/usr/local/lib/php/doc/Structures_Graph/docs/html/index.html";}s:34:"docs/html/li_Structures_Graph.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"4ec087627323546610b64d69a6aafca6";s:4:"name";s:34:"docs/html/li_Structures_Graph.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:74:"/usr/local/lib/php/doc/Structures_Graph/docs/html/li_Structures_Graph.html";}s:23:"docs/html/packages.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"005081a4c5d60afcbabc1f4909ebfcad";s:4:"name";s:23:"docs/html/packages.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:63:"/usr/local/lib/php/doc/Structures_Graph/docs/html/packages.html";}s:23:"docs/html/todolist.html";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"a7a1b748bbda6dfa1632bf6078fc8bb6";s:4:"name";s:23:"docs/html/todolist.html";s:4:"role";s:3:"doc";s:12:"installed_as";s:63:"/usr/local/lib/php/doc/Structures_Graph/docs/html/todolist.html";}s:52:"docs/tutorials/Structures_Graph/Structures_Graph.pkg";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"628eb6532a8047bf5962fe24c1c245df";s:4:"name";s:52:"docs/tutorials/Structures_Graph/Structures_Graph.pkg";s:4:"role";s:3:"doc";s:12:"installed_as";s:92:"/usr/local/lib/php/doc/Structures_Graph/docs/tutorials/Structures_Graph/Structures_Graph.pkg";}s:16:"docs/generate.sh";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"ce2da39dbb75e21074eb5e96231a3379";s:4:"name";s:16:"docs/generate.sh";s:4:"role";s:3:"doc";s:12:"installed_as";s:56:"/usr/local/lib/php/doc/Structures_Graph/docs/generate.sh";}s:44:"Structures/Graph/Manipulator/AcyclicTest.php";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"f0aff5a1efd188d63b4b8b9e9e840b97";s:4:"name";s:44:"Structures/Graph/Manipulator/AcyclicTest.php";s:4:"role";s:3:"php";s:12:"installed_as";s:63:"/usr/local/lib/php/Structures/Graph/Manipulator/AcyclicTest.php";}s:50:"Structures/Graph/Manipulator/TopologicalSorter.php";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"0492e677436d29228df93dca23629e06";s:4:"name";s:50:"Structures/Graph/Manipulator/TopologicalSorter.php";s:4:"role";s:3:"php";s:12:"installed_as";s:69:"/usr/local/lib/php/Structures/Graph/Manipulator/TopologicalSorter.php";}s:25:"Structures/Graph/Node.php";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"7e28e01ebfa273e5df2eb1ef7a356635";s:4:"name";s:25:"Structures/Graph/Node.php";s:4:"role";s:3:"php";s:12:"installed_as";s:44:"/usr/local/lib/php/Structures/Graph/Node.php";}s:20:"Structures/Graph.php";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"4f25a6275af156f6f8e7b4309cb9f40d";s:4:"name";s:20:"Structures/Graph.php";s:4:"role";s:3:"php";s:12:"installed_as";s:39:"/usr/local/lib/php/Structures/Graph.php";}s:29:"tests/testCase/BasicGraph.php";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"63dfc6f0f14e18c13d8a8415c3fe049d";s:4:"name";s:29:"tests/testCase/BasicGraph.php";s:4:"role";s:4:"test";s:12:"installed_as";s:70:"/usr/local/lib/php/test/Structures_Graph/tests/testCase/BasicGraph.php";}s:19:"tests/all-tests.php";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"1b9e35896d229b84601e6754cd44e339";s:4:"name";s:19:"tests/all-tests.php";s:4:"role";s:4:"test";s:12:"installed_as";s:60:"/usr/local/lib/php/test/Structures_Graph/tests/all-tests.php";}s:12:"tests/README";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"d41d8cd98f00b204e9800998ecf8427e";s:4:"name";s:12:"tests/README";s:4:"role";s:4:"test";s:12:"installed_as";s:53:"/usr/local/lib/php/test/Structures_Graph/tests/README";}s:17:"genpackage.xml.pl";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"ab23406ec7bfbb2029ca536378ff57db";s:4:"name";s:17:"genpackage.xml.pl";s:4:"role";s:4:"data";s:12:"installed_as";s:58:"/usr/local/lib/php/data/Structures_Graph/genpackage.xml.pl";}s:7:"LICENSE";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"7fbc338309ac38fefcd64b04bb903e34";s:4:"name";s:7:"LICENSE";s:4:"role";s:4:"data";s:12:"installed_as";s:48:"/usr/local/lib/php/data/Structures_Graph/LICENSE";}s:10:"package.sh";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"6e782f281c7d0ce27e54b574247073cb";s:4:"name";s:10:"package.sh";s:4:"role";s:4:"data";s:12:"installed_as";s:51:"/usr/local/lib/php/data/Structures_Graph/package.sh";}s:10:"publish.sh";a:5:{s:14:"baseinstalldir";s:0:"";s:6:"md5sum";s:32:"b81f67f7b5600231735243be73625e54";s:4:"name";s:10:"publish.sh";s:4:"role";s:4:"data";s:12:"installed_as";s:51:"/usr/local/lib/php/data/Structures_Graph/publish.sh";}}s:12:"_lastversion";N;s:7:"dirtree";a:14:{s:55:"/usr/local/lib/php/doc/Structures_Graph/docs/html/media";b:1;s:49:"/usr/local/lib/php/doc/Structures_Graph/docs/html";b:1;s:44:"/usr/local/lib/php/doc/Structures_Graph/docs";b:1;s:39:"/usr/local/lib/php/doc/Structures_Graph";b:1;s:66:"/usr/local/lib/php/doc/Structures_Graph/docs/html/Structures_Graph";b:1;s:71:"/usr/local/lib/php/doc/Structures_Graph/docs/tutorials/Structures_Graph";b:1;s:54:"/usr/local/lib/php/doc/Structures_Graph/docs/tutorials";b:1;s:47:"/usr/local/lib/php/Structures/Graph/Manipulator";b:1;s:35:"/usr/local/lib/php/Structures/Graph";b:1;s:29:"/usr/local/lib/php/Structures";b:1;s:55:"/usr/local/lib/php/test/Structures_Graph/tests/testCase";b:1;s:46:"/usr/local/lib/php/test/Structures_Graph/tests";b:1;s:40:"/usr/local/lib/php/test/Structures_Graph";b:1;s:40:"/usr/local/lib/php/data/Structures_Graph";b:1;}s:3:"old";a:7:{s:7:"version";s:5:"1.0.2";s:12:"release_date";s:10:"2007-02-01";s:13:"release_state";s:6:"stable";s:15:"release_license";s:4:"LGPL";s:13:"release_notes";s:130:"- Bug #9682 only variables can be returned by reference
- fix Bug #9661 notice in Structures_Graph_Manipulator_Topological::sort()";s:12:"release_deps";a:2:{i:0;a:4:{s:4:"type";s:3:"php";s:3:"rel";s:2:"ge";s:7:"version";s:5:"4.2.0";s:8:"optional";s:2:"no";}i:1;a:6:{s:4:"type";s:3:"pkg";s:7:"channel";s:12:"pear.php.net";s:4:"name";s:4:"PEAR";s:3:"rel";s:2:"ge";s:7:"version";s:5:"1.4.3";s:8:"optional";s:2:"no";}}s:11:"maintainers";a:1:{i:0;a:5:{s:4:"name";s:16:"S√©rgio Carvalho";s:5:"email";s:32:"sergio.carvalho@portugalmail.com";s:6:"active";s:3:"yes";s:6:"handle";s:9:"sergiosgc";s:4:"role";s:4:"lead";}}}s:10:"xsdversion";s:3:"2.0";s:13:"_lastmodified";i:1218735264;}a:24:{s:7:"attribs";a:6:{s:15:"packagerversion";s:8:"1.8.0RC1";s:7:"version";s:3:"2.0";s:5:"xmlns";s:35:"http://pear.php.net/dtd/package-2.0";s:11:"xmlns:tasks";s:33:"http://pear.php.net/dtd/tasks-1.0";s:9:"xmlns:xsi";s:41:"http://www.w3.org/2001/XMLSchema-instance";s:18:"xsi:schemaLocation";s:147:"http://pear.php.net/dtd/tasks-1.0 http://pear.php.net/dtd/tasks-1.0.xsd http://pear.php.net/dtd/package-2.0 http://pear.php.net/dtd/package-2.0.xsd";}s:4:"name";s:11:"Archive_Tar";s:7:"channel";s:12:"pear.php.net";s:7:"summary";s:25:"Tar file management class";s:11:"description";s:257:"This class provides handling of tar files in PHP.
It supports creating, listing, extracting and adding to tar files.
Gzip support is available if PHP has the zlib extension built-in or
loaded. Bz2 compression is also supported with the bz2 extension loaded.";s:4:"lead";a:2:{i:0;a:4:{s:4:"name";s:14:"Gregory Beaver";s:4:"user";s:6:"cellog";s:5:"email";s:14:"cellog@php.net";s:6:"active";s:3:"yes";}i:1;a:4:{s:4:"name";s:14:"Vincent Blavet";s:4:"user";s:7:"vblavet";s:5:"email";s:22:"vincent@phpconcept.net";s:6:"active";s:2:"no";}}s:6:"helper";a:4:{s:4:"name";s:11:"Stig Bakken";s:4:"user";s:3:"ssb";s:5:"email";s:12:"stig@php.net";s:6:"active";s:2:"no";}s:4:"date";s:10:"2009-03-27";s:4:"time";s:8:"02:37:57";s:7:"version";a:2:{s:7:"release";s:5:"1.3.3";s:3:"api";s:5:"1.3.1";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:50:"http://www.opensource.org/licenses/bsd-license.php";}s:8:"_content";s:15:"New BSD License";}s:5:"notes";s:249:"Change the license to New BSD license

   minor bugfix release
   * fix Bug #9921 compression with bzip2 fails [cellog]
   * fix Bug #11594 _readLongHeader leaves 0 bytes in filename [jamessas]
   * fix Bug #11769 Incorrect symlink handing [fajar99]";s:8:"contents";a:1:{s:3:"dir";a:2:{s:7:"attribs";a:1:{s:4:"name";s:1:"/";}s:4:"file";a:2:{i:0;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:1:"/";s:6:"md5sum";s:32:"d6c6633566e7484aff188f798529b061";s:4:"name";s:15:"Archive/Tar.php";s:4:"role";s:3:"php";}}i:1;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:1:"/";s:6:"md5sum";s:32:"29b03715377b18b1fafcff98a99cc9a7";s:4:"name";s:20:"docs/Archive_Tar.txt";s:4:"role";s:3:"doc";}}}}}s:10:"compatible";a:4:{s:4:"name";s:4:"PEAR";s:7:"channel";s:12:"pear.php.net";s:3:"min";s:5:"1.4.0";s:3:"max";s:8:"1.5.0RC2";}s:12:"dependencies";a:1:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"4.3.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:5:"1.5.4";}}}s:10:"phprelease";s:0:"";s:9:"changelog";a:1:{s:7:"release";a:11:{i:0;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"1.3.2";s:3:"api";s:5:"1.3.1";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2007-01-03";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:484:"Correct Bug #4016
Remove duplicate remove error display with '@'
Correct Bug #3909 : Check existence of OS_WINDOWS constant
Correct Bug #5452 fix for "lone zero block" when untarring packages
Change filemode (from pear-core/Archive/Tar.php v.1.21)
Correct Bug #6486 Can not extract symlinks
Correct Bug #6933 Archive_Tar (Tar file management class) Directory traversal
Correct Bug #8114 Files added on-the-fly not storing date
Correct Bug #9352 Bug on _dirCheck function over nfs path";}i:1;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"1.3.1";s:3:"api";s:5:"1.3.1";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2005-03-17";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:17:"Correct Bug #3855";}i:2;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"1.3.0";s:3:"api";s:5:"1.3.0";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2005-03-06";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:40:"Bugs correction (2475, 2488, 2135, 2176)";}i:3;a:5:{s:7:"version";a:2:{s:7:"release";s:3:"1.2";s:3:"api";s:3:"1.2";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2004-05-08";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:71:"Add support for other separator than the space char and bug
	correction";}i:4;a:5:{s:7:"version";a:2:{s:7:"release";s:3:"1.1";s:3:"api";s:3:"1.1";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2003-05-28";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:141:"* Add support for BZ2 compression
* Add support for add and extract without using temporary files : methods addString() and extractInString()";}i:5;a:5:{s:7:"version";a:2:{s:7:"release";s:3:"1.0";s:3:"api";s:3:"1.0";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2003-01-24";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:23:"Change status to stable";}i:6;a:5:{s:7:"version";a:2:{s:7:"release";s:7:"0.10-b1";s:3:"api";s:7:"0.10-b1";}s:9:"stability";a:2:{s:7:"release";s:4:"beta";s:3:"api";s:4:"beta";}s:4:"date";s:10:"2003-01-08";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:59:"Add support for long filenames (greater than 99 characters)";}i:7;a:5:{s:7:"version";a:2:{s:7:"release";s:3:"0.9";s:3:"api";s:3:"0.9";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2002-05-27";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:25:"Auto-detect gzip'ed files";}i:8;a:5:{s:7:"version";a:2:{s:7:"release";s:3:"0.4";s:3:"api";s:3:"0.4";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2002-05-20";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:51:"Windows bugfix: use forward slashes inside archives";}i:9;a:5:{s:7:"version";a:2:{s:7:"release";s:3:"0.2";s:3:"api";s:3:"0.2";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2002-02-18";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:29:"From initial commit to stable";}i:10;a:5:{s:7:"version";a:2:{s:7:"release";s:3:"0.3";s:3:"api";s:3:"0.3";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2002-04-13";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:47:"Windows bugfix: used wrong directory separators";}}}s:8:"filelist";a:2:{s:15:"Archive/Tar.php";a:5:{s:14:"baseinstalldir";s:1:"/";s:6:"md5sum";s:32:"d6c6633566e7484aff188f798529b061";s:4:"name";s:15:"Archive/Tar.php";s:4:"role";s:3:"php";s:12:"installed_as";s:34:"/usr/local/lib/php/Archive/Tar.php";}s:20:"docs/Archive_Tar.txt";a:5:{s:14:"baseinstalldir";s:1:"/";s:6:"md5sum";s:32:"29b03715377b18b1fafcff98a99cc9a7";s:4:"name";s:20:"docs/Archive_Tar.txt";s:4:"role";s:3:"doc";s:12:"installed_as";s:55:"/usr/local/lib/php/doc/Archive_Tar/docs/Archive_Tar.txt";}}s:12:"_lastversion";s:5:"1.3.2";s:7:"dirtree";a:3:{s:26:"/usr/local/lib/php/Archive";b:1;s:39:"/usr/local/lib/php/doc/Archive_Tar/docs";b:1;s:34:"/usr/local/lib/php/doc/Archive_Tar";b:1;}s:3:"old";a:7:{s:7:"version";s:5:"1.3.3";s:12:"release_date";s:10:"2009-03-27";s:13:"release_state";s:6:"stable";s:15:"release_license";s:15:"New BSD License";s:13:"release_notes";s:249:"Change the license to New BSD license

   minor bugfix release
   * fix Bug #9921 compression with bzip2 fails [cellog]
   * fix Bug #11594 _readLongHeader leaves 0 bytes in filename [jamessas]
   * fix Bug #11769 Incorrect symlink handing [fajar99]";s:12:"release_deps";a:2:{i:0;a:4:{s:4:"type";s:3:"php";s:3:"rel";s:2:"ge";s:7:"version";s:5:"4.3.0";s:8:"optional";s:2:"no";}i:1;a:6:{s:4:"type";s:3:"pkg";s:7:"channel";s:12:"pear.php.net";s:4:"name";s:4:"PEAR";s:3:"rel";s:2:"ge";s:7:"version";s:5:"1.5.4";s:8:"optional";s:2:"no";}}s:11:"maintainers";a:3:{i:0;a:5:{s:4:"name";s:14:"Gregory Beaver";s:5:"email";s:14:"cellog@php.net";s:6:"active";s:3:"yes";s:6:"handle";s:6:"cellog";s:4:"role";s:4:"lead";}i:1;a:5:{s:4:"name";s:14:"Vincent Blavet";s:5:"email";s:22:"vincent@phpconcept.net";s:6:"active";s:2:"no";s:6:"handle";s:7:"vblavet";s:4:"role";s:4:"lead";}i:2;a:5:{s:4:"name";s:11:"Stig Bakken";s:5:"email";s:12:"stig@php.net";s:6:"active";s:2:"no";s:6:"handle";s:3:"ssb";s:4:"role";s:6:"helper";}}}s:10:"xsdversion";s:3:"2.0";s:13:"_lastmodified";i:1238188062;}a:23:{s:7:"attribs";a:6:{s:15:"packagerversion";s:5:"1.7.2";s:7:"version";s:3:"2.0";s:5:"xmlns";s:35:"http://pear.php.net/dtd/package-2.0";s:11:"xmlns:tasks";s:33:"http://pear.php.net/dtd/tasks-1.0";s:9:"xmlns:xsi";s:41:"http://www.w3.org/2001/XMLSchema-instance";s:18:"xsi:schemaLocation";s:159:"http://pear.php.net/dtd/tasks-1.0     http://pear.php.net/dtd/tasks-1.0.xsd     http://pear.php.net/dtd/package-2.0     http://pear.php.net/dtd/package-2.0.xsd";}s:4:"name";s:8:"XML_Util";s:7:"channel";s:12:"pear.php.net";s:7:"summary";s:17:"XML utility class";s:11:"description";s:192:"Selection of methods that are often needed when working with XML documents.  Functionality includes creating of attribute lists from arrays, creation of tags, validation of XML names and more.";s:4:"lead";a:2:{i:0;a:4:{s:4:"name";s:13:"Chuck Burgess";s:4:"user";s:7:"ashnazg";s:5:"email";s:15:"ashnazg@php.net";s:6:"active";s:3:"yes";}i:1;a:4:{s:4:"name";s:15:"Stephan Schmidt";s:4:"user";s:5:"schst";s:5:"email";s:19:"schst@php-tools.net";s:6:"active";s:2:"no";}}s:6:"helper";a:4:{s:4:"name";s:12:"Davey Shafik";s:4:"user";s:5:"davey";s:5:"email";s:13:"davey@php.net";s:6:"active";s:2:"no";}s:4:"date";s:10:"2008-12-07";s:4:"time";s:8:"19:41:10";s:7:"version";a:2:{s:7:"release";s:5:"1.2.1";s:3:"api";s:5:"1.2.0";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:42:"http://opensource.org/licenses/bsd-license";}s:8:"_content";s:11:"BSD License";}s:5:"notes";s:68:"Fixed Bug #14760: Bug in getDocTypeDeclaration() [ashnazg|fpospisil]";s:8:"contents";a:1:{s:3:"dir";a:2:{s:7:"attribs";a:2:{s:14:"baseinstalldir";s:3:"XML";s:4:"name";s:1:"/";}s:4:"file";a:22:{i:0;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"06b6662b91b1a466e7b5113f37d4725f";s:4:"name";s:20:"examples/example.php";s:4:"role";s:3:"doc";}}i:1;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"77355702c9e861d3fc0a5318ea689eee";s:4:"name";s:21:"examples/example2.php";s:4:"role";s:3:"doc";}}i:2;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"0af0cff09232a6c275803bb36213cdd9";s:4:"name";s:18:"tests/AllTests.php";s:4:"role";s:4:"test";}}i:3;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"73088689d58b71cd4f86013c88b72216";s:4:"name";s:31:"tests/testBasic_apiVersion.phpt";s:4:"role";s:4:"test";}}i:4;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"4b17c0df7fbfb1bb2f3f636ebd6c2cbd";s:4:"name";s:39:"tests/testBasic_attributesToString.phpt";s:4:"role";s:4:"test";}}i:5;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"dc4202f1451bbeb62a5bc7d56a7c774c";s:4:"name";s:38:"tests/testBasic_collapseEmptyTags.phpt";s:4:"role";s:4:"test";}}i:6;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"4c87fda94fdfb7a78ba84998d6e28f45";s:4:"name";s:39:"tests/testBasic_createCDataSection.phpt";s:4:"role";s:4:"test";}}i:7;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"c101844768f146653c59c81978060158";s:4:"name";s:34:"tests/testBasic_createComment.phpt";s:4:"role";s:4:"test";}}i:8;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"ba75d66c2f0fb0010c71f3bcd1f64eb2";s:4:"name";s:37:"tests/testBasic_createEndElement.phpt";s:4:"role";s:4:"test";}}i:9;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"ad786fb687e1eea1f6890a7424709c79";s:4:"name";s:39:"tests/testBasic_createStartElement.phpt";s:4:"role";s:4:"test";}}i:10;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"5f453edadebaa3435c8e6f09a3aaaa9c";s:4:"name";s:30:"tests/testBasic_createTag.phpt";s:4:"role";s:4:"test";}}i:11;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"d2792da0d9c5f0987ee4587912017aa9";s:4:"name";s:39:"tests/testBasic_createTagFromArray.phpt";s:4:"role";s:4:"test";}}i:12;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"817882a0ab33e60f17ee71874ad975f0";s:4:"name";s:42:"tests/testBasic_getDocTypeDeclaration.phpt";s:4:"role";s:4:"test";}}i:13;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"5bc1926a488a6b63ec6366bfcf06a50a";s:4:"name";s:38:"tests/testBasic_getXmlDeclaration.phpt";s:4:"role";s:4:"test";}}i:14;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"a727860d55c14194fdaffa839a59a540";s:4:"name";s:32:"tests/testBasic_isValidName.phpt";s:4:"role";s:4:"test";}}i:15;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"300a6192f7cc6f7bc3d8f2576b51e4b0";s:4:"name";s:31:"tests/testBasic_raiseError.phpt";s:4:"role";s:4:"test";}}i:16;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"e6717d43001775cccd52bd5195cf02e0";s:4:"name";s:36:"tests/testBasic_replaceEntities.phpt";s:4:"role";s:4:"test";}}i:17;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"431856aa83a23396a9f00915dd2be192";s:4:"name";s:36:"tests/testBasic_reverseEntities.phpt";s:4:"role";s:4:"test";}}i:18;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"ab035534463cae8cc903e907aead8ffe";s:4:"name";s:39:"tests/testBasic_splitQualifiedName.phpt";s:4:"role";s:4:"test";}}i:19;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"1850856692ff6c6df5e8acb16e1080ce";s:4:"name";s:23:"tests/testBug_4950.phpt";s:4:"role";s:4:"test";}}i:20;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"b4127883df40a4b0d1736ad42215ee25";s:4:"name";s:23:"tests/testBug_5392.phpt";s:4:"role";s:4:"test";}}i:21;a:2:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"9bb265dafaaf06c86ca5c48f50368ded";s:4:"name";s:8:"Util.php";s:4:"role";s:3:"php";}s:13:"tasks:replace";a:1:{s:7:"attribs";a:3:{s:4:"from";s:9:"@version@";s:2:"to";s:7:"version";s:4:"type";s:12:"package-info";}}}}}}s:12:"dependencies";a:1:{s:8:"required";a:3:{s:3:"php";a:1:{s:3:"min";s:5:"4.3.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:5:"1.4.3";}s:9:"extension";a:1:{s:4:"name";s:4:"pcre";}}}s:10:"phprelease";s:0:"";s:9:"changelog";a:1:{s:7:"release";a:22:{i:0;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"1.2.1";s:3:"api";s:5:"1.2.0";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2008-12-07";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:42:"http://opensource.org/licenses/bsd-license";}s:8:"_content";s:11:"BSD License";}s:5:"notes";s:68:"Fixed Bug #14760: Bug in getDocTypeDeclaration() [ashnazg|fpospisil]";}i:1;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"1.2.0";s:3:"api";s:5:"1.2.0";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2008-07-26";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:42:"http://opensource.org/licenses/bsd-license";}s:8:"_content";s:11:"BSD License";}s:5:"notes";s:403:"Changed license to New BSD License (Req #13826 [ashnazg])
Added a test suite against all API methods [ashnazg]
Switch to package.xml v2 [ashnazg]
Added Req #13839: Missing XHTML empty tags to collapse [ashnazg|drry]
Fixed Bug #5392: encoding of ISO-8859-1 is the only supported encoding [ashnazg]
Fixed Bug #4950: Incorrect CDATA serializing [ashnazg|drry]
-- (this fix differs from the one in v1.2.0a1)";}i:2;a:5:{s:7:"version";a:2:{s:7:"release";s:8:"1.2.0RC1";s:3:"api";s:5:"1.2.0";}s:9:"stability";a:2:{s:7:"release";s:4:"beta";s:3:"api";s:4:"beta";}s:4:"date";s:10:"2008-07-12";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:42:"http://opensource.org/licenses/bsd-license";}s:8:"_content";s:11:"BSD License";}s:5:"notes";s:403:"Changed license to New BSD License (Req #13826 [ashnazg])
Added a test suite against all API methods [ashnazg]
Switch to package.xml v2 [ashnazg]
Added Req #13839: Missing XHTML empty tags to collapse [ashnazg|drry]
Fixed Bug #5392: encoding of ISO-8859-1 is the only supported encoding [ashnazg]
Fixed Bug #4950: Incorrect CDATA serializing [ashnazg|drry]
-- (this fix differs from the one in v1.2.0a1)";}i:3;a:5:{s:7:"version";a:2:{s:7:"release";s:7:"1.2.0a2";s:3:"api";s:5:"1.2.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2008-05-22";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:42:"http://opensource.org/licenses/bsd-license";}s:8:"_content";s:11:"BSD License";}s:5:"notes";s:403:"Changed license to New BSD License (Req #13826 [ashnazg])
Added a test suite against all API methods [ashnazg]
Switch to package.xml v2 [ashnazg]
Added Req #13839: Missing XHTML empty tags to collapse [ashnazg|drry]
Fixed Bug #5392: encoding of ISO-8859-1 is the only supported encoding [ashnazg]
Fixed Bug #4950: Incorrect CDATA serializing [ashnazg|drry]
-- (this fix differs from the one in v1.2.0a1)";}i:4;a:5:{s:7:"version";a:2:{s:7:"release";s:7:"1.2.0a1";s:3:"api";s:5:"1.2.0";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2008-05-04";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:42:"http://opensource.org/licenses/bsd-license";}s:8:"_content";s:11:"BSD License";}s:5:"notes";s:208:"Changed license to New BSD License (Req #13826 [ashnazg])
Added a test suite against all API methods [ashnazg]
Switch to package.xml v2 [ashnazg]
Fixed Bug #4950: Incorrect CDATA serializing [ashnazg|ja.doma]";}i:5;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"1.1.4";s:3:"api";s:5:"1.1.4";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2006-12-16";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:61:"- Fixed bug #9561: Not allowing underscores in middle of tags";}i:6;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"1.1.2";s:3:"api";s:5:"1.1.2";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2006-12-01";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:207:"- fixed bug #5419: isValidName() now checks for character classes
- implemented request #8196: added optional parameter to influence array sorting to createTag() createTagFromArray() and createStartElement()";}i:7;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"1.1.1";s:3:"api";s:5:"1.1.1";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2004-12-23";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:306:"- fixed bug in replaceEntities() and reverseEntities() in conjunction with XML_UTIL_ENTITIES_HTML
- createTag() and createTagFromArray() now accept XML_UTIL_ENTITIES_XML, XML_UTIL_ENTITIES_XML_REQUIRED, XML_UTIL_ENTITIES_HTML, XML_UTIL_ENTITIES_NONE and XML_UTIL_CDATA_SECTION as $replaceEntities parameter";}i:8;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"1.1.0";s:3:"api";s:5:"1.1.0";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2004-11-19";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:73:"- Added collapseEmptyTags (patch by Sebastian Bergmann and Thomas Duffey)";}i:9;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"1.0.0";s:3:"api";s:5:"1.0.0";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2004-10-28";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:41:"- Added reverseEntities() (request #2639)";}i:10;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.6.1";s:3:"api";s:5:"0.6.1";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2004-10-28";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:103:"- Added check for tag name (either as local part or qualified name) in createTagFromArray() (bug #1083)";}i:11;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.6.0";s:3:"api";s:5:"0.6.0";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2004-06-07";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:567:"- Fixed bug 1438 (namespaces not accepted for isValidName()) (thanks to davey)
- added optional parameter to replaceEntities() to define the set of entities to replace
- added optional parameter to attributesToString() to define, whether entities should be replaced (requested by Sebastian Bergmann)
- allowed second parameter to XML_Util::attributesToString() to be an array containing options (easier to use, if you only need to set the last parameter)
- introduced XML_Util::raiseError() to avoid the necessity of including PEAR.php, will only be included on error";}i:12;a:5:{s:7:"version";a:2:{s:7:"release";s:10:"0.6.0beta1";s:3:"api";s:10:"0.6.0beta1";}s:9:"stability";a:2:{s:7:"release";s:4:"beta";s:3:"api";s:4:"beta";}s:4:"date";s:10:"2004-05-24";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:567:"- Fixed bug 1438 (namespaces not accepted for isValidName()) (thanks to davey)
- added optional parameter to replaceEntities() to define the set of entities to replace
- added optional parameter to attributesToString() to define, whether entities should be replaced (requested by Sebastian Bergmann)
- allowed second parameter to XML_Util::attributesToString() to be an array containing options (easier to use, if you only need to set the last parameter)
- introduced XML_Util::raiseError() to avoid the necessity of including PEAR.php, will only be included on error";}i:13;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.5.2";s:3:"api";s:5:"0.5.2";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2003-11-22";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:78:"now creates XHTML compliant empty tags (Davey),
minor whitespace fixes (Davey)";}i:14;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.5.1";s:3:"api";s:5:"0.5.1";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2003-09-26";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:102:"added default namespace parameter (optional) in splitQualifiedName() (requested by Sebastian Bergmann)";}i:15;a:5:{s:7:"version";a:2:{s:7:"release";s:3:"0.5";s:3:"api";s:3:"0.5";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2003-09-23";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:170:"added support for multiline attributes in attributesToString(), createTag*() and createStartElement (requested by Yavor Shahpasov for XML_Serializer),
added createComment";}i:16;a:5:{s:7:"version";a:2:{s:7:"release";s:3:"0.4";s:3:"api";s:3:"0.4";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2003-09-21";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:132:"added createCDataSection(),
added support for CData sections in createTag* methods,
fixed bug #23,
fixed bug in splitQualifiedName()";}i:17;a:5:{s:7:"version";a:2:{s:7:"release";s:3:"0.3";s:3:"api";s:3:"0.3";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2003-09-12";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:49:"added createStartElement() and createEndElement()";}i:18;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.2.1";s:3:"api";s:5:"0.2.1";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2003-09-05";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:70:"fixed bug with zero as tag content in createTagFromArray and createTag";}i:19;a:5:{s:7:"version";a:2:{s:7:"release";s:3:"0.2";s:3:"api";s:3:"0.2";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2003-08-12";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:39:"added XML_Util::getDocTypeDeclaration()";}i:20;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.1.1";s:3:"api";s:5:"0.1.1";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2003-08-02";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:41:"bugfix: removed bug in createTagFromArray";}i:21;a:5:{s:7:"version";a:2:{s:7:"release";s:3:"0.1";s:3:"api";s:3:"0.1";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2003-08-01";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:26:"http://www.php.net/license";}s:8:"_content";s:11:"PHP License";}s:5:"notes";s:14:"inital release";}}}s:8:"filelist";a:22:{s:20:"examples/example.php";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"06b6662b91b1a466e7b5113f37d4725f";s:4:"name";s:20:"examples/example.php";s:4:"role";s:3:"doc";s:12:"installed_as";s:52:"/usr/local/lib/php/doc/XML_Util/examples/example.php";}s:21:"examples/example2.php";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"77355702c9e861d3fc0a5318ea689eee";s:4:"name";s:21:"examples/example2.php";s:4:"role";s:3:"doc";s:12:"installed_as";s:53:"/usr/local/lib/php/doc/XML_Util/examples/example2.php";}s:18:"tests/AllTests.php";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"0af0cff09232a6c275803bb36213cdd9";s:4:"name";s:18:"tests/AllTests.php";s:4:"role";s:4:"test";s:12:"installed_as";s:51:"/usr/local/lib/php/test/XML_Util/tests/AllTests.php";}s:31:"tests/testBasic_apiVersion.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"73088689d58b71cd4f86013c88b72216";s:4:"name";s:31:"tests/testBasic_apiVersion.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:64:"/usr/local/lib/php/test/XML_Util/tests/testBasic_apiVersion.phpt";}s:39:"tests/testBasic_attributesToString.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"4b17c0df7fbfb1bb2f3f636ebd6c2cbd";s:4:"name";s:39:"tests/testBasic_attributesToString.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:72:"/usr/local/lib/php/test/XML_Util/tests/testBasic_attributesToString.phpt";}s:38:"tests/testBasic_collapseEmptyTags.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"dc4202f1451bbeb62a5bc7d56a7c774c";s:4:"name";s:38:"tests/testBasic_collapseEmptyTags.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:71:"/usr/local/lib/php/test/XML_Util/tests/testBasic_collapseEmptyTags.phpt";}s:39:"tests/testBasic_createCDataSection.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"4c87fda94fdfb7a78ba84998d6e28f45";s:4:"name";s:39:"tests/testBasic_createCDataSection.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:72:"/usr/local/lib/php/test/XML_Util/tests/testBasic_createCDataSection.phpt";}s:34:"tests/testBasic_createComment.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"c101844768f146653c59c81978060158";s:4:"name";s:34:"tests/testBasic_createComment.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:67:"/usr/local/lib/php/test/XML_Util/tests/testBasic_createComment.phpt";}s:37:"tests/testBasic_createEndElement.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"ba75d66c2f0fb0010c71f3bcd1f64eb2";s:4:"name";s:37:"tests/testBasic_createEndElement.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:70:"/usr/local/lib/php/test/XML_Util/tests/testBasic_createEndElement.phpt";}s:39:"tests/testBasic_createStartElement.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"ad786fb687e1eea1f6890a7424709c79";s:4:"name";s:39:"tests/testBasic_createStartElement.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:72:"/usr/local/lib/php/test/XML_Util/tests/testBasic_createStartElement.phpt";}s:30:"tests/testBasic_createTag.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"5f453edadebaa3435c8e6f09a3aaaa9c";s:4:"name";s:30:"tests/testBasic_createTag.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:63:"/usr/local/lib/php/test/XML_Util/tests/testBasic_createTag.phpt";}s:39:"tests/testBasic_createTagFromArray.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"d2792da0d9c5f0987ee4587912017aa9";s:4:"name";s:39:"tests/testBasic_createTagFromArray.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:72:"/usr/local/lib/php/test/XML_Util/tests/testBasic_createTagFromArray.phpt";}s:42:"tests/testBasic_getDocTypeDeclaration.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"817882a0ab33e60f17ee71874ad975f0";s:4:"name";s:42:"tests/testBasic_getDocTypeDeclaration.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:75:"/usr/local/lib/php/test/XML_Util/tests/testBasic_getDocTypeDeclaration.phpt";}s:38:"tests/testBasic_getXmlDeclaration.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"5bc1926a488a6b63ec6366bfcf06a50a";s:4:"name";s:38:"tests/testBasic_getXmlDeclaration.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:71:"/usr/local/lib/php/test/XML_Util/tests/testBasic_getXmlDeclaration.phpt";}s:32:"tests/testBasic_isValidName.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"a727860d55c14194fdaffa839a59a540";s:4:"name";s:32:"tests/testBasic_isValidName.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:65:"/usr/local/lib/php/test/XML_Util/tests/testBasic_isValidName.phpt";}s:31:"tests/testBasic_raiseError.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"300a6192f7cc6f7bc3d8f2576b51e4b0";s:4:"name";s:31:"tests/testBasic_raiseError.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:64:"/usr/local/lib/php/test/XML_Util/tests/testBasic_raiseError.phpt";}s:36:"tests/testBasic_replaceEntities.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"e6717d43001775cccd52bd5195cf02e0";s:4:"name";s:36:"tests/testBasic_replaceEntities.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:69:"/usr/local/lib/php/test/XML_Util/tests/testBasic_replaceEntities.phpt";}s:36:"tests/testBasic_reverseEntities.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"431856aa83a23396a9f00915dd2be192";s:4:"name";s:36:"tests/testBasic_reverseEntities.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:69:"/usr/local/lib/php/test/XML_Util/tests/testBasic_reverseEntities.phpt";}s:39:"tests/testBasic_splitQualifiedName.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"ab035534463cae8cc903e907aead8ffe";s:4:"name";s:39:"tests/testBasic_splitQualifiedName.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:72:"/usr/local/lib/php/test/XML_Util/tests/testBasic_splitQualifiedName.phpt";}s:23:"tests/testBug_4950.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"1850856692ff6c6df5e8acb16e1080ce";s:4:"name";s:23:"tests/testBug_4950.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:56:"/usr/local/lib/php/test/XML_Util/tests/testBug_4950.phpt";}s:23:"tests/testBug_5392.phpt";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"b4127883df40a4b0d1736ad42215ee25";s:4:"name";s:23:"tests/testBug_5392.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:56:"/usr/local/lib/php/test/XML_Util/tests/testBug_5392.phpt";}s:8:"Util.php";a:5:{s:14:"baseinstalldir";s:3:"XML";s:6:"md5sum";s:32:"9bb265dafaaf06c86ca5c48f50368ded";s:4:"name";s:8:"Util.php";s:4:"role";s:3:"php";s:12:"installed_as";s:31:"/usr/local/lib/php/XML/Util.php";}}s:12:"_lastversion";N;s:7:"dirtree";a:5:{s:40:"/usr/local/lib/php/doc/XML_Util/examples";b:1;s:31:"/usr/local/lib/php/doc/XML_Util";b:1;s:38:"/usr/local/lib/php/test/XML_Util/tests";b:1;s:32:"/usr/local/lib/php/test/XML_Util";b:1;s:22:"/usr/local/lib/php/XML";b:1;}s:3:"old";a:7:{s:7:"version";s:5:"1.2.1";s:12:"release_date";s:10:"2008-12-07";s:13:"release_state";s:6:"stable";s:15:"release_license";s:11:"BSD License";s:13:"release_notes";s:68:"Fixed Bug #14760: Bug in getDocTypeDeclaration() [ashnazg|fpospisil]";s:12:"release_deps";a:3:{i:0;a:4:{s:4:"type";s:3:"php";s:3:"rel";s:2:"ge";s:7:"version";s:5:"4.3.0";s:8:"optional";s:2:"no";}i:1;a:6:{s:4:"type";s:3:"pkg";s:7:"channel";s:12:"pear.php.net";s:4:"name";s:4:"PEAR";s:3:"rel";s:2:"ge";s:7:"version";s:5:"1.4.3";s:8:"optional";s:2:"no";}i:2;a:4:{s:4:"type";s:3:"ext";s:4:"name";s:4:"pcre";s:3:"rel";s:3:"has";s:8:"optional";s:2:"no";}}s:11:"maintainers";a:3:{i:0;a:5:{s:4:"name";s:13:"Chuck Burgess";s:5:"email";s:15:"ashnazg@php.net";s:6:"active";s:3:"yes";s:6:"handle";s:7:"ashnazg";s:4:"role";s:4:"lead";}i:1;a:5:{s:4:"name";s:15:"Stephan Schmidt";s:5:"email";s:19:"schst@php-tools.net";s:6:"active";s:2:"no";s:6:"handle";s:5:"schst";s:4:"role";s:4:"lead";}i:2;a:5:{s:4:"name";s:12:"Davey Shafik";s:5:"email";s:13:"davey@php.net";s:6:"active";s:2:"no";s:6:"handle";s:5:"davey";s:4:"role";s:6:"helper";}}}s:10:"xsdversion";s:3:"2.0";s:13:"_lastmodified";i:1238188062;}a:22:{s:7:"attribs";a:6:{s:15:"packagerversion";s:5:"1.7.2";s:7:"version";s:3:"2.0";s:5:"xmlns";s:35:"http://pear.php.net/dtd/package-2.0";s:11:"xmlns:tasks";s:33:"http://pear.php.net/dtd/tasks-1.0";s:9:"xmlns:xsi";s:41:"http://www.w3.org/2001/XMLSchema-instance";s:18:"xsi:schemaLocation";s:147:"http://pear.php.net/dtd/tasks-1.0 http://pear.php.net/dtd/tasks-1.0.xsd http://pear.php.net/dtd/package-2.0 http://pear.php.net/dtd/package-2.0.xsd";}s:4:"name";s:9:"Text_Diff";s:7:"channel";s:12:"pear.php.net";s:7:"summary";s:46:"Engine for performing and rendering text diffs";s:11:"description";s:94:"This package provides a text-based diff engine and renderers for multiple diff output formats.";s:4:"lead";a:3:{i:0;a:4:{s:4:"name";s:15:"Chuck Hagenbuch";s:4:"user";s:8:"chagenbu";s:5:"email";s:15:"chuck@horde.org";s:6:"active";s:3:"yes";}i:1;a:4:{s:4:"name";s:13:"Jan Schneider";s:4:"user";s:6:"yunosh";s:5:"email";s:13:"jan@horde.org";s:6:"active";s:3:"yes";}i:2;a:4:{s:4:"name";s:12:"Paul M Jones";s:4:"user";s:7:"pmjones";s:5:"email";s:19:"pmjones@memphis.edu";s:6:"active";s:2:"no";}}s:4:"date";s:10:"2008-09-10";s:4:"time";s:8:"10:52:52";s:7:"version";a:2:{s:7:"release";s:5:"1.1.0";s:3:"api";s:5:"1.1.0";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:47:"http://opensource.org/licenses/lgpl-license.php";}s:8:"_content";s:4:"LGPL";}s:5:"notes";s:234:"* Add countAddedLines() and countDeletedLines() methods (Christian King, PEAR Request #13183).
* Improve string engine if patch data has no header (PEAR Bug #14533).
* Fix autodetection of diff type in string engine (PEAR Bug #14625).";s:8:"contents";a:1:{s:3:"dir";a:2:{s:7:"attribs";a:1:{s:4:"name";s:1:"/";}s:4:"file";a:35:{i:0;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"b30ce3240eed85e2114b93e28095af90";s:4:"name";s:22:"Diff/Engine/native.php";s:4:"role";s:3:"php";}}i:1;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"4ccb7b5ea80041fcd6e5c5cd958931fa";s:4:"name";s:21:"Diff/Engine/shell.php";s:4:"role";s:3:"php";}}i:2;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"1daaca651ed46e5711b43e47e91e077f";s:4:"name";s:22:"Diff/Engine/string.php";s:4:"role";s:3:"php";}}i:3;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"05f00fc5c59664199eb533ff825a386c";s:4:"name";s:21:"Diff/Engine/xdiff.php";s:4:"role";s:3:"php";}}i:4;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"1263babf64df086001944b699014e59d";s:4:"name";s:25:"Diff/Renderer/context.php";s:4:"role";s:3:"php";}}i:5;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"e001548ef0b37702633a421cf7eed83d";s:4:"name";s:24:"Diff/Renderer/inline.php";s:4:"role";s:3:"php";}}i:6;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"c4dbae31ce515995100f6ad27a8c9c4e";s:4:"name";s:25:"Diff/Renderer/unified.php";s:4:"role";s:3:"php";}}i:7;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"96b1dc3ba33aba32a4b5662b22d8b58a";s:4:"name";s:15:"Diff/Mapped.php";s:4:"role";s:3:"php";}}i:8;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"d5ac2cccaacad465caa41fae23eae8ad";s:4:"name";s:17:"Diff/Renderer.php";s:4:"role";s:3:"php";}}i:9;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"abf74995fef0ba23d50dfc6a5652b5e1";s:4:"name";s:17:"Diff/ThreeWay.php";s:4:"role";s:3:"php";}}i:10;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"5fbdf5388905ed07026b876126aeee5a";s:4:"name";s:19:"docs/examples/1.txt";s:4:"role";s:3:"doc";}}i:11;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"011c4dad4506a4843ded1f12cab69909";s:4:"name";s:19:"docs/examples/2.txt";s:4:"role";s:3:"doc";}}i:12;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"6082891c438ee1ba70fd89b9b4e241e8";s:4:"name";s:22:"docs/examples/diff.php";s:4:"role";s:3:"doc";}}i:13;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"5fbdf5388905ed07026b876126aeee5a";s:4:"name";s:11:"tests/1.txt";s:4:"role";s:4:"test";}}i:14;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"011c4dad4506a4843ded1f12cab69909";s:4:"name";s:11:"tests/2.txt";s:4:"role";s:4:"test";}}i:15;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"308bfdcfb801c46d41d5d24b9fe003f4";s:4:"name";s:11:"tests/3.txt";s:4:"role";s:4:"test";}}i:16;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"76af0d7919f307177aef831e62e48640";s:4:"name";s:11:"tests/4.txt";s:4:"role";s:4:"test";}}i:17;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"ea33106f5d970bf5dc318b752c95e343";s:4:"name";s:11:"tests/5.txt";s:4:"role";s:4:"test";}}i:18;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"38f7931505de496d7312a830b2880f2c";s:4:"name";s:11:"tests/6.txt";s:4:"role";s:4:"test";}}i:19;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"aa40a9c049e89eb8c6f5b0f47e1aabd9";s:4:"name";s:19:"tests/context.patch";s:4:"role";s:4:"test";}}i:20;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"b0143ef7d5e9a1ace0ff747165f27c1f";s:4:"name";s:18:"tests/context.phpt";s:4:"role";s:4:"test";}}i:21;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"2a88e4c49d51bbdced9a4bd8a8a657c5";s:4:"name";s:19:"tests/context2.phpt";s:4:"role";s:4:"test";}}i:22;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"43e8b69ff75bc0e7ecab5b4e87827d19";s:4:"name";s:15:"tests/diff.phpt";s:4:"role";s:4:"test";}}i:23;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"2c2f13e357f691f3922d07f6e70fa43d";s:4:"name";s:17:"tests/inline.phpt";s:4:"role";s:4:"test";}}i:24;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"05e94365c047905009b1913a3600036f";s:4:"name";s:18:"tests/inline2.phpt";s:4:"role";s:4:"test";}}i:25;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"e05b5cf54cfaf541663fa802724e9549";s:4:"name";s:24:"tests/pear_bug12740.phpt";s:4:"role";s:4:"test";}}i:26;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"7949426acc1e64d6c10338bf6382257d";s:4:"name";s:23:"tests/pear_bug4879.phpt";s:4:"role";s:4:"test";}}i:27;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"7fb3cda23ca78409f72ac233784ff1a1";s:4:"name";s:23:"tests/pear_bug6251.phpt";s:4:"role";s:4:"test";}}i:28;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"c4d40a654a584d3f939dca33fff0a5c4";s:4:"name";s:23:"tests/pear_bug6428.phpt";s:4:"role";s:4:"test";}}i:29;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"e7011d4030f4a020d24efb6f1673a1bc";s:4:"name";s:17:"tests/string.phpt";s:4:"role";s:4:"test";}}i:30;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"359096964862ff26e28cc44609ca237f";s:4:"name";s:19:"tests/unified.patch";s:4:"role";s:4:"test";}}i:31;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"77977a033a539c5ccadaf728b95a1a2c";s:4:"name";s:18:"tests/unified.phpt";s:4:"role";s:4:"test";}}i:32;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"dab2830cf62f341f1046b883948c1851";s:4:"name";s:19:"tests/unified2.phpt";s:4:"role";s:4:"test";}}i:33;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"3f715ec0e86162bddc1ea794a04aa4d3";s:4:"name";s:8:"Diff.php";s:4:"role";s:3:"php";}}i:34;a:1:{s:7:"attribs";a:4:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"7b57773de584d2408214cb2c7a0d0a2e";s:4:"name";s:9:"Diff3.php";s:4:"role";s:3:"php";}}}}}s:12:"dependencies";a:2:{s:8:"required";a:2:{s:3:"php";a:1:{s:3:"min";s:5:"4.2.0";}s:13:"pearinstaller";a:1:{s:3:"min";s:7:"1.4.0b1";}}s:8:"optional";a:1:{s:9:"extension";a:1:{s:4:"name";s:5:"xdiff";}}}s:10:"phprelease";s:0:"";s:9:"changelog";a:1:{s:7:"release";a:13:{i:0;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"1.0.0";s:3:"api";s:5:"1.0.0";}s:9:"stability";a:2:{s:7:"release";s:6:"stable";s:3:"api";s:6:"stable";}s:4:"date";s:10:"2008-01-31";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:47:"http://opensource.org/licenses/lgpl-license.php";}s:8:"_content";s:4:"LGPL";}s:5:"notes";s:49:"* Stable release; final non-bugfix PHP 4 release.";}i:1;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.3.2";s:3:"api";s:5:"0.3.0";}s:9:"stability";a:2:{s:7:"release";s:4:"beta";s:3:"api";s:4:"beta";}s:4:"date";s:10:"2007-01-04";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:47:"http://opensource.org/licenses/lgpl-license.php";}s:8:"_content";s:4:"LGPL";}s:5:"notes";s:68:"* Fixed assertion in the native engine with PHP 5 (PEAR Bug #12740).";}i:2;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.3.1";s:3:"api";s:5:"0.3.0";}s:9:"stability";a:2:{s:7:"release";s:4:"beta";s:3:"api";s:4:"beta";}s:4:"date";s:10:"2007-10-28";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:47:"http://opensource.org/licenses/lgpl-license.php";}s:8:"_content";s:4:"LGPL";}s:5:"notes";s:172:"* Fixed off-by-one errors with line numbers in default renderer output (Milian Wolff, PEAR Bugs #7839, #12111).
* Restore compatibility with PHP 4 in the shell diff engine.";}i:3;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.3.0";s:3:"api";s:5:"0.3.0";}s:9:"stability";a:2:{s:7:"release";s:4:"beta";s:3:"api";s:4:"beta";}s:4:"date";s:10:"2007-09-20";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:47:"http://opensource.org/licenses/lgpl-license.php";}s:8:"_content";s:4:"LGPL";}s:5:"notes";s:237:"* Converted to package.xml 2.0.
* Added context diff renderer.
* Stripped nul characters to avoid infinite loops (PEAR Bug #7921).
* Fix assertion with PHP 5 (PEAR Bug #10423).
* Add shell diff engine (Milian Wolff, PEAR Request #12051).";}i:4;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.2.1";s:3:"api";s:5:"0.2.1";}s:9:"stability";a:2:{s:7:"release";s:4:"beta";s:3:"api";s:4:"beta";}s:4:"date";s:10:"2006-02-06";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:47:"http://opensource.org/licenses/lgpl-license.php";}s:8:"_content";s:4:"LGPL";}s:5:"notes";s:62:"* Fix Text_Diff::reverse() method with PHP 5 (PEAR Bug #6699).";}i:5;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.2.0";s:3:"api";s:5:"0.2.0";}s:9:"stability";a:2:{s:7:"release";s:4:"beta";s:3:"api";s:4:"beta";}s:4:"date";s:10:"2006-01-06";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:47:"http://opensource.org/licenses/lgpl-license.php";}s:8:"_content";s:4:"LGPL";}s:5:"notes";s:308:"* Fix reference warnings with PHP 4.4 and PHP 5.1.
* Fix too many trailing context lines for the last diff chunk. (PEAR Bug #6251).
* Add diff engine for existing diffs/patches (√ñrjan Persson, PEAR Request #5373).
* Fix problems with numbers, whitespace-only changes and the inline renderer (PEAR Bug #6428.";}i:6;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.1.1";s:3:"api";s:5:"0.1.1";}s:9:"stability";a:2:{s:7:"release";s:4:"beta";s:3:"api";s:4:"beta";}s:4:"date";s:10:"2005-08-19";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:47:"http://opensource.org/licenses/lgpl-license.php";}s:8:"_content";s:4:"LGPL";}s:5:"notes";s:56:"* Restore compatibility with PHP 4.2.0 (PEAR Bug #5152).";}i:7;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.1.0";s:3:"api";s:5:"0.1.0";}s:9:"stability";a:2:{s:7:"release";s:4:"beta";s:3:"api";s:4:"beta";}s:4:"date";s:10:"2005-08-16";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:47:"http://opensource.org/licenses/lgpl-license.php";}s:8:"_content";s:4:"LGPL";}s:5:"notes";s:188:"* Fix Renderer::getParams() (PEAR Bug #4549)
* Encode HTML entities in the inline renderer (Horde Bug #2181)
* Fix endless loop in inline renderer with certain whitespaces (PEAR Bug #4879)";}i:8;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.0.5";s:3:"api";s:5:"0.0.5";}s:9:"stability";a:2:{s:7:"release";s:4:"beta";s:3:"api";s:4:"beta";}s:4:"date";s:10:"2005-05-04";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:47:"http://opensource.org/licenses/lgpl-license.php";}s:8:"_content";s:4:"LGPL";}s:5:"notes";s:212:"* Fixed variable name in Text_MappedDiff.
* Removed output buffering code.
* Fixed additional empty lines being added with the inline renderer (Bug 3730).
* Fixed multiple calls to _endBlock per block (Bug 4065).";}i:9;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.0.4";s:3:"api";s:5:"0.0.4";}s:9:"stability";a:2:{s:7:"release";s:4:"beta";s:3:"api";s:4:"beta";}s:4:"date";s:10:"2004-10-13";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:47:"http://opensource.org/licenses/lgpl-license.php";}s:8:"_content";s:4:"LGPL";}s:5:"notes";s:177:"* Generalized Diff Renderer parameter handling.
* Added an inline renderer contributed by Ciprian Popovici (ciprian@zuavra.net).
* Fixed PHPDoc.
* Fixed a PHP 5 incompatibility.";}i:10;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.0.3";s:3:"api";s:5:"0.0.3";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2004-05-13";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:47:"http://opensource.org/licenses/lgpl-license.php";}s:8:"_content";s:4:"LGPL";}s:5:"notes";s:79:"Renamed final() and orig() methods to avoid conflict with final keyword in PHP5";}i:11;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.0.2";s:3:"api";s:5:"0.0.2";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2004-03-16";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:47:"http://opensource.org/licenses/lgpl-license.php";}s:8:"_content";s:4:"LGPL";}s:5:"notes";s:28:"Added optional xdiff support";}i:12;a:5:{s:7:"version";a:2:{s:7:"release";s:5:"0.0.1";s:3:"api";s:5:"0.0.1";}s:9:"stability";a:2:{s:7:"release";s:5:"alpha";s:3:"api";s:5:"alpha";}s:4:"date";s:10:"2004-01-09";s:7:"license";a:2:{s:7:"attribs";a:1:{s:3:"uri";s:47:"http://opensource.org/licenses/lgpl-license.php";}s:8:"_content";s:4:"LGPL";}s:5:"notes";s:23:"Initial package release";}}}s:8:"filelist";a:35:{s:22:"Diff/Engine/native.php";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"b30ce3240eed85e2114b93e28095af90";s:4:"name";s:22:"Diff/Engine/native.php";s:4:"role";s:3:"php";s:12:"installed_as";s:46:"/usr/local/lib/php/Text/Diff/Engine/native.php";}s:21:"Diff/Engine/shell.php";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"4ccb7b5ea80041fcd6e5c5cd958931fa";s:4:"name";s:21:"Diff/Engine/shell.php";s:4:"role";s:3:"php";s:12:"installed_as";s:45:"/usr/local/lib/php/Text/Diff/Engine/shell.php";}s:22:"Diff/Engine/string.php";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"1daaca651ed46e5711b43e47e91e077f";s:4:"name";s:22:"Diff/Engine/string.php";s:4:"role";s:3:"php";s:12:"installed_as";s:46:"/usr/local/lib/php/Text/Diff/Engine/string.php";}s:21:"Diff/Engine/xdiff.php";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"05f00fc5c59664199eb533ff825a386c";s:4:"name";s:21:"Diff/Engine/xdiff.php";s:4:"role";s:3:"php";s:12:"installed_as";s:45:"/usr/local/lib/php/Text/Diff/Engine/xdiff.php";}s:25:"Diff/Renderer/context.php";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"1263babf64df086001944b699014e59d";s:4:"name";s:25:"Diff/Renderer/context.php";s:4:"role";s:3:"php";s:12:"installed_as";s:49:"/usr/local/lib/php/Text/Diff/Renderer/context.php";}s:24:"Diff/Renderer/inline.php";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"e001548ef0b37702633a421cf7eed83d";s:4:"name";s:24:"Diff/Renderer/inline.php";s:4:"role";s:3:"php";s:12:"installed_as";s:48:"/usr/local/lib/php/Text/Diff/Renderer/inline.php";}s:25:"Diff/Renderer/unified.php";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"c4dbae31ce515995100f6ad27a8c9c4e";s:4:"name";s:25:"Diff/Renderer/unified.php";s:4:"role";s:3:"php";s:12:"installed_as";s:49:"/usr/local/lib/php/Text/Diff/Renderer/unified.php";}s:15:"Diff/Mapped.php";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"96b1dc3ba33aba32a4b5662b22d8b58a";s:4:"name";s:15:"Diff/Mapped.php";s:4:"role";s:3:"php";s:12:"installed_as";s:39:"/usr/local/lib/php/Text/Diff/Mapped.php";}s:17:"Diff/Renderer.php";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"d5ac2cccaacad465caa41fae23eae8ad";s:4:"name";s:17:"Diff/Renderer.php";s:4:"role";s:3:"php";s:12:"installed_as";s:41:"/usr/local/lib/php/Text/Diff/Renderer.php";}s:17:"Diff/ThreeWay.php";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"abf74995fef0ba23d50dfc6a5652b5e1";s:4:"name";s:17:"Diff/ThreeWay.php";s:4:"role";s:3:"php";s:12:"installed_as";s:41:"/usr/local/lib/php/Text/Diff/ThreeWay.php";}s:19:"docs/examples/1.txt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"5fbdf5388905ed07026b876126aeee5a";s:4:"name";s:19:"docs/examples/1.txt";s:4:"role";s:3:"doc";s:12:"installed_as";s:52:"/usr/local/lib/php/doc/Text_Diff/docs/examples/1.txt";}s:19:"docs/examples/2.txt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"011c4dad4506a4843ded1f12cab69909";s:4:"name";s:19:"docs/examples/2.txt";s:4:"role";s:3:"doc";s:12:"installed_as";s:52:"/usr/local/lib/php/doc/Text_Diff/docs/examples/2.txt";}s:22:"docs/examples/diff.php";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"6082891c438ee1ba70fd89b9b4e241e8";s:4:"name";s:22:"docs/examples/diff.php";s:4:"role";s:3:"doc";s:12:"installed_as";s:55:"/usr/local/lib/php/doc/Text_Diff/docs/examples/diff.php";}s:11:"tests/1.txt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"5fbdf5388905ed07026b876126aeee5a";s:4:"name";s:11:"tests/1.txt";s:4:"role";s:4:"test";s:12:"installed_as";s:45:"/usr/local/lib/php/test/Text_Diff/tests/1.txt";}s:11:"tests/2.txt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"011c4dad4506a4843ded1f12cab69909";s:4:"name";s:11:"tests/2.txt";s:4:"role";s:4:"test";s:12:"installed_as";s:45:"/usr/local/lib/php/test/Text_Diff/tests/2.txt";}s:11:"tests/3.txt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"308bfdcfb801c46d41d5d24b9fe003f4";s:4:"name";s:11:"tests/3.txt";s:4:"role";s:4:"test";s:12:"installed_as";s:45:"/usr/local/lib/php/test/Text_Diff/tests/3.txt";}s:11:"tests/4.txt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"76af0d7919f307177aef831e62e48640";s:4:"name";s:11:"tests/4.txt";s:4:"role";s:4:"test";s:12:"installed_as";s:45:"/usr/local/lib/php/test/Text_Diff/tests/4.txt";}s:11:"tests/5.txt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"ea33106f5d970bf5dc318b752c95e343";s:4:"name";s:11:"tests/5.txt";s:4:"role";s:4:"test";s:12:"installed_as";s:45:"/usr/local/lib/php/test/Text_Diff/tests/5.txt";}s:11:"tests/6.txt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"38f7931505de496d7312a830b2880f2c";s:4:"name";s:11:"tests/6.txt";s:4:"role";s:4:"test";s:12:"installed_as";s:45:"/usr/local/lib/php/test/Text_Diff/tests/6.txt";}s:19:"tests/context.patch";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"aa40a9c049e89eb8c6f5b0f47e1aabd9";s:4:"name";s:19:"tests/context.patch";s:4:"role";s:4:"test";s:12:"installed_as";s:53:"/usr/local/lib/php/test/Text_Diff/tests/context.patch";}s:18:"tests/context.phpt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"b0143ef7d5e9a1ace0ff747165f27c1f";s:4:"name";s:18:"tests/context.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:52:"/usr/local/lib/php/test/Text_Diff/tests/context.phpt";}s:19:"tests/context2.phpt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"2a88e4c49d51bbdced9a4bd8a8a657c5";s:4:"name";s:19:"tests/context2.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:53:"/usr/local/lib/php/test/Text_Diff/tests/context2.phpt";}s:15:"tests/diff.phpt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"43e8b69ff75bc0e7ecab5b4e87827d19";s:4:"name";s:15:"tests/diff.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:49:"/usr/local/lib/php/test/Text_Diff/tests/diff.phpt";}s:17:"tests/inline.phpt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"2c2f13e357f691f3922d07f6e70fa43d";s:4:"name";s:17:"tests/inline.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:51:"/usr/local/lib/php/test/Text_Diff/tests/inline.phpt";}s:18:"tests/inline2.phpt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"05e94365c047905009b1913a3600036f";s:4:"name";s:18:"tests/inline2.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:52:"/usr/local/lib/php/test/Text_Diff/tests/inline2.phpt";}s:24:"tests/pear_bug12740.phpt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"e05b5cf54cfaf541663fa802724e9549";s:4:"name";s:24:"tests/pear_bug12740.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:58:"/usr/local/lib/php/test/Text_Diff/tests/pear_bug12740.phpt";}s:23:"tests/pear_bug4879.phpt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"7949426acc1e64d6c10338bf6382257d";s:4:"name";s:23:"tests/pear_bug4879.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:57:"/usr/local/lib/php/test/Text_Diff/tests/pear_bug4879.phpt";}s:23:"tests/pear_bug6251.phpt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"7fb3cda23ca78409f72ac233784ff1a1";s:4:"name";s:23:"tests/pear_bug6251.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:57:"/usr/local/lib/php/test/Text_Diff/tests/pear_bug6251.phpt";}s:23:"tests/pear_bug6428.phpt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"c4d40a654a584d3f939dca33fff0a5c4";s:4:"name";s:23:"tests/pear_bug6428.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:57:"/usr/local/lib/php/test/Text_Diff/tests/pear_bug6428.phpt";}s:17:"tests/string.phpt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"e7011d4030f4a020d24efb6f1673a1bc";s:4:"name";s:17:"tests/string.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:51:"/usr/local/lib/php/test/Text_Diff/tests/string.phpt";}s:19:"tests/unified.patch";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"359096964862ff26e28cc44609ca237f";s:4:"name";s:19:"tests/unified.patch";s:4:"role";s:4:"test";s:12:"installed_as";s:53:"/usr/local/lib/php/test/Text_Diff/tests/unified.patch";}s:18:"tests/unified.phpt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"77977a033a539c5ccadaf728b95a1a2c";s:4:"name";s:18:"tests/unified.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:52:"/usr/local/lib/php/test/Text_Diff/tests/unified.phpt";}s:19:"tests/unified2.phpt";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"dab2830cf62f341f1046b883948c1851";s:4:"name";s:19:"tests/unified2.phpt";s:4:"role";s:4:"test";s:12:"installed_as";s:53:"/usr/local/lib/php/test/Text_Diff/tests/unified2.phpt";}s:8:"Diff.php";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"3f715ec0e86162bddc1ea794a04aa4d3";s:4:"name";s:8:"Diff.php";s:4:"role";s:3:"php";s:12:"installed_as";s:32:"/usr/local/lib/php/Text/Diff.php";}s:9:"Diff3.php";a:5:{s:14:"baseinstalldir";s:5:"/Text";s:6:"md5sum";s:32:"7b57773de584d2408214cb2c7a0d0a2e";s:4:"name";s:9:"Diff3.php";s:4:"role";s:3:"php";s:12:"installed_as";s:33:"/usr/local/lib/php/Text/Diff3.php";}}s:12:"_lastversion";N;s:7:"dirtree";a:9:{s:35:"/usr/local/lib/php/Text/Diff/Engine";b:1;s:28:"/usr/local/lib/php/Text/Diff";b:1;s:23:"/usr/local/lib/php/Text";b:1;s:37:"/usr/local/lib/php/Text/Diff/Renderer";b:1;s:46:"/usr/local/lib/php/doc/Text_Diff/docs/examples";b:1;s:37:"/usr/local/lib/php/doc/Text_Diff/docs";b:1;s:32:"/usr/local/lib/php/doc/Text_Diff";b:1;s:39:"/usr/local/lib/php/test/Text_Diff/tests";b:1;s:33:"/usr/local/lib/php/test/Text_Diff";b:1;}s:3:"old";a:7:{s:7:"version";s:5:"1.1.0";s:12:"release_date";s:10:"2008-09-10";s:13:"release_state";s:6:"stable";s:15:"release_license";s:4:"LGPL";s:13:"release_notes";s:234:"* Add countAddedLines() and countDeletedLines() methods (Christian King, PEAR Request #13183).
* Improve string engine if patch data has no header (PEAR Bug #14533).
* Fix autodetection of diff type in string engine (PEAR Bug #14625).";s:12:"release_deps";a:3:{i:0;a:4:{s:4:"type";s:3:"php";s:3:"rel";s:2:"ge";s:7:"version";s:5:"4.2.0";s:8:"optional";s:2:"no";}i:1;a:6:{s:4:"type";s:3:"pkg";s:7:"channel";s:12:"pear.php.net";s:4:"name";s:4:"PEAR";s:3:"rel";s:2:"ge";s:7:"version";s:7:"1.4.0b1";s:8:"optional";s:2:"no";}i:2;a:4:{s:4:"type";s:3:"ext";s:4:"name";s:5:"xdiff";s:3:"rel";s:3:"has";s:8:"optional";s:3:"yes";}}s:11:"maintainers";a:3:{i:0;a:5:{s:4:"name";s:15:"Chuck Hagenbuch";s:5:"email";s:15:"chuck@horde.org";s:6:"active";s:3:"yes";s:6:"handle";s:8:"chagenbu";s:4:"role";s:4:"lead";}i:1;a:5:{s:4:"name";s:13:"Jan Schneider";s:5:"email";s:13:"jan@horde.org";s:6:"active";s:3:"yes";s:6:"handle";s:6:"yunosh";s:4:"role";s:4:"lead";}i:2;a:5:{s:4:"name";s:12:"Paul M Jones";s:5:"email";s:19:"pmjones@memphis.edu";s:6:"active";s:2:"no";s:6:"handle";s:7:"pmjones";s:4:"role";s:4:"lead";}}}s:10:"xsdversion";s:3:"2.0";s:13:"_lastmodified";i:1236197850;}a:6:{s:3:"php";a:117:{s:12:"OS/Guess.php";s:4:"pear";s:27:"PEAR/ChannelFile/Parser.php";s:4:"pear";s:21:"PEAR/Command/Auth.xml";s:4:"pear";s:21:"PEAR/Command/Auth.php";s:4:"pear";s:22:"PEAR/Command/Build.xml";s:4:"pear";s:22:"PEAR/Command/Build.php";s:4:"pear";s:25:"PEAR/Command/Channels.xml";s:4:"pear";s:25:"PEAR/Command/Channels.php";s:4:"pear";s:23:"PEAR/Command/Common.php";s:4:"pear";s:23:"PEAR/Command/Config.xml";s:4:"pear";s:23:"PEAR/Command/Config.php";s:4:"pear";s:24:"PEAR/Command/Install.xml";s:4:"pear";s:24:"PEAR/Command/Install.php";s:4:"pear";s:23:"PEAR/Command/Mirror.xml";s:4:"pear";s:23:"PEAR/Command/Mirror.php";s:4:"pear";s:24:"PEAR/Command/Package.xml";s:4:"pear";s:24:"PEAR/Command/Package.php";s:4:"pear";s:23:"PEAR/Command/Pickle.xml";s:4:"pear";s:23:"PEAR/Command/Pickle.php";s:4:"pear";s:25:"PEAR/Command/Registry.xml";s:4:"pear";s:25:"PEAR/Command/Registry.php";s:4:"pear";s:23:"PEAR/Command/Remote.xml";s:4:"pear";s:23:"PEAR/Command/Remote.php";s:4:"pear";s:21:"PEAR/Command/Test.xml";s:4:"pear";s:21:"PEAR/Command/Test.php";s:4:"pear";s:27:"PEAR/Downloader/Package.php";s:4:"pear";s:21:"PEAR/Frontend/CLI.php";s:4:"pear";s:30:"PEAR/Installer/Role/Common.php";s:4:"pear";s:27:"PEAR/Installer/Role/Cfg.xml";s:4:"pear";s:27:"PEAR/Installer/Role/Cfg.php";s:4:"pear";s:28:"PEAR/Installer/Role/Data.xml";s:4:"pear";s:28:"PEAR/Installer/Role/Data.php";s:4:"pear";s:27:"PEAR/Installer/Role/Doc.xml";s:4:"pear";s:27:"PEAR/Installer/Role/Doc.php";s:4:"pear";s:27:"PEAR/Installer/Role/Ext.xml";s:4:"pear";s:27:"PEAR/Installer/Role/Ext.php";s:4:"pear";s:27:"PEAR/Installer/Role/Php.xml";s:4:"pear";s:27:"PEAR/Installer/Role/Php.php";s:4:"pear";s:30:"PEAR/Installer/Role/Script.xml";s:4:"pear";s:30:"PEAR/Installer/Role/Script.php";s:4:"pear";s:27:"PEAR/Installer/Role/Src.xml";s:4:"pear";s:27:"PEAR/Installer/Role/Src.php";s:4:"pear";s:28:"PEAR/Installer/Role/Test.xml";s:4:"pear";s:28:"PEAR/Installer/Role/Test.php";s:4:"pear";s:27:"PEAR/Installer/Role/Www.xml";s:4:"pear";s:27:"PEAR/Installer/Role/Www.php";s:4:"pear";s:23:"PEAR/Installer/Role.php";s:4:"pear";s:33:"PEAR/PackageFile/Generator/v1.php";s:4:"pear";s:33:"PEAR/PackageFile/Generator/v2.php";s:4:"pear";s:30:"PEAR/PackageFile/Parser/v1.php";s:4:"pear";s:30:"PEAR/PackageFile/Parser/v2.php";s:4:"pear";s:26:"PEAR/PackageFile/v2/rw.php";s:4:"pear";s:33:"PEAR/PackageFile/v2/Validator.php";s:4:"pear";s:23:"PEAR/PackageFile/v1.php";s:4:"pear";s:23:"PEAR/PackageFile/v2.php";s:4:"pear";s:16:"PEAR/REST/10.php";s:4:"pear";s:16:"PEAR/REST/11.php";s:4:"pear";s:16:"PEAR/REST/13.php";s:4:"pear";s:34:"PEAR/Task/Postinstallscript/rw.php";s:4:"pear";s:24:"PEAR/Task/Replace/rw.php";s:4:"pear";s:24:"PEAR/Task/Unixeol/rw.php";s:4:"pear";s:27:"PEAR/Task/Windowseol/rw.php";s:4:"pear";s:20:"PEAR/Task/Common.php";s:4:"pear";s:31:"PEAR/Task/Postinstallscript.php";s:4:"pear";s:21:"PEAR/Task/Replace.php";s:4:"pear";s:21:"PEAR/Task/Unixeol.php";s:4:"pear";s:24:"PEAR/Task/Windowseol.php";s:4:"pear";s:23:"PEAR/Validator/PECL.php";s:4:"pear";s:19:"PEAR/Autoloader.php";s:4:"pear";s:16:"PEAR/Builder.php";s:4:"pear";s:20:"PEAR/ChannelFile.php";s:4:"pear";s:16:"PEAR/Command.php";s:4:"pear";s:15:"PEAR/Common.php";s:4:"pear";s:15:"PEAR/Config.php";s:4:"pear";s:21:"PEAR/DependencyDB.php";s:4:"pear";s:20:"PEAR/Dependency2.php";s:4:"pear";s:19:"PEAR/Downloader.php";s:4:"pear";s:19:"PEAR/ErrorStack.php";s:4:"pear";s:18:"PEAR/Exception.php";s:4:"pear";s:28:"PEAR/FixPHP5PEARWarnings.php";s:4:"pear";s:17:"PEAR/Frontend.php";s:4:"pear";s:18:"PEAR/Installer.php";s:4:"pear";s:20:"PEAR/PackageFile.php";s:4:"pear";s:17:"PEAR/Packager.php";s:4:"pear";s:17:"PEAR/Registry.php";s:4:"pear";s:13:"PEAR/REST.php";s:4:"pear";s:16:"PEAR/RunTest.php";s:4:"pear";s:17:"PEAR/Validate.php";s:4:"pear";s:18:"PEAR/XMLParser.php";s:4:"pear";s:19:"scripts/pearcmd.php";s:4:"pear";s:19:"scripts/peclcmd.php";s:4:"pear";s:9:"PEAR5.php";s:4:"pear";s:8:"PEAR.php";s:4:"pear";s:10:"System.php";s:4:"pear";s:23:"PHP/Archive/Creator.php";s:11:"php_archive";s:25:"PHP/Archive/Exception.php";s:11:"php_archive";s:23:"PHP/Archive/Manager.php";s:11:"php_archive";s:15:"PHP/Archive.php";s:11:"php_archive";s:18:"Console/Getopt.php";s:14:"console_getopt";s:44:"Structures/Graph/Manipulator/AcyclicTest.php";s:16:"structures_graph";s:50:"Structures/Graph/Manipulator/TopologicalSorter.php";s:16:"structures_graph";s:25:"Structures/Graph/Node.php";s:16:"structures_graph";s:20:"Structures/Graph.php";s:16:"structures_graph";s:15:"Archive/Tar.php";s:11:"archive_tar";s:12:"XML/Util.php";s:8:"xml_util";s:27:"Text/Diff/Engine/native.php";s:9:"text_diff";s:26:"Text/Diff/Engine/shell.php";s:9:"text_diff";s:27:"Text/Diff/Engine/string.php";s:9:"text_diff";s:26:"Text/Diff/Engine/xdiff.php";s:9:"text_diff";s:30:"Text/Diff/Renderer/context.php";s:9:"text_diff";s:29:"Text/Diff/Renderer/inline.php";s:9:"text_diff";s:30:"Text/Diff/Renderer/unified.php";s:9:"text_diff";s:20:"Text/Diff/Mapped.php";s:9:"text_diff";s:22:"Text/Diff/Renderer.php";s:9:"text_diff";s:22:"Text/Diff/ThreeWay.php";s:9:"text_diff";s:13:"Text/Diff.php";s:9:"text_diff";s:14:"Text/Diff3.php";s:9:"text_diff";}s:6:"script";a:3:{s:15:"scripts/pear.sh";s:4:"pear";s:18:"scripts/peardev.sh";s:4:"pear";s:15:"scripts/pecl.sh";s:4:"pear";}s:3:"doc";a:36:{s:12:"pear/LICENSE";s:4:"pear";s:12:"pear/INSTALL";s:4:"pear";s:11:"pear/README";s:4:"pear";s:14:"xdebug/CREDITS";s:6:"xdebug";s:16:"xdebug/Changelog";s:6:"xdebug";s:14:"xdebug/LICENSE";s:6:"xdebug";s:11:"xdebug/NEWS";s:6:"xdebug";s:13:"xdebug/README";s:6:"xdebug";s:13:"xdebug/xt.vim";s:6:"xdebug";s:43:"structures_graph/docs/html/media/banner.css";s:16:"structures_graph";s:47:"structures_graph/docs/html/media/stylesheet.css";s:16:"structures_graph";s:65:"structures_graph/docs/html/Structures_Graph/Structures_Graph.html";s:16:"structures_graph";s:89:"structures_graph/docs/html/Structures_Graph/Structures_Graph_Manipulator_AcyclicTest.html";s:16:"structures_graph";s:95:"structures_graph/docs/html/Structures_Graph/Structures_Graph_Manipulator_TopologicalSorter.html";s:16:"structures_graph";s:70:"structures_graph/docs/html/Structures_Graph/Structures_Graph_Node.html";s:16:"structures_graph";s:78:"structures_graph/docs/html/Structures_Graph/tutorial_Structures_Graph.pkg.html";s:16:"structures_graph";s:94:"structures_graph/docs/html/Structures_Graph/_Structures_Graph_Manipulator_AcyclicTest_php.html";s:16:"structures_graph";s:100:"structures_graph/docs/html/Structures_Graph/_Structures_Graph_Manipulator_TopologicalSorter_php.html";s:16:"structures_graph";s:75:"structures_graph/docs/html/Structures_Graph/_Structures_Graph_Node_php.html";s:16:"structures_graph";s:70:"structures_graph/docs/html/Structures_Graph/_Structures_Graph_php.html";s:16:"structures_graph";s:59:"structures_graph/docs/html/classtrees_Structures_Graph.html";s:16:"structures_graph";s:44:"structures_graph/docs/html/elementindex.html";s:16:"structures_graph";s:61:"structures_graph/docs/html/elementindex_Structures_Graph.html";s:16:"structures_graph";s:38:"structures_graph/docs/html/errors.html";s:16:"structures_graph";s:37:"structures_graph/docs/html/index.html";s:16:"structures_graph";s:51:"structures_graph/docs/html/li_Structures_Graph.html";s:16:"structures_graph";s:40:"structures_graph/docs/html/packages.html";s:16:"structures_graph";s:40:"structures_graph/docs/html/todolist.html";s:16:"structures_graph";s:69:"structures_graph/docs/tutorials/Structures_Graph/Structures_Graph.pkg";s:16:"structures_graph";s:33:"structures_graph/docs/generate.sh";s:16:"structures_graph";s:32:"archive_tar/docs/Archive_Tar.txt";s:11:"archive_tar";s:29:"xml_util/examples/example.php";s:8:"xml_util";s:30:"xml_util/examples/example2.php";s:8:"xml_util";s:29:"text_diff/docs/examples/1.txt";s:9:"text_diff";s:29:"text_diff/docs/examples/2.txt";s:9:"text_diff";s:32:"text_diff/docs/examples/diff.php";s:9:"text_diff";}s:4:"data";a:7:{s:16:"pear/package.dtd";s:4:"pear";s:18:"pear/template.spec";s:4:"pear";s:41:"php_archive/data/phar_frontcontroller.tpl";s:11:"php_archive";s:34:"structures_graph/genpackage.xml.pl";s:16:"structures_graph";s:24:"structures_graph/LICENSE";s:16:"structures_graph";s:27:"structures_graph/package.sh";s:16:"structures_graph";s:27:"structures_graph/publish.sh";s:16:"structures_graph";}s:4:"test";a:81:{s:48:"php_archive/tests/filenotfound/filenotfound.phar";s:11:"php_archive";s:59:"php_archive/tests/filenotfound/makefilenotfoundphar.php.inc";s:11:"php_archive";s:44:"php_archive/tests/longfilename/longphar.phar";s:11:"php_archive";s:51:"php_archive/tests/longfilename/makelongphar.php.inc";s:11:"php_archive";s:49:"php_archive/tests/opendir/makeopendirphar.php.inc";s:11:"php_archive";s:38:"php_archive/tests/opendir/opendir.phar";s:11:"php_archive";s:45:"php_archive/tests/planet_php/default_phar.php";s:11:"php_archive";s:59:"php_archive/tests/require_once/makerequire_oncephar.php.inc";s:11:"php_archive";s:48:"php_archive/tests/require_once/require_once.phar";s:11:"php_archive";s:26:"php_archive/tests/eof.phpt";s:11:"php_archive";s:35:"php_archive/tests/filenotfound.phpt";s:11:"php_archive";s:38:"php_archive/tests/filenotfoundtest.php";s:11:"php_archive";s:40:"php_archive/tests/filenotfound_phar.phpt";s:11:"php_archive";s:36:"php_archive/tests/gopearphar.php.inc";s:11:"php_archive";s:35:"php_archive/tests/longfilename.phpt";s:11:"php_archive";s:38:"php_archive/tests/makepearphar.php.inc";s:11:"php_archive";s:39:"php_archive/tests/maketestphars.php.inc";s:11:"php_archive";s:31:"php_archive/tests/new_phar.phar";s:11:"php_archive";s:33:"php_archive/tests/normalstat.phpt";s:11:"php_archive";s:38:"php_archive/tests/normalstat_phar.phpt";s:11:"php_archive";s:30:"php_archive/tests/opendir.phpt";s:11:"php_archive";s:31:"php_archive/tests/pearindex.php";s:11:"php_archive";s:26:"php_archive/tests/phar.log";s:11:"php_archive";s:35:"php_archive/tests/phpt_test.php.inc";s:11:"php_archive";s:35:"php_archive/tests/require_once.phpt";s:11:"php_archive";s:40:"php_archive/tests/require_once_phar.phpt";s:11:"php_archive";s:30:"php_archive/tests/savetest.php";s:11:"php_archive";s:27:"php_archive/tests/seek.phpt";s:11:"php_archive";s:32:"php_archive/tests/seek_phar.phpt";s:11:"php_archive";s:33:"php_archive/tests/streamstat.phpt";s:11:"php_archive";s:38:"php_archive/tests/streamstat_phar.phpt";s:11:"php_archive";s:26:"php_archive/tests/test.php";s:11:"php_archive";s:27:"php_archive/tests/test1.php";s:11:"php_archive";s:31:"php_archive/tests/test_path.php";s:11:"php_archive";s:32:"php_archive/tests/test_phar.phar";s:11:"php_archive";s:33:"php_archive/tests/test_phar2.phar";s:11:"php_archive";s:34:"php_archive/tests/test_require.php";s:11:"php_archive";s:30:"php_archive/tests/test_tar.tar";s:11:"php_archive";s:31:"php_archive/tests/twophars.phpt";s:11:"php_archive";s:46:"structures_graph/tests/testCase/BasicGraph.php";s:16:"structures_graph";s:36:"structures_graph/tests/all-tests.php";s:16:"structures_graph";s:29:"structures_graph/tests/README";s:16:"structures_graph";s:27:"xml_util/tests/AllTests.php";s:8:"xml_util";s:40:"xml_util/tests/testBasic_apiVersion.phpt";s:8:"xml_util";s:48:"xml_util/tests/testBasic_attributesToString.phpt";s:8:"xml_util";s:47:"xml_util/tests/testBasic_collapseEmptyTags.phpt";s:8:"xml_util";s:48:"xml_util/tests/testBasic_createCDataSection.phpt";s:8:"xml_util";s:43:"xml_util/tests/testBasic_createComment.phpt";s:8:"xml_util";s:46:"xml_util/tests/testBasic_createEndElement.phpt";s:8:"xml_util";s:48:"xml_util/tests/testBasic_createStartElement.phpt";s:8:"xml_util";s:39:"xml_util/tests/testBasic_createTag.phpt";s:8:"xml_util";s:48:"xml_util/tests/testBasic_createTagFromArray.phpt";s:8:"xml_util";s:51:"xml_util/tests/testBasic_getDocTypeDeclaration.phpt";s:8:"xml_util";s:47:"xml_util/tests/testBasic_getXmlDeclaration.phpt";s:8:"xml_util";s:41:"xml_util/tests/testBasic_isValidName.phpt";s:8:"xml_util";s:40:"xml_util/tests/testBasic_raiseError.phpt";s:8:"xml_util";s:45:"xml_util/tests/testBasic_replaceEntities.phpt";s:8:"xml_util";s:45:"xml_util/tests/testBasic_reverseEntities.phpt";s:8:"xml_util";s:48:"xml_util/tests/testBasic_splitQualifiedName.phpt";s:8:"xml_util";s:32:"xml_util/tests/testBug_4950.phpt";s:8:"xml_util";s:32:"xml_util/tests/testBug_5392.phpt";s:8:"xml_util";s:21:"text_diff/tests/1.txt";s:9:"text_diff";s:21:"text_diff/tests/2.txt";s:9:"text_diff";s:21:"text_diff/tests/3.txt";s:9:"text_diff";s:21:"text_diff/tests/4.txt";s:9:"text_diff";s:21:"text_diff/tests/5.txt";s:9:"text_diff";s:21:"text_diff/tests/6.txt";s:9:"text_diff";s:29:"text_diff/tests/context.patch";s:9:"text_diff";s:28:"text_diff/tests/context.phpt";s:9:"text_diff";s:29:"text_diff/tests/context2.phpt";s:9:"text_diff";s:25:"text_diff/tests/diff.phpt";s:9:"text_diff";s:27:"text_diff/tests/inline.phpt";s:9:"text_diff";s:28:"text_diff/tests/inline2.phpt";s:9:"text_diff";s:34:"text_diff/tests/pear_bug12740.phpt";s:9:"text_diff";s:33:"text_diff/tests/pear_bug4879.phpt";s:9:"text_diff";s:33:"text_diff/tests/pear_bug6251.phpt";s:9:"text_diff";s:33:"text_diff/tests/pear_bug6428.phpt";s:9:"text_diff";s:27:"text_diff/tests/string.phpt";s:9:"text_diff";s:29:"text_diff/tests/unified.patch";s:9:"text_diff";s:28:"text_diff/tests/unified.phpt";s:9:"text_diff";s:29:"text_diff/tests/unified2.phpt";s:9:"text_diff";}s:3:"src";a:1:{s:16:"xdebug/xdebug.so";s:6:"xdebug";}}a:3:{s:8:"_version";s:3:"1.0";s:12:"dependencies";a:1:{s:12:"pear.php.net";a:2:{s:11:"php_archive";a:1:{i:0;a:3:{s:3:"dep";a:3:{s:4:"name";s:4:"PEAR";s:7:"channel";s:12:"pear.php.net";s:3:"min";s:5:"1.4.3";}s:4:"type";s:8:"required";s:5:"group";b:0;}}s:4:"pear";a:9:{i:0;a:3:{s:3:"dep";a:5:{s:4:"name";s:11:"Archive_Tar";s:7:"channel";s:12:"pear.php.net";s:3:"min";s:3:"1.1";s:11:"recommended";s:5:"1.3.3";s:7:"exclude";s:5:"1.3.0";}s:4:"type";s:8:"required";s:5:"group";b:0;}i:1;a:3:{s:3:"dep";a:4:{s:4:"name";s:16:"Structures_Graph";s:7:"channel";s:12:"pear.php.net";s:3:"min";s:5:"1.0.2";s:11:"recommended";s:5:"1.0.2";}s:4:"type";s:8:"required";s:5:"group";b:0;}i:2;a:3:{s:3:"dep";a:4:{s:4:"name";s:14:"Console_Getopt";s:7:"channel";s:12:"pear.php.net";s:3:"min";s:3:"1.2";s:11:"recommended";s:5:"1.2.3";}s:4:"type";s:8:"required";s:5:"group";b:0;}i:3;a:3:{s:3:"dep";a:4:{s:4:"name";s:8:"XML_Util";s:7:"channel";s:12:"pear.php.net";s:3:"min";s:5:"1.2.0";s:11:"recommended";s:5:"1.2.1";}s:4:"type";s:8:"required";s:5:"group";b:0;}i:4;a:3:{s:3:"dep";a:4:{s:4:"name";s:17:"PEAR_Frontend_Web";s:7:"channel";s:12:"pear.php.net";s:3:"max";s:3:"0.4";s:9:"conflicts";s:0:"";}s:4:"type";s:8:"required";s:5:"group";b:0;}i:5;a:3:{s:3:"dep";a:5:{s:4:"name";s:17:"PEAR_Frontend_Gtk";s:7:"channel";s:12:"pear.php.net";s:3:"max";s:5:"0.4.0";s:7:"exclude";s:5:"0.4.0";s:9:"conflicts";s:0:"";}s:4:"type";s:8:"required";s:5:"group";b:0;}i:6;a:3:{s:3:"dep";a:3:{s:4:"name";s:17:"PEAR_Frontend_Web";s:7:"channel";s:12:"pear.php.net";s:3:"min";s:5:"0.5.1";}s:4:"type";s:8:"optional";s:5:"group";s:12:"webinstaller";}i:7;a:3:{s:3:"dep";a:3:{s:4:"name";s:17:"PEAR_Frontend_Gtk";s:7:"channel";s:12:"pear.php.net";s:3:"min";s:5:"0.4.0";}s:4:"type";s:8:"optional";s:5:"group";s:12:"gtkinstaller";}i:8;a:3:{s:3:"dep";a:2:{s:4:"name";s:18:"PEAR_Frontend_Gtk2";s:7:"channel";s:12:"pear.php.net";}s:4:"type";s:8:"optional";s:5:"group";s:13:"gtk2installer";}}}}s:8:"packages";a:1:{s:12:"pear.php.net";a:8:{s:4:"pear";a:1:{i:0;a:2:{s:7:"channel";s:12:"pear.php.net";s:7:"package";s:11:"php_archive";}}s:11:"archive_tar";a:1:{i:0;a:2:{s:7:"channel";s:12:"pear.php.net";s:7:"package";s:4:"pear";}}s:16:"structures_graph";a:1:{i:0;a:2:{s:7:"channel";s:12:"pear.php.net";s:7:"package";s:4:"pear";}}s:14:"console_getopt";a:1:{i:0;a:2:{s:7:"channel";s:12:"pear.php.net";s:7:"package";s:4:"pear";}}s:8:"xml_util";a:1:{i:0;a:2:{s:7:"channel";s:12:"pear.php.net";s:7:"package";s:4:"pear";}}s:17:"pear_frontend_web";a:1:{i:0;a:2:{s:7:"channel";s:12:"pear.php.net";s:7:"package";s:4:"pear";}}s:17:"pear_frontend_gtk";a:1:{i:0;a:2:{s:7:"channel";s:12:"pear.php.net";s:7:"package";s:4:"pear";}}s:18:"pear_frontend_gtk2";a:1:{i:0;a:2:{s:7:"channel";s:12:"pear.php.net";s:7:"package";s:4:"pear";}}}}}--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::_findPEAR test 1: explicit config path
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
mkdir(__DIR__ . '/testit');
ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'help'));

$contents = ob_get_contents();
ob_end_clean();
$help1 = 'Using PEAR installation found at ' . __DIR__ . DIRECTORY_SEPARATOR . 'testit' . "\n";
$help2 =
'
Pyrus, the installer for PEAR2

Usage:
  php findpear1.php [/path/to/pear] [options]
  php findpear1.php [/path/to/pear] [options] <command> [options] [args]

Options:
  -v, --verbose  increase verbosity
  -h, --help     show this help message and exit
  --version      show the program version and exit

Commands:
  install           Install a package.  Use install --plugin to install
                    plugins
  upgrade           Upgrade a package.  Use upgrade --plugin to upgrade
                    plugins
  uninstall         Uninstall a package.  Use uninstall --plugin to
                    uninstall plugins
  build             Build a PHP extension package from source and install
                    the compiled extension
  download          Download a remote package to the current directory
  list-packages     List all installed packages in all channels
  list-channels     List all discovered channels
  channel-discover  Discover a new channel
  channel-add       Add a new channel to the registry
  channel-del       Remove a channel from the registry
  upgrade-registry  Upgrade an old PEAR installation to the new registry
                    format
  run-scripts       Run all post-install scripts for a package
  config-show       Show all configuration values
  set               Set a configuration value
  mypear            Set a configuration value
  help              Get help on a particular command, or all commands

';
$test->assertEquals($help1 . $help2,
                    $contents,
                    'help output');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::upgrade(), basic test
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit', __DIR__ . '/testit/pearconfig.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();

require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/../../Mocks/Internet/install.prepare.explicitstate',
                       'http://pear2.php.net/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
PEAR2_Pyrus_Package_Remote::$downloadClass = 'Internet';

PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package(__DIR__ .
                                '/../../Mocks/Internet/install.prepare.explicitstate/get/P2-1.0.0.tar'));
PEAR2_Pyrus_Installer::commit();

ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'upgrade', 'P2-beta'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . 'Installed pear2.php.net/P2-1.1.0RC3' . "\n",
                    $contents,
                    'list packages');

$test->assertFileExists(__DIR__ . '/testit/php/glooby2', 'glooby2');
$test->assertEquals('hi',
                    file_get_contents(__DIR__ . '/testit/php/glooby2'), 'files match');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===package.xml                                                                                         100644    1751     144        22131 10450341002   6376                                                                                                                                                                                                                                                                                                                                                                      <?xml version="1.0" encoding="UTF-8"?>
<package packagerversion="1.4.10" version="2.0" xmlns="http://pear.php.net/dtd/package-2.0" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0 http://pear.php.net/dtd/tasks-1.0.xsd http://pear.php.net/dtd/package-2.0 http://pear.php.net/dtd/package-2.0.xsd">
 <name>docblock</name>
 <channel>pecl.php.net</channel>
 <summary>phpDocumentor-style DocBlock (T_DOC_COMMENT token) tokenizer</summary>
 <description>This extension is like the tokenizer extension for PHP.
It takes a document comment (docblock) like this one:

/**
 * information {@inlinetag}
 * @tags
 */

and parses it into tokens.

The primary function is docblock_tokenize(), which accepts a
string, and returns an array of arrays of array(TOKEN, &quot;token&quot;).
TOKEN is one of DOCBLOCK_* constants.

docblock_tokenize() has an optional second bool parameter that
determine whether to output non-essential tokens like
the /** * stuff.

docblock_token_name() takes a DOCBLOCK_* constant and returns its name</description>
 <lead>
  <name>Greg Beaver</name>
  <user>cellog</user>
  <email>cellog@php.net</email>
  <active>yes</active>
 </lead>
 <date>2006-06-27</date>
 <time>18:40:50</time>
 <version>
  <release>0.2.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>alpha</release>
  <api>alpha</api>
 </stability>
 <license uri="http://www.php.net/license">PHP License</license>
 <notes>Bugfix release
- fix Bug #7952: terse mode ignores simplelist end
- fix Bug #7953: {@internal}} returned as inline tag inside &lt;code&gt;</notes>
 <contents>
  <dir name="/">
   <file md5sum="fb8b82edc4deb3d09895f112fa87ba0d" name="tests/001.phpt" role="test" />
   <file md5sum="3f696f93f84df18681af504e4ec2d7b4" name="tests/002.phpt" role="test" />
   <file md5sum="2889509b42a3d1f8d424e0cf2d219b66" name="tests/003.phpt" role="test" />
   <file md5sum="28c6c47f7bca2129dfba74ea8561ac83" name="tests/004.phpt" role="test" />
   <file md5sum="30561a047e86ad2fd724e45f47670b27" name="tests/005.phpt" role="test" />
   <file md5sum="051263f7df81493b4a25808a8c6de2e0" name="tests/006.phpt" role="test" />
   <file md5sum="936a3a18bb75c201d990e82b88746024" name="tests/007.phpt" role="test" />
   <file md5sum="bcb3ada7b2fd9b126d255ac4ba5e877d" name="tests/008.phpt" role="test" />
   <file md5sum="afd86b57d97a35592c7eea74e4ef7ea2" name="tests/009.phpt" role="test" />
   <file md5sum="e6e6adc81af0ac7cbe1350514ddb2ff5" name="tests/010.phpt" role="test" />
   <file md5sum="b21198c0cec52ca532a853cdc3f50f86" name="tests/011.phpt" role="test" />
   <file md5sum="a8e27542bcb632ea980d7563a15c9b62" name="tests/012.phpt" role="test" />
   <file md5sum="30561a047e86ad2fd724e45f47670b27" name="tests/013.phpt" role="test" />
   <file md5sum="f01f5c2da72793a2649ae66288d95adc" name="tests/014.phpt" role="test" />
   <file md5sum="b366430f96e565d3326f4037d1a832ff" name="tests/015.phpt" role="test" />
   <file md5sum="e751a8a514429cdba6b6749675f8f058" name="tests/016.phpt" role="test" />
   <file md5sum="b2e5dced1d95ba9e5c74f2a15dfa1f7d" name="tests/017.phpt" role="test" />
   <file md5sum="c7788a98e29b88dab2e5169af7f05a33" name="tests/018.phpt" role="test" />
   <file md5sum="f19fffb14d620da6aef99f49bbad4d4d" name="tests/019.phpt" role="test" />
   <file md5sum="21bc4fd747cc1224e61e74c99a6c6104" name="tests/020.phpt" role="test" />
   <file md5sum="e9bfc9039dac707efa4e97c786afabe3" name="tests/021.phpt" role="test" />
   <file md5sum="a636e1935d29338a9410da6b30575356" name="tests/022.phpt" role="test" />
   <file md5sum="4eed50907422212432468cf7c793f18f" name="tests/023.phpt" role="test" />
   <file md5sum="2517424168c7020b55b6b253ee866af6" name="tests/024.phpt" role="test" />
   <file md5sum="5399912d74866451a531be9142d899ea" name="tests/025.phpt" role="test" />
   <file md5sum="12cc62a48e3b912ef49918fd50adfe8b" name="tests/026.phpt" role="test" />
   <file md5sum="1d7b79dfbd2208859668e41c8e1eeac5" name="tests/027.phpt" role="test" />
   <file md5sum="14139f90678e4bd4194b7f6be7ca3456" name="tests/028.phpt" role="test" />
   <file md5sum="0493fa41f824c500e531aede50fb564d" name="tests/029.phpt" role="test" />
   <file md5sum="8ce54df1369c9c3d4923eddab96e49a0" name="tests/030.phpt" role="test" />
   <file md5sum="57a000d62d33b774e71006a9cb48c9ac" name="tests/031.phpt" role="test" />
   <file md5sum="6ef25130c0a7eff7e8b4428abe1826d2" name="tests/032.phpt" role="test" />
   <file md5sum="1b8cf65b1190c4c59a8c3b525ec0d53a" name="tests/033.phpt" role="test" />
   <file md5sum="b1fd7cac15cd7b1b06ab7bb43eac55c5" name="tests/034.phpt" role="test" />
   <file md5sum="0d917cd8d907c901ec3f51ecb5f62f81" name="tests/035.phpt" role="test" />
   <file md5sum="69e48aba9e1afad0dd018c96c84b6c38" name="tests/036.phpt" role="test" />
   <file md5sum="f566ff5a4d75ef99b38089f175b6e762" name="tests/037.phpt" role="test" />
   <file md5sum="271ddc6ad2aa9457e9115518273ed9ac" name="tests/038.phpt" role="test" />
   <file md5sum="0964bb11ab3c598929447339357ebe1c" name="tests/039.phpt" role="test" />
   <file md5sum="57a000d62d33b774e71006a9cb48c9ac" name="tests/040.phpt" role="test" />
   <file md5sum="ed9b63f8e17315c104bb65eb6a0af3ee" name="tests/041.phpt" role="test" />
   <file md5sum="c0ef6744b50de6af57b54ad16f3c0d09" name="tests/042.phpt" role="test" />
   <file md5sum="039e27428e27adb53245e89fa69ed0e8" name="tests/043.phpt" role="test" />
   <file md5sum="4cc41cdbfff6c281929f9548a9289bad" name="tests/044.phpt" role="test" />
   <file md5sum="a0bd2707fb1c45bfa7f7d79e44b9129a" name="tests/045.phpt" role="test" />
   <file md5sum="13a5b1ef6d580cb941d2d09a7044f317" name="tests/046.phpt" role="test" />
   <file md5sum="d5a468de8d2fd14e4ad044ab00246229" name="tests/047.phpt" role="test" />
   <file md5sum="e997e5db2906bba120cfd2036312aef5" name="tests/048.phpt" role="test" />
   <file md5sum="368cdca90b4af95b5af9961c55752008" name="tests/049.phpt" role="test" />
   <file md5sum="91b10453841c6f6e1f1246ed38d092f5" name="tests/050.phpt" role="test" />
   <file md5sum="b69334681e9eccdfa23cda0193a63d15" name="tests/051.phpt" role="test" />
   <file md5sum="df1462434057485810278465f8d947f6" name="tests/052.phpt" role="test" />
   <file md5sum="0b8a25ab5ad74ac66612c716ff580f5f" name="tests/053.phpt" role="test" />
   <file md5sum="0d6b35d6778a18aa07bba734df92d8ec" name="tests/054.phpt" role="test" />
   <file md5sum="02a4b1c5e2a832268c52e6d37f0915db" name="tests/055.phpt" role="test" />
   <file md5sum="4fa7970c6f78a89fbafeed2f104f3f05" name="tests/056.phpt" role="test" />
   <file md5sum="5b2bb4cd6cb94937dc487ad3fa1d9f19" name="tests/057.phpt" role="test" />
   <file md5sum="c44fc05cc42036517b1b627cb3555a4d" name="tests/058.phpt" role="test" />
   <file md5sum="aa86a716f5bf0d6bb28ca5ef8775a3f4" name="tests/059.phpt" role="test" />
   <file md5sum="476d1ec8b4cc4f24591e4e1a6c5d9302" name="tests/060.phpt" role="test" />
   <file md5sum="7b9e09f0fe00d7ba8ad111aae9f2b742" name="tests/bug7952.phpt" role="test" />
   <file md5sum="d3a2b0f05a9a9c3e41f0eead48ba39f9" name="tests/bug7953.phpt" role="test" />
   <file md5sum="83300097520057fca484c85fe83bf1c2" name="tests/terse_003.phpt" role="test" />
   <file md5sum="734726ae75b17dfc6933d28d7519b917" name="tests/terse_004.phpt" role="test" />
   <file md5sum="8fb2defc44500fc94397698240cc77ff" name="tests/terse_006.phpt" role="test" />
   <file md5sum="fd5c2c30286d2d585883061e40967356" name="tests/terse_011.phpt" role="test" />
   <file md5sum="70e49f629d4342f0e0f7a97b704fc3fe" name="tests/terse_012.phpt" role="test" />
   <file md5sum="802a96fcc213e96d52cfd4f15a40c947" name="tests/terse_017.phpt" role="test" />
   <file md5sum="0b6a19a1eb2204bf2d32f5e562f1393f" name="tests/terse_018.phpt" role="test" />
   <file md5sum="05eea4d3cf7475aa1f62029f31ebc591" name="tests/terse_019.phpt" role="test" />
   <file md5sum="668e8c0ec608fc8ee17bb94c9d196a72" name="tests/terse_020.phpt" role="test" />
   <file md5sum="eda1cb3c2454bb92c530ef6db213e0e0" name="tests/terse_060.phpt" role="test" />
   <file md5sum="07e4fe2490def6614bc44dc7392656de" name="tests/setup.php.inc" role="test" />
   <file md5sum="7ec87da693c9d1a4fb3b5ada3074009d" name="config.m4" role="src" />
   <file md5sum="673cc355baebba7be2cd207879067018" name="config.w32" role="src" />
   <file md5sum="a47ac1436b6f711c63a205ce120c4819" name="CREDITS" role="doc" />
   <file md5sum="d41d8cd98f00b204e9800998ecf8427e" name="EXPERIMENTAL" role="src" />
   <file md5sum="050753ba071ad51476f98ffaf8a4389e" name="docblock.c" role="src" />
   <file md5sum="39d27493c7f257b9dd44a4c1da5795b7" name="docblock_scan.c" role="src" />
   <file md5sum="4cd5ace73cde000c8d1f30390e252a4f" name="docblock_scan.h" role="src" />
   <file md5sum="a578e9f6f126f9ae94673f07b960ad03" name="docblock_scan.re" role="src" />
   <file md5sum="a6b87a3e2ab1af5d00e29161a334feb3" name="Makefile.frag" role="src" />
   <file md5sum="2b2120e05e54ddee7087653efbb52801" name="php_docblock.h" role="src" />
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.1.0b1</min>
   </php>
   <pearinstaller>
    <min>1.4.3</min>
   </pearinstaller>
  </required>
 </dependencies>
 <providesextension>docblock</providesextension>
 <extsrcrelease />
</package>
                                                                                                                                                                                                                                                                                                                                                                                                                                       docblock-0.2.0/tests/001.phpt                                                                       100644    1751     144          320 10450341002  10767                                                                                                                                                                                                                                                                                                                                                                      --TEST--
Check for docblock presence
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php 
echo "docblock extension is available";
?>
--EXPECT--
docblock extension is available
                                                                                                                                                                                                                                                                                                                docblock-0.2.0/tests/002.phpt                                                                       100644    1751     144         1006 10450341002  11012                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** */
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize('/***/'));
test_docblock(docblock_tokenize('/** */'));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          docblock-0.2.0/tests/003.phpt                                                                       100644    1751     144         1065 10450341002  11020                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n*/"));
test_docblock(docblock_tokenize("/**\r\n*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(2) "
"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           docblock-0.2.0/tests/004.phpt                                                                       100644    1751     144          652 10450341002  11002                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n 		*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(3) " 		"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                      docblock-0.2.0/tests/005.phpt                                                                       100644    1751     144          645 10450341002  11005                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n**/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n**/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                           docblock-0.2.0/tests/006.phpt                                                                       100644    1751     144          750 10450341002  11003                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\ngobble\n**/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\ngobble\n*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(20) "DOCBLOCK_IGNOREDLINE"
string(6) "gobble"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                        docblock-0.2.0/tests/007.phpt                                                                       100644    1751     144          647 10450341002  11011                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n */
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n */"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                         docblock-0.2.0/tests/008.phpt                                                                       100644    1751     144          726 10450341002  11010                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n **/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n **/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                          docblock-0.2.0/tests/009.phpt                                                                       100644    1751     144          753 10450341002  11011                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n gobble**/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n gobble**/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(20) "DOCBLOCK_IGNOREDLINE"
string(7) "gobble*"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                     docblock-0.2.0/tests/010.phpt                                                                       100644    1751     144         1033 10450341002  11011                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n gobble*\n*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n gobble*\n*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(20) "DOCBLOCK_IGNOREDLINE"
string(7) "gobble*"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     docblock-0.2.0/tests/011.phpt                                                                       100644    1751     144          600 10450341002  10771                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**normal*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**normal*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(13) "DOCBLOCK_TEXT"
string(6) "normal"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                                                docblock-0.2.0/tests/012.phpt                                                                       100644    1751     144          660 10450341002  11000                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**normal*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** normal*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(13) "DOCBLOCK_TEXT"
string(6) "normal"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                docblock-0.2.0/tests/013.phpt                                                                       100644    1751     144          645 10450341002  11004                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n**/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n**/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                           docblock-0.2.0/tests/014.phpt                                                                       100644    1751     144          734 10450341002  11004                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n  	**/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n  	**/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(3) "  	"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                    docblock-0.2.0/tests/015.phpt                                                                       100644    1751     144         1007 10450341002  11017                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n * */
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n * */"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         docblock-0.2.0/tests/016.phpt                                                                       100644    1751     144         1067 10450341002  11026                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n \n* */
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n \n* */"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                                                                                                                                                                                                                                                                                                                                                                                         docblock-0.2.0/tests/017.phpt                                                                       100644    1751     144         1064 10450341002  11024                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n \n*@ */
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n \n*@ */"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(2) "@ "
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                                                                                                                                                                                                                                                                                                                                                                                            docblock-0.2.0/tests/018.phpt                                                                       100644    1751     144         1176 10450341002  11031                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n *t{@}{@*}*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n *t{@}{@*}*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(1) "t"
string(25) "DOCBLOCK_ESCAPEDINLINETAG"
string(3) "{@}"
string(25) "DOCBLOCK_ESCAPEDINLINETAG"
string(4) "{@*}"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                                                                                                                                                                                                                                                                                                                  docblock-0.2.0/tests/019.phpt                                                                       100644    1751     144         1231 10450341002  11022                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n *<<code>><</code>>*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n *<<code>><</code>><<.>>*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(20) "DOCBLOCK_ESCAPEDHTML"
string(8) "<<code>>"
string(20) "DOCBLOCK_ESCAPEDHTML"
string(9) "<</code>>"
string(13) "DOCBLOCK_TEXT"
string(5) "<<.>>"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                                                                                                                                                                                                                                                                                       docblock-0.2.0/tests/020.phpt                                                                       100644    1751     144         3237 10450341002  11022                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n *<samp><kbd></samp></kbd></b><b><i></i><p></p><p><ol><ul></li><li></ul></ol><var></var><br><br /><br/>*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n *<samp><kbd></samp></kbd></b><b><i></i><p></p><p><ol><ul></li><li></ul></ol><var></var><br><br /><br/>*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(17) "DOCBLOCK_SAMPOPEN"
string(6) "<samp>"
string(16) "DOCBLOCK_KBDOPEN"
string(5) "<kbd>"
string(18) "DOCBLOCK_SAMPCLOSE"
string(7) "</samp>"
string(17) "DOCBLOCK_KBDCLOSE"
string(6) "</kbd>"
string(15) "DOCBLOCK_BCLOSE"
string(4) "</b>"
string(14) "DOCBLOCK_BOPEN"
string(3) "<b>"
string(14) "DOCBLOCK_IOPEN"
string(3) "<i>"
string(15) "DOCBLOCK_ICLOSE"
string(4) "</i>"
string(14) "DOCBLOCK_POPEN"
string(3) "<p>"
string(15) "DOCBLOCK_PCLOSE"
string(4) "</p>"
string(14) "DOCBLOCK_POPEN"
string(3) "<p>"
string(15) "DOCBLOCK_OLOPEN"
string(4) "<ol>"
string(15) "DOCBLOCK_ULOPEN"
string(4) "<ul>"
string(16) "DOCBLOCK_LICLOSE"
string(5) "</li>"
string(15) "DOCBLOCK_LIOPEN"
string(4) "<li>"
string(16) "DOCBLOCK_ULCLOSE"
string(5) "</ul>"
string(16) "DOCBLOCK_OLCLOSE"
string(5) "</ol>"
string(16) "DOCBLOCK_VAROPEN"
string(5) "<var>"
string(17) "DOCBLOCK_VARCLOSE"
string(6) "</var>"
string(11) "DOCBLOCK_BR"
string(4) "<br>"
string(11) "DOCBLOCK_BR"
string(6) "<br />"
string(11) "DOCBLOCK_BR"
string(5) "<br/>"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                                                                                                                                                                                                                                                                                 docblock-0.2.0/tests/021.phpt                                                                       100644    1751     144         3423 10450341002  11020                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n *<samp><kbd></samp></kbd></b><b><i></i><p></p><p><ol><ul></li><li></ul></ol><var></var><br><br /><br/>*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n *{@internal<samp><kbd></samp></kbd></b><b><i></i><p></p><p><ol><ul></li><li></ul></ol><var></var><br><br /><br/>}}*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(17) "DOCBLOCK_INTERNAL"
string(10) "{@internal"
string(17) "DOCBLOCK_SAMPOPEN"
string(6) "<samp>"
string(16) "DOCBLOCK_KBDOPEN"
string(5) "<kbd>"
string(18) "DOCBLOCK_SAMPCLOSE"
string(7) "</samp>"
string(17) "DOCBLOCK_KBDCLOSE"
string(6) "</kbd>"
string(15) "DOCBLOCK_BCLOSE"
string(4) "</b>"
string(14) "DOCBLOCK_BOPEN"
string(3) "<b>"
string(14) "DOCBLOCK_IOPEN"
string(3) "<i>"
string(15) "DOCBLOCK_ICLOSE"
string(4) "</i>"
string(14) "DOCBLOCK_POPEN"
string(3) "<p>"
string(15) "DOCBLOCK_PCLOSE"
string(4) "</p>"
string(14) "DOCBLOCK_POPEN"
string(3) "<p>"
string(15) "DOCBLOCK_OLOPEN"
string(4) "<ol>"
string(15) "DOCBLOCK_ULOPEN"
string(4) "<ul>"
string(16) "DOCBLOCK_LICLOSE"
string(5) "</li>"
string(15) "DOCBLOCK_LIOPEN"
string(4) "<li>"
string(16) "DOCBLOCK_ULCLOSE"
string(5) "</ul>"
string(16) "DOCBLOCK_OLCLOSE"
string(5) "</ol>"
string(16) "DOCBLOCK_VAROPEN"
string(5) "<var>"
string(17) "DOCBLOCK_VARCLOSE"
string(6) "</var>"
string(11) "DOCBLOCK_BR"
string(4) "<br>"
string(11) "DOCBLOCK_BR"
string(6) "<br />"
string(11) "DOCBLOCK_BR"
string(5) "<br/>"
string(20) "DOCBLOCK_ENDINTERNAL"
string(2) "}}"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                                                                                                                                                             docblock-0.2.0/tests/022.phpt                                                                       100644    1751     144         1431 10450341002  11016                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n *{@internal<<code>><</code>}}>*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n *{@internal<<code>><</code>><<.>>}}*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(17) "DOCBLOCK_INTERNAL"
string(10) "{@internal"
string(20) "DOCBLOCK_ESCAPEDHTML"
string(8) "<<code>>"
string(20) "DOCBLOCK_ESCAPEDHTML"
string(9) "<</code>>"
string(13) "DOCBLOCK_TEXT"
string(5) "<<.>>"
string(20) "DOCBLOCK_ENDINTERNAL"
string(2) "}}"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                                                                                                                                                       docblock-0.2.0/tests/023.phpt                                                                       100644    1751     144          602 10450341002  10776                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**#@+\n*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**#@+\n*/"));
?>
--EXPECT--
string(24) "DOCBLOCK_COMMENTTEMPLATE"
string(6) "/**#@+"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                                              docblock-0.2.0/tests/024.phpt                                                                       100644    1751     144          447 10450341002  11006                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**#@-*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**#@-*/"));
?>
--EXPECT--
string(27) "DOCBLOCK_COMMENTTEMPLATEEND"
string(8) "/**#@-*/"                                                                                                                                                                                                                         docblock-0.2.0/tests/025.phpt                                                                       100644    1751     144         2250 10450341002  11021                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**<code>\n* for($i = 0;$i < strlen('<var>');$i++) {\n* // <code> is ignored\n* }\n* </code>*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**<code>\n* for(\$i = 0;\$i < strlen('<var>');\$i++) {\n* // <code> is ignored\n* }\n* </code>*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(17) "DOCBLOCK_CODEOPEN"
string(6) "<code>"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(40) " for($i = 0;$i < strlen('<var>');$i++) {"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(21) " // <code> is ignored"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(2) " }"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(1) " "
string(18) "DOCBLOCK_CODECLOSE"
string(7) "</code>"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                                                        docblock-0.2.0/tests/026.phpt                                                                       100644    1751     144         2235 10450341002  11025                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**<pre>\n* for($i = 0;$i < strlen('<var>');$i++) {\n* // <pre> is ignored\n* }\n* </pre>*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**<pre>\n* for(\$i = 0;\$i < strlen('<var>');\$i++) {\n* // <pre> is ignored\n* }\n* </pre>*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_PREOPEN"
string(5) "<pre>"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(40) " for($i = 0;$i < strlen('<var>');$i++) {"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(20) " // <pre> is ignored"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(2) " }"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(1) " "
string(17) "DOCBLOCK_PRECLOSE"
string(6) "</pre>"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                                                                   docblock-0.2.0/tests/027.phpt                                                                       100644    1751     144         1113 10450341002  11020                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**<code><code><</code>></code>*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**<code><code><</code>></code>*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(17) "DOCBLOCK_CODEOPEN"
string(6) "<code>"
string(13) "DOCBLOCK_TEXT"
string(6) "<code>"
string(20) "DOCBLOCK_ESCAPEDHTML"
string(9) "<</code>>"
string(18) "DOCBLOCK_CODECLOSE"
string(7) "</code>"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                                                                                                                                                     docblock-0.2.0/tests/028.phpt                                                                       100644    1751     144         1075 10450341002  11030                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**<pre><pre><</pre>></pre>*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**<pre><pre><</pre>></pre>*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(16) "DOCBLOCK_PREOPEN"
string(5) "<pre>"
string(13) "DOCBLOCK_TEXT"
string(5) "<pre>"
string(20) "DOCBLOCK_ESCAPEDHTML"
string(8) "<</pre>>"
string(17) "DOCBLOCK_PRECLOSE"
string(6) "</pre>"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                   docblock-0.2.0/tests/029.phpt                                                                       100644    1751     144          670 10450341002  11011                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**{@test}*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**{@test}*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(18) "DOCBLOCK_INLINETAG"
string(6) "{@test"
string(21) "DOCBLOCK_ENDINLINETAG"
string(1) "}"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                        docblock-0.2.0/tests/030.phpt                                                                       100644    1751     144         1013 10450341002  11011                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**{@\n*test}*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**{@\n*test}*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(13) "DOCBLOCK_TEXT"
string(2) "{@"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(5) "test}"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     docblock-0.2.0/tests/031.phpt                                                                       100644    1751     144         1030 10450341002  11011                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**{@test\n*}*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**{@test\n*}*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(18) "DOCBLOCK_INLINETAG"
string(6) "{@test"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(21) "DOCBLOCK_ENDINLINETAG"
string(1) "}"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        docblock-0.2.0/tests/032.phpt                                                                       100644    1751     144         1245 10450341002  11022                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**{@test contents \}\n*}*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**{@test contents \}\n*}*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(18) "DOCBLOCK_INLINETAG"
string(6) "{@test"
string(26) "DOCBLOCK_INLINETAGCONTENTS"
string(10) " contents "
string(25) "DOCBLOCK_ESCAPEDINLINEEND"
string(2) "\}"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(21) "DOCBLOCK_ENDINLINETAG"
string(1) "}"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                                                                                                                                                                                                                                                                           docblock-0.2.0/tests/033.phpt                                                                       100644    1751     144         1523 10450341002  11022                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**{@internal{@test contents \}\n*}} }}*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**{@internal{@test contents \}\n*}} }}*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(17) "DOCBLOCK_INTERNAL"
string(10) "{@internal"
string(18) "DOCBLOCK_INLINETAG"
string(6) "{@test"
string(26) "DOCBLOCK_INLINETAGCONTENTS"
string(10) " contents "
string(25) "DOCBLOCK_ESCAPEDINLINEEND"
string(2) "\}"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(21) "DOCBLOCK_ENDINLINETAG"
string(1) "}"
string(13) "DOCBLOCK_TEXT"
string(2) "} "
string(20) "DOCBLOCK_ENDINTERNAL"
string(2) "}}"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                                                                                             docblock-0.2.0/tests/034.phpt                                                                       100644    1751     144         2607 10450341002  11027                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**{@internal\n*<code>\n* for($i = 0;$i < strlen('<var>');$i++) {\n* // <code> is ignored\n* }\n* </code>}}*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**{@internal\n*<code>\n* for(\$i = 0;\$i < strlen('<var>');\$i++) {\n* // <code> is ignored\n* }\n* </code>}}*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(17) "DOCBLOCK_INTERNAL"
string(10) "{@internal"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(17) "DOCBLOCK_CODEOPEN"
string(6) "<code>"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(40) " for($i = 0;$i < strlen('<var>');$i++) {"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(21) " // <code> is ignored"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(2) " }"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(1) " "
string(18) "DOCBLOCK_CODECLOSE"
string(7) "</code>"
string(20) "DOCBLOCK_ENDINTERNAL"
string(2) "}}"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                         docblock-0.2.0/tests/035.phpt                                                                       100644    1751     144         2574 10450341002  11033                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**{@internal\n*<pre>\n* for($i = 0;$i < strlen('<var>');$i++) {\n* // <pre> is ignored\n* }\n* </pre>}}*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**{@internal\n*<pre>\n* for(\$i = 0;\$i < strlen('<var>');\$i++) {\n* // <pre> is ignored\n* }\n* </pre>}}*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(17) "DOCBLOCK_INTERNAL"
string(10) "{@internal"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(16) "DOCBLOCK_PREOPEN"
string(5) "<pre>"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(40) " for($i = 0;$i < strlen('<var>');$i++) {"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(20) " // <pre> is ignored"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(2) " }"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(1) " "
string(17) "DOCBLOCK_PRECLOSE"
string(6) "</pre>"
string(20) "DOCBLOCK_ENDINTERNAL"
string(2) "}}"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                    docblock-0.2.0/tests/036.phpt                                                                       100644    1751     144         1313 10450341002  11022                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**{@internal<code><code><</code>></code>}}*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**{@internal<code><code><</code>></code>}}*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(17) "DOCBLOCK_INTERNAL"
string(10) "{@internal"
string(17) "DOCBLOCK_CODEOPEN"
string(6) "<code>"
string(13) "DOCBLOCK_TEXT"
string(6) "<code>"
string(20) "DOCBLOCK_ESCAPEDHTML"
string(9) "<</code>>"
string(18) "DOCBLOCK_CODECLOSE"
string(7) "</code>"
string(20) "DOCBLOCK_ENDINTERNAL"
string(2) "}}"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                     docblock-0.2.0/tests/037.phpt                                                                       100644    1751     144         1275 10450341002  11032                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**{@internal<pre><pre><</pre>></pre>}}*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**{@internal<pre><pre><</pre>></pre>}}*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(17) "DOCBLOCK_INTERNAL"
string(10) "{@internal"
string(16) "DOCBLOCK_PREOPEN"
string(5) "<pre>"
string(13) "DOCBLOCK_TEXT"
string(5) "<pre>"
string(20) "DOCBLOCK_ESCAPEDHTML"
string(8) "<</pre>>"
string(17) "DOCBLOCK_PRECLOSE"
string(6) "</pre>"
string(20) "DOCBLOCK_ENDINTERNAL"
string(2) "}}"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                                   docblock-0.2.0/tests/038.phpt                                                                       100644    1751     144         1070 10450341002  11024                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**{@internal{@test}}}*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**{@internal{@test}}}*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(17) "DOCBLOCK_INTERNAL"
string(10) "{@internal"
string(18) "DOCBLOCK_INLINETAG"
string(6) "{@test"
string(21) "DOCBLOCK_ENDINLINETAG"
string(1) "}"
string(20) "DOCBLOCK_ENDINTERNAL"
string(2) "}}"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                                                                                                                                                                                                                                                                                                                                                                                        docblock-0.2.0/tests/039.phpt                                                                       100644    1751     144         1263 10450341002  11031                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**{@internal{@\n*test}}}*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**{@internal{@\n*test}}}*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(17) "DOCBLOCK_INTERNAL"
string(10) "{@internal"
string(13) "DOCBLOCK_TEXT"
string(2) "{@"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(4) "test"
string(20) "DOCBLOCK_ENDINTERNAL"
string(2) "}}"
string(13) "DOCBLOCK_TEXT"
string(1) "}"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                                             docblock-0.2.0/tests/040.phpt                                                                       100644    1751     144         1030 10450341002  11011                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**{@test\n*}*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**{@test\n*}*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(18) "DOCBLOCK_INLINETAG"
string(6) "{@test"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(21) "DOCBLOCK_ENDINLINETAG"
string(1) "}"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        docblock-0.2.0/tests/041.phpt                                                                       100644    1751     144         1370 10450341002  11021                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**<code>\n*@fopen('filename', 'rb');\n*</code>*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**<code>\n*@fopen('filename', 'rb');\n*</code>*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(17) "DOCBLOCK_CODEOPEN"
string(6) "<code>"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(25) "@fopen('filename', 'rb');"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(18) "DOCBLOCK_CODECLOSE"
string(7) "</code>"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                                                                                                                                                                                        docblock-0.2.0/tests/042.phpt                                                                       100644    1751     144         1021 10450341002  11013                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**@fopen('filename', 'rb');\n*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**@fopen('filename', 'rb');\n*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(12) "DOCBLOCK_TAG"
string(6) "@fopen"
string(13) "DOCBLOCK_TEXT"
string(19) "('filename', 'rb');"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               docblock-0.2.0/tests/043.phpt                                                                       100644    1751     144         1733 10450341002  11026                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**hi there\n* @author Greg Beaver <cellog@php.net>\n* @version 1.0.0*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**hi there\n* @author Greg Beaver <cellog@php.net>\n* @version 1.0.0*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(13) "DOCBLOCK_TEXT"
string(8) "hi there"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(12) "DOCBLOCK_TAG"
string(7) "@author"
string(13) "DOCBLOCK_TEXT"
string(29) " Greg Beaver <cellog@php.net>"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(12) "DOCBLOCK_TAG"
string(8) "@version"
string(13) "DOCBLOCK_TEXT"
string(6) " 1.0.0"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                     docblock-0.2.0/tests/044.phpt                                                                       100644    1751     144         1062 10450341002  11022                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** - simple list*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** - simple list*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(12) " simple list"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              docblock-0.2.0/tests/045.phpt                                                                       100644    1751     144         1142 10450341002  11022                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** - simple list\n*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** - simple list\n*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(12) " simple list"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                                                                                                                              docblock-0.2.0/tests/046.phpt                                                                       100644    1751     144         1223 10450341002  11023                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** - simple list\n */
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** - simple list\n */"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(12) " simple list"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                                                                             docblock-0.2.0/tests/047.phpt                                                                       100644    1751     144         1302 10450341002  11022                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** - simple list\n **/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** - simple list\n **/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(12) " simple list"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                              docblock-0.2.0/tests/048.phpt                                                                       100644    1751     144         1363 10450341002  11032                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** - simple list\n * */
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** - simple list\n * */"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(12) " simple list"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                             docblock-0.2.0/tests/049.phpt                                                                       100644    1751     144         1436 10450341002  11034                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** - simple list\n * -*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** - simple list\n * -*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(12) " simple list"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(13) "DOCBLOCK_TEXT"
string(1) "-"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                  docblock-0.2.0/tests/050.phpt                                                                       100644    1751     144         1525 10450341002  11023                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** - simple list\n * - */
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** - simple list\n * - */"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(12) " simple list"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(1) " "
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                           docblock-0.2.0/tests/051.phpt                                                                       100644    1751     144         1533 10450341002  11023                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** - simple list\n * - hi*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** - simple list\n * - hi*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(12) " simple list"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(3) " hi"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                     docblock-0.2.0/tests/052.phpt                                                                       100644    1751     144         1371 10450341002  11024                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** - simple list\n * o hi*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** - simple list\n * o hi*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(12) " simple list"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(13) "DOCBLOCK_TEXT"
string(5) " o hi"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                       docblock-0.2.0/tests/053.phpt                                                                       100644    1751     144         1372 10450341002  11026                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** - simple list\n *  o hi*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** - simple list\n * o hi*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(12) " simple list"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(13) "DOCBLOCK_TEXT"
string(5) " o hi"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                      docblock-0.2.0/tests/054.phpt                                                                       100644    1751     144         1626 10450341002  11031                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** - simple list\n *   o hi*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** - simple list\n *   o hi*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(12) " simple list"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(3) "   "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "o"
string(13) "DOCBLOCK_TEXT"
string(3) " hi"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"                                                                                                          docblock-0.2.0/tests/055.phpt                                                                       100644    1751     144         1635 10450341002  11032                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** - simple list\n *     o hi*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** - simple list\n *     o hi*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(12) " simple list"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(5) "     "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "o"
string(13) "DOCBLOCK_TEXT"
string(3) " hi"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                   docblock-0.2.0/tests/056.phpt                                                                       100644    1751     144         2426 10450341002  11032                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** - simple list\n * stuff\n* 1. simple list\n* 3. oops*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** - simple list\n * stuff\n* 1. simple list\n* 3. oops*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(12) " simple list"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(13) "DOCBLOCK_TEXT"
string(5) "stuff"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(2) "1."
string(13) "DOCBLOCK_TEXT"
string(12) " simple list"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(13) "DOCBLOCK_TEXT"
string(8) " 3. oops"
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                          docblock-0.2.0/tests/057.phpt                                                                       100644    1751     144         3123 10450341002  11026                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** * one kind of list\n * * again\n*\n* + another kind\n* + second\n*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** * one kind of list\n * * again\n*\n* + another kind\n* + second\n*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(17) " one kind of list"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "*"
string(13) "DOCBLOCK_TEXT"
string(6) " again"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "+"
string(13) "DOCBLOCK_TEXT"
string(13) " another kind"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "+"
string(13) "DOCBLOCK_TEXT"
string(7) " second"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                                                                                                                                                                             docblock-0.2.0/tests/058.phpt                                                                       100644    1751     144         5401 10450341002  11030                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** 1. t\n* 2. t\n* 3. t\n* 4. t\n* 5. t\n* 6. t\n* 7. t\n* 8. t\n* 9. t\n* 10. t\n*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** 1. t\n* 2. t\n* 3. t\n* 4. t\n* 5. t\n* 6. t\n* 7. t\n* 8. t\n* 9. t\n* 10. t\n*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(2) "1."
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(2) "2."
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(2) "3."
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(2) "4."
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(2) "5."
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(2) "6."
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(2) "7."
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(2) "8."
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(2) "9."
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(3) "10."
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                               docblock-0.2.0/tests/059.phpt                                                                       100644    1751     144         5343 10450341002  11036                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/** 1 t\n* 2 t\n* 3 t\n* 4 t\n* 5 t\n* 6 t\n* 7 t\n* 8 t\n* 9 t\n* 10 t\n*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** 1 t\n* 2 t\n* 3 t\n* 4 t\n* 5 t\n* 6 t\n* 7 t\n* 8 t\n* 9 t\n* 10 t\n*/"));
?>
--EXPECT--
string(21) "DOCBLOCK_COMMENTSTART"
string(3) "/**"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "1"
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "2"
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "3"
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "4"
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "5"
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "6"
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "7"
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "8"
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "9"
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_ASTERISK"
string(1) "*"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(2) "10"
string(13) "DOCBLOCK_TEXT"
string(2) " t"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
                                                                                                                                                                                                                                                                                             docblock-0.2.0/tests/060.phpt                                                                       100644    1751     144          770 10450341002  11005                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**#@+ *//**#@-*/
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize('/**#@+ */'));
test_docblock(docblock_tokenize('/**#@-*/'));
?>
--EXPECT--
string(24) "DOCBLOCK_COMMENTTEMPLATE"
string(6) "/**#@+"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(19) "DOCBLOCK_COMMENTEND"
string(2) "*/"
string(27) "DOCBLOCK_COMMENTTEMPLATEEND"
string(8) "/**#@-*/"
        docblock-0.2.0/tests/bug7952.phpt                                                                   100644    1751     144         1734 10450341002  11625                                                                                                                                                                                                                                                                                                                                                                      --TEST--
bug #7952 (SIMPLELISTEND is dropped in terse mode)
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize('/**
 * - item 1
 * - item 2
 * - item 3
 */', true));
?>
--EXPECT--
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(24) "DOCBLOCK_SIMPLELISTSTART"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(7) " item 1"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(7) " item 2"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(25) "DOCBLOCK_SIMPLELISTBULLET"
string(1) "-"
string(13) "DOCBLOCK_TEXT"
string(7) " item 3"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(22) "DOCBLOCK_SIMPLELISTEND"
string(0) ""
                                    docblock-0.2.0/tests/bug7953.phpt                                                                   100644    1751     144         4034 10450341002  11622                                                                                                                                                                                                                                                                                                                                                                      --TEST--
bug #7952 (SIMPLELISTEND is dropped in terse mode)
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize('/**
 * <code>
 * {@internal oops }}
 * $stuff = 1;
 * </code>
 * <pre>
 * {@internal oops }}
 * $stuff = 1;
 * </pre>
 * {@internal oops }}
 * $stuff = 1;
 */', true));
?>
--EXPECT--
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_CODEOPEN"
string(6) "<code>"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(13) "DOCBLOCK_TEXT"
string(1) " "
string(17) "DOCBLOCK_INTERNAL"
string(10) "{@internal"
string(13) "DOCBLOCK_TEXT"
string(6) " oops "
string(20) "DOCBLOCK_ENDINTERNAL"
string(2) "}}"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(13) "DOCBLOCK_TEXT"
string(12) " $stuff = 1;"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(13) "DOCBLOCK_TEXT"
string(1) " "
string(18) "DOCBLOCK_CODECLOSE"
string(7) "</code>"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(16) "DOCBLOCK_PREOPEN"
string(5) "<pre>"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(13) "DOCBLOCK_TEXT"
string(1) " "
string(17) "DOCBLOCK_INTERNAL"
string(10) "{@internal"
string(13) "DOCBLOCK_TEXT"
string(6) " oops "
string(20) "DOCBLOCK_ENDINTERNAL"
string(2) "}}"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(13) "DOCBLOCK_TEXT"
string(12) " $stuff = 1;"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(13) "DOCBLOCK_TEXT"
string(1) " "
string(17) "DOCBLOCK_PRECLOSE"
string(6) "</pre>"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(17) "DOCBLOCK_INTERNAL"
string(10) "{@internal"
string(13) "DOCBLOCK_TEXT"
string(6) " oops "
string(20) "DOCBLOCK_ENDINTERNAL"
string(2) "}}"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(13) "DOCBLOCK_TEXT"
string(11) "$stuff = 1;"
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    docblock-0.2.0/tests/terse_003.phpt                                                                 100644    1751     144          601 10450341002  12175                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n*/ terse
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n*/", true));
test_docblock(docblock_tokenize("/**\r\n*/", true));
?>
--EXPECT--
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(16) "DOCBLOCK_NEWLINE"
string(2) "
"
                                                                                                                               docblock-0.2.0/tests/terse_004.phpt                                                                 100644    1751     144          442 10450341002  12201                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n*/ terse
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n 		*/", true));
?>
--EXPECT--
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"                                                                                                                                                                                                                              docblock-0.2.0/tests/terse_006.phpt                                                                 100644    1751     144          461 10450341002  12204                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\ngobble\n**/ terse
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\ngobble\n*/", true));
?>
--EXPECT--
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
                                                                                                                                                                                                               docblock-0.2.0/tests/terse_011.phpt                                                                 100644    1751     144          452 10450341002  12200                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**normal*/ terse
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**normal*/", true));
?>
--EXPECT--
string(13) "DOCBLOCK_TEXT"
string(6) "normal"
                                                                                                                                                                                                                      docblock-0.2.0/tests/terse_012.phpt                                                                 100644    1751     144          532 10450341002  12200                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**normal*/ terse
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/** normal*/", true));
?>
--EXPECT--
string(19) "DOCBLOCK_WHITESPACE"
string(1) " "
string(13) "DOCBLOCK_TEXT"
string(6) "normal"
                                                                                                                                                                      docblock-0.2.0/tests/terse_017.phpt                                                                 100644    1751     144          526 10450341002  12210                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n \n*@ */ terse
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n \n*@ */", true));
?>
--EXPECT--
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(13) "DOCBLOCK_TEXT"
string(2) "@ "
                                                                                                                                                                          docblock-0.2.0/tests/terse_018.phpt                                                                 100644    1751     144          714 10450341002  12210                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n *t{@}{@*}*/ terse
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n *t{@}{@*}*/", true));
?>
--EXPECT--
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(13) "DOCBLOCK_TEXT"
string(1) "t"
string(25) "DOCBLOCK_ESCAPEDINLINETAG"
string(3) "{@}"
string(25) "DOCBLOCK_ESCAPEDINLINETAG"
string(4) "{@*}"
                                                    docblock-0.2.0/tests/terse_019.phpt                                                                 100644    1751     144          747 10450341002  12217                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n *<<code>><</code>>*/ terse
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n *<<code>><</code>><<.>>*/", true));
?>
--EXPECT--
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(20) "DOCBLOCK_ESCAPEDHTML"
string(8) "<<code>>"
string(20) "DOCBLOCK_ESCAPEDHTML"
string(9) "<</code>>"
string(13) "DOCBLOCK_TEXT"
string(5) "<<.>>"
                         docblock-0.2.0/tests/terse_020.phpt                                                                 100644    1751     144         2755 10450341002  12230                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**\n *<samp><kbd></samp></kbd></b><b><i></i><p></p><p><ol><ul></li><li></ul></ol><var></var><br><br /><br/>*/ terse
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize("/**\n *<samp><kbd></samp></kbd></b><b><i></i><p></p><p><ol><ul></li><li></ul></ol><var></var><br><br /><br/>*/", true));
?>
--EXPECT--
string(16) "DOCBLOCK_NEWLINE"
string(1) "
"
string(17) "DOCBLOCK_SAMPOPEN"
string(6) "<samp>"
string(16) "DOCBLOCK_KBDOPEN"
string(5) "<kbd>"
string(18) "DOCBLOCK_SAMPCLOSE"
string(7) "</samp>"
string(17) "DOCBLOCK_KBDCLOSE"
string(6) "</kbd>"
string(15) "DOCBLOCK_BCLOSE"
string(4) "</b>"
string(14) "DOCBLOCK_BOPEN"
string(3) "<b>"
string(14) "DOCBLOCK_IOPEN"
string(3) "<i>"
string(15) "DOCBLOCK_ICLOSE"
string(4) "</i>"
string(14) "DOCBLOCK_POPEN"
string(3) "<p>"
string(15) "DOCBLOCK_PCLOSE"
string(4) "</p>"
string(14) "DOCBLOCK_POPEN"
string(3) "<p>"
string(15) "DOCBLOCK_OLOPEN"
string(4) "<ol>"
string(15) "DOCBLOCK_ULOPEN"
string(4) "<ul>"
string(16) "DOCBLOCK_LICLOSE"
string(5) "</li>"
string(15) "DOCBLOCK_LIOPEN"
string(4) "<li>"
string(16) "DOCBLOCK_ULCLOSE"
string(5) "</ul>"
string(16) "DOCBLOCK_OLCLOSE"
string(5) "</ol>"
string(16) "DOCBLOCK_VAROPEN"
string(5) "<var>"
string(17) "DOCBLOCK_VARCLOSE"
string(6) "</var>"
string(11) "DOCBLOCK_BR"
string(4) "<br>"
string(11) "DOCBLOCK_BR"
string(6) "<br />"
string(11) "DOCBLOCK_BR"
string(5) "<br/>"
                   docblock-0.2.0/tests/terse_060.phpt                                                                 100644    1751     144          653 10450341002  12207                                                                                                                                                                                                                                                                                                                                                                      --TEST--
/**#@+ *//**#@-*/ terse
--SKIPIF--
<?php if (!extension_loaded("docblock")) print "skip"; ?>
--FILE--
<?php
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'setup.php.inc';
test_docblock(docblock_tokenize('/**#@+ */', true));
test_docblock(docblock_tokenize('/**#@-*/', true));
?>
--EXPECT--
string(24) "DOCBLOCK_COMMENTTEMPLATE"
string(6) "/**#@+"
string(27) "DOCBLOCK_COMMENTTEMPLATEEND"
string(8) "/**#@-*/"
                                                                                     docblock-0.2.0/tests/setup.php.inc                                                                  100644    1751     144          232 10450341002  12215                                                                                                                                                                                                                                                                                                                                                                      <?php
function test_docblock($output)
{
	foreach ($output as $item) {
		var_dump(docblock_token_name($item[0]),$item[1]);
	}
}
error_reporting(E_ALL);
?>
                                                                                                                                                                                                                                                                                                                                                                      docblock-0.2.0/config.m4                                                                            100644    1751     144          567 10450341002  10154                                                                                                                                                                                                                                                                                                                                                                      dnl $Id: config.m4,v 1.2 2005/12/04 23:39:49 cellog Exp $
dnl config.m4 for extension docblock
PHP_ARG_ENABLE(docblock, whether to enable docblock tokenizer support,
[  --enable-docblock       Enable docblock tokenizer support], yes)

if test "$PHP_DOCBLOCK" != "no"; then
  PHP_NEW_EXTENSION(docblock, docblock.c docblock_scan.c, $ext_shared)
  PHP_ADD_MAKEFILE_FRAGMENT
fi
                                                                                                                                         docblock-0.2.0/config.w32                                                                           100644    1751     144          354 10450341002  10241                                                                                                                                                                                                                                                                                                                                                                      // $Id: config.w32,v 1.2 2005/11/18 02:43:04 rrichards Exp $
// vim:ft=javascript

ARG_ENABLE("docblock", "enable docblock tokenizer support", "no");

if (PHP_DOCBLOCK != "no") {
	EXTENSION("docblock", "docblock.c docblock_scan.c");
}

                                                                                                                                                                                                                                                                                    docblock-0.2.0/CREDITS                                                                              100644    1751     144           27 10450341002   7434                                                                                                                                                                                                                                                                                                                                                                      docblock
Gregory Beaver                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         docblock-0.2.0/EXPERIMENTAL                                                                         100644    1751     144            0 10450341002  10203                                                                                                                                                                                                                                                                                                                                                                      docblock-0.2.0/docblock.c                                                                           100644    1751     144        17415 10450341002  10431                                                                                                                                                                                                                                                                                                                                                                      /*
  +----------------------------------------------------------------------+
  | PHP Version 5                                                        |
  +----------------------------------------------------------------------+
  | Copyright (c) 1997-2005 The PHP Group                                |
  +----------------------------------------------------------------------+
  | This source file is subject to version 3.0 of the PHP license,       |
  | that is bundled with this package in the file LICENSE, and is        |
  | available through the world-wide-web at the following url:           |
  | http://www.php.net/license/3_0.txt.                                  |
  | If you did not receive a copy of the PHP license and are unable to   |
  | obtain it through the world-wide-web, please send a note to          |
  | license@php.net so we can mail you a copy immediately.               |
  +----------------------------------------------------------------------+
  | Author: Gregory Beaver <cellog@php.net>                              |
  +----------------------------------------------------------------------+
*/

/* $Id: docblock.c,v 1.7 2006/06/27 22:52:10 cellog Exp $ */

#ifdef HAVE_CONFIG_H
#include "config.h"
#endif

#include "php.h"
#include "php_ini.h"
#include "ext/standard/info.h"
#include "php_docblock.h"
#include "docblock_scan.h"

/* If you declare any globals in php_test.h uncomment this:
ZEND_DECLARE_MODULE_GLOBALS(test)
*/

/* True global resources - no need for thread safety here */
static int le_docblock;

/* {{{ docblock_functions[]
 *
 * Every user visible function must have an entry in docblock_functions[].
 */
function_entry docblock_functions[] = {
	PHP_FE(docblock_tokenize,	NULL)
	PHP_FE(docblock_token_name,	NULL)
	{NULL, NULL, NULL}
};
/* }}} */

/* {{{ docblock_module_entry
 */
zend_module_entry docblock_module_entry = {
#if ZEND_MODULE_API_NO >= 20010901
	STANDARD_MODULE_HEADER,
#endif
	"docblock",
	docblock_functions,
	PHP_MINIT(docblock),
	PHP_MSHUTDOWN(docblock),
	NULL,		/* request start */
	NULL,	/* request end */
	PHP_MINFO(docblock),
#if ZEND_MODULE_API_NO >= 20010901
	"0.1.0",
#endif
	STANDARD_MODULE_PROPERTIES
};
/* }}} */

#ifdef COMPILE_DL_DOCBLOCK
ZEND_GET_MODULE(docblock)
#endif

/* {{{ PHP_INI
 */
/* Remove comments and fill if you need to have entries in php.ini
PHP_INI_BEGIN()
    STD_PHP_INI_ENTRY("test.global_value",      "42", PHP_INI_ALL, OnUpdateLong, global_value, zend_test_globals, test_globals)
    STD_PHP_INI_ENTRY("test.global_string", "foobar", PHP_INI_ALL, OnUpdateString, global_string, zend_test_globals, test_globals)
PHP_INI_END()
*/
/* }}} */

/* {{{ php_docblock_init_globals
 */
/* Uncomment this function if you have INI entries
static void php_docblock_init_globals(zend_docblock_globals *docblock_globals)
{
	docblock_globals->global_value = 0;
	docblock_globals->global_string = NULL;
}
*/
/* }}} */
#define DOCBLOCK_DOREGISTER(macro)\
	macro("DOCBLOCK_NEWLINE",DOCB_NEWLINE)\
	macro("DOCBLOCK_WHITESPACE",DOCB_WHITESPACE)\
	macro("DOCBLOCK_ASTERISK",DOCB_ASTERISK)\
	macro("DOCBLOCK_IGNOREDLINE",DOCB_IGNOREDLINE)\
	macro("DOCBLOCK_TAG",DOCB_TAG)\
	macro("DOCBLOCK_INTERNAL",DOCB_INTERNAL)\
	macro("DOCBLOCK_INLINETAG",DOCB_INLINETAG)\
	macro("DOCBLOCK_COMMENTSTART",DOCB_COMMENTSTART)\
	macro("DOCBLOCK_ESCAPEDINLINETAG",DOCB_ESCAPEDINLINETAG)\
	macro("DOCBLOCK_INLINETAGCONTENTS",DOCB_INLINETAGCONTENTS)\
	macro("DOCBLOCK_ESCAPEDHTML",DOCB_ESCAPEDHTML)\
	macro("DOCBLOCK_CODEOPEN",DOCB_CODEOPEN)\
	macro("DOCBLOCK_PREOPEN",DOCB_PREOPEN)\
	macro("DOCBLOCK_SAMPOPEN",DOCB_SAMPOPEN)\
	macro("DOCBLOCK_VAROPEN",DOCB_VAROPEN)\
	macro("DOCBLOCK_KBDOPEN",DOCB_KBDOPEN)\
	macro("DOCBLOCK_POPEN",DOCB_POPEN)\
	macro("DOCBLOCK_BOPEN",DOCB_BOPEN)\
	macro("DOCBLOCK_IOPEN",DOCB_IOPEN)\
	macro("DOCBLOCK_OLOPEN",DOCB_OLOPEN)\
	macro("DOCBLOCK_ULOPEN",DOCB_ULOPEN)\
	macro("DOCBLOCK_LIOPEN",DOCB_LIOPEN)\
	macro("DOCBLOCK_CODECLOSE",DOCB_CODECLOSE)\
	macro("DOCBLOCK_PRECLOSE",DOCB_PRECLOSE)\
	macro("DOCBLOCK_SAMPCLOSE",DOCB_SAMPCLOSE)\
	macro("DOCBLOCK_VARCLOSE",DOCB_VARCLOSE)\
	macro("DOCBLOCK_KBDCLOSE",DOCB_KBDCLOSE)\
	macro("DOCBLOCK_PCLOSE",DOCB_PCLOSE)\
	macro("DOCBLOCK_BCLOSE",DOCB_BCLOSE)\
	macro("DOCBLOCK_ICLOSE",DOCB_ICLOSE)\
	macro("DOCBLOCK_OLCLOSE",DOCB_OLCLOSE)\
	macro("DOCBLOCK_ULCLOSE",DOCB_ULCLOSE)\
	macro("DOCBLOCK_LICLOSE",DOCB_LICLOSE)\
	macro("DOCBLOCK_BR",DOCB_BR)\
	macro("DOCBLOCK_COMMENTEND",DOCB_COMMENTEND)\
	macro("DOCBLOCK_TEXT",DOCB_TEXT)\
	macro("DOCBLOCK_ENDINLINETAG",DOCB_ENDINLINETAG)\
	macro("DOCBLOCK_ENDINTERNAL",DOCB_ENDINTERNAL)\
	macro("DOCBLOCK_ESCAPEDINLINEEND",DOCB_ESCAPEDINLINEEND)\
	macro("DOCBLOCK_COMMENTTEMPLATE",DOCB_COMMENTTEMPLATE)\
	macro("DOCBLOCK_COMMENTTEMPLATEEND",DOCB_COMMENTTEMPLATEEND)\
	macro("DOCBLOCK_SIMPLELISTSTART",DOCB_SIMPLELISTSTART)\
	macro("DOCBLOCK_SIMPLELISTEND",DOCB_SIMPLELISTEND)\
	macro("DOCBLOCK_SIMPLELISTBULLET",DOCB_SIMPLELISTBULLET)

/* {{{ PHP_MINIT_FUNCTION
 */
PHP_MINIT_FUNCTION(docblock)
{
#define RCONS(name,constname) REGISTER_LONG_CONSTANT(name,\
	 constname, CONST_CS | CONST_PERSISTENT);
	DOCBLOCK_DOREGISTER(RCONS)
	return SUCCESS;
#undef RCONS
}
/* }}} */

/* {{{ PHP_MSHUTDOWN_FUNCTION
 */
PHP_MSHUTDOWN_FUNCTION(docblock)
{
	/* uncomment this line if you have INI entries
	UNREGISTER_INI_ENTRIES();
	*/
	return SUCCESS;
}
/* }}} */

/* Remove if there's nothing to do at request start */
/* {{{ PHP_RINIT_FUNCTION
 */
PHP_RINIT_FUNCTION(docblock)
{
	return SUCCESS;
}
/* }}} */

/* Remove if there's nothing to do at request end */
/* {{{ PHP_RSHUTDOWN_FUNCTION
 */
PHP_RSHUTDOWN_FUNCTION(docblock)
{
	return SUCCESS;
}
/* }}} */

/* {{{ PHP_MINFO_FUNCTION
 */
PHP_MINFO_FUNCTION(docblock)
{
	php_info_print_table_start();
	php_info_print_table_header(2, "DocBlock Tokenizer support", "enabled");
	php_info_print_table_end();

	/* Remove comments if you have entries in php.ini
	DISPLAY_INI_ENTRIES();
	*/
}
/* }}} */


static char *
get_docblock_token_name(int token)
{
#define CASES(x,y) case y: return x;
	switch (token) {
		DOCBLOCK_DOREGISTER(CASES)
	}
#undef CASES
	return "UNKNOWN";
}
/* {{{ proto string docblock_token_name(int arg)
   Return the token name of an integer token */
PHP_FUNCTION(docblock_token_name)
{
	long token;
	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "l", &token)
			== FAILURE) {
		return;
	}
	RETURN_STRING(get_docblock_token_name(token), 1);
}
/* }}} */
/* {{{ proto array docblock_tokenize(string arg)
   Parse a T_DOC_COMMENT token for phpDocumentor tokens */
PHP_FUNCTION(docblock_tokenize)
{
	char *arg;
	zend_bool opt = 0, postasterisk = 0;
	int e;
	int len;
	zval *entry;
	docblock_Scanner *scan;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|b", &arg, &len, &opt)
			== FAILURE) {
		return;
	}

	scan = docblock_prepare_string(arg, len TSRMLS_CC);
	array_init(return_value);
	do {
SCAN_LOOP:
		e = docblock_scan(scan TSRMLS_CC);
		if (e) {
			if (opt) {
				/* in terse mode, ignore non-semantic tokens like **/
				switch (e) {
					case DOCB_COMMENTTEMPLATE :
					case DOCB_COMMENTTEMPLATEEND :
					break;
					case DOCB_COMMENTSTART :
					case DOCB_ASTERISK :
						postasterisk = 1;
						goto SCAN_LOOP;
					case DOCB_NEWLINE :
						if (postasterisk) {
							postasterisk = 0;
							break;
						} else {
							goto SCAN_LOOP;
						}
					case DOCB_COMMENTEND :
						docblock_finish_scan(scan TSRMLS_CC);
						return;
					case DOCB_SIMPLELISTEND :
						postasterisk = 1;
					default :
						if (!postasterisk) {
							goto SCAN_LOOP;
						}
				}
			}
			MAKE_STD_ZVAL(entry);
			array_init(entry);
			add_next_index_long(entry, e);
			add_next_index_string(entry, scan->current_token, 0);
			add_next_index_zval(return_value, entry);
		} else {
			break;
		}
	} while (1);
	docblock_finish_scan(scan TSRMLS_CC);
}
/* }}} */

/*
 * Local variables:
 * tab-width: 4
 * c-basic-offset: 4
 * End:
 * vim600: noet sw=4 ts=4 fdm=marker
 * vim<600: noet sw=4 ts=4
 */
                                                                                                                                                                                                                                                   docblock-0.2.0/docblock_scan.c                                                                      100644    1751     144       262660 10450341002  11461                                                                                                                                                                                                                                                                                                                                                                      /* Generated by re2c 0.10.1 on Tue Jun 27 18:34:07 2006 */
#line 1 "ext/docblock/docblock_scan.re"
/*
   +----------------------------------------------------------------------+
   | DocBlock Scanner                                                     |
   +----------------------------------------------------------------------+
   | Copyright (c) 2005 Gregory Beaver                                    |
   +----------------------------------------------------------------------+
   | This source file is subject to version 3.00 of the PHP license,      |
   | that is bundled with this package in the file LICENSE, and is        |
   | available through the world-wide-web at the following url:           |
   | http://www.php.net/license/3_00.txt.                                 |
   | If you did not receive a copy of the PHP license and are unable to   |
   | obtain it through the world-wide-web, please send a note to          |
   | license@php.net so we can mail you a copy immediately.               |
   +----------------------------------------------------------------------+
   | Authors: Gregory Beaver <cellog@php.net>                             |
   +----------------------------------------------------------------------+
*/

/* $Id: docblock_scan.c,v 1.17 2006/06/27 23:30:56 cellog Exp $ */

#include "zend_API.h"
#include "zend.h"
#include "docblock_scan.h"

/* #define DOCBLOCK_DEBUG */

/* re2c defines */
/* refill buffer - unused */
#define YYFILL(n)
/* character type */
#define YYCTYPE char
#define	YYCURSOR cursor
#define YYLIMIT s->length
#define YYMARKER s->ptr

#define DOCB_STATE(z) DOCBLOCK_SCAN_##z

#define DOCB_RET(t,z)\
	if (s->return_simplelist_end) {\
		cursor = s->token;\
		s->current_token = (char *)emalloc(cursor - s->token + 1);\
		s->current_token[0] = '\0';\
		s->return_simplelist_end = 0;\
		return DOCB_SIMPLELISTEND;\
	}\
	if (s->normalcursor) {\
		if (t == DOCB_SIMPLELISTEND) {\
			s->return_simplelist_end = 1;\
		} else {\
			s->return_simplelist_end = 0;\
		}\
		cursor = s->token;\
		s->token = s->normalcursor;\
		s->cursor = cursor;\
		s->current_token = (char *)emalloc(cursor - s->token + 1);\
		memcpy(s->current_token,s->token,cursor - s->token);\
		*(s->current_token + (cursor - s->token)) = '\0';\
		s->token = cursor;\
		s->normalcursor = 0;\
		return s->normaltoken;\
	}\
	s->cursor = cursor;\
	s->current_token = (char *)emalloc(cursor - s->token + 1);\
	memcpy(s->current_token,s->token,cursor - s->token);\
	*(s->current_token + (cursor - s->token)) = '\0';\
	s->token = cursor;\
	s->state = DOCB_STATE(z);\
	return t;

#define DOCB_BEGIN(z) s->cursor = cursor;s->token = cursor;s->state = DOCB_STATE(z);goto z;
#define DOCB_BEGINT(tok,state)\
	if (!s->normalcursor) {\
		s->normalcursor = s->token;\
		s->normaltoken = tok;\
	}\
	DOCB_BEGIN(state)


/* switch to proper error handling when the time is right*/
#define DOCB_ERROR(m) zend_printf(m);return -1;
#ifdef DOCBLOCK_DEBUG
#define DOCB_DB(message) tmp = (char *)emalloc(cursor - s->token + 1);\
	memcpy(tmp,s->token,cursor - s->token);\
	*(tmp + (cursor - s->token)) = '\0';\
	zend_printf(#message" (%.*s)\n", cursor - s->token, tmp);\
	efree(tmp);
#else
#define DOCB_DB(message)
#endif

#define DOCBLOCK_SCAN_START 1
#define DOCBLOCK_SCAN_LINESTART 2
#define DOCBLOCK_SCAN_PREASTERISK 3
#define DOCBLOCK_SCAN_POSTASTERISK 4
#define DOCBLOCK_SCAN_IGNOREDLINE 5
#define DOCBLOCK_SCAN_NORMAL 6
#define DOCBLOCK_SCAN_INTERNAL 7
#define DOCBLOCK_SCAN_INLINETAG 8
#define DOCBLOCK_SCAN_CODE 9
#define DOCBLOCK_SCAN_PRE 10
#define DOCBLOCK_SCAN_SIMPLELIST 11

typedef struct _docblock_simplelist {
	char	token[3];
	char	*whitespace;
} docblock_simplelist;

static docblock_simplelist *_docblock_new_item(docblock_Scanner *s,
					   const char *token,
					   const char *cursor, char *ptr)
{
	docblock_simplelist *listitem;
	listitem = (docblock_simplelist *) emalloc(sizeof (docblock_simplelist));
	/* note the whitespace*/
	listitem->whitespace = (char *) emalloc(ptr - token + 1);
	memcpy(listitem->whitespace, token, ptr - token);
	*(listitem->whitespace + (ptr - token)) = '\0';
	if (*ptr >= '1' && *ptr <= '9') {
		if (*(ptr + 1) == '.') {
			listitem->token[1] = '.';
		} else {
			listitem->token[1] = '\0';
		}
		listitem->token[0] = *ptr;
	} else {
		listitem->token[0] = *ptr;
		listitem->token[1] = '\0';
	}
	return listitem;
}

static void _docblock_simplelist_dtor(void *el)
{
/*	*((docblock_simplelist *) el)->whitespace = '\0';*/
/*	efree(((docblock_simplelist *) el)->whitespace);*/
}

static int _docblock_detect_new_simplelist(docblock_Scanner *s,
					   const char *token,
					   const char *cursor)
{
	int test, expt, need_dot, i;
	char *tmp, *ptr, expected_token[3];
	docblock_simplelist *testitem, *newitem;
	/* 1 = start new list, -1 = end list, 0 = error, 2 = carry on*/
	/* 3 = next list item*/
	need_dot = 0;
	expt = 0;
	test = 0;
	i = 0;
	tmp = (char *)emalloc(cursor - token + 1);
	memcpy(tmp, token, cursor - token);
	*(tmp + (cursor - token)) = '\0';
	ptr = tmp;
	expected_token[0] = '\0';
	expected_token[1] = '\0';
	expected_token[2] = '\0';
	while ((*ptr == ' ' || *ptr == '\t') && *ptr != '\0') ++ptr;

	if (*ptr == '\0') {
		/* error*/
		efree(tmp);
		return 0;
	}
	if (s->simplelist->count) {
		/* construct the next token we need to see*/
		testitem = (docblock_simplelist *) s->simplelist->tail->data;
		/* first, make sure the whitespace is identical.  If not, we*/
		/* need to be looking for other lists*/
		if ((ptr - tmp) > strlen(testitem->whitespace)) {
			if ((ptr - tmp) >= strlen(testitem->whitespace) + 1) {
				goto LOOK_FOR_OTHER_LISTS;
			} else {
				efree(tmp);
				/* a simple list has ended*/
				zend_llist_remove_tail(s->simplelist);
				return -1;
			}
		}
		if ((ptr - tmp) < strlen(testitem->whitespace)) {
			/* no need to continue, this list is over*/
			efree(tmp);
			/* a simple list has ended*/
			zend_llist_remove_tail(s->simplelist);
			return -1;
		}
		expected_token[0] = testitem->token[0];
		expected_token[1] = testitem->token[1];
		expected_token[2] = testitem->token[2];
		if (expected_token[0] >= '1' && expected_token[0] <= '9') {
			expt = (expected_token[0] - '1' + 1);
			if (expected_token[1] >= '1' && expected_token[1] <= '0') {
				if (expected_token[2] == '.') {
					need_dot = 1;
				}
				expt *= 10;
				expt += expected_token[1] - '1' + 1;
			} else {
				if (expected_token[1] == '.') {
					need_dot = 1;
				}
			}
			expt++;
			if (expt > 99) {
				/* this is a ridiculous list - who needs 99+*/
				/* simple list entries in a docblock??!*/
				zend_llist_remove_tail(s->simplelist);
				efree(tmp);
				/* end this list*/
				return -1;
			}
			expected_token[1] = '\0';
			expected_token[2] = '\0';
			if (sprintf(expected_token, "%d", expt)) {
				if (need_dot) {
					if (expected_token[1] == '\0') {
						expected_token[1] = '.';
					} else {
						expected_token[2] = '.';
					}
				}
			}
		}
		/* assume match*/
		test = 0;
		for (i = 0; i < 3; i++) {
			if (expected_token[i] == '\0') {
				break;
			}
			if (*(ptr + i) != expected_token[i]) {
				test = 1;
				break;
			}
		}
		if (!test) {
			/* bullet must always be followed by whitespace to*/
			/* be a simple list item*/
			if (*(ptr + i) != ' ' && *(ptr + i) != '\t') {
				test = 1;
			} else {
				/* save the expected token for the next list item*/
				testitem->token[0] = expected_token[0];
				testitem->token[1] = expected_token[1];
				testitem->token[2] = expected_token[2];
			}
		}
	} else {
LOOK_FOR_OTHER_LISTS:
		testitem = 0;
		/* test for tokens*/
		test = (*ptr != '*' && *ptr != '-' && *ptr != 'o' && *ptr != '+');
		i = 1;
		/* test is set if no unordered bullets were found*/
		if (test) {
			test = (*ptr != '1');
			if (!test) {
				if (*(ptr + 1) == '.') i++;
			}
		}
		/* a simplelist bullet was found*/
		if (!test) {
			/* bullet must always be followed by whitespace to*/
			/* be a simple list item*/
			if (*(ptr + i) != ' ' && *(ptr + i) != '\t') {
				test = 1;
			}
		}
	}
	/* no simple list tokens were matched*/
	if (test) {
		/* no new simplelist item*/
		if (testitem) {
			/* we need whitespace like so:*/
			/* - simplelist*/
			/*   continued line*/
			/* meaning we need 2 extra whitespace tokens*/
			if ((ptr - tmp) >= strlen(testitem->whitespace) + 2) {
				efree(tmp);
				/* continue existing list item*/
				return 2;
			} else {
				/* a simple list has ended*/
				zend_llist_remove_tail(s->simplelist);
				efree(tmp);
				return -1;
			}
		} else {
			/* no simple list*/
			efree(tmp);
			/* continue non-simple list text*/
			return 2;
		}
	} else {
		/* simple list tokens matched*/
		if (testitem) {
			/* we need identical whitespace like so:*/
			/* - simplelist item 1*/
			/* - simplelist item 2*/
			/* otherwise we have a new list*/
			if ((ptr - tmp) > strlen(testitem->whitespace)) {
				newitem = _docblock_new_item(s, token, cursor,
					(char *) ((ptr - tmp) + token));
				zend_llist_add_element(s->simplelist, newitem);
				efree(tmp);
				_docblock_simplelist_dtor(newitem);
				/* start nested list*/
				return 1;
			}
			if ((ptr - tmp) < strlen(testitem->whitespace)) {
				efree(tmp);
				zend_llist_remove_tail(s->simplelist);
				/* finish this list*/
				return -1;
			}
			/* continue with next list item*/
			efree(tmp);
			return 3;
		} else {
			/* brand new list*/
			newitem = _docblock_new_item(s, token, cursor,
				(char *) ((ptr - tmp) + token));
			zend_llist_add_element(s->simplelist, newitem);
			efree(newitem);
			efree(tmp);
			return 1;
		}
	}
}

PHP_DOCBLOCK_API docblock_Scanner *docblock_prepare_string(char *input_str, int length TSRMLS_DC)
{
	docblock_Scanner *scan;
	scan = (docblock_Scanner *)emalloc(sizeof (docblock_Scanner));
	scan->buffer = (char *)emalloc(length + 1);
	memcpy(scan->buffer, input_str, length + 1);
	scan->token = scan->buffer;
	scan->cursor = scan->token;
	scan->ptr = scan->cursor;
	scan->length = scan->buffer + length;
	scan->line = 0;
	scan->state = DOCBLOCK_SCAN_START;
	scan->in_internal = 0;
	scan->in_inlinetag = 0;
	scan->return_simplelist_end = 0;
	scan->in_code = 0;
	scan->in_pre = 0;
	scan->current_token = 0;
	scan->normalcursor = 0;
	scan->normaltoken = 0;
	scan->simplelist = (zend_llist *)emalloc(sizeof (zend_llist));
	zend_llist_init(scan->simplelist, sizeof (docblock_simplelist), _docblock_simplelist_dtor, 0);
	return scan;
}

PHP_DOCBLOCK_API void docblock_finish_scan(docblock_Scanner *s TSRMLS_DC)
{
	if (s) {
		if (s->simplelist->count) {
			zend_llist_destroy(s->simplelist);
		}
		efree(s->simplelist);
		if (s->buffer) {
			efree(s->buffer);
		}
		efree(s);
	}
}

PHP_DOCBLOCK_API int docblock_scan(docblock_Scanner *s TSRMLS_DC)
{
	char *cursor,*tmp;

	s->current_token = 0;
	if (s->cursor >= s->length) {
		if (s->normalcursor) {
			cursor = 0; /* nuke warning on windows*/
			/* unreturned output*/
			/* values are ignored, and the normalcursor will instead be returned*/
			DOCB_RET(0,IGNOREDLINE);
		}
		return 0;
	}
	cursor = s->cursor;
#line 393 "ext/docblock/docblock_scan.re"

#define DOCB_CASES(z) case DOCB_STATE(z):goto z;
	switch (s->state) {
		DOCB_CASES(START)
		DOCB_CASES(LINESTART)
		DOCB_CASES(PREASTERISK)
		DOCB_CASES(POSTASTERISK)
		DOCB_CASES(IGNOREDLINE)
		DOCB_CASES(NORMAL)
		DOCB_CASES(CODE)
		DOCB_CASES(PRE)
		DOCB_CASES(INLINETAG)
		DOCB_CASES(SIMPLELIST)
	}
#undef DOCB_CASES
START:
{

#line 406 "ext/docblock/docblock_scan.c"
	{
		YYCTYPE yych;
		unsigned int yyaccept = 0;

		if((YYLIMIT - YYCURSOR) < 8) YYFILL(8);
		yych = *YYCURSOR;
		if(yych == 0x0A) goto yy2;
		if(yych == '/') goto yy3;
		goto yy5;
yy2:
		YYCURSOR = YYMARKER;
		switch(yyaccept){
		case 1:	goto yy8;
		case 0:	goto yy4;
		}
yy3:
		yyaccept = 0;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych == '*') goto yy6;
yy4:
#line 421 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("SKIP");
	  --cursor;
	  DOCB_BEGIN(LINESTART);
	}
#line 432 "ext/docblock/docblock_scan.c"
yy5:
		yych = *++YYCURSOR;
		goto yy4;
yy6:
		yych = *++YYCURSOR;
		if(yych != '*') goto yy2;
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych == '#') goto yy9;
yy8:
#line 418 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("start comment")
	  DOCB_RET(DOCB_COMMENTSTART,POSTASTERISK);
	}
#line 447 "ext/docblock/docblock_scan.c"
yy9:
		yych = *++YYCURSOR;
		if(yych != '@') goto yy2;
		yych = *++YYCURSOR;
		if(yych == '+') goto yy11;
		if(yych == '-') goto yy13;
		goto yy2;
yy11:
		++YYCURSOR;
#line 415 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("start comment template")
	  DOCB_RET(DOCB_COMMENTTEMPLATE,POSTASTERISK);
	}
#line 461 "ext/docblock/docblock_scan.c"
yy13:
		yych = *++YYCURSOR;
		if(yych != '*') goto yy2;
		yych = *++YYCURSOR;
		if(yych != '/') goto yy2;
		++YYCURSOR;
#line 411 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("start comment template")
	  DOCB_RET(DOCB_COMMENTTEMPLATEEND,POSTASTERISK);
	}
#line 472 "ext/docblock/docblock_scan.c"
	}
}
#line 426 "ext/docblock/docblock_scan.re"

LINESTART:
{
	static unsigned char yybm[] = {
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0, 128,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		128,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
	};

#line 514 "ext/docblock/docblock_scan.c"
	{
		YYCTYPE yych;
		if((YYLIMIT - YYCURSOR) < 2) YYFILL(2);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 128) {
			goto yy24;
		}
		if(yych <= 0x0C) {
			if(yych == 0x0A) goto yy21;
			goto yy27;
		} else {
			if(yych <= 0x0D) goto yy23;
			if(yych != '*') goto yy27;
		}
		++YYCURSOR;
		if((yych = *YYCURSOR) == '/') goto yy29;
#line 450 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("asterisk")
	  DOCB_RET(DOCB_ASTERISK,POSTASTERISK);
	}
#line 535 "ext/docblock/docblock_scan.c"
yy21:
		++YYCURSOR;
yy22:
#line 443 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("newline (LINESTART)")
	  DOCB_RET(DOCB_NEWLINE,LINESTART);
	}
#line 543 "ext/docblock/docblock_scan.c"
yy23:
		yych = *++YYCURSOR;
		if(yych == 0x0A) goto yy21;
		goto yy22;
yy24:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 128) {
			goto yy24;
		}
#line 447 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("pre-asterisk whitespace")
	  DOCB_RET(DOCB_WHITESPACE,PREASTERISK);
	}
#line 559 "ext/docblock/docblock_scan.c"
yy27:
		++YYCURSOR;
#line 454 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("SKIP")
	  --cursor;
	  DOCB_BEGIN(IGNOREDLINE);
	}
#line 567 "ext/docblock/docblock_scan.c"
yy29:
		++YYCURSOR;
#line 429 "ext/docblock/docblock_scan.re"
		{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			/* don't cut out multiple list end tokens*/
			/* when we need to*/
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end 1")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  DOCB_DB("end comment")
	  DOCB_RET(DOCB_COMMENTEND,LINESTART);
	}
#line 584 "ext/docblock/docblock_scan.c"
	}
}
#line 458 "ext/docblock/docblock_scan.re"

IGNOREDLINE:
{
	static unsigned char yybm[] = {
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128,   0, 128, 128,   0, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128,   0, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
	};

#line 626 "ext/docblock/docblock_scan.c"
	{
		YYCTYPE yych;
		if((YYLIMIT - YYCURSOR) < 2) YYFILL(2);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 128) {
			goto yy38;
		}
		if(yych <= 0x0C) goto yy35;
		if(yych <= 0x0D) goto yy37;
		++YYCURSOR;
		if((yych = *YYCURSOR) == '/') goto yy41;
#line 481 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("ignored line")
	  DOCB_BEGINT(DOCB_IGNOREDLINE,IGNOREDLINE);
	}
#line 642 "ext/docblock/docblock_scan.c"
yy35:
		++YYCURSOR;
yy36:
#line 473 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("newline (IGNOREDLINE)")
	  DOCB_RET(DOCB_NEWLINE,LINESTART);
	}
#line 650 "ext/docblock/docblock_scan.c"
yy37:
		yych = *++YYCURSOR;
		if(yych == 0x0A) goto yy35;
		goto yy36;
yy38:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 128) {
			goto yy38;
		}
#line 477 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("ignored line")
	  DOCB_BEGINT(DOCB_IGNOREDLINE,IGNOREDLINE);
	}
#line 666 "ext/docblock/docblock_scan.c"
yy41:
		++YYCURSOR;
#line 461 "ext/docblock/docblock_scan.re"
		{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end 2")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  DOCB_DB("end comment")
	  DOCB_RET(DOCB_COMMENTEND,LINESTART);
	}
#line 681 "ext/docblock/docblock_scan.c"
	}
}
#line 484 "ext/docblock/docblock_scan.re"

PREASTERISK:
{

#line 689 "ext/docblock/docblock_scan.c"
	{
		YYCTYPE yych;
		if((YYLIMIT - YYCURSOR) < 2) YYFILL(2);
		yych = *YYCURSOR;
		if(yych <= 0x0C) {
			if(yych == 0x0A) goto yy47;
			goto yy50;
		} else {
			if(yych <= 0x0D) goto yy49;
			if(yych != '*') goto yy50;
		}
		++YYCURSOR;
		if((yych = *YYCURSOR) == '/') goto yy52;
#line 502 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("asterisk")
	  DOCB_RET(DOCB_ASTERISK,POSTASTERISK);
	}
#line 707 "ext/docblock/docblock_scan.c"
yy47:
		++YYCURSOR;
yy48:
#line 499 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("newline (PREASTERISK)")
	  DOCB_RET(DOCB_NEWLINE,LINESTART);
	}
#line 715 "ext/docblock/docblock_scan.c"
yy49:
		yych = *++YYCURSOR;
		if(yych == 0x0A) goto yy47;
		goto yy48;
yy50:
		++YYCURSOR;
#line 506 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("SKIP")
	  --cursor;
	  DOCB_BEGIN(IGNOREDLINE);
	}
#line 727 "ext/docblock/docblock_scan.c"
yy52:
		++YYCURSOR;
#line 487 "ext/docblock/docblock_scan.re"
		{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  DOCB_DB("end comment")
	  DOCB_RET(DOCB_COMMENTEND,LINESTART);
	}
#line 742 "ext/docblock/docblock_scan.c"
	}
}
#line 510 "ext/docblock/docblock_scan.re"

POSTASTERISK:
	if (s->in_inlinetag) {
		goto INLINETAG;
	}
	if (s->in_code) {
		goto CODE;
	}
	if (s->in_pre) {
		goto PRE;
	}
	goto NOTSIMPLELIST;
SIMPLELIST:
{
	static unsigned char yybm[] = {
		128, 128, 128, 128, 128, 128, 128, 128, 
		128,   0, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		  0, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
	};

#line 795 "ext/docblock/docblock_scan.c"
	{
		YYCTYPE yych;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 128) {
			goto yy57;
		}
yy57:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 128) {
			goto yy57;
		}
#line 524 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("simple list bullet");
	  DOCB_RET(DOCB_SIMPLELISTBULLET,NORMAL);
	}
#line 814 "ext/docblock/docblock_scan.c"
	}
}
#line 527 "ext/docblock/docblock_scan.re"

NOTSIMPLELIST:
	if (!s->in_internal) {
{
	static unsigned char yybm[] = {
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0, 128,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		128,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,   0,   0,   0,   0,   0,   0, 
		  0,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,   0,   0,   0,   0,  64, 
		  0,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,   0,   0,   0,   0,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
	};

#line 857 "ext/docblock/docblock_scan.c"
	{
		YYCTYPE yych;
		unsigned int yyaccept = 0;
		if((YYLIMIT - YYCURSOR) < 5) YYFILL(5);
		yych = *YYCURSOR;
		if(yych <= 0x1F) {
			if(yych <= 0x0A) {
				if(yych <= 0x08) goto yy69;
				if(yych <= 0x09) goto yy64;
				goto yy66;
			} else {
				if(yych == 0x0D) goto yy68;
				goto yy69;
			}
		} else {
			if(yych <= '*') {
				if(yych <= ' ') goto yy64;
				if(yych <= ')') goto yy69;
			} else {
				if(yych == '@') goto yy65;
				goto yy69;
			}
		}
		++YYCURSOR;
		if((yych = *YYCURSOR) == '/') goto yy95;
yy63:
#line 627 "ext/docblock/docblock_scan.re"
		{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end (.)")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  DOCB_DB("SKIP")
	  --cursor;
	  DOCB_BEGIN(NORMAL);
	}
#line 897 "ext/docblock/docblock_scan.c"
yy64:
		yych = *++YYCURSOR;
		if(yych == 0x0A) goto yy63;
		goto yy80;
yy65:
		yych = *++YYCURSOR;
		if(yych <= '_') {
			if(yych <= '@') goto yy63;
			if(yych <= 'Z') goto yy70;
			if(yych <= '^') goto yy63;
			goto yy70;
		} else {
			if(yych <= '`') goto yy63;
			if(yych <= 'z') goto yy70;
			if(yych <= '~') goto yy63;
			goto yy70;
		}
yy66:
		++YYCURSOR;
yy67:
#line 616 "ext/docblock/docblock_scan.re"
		{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end (\\n)")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  DOCB_DB("newline (POSTASTERISK)")
	  DOCB_RET(DOCB_NEWLINE,LINESTART);
	}
#line 930 "ext/docblock/docblock_scan.c"
yy68:
		yych = *++YYCURSOR;
		if(yych == 0x0A) goto yy66;
		goto yy67;
yy69:
		yych = *++YYCURSOR;
		goto yy63;
yy70:
		yyaccept = 0;
		YYMARKER = ++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 64) {
			goto yy70;
		}
		if(yych == '.') goto yy73;
yy72:
#line 580 "ext/docblock/docblock_scan.re"
		{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end (tag)")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  DOCB_DB("tag")
	  DOCB_RET(DOCB_TAG,NORMAL);
	}
#line 960 "ext/docblock/docblock_scan.c"
yy73:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= '_') {
			if(yych <= '@') goto yy74;
			if(yych <= 'Z') goto yy75;
			if(yych >= '_') goto yy75;
		} else {
			if(yych <= '`') goto yy74;
			if(yych <= 'z') goto yy75;
			if(yych >= 0x7F) goto yy75;
		}
yy74:
		YYCURSOR = YYMARKER;
		switch(yyaccept){
		case 2:	goto yy86;
		case 0:	goto yy72;
		case 1:	goto yy78;
		}
yy75:
		yyaccept = 0;
		YYMARKER = ++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= 'Z') {
			if(yych <= '/') {
				if(yych == '.') goto yy73;
				goto yy72;
			} else {
				if(yych <= '9') goto yy75;
				if(yych <= '@') goto yy72;
				goto yy75;
			}
		} else {
			if(yych <= '`') {
				if(yych == '_') goto yy75;
				goto yy72;
			} else {
				if(yych <= 'z') goto yy75;
				if(yych <= '~') goto yy72;
				goto yy75;
			}
		}
yy77:
		++YYCURSOR;
yy78:
#line 592 "ext/docblock/docblock_scan.re"
		{ switch (_docblock_detect_new_simplelist(s, s->token, cursor)) {
		case -1 : /* end list*/
			cursor = s->token;
			DOCB_DB("simple list end")
	  		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
		case 3 : /* next list item*/
			cursor = s->token + strlen(
			  ((docblock_simplelist *)s->simplelist->tail->data)->whitespace);
			DOCB_DB("simple list item whitespace")
			DOCB_RET(DOCB_WHITESPACE,SIMPLELIST);
		case 1 : /* start new list*/
			cursor = s->token + strlen(
			  ((docblock_simplelist *)s->simplelist->tail->data)->whitespace);
			DOCB_DB("simple list start whitespace")
			DOCB_RET(DOCB_SIMPLELISTSTART,SIMPLELIST);
		case 0 : /* error*/
		case 2 : /* carry on as you were*/
			cursor = s->token;
			while (*cursor == ' ' || *cursor == '\t') cursor++;
			DOCB_DB("pre-content whitespace (spaces .)")
			DOCB_RET(DOCB_WHITESPACE,NORMAL)
	  }
	}
#line 1032 "ext/docblock/docblock_scan.c"
yy79:
		++YYCURSOR;
		if((YYLIMIT - YYCURSOR) < 4) YYFILL(4);
		yych = *YYCURSOR;
yy80:
		if(yybm[0+yych] & 128) {
			goto yy79;
		}
		if(yych <= '-') {
			if(yych <= ')') {
				if(yych == 0x0A) goto yy78;
				goto yy77;
			} else {
				if(yych == ',') goto yy77;
			}
		} else {
			if(yych <= '?') {
				if(yych <= '0') goto yy77;
				if(yych <= '9') goto yy82;
				goto yy77;
			} else {
				if(yych <= '@') goto yy83;
				if(yych != 'o') goto yy77;
			}
		}
		yych = *++YYCURSOR;
		if(yych == 0x09) goto yy92;
		if(yych == ' ') goto yy92;
		goto yy78;
yy82:
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych <= ' ') {
			if(yych == 0x09) goto yy92;
			if(yych <= 0x1F) goto yy78;
			goto yy92;
		} else {
			if(yych <= '.') {
				if(yych <= '-') goto yy78;
				goto yy91;
			} else {
				if(yych <= '/') goto yy78;
				if(yych <= '9') goto yy90;
				goto yy78;
			}
		}
yy83:
		yych = *++YYCURSOR;
		if(yych <= '_') {
			if(yych <= '@') goto yy78;
			if(yych <= 'Z') goto yy84;
			if(yych <= '^') goto yy78;
		} else {
			if(yych <= '`') goto yy78;
			if(yych <= 'z') goto yy84;
			if(yych <= '~') goto yy78;
		}
yy84:
		yyaccept = 2;
		YYMARKER = ++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= 'Z') {
			if(yych <= '/') {
				if(yych == '.') goto yy87;
			} else {
				if(yych <= '9') goto yy84;
				if(yych >= 'A') goto yy84;
			}
		} else {
			if(yych <= '`') {
				if(yych == '_') goto yy84;
			} else {
				if(yych <= 'z') goto yy84;
				if(yych >= 0x7F) goto yy84;
			}
		}
yy86:
#line 567 "ext/docblock/docblock_scan.re"
		{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end (pre-tag)")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  cursor = s->token;
	  while (*cursor == ' ' || *cursor == '\t') cursor++;
	  DOCB_DB("pre-content whitespace (pre-tag)")
	  DOCB_RET(DOCB_WHITESPACE,POSTASTERISK);
	}
#line 1125 "ext/docblock/docblock_scan.c"
yy87:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= '_') {
			if(yych <= '@') goto yy74;
			if(yych <= 'Z') goto yy88;
			if(yych <= '^') goto yy74;
		} else {
			if(yych <= '`') goto yy74;
			if(yych <= 'z') goto yy88;
			if(yych <= '~') goto yy74;
		}
yy88:
		yyaccept = 2;
		YYMARKER = ++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= 'Z') {
			if(yych <= '/') {
				if(yych == '.') goto yy87;
				goto yy86;
			} else {
				if(yych <= '9') goto yy88;
				if(yych <= '@') goto yy86;
				goto yy88;
			}
		} else {
			if(yych <= '`') {
				if(yych == '_') goto yy88;
				goto yy86;
			} else {
				if(yych <= 'z') goto yy88;
				if(yych <= '~') goto yy86;
				goto yy88;
			}
		}
yy90:
		yych = *++YYCURSOR;
		if(yych <= 0x1F) {
			if(yych == 0x09) goto yy92;
			goto yy74;
		} else {
			if(yych <= ' ') goto yy92;
			if(yych != '.') goto yy74;
		}
yy91:
		yych = *++YYCURSOR;
		if(yych == 0x09) goto yy92;
		if(yych != ' ') goto yy74;
yy92:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych == 0x09) goto yy92;
		if(yych == ' ') goto yy92;
#line 543 "ext/docblock/docblock_scan.re"
		{ switch (_docblock_detect_new_simplelist(s, s->token, cursor)) {
		case -1 : /* end list*/
			cursor = s->token;
			DOCB_DB("simple list end")
	  		DOCB_RET(DOCB_SIMPLELISTEND,NORMAL);
		case 3 : /* next list item*/
			cursor = s->token + strlen(
			  ((docblock_simplelist *)s->simplelist->tail->data)->whitespace);
			DOCB_DB("simple list item whitespace")
			DOCB_RET(DOCB_WHITESPACE,SIMPLELIST);
		case 1 : /* start new list*/
			cursor = s->token + strlen(
			  ((docblock_simplelist *)s->simplelist->tail->data)->whitespace);
			DOCB_DB("simple list start whitespace")
			DOCB_RET(DOCB_SIMPLELISTSTART,SIMPLELIST);
		case 0 : /* error*/
		case 2 : /* carry on as you were*/
			cursor = s->token;
			while (*cursor == ' ' || *cursor == '\t') cursor++;
			DOCB_DB("pre-content whitespace (spaces .)")
			DOCB_RET(DOCB_WHITESPACE,NORMAL)
	  }
	}
#line 1206 "ext/docblock/docblock_scan.c"
yy95:
		++YYCURSOR;
#line 531 "ext/docblock/docblock_scan.re"
		{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end 3")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  DOCB_DB("end comment")
	  DOCB_RET(DOCB_COMMENTEND,LINESTART);
	}
#line 1221 "ext/docblock/docblock_scan.c"
	}
}
#line 639 "ext/docblock/docblock_scan.re"

	}
NORMAL:
	if (s->in_internal) {
{
	static unsigned char yybm[] = {
		 32,  32,  32,  32,  32,  32,  32,  32, 
		 32,  32,   0,  32,  32,   0,  32,  32, 
		 32,  32,  32,  32,  32,  32,  32,  32, 
		 32,  32,  32,  32,  32,  32,  32,  32, 
		 32,  32,  32,  32,  32,  32,  32,  32, 
		 32,  32,   0,  32,  32,  32,  32,  32, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160,  32,  32,   0,  32,  32,  32, 
		 32, 224, 224, 224, 224, 224, 224, 224, 
		224, 224, 224, 224, 224, 224, 224, 224, 
		224, 224, 224, 224, 224, 224, 224, 224, 
		224, 224, 224,  32,  32,  32,  32, 160, 
		 32, 224, 224, 224, 224, 224, 224, 224, 
		224, 224, 224, 224, 224, 224, 224, 224, 
		224, 224, 224, 224, 224, 224, 224, 224, 
		224, 224, 224,   0,  32,   0,  32, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
	};

#line 1265 "ext/docblock/docblock_scan.c"
	{
		YYCTYPE yych;
		unsigned int yyaccept = 0;
		if((YYLIMIT - YYCURSOR) < 7) YYFILL(7);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 32) {
			goto yy107;
		}
		if(yych <= ';') {
			if(yych <= 0x0C) goto yy104;
			if(yych <= 0x0D) goto yy106;
		} else {
			if(yych <= '<') goto yy103;
			if(yych <= '|') goto yy102;
			goto yy101;
		}
		++YYCURSOR;
		if((yych = *YYCURSOR) == '/') goto yy220;
yy100:
#line 767 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("normal text")
		DOCB_BEGINT(DOCB_TEXT,NORMAL);
		}
#line 1289 "ext/docblock/docblock_scan.c"
yy101:
		yych = *++YYCURSOR;
		if(yych == '}') goto yy218;
		goto yy100;
yy102:
		yyaccept = 0;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych == '@') goto yy208;
		goto yy100;
yy103:
		yyaccept = 0;
		yych = *(YYMARKER = ++YYCURSOR);
		switch(yych){
		case '/':	goto yy111;
		case '<':	goto yy121;
		case 'B':
		case 'b':	goto yy109;
		case 'C':
		case 'c':	goto yy120;
		case 'I':
		case 'i':	goto yy115;
		case 'K':
		case 'k':	goto yy118;
		case 'L':
		case 'l':	goto yy112;
		case 'O':
		case 'o':	goto yy114;
		case 'P':
		case 'p':	goto yy116;
		case 'S':
		case 's':	goto yy119;
		case 'U':
		case 'u':	goto yy113;
		case 'V':
		case 'v':	goto yy117;
		default:	goto yy100;
		}
yy104:
		++YYCURSOR;
yy105:
#line 763 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("newline (INTERNAL)")
		DOCB_RET(DOCB_NEWLINE,LINESTART);
		}
#line 1334 "ext/docblock/docblock_scan.c"
yy106:
		yych = *++YYCURSOR;
		if(yych == 0x0A) goto yy104;
		goto yy105;
yy107:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 32) {
			goto yy107;
		}
		goto yy100;
yy109:
		yych = *++YYCURSOR;
		if(yych <= 'Q') {
			if(yych == '>') goto yy200;
		} else {
			if(yych <= 'R') goto yy202;
			if(yych == 'r') goto yy202;
		}
yy110:
		YYCURSOR = YYMARKER;
		switch(yyaccept){
		case 1:	goto yy214;
		case 0:	goto yy100;
		}
yy111:
		yych = *++YYCURSOR;
		switch(yych){
		case 'B':
		case 'b':	goto yy167;
		case 'I':
		case 'i':	goto yy168;
		case 'K':
		case 'k':	goto yy164;
		case 'L':
		case 'l':	goto yy171;
		case 'O':
		case 'o':	goto yy169;
		case 'P':
		case 'p':	goto yy166;
		case 'S':
		case 's':	goto yy163;
		case 'U':
		case 'u':	goto yy170;
		case 'V':
		case 'v':	goto yy165;
		default:	goto yy110;
		}
yy112:
		yych = *++YYCURSOR;
		if(yych == 'I') goto yy160;
		if(yych == 'i') goto yy160;
		goto yy110;
yy113:
		yych = *++YYCURSOR;
		if(yych == 'L') goto yy157;
		if(yych == 'l') goto yy157;
		goto yy110;
yy114:
		yych = *++YYCURSOR;
		if(yych == 'L') goto yy154;
		if(yych == 'l') goto yy154;
		goto yy110;
yy115:
		yych = *++YYCURSOR;
		if(yych == '>') goto yy152;
		goto yy110;
yy116:
		yych = *++YYCURSOR;
		if(yych <= 'Q') {
			if(yych == '>') goto yy147;
			goto yy110;
		} else {
			if(yych <= 'R') goto yy146;
			if(yych == 'r') goto yy146;
			goto yy110;
		}
yy117:
		yych = *++YYCURSOR;
		if(yych == 'A') goto yy142;
		if(yych == 'a') goto yy142;
		goto yy110;
yy118:
		yych = *++YYCURSOR;
		if(yych == 'B') goto yy138;
		if(yych == 'b') goto yy138;
		goto yy110;
yy119:
		yych = *++YYCURSOR;
		if(yych == 'A') goto yy133;
		if(yych == 'a') goto yy133;
		goto yy110;
yy120:
		yych = *++YYCURSOR;
		if(yych == 'O') goto yy128;
		if(yych == 'o') goto yy128;
		goto yy110;
yy121:
		yych = *++YYCURSOR;
		if(yych == '/') goto yy122;
		if(yych == '>') goto yy110;
		goto yy124;
yy122:
		yych = *++YYCURSOR;
		if(yych == '>') goto yy110;
		goto yy124;
yy123:
		++YYCURSOR;
		if((YYLIMIT - YYCURSOR) < 2) YYFILL(2);
		yych = *YYCURSOR;
yy124:
		if(yybm[0+yych] & 64) {
			goto yy123;
		}
		if(yych != '>') goto yy110;
		yych = *++YYCURSOR;
		if(yych != '>') goto yy110;
		++YYCURSOR;
#line 673 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("escaped html tag")
		DOCB_RET(DOCB_ESCAPEDHTML,NORMAL);
		}
#line 1458 "ext/docblock/docblock_scan.c"
yy128:
		yych = *++YYCURSOR;
		if(yych == 'D') goto yy129;
		if(yych != 'd') goto yy110;
yy129:
		yych = *++YYCURSOR;
		if(yych == 'E') goto yy130;
		if(yych != 'e') goto yy110;
yy130:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy110;
		++YYCURSOR;
#line 677 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("code section begin")
		s->in_code = 1;
		DOCB_RET(DOCB_CODEOPEN,CODE);
		}
#line 1476 "ext/docblock/docblock_scan.c"
yy133:
		yych = *++YYCURSOR;
		if(yych == 'M') goto yy134;
		if(yych != 'm') goto yy110;
yy134:
		yych = *++YYCURSOR;
		if(yych == 'P') goto yy135;
		if(yych != 'p') goto yy110;
yy135:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy110;
		++YYCURSOR;
#line 687 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("samp open")
		DOCB_RET(DOCB_SAMPOPEN,NORMAL);
		}
#line 1493 "ext/docblock/docblock_scan.c"
yy138:
		yych = *++YYCURSOR;
		if(yych == 'D') goto yy139;
		if(yych != 'd') goto yy110;
yy139:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy110;
		++YYCURSOR;
#line 691 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("kbd open")
		DOCB_RET(DOCB_KBDOPEN,NORMAL);
		}
#line 1506 "ext/docblock/docblock_scan.c"
yy142:
		yych = *++YYCURSOR;
		if(yych == 'R') goto yy143;
		if(yych != 'r') goto yy110;
yy143:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy110;
		++YYCURSOR;
#line 695 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("var open")
		DOCB_RET(DOCB_VAROPEN,NORMAL);
		}
#line 1519 "ext/docblock/docblock_scan.c"
yy146:
		yych = *++YYCURSOR;
		if(yych == 'E') goto yy149;
		if(yych == 'e') goto yy149;
		goto yy110;
yy147:
		++YYCURSOR;
#line 699 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("p open")
		DOCB_RET(DOCB_POPEN,NORMAL);
		}
#line 1531 "ext/docblock/docblock_scan.c"
yy149:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy110;
		++YYCURSOR;
#line 682 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("pre section begin")
		s->in_pre = 1;
		DOCB_RET(DOCB_PREOPEN,PRE);
		}
#line 1541 "ext/docblock/docblock_scan.c"
yy152:
		++YYCURSOR;
#line 707 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("i open")
		DOCB_RET(DOCB_IOPEN,NORMAL);
		}
#line 1548 "ext/docblock/docblock_scan.c"
yy154:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy110;
		++YYCURSOR;
#line 711 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("ol open")
		DOCB_RET(DOCB_OLOPEN,NORMAL);
		}
#line 1557 "ext/docblock/docblock_scan.c"
yy157:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy110;
		++YYCURSOR;
#line 715 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("ul open")
		DOCB_RET(DOCB_ULOPEN,NORMAL);
		}
#line 1566 "ext/docblock/docblock_scan.c"
yy160:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy110;
		++YYCURSOR;
#line 719 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("li open")
		DOCB_RET(DOCB_LIOPEN,NORMAL);
		}
#line 1575 "ext/docblock/docblock_scan.c"
yy163:
		yych = *++YYCURSOR;
		if(yych == 'A') goto yy195;
		if(yych == 'a') goto yy195;
		goto yy110;
yy164:
		yych = *++YYCURSOR;
		if(yych == 'B') goto yy191;
		if(yych == 'b') goto yy191;
		goto yy110;
yy165:
		yych = *++YYCURSOR;
		if(yych == 'A') goto yy187;
		if(yych == 'a') goto yy187;
		goto yy110;
yy166:
		yych = *++YYCURSOR;
		if(yych == '>') goto yy185;
		goto yy110;
yy167:
		yych = *++YYCURSOR;
		if(yych == '>') goto yy183;
		goto yy110;
yy168:
		yych = *++YYCURSOR;
		if(yych == '>') goto yy181;
		goto yy110;
yy169:
		yych = *++YYCURSOR;
		if(yych == 'L') goto yy178;
		if(yych == 'l') goto yy178;
		goto yy110;
yy170:
		yych = *++YYCURSOR;
		if(yych == 'L') goto yy175;
		if(yych == 'l') goto yy175;
		goto yy110;
yy171:
		yych = *++YYCURSOR;
		if(yych == 'I') goto yy172;
		if(yych != 'i') goto yy110;
yy172:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy110;
		++YYCURSOR;
#line 755 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("li close")
		DOCB_RET(DOCB_LICLOSE,NORMAL);
		}
#line 1625 "ext/docblock/docblock_scan.c"
yy175:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy110;
		++YYCURSOR;
#line 751 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("ul close")
		DOCB_RET(DOCB_ULCLOSE,NORMAL);
		}
#line 1634 "ext/docblock/docblock_scan.c"
yy178:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy110;
		++YYCURSOR;
#line 747 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("ol close")
		DOCB_RET(DOCB_OLCLOSE,NORMAL);
		}
#line 1643 "ext/docblock/docblock_scan.c"
yy181:
		++YYCURSOR;
#line 743 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("i close")
		DOCB_RET(DOCB_ICLOSE,NORMAL);
		}
#line 1650 "ext/docblock/docblock_scan.c"
yy183:
		++YYCURSOR;
#line 739 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("b close")
		DOCB_RET(DOCB_BCLOSE,NORMAL);
		}
#line 1657 "ext/docblock/docblock_scan.c"
yy185:
		++YYCURSOR;
#line 735 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("p close")
		DOCB_RET(DOCB_PCLOSE,NORMAL);
		}
#line 1664 "ext/docblock/docblock_scan.c"
yy187:
		yych = *++YYCURSOR;
		if(yych == 'R') goto yy188;
		if(yych != 'r') goto yy110;
yy188:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy110;
		++YYCURSOR;
#line 731 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("var close")
		DOCB_RET(DOCB_VARCLOSE,NORMAL);
		}
#line 1677 "ext/docblock/docblock_scan.c"
yy191:
		yych = *++YYCURSOR;
		if(yych == 'D') goto yy192;
		if(yych != 'd') goto yy110;
yy192:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy110;
		++YYCURSOR;
#line 727 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("kbd close")
		DOCB_RET(DOCB_KBDCLOSE,NORMAL);
		}
#line 1690 "ext/docblock/docblock_scan.c"
yy195:
		yych = *++YYCURSOR;
		if(yych == 'M') goto yy196;
		if(yych != 'm') goto yy110;
yy196:
		yych = *++YYCURSOR;
		if(yych == 'P') goto yy197;
		if(yych != 'p') goto yy110;
yy197:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy110;
		++YYCURSOR;
#line 723 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("samp close")
		DOCB_RET(DOCB_SAMPCLOSE,NORMAL);
		}
#line 1707 "ext/docblock/docblock_scan.c"
yy200:
		++YYCURSOR;
#line 703 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("b open")
		DOCB_RET(DOCB_BOPEN,NORMAL);
		}
#line 1714 "ext/docblock/docblock_scan.c"
yy202:
		yych = *++YYCURSOR;
		if(yych <= '.') {
			if(yych != ' ') goto yy110;
		} else {
			if(yych <= '/') goto yy204;
			if(yych == '>') goto yy205;
			goto yy110;
		}
		yych = *++YYCURSOR;
		if(yych == '/') goto yy207;
		goto yy110;
yy204:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy110;
yy205:
		++YYCURSOR;
#line 759 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("br tag")
		DOCB_RET(DOCB_BR,NORMAL);
		}
#line 1736 "ext/docblock/docblock_scan.c"
yy207:
		yych = *++YYCURSOR;
		if(yych == '>') goto yy205;
		goto yy110;
yy208:
		yych = *++YYCURSOR;
		if(yych <= '_') {
			if(yych <= '@') {
				if(yych == '*') goto yy211;
				goto yy110;
			} else {
				if(yych <= 'Z') goto yy212;
				if(yych <= '^') goto yy110;
				goto yy212;
			}
		} else {
			if(yych <= '|') {
				if(yych <= '`') goto yy110;
				if(yych <= 'z') goto yy212;
				goto yy110;
			} else {
				if(yych <= '}') goto yy209;
				if(yych <= '~') goto yy110;
				goto yy212;
			}
		}
yy209:
		++YYCURSOR;
#line 664 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("escaped inline tag")
		DOCB_RET(DOCB_ESCAPEDINLINETAG,NORMAL);
		}
#line 1769 "ext/docblock/docblock_scan.c"
yy211:
		yych = *++YYCURSOR;
		if(yych == '}') goto yy209;
		goto yy110;
yy212:
		yyaccept = 1;
		YYMARKER = ++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 128) {
			goto yy212;
		}
		if(yych == '.') goto yy215;
yy214:
#line 668 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("inline tag start")
		s->in_inlinetag = 1;
		DOCB_RET(DOCB_INLINETAG,INLINETAG);
		}
#line 1789 "ext/docblock/docblock_scan.c"
yy215:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= '_') {
			if(yych <= '@') goto yy110;
			if(yych <= 'Z') goto yy216;
			if(yych <= '^') goto yy110;
		} else {
			if(yych <= '`') goto yy110;
			if(yych <= 'z') goto yy216;
			if(yych <= '~') goto yy110;
		}
yy216:
		yyaccept = 1;
		YYMARKER = ++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= 'Z') {
			if(yych <= '/') {
				if(yych == '.') goto yy215;
				goto yy214;
			} else {
				if(yych <= '9') goto yy216;
				if(yych <= '@') goto yy214;
				goto yy216;
			}
		} else {
			if(yych <= '`') {
				if(yych == '_') goto yy216;
				goto yy214;
			} else {
				if(yych <= 'z') goto yy216;
				if(yych <= '~') goto yy214;
				goto yy216;
			}
		}
yy218:
		++YYCURSOR;
#line 656 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("end internal")
		/* if normalcursor is set, this will be re-scanned*/
		if (!s->normalcursor) {
			s->in_internal = 0;
		}
		DOCB_RET(DOCB_ENDINTERNAL,NORMAL);
		}
#line 1837 "ext/docblock/docblock_scan.c"
yy220:
		++YYCURSOR;
#line 644 "ext/docblock/docblock_scan.re"
		{ if (s->simplelist->count) {
			if (!s->return_simplelist_end) {
				zend_llist_remove_tail(s->simplelist);
			}
			cursor = s->token; /* empty token*/
			DOCB_DB("simplelist end n1")
			DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
		}
		DOCB_DB("end comment")
		DOCB_RET(DOCB_COMMENTEND,LINESTART);
		}
#line 1852 "ext/docblock/docblock_scan.c"
	}
}
#line 770 "ext/docblock/docblock_scan.re"

	} /* if (s->in_internal)*/
/*NORMAL_TEXT:*/
{
	static unsigned char yybm[] = {
		 32,  32,  32,  32,  32,  32,  32,  32, 
		 32,  32,   0,  32,  32,   0,  32,  32, 
		 32,  32,  32,  32,  32,  32,  32,  32, 
		 32,  32,  32,  32,  32,  32,  32,  32, 
		 32,  32,  32,  32,  32,  32,  32,  32, 
		 32,  32,   0,  32,  32,  32,  32,  32, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160,  32,  32,   0,  32,  32,  32, 
		 32, 224, 224, 224, 224, 224, 224, 224, 
		224, 224, 224, 224, 224, 224, 224, 224, 
		224, 224, 224, 224, 224, 224, 224, 224, 
		224, 224, 224,  32,  32,  32,  32, 160, 
		 32, 224, 224, 224, 224, 224, 224, 224, 
		224, 224, 224, 224, 224, 224, 224, 224, 
		224, 224, 224, 224, 224, 224, 224, 224, 
		224, 224, 224,   0,  32,  32,  32, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
		160, 160, 160, 160, 160, 160, 160, 160, 
	};

#line 1895 "ext/docblock/docblock_scan.c"
	{
		YYCTYPE yych;
		unsigned int yyaccept = 0;
		if((YYLIMIT - YYCURSOR) < 11) YYFILL(11);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 32) {
			goto yy231;
		}
		if(yych <= 0x0C) goto yy228;
		if(yych <= 0x0D) goto yy230;
		if(yych <= ';') goto yy224;
		if(yych <= '<') goto yy227;
		goto yy226;
yy224:
		++YYCURSOR;
		if((yych = *YYCURSOR) == '/') goto yy351;
yy225:
#line 900 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("normal text")
	  DOCB_BEGINT(DOCB_TEXT,NORMAL);
	}
#line 1917 "ext/docblock/docblock_scan.c"
yy226:
		yyaccept = 0;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych == '@') goto yy332;
		goto yy225;
yy227:
		yyaccept = 0;
		yych = *(YYMARKER = ++YYCURSOR);
		switch(yych){
		case '/':	goto yy235;
		case '<':	goto yy245;
		case 'B':
		case 'b':	goto yy233;
		case 'C':
		case 'c':	goto yy244;
		case 'I':
		case 'i':	goto yy239;
		case 'K':
		case 'k':	goto yy242;
		case 'L':
		case 'l':	goto yy236;
		case 'O':
		case 'o':	goto yy238;
		case 'P':
		case 'p':	goto yy240;
		case 'S':
		case 's':	goto yy243;
		case 'U':
		case 'u':	goto yy237;
		case 'V':
		case 'v':	goto yy241;
		default:	goto yy225;
		}
yy228:
		++YYCURSOR;
yy229:
#line 896 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("newline (NORMAL)")
	  DOCB_RET(DOCB_NEWLINE,LINESTART);
	}
#line 1958 "ext/docblock/docblock_scan.c"
yy230:
		yych = *++YYCURSOR;
		if(yych == 0x0A) goto yy228;
		goto yy229;
yy231:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 32) {
			goto yy231;
		}
		goto yy225;
yy233:
		yych = *++YYCURSOR;
		if(yych <= 'Q') {
			if(yych == '>') goto yy324;
		} else {
			if(yych <= 'R') goto yy326;
			if(yych == 'r') goto yy326;
		}
yy234:
		YYCURSOR = YYMARKER;
		switch(yyaccept){
		case 2:	goto yy350;
		case 1:	goto yy334;
		case 0:	goto yy225;
		}
yy235:
		yych = *++YYCURSOR;
		switch(yych){
		case 'B':
		case 'b':	goto yy291;
		case 'I':
		case 'i':	goto yy292;
		case 'K':
		case 'k':	goto yy288;
		case 'L':
		case 'l':	goto yy295;
		case 'O':
		case 'o':	goto yy293;
		case 'P':
		case 'p':	goto yy290;
		case 'S':
		case 's':	goto yy287;
		case 'U':
		case 'u':	goto yy294;
		case 'V':
		case 'v':	goto yy289;
		default:	goto yy234;
		}
yy236:
		yych = *++YYCURSOR;
		if(yych == 'I') goto yy284;
		if(yych == 'i') goto yy284;
		goto yy234;
yy237:
		yych = *++YYCURSOR;
		if(yych == 'L') goto yy281;
		if(yych == 'l') goto yy281;
		goto yy234;
yy238:
		yych = *++YYCURSOR;
		if(yych == 'L') goto yy278;
		if(yych == 'l') goto yy278;
		goto yy234;
yy239:
		yych = *++YYCURSOR;
		if(yych == '>') goto yy276;
		goto yy234;
yy240:
		yych = *++YYCURSOR;
		if(yych <= 'Q') {
			if(yych == '>') goto yy271;
			goto yy234;
		} else {
			if(yych <= 'R') goto yy270;
			if(yych == 'r') goto yy270;
			goto yy234;
		}
yy241:
		yych = *++YYCURSOR;
		if(yych == 'A') goto yy266;
		if(yych == 'a') goto yy266;
		goto yy234;
yy242:
		yych = *++YYCURSOR;
		if(yych == 'B') goto yy262;
		if(yych == 'b') goto yy262;
		goto yy234;
yy243:
		yych = *++YYCURSOR;
		if(yych == 'A') goto yy257;
		if(yych == 'a') goto yy257;
		goto yy234;
yy244:
		yych = *++YYCURSOR;
		if(yych == 'O') goto yy252;
		if(yych == 'o') goto yy252;
		goto yy234;
yy245:
		yych = *++YYCURSOR;
		if(yych == '/') goto yy246;
		if(yych == '>') goto yy234;
		goto yy248;
yy246:
		yych = *++YYCURSOR;
		if(yych == '>') goto yy234;
		goto yy248;
yy247:
		++YYCURSOR;
		if((YYLIMIT - YYCURSOR) < 2) YYFILL(2);
		yych = *YYCURSOR;
yy248:
		if(yybm[0+yych] & 64) {
			goto yy247;
		}
		if(yych != '>') goto yy234;
		yych = *++YYCURSOR;
		if(yych != '>') goto yy234;
		++YYCURSOR;
#line 802 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("escaped html tag")
	  DOCB_RET(DOCB_ESCAPEDHTML,NORMAL);
	}
#line 2083 "ext/docblock/docblock_scan.c"
yy252:
		yych = *++YYCURSOR;
		if(yych == 'D') goto yy253;
		if(yych != 'd') goto yy234;
yy253:
		yych = *++YYCURSOR;
		if(yych == 'E') goto yy254;
		if(yych != 'e') goto yy234;
yy254:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy234;
		++YYCURSOR;
#line 806 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("code section begin")
	  if (!s->normalcursor) {
	  	s->in_code = 1;
	  }
	  DOCB_RET(DOCB_CODEOPEN,CODE);
	}
#line 2103 "ext/docblock/docblock_scan.c"
yy257:
		yych = *++YYCURSOR;
		if(yych == 'M') goto yy258;
		if(yych != 'm') goto yy234;
yy258:
		yych = *++YYCURSOR;
		if(yych == 'P') goto yy259;
		if(yych != 'p') goto yy234;
yy259:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy234;
		++YYCURSOR;
#line 820 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("samp open")
	  DOCB_RET(DOCB_SAMPOPEN,NORMAL);
	}
#line 2120 "ext/docblock/docblock_scan.c"
yy262:
		yych = *++YYCURSOR;
		if(yych == 'D') goto yy263;
		if(yych != 'd') goto yy234;
yy263:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy234;
		++YYCURSOR;
#line 824 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("kbd open")
	  DOCB_RET(DOCB_KBDOPEN,NORMAL);
	}
#line 2133 "ext/docblock/docblock_scan.c"
yy266:
		yych = *++YYCURSOR;
		if(yych == 'R') goto yy267;
		if(yych != 'r') goto yy234;
yy267:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy234;
		++YYCURSOR;
#line 828 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("var open")
	  DOCB_RET(DOCB_VAROPEN,NORMAL);
	}
#line 2146 "ext/docblock/docblock_scan.c"
yy270:
		yych = *++YYCURSOR;
		if(yych == 'E') goto yy273;
		if(yych == 'e') goto yy273;
		goto yy234;
yy271:
		++YYCURSOR;
#line 832 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("p open")
	  DOCB_RET(DOCB_POPEN,NORMAL);
	}
#line 2158 "ext/docblock/docblock_scan.c"
yy273:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy234;
		++YYCURSOR;
#line 813 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("pre section begin")
	  if (!s->normalcursor) {
	  	s->in_pre = 1;
	  }
	  DOCB_RET(DOCB_PREOPEN,PRE);
	}
#line 2170 "ext/docblock/docblock_scan.c"
yy276:
		++YYCURSOR;
#line 840 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("i open")
	  DOCB_RET(DOCB_IOPEN,NORMAL);
	}
#line 2177 "ext/docblock/docblock_scan.c"
yy278:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy234;
		++YYCURSOR;
#line 844 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("ol open")
	  DOCB_RET(DOCB_OLOPEN,NORMAL);
	}
#line 2186 "ext/docblock/docblock_scan.c"
yy281:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy234;
		++YYCURSOR;
#line 848 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("ul open")
	  DOCB_RET(DOCB_ULOPEN,NORMAL);
	}
#line 2195 "ext/docblock/docblock_scan.c"
yy284:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy234;
		++YYCURSOR;
#line 852 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("li open")
	  DOCB_RET(DOCB_LIOPEN,NORMAL);
	}
#line 2204 "ext/docblock/docblock_scan.c"
yy287:
		yych = *++YYCURSOR;
		if(yych == 'A') goto yy319;
		if(yych == 'a') goto yy319;
		goto yy234;
yy288:
		yych = *++YYCURSOR;
		if(yych == 'B') goto yy315;
		if(yych == 'b') goto yy315;
		goto yy234;
yy289:
		yych = *++YYCURSOR;
		if(yych == 'A') goto yy311;
		if(yych == 'a') goto yy311;
		goto yy234;
yy290:
		yych = *++YYCURSOR;
		if(yych == '>') goto yy309;
		goto yy234;
yy291:
		yych = *++YYCURSOR;
		if(yych == '>') goto yy307;
		goto yy234;
yy292:
		yych = *++YYCURSOR;
		if(yych == '>') goto yy305;
		goto yy234;
yy293:
		yych = *++YYCURSOR;
		if(yych == 'L') goto yy302;
		if(yych == 'l') goto yy302;
		goto yy234;
yy294:
		yych = *++YYCURSOR;
		if(yych == 'L') goto yy299;
		if(yych == 'l') goto yy299;
		goto yy234;
yy295:
		yych = *++YYCURSOR;
		if(yych == 'I') goto yy296;
		if(yych != 'i') goto yy234;
yy296:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy234;
		++YYCURSOR;
#line 888 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("li close")
	  DOCB_RET(DOCB_LICLOSE,NORMAL);
	}
#line 2254 "ext/docblock/docblock_scan.c"
yy299:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy234;
		++YYCURSOR;
#line 884 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("ul close")
	  DOCB_RET(DOCB_ULCLOSE,NORMAL);
	}
#line 2263 "ext/docblock/docblock_scan.c"
yy302:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy234;
		++YYCURSOR;
#line 880 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("ol close")
	  DOCB_RET(DOCB_OLCLOSE,NORMAL);
	}
#line 2272 "ext/docblock/docblock_scan.c"
yy305:
		++YYCURSOR;
#line 876 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("i close")
	  DOCB_RET(DOCB_ICLOSE,NORMAL);
	}
#line 2279 "ext/docblock/docblock_scan.c"
yy307:
		++YYCURSOR;
#line 872 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("b close")
	  DOCB_RET(DOCB_BCLOSE,NORMAL);
	}
#line 2286 "ext/docblock/docblock_scan.c"
yy309:
		++YYCURSOR;
#line 868 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("p close")
	  DOCB_RET(DOCB_PCLOSE,NORMAL);
	}
#line 2293 "ext/docblock/docblock_scan.c"
yy311:
		yych = *++YYCURSOR;
		if(yych == 'R') goto yy312;
		if(yych != 'r') goto yy234;
yy312:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy234;
		++YYCURSOR;
#line 864 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("var close")
	  DOCB_RET(DOCB_VARCLOSE,NORMAL);
	}
#line 2306 "ext/docblock/docblock_scan.c"
yy315:
		yych = *++YYCURSOR;
		if(yych == 'D') goto yy316;
		if(yych != 'd') goto yy234;
yy316:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy234;
		++YYCURSOR;
#line 860 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("kbd close")
	  DOCB_RET(DOCB_KBDCLOSE,NORMAL);
	}
#line 2319 "ext/docblock/docblock_scan.c"
yy319:
		yych = *++YYCURSOR;
		if(yych == 'M') goto yy320;
		if(yych != 'm') goto yy234;
yy320:
		yych = *++YYCURSOR;
		if(yych == 'P') goto yy321;
		if(yych != 'p') goto yy234;
yy321:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy234;
		++YYCURSOR;
#line 856 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("samp close")
	  DOCB_RET(DOCB_SAMPCLOSE,NORMAL);
	}
#line 2336 "ext/docblock/docblock_scan.c"
yy324:
		++YYCURSOR;
#line 836 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("b open")
	  DOCB_RET(DOCB_BOPEN,NORMAL);
	}
#line 2343 "ext/docblock/docblock_scan.c"
yy326:
		yych = *++YYCURSOR;
		if(yych <= '.') {
			if(yych != ' ') goto yy234;
		} else {
			if(yych <= '/') goto yy328;
			if(yych == '>') goto yy329;
			goto yy234;
		}
		yych = *++YYCURSOR;
		if(yych == '/') goto yy331;
		goto yy234;
yy328:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy234;
yy329:
		++YYCURSOR;
#line 892 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("br tag")
	  DOCB_RET(DOCB_BR,NORMAL);
	}
#line 2365 "ext/docblock/docblock_scan.c"
yy331:
		yych = *++YYCURSOR;
		if(yych == '>') goto yy329;
		goto yy234;
yy332:
		yych = *++YYCURSOR;
		if(yych <= '`') {
			if(yych <= '@') {
				if(yych == '*') goto yy337;
				goto yy234;
			} else {
				if(yych <= 'Z') goto yy338;
				if(yych == '_') goto yy338;
				goto yy234;
			}
		} else {
			if(yych <= 'z') {
				if(yych != 'i') goto yy338;
			} else {
				if(yych == '}') goto yy335;
				if(yych <= '~') goto yy234;
				goto yy338;
			}
		}
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych == 'n') goto yy343;
		goto yy339;
yy334:
#line 797 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("inline tag start")
	  s->in_inlinetag = 1;
	  DOCB_RET(DOCB_INLINETAG,INLINETAG);
	}
#line 2400 "ext/docblock/docblock_scan.c"
yy335:
		++YYCURSOR;
#line 793 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("escaped inline tag")
	  DOCB_RET(DOCB_ESCAPEDINLINETAG,NORMAL);
	}
#line 2407 "ext/docblock/docblock_scan.c"
yy337:
		yych = *++YYCURSOR;
		if(yych == '}') goto yy335;
		goto yy234;
yy338:
		yyaccept = 1;
		YYMARKER = ++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
yy339:
		if(yybm[0+yych] & 128) {
			goto yy338;
		}
		if(yych != '.') goto yy334;
yy340:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= '_') {
			if(yych <= '@') goto yy234;
			if(yych <= 'Z') goto yy341;
			if(yych <= '^') goto yy234;
		} else {
			if(yych <= '`') goto yy234;
			if(yych <= 'z') goto yy341;
			if(yych <= '~') goto yy234;
		}
yy341:
		yyaccept = 1;
		YYMARKER = ++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= 'Z') {
			if(yych <= '/') {
				if(yych == '.') goto yy340;
				goto yy334;
			} else {
				if(yych <= '9') goto yy341;
				if(yych <= '@') goto yy334;
				goto yy341;
			}
		} else {
			if(yych <= '`') {
				if(yych == '_') goto yy341;
				goto yy334;
			} else {
				if(yych <= 'z') goto yy341;
				if(yych <= '~') goto yy334;
				goto yy341;
			}
		}
yy343:
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 't') goto yy339;
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 'e') goto yy339;
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 'r') goto yy339;
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 'n') goto yy339;
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 'a') goto yy339;
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 'l') goto yy339;
		yyaccept = 2;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yybm[0+yych] & 128) {
			goto yy338;
		}
		if(yych == '.') goto yy340;
yy350:
#line 786 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("internal start")
	  if (!s->normalcursor) {
	  	s->in_internal = 1;
	  }
	  DOCB_RET(DOCB_INTERNAL,NORMAL);
	}
#line 2492 "ext/docblock/docblock_scan.c"
yy351:
		++YYCURSOR;
#line 774 "ext/docblock/docblock_scan.re"
		{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end n2")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  DOCB_DB("end comment")
	  DOCB_RET(DOCB_COMMENTEND,LINESTART);
	}
#line 2507 "ext/docblock/docblock_scan.c"
	}
}
#line 903 "ext/docblock/docblock_scan.re"

INLINETAG:
{
	static unsigned char yybm[] = {
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128,   0, 128, 128,   0, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128,   0, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128,   0, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
	};

#line 2549 "ext/docblock/docblock_scan.c"
	{
		YYCTYPE yych;
		if((YYLIMIT - YYCURSOR) < 3) YYFILL(3);
		yych = *YYCURSOR;
		if(yych <= ')') {
			if(yych <= 0x0A) {
				if(yych <= 0x09) goto yy360;
				goto yy363;
			} else {
				if(yych == 0x0D) goto yy362;
				goto yy360;
			}
		} else {
			if(yych <= '\\') {
				if(yych <= '*') goto yy355;
				if(yych <= '[') goto yy360;
				goto yy357;
			} else {
				if(yych == '}') goto yy358;
				goto yy360;
			}
		}
yy355:
		++YYCURSOR;
		if((yych = *YYCURSOR) == '/') goto yy367;
		goto yy361;
yy356:
#line 920 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("inline tag contents")
	  DOCB_BEGINT(DOCB_INLINETAGCONTENTS,INLINETAG);
	}
#line 2581 "ext/docblock/docblock_scan.c"
yy357:
		yych = *++YYCURSOR;
		if(yych == '}') goto yy365;
		goto yy356;
yy358:
		++YYCURSOR;
#line 912 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("end inline tag")
	  /* if normalcursor is set, this will be re-scanned*/
	  if (!s->normalcursor) {
		s->in_inlinetag = 0;
	  }
	  DOCB_RET(DOCB_ENDINLINETAG,NORMAL);
	}
#line 2596 "ext/docblock/docblock_scan.c"
yy360:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
yy361:
		if(yybm[0+yych] & 128) {
			goto yy360;
		}
		goto yy356;
yy362:
		yych = *++YYCURSOR;
		if(yych != 0x0A) goto yy356;
yy363:
		++YYCURSOR;
#line 924 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("newline (INLINETAG)")
	  DOCB_RET(DOCB_NEWLINE,LINESTART);
	}
#line 2615 "ext/docblock/docblock_scan.c"
yy365:
		++YYCURSOR;
#line 909 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("escaped end inline tag")
	  DOCB_RET(DOCB_ESCAPEDINLINEEND,INLINETAG);
	}
#line 2622 "ext/docblock/docblock_scan.c"
yy367:
		++YYCURSOR;
		if(yybm[0+(yych = *YYCURSOR)] & 128) {
			goto yy360;
		}
#line 906 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("end comment")
	  DOCB_RET(DOCB_COMMENTEND,LINESTART);
	}
#line 2632 "ext/docblock/docblock_scan.c"
	}
}
#line 927 "ext/docblock/docblock_scan.re"

CODE:
if (s->in_internal) {
	{
	static unsigned char yybm[] = {
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,   0,  64,  64,   0,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,   0,  64,  64,  64,  64,  64, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192,  64,  64,   0,  64,  64,  64, 
		 64, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192,  64,  64,  64,  64, 192, 
		 64, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192,   0,  64,   0,  64, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
	};

#line 2675 "ext/docblock/docblock_scan.c"
	{
		YYCTYPE yych;
		unsigned int yyaccept = 0;
		if((YYLIMIT - YYCURSOR) < 9) YYFILL(9);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 64) {
			goto yy379;
		}
		if(yych <= ';') {
			if(yych <= 0x0C) goto yy374;
			if(yych <= 0x0D) goto yy376;
		} else {
			if(yych <= '<') goto yy373;
			if(yych <= '|') goto yy378;
			goto yy377;
		}
		++YYCURSOR;
		if((yych = *YYCURSOR) == '/') goto yy410;
yy372:
#line 970 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("normal text")
		DOCB_BEGINT(DOCB_TEXT,CODE);
		}
#line 2699 "ext/docblock/docblock_scan.c"
yy373:
		yyaccept = 0;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych == '/') goto yy395;
		if(yych == '<') goto yy394;
		goto yy372;
yy374:
		++YYCURSOR;
yy375:
#line 943 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("newline (CODE)")
		DOCB_RET(DOCB_NEWLINE,LINESTART);
		}
#line 2713 "ext/docblock/docblock_scan.c"
yy376:
		yych = *++YYCURSOR;
		if(yych == 0x0A) goto yy374;
		goto yy375;
yy377:
		yych = *++YYCURSOR;
		if(yych == '}') goto yy392;
		goto yy372;
yy378:
		yyaccept = 0;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych == '@') goto yy381;
		goto yy372;
yy379:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 64) {
			goto yy379;
		}
		goto yy372;
yy381:
		yych = *++YYCURSOR;
		if(yych <= '_') {
			if(yych <= '@') {
				if(yych == '*') goto yy385;
			} else {
				if(yych <= 'Z') goto yy386;
				if(yych >= '_') goto yy386;
			}
		} else {
			if(yych <= '|') {
				if(yych <= '`') goto yy382;
				if(yych <= 'z') goto yy386;
			} else {
				if(yych <= '}') goto yy383;
				if(yych >= 0x7F) goto yy386;
			}
		}
yy382:
		YYCURSOR = YYMARKER;
		switch(yyaccept){
		case 1:	goto yy388;
		case 0:	goto yy372;
		}
yy383:
		++YYCURSOR;
#line 955 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("escaped inline tag")
		DOCB_RET(DOCB_ESCAPEDINLINETAG,CODE);
		}
#line 2765 "ext/docblock/docblock_scan.c"
yy385:
		yych = *++YYCURSOR;
		if(yych == '}') goto yy383;
		goto yy382;
yy386:
		yyaccept = 1;
		YYMARKER = ++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 128) {
			goto yy386;
		}
		if(yych == '.') goto yy389;
yy388:
#line 959 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("inline tag start")
		if (!s->normalcursor) {
			s->in_inlinetag = 1;
		}
		DOCB_RET(DOCB_INLINETAG,INLINETAG);
		}
#line 2787 "ext/docblock/docblock_scan.c"
yy389:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= '_') {
			if(yych <= '@') goto yy382;
			if(yych <= 'Z') goto yy390;
			if(yych <= '^') goto yy382;
		} else {
			if(yych <= '`') goto yy382;
			if(yych <= 'z') goto yy390;
			if(yych <= '~') goto yy382;
		}
yy390:
		yyaccept = 1;
		YYMARKER = ++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= 'Z') {
			if(yych <= '/') {
				if(yych == '.') goto yy389;
				goto yy388;
			} else {
				if(yych <= '9') goto yy390;
				if(yych <= '@') goto yy388;
				goto yy390;
			}
		} else {
			if(yych <= '`') {
				if(yych == '_') goto yy390;
				goto yy388;
			} else {
				if(yych <= 'z') goto yy390;
				if(yych <= '~') goto yy388;
				goto yy390;
			}
		}
yy392:
		++YYCURSOR;
#line 947 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("end internal")
		/* if normalcursor is set, this will be re-scanned*/
		if (!s->normalcursor) {
			s->in_internal = 0;
		}
		DOCB_RET(DOCB_ENDINTERNAL,CODE);
		}
#line 2835 "ext/docblock/docblock_scan.c"
yy394:
		yych = *++YYCURSOR;
		if(yych == '/') goto yy402;
		goto yy382;
yy395:
		yych = *++YYCURSOR;
		if(yych != 'c') goto yy382;
		yych = *++YYCURSOR;
		if(yych != 'o') goto yy382;
		yych = *++YYCURSOR;
		if(yych != 'd') goto yy382;
		yych = *++YYCURSOR;
		if(yych != 'e') goto yy382;
		yych = *++YYCURSOR;
		if(yych != '>') goto yy382;
		++YYCURSOR;
#line 935 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("close code")
		/* if normalcursor is set, this will be re-scanned*/
		if (!s->normalcursor) {
			s->in_code = 0;
		}
		DOCB_RET(DOCB_CODECLOSE,NORMAL);
		}
#line 2860 "ext/docblock/docblock_scan.c"
yy402:
		yych = *++YYCURSOR;
		if(yych == 'C') goto yy403;
		if(yych != 'c') goto yy382;
yy403:
		yych = *++YYCURSOR;
		if(yych == 'O') goto yy404;
		if(yych != 'o') goto yy382;
yy404:
		yych = *++YYCURSOR;
		if(yych == 'D') goto yy405;
		if(yych != 'd') goto yy382;
yy405:
		yych = *++YYCURSOR;
		if(yych == 'E') goto yy406;
		if(yych != 'e') goto yy382;
yy406:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy382;
		yych = *++YYCURSOR;
		if(yych != '>') goto yy382;
		++YYCURSOR;
#line 966 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("escaped html tag")
		DOCB_RET(DOCB_ESCAPEDHTML,CODE);
		}
#line 2887 "ext/docblock/docblock_scan.c"
yy410:
		++YYCURSOR;
#line 931 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("end comment")
		DOCB_RET(DOCB_COMMENTEND,LINESTART);
		}
#line 2894 "ext/docblock/docblock_scan.c"
	}
}
#line 973 "ext/docblock/docblock_scan.re"

} /* if (s->in_internal) */
/* CODE: */
{
	static unsigned char yybm[] = {
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,   0,  64,  64,   0,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,   0,  64,  64,  64,  64,  64, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192,  64,  64,   0,  64,  64,  64, 
		 64, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192,  64,  64,  64,  64, 192, 
		 64, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192,   0,  64,  64,  64, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
	};

#line 2937 "ext/docblock/docblock_scan.c"
	{
		YYCTYPE yych;
		unsigned int yyaccept = 0;
		if((YYLIMIT - YYCURSOR) < 11) YYFILL(11);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 64) {
			goto yy421;
		}
		if(yych <= 0x0C) goto yy417;
		if(yych <= 0x0D) goto yy419;
		if(yych <= ';') goto yy414;
		if(yych <= '<') goto yy416;
		goto yy420;
yy414:
		++YYCURSOR;
		if((yych = *YYCURSOR) == '/') goto yy459;
yy415:
#line 1015 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("normal text")
	  DOCB_BEGINT(DOCB_TEXT,CODE);
	}
#line 2959 "ext/docblock/docblock_scan.c"
yy416:
		yyaccept = 0;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych == '/') goto yy444;
		if(yych == '<') goto yy443;
		goto yy415;
yy417:
		++YYCURSOR;
yy418:
#line 989 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("newline (CODE)")
	  DOCB_RET(DOCB_NEWLINE,LINESTART);
	}
#line 2973 "ext/docblock/docblock_scan.c"
yy419:
		yych = *++YYCURSOR;
		if(yych == 0x0A) goto yy417;
		goto yy418;
yy420:
		yyaccept = 0;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych == '@') goto yy423;
		goto yy415;
yy421:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 64) {
			goto yy421;
		}
		goto yy415;
yy423:
		yych = *++YYCURSOR;
		if(yych <= '`') {
			if(yych <= '@') {
				if(yych == '*') goto yy429;
			} else {
				if(yych <= 'Z') goto yy430;
				if(yych == '_') goto yy430;
			}
		} else {
			if(yych <= 'z') {
				if(yych == 'i') goto yy425;
				goto yy430;
			} else {
				if(yych == '}') goto yy427;
				if(yych >= 0x7F) goto yy430;
			}
		}
yy424:
		YYCURSOR = YYMARKER;
		switch(yyaccept){
		case 2:	goto yy442;
		case 1:	goto yy426;
		case 0:	goto yy415;
		}
yy425:
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych == 'n') goto yy435;
		goto yy431;
yy426:
#line 1004 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("inline tag start")
	  if (!s->normalcursor) {
	  	s->in_inlinetag = 1;
	  }
	  DOCB_RET(DOCB_INLINETAG,INLINETAG);
	}
#line 3029 "ext/docblock/docblock_scan.c"
yy427:
		++YYCURSOR;
#line 1000 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("escaped inline tag")
	  DOCB_RET(DOCB_ESCAPEDINLINETAG,CODE);
	}
#line 3036 "ext/docblock/docblock_scan.c"
yy429:
		yych = *++YYCURSOR;
		if(yych == '}') goto yy427;
		goto yy424;
yy430:
		yyaccept = 1;
		YYMARKER = ++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
yy431:
		if(yybm[0+yych] & 128) {
			goto yy430;
		}
		if(yych != '.') goto yy426;
yy432:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= '_') {
			if(yych <= '@') goto yy424;
			if(yych <= 'Z') goto yy433;
			if(yych <= '^') goto yy424;
		} else {
			if(yych <= '`') goto yy424;
			if(yych <= 'z') goto yy433;
			if(yych <= '~') goto yy424;
		}
yy433:
		yyaccept = 1;
		YYMARKER = ++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= 'Z') {
			if(yych <= '/') {
				if(yych == '.') goto yy432;
				goto yy426;
			} else {
				if(yych <= '9') goto yy433;
				if(yych <= '@') goto yy426;
				goto yy433;
			}
		} else {
			if(yych <= '`') {
				if(yych == '_') goto yy433;
				goto yy426;
			} else {
				if(yych <= 'z') goto yy433;
				if(yych <= '~') goto yy426;
				goto yy433;
			}
		}
yy435:
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 't') goto yy431;
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 'e') goto yy431;
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 'r') goto yy431;
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 'n') goto yy431;
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 'a') goto yy431;
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 'l') goto yy431;
		yyaccept = 2;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yybm[0+yych] & 128) {
			goto yy430;
		}
		if(yych == '.') goto yy432;
yy442:
#line 993 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("internal start")
	  if (!s->normalcursor) {
	  	s->in_internal = 1;
	  }
	  DOCB_RET(DOCB_INTERNAL,CODE);
	}
#line 3121 "ext/docblock/docblock_scan.c"
yy443:
		yych = *++YYCURSOR;
		if(yych == '/') goto yy451;
		goto yy424;
yy444:
		yych = *++YYCURSOR;
		if(yych != 'c') goto yy424;
		yych = *++YYCURSOR;
		if(yych != 'o') goto yy424;
		yych = *++YYCURSOR;
		if(yych != 'd') goto yy424;
		yych = *++YYCURSOR;
		if(yych != 'e') goto yy424;
		yych = *++YYCURSOR;
		if(yych != '>') goto yy424;
		++YYCURSOR;
#line 981 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("close code")
	  /* if normalcursor is set, this will be re-scanned*/
	  if (!s->normalcursor) {
	  	s->in_code = 0;
	  }
	  DOCB_RET(DOCB_CODECLOSE,NORMAL);
	}
#line 3146 "ext/docblock/docblock_scan.c"
yy451:
		yych = *++YYCURSOR;
		if(yych == 'C') goto yy452;
		if(yych != 'c') goto yy424;
yy452:
		yych = *++YYCURSOR;
		if(yych == 'O') goto yy453;
		if(yych != 'o') goto yy424;
yy453:
		yych = *++YYCURSOR;
		if(yych == 'D') goto yy454;
		if(yych != 'd') goto yy424;
yy454:
		yych = *++YYCURSOR;
		if(yych == 'E') goto yy455;
		if(yych != 'e') goto yy424;
yy455:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy424;
		yych = *++YYCURSOR;
		if(yych != '>') goto yy424;
		++YYCURSOR;
#line 1011 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("escaped html tag")
	  DOCB_RET(DOCB_ESCAPEDHTML,CODE);
	}
#line 3173 "ext/docblock/docblock_scan.c"
yy459:
		++YYCURSOR;
#line 977 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("end comment")
	  DOCB_RET(DOCB_COMMENTEND,LINESTART);
	}
#line 3180 "ext/docblock/docblock_scan.c"
	}
}
#line 1018 "ext/docblock/docblock_scan.re"


PRE:

if (s->in_internal) {
{
	static unsigned char yybm[] = {
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,   0,  64,  64,   0,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,   0,  64,  64,  64,  64,  64, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192,  64,  64,   0,  64,  64,  64, 
		 64, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192,  64,  64,  64,  64, 192, 
		 64, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192,   0,  64,   0,  64, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
	};

#line 3225 "ext/docblock/docblock_scan.c"
	{
		YYCTYPE yych;
		unsigned int yyaccept = 0;
		if((YYLIMIT - YYCURSOR) < 8) YYFILL(8);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 64) {
			goto yy471;
		}
		if(yych <= ';') {
			if(yych <= 0x0C) goto yy466;
			if(yych <= 0x0D) goto yy468;
		} else {
			if(yych <= '<') goto yy465;
			if(yych <= '|') goto yy470;
			goto yy469;
		}
		++YYCURSOR;
		if((yych = *YYCURSOR) == '/') goto yy500;
yy464:
#line 1063 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("normal text")
		DOCB_BEGINT(DOCB_TEXT,PRE);
		}
#line 3249 "ext/docblock/docblock_scan.c"
yy465:
		yyaccept = 0;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych == '/') goto yy487;
		if(yych == '<') goto yy486;
		goto yy464;
yy466:
		++YYCURSOR;
yy467:
#line 1036 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("newline (PRE)")
		DOCB_RET(DOCB_NEWLINE,LINESTART);
		}
#line 3263 "ext/docblock/docblock_scan.c"
yy468:
		yych = *++YYCURSOR;
		if(yych == 0x0A) goto yy466;
		goto yy467;
yy469:
		yych = *++YYCURSOR;
		if(yych == '}') goto yy484;
		goto yy464;
yy470:
		yyaccept = 0;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych == '@') goto yy473;
		goto yy464;
yy471:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 64) {
			goto yy471;
		}
		goto yy464;
yy473:
		yych = *++YYCURSOR;
		if(yych <= '_') {
			if(yych <= '@') {
				if(yych == '*') goto yy477;
			} else {
				if(yych <= 'Z') goto yy478;
				if(yych >= '_') goto yy478;
			}
		} else {
			if(yych <= '|') {
				if(yych <= '`') goto yy474;
				if(yych <= 'z') goto yy478;
			} else {
				if(yych <= '}') goto yy475;
				if(yych >= 0x7F) goto yy478;
			}
		}
yy474:
		YYCURSOR = YYMARKER;
		switch(yyaccept){
		case 1:	goto yy480;
		case 0:	goto yy464;
		}
yy475:
		++YYCURSOR;
#line 1048 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("escaped inline tag")
		DOCB_RET(DOCB_ESCAPEDINLINETAG,PRE);
		}
#line 3315 "ext/docblock/docblock_scan.c"
yy477:
		yych = *++YYCURSOR;
		if(yych == '}') goto yy475;
		goto yy474;
yy478:
		yyaccept = 1;
		YYMARKER = ++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 128) {
			goto yy478;
		}
		if(yych == '.') goto yy481;
yy480:
#line 1052 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("inline tag start")
		if (!s->normalcursor) {
			s->in_inlinetag = 1;
		}
		DOCB_RET(DOCB_INLINETAG,INLINETAG);
		}
#line 3337 "ext/docblock/docblock_scan.c"
yy481:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= '_') {
			if(yych <= '@') goto yy474;
			if(yych <= 'Z') goto yy482;
			if(yych <= '^') goto yy474;
		} else {
			if(yych <= '`') goto yy474;
			if(yych <= 'z') goto yy482;
			if(yych <= '~') goto yy474;
		}
yy482:
		yyaccept = 1;
		YYMARKER = ++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= 'Z') {
			if(yych <= '/') {
				if(yych == '.') goto yy481;
				goto yy480;
			} else {
				if(yych <= '9') goto yy482;
				if(yych <= '@') goto yy480;
				goto yy482;
			}
		} else {
			if(yych <= '`') {
				if(yych == '_') goto yy482;
				goto yy480;
			} else {
				if(yych <= 'z') goto yy482;
				if(yych <= '~') goto yy480;
				goto yy482;
			}
		}
yy484:
		++YYCURSOR;
#line 1040 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("end internal")
		/* if normalcursor is set, this will be re-scanned*/
		if (!s->normalcursor) {
			s->in_internal = 0;
		}
		DOCB_RET(DOCB_ENDINTERNAL,PRE);
		}
#line 3385 "ext/docblock/docblock_scan.c"
yy486:
		yych = *++YYCURSOR;
		if(yych == '/') goto yy493;
		goto yy474;
yy487:
		yych = *++YYCURSOR;
		if(yych != 'p') goto yy474;
		yych = *++YYCURSOR;
		if(yych != 'r') goto yy474;
		yych = *++YYCURSOR;
		if(yych != 'e') goto yy474;
		yych = *++YYCURSOR;
		if(yych != '>') goto yy474;
		++YYCURSOR;
#line 1028 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("close pre")
		/* if normalcursor is set, this will be re-scanned*/
		if (!s->normalcursor) {
			s->in_pre = 0;
		}
		DOCB_RET(DOCB_PRECLOSE,NORMAL);
		}
#line 3408 "ext/docblock/docblock_scan.c"
yy493:
		yych = *++YYCURSOR;
		if(yych == 'P') goto yy494;
		if(yych != 'p') goto yy474;
yy494:
		yych = *++YYCURSOR;
		if(yych == 'R') goto yy495;
		if(yych != 'r') goto yy474;
yy495:
		yych = *++YYCURSOR;
		if(yych == 'E') goto yy496;
		if(yych != 'e') goto yy474;
yy496:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy474;
		yych = *++YYCURSOR;
		if(yych != '>') goto yy474;
		++YYCURSOR;
#line 1059 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("escaped html tag")
		DOCB_RET(DOCB_ESCAPEDHTML,PRE);
		}
#line 3431 "ext/docblock/docblock_scan.c"
yy500:
		++YYCURSOR;
#line 1024 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("end comment")
		DOCB_RET(DOCB_COMMENTEND,LINESTART);
		}
#line 3438 "ext/docblock/docblock_scan.c"
	}
}
#line 1066 "ext/docblock/docblock_scan.re"

} /* if (s->in_internal) */
/* PRE */
{
	static unsigned char yybm[] = {
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,   0,  64,  64,   0,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,   0,  64,  64,  64,  64,  64, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192,  64,  64,   0,  64,  64,  64, 
		 64, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192,  64,  64,  64,  64, 192, 
		 64, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192,   0,  64,  64,  64, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
		192, 192, 192, 192, 192, 192, 192, 192, 
	};

#line 3481 "ext/docblock/docblock_scan.c"
	{
		YYCTYPE yych;
		unsigned int yyaccept = 0;
		if((YYLIMIT - YYCURSOR) < 11) YYFILL(11);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 64) {
			goto yy511;
		}
		if(yych <= 0x0C) goto yy507;
		if(yych <= 0x0D) goto yy509;
		if(yych <= ';') goto yy504;
		if(yych <= '<') goto yy506;
		goto yy510;
yy504:
		++YYCURSOR;
		if((yych = *YYCURSOR) == '/') goto yy547;
yy505:
#line 1108 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("normal text")
	  DOCB_BEGINT(DOCB_TEXT,PRE);
	}
#line 3503 "ext/docblock/docblock_scan.c"
yy506:
		yyaccept = 0;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych == '/') goto yy534;
		if(yych == '<') goto yy533;
		goto yy505;
yy507:
		++YYCURSOR;
yy508:
#line 1082 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("newline (PRE)")
	  DOCB_RET(DOCB_NEWLINE,LINESTART);
	}
#line 3517 "ext/docblock/docblock_scan.c"
yy509:
		yych = *++YYCURSOR;
		if(yych == 0x0A) goto yy507;
		goto yy508;
yy510:
		yyaccept = 0;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych == '@') goto yy513;
		goto yy505;
yy511:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yybm[0+yych] & 64) {
			goto yy511;
		}
		goto yy505;
yy513:
		yych = *++YYCURSOR;
		if(yych <= '`') {
			if(yych <= '@') {
				if(yych == '*') goto yy519;
			} else {
				if(yych <= 'Z') goto yy520;
				if(yych == '_') goto yy520;
			}
		} else {
			if(yych <= 'z') {
				if(yych == 'i') goto yy515;
				goto yy520;
			} else {
				if(yych == '}') goto yy517;
				if(yych >= 0x7F) goto yy520;
			}
		}
yy514:
		YYCURSOR = YYMARKER;
		switch(yyaccept){
		case 2:	goto yy532;
		case 1:	goto yy516;
		case 0:	goto yy505;
		}
yy515:
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych == 'n') goto yy525;
		goto yy521;
yy516:
#line 1097 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("inline tag start")
	  if (!s->normalcursor) {
	  	s->in_inlinetag = 1;
	  }
	  DOCB_RET(DOCB_INLINETAG,INLINETAG);
	}
#line 3573 "ext/docblock/docblock_scan.c"
yy517:
		++YYCURSOR;
#line 1093 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("escaped inline tag")
	  DOCB_RET(DOCB_ESCAPEDINLINETAG,PRE);
	}
#line 3580 "ext/docblock/docblock_scan.c"
yy519:
		yych = *++YYCURSOR;
		if(yych == '}') goto yy517;
		goto yy514;
yy520:
		yyaccept = 1;
		YYMARKER = ++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
yy521:
		if(yybm[0+yych] & 128) {
			goto yy520;
		}
		if(yych != '.') goto yy516;
yy522:
		++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= '_') {
			if(yych <= '@') goto yy514;
			if(yych <= 'Z') goto yy523;
			if(yych <= '^') goto yy514;
		} else {
			if(yych <= '`') goto yy514;
			if(yych <= 'z') goto yy523;
			if(yych <= '~') goto yy514;
		}
yy523:
		yyaccept = 1;
		YYMARKER = ++YYCURSOR;
		if(YYLIMIT == YYCURSOR) YYFILL(1);
		yych = *YYCURSOR;
		if(yych <= 'Z') {
			if(yych <= '/') {
				if(yych == '.') goto yy522;
				goto yy516;
			} else {
				if(yych <= '9') goto yy523;
				if(yych <= '@') goto yy516;
				goto yy523;
			}
		} else {
			if(yych <= '`') {
				if(yych == '_') goto yy523;
				goto yy516;
			} else {
				if(yych <= 'z') goto yy523;
				if(yych <= '~') goto yy516;
				goto yy523;
			}
		}
yy525:
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 't') goto yy521;
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 'e') goto yy521;
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 'r') goto yy521;
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 'n') goto yy521;
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 'a') goto yy521;
		yyaccept = 1;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yych != 'l') goto yy521;
		yyaccept = 2;
		yych = *(YYMARKER = ++YYCURSOR);
		if(yybm[0+yych] & 128) {
			goto yy520;
		}
		if(yych == '.') goto yy522;
yy532:
#line 1086 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("internal start")
	  if (!s->normalcursor) {
	  	s->in_internal = 1;
	  }
	  DOCB_RET(DOCB_INTERNAL,PRE);
	}
#line 3665 "ext/docblock/docblock_scan.c"
yy533:
		yych = *++YYCURSOR;
		if(yych == '/') goto yy540;
		goto yy514;
yy534:
		yych = *++YYCURSOR;
		if(yych != 'p') goto yy514;
		yych = *++YYCURSOR;
		if(yych != 'r') goto yy514;
		yych = *++YYCURSOR;
		if(yych != 'e') goto yy514;
		yych = *++YYCURSOR;
		if(yych != '>') goto yy514;
		++YYCURSOR;
#line 1074 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("close pre")
	  /* if normalcursor is set, this will be re-scanned*/
	  if (!s->normalcursor) {
		s->in_pre = 0;
	  }
	  DOCB_RET(DOCB_PRECLOSE,NORMAL);
	}
#line 3688 "ext/docblock/docblock_scan.c"
yy540:
		yych = *++YYCURSOR;
		if(yych == 'P') goto yy541;
		if(yych != 'p') goto yy514;
yy541:
		yych = *++YYCURSOR;
		if(yych == 'R') goto yy542;
		if(yych != 'r') goto yy514;
yy542:
		yych = *++YYCURSOR;
		if(yych == 'E') goto yy543;
		if(yych != 'e') goto yy514;
yy543:
		yych = *++YYCURSOR;
		if(yych != '>') goto yy514;
		yych = *++YYCURSOR;
		if(yych != '>') goto yy514;
		++YYCURSOR;
#line 1104 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("escaped html tag")
	  DOCB_RET(DOCB_ESCAPEDHTML,PRE);
	}
#line 3711 "ext/docblock/docblock_scan.c"
yy547:
		++YYCURSOR;
#line 1070 "ext/docblock/docblock_scan.re"
		{ DOCB_DB("end comment")
	  DOCB_RET(DOCB_COMMENTEND,LINESTART);
	}
#line 3718 "ext/docblock/docblock_scan.c"
	}
}
#line 1111 "ext/docblock/docblock_scan.re"


	return 0;
}
                                                                                docblock-0.2.0/docblock_scan.h                                                                      100644    1751     144         4611 10450341002  11414                                                                                                                                                                                                                                                                                                                                                                      #ifndef DOCBLOCK_SCAN_H
#define DOCBLOCK_SCAN_H

#include "zend.h"

#ifdef PHP_WIN32
# if defined(DOCBLOCK_EXPORTS) || (!defined(COMPILE_DL_DOCBLOCK))
#  define PHP_DOCBLOCK_API __declspec(dllexport)
# elif defined(COMPILE_DL_DOCBLOCK)
#  define PHP_DOCBLOCK_API __declspec(dllimport)
# else
#  define PHP_DOCBLOCK_API /* nothing special */
# endif
#else
# define PHP_DOCBLOCK_API
#endif
typedef struct _docblock_Scanner {
	char		*buffer;
	char		*token, *ptr;
	char		*cursor, *current_token;
	char		*length;
	int		line;
	/**
	 * Scanner state
	 */
	int		state;
	/**
	 * Determines whether we are in tags or description
	 */
	int		in_internal, in_inlinetag, in_code, in_pre;
	int		return_simplelist_end;
	zend_llist	*simplelist;
	char		*normalcursor;
	int		normaltoken;
} docblock_Scanner;

BEGIN_EXTERN_C()
extern PHP_DOCBLOCK_API int docblock_scan(docblock_Scanner *scan TSRMLS_DC);
extern PHP_DOCBLOCK_API void docblock_finish_scan(docblock_Scanner *scan TSRMLS_DC);
extern PHP_DOCBLOCK_API docblock_Scanner *docblock_prepare_string(char *str, int len TSRMLS_DC);
END_EXTERN_C()

#define DOCB_NEWLINE 1
#define DOCB_WHITESPACE 2
#define DOCB_ASTERISK 3
#define DOCB_IGNOREDLINE 4
#define DOCB_TAG 5
#define DOCB_INTERNAL 6
#define DOCB_INLINETAG 7
#define DOCB_COMMENTSTART 8
#define DOCB_ESCAPEDINLINETAG 9
#define DOCB_INLINETAGCONTENTS 10
#define DOCB_ESCAPEDHTML 11
#define DOCB_CODEOPEN 12
#define DOCB_PREOPEN 13
#define DOCB_SAMPOPEN 14
#define DOCB_VAROPEN 15
#define DOCB_KBDOPEN 16
#define DOCB_POPEN 17
#define DOCB_BOPEN 18
#define DOCB_IOPEN 19
#define DOCB_OLOPEN 20
#define DOCB_ULOPEN 21
#define DOCB_LIOPEN 22
#define DOCB_CODECLOSE 23
#define DOCB_PRECLOSE 24
#define DOCB_SAMPCLOSE 25
#define DOCB_VARCLOSE 26
#define DOCB_KBDCLOSE 27
#define DOCB_PCLOSE 28
#define DOCB_BCLOSE 29
#define DOCB_ICLOSE 30
#define DOCB_OLCLOSE 31
#define DOCB_ULCLOSE 32
#define DOCB_LICLOSE 33
#define DOCB_BR 34
#define DOCB_COMMENTEND 35
#define DOCB_TEXT 36
#define DOCB_ENDINLINETAG 37
#define DOCB_ENDINTERNAL 38
#define DOCB_ESCAPEDINLINEEND 39
#define DOCB_COMMENTTEMPLATE 40
#define DOCB_COMMENTTEMPLATEEND 41
#define DOCB_SIMPLELISTSTART 42
#define DOCB_SIMPLELISTEND 43
#define DOCB_SIMPLELISTBULLET 44
// if you add a value here, you must add it to the
// DOCBLOCK_DOREGISTER macro definition on line
// 93 of docblock.c

// add as format:
// 	macro("DOCBLOCK_XXXX",DOCB_XXXX)
// where XXXX is the name of a new token

#endif

                                                                                                                       docblock-0.2.0/docblock_scan.re                                                                     100644    1751     144        64073 10450341002  11623                                                                                                                                                                                                                                                                                                                                                                      /*
   +----------------------------------------------------------------------+
   | DocBlock Scanner                                                     |
   +----------------------------------------------------------------------+
   | Copyright (c) 2005 Gregory Beaver                                    |
   +----------------------------------------------------------------------+
   | This source file is subject to version 3.00 of the PHP license,      |
   | that is bundled with this package in the file LICENSE, and is        |
   | available through the world-wide-web at the following url:           |
   | http://www.php.net/license/3_00.txt.                                 |
   | If you did not receive a copy of the PHP license and are unable to   |
   | obtain it through the world-wide-web, please send a note to          |
   | license@php.net so we can mail you a copy immediately.               |
   +----------------------------------------------------------------------+
   | Authors: Gregory Beaver <cellog@php.net>                             |
   +----------------------------------------------------------------------+
*/

/* $Id: docblock_scan.re,v 1.18 2006/06/27 23:30:56 cellog Exp $ */

#include "zend_API.h"
#include "zend.h"
#include "docblock_scan.h"

/* #define DOCBLOCK_DEBUG */

/* re2c defines */
/* refill buffer - unused */
#define YYFILL(n)
/* character type */
#define YYCTYPE char
#define	YYCURSOR cursor
#define YYLIMIT s->length
#define YYMARKER s->ptr

#define DOCB_STATE(z) DOCBLOCK_SCAN_##z

#define DOCB_RET(t,z)\
	if (s->return_simplelist_end) {\
		cursor = s->token;\
		s->current_token = (char *)emalloc(cursor - s->token + 1);\
		s->current_token[0] = '\0';\
		s->return_simplelist_end = 0;\
		return DOCB_SIMPLELISTEND;\
	}\
	if (s->normalcursor) {\
		if (t == DOCB_SIMPLELISTEND) {\
			s->return_simplelist_end = 1;\
		} else {\
			s->return_simplelist_end = 0;\
		}\
		cursor = s->token;\
		s->token = s->normalcursor;\
		s->cursor = cursor;\
		s->current_token = (char *)emalloc(cursor - s->token + 1);\
		memcpy(s->current_token,s->token,cursor - s->token);\
		*(s->current_token + (cursor - s->token)) = '\0';\
		s->token = cursor;\
		s->normalcursor = 0;\
		return s->normaltoken;\
	}\
	s->cursor = cursor;\
	s->current_token = (char *)emalloc(cursor - s->token + 1);\
	memcpy(s->current_token,s->token,cursor - s->token);\
	*(s->current_token + (cursor - s->token)) = '\0';\
	s->token = cursor;\
	s->state = DOCB_STATE(z);\
	return t;

#define DOCB_BEGIN(z) s->cursor = cursor;s->token = cursor;s->state = DOCB_STATE(z);goto z;
#define DOCB_BEGINT(tok,state)\
	if (!s->normalcursor) {\
		s->normalcursor = s->token;\
		s->normaltoken = tok;\
	}\
	DOCB_BEGIN(state)


/* switch to proper error handling when the time is right*/
#define DOCB_ERROR(m) zend_printf(m);return -1;
#ifdef DOCBLOCK_DEBUG
#define DOCB_DB(message) tmp = (char *)emalloc(cursor - s->token + 1);\
	memcpy(tmp,s->token,cursor - s->token);\
	*(tmp + (cursor - s->token)) = '\0';\
	zend_printf(#message" (%.*s)\n", cursor - s->token, tmp);\
	efree(tmp);
#else
#define DOCB_DB(message)
#endif

#define DOCBLOCK_SCAN_START 1
#define DOCBLOCK_SCAN_LINESTART 2
#define DOCBLOCK_SCAN_PREASTERISK 3
#define DOCBLOCK_SCAN_POSTASTERISK 4
#define DOCBLOCK_SCAN_IGNOREDLINE 5
#define DOCBLOCK_SCAN_NORMAL 6
#define DOCBLOCK_SCAN_INTERNAL 7
#define DOCBLOCK_SCAN_INLINETAG 8
#define DOCBLOCK_SCAN_CODE 9
#define DOCBLOCK_SCAN_PRE 10
#define DOCBLOCK_SCAN_SIMPLELIST 11

typedef struct _docblock_simplelist {
	char	token[3];
	char	*whitespace;
} docblock_simplelist;

static docblock_simplelist *_docblock_new_item(docblock_Scanner *s,
					   const char *token,
					   const char *cursor, char *ptr)
{
	docblock_simplelist *listitem;
	listitem = (docblock_simplelist *) emalloc(sizeof (docblock_simplelist));
	/* note the whitespace*/
	listitem->whitespace = (char *) emalloc(ptr - token + 1);
	memcpy(listitem->whitespace, token, ptr - token);
	*(listitem->whitespace + (ptr - token)) = '\0';
	if (*ptr >= '1' && *ptr <= '9') {
		if (*(ptr + 1) == '.') {
			listitem->token[1] = '.';
		} else {
			listitem->token[1] = '\0';
		}
		listitem->token[0] = *ptr;
	} else {
		listitem->token[0] = *ptr;
		listitem->token[1] = '\0';
	}
	return listitem;
}

static void _docblock_simplelist_dtor(void *el)
{
/*	*((docblock_simplelist *) el)->whitespace = '\0';*/
/*	efree(((docblock_simplelist *) el)->whitespace);*/
}

static int _docblock_detect_new_simplelist(docblock_Scanner *s,
					   const char *token,
					   const char *cursor)
{
	int test, expt, need_dot, i;
	char *tmp, *ptr, expected_token[3];
	docblock_simplelist *testitem, *newitem;
	/* 1 = start new list, -1 = end list, 0 = error, 2 = carry on*/
	/* 3 = next list item*/
	need_dot = 0;
	expt = 0;
	test = 0;
	i = 0;
	tmp = (char *)emalloc(cursor - token + 1);
	memcpy(tmp, token, cursor - token);
	*(tmp + (cursor - token)) = '\0';
	ptr = tmp;
	expected_token[0] = '\0';
	expected_token[1] = '\0';
	expected_token[2] = '\0';
	while ((*ptr == ' ' || *ptr == '\t') && *ptr != '\0') ++ptr;

	if (*ptr == '\0') {
		/* error*/
		efree(tmp);
		return 0;
	}
	if (s->simplelist->count) {
		/* construct the next token we need to see*/
		testitem = (docblock_simplelist *) s->simplelist->tail->data;
		/* first, make sure the whitespace is identical.  If not, we*/
		/* need to be looking for other lists*/
		if ((ptr - tmp) > strlen(testitem->whitespace)) {
			if ((ptr - tmp) >= strlen(testitem->whitespace) + 1) {
				goto LOOK_FOR_OTHER_LISTS;
			} else {
				efree(tmp);
				/* a simple list has ended*/
				zend_llist_remove_tail(s->simplelist);
				return -1;
			}
		}
		if ((ptr - tmp) < strlen(testitem->whitespace)) {
			/* no need to continue, this list is over*/
			efree(tmp);
			/* a simple list has ended*/
			zend_llist_remove_tail(s->simplelist);
			return -1;
		}
		expected_token[0] = testitem->token[0];
		expected_token[1] = testitem->token[1];
		expected_token[2] = testitem->token[2];
		if (expected_token[0] >= '1' && expected_token[0] <= '9') {
			expt = (expected_token[0] - '1' + 1);
			if (expected_token[1] >= '1' && expected_token[1] <= '0') {
				if (expected_token[2] == '.') {
					need_dot = 1;
				}
				expt *= 10;
				expt += expected_token[1] - '1' + 1;
			} else {
				if (expected_token[1] == '.') {
					need_dot = 1;
				}
			}
			expt++;
			if (expt > 99) {
				/* this is a ridiculous list - who needs 99+*/
				/* simple list entries in a docblock??!*/
				zend_llist_remove_tail(s->simplelist);
				efree(tmp);
				/* end this list*/
				return -1;
			}
			expected_token[1] = '\0';
			expected_token[2] = '\0';
			if (sprintf(expected_token, "%d", expt)) {
				if (need_dot) {
					if (expected_token[1] == '\0') {
						expected_token[1] = '.';
					} else {
						expected_token[2] = '.';
					}
				}
			}
		}
		/* assume match*/
		test = 0;
		for (i = 0; i < 3; i++) {
			if (expected_token[i] == '\0') {
				break;
			}
			if (*(ptr + i) != expected_token[i]) {
				test = 1;
				break;
			}
		}
		if (!test) {
			/* bullet must always be followed by whitespace to*/
			/* be a simple list item*/
			if (*(ptr + i) != ' ' && *(ptr + i) != '\t') {
				test = 1;
			} else {
				/* save the expected token for the next list item*/
				testitem->token[0] = expected_token[0];
				testitem->token[1] = expected_token[1];
				testitem->token[2] = expected_token[2];
			}
		}
	} else {
LOOK_FOR_OTHER_LISTS:
		testitem = 0;
		/* test for tokens*/
		test = (*ptr != '*' && *ptr != '-' && *ptr != 'o' && *ptr != '+');
		i = 1;
		/* test is set if no unordered bullets were found*/
		if (test) {
			test = (*ptr != '1');
			if (!test) {
				if (*(ptr + 1) == '.') i++;
			}
		}
		/* a simplelist bullet was found*/
		if (!test) {
			/* bullet must always be followed by whitespace to*/
			/* be a simple list item*/
			if (*(ptr + i) != ' ' && *(ptr + i) != '\t') {
				test = 1;
			}
		}
	}
	/* no simple list tokens were matched*/
	if (test) {
		/* no new simplelist item*/
		if (testitem) {
			/* we need whitespace like so:*/
			/* - simplelist*/
			/*   continued line*/
			/* meaning we need 2 extra whitespace tokens*/
			if ((ptr - tmp) >= strlen(testitem->whitespace) + 2) {
				efree(tmp);
				/* continue existing list item*/
				return 2;
			} else {
				/* a simple list has ended*/
				zend_llist_remove_tail(s->simplelist);
				efree(tmp);
				return -1;
			}
		} else {
			/* no simple list*/
			efree(tmp);
			/* continue non-simple list text*/
			return 2;
		}
	} else {
		/* simple list tokens matched*/
		if (testitem) {
			/* we need identical whitespace like so:*/
			/* - simplelist item 1*/
			/* - simplelist item 2*/
			/* otherwise we have a new list*/
			if ((ptr - tmp) > strlen(testitem->whitespace)) {
				newitem = _docblock_new_item(s, token, cursor,
					(char *) ((ptr - tmp) + token));
				zend_llist_add_element(s->simplelist, newitem);
				efree(tmp);
				_docblock_simplelist_dtor(newitem);
				/* start nested list*/
				return 1;
			}
			if ((ptr - tmp) < strlen(testitem->whitespace)) {
				efree(tmp);
				zend_llist_remove_tail(s->simplelist);
				/* finish this list*/
				return -1;
			}
			/* continue with next list item*/
			efree(tmp);
			return 3;
		} else {
			/* brand new list*/
			newitem = _docblock_new_item(s, token, cursor,
				(char *) ((ptr - tmp) + token));
			zend_llist_add_element(s->simplelist, newitem);
			efree(newitem);
			efree(tmp);
			return 1;
		}
	}
}

PHP_DOCBLOCK_API docblock_Scanner *docblock_prepare_string(char *input_str, int length TSRMLS_DC)
{
	docblock_Scanner *scan;
	scan = (docblock_Scanner *)emalloc(sizeof (docblock_Scanner));
	scan->buffer = (char *)emalloc(length + 1);
	memcpy(scan->buffer, input_str, length + 1);
	scan->token = scan->buffer;
	scan->cursor = scan->token;
	scan->ptr = scan->cursor;
	scan->length = scan->buffer + length;
	scan->line = 0;
	scan->state = DOCBLOCK_SCAN_START;
	scan->in_internal = 0;
	scan->in_inlinetag = 0;
	scan->return_simplelist_end = 0;
	scan->in_code = 0;
	scan->in_pre = 0;
	scan->current_token = 0;
	scan->normalcursor = 0;
	scan->normaltoken = 0;
	scan->simplelist = (zend_llist *)emalloc(sizeof (zend_llist));
	zend_llist_init(scan->simplelist, sizeof (docblock_simplelist), _docblock_simplelist_dtor, 0);
	return scan;
}

PHP_DOCBLOCK_API void docblock_finish_scan(docblock_Scanner *s TSRMLS_DC)
{
	if (s) {
		if (s->simplelist->count) {
			zend_llist_destroy(s->simplelist);
		}
		efree(s->simplelist);
		if (s->buffer) {
			efree(s->buffer);
		}
		efree(s);
	}
}

PHP_DOCBLOCK_API int docblock_scan(docblock_Scanner *s TSRMLS_DC)
{
	char *cursor,*tmp;

	s->current_token = 0;
	if (s->cursor >= s->length) {
		if (s->normalcursor) {
			cursor = 0; /* nuke warning on windows*/
			/* unreturned output*/
			/* values are ignored, and the normalcursor will instead be returned*/
			DOCB_RET(0,IGNOREDLINE);
		}
		return 0;
	}
	cursor = s->cursor;
/*!re2c
tabsandspaces =			[ \t]+;
optionaltabsspaces =		[ \t]*;
newline =			"\r"|"\n"|"\r\n";
label =				[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*;
nonlabel =			.\[a-zA-Z_\x7f-\xff];
labelstart =			[a-zA-Z_\x7f-\xff];
tag =				"@" label ("." (label))*;

*/
#define DOCB_CASES(z) case DOCB_STATE(z):goto z;
	switch (s->state) {
		DOCB_CASES(START)
		DOCB_CASES(LINESTART)
		DOCB_CASES(PREASTERISK)
		DOCB_CASES(POSTASTERISK)
		DOCB_CASES(IGNOREDLINE)
		DOCB_CASES(NORMAL)
		DOCB_CASES(CODE)
		DOCB_CASES(PRE)
		DOCB_CASES(INLINETAG)
		DOCB_CASES(SIMPLELIST)
	}
#undef DOCB_CASES
START:
/*!re2c
"/**#@-*""/"
	{ DOCB_DB("start comment template")
	  DOCB_RET(DOCB_COMMENTTEMPLATEEND,POSTASTERISK);
	}
"/**#@+"
	{ DOCB_DB("start comment template")
	  DOCB_RET(DOCB_COMMENTTEMPLATE,POSTASTERISK);
	}
"/**"	{ DOCB_DB("start comment")
	  DOCB_RET(DOCB_COMMENTSTART,POSTASTERISK);
	}
.	{ DOCB_DB("SKIP");
	  --cursor;
	  DOCB_BEGIN(LINESTART);
	}

*/
LINESTART:
/*!re2c
"*""/"	{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			/* don't cut out multiple list end tokens*/
			/* when we need to*/
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end 1")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  DOCB_DB("end comment")
	  DOCB_RET(DOCB_COMMENTEND,LINESTART);
	}
newline
	{ DOCB_DB("newline (LINESTART)")
	  DOCB_RET(DOCB_NEWLINE,LINESTART);
	}
tabsandspaces
	{ DOCB_DB("pre-asterisk whitespace")
	  DOCB_RET(DOCB_WHITESPACE,PREASTERISK);
	}
"*"	{ DOCB_DB("asterisk")
	  DOCB_RET(DOCB_ASTERISK,POSTASTERISK);
	}
[^* \t\r\n]
	{ DOCB_DB("SKIP")
	  --cursor;
	  DOCB_BEGIN(IGNOREDLINE);
	}
*/
IGNOREDLINE:
/*!re2c
"*""/"	{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end 2")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  DOCB_DB("end comment")
	  DOCB_RET(DOCB_COMMENTEND,LINESTART);
	}
newline
	{ DOCB_DB("newline (IGNOREDLINE)")
	  DOCB_RET(DOCB_NEWLINE,LINESTART);
	}
[^*\r\n]+
	{ DOCB_DB("ignored line")
	  DOCB_BEGINT(DOCB_IGNOREDLINE,IGNOREDLINE);
	}
"*"
	{ DOCB_DB("ignored line")
	  DOCB_BEGINT(DOCB_IGNOREDLINE,IGNOREDLINE);
	}
*/
PREASTERISK:
/*!re2c
"*""/"	{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  DOCB_DB("end comment")
	  DOCB_RET(DOCB_COMMENTEND,LINESTART);
	}
newline
	{ DOCB_DB("newline (PREASTERISK)")
	  DOCB_RET(DOCB_NEWLINE,LINESTART);
	}
"*"	{ DOCB_DB("asterisk")
	  DOCB_RET(DOCB_ASTERISK,POSTASTERISK);
	}
[^*\r\n]
	{ DOCB_DB("SKIP")
	  --cursor;
	  DOCB_BEGIN(IGNOREDLINE);
	}
*/
POSTASTERISK:
	if (s->in_inlinetag) {
		goto INLINETAG;
	}
	if (s->in_code) {
		goto CODE;
	}
	if (s->in_pre) {
		goto PRE;
	}
	goto NOTSIMPLELIST;
SIMPLELIST:
/*!re2c
[^ \t]+	{ DOCB_DB("simple list bullet");
	  DOCB_RET(DOCB_SIMPLELISTBULLET,NORMAL);
	}
*/
NOTSIMPLELIST:
	if (!s->in_internal) {
/*!re2c
"*""/"	{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end 3")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  DOCB_DB("end comment")
	  DOCB_RET(DOCB_COMMENTEND,LINESTART);
	}
tabsandspaces+ ("-"|"+"|"o"|"*"|[1-9]|[1-9][0-9]|[1-9]"."|[1-9][0-9]".") tabsandspaces+
	{ switch (_docblock_detect_new_simplelist(s, s->token, cursor)) {
		case -1 : /* end list*/
			cursor = s->token;
			DOCB_DB("simple list end")
	  		DOCB_RET(DOCB_SIMPLELISTEND,NORMAL);
		case 3 : /* next list item*/
			cursor = s->token + strlen(
			  ((docblock_simplelist *)s->simplelist->tail->data)->whitespace);
			DOCB_DB("simple list item whitespace")
			DOCB_RET(DOCB_WHITESPACE,SIMPLELIST);
		case 1 : /* start new list*/
			cursor = s->token + strlen(
			  ((docblock_simplelist *)s->simplelist->tail->data)->whitespace);
			DOCB_DB("simple list start whitespace")
			DOCB_RET(DOCB_SIMPLELISTSTART,SIMPLELIST);
		case 0 : /* error*/
		case 2 : /* carry on as you were*/
			cursor = s->token;
			while (*cursor == ' ' || *cursor == '\t') cursor++;
			DOCB_DB("pre-content whitespace (spaces .)")
			DOCB_RET(DOCB_WHITESPACE,NORMAL)
	  }
	}
tabsandspaces+ tag
	{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end (pre-tag)")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  cursor = s->token;
	  while (*cursor == ' ' || *cursor == '\t') cursor++;
	  DOCB_DB("pre-content whitespace (pre-tag)")
	  DOCB_RET(DOCB_WHITESPACE,POSTASTERISK);
	}
tag	{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end (tag)")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  DOCB_DB("tag")
	  DOCB_RET(DOCB_TAG,NORMAL);
	}
tabsandspaces+ .
	{ switch (_docblock_detect_new_simplelist(s, s->token, cursor)) {
		case -1 : /* end list*/
			cursor = s->token;
			DOCB_DB("simple list end")
	  		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
		case 3 : /* next list item*/
			cursor = s->token + strlen(
			  ((docblock_simplelist *)s->simplelist->tail->data)->whitespace);
			DOCB_DB("simple list item whitespace")
			DOCB_RET(DOCB_WHITESPACE,SIMPLELIST);
		case 1 : /* start new list*/
			cursor = s->token + strlen(
			  ((docblock_simplelist *)s->simplelist->tail->data)->whitespace);
			DOCB_DB("simple list start whitespace")
			DOCB_RET(DOCB_SIMPLELISTSTART,SIMPLELIST);
		case 0 : /* error*/
		case 2 : /* carry on as you were*/
			cursor = s->token;
			while (*cursor == ' ' || *cursor == '\t') cursor++;
			DOCB_DB("pre-content whitespace (spaces .)")
			DOCB_RET(DOCB_WHITESPACE,NORMAL)
	  }
	}
newline
	{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end (\\n)")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  DOCB_DB("newline (POSTASTERISK)")
	  DOCB_RET(DOCB_NEWLINE,LINESTART);
	}
.	{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end (.)")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  DOCB_DB("SKIP")
	  --cursor;
	  DOCB_BEGIN(NORMAL);
	}
*/
	}
NORMAL:
	if (s->in_internal) {
/*!re2c
	"*""/"	{ if (s->simplelist->count) {
			if (!s->return_simplelist_end) {
				zend_llist_remove_tail(s->simplelist);
			}
			cursor = s->token; /* empty token*/
			DOCB_DB("simplelist end n1")
			DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
		}
		DOCB_DB("end comment")
		DOCB_RET(DOCB_COMMENTEND,LINESTART);
		}
	"}}"
		{ DOCB_DB("end internal")
		/* if normalcursor is set, this will be re-scanned*/
		if (!s->normalcursor) {
			s->in_internal = 0;
		}
		DOCB_RET(DOCB_ENDINTERNAL,NORMAL);
		}
	"{@}"|"{@*}"
		{ DOCB_DB("escaped inline tag")
		DOCB_RET(DOCB_ESCAPEDINLINETAG,NORMAL);
		}
	"{"tag
		{ DOCB_DB("inline tag start")
		s->in_inlinetag = 1;
		DOCB_RET(DOCB_INLINETAG,INLINETAG);
		}
	"<<""/"?[A-Za-z]+">>"
		{ DOCB_DB("escaped html tag")
		DOCB_RET(DOCB_ESCAPEDHTML,NORMAL);
		}
	'<code>'
		{ DOCB_DB("code section begin")
		s->in_code = 1;
		DOCB_RET(DOCB_CODEOPEN,CODE);
		}
	'<pre>'
		{ DOCB_DB("pre section begin")
		s->in_pre = 1;
		DOCB_RET(DOCB_PREOPEN,PRE);
		}
	'<samp>'
		{ DOCB_DB("samp open")
		DOCB_RET(DOCB_SAMPOPEN,NORMAL);
		}
	'<kbd>'
		{ DOCB_DB("kbd open")
		DOCB_RET(DOCB_KBDOPEN,NORMAL);
		}
	'<var>'
		{ DOCB_DB("var open")
		DOCB_RET(DOCB_VAROPEN,NORMAL);
		}
	'<p>'
		{ DOCB_DB("p open")
		DOCB_RET(DOCB_POPEN,NORMAL);
		}
	'<b>'
		{ DOCB_DB("b open")
		DOCB_RET(DOCB_BOPEN,NORMAL);
		}
	'<i>'
		{ DOCB_DB("i open")
		DOCB_RET(DOCB_IOPEN,NORMAL);
		}
	'<ol>'
		{ DOCB_DB("ol open")
		DOCB_RET(DOCB_OLOPEN,NORMAL);
		}
	'<ul>'
		{ DOCB_DB("ul open")
		DOCB_RET(DOCB_ULOPEN,NORMAL);
		}
	'<li>'
		{ DOCB_DB("li open")
		DOCB_RET(DOCB_LIOPEN,NORMAL);
		}
	'</samp>'
		{ DOCB_DB("samp close")
		DOCB_RET(DOCB_SAMPCLOSE,NORMAL);
		}
	'</kbd>'
		{ DOCB_DB("kbd close")
		DOCB_RET(DOCB_KBDCLOSE,NORMAL);
		}
	'</var>'
		{ DOCB_DB("var close")
		DOCB_RET(DOCB_VARCLOSE,NORMAL);
		}
	'</p>'
		{ DOCB_DB("p close")
		DOCB_RET(DOCB_PCLOSE,NORMAL);
		}
	'</b>'
		{ DOCB_DB("b close")
		DOCB_RET(DOCB_BCLOSE,NORMAL);
		}
	'</i>'
		{ DOCB_DB("i close")
		DOCB_RET(DOCB_ICLOSE,NORMAL);
		}
	'</ol>'
		{ DOCB_DB("ol close")
		DOCB_RET(DOCB_OLCLOSE,NORMAL);
		}
	'</ul>'
		{ DOCB_DB("ul close")
		DOCB_RET(DOCB_ULCLOSE,NORMAL);
		}
	'</li>'
		{ DOCB_DB("li close")
		DOCB_RET(DOCB_LICLOSE,NORMAL);
		}
	'<br>'|'<br/>'|'<br />'
		{ DOCB_DB("br tag")
		DOCB_RET(DOCB_BR,NORMAL);
		}
	newline
		{ DOCB_DB("newline (INTERNAL)")
		DOCB_RET(DOCB_NEWLINE,LINESTART);
		}
	[^*{}<\r\n]+|.
		{ DOCB_DB("normal text")
		DOCB_BEGINT(DOCB_TEXT,NORMAL);
		}
*/
	} /* if (s->in_internal)*/
/*NORMAL_TEXT:*/
/*!re2c
"*""/"	{ if (s->simplelist->count) {
		if (!s->return_simplelist_end) {
			zend_llist_remove_tail(s->simplelist);
		}
		cursor = s->token; /* empty token*/
		DOCB_DB("simplelist end n2")
		DOCB_RET(DOCB_SIMPLELISTEND,POSTASTERISK);
	  }
	  DOCB_DB("end comment")
	  DOCB_RET(DOCB_COMMENTEND,LINESTART);
	}
"{@internal"
	{ DOCB_DB("internal start")
	  if (!s->normalcursor) {
	  	s->in_internal = 1;
	  }
	  DOCB_RET(DOCB_INTERNAL,NORMAL);
	}
"{@}"|"{@*}"
	{ DOCB_DB("escaped inline tag")
	  DOCB_RET(DOCB_ESCAPEDINLINETAG,NORMAL);
	}
"{"tag
	{ DOCB_DB("inline tag start")
	  s->in_inlinetag = 1;
	  DOCB_RET(DOCB_INLINETAG,INLINETAG);
	}
"<<""/"?[A-Za-z]+">>"
	{ DOCB_DB("escaped html tag")
	  DOCB_RET(DOCB_ESCAPEDHTML,NORMAL);
	}
'<code>'
	{ DOCB_DB("code section begin")
	  if (!s->normalcursor) {
	  	s->in_code = 1;
	  }
	  DOCB_RET(DOCB_CODEOPEN,CODE);
	}
'<pre>'
	{ DOCB_DB("pre section begin")
	  if (!s->normalcursor) {
	  	s->in_pre = 1;
	  }
	  DOCB_RET(DOCB_PREOPEN,PRE);
	}
'<samp>'
	{ DOCB_DB("samp open")
	  DOCB_RET(DOCB_SAMPOPEN,NORMAL);
	}
'<kbd>'
	{ DOCB_DB("kbd open")
	  DOCB_RET(DOCB_KBDOPEN,NORMAL);
	}
'<var>'
	{ DOCB_DB("var open")
	  DOCB_RET(DOCB_VAROPEN,NORMAL);
	}
'<p>'
	{ DOCB_DB("p open")
	  DOCB_RET(DOCB_POPEN,NORMAL);
	}
'<b>'
	{ DOCB_DB("b open")
	  DOCB_RET(DOCB_BOPEN,NORMAL);
	}
'<i>'
	{ DOCB_DB("i open")
	  DOCB_RET(DOCB_IOPEN,NORMAL);
	}
'<ol>'
	{ DOCB_DB("ol open")
	  DOCB_RET(DOCB_OLOPEN,NORMAL);
	}
'<ul>'
	{ DOCB_DB("ul open")
	  DOCB_RET(DOCB_ULOPEN,NORMAL);
	}
'<li>'
	{ DOCB_DB("li open")
	  DOCB_RET(DOCB_LIOPEN,NORMAL);
	}
'</samp>'
	{ DOCB_DB("samp close")
	  DOCB_RET(DOCB_SAMPCLOSE,NORMAL);
	}
'</kbd>'
	{ DOCB_DB("kbd close")
	  DOCB_RET(DOCB_KBDCLOSE,NORMAL);
	}
'</var>'
	{ DOCB_DB("var close")
	  DOCB_RET(DOCB_VARCLOSE,NORMAL);
	}
'</p>'
	{ DOCB_DB("p close")
	  DOCB_RET(DOCB_PCLOSE,NORMAL);
	}
'</b>'
	{ DOCB_DB("b close")
	  DOCB_RET(DOCB_BCLOSE,NORMAL);
	}
'</i>'
	{ DOCB_DB("i close")
	  DOCB_RET(DOCB_ICLOSE,NORMAL);
	}
'</ol>'
	{ DOCB_DB("ol close")
	  DOCB_RET(DOCB_OLCLOSE,NORMAL);
	}
'</ul>'
	{ DOCB_DB("ul close")
	  DOCB_RET(DOCB_ULCLOSE,NORMAL);
	}
'</li>'
	{ DOCB_DB("li close")
	  DOCB_RET(DOCB_LICLOSE,NORMAL);
	}
'<br>'|'<br/>'|'<br />'
	{ DOCB_DB("br tag")
	  DOCB_RET(DOCB_BR,NORMAL);
	}
newline
	{ DOCB_DB("newline (NORMAL)")
	  DOCB_RET(DOCB_NEWLINE,LINESTART);
	}
[^*{<\r\n]+|"{"|"<"|"*"
	{ DOCB_DB("normal text")
	  DOCB_BEGINT(DOCB_TEXT,NORMAL);
	}
*/
INLINETAG:
/*!re2c
"*""/"	{ DOCB_DB("end comment")
	  DOCB_RET(DOCB_COMMENTEND,LINESTART);
	}
"\\}"	{ DOCB_DB("escaped end inline tag")
	  DOCB_RET(DOCB_ESCAPEDINLINEEND,INLINETAG);
	}
"}"	{ DOCB_DB("end inline tag")
	  /* if normalcursor is set, this will be re-scanned*/
	  if (!s->normalcursor) {
		s->in_inlinetag = 0;
	  }
	  DOCB_RET(DOCB_ENDINLINETAG,NORMAL);
	}
[^}\\\r\n]+|.
	{ DOCB_DB("inline tag contents")
	  DOCB_BEGINT(DOCB_INLINETAGCONTENTS,INLINETAG);
	}
newline
	{ DOCB_DB("newline (INLINETAG)")
	  DOCB_RET(DOCB_NEWLINE,LINESTART);
	}
*/
CODE:
if (s->in_internal) {
	/*!re2c
	"*""/"	{ DOCB_DB("end comment")
		DOCB_RET(DOCB_COMMENTEND,LINESTART);
		}
	"</code>"
		{ DOCB_DB("close code")
		/* if normalcursor is set, this will be re-scanned*/
		if (!s->normalcursor) {
			s->in_code = 0;
		}
		DOCB_RET(DOCB_CODECLOSE,NORMAL);
		}
	newline
		{ DOCB_DB("newline (CODE)")
		DOCB_RET(DOCB_NEWLINE,LINESTART);
		}
	"}}"
		{ DOCB_DB("end internal")
		/* if normalcursor is set, this will be re-scanned*/
		if (!s->normalcursor) {
			s->in_internal = 0;
		}
		DOCB_RET(DOCB_ENDINTERNAL,CODE);
		}
	"{@}"|"{@*}"
		{ DOCB_DB("escaped inline tag")
		DOCB_RET(DOCB_ESCAPEDINLINETAG,CODE);
		}
	"{"tag
		{ DOCB_DB("inline tag start")
		if (!s->normalcursor) {
			s->in_inlinetag = 1;
		}
		DOCB_RET(DOCB_INLINETAG,INLINETAG);
		}
	'<</code>>'
		{ DOCB_DB("escaped html tag")
		DOCB_RET(DOCB_ESCAPEDHTML,CODE);
		}
	[^*\r\n{}<]+|.
		{ DOCB_DB("normal text")
		DOCB_BEGINT(DOCB_TEXT,CODE);
		}
	*/
} /* if (s->in_internal) */
/* CODE: */
/*!re2c
"*""/"	{ DOCB_DB("end comment")
	  DOCB_RET(DOCB_COMMENTEND,LINESTART);
	}
"</code>"
	{ DOCB_DB("close code")
	  /* if normalcursor is set, this will be re-scanned*/
	  if (!s->normalcursor) {
	  	s->in_code = 0;
	  }
	  DOCB_RET(DOCB_CODECLOSE,NORMAL);
	}
newline
	{ DOCB_DB("newline (CODE)")
	  DOCB_RET(DOCB_NEWLINE,LINESTART);
	}
"{@internal"
	{ DOCB_DB("internal start")
	  if (!s->normalcursor) {
	  	s->in_internal = 1;
	  }
	  DOCB_RET(DOCB_INTERNAL,CODE);
	}
"{@}"|"{@*}"
	{ DOCB_DB("escaped inline tag")
	  DOCB_RET(DOCB_ESCAPEDINLINETAG,CODE);
	}
"{"tag
	{ DOCB_DB("inline tag start")
	  if (!s->normalcursor) {
	  	s->in_inlinetag = 1;
	  }
	  DOCB_RET(DOCB_INLINETAG,INLINETAG);
	}
'<</code>>'
	{ DOCB_DB("escaped html tag")
	  DOCB_RET(DOCB_ESCAPEDHTML,CODE);
	}
[^*\r\n{<]+|.
	{ DOCB_DB("normal text")
	  DOCB_BEGINT(DOCB_TEXT,CODE);
	}
*/

PRE:

if (s->in_internal) {
/*!re2c
	"*""/"	{ DOCB_DB("end comment")
		DOCB_RET(DOCB_COMMENTEND,LINESTART);
		}
	"</pre>"
		{ DOCB_DB("close pre")
		/* if normalcursor is set, this will be re-scanned*/
		if (!s->normalcursor) {
			s->in_pre = 0;
		}
		DOCB_RET(DOCB_PRECLOSE,NORMAL);
		}
	newline
		{ DOCB_DB("newline (PRE)")
		DOCB_RET(DOCB_NEWLINE,LINESTART);
		}
	"}}"
		{ DOCB_DB("end internal")
		/* if normalcursor is set, this will be re-scanned*/
		if (!s->normalcursor) {
			s->in_internal = 0;
		}
		DOCB_RET(DOCB_ENDINTERNAL,PRE);
		}
	"{@}"|"{@*}"
		{ DOCB_DB("escaped inline tag")
		DOCB_RET(DOCB_ESCAPEDINLINETAG,PRE);
		}
	"{"tag
		{ DOCB_DB("inline tag start")
		if (!s->normalcursor) {
			s->in_inlinetag = 1;
		}
		DOCB_RET(DOCB_INLINETAG,INLINETAG);
		}
	'<</pre>>'
		{ DOCB_DB("escaped html tag")
		DOCB_RET(DOCB_ESCAPEDHTML,PRE);
		}
	[^*\r\n{}<]+|.
		{ DOCB_DB("normal text")
		DOCB_BEGINT(DOCB_TEXT,PRE);
		}
*/
} /* if (s->in_internal) */
/* PRE */
/*!re2c
"*""/"	{ DOCB_DB("end comment")
	  DOCB_RET(DOCB_COMMENTEND,LINESTART);
	}
"</pre>"
	{ DOCB_DB("close pre")
	  /* if normalcursor is set, this will be re-scanned*/
	  if (!s->normalcursor) {
		s->in_pre = 0;
	  }
	  DOCB_RET(DOCB_PRECLOSE,NORMAL);
	}
newline
	{ DOCB_DB("newline (PRE)")
	  DOCB_RET(DOCB_NEWLINE,LINESTART);
	}
"{@internal"
	{ DOCB_DB("internal start")
	  if (!s->normalcursor) {
	  	s->in_internal = 1;
	  }
	  DOCB_RET(DOCB_INTERNAL,PRE);
	}
"{@}"|"{@*}"
	{ DOCB_DB("escaped inline tag")
	  DOCB_RET(DOCB_ESCAPEDINLINETAG,PRE);
	}
"{"tag
	{ DOCB_DB("inline tag start")
	  if (!s->normalcursor) {
	  	s->in_inlinetag = 1;
	  }
	  DOCB_RET(DOCB_INLINETAG,INLINETAG);
	}
'<</pre>>'
	{ DOCB_DB("escaped html tag")
	  DOCB_RET(DOCB_ESCAPEDHTML,PRE);
	}
[^*\r\n{<]+|.
	{ DOCB_DB("normal text")
	  DOCB_BEGINT(DOCB_TEXT,PRE);
	}
*/

	return 0;
}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                     docblock-0.2.0/Makefile.frag                                                                        100644    1751     144          207 10450341002  11012                                                                                                                                                                                                                                                                                                                                                                      ext/docblock/docblock_scan.c: ext/docblock/docblock_scan.re
	@$(RE2C) -b -o ext/docblock/docblock_scan.c ext/docblock/docblock_scan.re
                                                                                                                                                                                                                                                                                                                                                                                         docblock-0.2.0/php_docblock.h                                                                       100644    1751     144         5642 10450341002  11264                                                                                                                                                                                                                                                                                                                                                                      /*
  +----------------------------------------------------------------------+
  | PHP Version 5                                                        |
  +----------------------------------------------------------------------+
  | Copyright (c) 1997-2005 The PHP Group                                |
  +----------------------------------------------------------------------+
  | This source file is subject to version 3.0 of the PHP license,       |
  | that is bundled with this package in the file LICENSE, and is        |
  | available through the world-wide-web at the following url:           |
  | http://www.php.net/license/3_0.txt.                                  |
  | If you did not receive a copy of the PHP license and are unable to   |
  | obtain it through the world-wide-web, please send a note to          |
  | license@php.net so we can mail you a copy immediately.               |
  +----------------------------------------------------------------------+
  | Author:                                                              |
  +----------------------------------------------------------------------+
*/

/* $Id: php_docblock.h,v 1.2 2005/11/18 05:17:40 cellog Exp $ */

#ifndef PHP_DOCBLOCK_H
#define PHP_DOCBLOCK_H

extern zend_module_entry docblock_module_entry;
#define phpext_docblock_ptr &docblock_module_entry

#ifdef PHP_WIN32
# if defined(DOCBLOCK_EXPORTS) || (!defined(COMPILE_DL_DOCBLOCK))
#  define PHP_DOCBLOCK_API __declspec(dllexport)
# elif defined(COMPILE_DL_DOCBLOCK)
#  define PHP_DOCBLOCK_API __declspec(dllimport)
# else
#  define PHP_DOCBLOCK_API /* nothing special */
# endif
#else
# define PHP_DOCBLOCK_API
#endif

#ifdef ZTS
#include "TSRM.h"
#endif

PHP_MINIT_FUNCTION(docblock);
PHP_MSHUTDOWN_FUNCTION(docblock);
PHP_RINIT_FUNCTION(docblock);
PHP_RSHUTDOWN_FUNCTION(docblock);
PHP_MINFO_FUNCTION(docblock);

PHP_FUNCTION(docblock_tokenize);
PHP_FUNCTION(docblock_token_name);

/* 
  	Declare any global variables you may need between the BEGIN
	and END macros here:     

ZEND_BEGIN_MODULE_GLOBALS(docblock)
	long  global_value;
	char *global_string;
ZEND_END_MODULE_GLOBALS(docblock)
*/

/* In every utility function you add that needs to use variables 
   in php_docblock_globals, call TSRMLS_FETCH(); after declaring other 
   variables used by that function, or better yet, pass in TSRMLS_CC
   after the last function argument and declare your utility function
   with TSRMLS_DC after the last declared argument.  Always refer to
   the globals in your function as DOCBLOCK_G(variable).  You are 
   encouraged to rename these macros something shorter, see
   examples in any other php module directory.
*/

#ifdef ZTS
#define DOCBLOCK_G(v) TSRMG(docblock_globals_id, zend_docblock_globals *, v)
#else
#define DOCBLOCK_G(v) (docblock_globals.v)
#endif

#endif	/* PHP_DOCBLOCK_H */


/*
 * Local variables:
 * tab-width: 4
 * c-basic-offset: 4
 * End:
 * vim600: noet sw=4 ts=4 fdm=marker
 * vim<600: noet sw=4 ts=4
 */
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              package.xml                                                                                         100644     765       0        17106 10640746077   6345                                                                                                                                                                                                                                                                                                                                                                      <?xml version="1.0" encoding="UTF-8"?>
<package packagerversion="1.6.0" version="2.0" xmlns="http://pear.php.net/dtd/package-2.0" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0 http://pear.php.net/dtd/tasks-1.0.xsd http://pear.php.net/dtd/package-2.0 http://pear.php.net/dtd/package-2.0.xsd">
 <name>Net_URL</name>
 <channel>pear.php.net</channel>
 <summary>Easy parsing of Urls</summary>
 <description>Provides easy parsing of URLs and their constituent parts.</description>
 <lead>
  <name>Richard heyes</name>
  <user>richard</user>
  <email>richard@php.net</email>
  <active>no</active>
 </lead>
 <lead>
  <name>David Coallier</name>
  <user>davidc</user>
  <email>davidc@php.net</email>
  <active>yes</active>
 </lead>
 <date>2007-06-28</date>
 <time>10:57:03</time>
 <version>
  <release>1.0.15</release>
  <api>1.0.15</api>
 </version>
 <stability>
  <release>stable</release>
  <api>stable</api>
 </stability>
 <license uri="http://www.opensource.org/licenses/bsd-license.php">BSD</license>
 <notes>- Fixed Bug #11385 $url was defined.
- Fixed Doc #11017 Fixed docblock problem (cweiske) 
- Fixed Bug #11008 (Override object properties in initialize())
- Fixed Bug #6338 Wrong query string handling
- Fixed Bug #704  Fixed hardcoded value and use ini_get(arg_separator)
- Fixed Bug #1036 Improper default port number detection
- Fixed Bug #1447 use $_SERVER instead of HTTP_SERVER_VARS
- Fixed Bug #1558 _parseRawQueryString failed if arg_sep.input was more than 1 char.
- Fixed Bug #1682 File was in DOC format rather than Unix
- Fixed Bug #2334 Sqare brackets in var names were encoded
- Fixed Bug #2824 Better error handling support.
- Fixed bug #3159 setProtocol was calling getStandardPort incorrectly</notes>
 <contents>
  <dir name="/">
   <file baseinstalldir="Net" md5sum="af793351a5f00e31a2df697b54cfbc02" name="docs/example.php" role="doc" />
   <file baseinstalldir="Net" md5sum="0488b5531c31332113100971be7ba2d9" name="docs/6470.php" role="doc" />
   <file baseinstalldir="Net" md5sum="c7e690d656b56cc48a12399331a35b27" name="URL.php" role="php" />
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>4.0.0</min>
   </php>
   <pearinstaller>
    <min>1.4.0b1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <phprelease />
 <changelog>
  <release>
   <version>
    <release>1.0.14</release>
    <api>1.0.14</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2004-06-19</date>
   <license uri="http://www.opensource.org/licenses/bsd-license.php">BSD</license>
   <notes>Whitespace</notes>
  </release>
  <release>
   <version>
    <release>1.0.13</release>
    <api>1.0.13</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2004-06-05</date>
   <license uri="http://www.opensource.org/licenses/bsd-license.php">BSD</license>
   <notes>Fix bug 1558</notes>
  </release>
  <release>
   <version>
    <release>1.0.12</release>
    <api>1.0.12</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2004-05-08</date>
   <license uri="http://www.opensource.org/licenses/bsd-license.php">BSD</license>
   <notes>Bug fixes release (#704 and #1036)</notes>
  </release>
  <release>
   <version>
    <release>1.0.11</release>
    <api>1.0.11</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2004-01-17</date>
   <license uri="http://www.opensource.org/licenses/bsd-license.php">BSD</license>
   <notes>Bug fixes release (#83 and #471)</notes>
  </release>
  <release>
   <version>
    <release>1.0.10</release>
    <api>1.0.10</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2002-04-06</date>
   <license uri="http://www.opensource.org/licenses/bsd-license.php">BSD</license>
   <notes>Be more flexible in what constitutes a scheme</notes>
  </release>
  <release>
   <version>
    <release>1.0.9</release>
    <api>1.0.9</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2002-04-05</date>
   <license uri="http://www.opensource.org/licenses/bsd-license.php">BSD</license>
   <notes>Fix couple of absolute URL bugs.</notes>
  </release>
  <release>
   <version>
    <release>1.0.8</release>
    <api>1.0.8</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2002-03-06</date>
   <license uri="http://www.opensource.org/licenses/bsd-license.php">BSD</license>
   <notes>Various bugs. Remove auto setting of default url to &apos;/&apos; if a url is supplied
to the constructor. May cause BC issues.</notes>
  </release>
  <release>
   <version>
    <release>1.0.7</release>
    <api>1.0.7</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2002-12-07</date>
   <license uri="http://www.opensource.org/licenses/bsd-license.php">BSD</license>
   <notes>Added method to resolve URL paths of //, ../ and ./</notes>
  </release>
  <release>
   <version>
    <release>1.0.6</release>
    <api>1.0.6</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2002-12-07</date>
   <license uri="http://www.opensource.org/licenses/bsd-license.php">BSD</license>
   <notes>Make usage of [] optional</notes>
  </release>
  <release>
   <version>
    <release>1.0.5</release>
    <api>1.0.5</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2002-11-14</date>
   <license uri="http://www.opensource.org/licenses/bsd-license.php">BSD</license>
   <notes>Allow for URLS such as ...?foo</notes>
  </release>
  <release>
   <version>
    <release>1.0.4</release>
    <api>1.0.4</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2002-07-27</date>
   <license uri="http://www.opensource.org/licenses/bsd-license.php">BSD</license>
   <notes>License change</notes>
  </release>
  <release>
   <version>
    <release>1.0.3</release>
    <api>1.0.3</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2002-06-20</date>
   <license uri="http://www.opensource.org/licenses/bsd-license.php">BSD</license>
   <notes>Now uses HTTP_HOST if available.</notes>
  </release>
  <release>
   <version>
    <release>1.0.2</release>
    <api>1.0.2</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2002-04-28</date>
   <license uri="http://www.opensource.org/licenses/bsd-license.php">BSD</license>
   <notes>updated to fix a minor irritation when running on windows</notes>
  </release>
  <release>
   <version>
    <release>1.0.1</release>
    <api>1.0.1</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2002-04-28</date>
   <license uri="http://www.opensource.org/licenses/bsd-license.php">BSD</license>
   <notes>Maintenance release. Bugs fixed with path detection and defaults.</notes>
  </release>
  <release>
   <version>
    <release>1.0</release>
    <api>1.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2002-02-17</date>
   <license uri="http://www.opensource.org/licenses/bsd-license.php">BSD</license>
   <notes>This is the initial release of the Net_URL package.</notes>
  </release>
 </changelog>
</package>
                                                                                                                                                                                                                                                                                                                                                                                                                                                          Net_URL-1.0.15/docs/example.php                                                                     100644     765       0         6466 10640746077  11303                                                                                                                                                                                                                                                                                                                                                                      <?php
// +-----------------------------------------------------------------------+
// | Copyright (c) 2002-2003, Richard Heyes                                     |
// | All rights reserved.                                                  |
// |                                                                       |
// | Redistribution and use in source and binary forms, with or without    |
// | modification, are permitted provided that the following conditions    |
// | are met:                                                              |
// |                                                                       |
// | o Redistributions of source code must retain the above copyright      |
// |   notice, this list of conditions and the following disclaimer.       |
// | o Redistributions in binary form must reproduce the above copyright   |
// |   notice, this list of conditions and the following disclaimer in the |
// |   documentation and/or other materials provided with the distribution.| 
// | o The names of the authors may not be used to endorse or promote      |
// |   products derived from this software without specific prior written  |
// |   permission.                                                         |
// |                                                                       |
// | THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS   |
// | "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT     |
// | LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR |
// | A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT  |
// | OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, |
// | SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT      |
// | LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, |
// | DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY |
// | THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT   |
// | (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE |
// | OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  |
// |                                                                       |
// +-----------------------------------------------------------------------+
// | Author: Richard Heyes <richard at php net>                            |
// +-----------------------------------------------------------------------+
// $Id: example.php,v 1.12 2007/06/28 14:42:42 davidc Exp $
/**
* This example will decode the url given and display its
* constituent parts.
*/

//include('../URL.php');
include('Net/URL.php');

	//$url = &new Net_URL('https://www.example.com/foo/bar/index.php?foo=bar');
	$url = new Net_URL('https://example.com/pls/portal30/PORTAL30.wwpob_page.changetabs?p_back_url=http%3A%2F%2Fexample.com%2Fservlet%2Fpage%3F_pageid%3D360%2C366%2C368%2C382%26_dad%3Dportal30%26_schema%3DPORTAL30&foo=bar');
?>
<html>
<body>

<pre>
Protocol...: <?php echo $url->protocol?>

Username...: <?php echo $url->user?>

Password...: <?php echo $url->pass?>

Server.....: <?php echo $url->host?>

Port.......: <?php echo $url->port?>

File/path..: <?php echo $url->path?>

Querystring: <?php print_r($url->querystring)?>

Anchor.....: <?php echo $url->anchor?>


Full URL...: <?php echo $url->getUrl()?>
</pre>

</body>
</html>
                                                                                                                                                                                                          Net_URL-1.0.15/docs/6470.php                                                                        100644     765       0          272 10640746077  10215                                                                                                                                                                                                                                                                                                                                                                      <?php
error_reporting(E_ALL);
ini_set('display_errors', 'on');
require_once '../URL.php';

$url = new Net_URL;
$url->setOption('encode_query_keys', true);
print_r($url->querystring);
?>
                                                                                                                                                                                                                                                                                                                                      Net_URL-1.0.15/URL.php                                                                              100644     765       0        35710 10640746077   7374                                                                                                                                                                                                                                                                                                                                                                      <?php
// +-----------------------------------------------------------------------+
// | Copyright (c) 2002-2004, Richard Heyes                                |
// | All rights reserved.                                                  |
// |                                                                       |
// | Redistribution and use in source and binary forms, with or without    |
// | modification, are permitted provided that the following conditions    |
// | are met:                                                              |
// |                                                                       |
// | o Redistributions of source code must retain the above copyright      |
// |   notice, this list of conditions and the following disclaimer.       |
// | o Redistributions in binary form must reproduce the above copyright   |
// |   notice, this list of conditions and the following disclaimer in the |
// |   documentation and/or other materials provided with the distribution.|
// | o The names of the authors may not be used to endorse or promote      |
// |   products derived from this software without specific prior written  |
// |   permission.                                                         |
// |                                                                       |
// | THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS   |
// | "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT     |
// | LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR |
// | A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT  |
// | OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, |
// | SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT      |
// | LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, |
// | DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY |
// | THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT   |
// | (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE |
// | OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  |
// |                                                                       |
// +-----------------------------------------------------------------------+
// | Author: Richard Heyes <richard at php net>                            |
// +-----------------------------------------------------------------------+
//
// $Id: URL.php,v 1.49 2007/06/28 14:43:07 davidc Exp $
//
// Net_URL Class


class Net_URL
{
    var $options = array('encode_query_keys' => false);
    /**
    * Full url
    * @var string
    */
    var $url;

    /**
    * Protocol
    * @var string
    */
    var $protocol;

    /**
    * Username
    * @var string
    */
    var $username;

    /**
    * Password
    * @var string
    */
    var $password;

    /**
    * Host
    * @var string
    */
    var $host;

    /**
    * Port
    * @var integer
    */
    var $port;

    /**
    * Path
    * @var string
    */
    var $path;

    /**
    * Query string
    * @var array
    */
    var $querystring;

    /**
    * Anchor
    * @var string
    */
    var $anchor;

    /**
    * Whether to use []
    * @var bool
    */
    var $useBrackets;

    /**
    * PHP4 Constructor
    *
    * @see __construct()
    */
    function Net_URL($url = null, $useBrackets = true)
    {
        $this->__construct($url, $useBrackets);
    }

    /**
    * PHP5 Constructor
    *
    * Parses the given url and stores the various parts
    * Defaults are used in certain cases
    *
    * @param string $url         Optional URL
    * @param bool   $useBrackets Whether to use square brackets when
    *                            multiple querystrings with the same name
    *                            exist
    */
    function __construct($url = null, $useBrackets = true)
    {
        $this->url = $url;
        $this->useBrackets = $useBrackets;

        $this->initialize();
    }

    function initialize()
    {
        $HTTP_SERVER_VARS  = !empty($_SERVER) ? $_SERVER : $GLOBALS['HTTP_SERVER_VARS'];

        $this->user        = '';
        $this->pass        = '';
        $this->host        = '';
        $this->port        = 80;
        $this->path        = '';
        $this->querystring = array();
        $this->anchor      = '';

        // Only use defaults if not an absolute URL given
        if (!preg_match('/^[a-z0-9]+:\/\//i', $this->url)) {
            $this->protocol = (!empty($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on' ? 'https' : 'http');

            /**
            * Figure out host/port
            */
            if (!empty($HTTP_SERVER_VARS['HTTP_HOST']) && 
                preg_match('/^(.*)(:([0-9]+))?$/U', $HTTP_SERVER_VARS['HTTP_HOST'], $matches)) 
            {
                $host = $matches[1];
                if (!empty($matches[3])) {
                    $port = $matches[3];
                } else {
                    $port = $this->getStandardPort($this->protocol);
                }
            }

            $this->user        = '';
            $this->pass        = '';
            $this->host        = !empty($host) ? $host : (isset($HTTP_SERVER_VARS['SERVER_NAME']) ? $HTTP_SERVER_VARS['SERVER_NAME'] : 'localhost');
            $this->port        = !empty($port) ? $port : (isset($HTTP_SERVER_VARS['SERVER_PORT']) ? $HTTP_SERVER_VARS['SERVER_PORT'] : $this->getStandardPort($this->protocol));
            $this->path        = !empty($HTTP_SERVER_VARS['PHP_SELF']) ? $HTTP_SERVER_VARS['PHP_SELF'] : '/';
            $this->querystring = isset($HTTP_SERVER_VARS['QUERY_STRING']) ? $this->_parseRawQuerystring($HTTP_SERVER_VARS['QUERY_STRING']) : null;
            $this->anchor      = '';
        }

        // Parse the url and store the various parts
        if (!empty($this->url)) {
            $urlinfo = parse_url($this->url);

            // Default querystring
            $this->querystring = array();

            foreach ($urlinfo as $key => $value) {
                switch ($key) {
                    case 'scheme':
                        $this->protocol = $value;
                        $this->port     = $this->getStandardPort($value);
                        break;

                    case 'user':
                    case 'pass':
                    case 'host':
                    case 'port':
                        $this->$key = $value;
                        break;

                    case 'path':
                        if ($value{0} == '/') {
                            $this->path = $value;
                        } else {
                            $path = dirname($this->path) == DIRECTORY_SEPARATOR ? '' : dirname($this->path);
                            $this->path = sprintf('%s/%s', $path, $value);
                        }
                        break;

                    case 'query':
                        $this->querystring = $this->_parseRawQueryString($value);
                        break;

                    case 'fragment':
                        $this->anchor = $value;
                        break;
                }
            }
        }
    }
    /**
    * Returns full url
    *
    * @return string Full url
    * @access public
    */
    function getURL()
    {
        $querystring = $this->getQueryString();

        $this->url = $this->protocol . '://'
                   . $this->user . (!empty($this->pass) ? ':' : '')
                   . $this->pass . (!empty($this->user) ? '@' : '')
                   . $this->host . ($this->port == $this->getStandardPort($this->protocol) ? '' : ':' . $this->port)
                   . $this->path
                   . (!empty($querystring) ? '?' . $querystring : '')
                   . (!empty($this->anchor) ? '#' . $this->anchor : '');

        return $this->url;
    }

    /**
    * Adds or updates a querystring item (URL parameter).
    * Automatically encodes parameters with rawurlencode() if $preencoded
    *  is false.
    * You can pass an array to $value, it gets mapped via [] in the URL if
    * $this->useBrackets is activated.
    *
    * @param  string $name       Name of item
    * @param  string $value      Value of item
    * @param  bool   $preencoded Whether value is urlencoded or not, default = not
    * @access public
    */
    function addQueryString($name, $value, $preencoded = false)
    {
        if ($this->getOption('encode_query_keys')) {
            $name = rawurlencode($name);
        }

        if ($preencoded) {
            $this->querystring[$name] = $value;
        } else {
            $this->querystring[$name] = is_array($value) ? array_map('rawurlencode', $value): rawurlencode($value);
        }
    }

    /**
    * Removes a querystring item
    *
    * @param  string $name Name of item
    * @access public
    */
    function removeQueryString($name)
    {
        if ($this->getOption('encode_query_keys')) {
            $name = rawurlencode($name);
        }

        if (isset($this->querystring[$name])) {
            unset($this->querystring[$name]);
        }
    }

    /**
    * Sets the querystring to literally what you supply
    *
    * @param  string $querystring The querystring data. Should be of the format foo=bar&x=y etc
    * @access public
    */
    function addRawQueryString($querystring)
    {
        $this->querystring = $this->_parseRawQueryString($querystring);
    }

    /**
    * Returns flat querystring
    *
    * @return string Querystring
    * @access public
    */
    function getQueryString()
    {
        if (!empty($this->querystring)) {
            foreach ($this->querystring as $name => $value) {
                // Encode var name
                $name = rawurlencode($name);

                if (is_array($value)) {
                    foreach ($value as $k => $v) {
                        $querystring[] = $this->useBrackets ? sprintf('%s[%s]=%s', $name, $k, $v) : ($name . '=' . $v);
                    }
                } elseif (!is_null($value)) {
                    $querystring[] = $name . '=' . $value;
                } else {
                    $querystring[] = $name;
                }
            }
            $querystring = implode(ini_get('arg_separator.output'), $querystring);
        } else {
            $querystring = '';
        }

        return $querystring;
    }

    /**
    * Parses raw querystring and returns an array of it
    *
    * @param  string  $querystring The querystring to parse
    * @return array                An array of the querystring data
    * @access private
    */
    function _parseRawQuerystring($querystring)
    {
        $parts  = preg_split('/[' . preg_quote(ini_get('arg_separator.input'), '/') . ']/', $querystring, -1, PREG_SPLIT_NO_EMPTY);
        $return = array();

        foreach ($parts as $part) {
            if (strpos($part, '=') !== false) {
                $value = substr($part, strpos($part, '=') + 1);
                $key   = substr($part, 0, strpos($part, '='));
            } else {
                $value = null;
                $key   = $part;
            }

            if (!$this->getOption('encode_query_keys')) {
                $key = rawurldecode($key);
            }

            if (preg_match('#^(.*)\[([0-9a-z_-]*)\]#i', $key, $matches)) {
                $key = $matches[1];
                $idx = $matches[2];

                // Ensure is an array
                if (empty($return[$key]) || !is_array($return[$key])) {
                    $return[$key] = array();
                }

                // Add data
                if ($idx === '') {
                    $return[$key][] = $value;
                } else {
                    $return[$key][$idx] = $value;
                }
            } elseif (!$this->useBrackets AND !empty($return[$key])) {
                $return[$key]   = (array)$return[$key];
                $return[$key][] = $value;
            } else {
                $return[$key] = $value;
            }
        }

        return $return;
    }

    /**
    * Resolves //, ../ and ./ from a path and returns
    * the result. Eg:
    *
    * /foo/bar/../boo.php    => /foo/boo.php
    * /foo/bar/../../boo.php => /boo.php
    * /foo/bar/.././/boo.php => /foo/boo.php
    *
    * This method can also be called statically.
    *
    * @param  string $path URL path to resolve
    * @return string      The result
    */
    function resolvePath($path)
    {
        $path = explode('/', str_replace('//', '/', $path));

        for ($i=0; $i<count($path); $i++) {
            if ($path[$i] == '.') {
                unset($path[$i]);
                $path = array_values($path);
                $i--;

            } elseif ($path[$i] == '..' AND ($i > 1 OR ($i == 1 AND $path[0] != '') ) ) {
                unset($path[$i]);
                unset($path[$i-1]);
                $path = array_values($path);
                $i -= 2;

            } elseif ($path[$i] == '..' AND $i == 1 AND $path[0] == '') {
                unset($path[$i]);
                $path = array_values($path);
                $i--;

            } else {
                continue;
            }
        }

        return implode('/', $path);
    }

    /**
    * Returns the standard port number for a protocol
    *
    * @param  string  $scheme The protocol to lookup
    * @return integer         Port number or NULL if no scheme matches
    *
    * @author Philippe Jausions <Philippe.Jausions@11abacus.com>
    */
    function getStandardPort($scheme)
    {
        switch (strtolower($scheme)) {
            case 'http':    return 80;
            case 'https':   return 443;
            case 'ftp':     return 21;
            case 'imap':    return 143;
            case 'imaps':   return 993;
            case 'pop3':    return 110;
            case 'pop3s':   return 995;
            default:        return null;
       }
    }

    /**
    * Forces the URL to a particular protocol
    *
    * @param string  $protocol Protocol to force the URL to
    * @param integer $port     Optional port (standard port is used by default)
    */
    function setProtocol($protocol, $port = null)
    {
        $this->protocol = $protocol;
        $this->port     = is_null($port) ? $this->getStandardPort($protocol) : $port;
    }

    /**
     * Set an option
     *
     * This function set an option
     * to be used thorough the script.
     *
     * @access public
     * @param  string $optionName  The optionname to set
     * @param  string $value       The value of this option.
     */
    function setOption($optionName, $value)
    {
        if (!array_key_exists($optionName, $this->options)) {
            return false;
        }

        $this->options[$optionName] = $value;
        $this->initialize();
    }

    /**
     * Get an option
     *
     * This function gets an option
     * from the $this->options array
     * and return it's value.
     *
     * @access public
     * @param  string $opionName  The name of the option to retrieve
     * @see    $this->options
     */
    function getOption($optionName)
    {
        if (!isset($this->options[$optionName])) {
            return false;
        }

        return $this->options[$optionName];
    }

}
?>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        --TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::configShow()
--FILE--
<?php
define('MYDIR', __DIR__);
require __DIR__ . '/setup.php.inc';

set_include_path(__DIR__ . '/testit');
$a = PEAR2_Pyrus_Config::singleton(__DIR__ . '/testit', __DIR__ . '/testit/foo.xml');
restore_include_path();
$a->ext_dir = __DIR__ . '/testit/ext';
$a->bin_dir = __DIR__ . '/testit/bin';
file_put_contents(__DIR__ . '/testit/foo.xml', '<pearconfig version="1.0"></pearconfig>');

ob_start();
$cli = new test_scriptfrontend();
$cli->run($args = array (0 => 'config-show'));

$contents = ob_get_contents();
ob_end_clean();
$help1 = 'Using PEAR installation found at ' . __DIR__ . DIRECTORY_SEPARATOR . 'testit' . "\n";
$d = DIRECTORY_SEPARATOR;
$help2 =
   "System paths:\n"
 . "  php_dir => " . __DIR__ . DIRECTORY_SEPARATOR . "testit${d}php\n"
 . "  ext_dir => " . __DIR__ . DIRECTORY_SEPARATOR . "testit${d}ext\n"
 . "  cfg_dir => " . __DIR__ . DIRECTORY_SEPARATOR . "testit${d}cfg\n"
 . "  doc_dir => " . __DIR__ . DIRECTORY_SEPARATOR . "testit${d}docs\n"
 . "  bin_dir => " . __DIR__ . DIRECTORY_SEPARATOR . "testit${d}bin\n"
 . "  data_dir => " . __DIR__ . DIRECTORY_SEPARATOR . "testit${d}data\n"
 . "  www_dir => " . __DIR__ . DIRECTORY_SEPARATOR . "testit${d}www\n"
 . "  test_dir => " . __DIR__ . DIRECTORY_SEPARATOR . "testit${d}tests\n"
 . "  src_dir => " . __DIR__ . DIRECTORY_SEPARATOR . "testit${d}src\n"
 . "  php_bin => " . $a->php_bin . "\n"
 . "  php_ini => " . php_ini_loaded_file() . "\n"
 . "  php_prefix => \n"
 . "  php_suffix => \n"
 . "Custom System paths:\n"
 . "User config (from " . __DIR__ . "${d}testit${d}foo.xml):\n"
 . "  default_channel => pear2.php.net\n"
 . "  preferred_mirror => pear2.php.net\n"
 . "  auto_discover => 0\n"
 . "  http_proxy => \n"
 . "  cache_dir => " . __DIR__ . "${d}testit${d}cache\n"
 . "  temp_dir => " . __DIR__ . "${d}testit${d}temp\n"
 . "  download_dir => " . __DIR__ . "${d}testit${d}downloads\n"
 . "  username => \n"
 . "  password => \n"
 . "  verbose => 1\n"
 . "  preferred_state => stable\n"
 . "  umask => 0022\n"
 . "  cache_ttl => 3600\n"
 . "  sig_type => \n"
 . "  sig_bin => \n"
 . "  sig_keyid => \n"
 . "  sig_keydir => \n"
 . "  my_pear_path => " . __DIR__ . DIRECTORY_SEPARATOR . "testit\n"
 . "  plugins_dir => " . __DIR__ . "${d}testit\n"
 . "Custom User config (from " . __DIR__ . "${d}testit${d}foo.xml):\n";

$test->assertEquals($help1 . $help2,
                    $contents,
                    'help output');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::uninstall(), basic test
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$package = new PEAR2_Pyrus_Package(__DIR__.'/../../../../sandbox/SimpleChannelServer/package.xml');
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
PEAR2_Pyrus_Installer::begin();
PEAR2_Pyrus_Installer::prepare($package);
PEAR2_Pyrus_Installer::commit();
$test->assertFileExists(__DIR__ . '/testit/bin/pearscs', 'bin/pearscs');
$test->assertEquals(decoct(0755), decoct(0777 & fileperms(__DIR__ . '/testit/bin/pearscs')), 'bin/pearscs perms');
$test->assertFileExists(__DIR__ . '/testit/php/PEAR2/SimpleChannelServer.php', 'src/PEAR2/SimpleChannelServer.php');
$test->assertEquals(file_get_contents(__DIR__.'/../../../../sandbox/SimpleChannelServer/src/SimpleChannelServer.php'),
                    file_get_contents(__DIR__ . '/testit/php/PEAR2/SimpleChannelServer.php'), 'files match');

ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'uninstall', 'pear2/PEAR2_SimpleChannelServer', 'pear/foobar'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . 'Package pear/foobar not installed, cannot uninstall' . "\n"
                    . 'Uninstalled pear2.php.net/PEAR2_SimpleChannelServer' . "\n",
                    $contents,
                    'list packages');

$test->assertFileNotExists(__DIR__ . '/testit/bin/pearscs', 'bin/pearscs after');
$test->assertFileNotExists(__DIR__ . '/testit/php/PEAR2/SimpleChannelServer.php', 'src/PEAR2/SimpleChannelServer.php after');
$test->assertEquals(false, isset(PEAR2_Pyrus_Config::current()->registry->package['pear2.php.net/PEAR2_SimpleChannelServer']), 'verify uninstalled');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PEAR2_Pyrus_ScriptFrontend_Commands::channelDiscover() failure
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'testit')) {
    $dir = __DIR__ . '/testit';
    include __DIR__ . '/../../clean.php.inc';
}
mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit', __DIR__ . '/testit/pearconfig.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();

require __DIR__ . '/../../Mocks/Internet.php';

Internet::addDirectory(__DIR__ . '/testit',
                       'https://pear.unl.edu/');
Internet::addDirectory(__DIR__ . '/testit',
                       'http://pear.unl.edu/');
PEAR2_Pyrus_REST::$downloadClass = 'Internet';
PEAR2_Pyrus_ScriptFrontend_Commands::$downloadClass = 'Internet';
$test->assertEquals(false, isset(PEAR2_Pyrus_Config::current()->channelregistry['pear.unl.edu']),
                    'before discover of pear.unl.edu');
ob_start();
$cli = new PEAR2_Pyrus_ScriptFrontend_Commands();
$cli->run($args = array (__DIR__ . '/testit', 'channel-discover', 'pear.unl.edu'));

$contents = ob_get_contents();
ob_end_clean();
$test->assertEquals('Using PEAR installation found at ' . __DIR__. DIRECTORY_SEPARATOR . 'testit' . "\n"
                    . "Discovery of channel pear.unl.edu failed: Download of channel.xml failed\n",
                     $contents,
                    'list packages');

$test->assertEquals(false, isset(PEAR2_Pyrus_Config::current()->channelregistry['pear.unl.edu']),
                    'after discover of pear.unl.edu');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
include __DIR__ . '/../test_framework.php.inc';
mkdir(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
set_include_path(__DIR__ . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__ . '/testit', __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR . 'foo.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();

class test_Config extends PEAR2_Pyrus_Config
{
    static function getDefaultUserConfigFile()
    {
        return __DIR__ . DIRECTORY_SEPARATOR . 'testit' . DIRECTORY_SEPARATOR . 'foo.xml';
    }
}

class test_scriptfrontend extends PEAR2_Pyrus_ScriptFrontend_Commands
{
    public static $configclass = 'test_Config';
    public static $stdin = array();
    public static $index = 0;
    function _readStdin($amount = 1024)
    {
        $ret = self::$stdin[self::$index];
        echo $ret,"\n";
        if (++self::$index >= count(self::$stdin)) {
            throw new Exception('ran out of input, add more to test');
        }
        return $ret;
    }
}<?php
$channel = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile(__DIR__.'/../../ChannelRegistry/sample_channel_complex.xml'));
<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
--TEST--
ChannelFile: test basic channel.xml properties
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
require __DIR__ . '/../setupFiles/setupChannelFile.php.inc';
// $channel should be set up!
require __DIR__ . '/../../ChannelRegistry/AllRegistries/info/basic.template';
require __DIR__ . '/../../ChannelRegistry/AllRegistries/info/rest.template';
require __DIR__ . '/../../ChannelRegistry/AllRegistries/info/mirrors.template';


?>
===DONE===
--EXPECT--
===DONE===--TEST--
ChannelFile: random channelfile tests
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$c = new PEAR2_Pyrus_ChannelFile(file_get_contents(__DIR__ . '/../../ChannelRegistry/sample_channel.xml'), true);

$test->assertEquals('pear.unl.edu', $c->name, 'verify we got the right info');

try {
    $c = new PEAR2_Pyrus_ChannelFile(false, true);
} catch (Exception $e) {
    $test->assertEquals('Unable to open channel xml file  or file was empty.', $e->getMessage(), 'error 1');
}

try {
    $c = new PEAR2_Pyrus_ChannelFile('greg.chiaraquartet.net/poop', false, true);
    $test->assertEquals(false, true, 'succeeded where it should fail');
} catch (Exception $e) {
}

$c->name = 'test';
$test->assertEquals('test', $c->name, '__set');

try {
    $c->foo();
} catch (Exception $e) {
    $test->assertEquals('unknown method: ::foo', $e->getMessage(), 'error 2');
}

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml toArray(), only 1 file
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../setupFiles/setupPackageFile.php.inc';
$reg = $package; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/toarray.onefile.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml toArray(), for packaging
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../setupFiles/setupPackageFile.php.inc';
$reg = $package; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/toarray.packaging.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml toArray(), multiple <group> dependencies
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../setupFiles/setupPackageFile.php.inc';
$reg = $package; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/toarray.multiplegroupdep.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml toArray(), for packaging w/filelist
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../setupFiles/setupPackageFile.php.inc';
$reg = $package; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/toarray.packaging.filelist.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml toArray()
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../setupFiles/setupPackageFile.php.inc';
$reg = $package; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/toarray.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml toArray(), for packaging w/filelist (3)
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../setupFiles/setupPackageFile.php.inc';
$reg = $package; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/toarray.packaging.filelist3.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml toArray(), for packaging w/filelist (2)
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../setupFiles/setupPackageFile.php.inc';
$reg = $package; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/toarray.packaging.filelist2.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml compatible property, basic operation
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/compatible.basic.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml compatible property, basic set
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/compatible.set.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml isCompatible()
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$pf1 = new PEAR2_Pyrus_PackageFile_v2;
$pf1->name = 'P1';
$pf1->channel = 'pear2.php.net';
$pf1->version['release'] = '1.0.0';

$test->assertEquals('1.0.0', $pf1->version['release'], 'confirm version is what we expect');

$pf2 = new PEAR2_Pyrus_PackageFile_v2;
$pf2->channel = 'pear2.php.net';

$test->assertEquals(false, $pf2->isCompatible($pf1), 'no compatible section');

$pf2->compatible['pear2.php.net/P1']->min('0.9.0')->max('1.2.0');
$pf2->uri = 'http://localhost';

$test->assertEquals(false, $pf2->isCompatible($pf1), 'uri');

$pf2->channel = 'pear2.php.net';

$test->assertEquals(true, $pf2->isCompatible($pf1), 'success');

$pf2->compatible['pear2.php.net/P1']->exclude('1.0.0');

$test->assertEquals(false, $pf2->isCompatible($pf1), 'fail exclude');

$pf2->compatible['pear2.php.net/P1']->exclude(null);
$pf2->compatible['pear2.php.net/P1']->min('1.1.0');

$test->assertEquals(false, $pf2->isCompatible($pf1), 'fail min');

$pf2->compatible['pear2.php.net/P1']->min('1.0.0');

$test->assertEquals(true, $pf2->isCompatible($pf1), 'success min bounds');

$pf2->compatible['pear2.php.net/P1']->min('0.9.0');
$pf2->compatible['pear2.php.net/P1']->max('0.9.9');

$test->assertEquals(false, $pf2->isCompatible($pf1), 'fail max');
$pf2->compatible['pear2.php.net/P1']->max('1.0.0');

$test->assertEquals(true, $pf2->isCompatible($pf1), 'success max bounds');

$pf1->name = 'notfound';

$test->assertEquals(false, $pf2->isCompatible($pf1), 'fail not found');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml compatible property, errors
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$package = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/compatible.errors.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml odd orderings (bloomy package)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$apc = new PEAR2_Pyrus_Package(__DIR__ . '/packages/bloomy/package.xml');
$test->assertEquals('bloomy', $apc->name, 'if we get here, all is well unless this part fails');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml odd orderings (Config package)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$apc = new PEAR2_Pyrus_Package(__DIR__ . '/packages/Config/package.xml');
$test->assertEquals('Config', $apc->name, 'if we get here, all is well unless this part fails');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml odd orderings (APC package)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$apc = new PEAR2_Pyrus_Package(__DIR__ . '/packages/APC/package.xml');
$test->assertEquals('APC', $apc->name, 'if we get here, all is well unless this part fails');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml odd orderings (Auth_Prefmanager package)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$apc = new PEAR2_Pyrus_Package(__DIR__ . '/packages/Auth_PrefManager/package.xml');
$test->assertEquals('Auth_PrefManager', $apc->name, 'if we get here, all is well unless this part fails');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml odd orderings (Auth package)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
$apc = new PEAR2_Pyrus_Package(__DIR__ . '/packages/Auth/package.xml');
$test->assertEquals('Auth', $apc->name, 'if we get here, all is well unless this part fails');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit', __DIR__ . '/testit/pearconfig.xml');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();<?xml version="1.0" encoding="UTF-8"?>
<package packagerversion="1.5.4" version="2.0" xmlns="http://pear.php.net/dtd/package-2.0" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0 http://pear.php.net/dtd/tasks-1.0.xsd http://pear.php.net/dtd/package-2.0 http://pear.php.net/dtd/package-2.0.xsd">
 <name>Config</name>
 <channel>pear.php.net</channel>
 <summary>Your configuration&apos;s swiss-army knife.</summary>
 <description>The Config package provides methods for configuration manipulation.
* Creates configurations from scratch
* Parses and outputs different formats (XML, PHP, INI, Apache...)
* Edits existing configurations
* Converts configurations to other formats
* Allows manipulation of sections, comments, directives...
* Parses configurations into a tree structure
* Provides XPath like access to directives</description>
 <lead>
  <name>Bertrand Mansion</name>
  <user>mansion</user>
  <email>bmansion@mamasam.com</email>
  <active>no</active>
 </lead>
 <lead>
  <name>Ryan King</name>
  <user>ryansking</user>
  <email>ryansking@php.net</email>
  <active>no</active>
 </lead>
 <lead>
  <name>Adam Ashley</name>
  <user>aashley</user>
  <email>aashley@php.net</email>
  <active>yes</active>
 </lead>
 <developer>
  <name>Adam Harvey</name>
  <user>aharvey</user>
  <email>aharvey@php.net</email>
  <active>yes</active>
 </developer>
 <date>2007-06-12</date>
 <time>05:29:14</time>
 <version>
  <release>1.10.11</release>
  <api>1.10.8</api>
 </version>
 <stability>
  <release>stable</release>
  <api>stable</api>
 </stability>
 <license uri="http://www.php.net/license">PHP License</license>
 <notes>* Fixed Bug #11184: Knock on problems from fix for Bug #10185. Thanks to
  Thomas Despoix and Carsten Wiedmann for helping me understand it properly.</notes>
 <contents>
  <dir name="/">
   <file md5sum="24c8aa0428acef34c3941da6e316ee64" name="Config/Container/Apache.php" role="php" />
   <file md5sum="97334aef3975512fe8820dd0577ec135" name="Config/Container/GenericConf.php" role="php" />
   <file md5sum="cea4ff38f7e4240e2c999be4aa1854e6" name="Config/Container/IniCommented.php" role="php" />
   <file md5sum="33e8495e6c8da599248193bf66f3b479" name="Config/Container/IniFile.php" role="php" />
   <file md5sum="86ddfaabf01eb9cb3d21e8afb5022930" name="Config/Container/PHPArray.php" role="php" />
   <file md5sum="5754e39e081433aaf132c64db676a163" name="Config/Container/PHPConstants.php" role="php" />
   <file md5sum="957cbd88a70e34e94ed65ab7d3df5d7d" name="Config/Container/XML.php" role="php" />
   <file md5sum="5cb17578402b866ed080a8e77a8a9a9b" name="Config/Container.php" role="php" />
   <file md5sum="3f258a90dbd6371c52337d83e763bdb8" name="docs/Apache.php" role="doc" />
   <file md5sum="702edcddaf83d81196433887fa383a09" name="docs/IniCommented.php" role="doc" />
   <file md5sum="bce55b10d2e5ffef5a4a04aba92851ce" name="docs/IniFromScratch.php" role="doc" />
   <file md5sum="d77a133b013cdc9794d0f6e09b6b88d1" name="test/bug2742.ini" role="test" />
   <file md5sum="1c00244cdc36cff6960e394f1746c86d" name="test/bug2742.phpt" role="test" />
   <file md5sum="a750197af925dcfbe4f30d493f43896d" name="test/bug2780.phpt" role="test" />
   <file md5sum="756ac177b9281c16a54d5beabe5ece9b" name="test/bug3051.phpt" role="test" />
   <file md5sum="61064633ed23cbec0f706fde3751a3e4" name="test/bug3051.xml" role="test" />
   <file md5sum="ebe9d890f041a26b0a37f4b97355a7fd" name="test/bug3137.phpt" role="test" />
   <file md5sum="2935e7e4362eca07908f005e92683460" name="test/bug3298.phpt" role="test" />
   <file md5sum="7d577265dcdecebc67dee5118268ace5" name="test/bug3298.xml" role="test" />
   <file md5sum="2b36a2cc7b70a10d13799c116a5536bb" name="test/bug3398.ini" role="test" />
   <file md5sum="373109b53b1b5129f68c7b81aa31f297" name="test/bug3398.phpt" role="test" />
   <file md5sum="08ec9d9f4649fefda49b1991d3fb20b1" name="test/bug3590-input.php" role="test" />
   <file md5sum="164099132d1dedf4ac03b3f4a5afba19" name="test/bug3590.phpt" role="test" />
   <file md5sum="ad05c4a11c5b08b25488aab6248192a7" name="test/bug4623.conf" role="test" />
   <file md5sum="9a8c732b18ec989dbf90c00bba4e0c55" name="test/bug4623.phpt" role="test" />
   <file md5sum="f6fec7ec6187f591c51fc7b09130da7d" name="test/bug6441.ini" role="test" />
   <file md5sum="7e9519b6ccfa0b8a3e369023add3ead1" name="test/bug6441.phpt" role="test" />
   <file md5sum="8a3b57b2ae8d47ee78056b99e620c282" name="test/bug7544-inicommented.phpt" role="test" />
   <file md5sum="db33c7454539f9fbc02897f5de2b90b2" name="test/bug7544-inifile.phpt" role="test" />
   <file md5sum="8aa8d748b9266e30028e75889ed5ff0c" name="test/bug7544.ini" role="test" />
   <file md5sum="b293dee5fc7a375dbf72fae9b3d65bca" name="test/bug7652.phpt" role="test" />
   <file md5sum="3fcbdf4ceabeca34357cfcd3266e5e6d" name="test/bug7652.xml" role="test" />
   <file md5sum="db3a27af6cf7afbeafb56e55ba63e601" name="test/bug8357-inicommented.phpt" role="test" />
   <file md5sum="68f5313a4cb289711453a2561ba1645a" name="test/bug8357-inifile.phpt" role="test" />
   <file md5sum="23285375454662259e5821eb991d124d" name="test/bug8357.ini" role="test" />
   <file md5sum="e9ab76a4d81cc67d98aec18c049e93c0" name="test/bug10010.phpt" role="test" />
   <file md5sum="39174eaab97f7c97ac56dc8c99396947" name="test/bug10185.phpt" role="test" />
   <file md5sum="85a595db7562821ef50297502a50317b" name="test/phpt_test.php.inc" role="test" />
   <file md5sum="1dce06e33ccfa8f55463450db8b4d365" name="test/setup.php.inc" role="test" />
   <file baseinstalldir="/" md5sum="a664418fa43875d263b20e611e4edee2" name="Config.php" role="php" />
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>4.3.0</min>
   </php>
   <pearinstaller>
    <min>1.4.0b1</min>
   </pearinstaller>
  </required>
  <optional>
   <package>
    <name>XML_Parser</name>
    <channel>pear.php.net</channel>
   </package>
   <package>
    <name>XML_Util</name>
    <channel>pear.php.net</channel>
   </package>
  </optional>
 </dependencies>
 <phprelease />
 <changelog>
  <release>
   <date>2007-03-26</date>
   <time>22:03:06</time>
   <version>
    <release>1.10.10</release>
    <api>1.10.8</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fix Bug #10010: numeric index lost when parsing subarrays
* Fix Bug #10185: problem with addslashs in container &quot;PHPArray&quot; / method &quot;toString&quot;</notes>
  </release>
  <release>
   <date>2006-12-22</date>
   <time>09:00:00</time>
   <version>
    <release>1.10.9</release>
    <api>1.10.8</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fixed Bug #9632: PHPConstants container not registered. Thanks to 
  Clemens Lang &lt;neverpanic at gmail dot com&gt;</notes>
  </release>
  <release>
   <date>2006-11-10</date>
   <time>09:00:00</time>
   <version>
    <release>1.10.8</release>
    <api>1.10.8</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fixed Bug #7097: writeConfig incorrect when root has attributes</notes>
  </release>
  <release>
   <date>2006-10-20</date>
   <time>03:23:43</time>
   <version>
    <release>1.10.8RC1</release>
    <api>1.10.8</api>
   </version>
   <stability>
    <release>beta</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fixed Bug #7097: writeConfig incorrect when root has attributes
  This fix has the potential to break other things as it is a big change to the
  PHPArray backend. Please test.</notes>
  </release>
  <release>
   <version>
    <release>1.10.7</release>
    <api>1.10.7</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2006-08-11</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>Changelog:
 * Fixed Bug #7544: Empty attributes in IniCommented are being discarded (Luis Correa d&apos;Almeida)
 * Fixed Bug #7652: wrong xml to phparray convert. Caused by counting position
   of directives and sections seperately. While when converting to some containers
   we want to count them together.
 * Add tests to confirm behaviour of Bug #8357. Do not believe it is fixable without removing
   features.</notes>
  </release>
  <release>
   <version>
    <release>1.10.6</release>
    <api>1.10.6</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2006-02-14</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>Changelog:
 * More PHP 4.4 and 5.1 return by reference fixes
 * Fixed bug #4477 fatal error when key of array is longer than 114 chars under PHP4.x
 * Fixed bug #6385 Allow colon in directive name in IniCommented to match IniFile.
 * Fixed bug #6441 true and false literals should be parsed appropriately. Booleans are now parsed the same as in parse_ini_file()</notes>
  </release>
  <release>
   <version>
    <release>1.10.5</release>
    <api>1.10.5</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2006-01-03</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>Changelog:
 * Make what we add quotes around consistent between IniFile and IniCommented.
 * Fixed bug #3137 Adding a comment caused problems outputing in phparray format.
 * Fixed bug #3590 Handling phparray formats with implicit numeric keys.
 * Fixed bug #4623 Rendering to Apache format a second time looses section attributes.
 * Fixed bug #5598 Allow &apos;=&apos; in values and output it correctly in IniFile format.
 * Fixed bugs #5033, #5835, #6294 Return only variables by reference as required by PHP 4.4 and 5.1.
 * Partial Fix for #6385 Allow colon in directive name in IniCommented to match IniFile.</notes>
  </release>
  <release>
   <version>
    <release>1.10.4</release>
    <api>1.10.4</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2005-02-10</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>Changelog:
    * Fixed bug #3298 which wouldn&apos;t parse arrays with numerical indexes correctly.
    *Fixed bug #2742 which didn&apos;t trim variable names in Inicommented file
    *changed XML_Parser and XML_Util dependencies to optional, since they&apos;re only needed 
    when parsing XML files (bug #2738)
    *added a new container for editing files of php constants, courtesy of philip ortel [me@phillipoertel.com] (beta)</notes>
  </release>
  <release>
   <version>
    <release>1.10.3</release>
    <api>1.10.3</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2004-10-13</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>Changelog:
    *Fixed bug #2179 which prevented URL&apos;s containting ~ in ini files to be parsed correctly
    *Fixed bug #2439 which caused Config_Containter::countChildren() to return a PEAR_ERROR
        object when called on a non-section Config_Container object.  This change brings
        the object&apos;s behavior inline with the documentation. Beware, if your code relies
        on the previous behavior, this change may break your code.</notes>
  </release>
  <release>
   <version>
    <release>1.10.2</release>
    <api>1.10.2</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2004-06-14</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fixed bug #1633 related to case-sensitivity of method names in PHP4.
  causing PHPArray container not to work correctly. See also #1556.
  Patch provided by m at tacker dotorg.</notes>
  </release>
  <release>
   <version>
    <release>1.10.1</release>
    <api>1.10.1</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2004-06-04</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fixed problems with PHP5 case sensitivity on class and method names.
* Added possibility to actually replace the root container by using method
Config::setRoot() with a container of type &apos;section&apos; and name &apos;root&apos;.
* XML parser now makes use of the encoding specified in the options array.
* Fixed a warning with array_splice() on an unset $children.</notes>
  </release>
  <release>
   <version>
    <release>1.10</release>
    <api>1.10</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2003-11-29</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Added &apos;isFile&apos; option to XML container
* Fix a bug when a directive has no content in XML configurations
* Fix slowdown caused by uniqid() on Linux
* Fix regular expression for directives in .ini files (Emil Biserov)
* Fix bug #132 concerning % in .ini files (Wagner netsols.de)
* Fix possible warning if text is empty in .ini commented (Dean Urmson)
* Small speed optimizations</notes>
  </release>
  <release>
   <version>
    <release>1.9</release>
    <api>1.9</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2003-09-21</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Added a new boolean option/parameter in XML, PHPArray and toArray() to set
  whether attributes should be rendered.
* Added comments rendering in XML.
* Fix typo in PHPArray when setting the configuration array name (Laurent Laville)</notes>
  </release>
  <release>
   <version>
    <release>1.8.1</release>
    <api>1.8.1</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2003-09-07</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fix a bug in XML container related to cdata handler read by chunk, reported by Stephan Wentz</notes>
  </release>
  <release>
   <version>
    <release>1.8</release>
    <api>1.8</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2003-08-16</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fix a bug in setRoot() for the XML generator
* Added new method searchPath() to Config_Container (taken from Alan Knowles for XML_Tree)
* Added float detection in Config_Container_PHPArray (Sylvinus Prodi)
* Uses XML_Util in xml container for special entities translation, customizable linebreaks, indents, xml declaration</notes>
  </release>
  <release>
   <version>
    <release>1.7</release>
    <api>1.7</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2003-06-16</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Added new method registerConfigType() (Greg Beaver)
* Root containers are not named &apos;root&apos; anymore (Bertrand Mansion)
* IniCommented handles comma, quotes, slashes (Greg Beaver)
* IniFile and IniCommented take care of slashes (Greg Beaver)
* Method _parseArray() in PHPArray refactored and much faster (Bertrand Mansion)
* Fix bugs with certain type of arrays with PHPArray (Bertrand Mansion)
* PHPArray now returns values between single quotes (Jean-Marc Fontaine)</notes>
  </release>
  <release>
   <version>
    <release>1.6</release>
    <api>1.6</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2003-05-20</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fix bug #23690 in toArray reported by Rob Halff</notes>
  </release>
  <release>
   <version>
    <release>1.5</release>
    <api>1.5</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2003-04-14</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Added an id private property for each node
* Fix a bug in toArray when items are duplicates</notes>
  </release>
  <release>
   <version>
    <release>1.4</release>
    <api>1.4</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2003-04-02</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fix setDirective method in Container
* Fix warnings in foreach loop when attributes are not set
* Added phpdoc comments</notes>
  </release>
  <release>
   <version>
    <release>1.3</release>
    <api>1.3</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2003-03-26</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fixed missing quote in xml generation (Nicolas Guennoc)
* Fixed warning in xml container when no attributes (Nicolas Guennoc)
* Added methods getAttribute and updateAttributes to container.
* Added possibility to get item by looking at its attributes in getItem()
* PHPArray container automatically generates array name when not specified in options
* XML Container can accept a name too that will generate the global root entity if needed</notes>
  </release>
  <release>
   <version>
    <release>1.2</release>
    <api>1.2</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2003-03-24</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>First stable release.
* Added an XML container (uses XML_Parser),
* Possibility to convert from one format to another,
* Fixes in toArray(),
* Added attributes to containers,
* New methods for item manipulation.</notes>
  </release>
  <release>
   <version>
    <release>1.1</release>
    <api>1.1</api>
   </version>
   <stability>
    <release>beta</release>
    <api>beta</api>
   </stability>
   <date>2002-10-08</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>Fix bug in toArray().
Thanks to Mark Polsen for noticing it.</notes>
  </release>
  <release>
   <version>
    <release>1.0</release>
    <api>1.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2006-10-20</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>Complete rewrite : API has changed.
The class now uses a tree structure of container objects.
As a consequence, backward compatibility is not provided !!!
Look at the Apache.php and IniCommented.php scripts in &apos;docs&apos; for usage examples.
Some containers are still missing : XML and DB.</notes>
  </release>
  <release>
   <version>
    <release>0.3.1</release>
    <api>0.3.1</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2006-10-20</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>Documentation is in README.Config.
0.3.1
-  E_ALL fixes</notes>
  </release>
  <release>
   <version>
    <release>0.3</release>
    <api>0.3</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2006-10-20</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>- some fixes
- add WDDX-Container for config data in WDDX-files
- add phpIniFile, does the same like IniFile but based on the PHP build-in function parse_ini_file()</notes>
  </release>
  <release>
   <version>
    <release>0.2.2</release>
    <api>0.2.2</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2006-10-20</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>- Only the first char of -&gt;feature[&apos;cc&apos;] is taken as a comment deliminator
- quoting supports both methods:
  [bla]
  foo = &quot;&apos;bar&apos;&quot;
  bar = &apos;&quot;foo&quot;&apos;
- Value parser only parser until first comment-char or the end of the string, therefore spaces surrounded by nonspaces don&apos;t have to be quoted.</notes>
  </release>
  <release>
   <version>
    <release>0.2.1</release>
    <api>0.2.1</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2006-10-20</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>- Bug fixed, when $feature in ParseInput was not set 
- some e_warnings fixed
(thanks to Markus Fischer for the reports)</notes>
  </release>
 </changelog>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<package packagerversion="1.7.2" version="2.0" xmlns="http://pear.php.net/dtd/package-2.0" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0 http://pear.php.net/dtd/tasks-1.0.xsd http://pear.php.net/dtd/package-2.0 http://pear.php.net/dtd/package-2.0.xsd">
 <name>APC</name>
 <channel>pecl.php.net</channel>
 <summary>Alternative PHP Cache</summary>
 <description>APC is a free, open, and robust framework for caching and optimizing PHP intermediate code.</description>
 <lead>
  <name>Daniel Cowgill</name>
  <user>dcowgill</user>
  <email>dan@mail.communityconnect.com</email>
  <active>no</active>
 </lead>
 <lead>
  <name>George Schlossnagle</name>
  <user>gschlossnagle</user>
  <email>george@omniti.com</email>
  <active>no</active>
 </lead>
 <lead>
  <name>Rasmus Lerdorf</name>
  <user>rasmus</user>
  <email>rasmus@php.net</email>
  <active>yes</active>
 </lead>
 <lead>
  <name>Gopal Vijayaraghavan</name>
  <user>gopalv</user>
  <email>gopalv@php.net</email>
  <active>yes</active>
 </lead>
 <developer>
  <name>Edin Kadribasic</name>
  <user>edink</user>
  <email>edink@emini.dk</email>
  <active>yes</active>
 </developer>
 <developer>
  <name>Ilia Alshanetsky</name>
  <user>iliaa</user>
  <email>ilia@prohost.org</email>
  <active>yes</active>
 </developer>
 <developer>
  <name>Marcus B√∂rger</name>
  <user>helly</user>
  <email>helly@php.net</email>
  <active>yes</active>
 </developer>
 <developer>
  <name>Sara Golemon</name>
  <user>pollita</user>
  <email>pollita@php.net</email>
  <active>yes</active>
 </developer>
 <developer>
  <name>Brian Shire</name>
  <user>shire</user>
  <email>shire@php.net</email>
  <active>yes</active>
 </developer>
 <date>2008-12-12</date>
 <time>17:07:26</time>
 <version>
  <release>3.1.2</release>
  <api>3.1.0</api>
 </version>
 <stability>
  <release>beta</release>
  <api>beta</api>
 </stability>
 <license uri="http://www.php.net/license">PHP License</license>
 <notes>- pecl package.xml/build fixes (bjori)</notes>
 <contents>
  <dir name="/">
   <file md5sum="841596cff3b9bd83e79d01ccb591ff55" name="tests/apc_001.phpt" role="test" />
   <file md5sum="cc1dba4e429ff93dce1ca7dea01c2899" name="tests/apc_002.phpt" role="test" />
   <file md5sum="04c800594e9934cf8e15157e9bd4c52f" name="tests/apc_003.phpt" role="test" />
   <file md5sum="538f198f432614d9f2c0819fea5193a7" name="tests/apc_003b.phpt" role="test" />
   <file md5sum="43c8e1c89fad5bb25ded528837e63b2b" name="tests/apc_004.phpt" role="test" />
   <file md5sum="06432141cbc82df8ddde7fac52e9f65e" name="tests/apc_005.phpt" role="test" />
   <file md5sum="af5fb27e3ff8867bf44d043aad378261" name="tests/apc_006.phpt" role="test" />
   <file md5sum="0bcb17840e8281a5ffc2e82278319b53" name="tests/apc_007.phpt" role="test" />
   <file md5sum="0674cbe2e88fe5c331bee3fbb1395d4f" name="tests/apc_008.phpt" role="test" />
   <file md5sum="87bdae8d939c92ea82d7ee914728e6f8" name="tests/apc_009.phpt" role="test" />
   <file md5sum="ae89fc951656bafc0028d3c3bf0f5e4d" name="tests/iterator_001.phpt" role="test" />
   <file md5sum="278fd065fa65c6f4634cdb3bc91caf95" name="tests/iterator_002.phpt" role="test" />
   <file md5sum="1bbc3b6d212f0a89ce3fe11b67fa7b9f" name="tests/iterator_003.phpt" role="test" />
   <file md5sum="babe1d2bc638371cd180e3324f0792cb" name="tests/iterator_004.phpt" role="test" />
   <file md5sum="3a70387a8eb37bc391b67d2bf8eb9eb2" name="tests/iterator_005.phpt" role="test" />
   <file md5sum="2834d8f550ac95862c508c46f69e4c15" name="tests/iterator_006.phpt" role="test" />
   <file md5sum="82a40b37c545631cd87c3e1e421353b5" name="tests/iterator_007.phpt" role="test" />
   <file md5sum="6ecba4154b6bd6f8703000f5198710cc" name="tests/skipif.inc" role="test" />
   <file md5sum="ed9a4192d7ab7f953856b92c5e689cf5" name="CHANGELOG" role="doc" />
   <file md5sum="f5ca8db7fde5fb83ab79b509279b9856" name="INSTALL" role="doc" />
   <file md5sum="694f49a7e1f276ba75a3dd2c5acd580d" name="LICENSE" role="doc" />
   <file md5sum="eea150699d3dffb2cdf7d243854189d7" name="NOTICE" role="doc" />
   <file md5sum="efa40416571fc54aa59912203c0391e6" name="TODO" role="doc" />
   <file md5sum="b7dd14328e218d3ecc97d85fb83d7ba7" name="TECHNOTES.txt" role="doc" />
   <file md5sum="050a47e9a05043e698eeee1b580b478d" name="apc.c" role="src" />
   <file md5sum="09a525ff9a3850e6de42eee2adf07463" name="apc.dsp" role="src" />
   <file md5sum="67d689ece47e2f43d1a7bdfcea3d4400" name="apc.h" role="src" />
   <file md5sum="352831e4db2c9bba97944013604bd6e9" name="apc_cache.c" role="src" />
   <file md5sum="bd42e24d736266b668c7b1adae301f16" name="apc_cache.h" role="src" />
   <file md5sum="84e7b572e3a42287fb4967a5dd91fc9a" name="apc_compile.c" role="src" />
   <file md5sum="4e881672af8c19547b90d64603e3182c" name="apc_compile.h" role="src" />
   <file md5sum="7762f65c0e459163866663a56447049d" name="apc_debug.c" role="src" />
   <file md5sum="46d182a6122f3c29a1904f62af7cfb51" name="apc_debug.h" role="src" />
   <file md5sum="65367f710406a4dc87f274ca46417625" name="apc_fcntl.c" role="src" />
   <file md5sum="dcabe06fc0a3d7547899ece513ec1100" name="apc_fcntl.h" role="src" />
   <file md5sum="202ae82f6732496f4a6c761f4e45e78c" name="apc_globals.h" role="src" />
   <file md5sum="c84940480451b2f0de65e359e42b76d9" name="apc_lock.h" role="src" />
   <file md5sum="56d9bcb55dc89c89418454ed340a0c0e" name="apc_main.c" role="src" />
   <file md5sum="b227ce21ac3370c3d7f564e4d303540d" name="apc_main.h" role="src" />
   <file md5sum="cbc6ebf0be7b610cf5d3e26c54ff4d4e" name="apc_mmap.c" role="src" />
   <file md5sum="113fd94c3c05423b997b41e03af86cdd" name="apc_php.h" role="src" />
   <file md5sum="c885c9cef69b2ba06f9b8333708f8ea5" name="apc_pthreadmutex.c" role="src" />
   <file md5sum="8d07a72d0ca3a69fb012d82846383a11" name="apc_pthreadmutex.h" role="src" />
   <file md5sum="63f80e9ac6076e6fb93bbb05b566eb5c" name="apc_sem.c" role="src" />
   <file md5sum="cbfacf4486d4d0a6f47a9947cf100838" name="apc_sem.h" role="src" />
   <file md5sum="300306bdd82ff7579515ff9270c56e3f" name="apc_shm.c" role="src" />
   <file md5sum="a30c912a457554fbbf8bb909536350e1" name="apc_shm.h" role="src" />
   <file md5sum="b5e560ffdbf8e273786d33fe0aab49b4" name="apc_sma.c" role="src" />
   <file md5sum="80a9785a7032a5726871529fc55ab2fe" name="apc_sma.h" role="src" />
   <file md5sum="228f76738e0f800fe4a0ff554a2db8f5" name="apc_spin.c" role="src" />
   <file md5sum="c6d00605fec2c886f9d98ea56e3372f2" name="apc_spin.h" role="src" />
   <file md5sum="ac4574ad062994d05e13dc458350043a" name="apc_stack.c" role="src" />
   <file md5sum="7d9fea097e632261c6f5039ad1d769fa" name="apc_stack.h" role="src" />
   <file md5sum="13d01cf3d1d022ee2a9cf14df3ecede8" name="apc_zend.c" role="src" />
   <file md5sum="0532efbc67417673a19cdf2161e71877" name="apc_zend.h" role="src" />
   <file md5sum="0c84d4eff92d6fd5f0a8f75007b3e608" name="apc_signal.c" role="src" />
   <file md5sum="001eaa1cc5b7d60f7430150ad9267733" name="apc_signal.h" role="src" />
   <file md5sum="5cbb4715b9f084133ecfe85d09f2b1f5" name="apc_iterator.c" role="src" />
   <file md5sum="95f12ee9869c1c1908dabeba3e113ebf" name="apc_iterator.h" role="src" />
   <file md5sum="e05f065d0d53da1bc44559263b0697bc" name="apc_pool.c" role="src" />
   <file md5sum="e412e21afe7e3178afdae3b7bcfdd866" name="apc_pool.h" role="src" />
   <file md5sum="e493fedd312ad7133e2e3b03bbf8521f" name="config.m4" role="src" />
   <file md5sum="115c8c1f6f3df61087e7477004dfffcd" name="config.w32" role="src" />
   <file md5sum="01de6e34c6840726b7e78fdef7e71fb5" name="php_apc.c" role="src" />
   <file md5sum="28059ab3cea1e84afab40d7fa66f6d83" name="php_apc.h" role="src" />
   <file md5sum="b45f27dcf4858683000a6059eef4890e" name="pgsql_s_lock.c" role="src" />
   <file md5sum="60e3c5ef4f051d48d52c13760af9b8a7" name="pgsql_s_lock.h" role="src" />
   <file md5sum="eba8123157da4d7cd334e31d405dba2c" name="apc_fcntl_win32.c" role="src" />
   <file md5sum="b48b9e243638d12cb529c1d3a6f2f7ba" name="apc_rfc1867.c" role="src" />
   <file md5sum="5584690bea9f880f206c2fee311c36bd" name="apc.php" role="php" />
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.1.0</min>
   </php>
   <pearinstaller>
    <min>1.4.0</min>
   </pearinstaller>
  </required>
 </dependencies>
 <providesextension>apc</providesextension>
 <extsrcrelease>
  <configureoption default="no" name="enable-apc-filehits" prompt="Enable per request file info about files used from the APC cache" />
  <configureoption default="no" name="enable-spinlocks" prompt="Enable spin locks (EXPERIMENTAL)" />
 </extsrcrelease>
 <changelog>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>2.0.0</release>
    <api>2.0.0</api>
   </version>
   <date>2003-07-01</date>
   <notes>Complete rework.</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>2.0.1</release>
    <api>2.0.0</api>
   </version>
   <date>2003-07-01</date>
   <notes>Win32 support added.</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>2.0.2</release>
    <api>2.0.0</api>
   </version>
   <date>2004-03-12</date>
   <notes>Fixed non-existant class bug.</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.0</release>
    <api>3.0.0</api>
   </version>
   <date>2005-07-05</date>
   <notes>PHP-5.1 Support and numerous fixes</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.1</release>
    <api>3.0.0</api>
   </version>
   <date>2005-07-05</date>
   <notes>PHP4 build fix</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.2</release>
    <api>3.0.0</api>
   </version>
   <date>2005-07-05</date>
   <notes>Default to mmap and add a better error message for shmget failures</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.3</release>
    <api>3.0.0</api>
   </version>
   <date>2005-07-07</date>
   <notes>Fix compile problem against PHP 5.0.x</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.4</release>
    <api>3.0.0</api>
   </version>
   <date>2005-07-18</date>
   <notes>Add win32 support from Edin.
Add --with-apxs switch to work around problem when loading APC into Apache binary compiled with LFS switches
A couple of other minor fixes.</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.5</release>
    <api>3.0.0</api>
   </version>
   <date>2005-07-27</date>
   <notes>Make it easier for sapis that only populate file_handle-&gt;filename to use APC. (Rasmus)
Support extensions such as bcompiler that need to hook into compile_file. (Val)
Ralf Becker&apos;s apcgui code has now become the default apc.php status page. (Ralf, Rasmus, Ilia)
Segfault in cache cleanup code (Ilia, Rasmus)</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.6</release>
    <api>3.0.0</api>
   </version>
   <date>2005-07-30</date>
   <notes>Added apc.php to package.xml file.
Track per-entry memory usage. (Val)
Various apc.php fixes and enhancements. (Ralf, Ilia, Rasmus)
fcntl locking robustness fixes. (Rasmus)
Shared read-locks where possible. (Rasmus)
Added file_update_protection configuration parameter. (Rasmus)
Windows ZTS fixes (Frank)</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.7</release>
    <api>3.0.0</api>
   </version>
   <date>2005-08-16</date>
   <notes>Fix to apc.php to show final segment in frag chart. (Ilia)
A couple of win32 fixes. (Frank)
Add apc.enable_cli ini directive. (Rasmus)
Add test cases. (Marcus)
Fix apc_define_constants() bug - http://pecl.php.net/bugs/5084 (Rasmus)
Simplify user cache handling by removing the user_cache_stack (Rasmus)
Fix apc_fetch() memory corruption (Andrei,Rasmus)
Added apc.max_file_size INI setting that allows exclusion of large files from being cached. Default file size limit, 1 megabyte. (Ilia)</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.8</release>
    <api>3.0.0</api>
   </version>
   <date>2005-08-24</date>
   <notes>Fix invalid free in globals destructor introduced in 3.0.7 (Rasmus)
Cache corruption fix in cache-full cleanup code (Gopal)</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.9</release>
    <api>3.0.0</api>
   </version>
   <date>2006-03-04</date>
   <notes>Eliminate rand() call when slam_defense is not set (Rasmus)
Fix for __isset problem (Gopal)
Rewrite allocator from a &quot;best fit&quot; to a &quot;next fit&quot; algorithm (Rasmus)
Added a Cache Full counter so we have an idea how many times the segment has filled up causing an expunge (Rasmus)
Report back the correct number of available bytes in the segment instead of the allocated bytes. (Rasmus)
Add cache busy flag which is set when an expunge is underway (Rasmus)
Add automatic serialization of objects in apc_store() (Marcus)
64-bit .ini flag fix (Rasmus)
Static members fix (Gopal)
sma_cleanup() mem leak fix (Rasmus)
Fix for http://pecl.php.net/bugs/5311 (Rasmus)
Fix autoglobals JIT bug (Gopal)
Fix instance bug (Gopal)
Add a lock cleanup safety net to request shutdown (Rasmus)
Fix apc.slam_defense edge-case bug (Rasmus)
User entry memory usage tracking support (Ilia)
Allow keys used in apc_store/apc_fetch/apc_delete to be binary safe and prevent conflicts between keys that are found at the start of other keys. (Ilia)</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.10</release>
    <api>3.0.0</api>
   </version>
   <date>2006-03-11</date>
   <notes>* Add apc.stat ini flag which defaults to 1.  If set to 0, the main script and any fullpath
  includes will not be stat&apos;ed for any changes.  You will have to restart the server if you
  change anything.  This mode increases performance quite a bit, especially if you have a
  lot of includes.

* Get rid of the lock safety net hack I added in 3.0.9.  It seems to cause more problems
  than it solves.  I&apos;ll need to revisit locking and signal handling at some point soon.</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.11</release>
    <api>3.0.0</api>
   </version>
   <date>2006-08-16</date>
   <notes>* Made --enable-apc-mmap the default compile option (for real this time)

* Add an optional flag to apc_cache_info() and some apc.php tweaks to make it
  only fetch header information to make it useful when you have tens of
  thousands of entries.  (Brian Shire)

* 64-bit fixes (George)

* Don&apos;t mix Full Path and Inode keys (George)

* Override ZEND_INCLUDE_OR_EVAL opcode (when possible) to speed up use of
  require_once() and include_once() statements. (Sara)

* Add a non-blocking write_lock for cache inserts.  This is a better approach
  to prevent cache slams and deprecates the slam_defense setting. (Rasmus)

* A bit of work on the optimizer.  (Sara)

* Various memory issues resolved. (Gopal)</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.12</release>
    <api>3.0.0</api>
   </version>
   <date>2006-09-04</date>
   <notes>* Fix stray debug message

* Work on the optimizer - still not stable (Gopal, Ilia, Sara)

* Performance boost - Replace multiple loops over the opcode
  array with a single loop for copying, jump fixups and auto
  global pre-fetches. (Gopal)

* Perform fetch_global checks only in php5 and only if 
  auto_globals_jit is enabled. (Gopal)

* Fix bug #8579 - scrub php4 classes&apos; function_table and default
  properties before inserting into cache. (Gopal)

* Fix bug #8606 - ZEND_FETCH_GLOBAL is not an opcode, but is a 
  op1-&gt;type.  The opcodes applicable are ZEND_FETCH_R and 
  ZEND_FETCH_W. (Gopal)

* PHP 5.2 Compatibility (Gopal)

* Make the include_once override optional - default off (Sara)

* Fixed crash when apc run in CLI, but enable_cli is off. (Ilia)

* Ensure that the apc_globals-&gt;cache_stack is cleared before the 
  shm cache is destroyed. Fixes segfault for corner-case i.e request
  shutdown (apc_deactivate) is not called before module shutdown 
  calls (php_apc_shutdown_globals)  (Gopal)

* TSRM fixes (ensure ts_free_id before apc.so is dlclosed) (Gopal)

* Fix memory leak of apc_cache_info_t-&gt;deleted_list (Gopal)</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.12p1</release>
    <api>3.0.0</api>
   </version>
   <date>2006-09-05</date>
   <notes>* The only change here is a trivial PHP 4 build fix.</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.12p2</release>
    <api>3.0.0</api>
   </version>
   <date>2006-09-05</date>
   <notes>* Let&apos;s get the version number right.  3.0.12p2 now.</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.13</release>
    <api>3.0.0</api>
   </version>
   <date>2007-02-24</date>
   <notes>* PHP 5.2 file upload progress tracking support (Rasmus)
* Pthread mutex and spin locks (Shire)
* Recursive zval support for apc_fetch/_store (Shire, Gopal)
* apc.stat_ctime flag for ctime checks (Rasmus)
* Multiple key fetches with apc_fetch (Shire)
* Canary checks for shm memory deallocation (Gopal)
* Add hooks for external optimizer (Shire)
* Obsolete and remove apc optimizer (Gopal)
* APC info changes - cache insert rate, hit and miss rates (Shire)
* Fix apc_load_constants (Gopal)
* Rewrite dump opcode code to use vld (Gopal)
* Use apc_[ewn]print functions for error reporting (Shire) 
* Auto global fixes and refactoring (Gopal, Shire)
* Fix memory leaks in object serialization (Ilia)
* Memory cleanup code for destructor order (Gopal)
* Win32 build fixes (Ilia, Wez)
* ZTS and Php 4 build fixes (Bjori)
* Add apc_add() function (Rasmus)
* Add optional limited flag to apc_sma_info() (Rasmus)</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.14</release>
    <api>3.0.0</api>
   </version>
   <date>2007-04-02</date>
   <notes>* Build fix (Shire)
* Don&apos;t hook the upload hook if APC is disabled (Rasmus)
* Local shadow cache support (Gopal)
* Avoid uneccessary loops over op_arrays for &quot;known&quot; auto-globals (Gopal)
* Fix apc_add() to overwrite timed out user entries (Rasmus)
* Fix double inclusion of files with conditional classes in php4 (Gopal)
* Allocator fixes to reduce fragmentation (Gopal)</notes>
  </release>
  <release>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <version>
    <release>3.0.15</release>
    <api>3.0.0</api>
   </version>
   <date>2007-10-18</date>
   <notes>* Eliminate a per-request time() syscall (Rasmus)
* Added rfc1867 prefix, name, and freq ini options (Shire)
* Allow deletion of individual user cache entries via apc.php (Sara)
* Fix overzealous cleanup during RSHUTDOWN (Gopal)
* Fix memory alignment and locking issues (Gopal)
* Make apc_compile insert/replace entries (Shire)
* Make mixed inheritance recompile &amp; cache afresh  (Gopal)
* Make nostat mode search include_path for canonicalization (Gopal)
* ZTS &amp; other compile fixes (Gopal, Edin, Shire)</notes>
  </release>
  <release>
   <version>
    <release>3.0.16</release>
    <api>3.0.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <date>2008-03-26</date>
   <notes>* Fix for longstanding cache-full crash (Christian Seiler)
  http://news.php.net/php.pecl.dev/4951 for the details
* Added optional shm unmap on a fatal signal feature (Lucas Nealan)
* Added PTHREAD_MUTEX_ADAPTIVE_NP option pthread locks (Paul Saab)
* Minor cleanups (Lucas Nealan)
* Added configure option to enable apc_cache_info(&apos;filehits&apos;) (Shire)</notes>
  </release>
  <release>
   <version>
    <release>3.0.17</release>
    <api>3.0.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <date>2008-03-29</date>
   <notes>* Crash fixes
* Fix apc_add() cache expunge bug (Rasmus)
* Added parameter to apc_fetch to determine success/failure when fetching booleans (shire)
* Fix misc. memleaks (shire)</notes>
  </release>
  <release>
   <version>
    <release>3.0.18</release>
    <api>3.0.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <date>2008-03-29</date>
   <notes>- Revert apc_expunge_cb bug-fix
- Misc memleaks</notes>
  </release>
  <release>
   <version>
    <release>3.0.19</release>
    <api>3.0.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <date>2008-05-15</date>
   <notes>- Safe-mode and fast-cgi fixes
- Fix double-free of builtin_functions
- php 5.3 fixes</notes>
  </release>
  <release>
   <version>
    <release>3.1.1</release>
    <api>3.1.0</api>
   </version>
   <stability>
    <release>beta</release>
    <api>beta</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <date>2008-12-12</date>
   <notes>- PHP4 compatibilty break
- apc_pool allocator (Gopal) 
- doubly-linked sma allocator (Shire)
- php 5.3 gc compatibility (Gopal)
- APCIterator for easy access (Shire)
- apc_delete_file (Shire)
- apc_inc/apc_dec/apc_cas functions (Shire)
- apc.canonicalize (Gopal)
- apc.preload_path (Gopal)
- apc.rfc1867_ttl  (Shire)
- apc.file_md5     (Shire)
- consolidate locking macros (Shire)
- remove futex/TSRM locks  (Shire)
- non-blocking semaphore locks  (Shire)
- zval* object rework (Gopal)</notes>
  </release>
 </changelog>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<package packagerversion="1.7.1" version="2.0" xmlns="http://pear.php.net/dtd/package-2.0" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0 http://pear.php.net/dtd/tasks-1.0.xsd http://pear.php.net/dtd/package-2.0 http://pear.php.net/dtd/package-2.0.xsd">
 <name>Auth</name>
 <channel>pear.php.net</channel>
 <summary>Creating an authentication system.</summary>
 <description>The PEAR::Auth package provides methods for creating an authentication
system using PHP.

Currently it supports the following storage containers to read/write
the login data:

* All databases supported by the PEAR database layer
* All databases supported by the MDB database layer
* All databases supported by the MDB2 database layer
* Plaintext files
* LDAP servers
* POP3 servers
* IMAP servers
* vpopmail accounts (Using either PECL vpopmail or PEAR Net_Vpopmaild)
* RADIUS
* SAMBA password files
* SOAP (Using either PEAR SOAP package or PHP5 SOAP extension)
* PEAR website
* Kerberos V servers
* SAP servers</description>
 <lead>
  <name>Martin Jansen</name>
  <user>MJ</user>
  <email>mj@php.net</email>
  <active>no</active>
 </lead>
 <lead>
  <name>Yavor Shahpasov</name>
  <user>yavo</user>
  <email>yavo@siava.org</email>
  <active>no</active>
 </lead>
 <lead>
  <name>Adam Ashley</name>
  <user>aashley</user>
  <email>php@adamashley.name</email>
  <active>yes</active>
 </lead>
 <developer>
  <name>James E. Flemer</name>
  <user>jflemer</user>
  <email>jflemer@acm.jhu.edu</email>
  <active>no</active>
 </developer>
 <developer>
  <name>Adam Harvey</name>
  <user>aharvey</user>
  <email>aharvey@php.net</email>
  <active>yes</active>
 </developer>
 <date>2008-04-04</date>
 <time>15:57:23</time>
 <version>
  <release>1.6.1</release>
  <api>1.5.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>stable</api>
 </stability>
 <license uri="http://www.php.net/license">PHP License</license>
 <notes>* Actually included the new NetVPOPMaild container file.
	  *mutter*grumble*stupid package.xml*grumble*mutter*
* Fix Bug #13578: Parse errors in DB Containers</notes>
 <contents>
  <dir name="/">
   <file baseinstalldir="" md5sum="7ddc0ffcb8b92481e3167da27f3e2996" name="Auth/Anonymous.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="" md5sum="3db4bed05ee42a45064360c185babcfc" name="Auth/Auth.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="" md5sum="4cd779a507fd8a196f5c40fdc8ac2321" name="Auth/Controller.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="425ad2bfe23c78222e067260bba148c9" name="Container/Array.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="f65dbd589c96909e015adbb5e84c816b" name="Container/DB.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="c4d18739394aa954b957a3c3b217a6be" name="Container/DBLite.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="ec960928f512703c94b3a5a443699431" name="Container/File.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="71c4887d6077628a0c8ab2ae23b1dd2b" name="Container/IMAP.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="71928f157342e34eaa8a873ed389a502" name="Container/KADM5.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="51ce4915d7f0b740539703260388f8e7" name="Container/LDAP.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="36c94238dbf7fb795ed454e04667c47b" name="Container/MDB.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="201ce32581bb1b4071ed8aa5cdf7599b" name="Container/MDB2.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="75d308e264d4cbc2060b5600762d37ff" name="Container/Multiple.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="e926c315a6e8d8e9b6a199f16b423bcd" name="Container/PEAR.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="42aa53e04e98ccd3595e102d5ab375c1" name="Container/POP3.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="b1335e1986b737436445295cf5f32a4a" name="Container/RADIUS.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="4728846b74290332eceee0502b17a055" name="Container/SAP.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="22b8425b8dee653e415498815eca3986" name="Container/SMBPasswd.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="850962e77d4d2b07eca687a685200c78" name="Container/SOAP.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="70c6c480ea673bc1e06aed12c312f869" name="Container/SOAP5.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="d3278589849381774ab0057daae4404c" name="Container/vpopmail.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="a14679c2f26af6708b3de87320c92ccd" name="Container/NetVPOPMaild.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="970cb92d4da66781cfd2aca6d171f3ff" name="Frontend/Html.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="6d03025f455869185b57b5c138fd1c01" name="Frontend/md5.js" role="php" />
   <file baseinstalldir="Auth" md5sum="b60c8b083eb08119d88089db53ee2ede" name="tests/auth_container_db_options.php" role="test" />
   <file baseinstalldir="Auth" md5sum="907193304f6f6d0a03321a344d81a8a8" name="tests/auth_container_file_options.php" role="test" />
   <file baseinstalldir="Auth" md5sum="2070e2661d33de660a39837ecdec8ca7" name="tests/auth_container_mdb2_options.php" role="test" />
   <file baseinstalldir="Auth" md5sum="2070e2661d33de660a39837ecdec8ca7" name="tests/auth_container_mdb_options.php" role="test" />
   <file baseinstalldir="Auth" md5sum="7e41dc017dbc7f9c3841f205736cf2ab" name="tests/auth_container_pop3a_options.php" role="test" />
   <file baseinstalldir="Auth" md5sum="f2884c6ddc8f0405364aad909105f0d5" name="tests/auth_container_pop3_options.php" role="test" />
   <file baseinstalldir="Auth" md5sum="4bc05df7b07e19894d09f091e09a374d" name="tests/DBContainer.php" role="test" />
   <file baseinstalldir="Auth" md5sum="86f699d5ac6ca6ea13286e073e95be3e" name="tests/FileContainer.php" role="test" />
   <file baseinstalldir="Auth" md5sum="cce1cc136b4b2e7a01d84486b0490336" name="tests/MDB2Container.php" role="test" />
   <file baseinstalldir="Auth" md5sum="42fafd76f8ffc6bab8b3fe852e1aa7aa" name="tests/MDBContainer.php" role="test" />
   <file baseinstalldir="Auth" md5sum="c0ea6513ca30793404fa300c1f82995e" name="tests/mysql_test_db.sql" role="test" />
   <file baseinstalldir="Auth" md5sum="86d9d9def200d6a967af5aa08badae17" name="tests/POP3aContainer.php" role="test" />
   <file baseinstalldir="Auth" md5sum="e5f33effb6e18ec52e2aad46f2cf9dc7" name="tests/POP3Container.php" role="test" />
   <file baseinstalldir="Auth" md5sum="133ab03f3bafa896cd827f059eb8f20b" name="tests/TestAuthContainer.php" role="test" />
   <file baseinstalldir="Auth" md5sum="db9782123c381f0d638ed9ace4f6d42d" name="tests/tests.php" role="test" />
   <file baseinstalldir="Auth" md5sum="81051bcc2cf1bedf378224b0a93e2877" name="tests/users" role="test" />
   <file baseinstalldir="Auth" md5sum="3796a67d8c5d3f281ceb414638f60cfa" name="tests/bug8735.passwd" role="test" />
   <file baseinstalldir="Auth" md5sum="7a5ca7c595123a06d18543b803355158" name="tests/bug8735.phpt" role="test" />
   <file baseinstalldir="Auth" md5sum="797b51ba0f58858ab014771aa1b26fd6" name="examples/logging.php" role="doc" />
   <file baseinstalldir="Auth" md5sum="c0234bbeeb10e24cdb6f64272e5e9831" name="examples/multi-container.php" role="doc" />
   <file baseinstalldir="" md5sum="289fa024b2d1eda68b7b1b0c9f877493" name="Auth.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="b1dc665b8f34b2c0743b8065f0afedbf" name="Container.php" role="php">
    <tasks:replace from="@package_version@" to="version" type="package-info" />
   </file>
   <file baseinstalldir="Auth" md5sum="f5632fbe6d758b2da9af3f54485d0398" name="README.Auth" role="doc" />
   <file baseinstalldir="Auth" md5sum="14012d9f7ed31ca900dc177cc37df9b5" name="README.AdvancedSecurity" role="doc" />
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>4.3.3</min>
   </php>
   <pearinstaller>
    <min>1.4.0b1</min>
   </pearinstaller>
  </required>
  <optional>
   <package>
    <name>Log</name>
    <channel>pear.php.net</channel>
    <min>1.9.10</min>
   </package>
   <package>
    <name>File_Passwd</name>
    <channel>pear.php.net</channel>
    <min>1.1.0</min>
   </package>
   <package>
    <name>Net_POP3</name>
    <channel>pear.php.net</channel>
    <min>1.3.0</min>
   </package>
   <package>
    <name>DB</name>
    <channel>pear.php.net</channel>
    <min>1.6.0</min>
   </package>
   <package>
    <name>MDB</name>
    <channel>pear.php.net</channel>
   </package>
   <package>
    <name>MDB2</name>
    <channel>pear.php.net</channel>
    <min>2.0.0RC1</min>
   </package>
   <package>
    <name>Auth_RADIUS</name>
    <channel>pear.php.net</channel>
   </package>
   <package>
    <name>Crypt_CHAP</name>
    <channel>pear.php.net</channel>
    <min>1.0.0</min>
   </package>
   <package>
    <name>File_SMBPasswd</name>
    <channel>pear.php.net</channel>
    <min>1.0.0</min>
   </package>
   <package>
    <name>HTTP_Client</name>
    <channel>pear.php.net</channel>
    <min>1.1.0</min>
   </package>
   <package>
    <name>SOAP</name>
    <channel>pear.php.net</channel>
    <min>0.9.0</min>
   </package>
   <package>
    <name>Net_Vpopmaild</name>
    <channel>pear.php.net</channel>
    <min>0.1.0</min>
   </package>
   <package>
    <name>vpopmail</name>
    <channel>pecl.php.net</channel>
    <min>0.2</min>
    <providesextension>vpopmail</providesextension>
   </package>
   <package>
    <name>kadm5</name>
    <channel>pecl.php.net</channel>
    <min>0.2.3</min>
    <providesextension>kadm5</providesextension>
   </package>
   <extension>
    <name>imap</name>
   </extension>
   <extension>
    <name>saprfc</name>
   </extension>
   <extension>
    <name>soap</name>
   </extension>
  </optional>
 </dependencies>
 <phprelease />
 <changelog>
  <release>
   <date>2008-04-04</date>
   <time>10:35:00</time>
   <version>
    <release>1.6.0</release>
    <api>1.5.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fixed Bug #12112: Advanced Security Cookie has different settings to
  session cookie.
* Implemented Request #13337: New vpopmail container utilising Net_Vpopmaild.
  Patch supplied by Bill Shupp (shupp)
* Implemented Request #13418: Karma support for PEAR Container. Patch supplied
  by Christian Weiske (cweiske).
* Added correct debug message for when no login has occured instead of session
  storage not found.
* Implemented Request #12061: Auto Quote handle database schema changes. ie
  schema.tableName -&gt; &quot;schema&quot;.&quot;tableName&quot;
* Implemented Request #12087: Ability to select which Advanced Security options
  are used.
* Fixed Doc Bug #12156: Correction to doc page for Auth::setSessionName() by
  Adam Harvey (aharvey)</notes>
  </release>
  <release>
   <date>2007-07-02</date>
   <time>10:35:00</time>
   <version>
    <release>1.5.4</release>
    <api>1.5.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fixed Bug #11499: Redundant parameter in Auth_Container_SOAP5::_validateOptions()
  definition. Thanks to Koles Mihaly for spotting this.</notes>
  </release>
  <release>
   <date>2007-07-02</date>
   <time>10:35:00</time>
   <version>
    <release>1.5.3</release>
    <api>1.5.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fixed Bug: If Auth::setSessionName() is called new session name variable is
  not initialised so checks for session storage fail.
* Fixed Bug #11396: Auth_Container_Pear doesn&apos;t work with latest changes to
  pear.php.net. Fix by Adam Harvey.
* Fixed Bug #11476: SOAP5 container&apos;s _validateOptions() and _setDefaults()
  functions where setting options into the wrong object parameter. Thanks to
  K√∂les Mih√°ly for fix.</notes>
  </release>
  <release>
   <date>2007-06-12</date>
   <time>10:35:00</time>
   <version>
    <release>1.5.2</release>
    <api>1.5.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Feature Request #10729: Optionally regenerate session id on every page request.
  Thanks to Bernhard for patch.
* Fixed Bug #10785: Notice when Auth::logout() called with a login callback
  defined but no user logged in. Suggested fix thanks to Sascha Grossenbacher.</notes>
  </release>
  <release>
   <date>2007-03-23</date>
   <time>10:35:00</time>
   <version>
    <release>1.5.1</release>
    <api>1.5.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Added missing optional dependancy on PEAR Log to package.xml
* Fixed Bug #10125: Auth_Container_LDAP::fetchData only fetching attributes for
  first entry.</notes>
  </release>
  <release>
   <date>2007-02-13</date>
   <time>10:35:00</time>
   <version>
    <release>1.5.0</release>
    <api>1.5.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Completed Request #2229: Ability to attach fall through containers. This
  is implemented through the use of a new container Auth_Container_Multiple.
  See multi-container.php in examples directory.
* Completed Request #4126: Enhancements to Advanced Security Mode. Thanks
  to makler at man dot torun dot pl.
* Completed Request #6949: Use Log package for debugging messages. See logging.php
  in examples directory.
* Completed Request #7089: Add optional extra WHERE options to DB and MDB(2) 
  containers.
* Fixed Bug #9944: Logging constants not defined when logging disabled.
* Fixed Bug #10000: Stupid developer didn&apos;t stop to look what he was doing
  and broke things.
* Fixed Bug #10004: Logging of connection failures in LDAP container missing.</notes>
  </release>
  <release>
   <date>2007-02-02</date>
   <time>07:00:00</time>
   <version>
    <release>1.5.0RC2</release>
    <api>1.5.0</api>
   </version>
   <stability>
    <release>beta</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fixed Bug #9944: Logging constants not defined when logging disabled.
* Fixed Bug #10000: Stupid developer didn&apos;t stop to look what he was doing
  and broke things.
* Fixed Bug #10004: Logging of connection failures in LDAP container missing.</notes>
  </release>
  <release>
   <date>2007-01-17</date>
   <time>07:00:00</time>
   <version>
    <release>1.5.0RC1</release>
    <api>1.5.0</api>
   </version>
   <stability>
    <release>beta</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Completed Request #2229: Ability to attach fall through containers. This
  is implemented through the use of a new container Auth_Container_Multiple.
  See multi-container.php in examples directory.
* Completed Request #4126: Enhancements to Advanced Security Mode. Thanks
  to makler at man dot torun dot pl.
* Completed Request #6949: Use Log package for debugging messages. See logging.php
  in examples directory.
* Completed Request #7089: Add optional extra WHERE options to DB and MDB(2) 
  containers.
* Add ability to pass an instanciated DB, MDB or MDB2 database connection to each
  of the respective Auth Containers.</notes>
  </release>
  <release>
   <date>2006-12-06</date>
   <time>07:00:00</time>
   <version>
    <release>1.4.3</release>
    <api>1.4.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fixed Bug #9380: Default Auth_Container_POP3 configuration not 
  working.
* Fixed Bug #9407: Add callback in checkAuth() process.
* Fixed Bug #9479: Typo in Auth_Container_KADM5::_checkServer causes
  failure. Thanks to Matt T. Proud (khanreaper at nerp dot net).</notes>
  </release>
  <release>
   <date>2006-11-10</date>
   <time>07:00:00</time>
   <version>
    <release>1.4.2</release>
    <api>1.4.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fixed Bug #9241: Callback functions where being passed a copy of
  the login object instead of a reference to it under PHP4.
* Fixed Bug #9286: Comparison of passwords and their hashes could give
  false positive.</notes>
  </release>
  <release>
   <date>2006-10-28</date>
   <time>07:00:00</time>
   <version>
    <release>1.4.1</release>
    <api>1.4.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Forgot to add Auth/Container/Array.php to package2.xml.</notes>
  </release>
  <release>
   <date>2006-10-20</date>
   <time>10:00:00</time>
   <version>
    <release>1.4.0</release>
    <api>1.4.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Added new SOAP container that makes use of the PHP5 SOAP Client. Thanks to
  Marcel Oelke &lt;puRe at rednoize dot com&gt;. Fixes #2612.
* Added support for trying all the user accounts returned from an LDAP server
  not just the first one so as to support authenticating against Lotus Notes
  which allows identical usernames where the only difference is the password.
  Fixes #5365.
* Added new Array container for simple authentication setups where it&apos;s easier
  to list users in the file than setup some sort of backend. Thanks to 
  georg_1 at have2 dot com. Fixes #5832.
* Added KADM5 container that makes use of the PECL kadm5 extension to 
  authenticate against Kerberos 5 servers. Thanks to Andrew Teixeira 
  &lt;ateixeira at gmail dot com&gt;. Fixes #6671.
* Fixed #8597. Remove references to $GLOBALS[&apos;HTTP_*_VARS&apos;] now that we require
  PHP 4.3.3+ for other reasons.
* Added SAP container that makes use of the SAPRFC extension available from
  http://saprfc.sourceforge.net/. Thanks to Stoyan Stefanov &lt;ssttoo at gmail dot com&gt;.
  Fixes #8637.
* Fix #8599. Allow identifier quoting in DB, DBLite, MDB and MDB2 backends to 
  be switched off by developer.
* Fix Bug #8732: Auth_Container_DB having problems with SQLite databases.
  SQLite returns the name of quoted field names including the quotes instead
  of stripping the quotes like all other DBs.
* Fix Bug #8735: Auth_Container_File::addUser() working on different instances
  of File_Passwrd object.</notes>
  </release>
  <release>
   <date>2006-09-21</date>
   <time>10:00:00</time>
   <version>
    <release>1.4.0RC3</release>
    <api>1.4.0</api>
   </version>
   <stability>
    <release>beta</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fix Bug #8732: Auth_Container_DB having problems with SQLite databases.
  SQLite returns the name of quoted field names including the quotes instead
  of stripping the quotes like all other DBs.
* Fix Bug #8735: Auth_Container_File::addUser() working on different instances
  of File_Passwrd object.</notes>
  </release>
  <release>
   <date>2006-09-11</date>
   <time>03:30:33</time>
   <version>
    <release>1.4.0RC1</release>
    <api>1.4.0</api>
   </version>
   <stability>
    <release>beta</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Added new SOAP container that makes use of the PHP5 SOAP Client. Thanks to
  Marcel Oelke &lt;puRe at rednoize dot com&gt;. Fixes #2612.
* Added support for trying all the user accounts returned from an LDAP server
  not just the first one so as to support authenticating against Lotus Notes
  which allows identical usernames where the only difference is the password.
  Fixes #5365.
* Added new Array container for simple authentication setups where it&apos;s easier
  to list users in the file than setup some sort of backend. Thanks to 
  georg_1 at have2 dot com. Fixes #5832.
* Added KADM5 container that makes use of the PECL kadm5 extension to 
  authenticate against Kerberos 5 servers. Thanks to Andrew Teixeira 
  &lt;ateixeira at gmail dot com&gt;. Fixes #6671.
* Fixed #8597. Remove references to $GLOBALS[&apos;HTTP_*_VARS&apos;] now that we require
  PHP 4.3.3+ for other reasons.
* Added SAP container that makes use of the SAPRFC extension available from
  http://saprfc.sourceforge.net/. Thanks to Stoyan Stefanov &lt;ssttoo at gmail dot com&gt;.
  Fixes #8637.
* Fix #8599. Allow identifier quoting in DB, DBLite, MDB and MDB2 backends to 
  be switched off by developer.</notes>
  </release>
  <release>
   <version>
    <release>1.3.2</release>
    <api>1.3.2</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2006-08-31</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fixed Bug #8524: Notice from attempting to perform string operation on what
  might be an array in DB, DBLite, MDB and MDB2. Thanks to dozoyousan at gmail
  dot com.
* Remove debug message from RADIUS Container when using CHAP_MD5 or MSCHAPv1
  style passwords. Thanks to Stoyan Stefanov &lt;ssttoo at gmail dot com&gt; for
  pointing out this 3yr old bug.</notes>
  </release>
  <release>
   <version>
    <release>1.3.1</release>
    <api>1.3.1</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2006-08-21</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fixed Bug #7031: session_regenerate_id() not cleaning up old session storage.
  Fix for this bug in PHP5.1.0+ has been done, still a problem in older versions
  of PHP.
* Fixed Bug #7421: Allow false to be passed in for allowLogin and advancedSecurity
  options.
* Fixed Bug #7434: Enable start_tls support for LDAP Container by Stuart Prescott
  &lt;php.net@nanonanonano.net&gt;
* Fixed Bug #7537: Made File Container capable of using all File_Passwd backends.
* Fixed Bug #7841: Added missing &lt;/center&gt;. Really the whole frontend needs
  reworking.
* Fixed Bug #7860: Removed deprecated session_register call.
* Fixed Bug #7899: sessionValidThru() returning incorrect value when no idle
  timeout set.
* Fixed Bug #7956: Session handling had several security bugs before PHP4.3.3.
  Bumped PHP dependancy so we don&apos;t have to deal with them.
* Fixed Bug #8076: MDB &amp; MDB2 Containers not using default db_fields values
* Fixed Bug #8351: Documentation of $loginFailedCallback pointed to incorrect
  set function.
* Fixed Bug #8406: Error message updates by Adam Harvey &lt;pear@adamharvey.name&gt;
* Fixed Bug #8407: Database containers don&apos;t quote table/field names by Adam
  Harvey &lt;pear@adamharvey.name&gt;</notes>
  </release>
  <release>
   <version>
    <release>1.3.1RC1</release>
    <api>1.3.1RC1</api>
   </version>
   <stability>
    <release>beta</release>
    <api>beta</api>
   </stability>
   <date>2006-08-11</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>This release candidate is test the numerous fixes described below. It is also
to get feedback on the change made for Bug #8407. Bug #8407 adds automatic 
quoting of table and field names used in SQL in the Database backends.

 * Fixed Bug #7031: session_regenerate_id() not cleaning up old session storage.
   Fix for this bug in PHP5.1.0+ has been done, still a problem in older versions
   of PHP.
 * Fixed Bug #7421: Allow false to be passed in for allowLogin and advancedSecurity
   options.
 * Fixed Bug #7434: Enable start_tls support for LDAP Container by Stuart Prescott
   &lt;php.net@nanonanonano.net&gt;
 * Fixed Bug #7537: Made File Container capable of using all File_Passwd backends.
 * Fixed Bug #7841: Added missing &lt;/center&gt;. Really the whole frontend needs
   reworking.
 * Fixed Bug #7860: Removed deprecated session_register call.
 * Fixed Bug #7899: sessionValidThru() returning incorrect value when no idle
   timeout set.
 * Fixed Bug #7956: Session handling had several security bugs before PHP4.3.3.
   Bumped PHP dependancy so we don&apos;t have to deal with them.
 * Fixed Bug #8076: MDB &amp; MDB2 Containers not using default db_fields values
 * Fixed Bug #8351: Documentation of $loginFailedCallback pointed to incorrect
   set function.
 * Fixed Bug #8406: Error message updates by Adam Harvey &lt;pear@adamharvey.name&gt;
 * Fixed Bug #8407: Database containers don&apos;t quote table/field names by Adam
   Harvey &lt;pear@adamharvey.name&gt;</notes>
  </release>
  <release>
   <version>
    <release>1.3.0</release>
    <api>1.3.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2006-03-03</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>This is the final stable release of Auth 1.3.0. This version contains many new
features over previous versions. Summary of changes:

 * New MDB2 container [30/March/2004 - quipo]
 * New PEAR container, authenticate against pear.php.net [16/Dec/2003 - yavo]
 * New Advanced Security mode to catch man-in-the-middle attacks.
 * Added options for changing the post variables, patch supplied by Moritz 
   Heidkamp &lt;moritz.heidkamp@invision-team.de&gt;
 * New DBLite container, same as DB but with the user manipulation functions 
   removed (50% smaller).
 * Split login form to Auth_Frontend_HTML with goal to make it easily 
   customisable.

Numerous other small fixes and improvements to all storage containers thanks
to the following people: Matt Eaton, Jeroen Houben, Cipriano Groenendal,
Markku Turunen, Matthew Van Gundy, marc at practeo dot ch and I&apos;m sure many
others that have contributed over the years it&apos;s taken to get this release
out.</notes>
  </release>
  <release>
   <version>
    <release>1.3.0RC7</release>
    <api>1.3.0RC7</api>
   </version>
   <stability>
    <release>beta</release>
    <api>beta</api>
   </stability>
   <date>2006-03-01</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>This release is primarily a coding standard clean-up before the 1.3.0 final
release.

In addition the following improvements to the LDAP Container where supplied
by Hugues Peeters &lt;hugues.peeters@claroline.net&gt;.
 * Changed default attrformat to AUTH so that loaded attributes are
   presented in the same format as other backends provide.
 * Added compatibility support to 1.2 style configuration options
 * Attributes option now accepts a comma seperated string as well as
   as array the same as db_fields in the DB, MDB and MDB2 backends.

Finally there are additional checks that the relevant PHP module is loaded
when loading the IMAP and VPOPMail Containers.</notes>
  </release>
  <release>
   <version>
    <release>1.3.0RC6</release>
    <api>1.3.0RC6</api>
   </version>
   <stability>
    <release>beta</release>
    <api>beta</api>
   </stability>
   <date>2006-02-22</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes />
  </release>
  <release>
   <version>
    <release>1.3.0r5</release>
    <api>1.3.0r5</api>
   </version>
   <stability>
    <release>beta</release>
    <api>beta</api>
   </stability>
   <date>2006-02-21</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Fixed Bug #2873: Allow calling programs to gracefully handle being unable
  to connect/bind to LDAP server.
* Fixed Bug #4918: Added support to specify which authentication method to 
  prefer when authenticating against a POP3 backend.
* Fixed Bug #6644: Added support for LDAP_OPT_REFERRALS. Setting to false can 
  improve compatibility with Active Directory.
* Fixed Bug #6791: Made all calls to call_user_func() call_user_func_array and
  made calls consistant per change done in 1.3.0r3.
* Fixed Bug #6803: depreciated DB function. Now requires DB &gt;= 1.6.0
* Fixed Bug #6808: Whenever Auth_Container_DB attempts to change the database 
  make sure the connection/DB object exists and is correct before attempting to
  use the DB quoting features.</notes>
  </release>
  <release>
   <version>
    <release>1.3.0r4</release>
    <api>1.3.0r4</api>
   </version>
   <stability>
    <release>beta</release>
    <api>beta</api>
   </stability>
   <date>2006-02-14</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>This release fixes a security issue that allows an attacker to perform
injection attacks against the underlying storage containers.  Upgrading
is strongly recommended if you are using beta releases of the Auth
package.

* Improved parameter validation in the DB and LPAP containers. (Patch
  provided by Matthew Van Gundy.)
* Fixed Bug #3101: Wrong variable names in Auth/Container/File.php (mike)
* renamed supportsChallengeResponce() to supportsChallengeResponse()
  in the DB container (quipo)
* Fixed Bug #4347: recognition of DB and MDB objects passed as dsn
* Fixed Bug #6324: updated MDB2 container
* Fixed Bug #5174: &quot;Only variable references should be returned by reference&quot;
  bug in _factory()
* Fixed Bug #2446: english language typos.
  This results in a BC break for any custom containers that have implemented
  supportsChallengeResponce(). Also all containers already
  supportsChallengeResponse() instead of supportsChallengeResponce() and
  therefore the call in Auth_Frontend_Html always called the default
  implementation and not the container implementation.</notes>
  </release>
  <release>
   <version>
    <release>1.3.0r3</release>
    <api>1.3.0r3</api>
   </version>
   <stability>
    <release>beta</release>
    <api>beta</api>
   </stability>
   <date>2004-08-07</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Moved login screen generation code to Auth/Frontend/Html.php 
  In the future the frontend will be configurable.
* Implemented support for Challenge / Responce password authenthication
  have to enable advanced security $auth-&gt;setAdvancedSecurity
  will work only with DB container and cryptType = none|md5
* Implemented setAllowLogin to control which pages are allowed to perform login, 
  to preservce BC. Previusly the showLogin flag was used to control this - yavo
* Implmented lazy loading for the storage constructor, constructor is only created when needed
  to make Auth more lightweight (this might be adding a bit more overhead to login and usermanagement functions)
* Removed include of PEAR, was not used anywhare in Auth.php
* Created a new storage container DBLite same as DB but with the user manipulation functions removed (50% smaller)
* Added a new method staticCheckAuth which can be called statically with only the auth options
* Auth::importGlobalVariable method was removed and replaced by references to global variables
* Removed all calls to $session[$this-&gt;_sessionName], made local reference session point to that instead
* Changed call_user_func to call_user_func_array for the callbacks, to avoid using @ for passing variables by reference
* Code Cleanup, removed most vi comments</notes>
  </release>
  <release>
   <version>
    <release>1.3.0r1</release>
    <api>1.3.0r1</api>
   </version>
   <stability>
    <release>beta</release>
    <api>beta</api>
   </stability>
   <date>2004-06-04</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Changes to LDAP container:
  - check for loaded ldap extension at startup as suggested by Markku Turunen
  - make ldap version configurable via config array
  - documentation fix for active directory default user container
  [ 14/Jun/2004 - jw]
* Added an Auth_Controller class, to manage automatic redirection to login page and redirect back
  to the calling page [04/06/2004 - Yavo]
* Changes to LDAP container:
  - additional attribute fetching to authData via new option attributes
  - utf8 encoding username for ldapv3 (fixes german umlaut problem)
  - make scope definable for user and group searching seperately
  - remove useroc, groupoc and replace them with userfilter, groupfilter which is way more flexible
  - updated documentation on all new and changed parameters
  As some of the parameters changed this one is not backwards compatible to earlier versions.
  Look at the top of the class where all parameters are explained in detail.
  [08/April/2004 - jw]
* Added new MDB2 container  [30/March/2004 - quipo]
* Implements changePassword and CS fixed, patch from Cipriano Groenendal &lt;cipri@cipri.com&gt;
  [29/March/2004 - yavo]
* Added options for changing the post variables, patch supplied by Moritz Heidkamp &lt;moritz.heidkamp@invision-team.de&gt;
  [03/March/2004 - yavo]
* Added method setAdvancedSecurity and set advanced security to off by default, if turned on auth will perform additional
  security checks if ip or user agent has changed across requests
* Login is now performed only if showLogin is true, do not allow for logins to be performed from any page which calls auth-&gt;start
  spotted by Matt Eaton &lt;pear@divinehawk.com&gt; [16/Jan/2004 - yavo] 
* Fixed bug noted by Jeroen Houben &lt;jeroen@terena.nl&gt;, calling loginFailedCallback
  would not have the proper status set [16/Jan/2004 - yavo]
* Added PEAR container, authenticate the user against the pear web site
  (probably php.net also) [16/Dec/2003 - yavo]</notes>
  </release>
  <release>
   <version>
    <release>1.2.3</release>
    <api>1.2.3</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2003-09-08</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* new Method to auth_container getUser()
* New Auth_Container_File, using new File_Passwd class. Provided by Michael Wallner &lt;mike@php.net&gt;
* Login/Logout callbacks now get a reference to auth
* New Login Failed Callback added (method setFailedLoginCallback)
* SOAP container patch to keep a reference to the Soap responce by Bruno Pedro &lt;bpedro@co.sapo.pt&gt;
* Auth is now installed in /pear-dir/Auth.php instead of /pear-dir/Auth/Auth.php, an
  empty file /pear-dev/Auth/Auth.php wich includes Auth.php is added for BC
* The contaner now gets a reference to the auth object ($auth-&gt;storage-&gt;_auth_obj)
*Some patches from the pear-dev list bellow
    -maka3d@yahoo.com.br - Patch to use a method of the container in Auth_Container::verifyPassword
    -Lorenzo Alberton &lt;l.alberton@quipo.it&gt; - Patch to use variable session variable name, untill now the variable auth was used
    -Marcos Neves &lt;maka3d@yahoo.com.br&gt; - Avaoid error when calling getAuthData() before the login</notes>
  </release>
  <release>
   <version>
    <release>1.2.2</release>
    <api>1.2.2</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2003-07-29</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Added support for passing contaner as an object
* Added fix when db_fileds is *
* Added Test Suite (experimental)
* Added generic support for arbitrary password crypting functions
  different than MD5, DES and plain text. (Patch by Tom Anderson)
* Added new MDB storage container written by Lorenzo Alberton
* Added new Container for SAMBA password files (SMBPasswd)</notes>
  </release>
 </changelog>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<package packagerversion="1.7.2" version="2.0" xmlns="http://pear.php.net/dtd/package-2.0" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0 http://pear.php.net/dtd/tasks-1.0.xsd http://pear.php.net/dtd/package-2.0 http://pear.php.net/dtd/package-2.0.xsd">
 <name>bloomy</name>
 <channel>pecl.php.net</channel>
 <summary>Extension implementing a Bloom filter</summary>
 <description>This extension implements a Bloom filter, which is a space-efficient
  probabilistic data structure that is used to test whether an element is a
  member of a set.</description>
 <lead>
  <name>Andrei Zmievski</name>
  <user>andrei</user>
  <email>andrei@php.net</email>
  <active>yes</active>
 </lead>
 <lead>
  <name>Andrei Zmievski</name>
  <user>andrei</user>
  <email>andrei@php.net</email>
  <active>yes</active>
 </lead>
 <date>2009-03-23</date>
 <time>15:56:59</time>
 <version>
  <release>0.1.0</release>
  <api>0.1.0</api>
 </version>
 <stability>
  <release>beta</release>
  <api>beta</api>
 </stability>
 <license uri="http://www.php.net/license">PHP</license>
 <notes>- Initial PECL release</notes>
 <contents>
  <dir name="/">
   <file md5sum="7291f1b05a4608bc9223993fd2bea6c2" name="EXPERIMENTAL" role="doc" />
   <file md5sum="dccc33317a74c41b5b4617164635b970" name="README" role="doc" />
   <file md5sum="087e38d1111ef87574ef14e094b085b6" name="CREDITS" role="doc" />
   <file md5sum="56e7876babee694afcf5aa631bbe2a54" name="LICENSE" role="doc" />
   <file md5sum="e4371910e11b5a7e694ddc3ea253beb6" name="ChangeLog" role="doc" />
   <file md5sum="c2e9db1d86e7cf58d55dbbe37e08f7ea" name="config.m4" role="src" />
   <file md5sum="643911e0fb385fa5f4d45b059f8a14ad" name="config.w32" role="src" />
   <file md5sum="de9a12d2221f49ced2ebc6bef1270e7a" name="bloom.c" role="src" />
   <file md5sum="ec37945ab142f269babd8a019a4b886d" name="bloom.h" role="src" />
   <file md5sum="fe1bfa37893c82854398236475542ca1" name="lookup3.c" role="src" />
   <file md5sum="d985b6b209f5208eb7f1606eceef57aa" name="php_bloomy.h" role="src" />
   <file md5sum="e1e2a01573d8bc5b371b1cc34252ac7e" name="php_bloomy.c" role="src" />
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>5.2.0</min>
    <max>6.0.0</max>
    <exclude>6.0.0</exclude>
   </php>
   <pearinstaller>
    <min>1.4.0b1</min>
   </pearinstaller>
  </required>
 </dependencies>
 <providesextension>bloomy</providesextension>
 <extsrcrelease />
 <changelog>
  <release>
   <stability>
    <release>beta</release>
    <api>beta</api>
   </stability>
   <version>
    <release>0.1.0</release>
    <api>0.1.0</api>
   </version>
   <date>2009-03-23</date>
   <notes>- Initial PECL release</notes>
  </release>
 </changelog>
</package>
<?xml version="1.0" encoding="UTF-8"?>
<package packagerversion="1.6.0" version="2.0" xmlns="http://pear.php.net/dtd/package-2.0" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/dtd/tasks-1.0 http://pear.php.net/dtd/tasks-1.0.xsd http://pear.php.net/dtd/package-2.0 http://pear.php.net/dtd/package-2.0.xsd">
 <name>Auth_PrefManager</name>
 <channel>pear.php.net</channel>
 <summary>Preferences management class</summary>
 <description>Preference Manager is a class to handle user preferences in a web application, looking them up in a table using a combination of their userid, and the preference name to get a value, and (optionally) returning a default value for the preference if no value could be found for that user.

It is designed to be used alongside the PEAR Auth class, but can be used with anything that allows you
to obtain the user&apos;s id - including your own code.</description>
 <lead>
  <name>Adam Ashley</name>
  <user>aashley</user>
  <email>php@adamashley.name</email>
  <active>yes</active>
 </lead>
 <lead>
  <name>Jon Wood</name>
  <user>jellybob</user>
  <email>jon@jellybob.co.uk</email>
  <active>no</active>
 </lead>
 <date>2007-06-18</date>
 <time>02:50:22</time>
 <version>
  <release>1.2.0</release>
  <api>1.0.0</api>
 </version>
 <stability>
  <release>stable</release>
  <api>stable</api>
 </stability>
 <license uri="http://www.php.net/license">PHP License</license>
 <notes>* Moved DB connection out of constructor so connection is only made when
  needed and error handling can be done properly.
* Added option to return PEAR_Error objects when a problem occurs.
* General code cleanup.
* Switched to package.xml 2.0.
* Added test suite.
* Fix Bug #9469. Attempts to use DB connection even if error generated
  while connecting.</notes>
 <contents>
  <dir name="/">
   <file md5sum="3e2440341777da0d390ba1fa83308901" name="docs/PM_Example.php" role="doc" />
   <file md5sum="6794f92f346bc963b92efdb87440313f" name="tests/deleteDefaultPref/database-error-pear.phpt" role="test" />
   <file md5sum="a75eb616ebb66d09548c5b7dc9beee12" name="tests/deleteDefaultPref/database-error.phpt" role="test" />
   <file md5sum="284662e7a972de313dbaa502862f3792" name="tests/deleteDefaultPref/pref-exists-default-exists.phpt" role="test" />
   <file md5sum="05148d500963e6712cc730589fdceff2" name="tests/deleteDefaultPref/pref-exists-default-notexist.phpt" role="test" />
   <file md5sum="2134990e859d4d5a0df5d0d042e9d3f9" name="tests/deleteDefaultPref/pref-notexist-default-exist.phpt" role="test" />
   <file md5sum="dd87655574507b2f1a29b2cea778d06b" name="tests/deleteDefaultPref/pref-notexist-default-notexist.phpt" role="test" />
   <file md5sum="09fff9cbeef443f2c196241c9f7a303f" name="tests/deletePref/database-error-pear.phpt" role="test" />
   <file md5sum="cc97c0548c91810e8e1e37cbd3c1415f" name="tests/deletePref/database-error.phpt" role="test" />
   <file md5sum="8b243efebd80cb1deeb4566b02aead54" name="tests/deletePref/pref-exists-default-exists.phpt" role="test" />
   <file md5sum="46daaec1b14e5a6991105656f940e99e" name="tests/deletePref/pref-exists-default-notexist.phpt" role="test" />
   <file md5sum="b3b0df0604b266326ebc2cf68d36a303" name="tests/deletePref/pref-notexist-default-exist.phpt" role="test" />
   <file md5sum="92db79c075174eb90f3ba251d0b6fe75" name="tests/deletePref/pref-notexist-default-notexist.phpt" role="test" />
   <file md5sum="3a184adc84173c09fcfe7145ff8ebbb6" name="tests/getDefaultPref/database-error-pear.phpt" role="test" />
   <file md5sum="c65f309a525167b570f541a329fd9bfa" name="tests/getDefaultPref/database-error.phpt" role="test" />
   <file md5sum="c3de927fefc0a6a0b46e076aaca3a072" name="tests/getDefaultPref/default-exists.phpt" role="test" />
   <file md5sum="f2700cae80b5577cb07469c2b63aa269" name="tests/getDefaultPref/default-notexist.phpt" role="test" />
   <file md5sum="6c3968938909232118c152a295d0363e" name="tests/getPref/database-error-pear.phpt" role="test" />
   <file md5sum="a0c9bf6b1687fe03ca695543795f8e6b" name="tests/getPref/database-error.phpt" role="test" />
   <file md5sum="b893daadf8f7032e81bf4cd67a1f9a70" name="tests/getPref/pref-exists-default-exists.phpt" role="test" />
   <file md5sum="09f8435eb8555f518c83a370d368e084" name="tests/getPref/pref-exists-default-notexist.phpt" role="test" />
   <file md5sum="1db12df8cc97406ea17bb1318b9d6f01" name="tests/getPref/pref-notexist-default-exist.phpt" role="test" />
   <file md5sum="ca163f56ad82589102b919459f48ef8c" name="tests/getPref/pref-notexist-default-notexist.phpt" role="test" />
   <file md5sum="21187ab567c66a9b40fdebd5ea719a61" name="tests/setDefaultPref/database-error-pear.phpt" role="test" />
   <file md5sum="a90baac6a5ff4a7dbb41c9c3a21b5e3b" name="tests/setDefaultPref/database-error.phpt" role="test" />
   <file md5sum="c7261d70f3e4e25becf04d8e49086b3d" name="tests/setDefaultPref/pref-exists-default-exists.phpt" role="test" />
   <file md5sum="3c7427e81f57278835484683e87f2e57" name="tests/setDefaultPref/pref-exists-default-notexist.phpt" role="test" />
   <file md5sum="7e943c635d4b7f1bb5a4646ae3091d4e" name="tests/setDefaultPref/pref-notexist-default-exists.phpt" role="test" />
   <file md5sum="8bc6cfeb367780653cbe6362c122db61" name="tests/setDefaultPref/pref-notexist-default-notexist.phpt" role="test" />
   <file md5sum="8a9b20ffefa6b271ee846615d2c308b5" name="tests/setPref/database-error-pear.phpt" role="test" />
   <file md5sum="b0999f12547e1d120c98dad17fc7d428" name="tests/setPref/database-error.phpt" role="test" />
   <file md5sum="0e1c8bdf5f12519615efda379c235893" name="tests/setPref/pref-exists-default-exists.phpt" role="test" />
   <file md5sum="24f12431e2ea877ad43d091587d9d0cd" name="tests/setPref/pref-notexist-default-exists.phpt" role="test" />
   <file md5sum="46375cd974ec98fed9029274528b0de7" name="tests/setup.php" role="test" />
   <file baseinstalldir="/Auth" md5sum="3cd56feaca198219724f52d314eace05" name="PrefManager.php" role="php" />
  </dir>
 </contents>
 <dependencies>
  <required>
   <php>
    <min>4.4.0</min>
   </php>
   <pearinstaller>
    <min>1.4.0</min>
   </pearinstaller>
   <package>
    <name>DB</name>
    <channel>pear.php.net</channel>
    <min>1.7.0</min>
   </package>
  </required>
 </dependencies>
 <phprelease />
 <changelog>
  <release>
   <date>2005-04-05</date>
   <time>00:06:00</time>
   <version>
    <release>1.1.4</release>
    <api>1.1.4</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>Bugfix release, submitted patches from the bug tracker.
 * Closes #3655
 * Closes #2975
 * Closes #2512</notes>
  </release>
  <release>
   <date>2004-06-16</date>
   <time>23:30:00</time>
   <version>
    <release>1.1.3</release>
    <api>1.1.3</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>Bugfix release, removing a missed debug echo.</notes>
  </release>
  <release>
   <version>
    <release>1.1.2</release>
    <api>1.1.2</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2004-04-29</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Stopped using the depracted DB_Common::quote method, and changed to DB_Common::quoteSmart.
* Use DB_Common::quoteIdentifier to make sure that the table and column names are legal.</notes>
  </release>
  <release>
   <version>
    <release>1.1.1</release>
    <api>1.1.1</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2004-02-17</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>Fixed a bug in the new serialization code, which was preventing non-default values from being unserialized.</notes>
  </release>
  <release>
   <version>
    <release>1.1.0</release>
    <api>1.1.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2004-02-14</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>Added support for serializing values before they&apos;re saved in the database, and then unserializing when retrieved.
To use it set the &quot;serialize&quot; option to true.</notes>
  </release>
  <release>
   <version>
    <release>1.0.3</release>
    <api>1.0.3</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2003-04-24</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* I missed a set of quotes in the last release, causing empty preferences to be set to &apos;
One day I&apos;ll manage to get the release thing right ;)</notes>
  </release>
  <release>
   <version>
    <release>1.0.1</release>
    <api>1.0.1</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2003-04-20</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Added a getDefaultPref method.
* Various bug fixes</notes>
  </release>
  <release>
   <version>
    <release>1.0</release>
    <api>1.0</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2003-04-20</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>* Added a getDefaultPref method.
* Various bug fixes</notes>
  </release>
  <release>
   <version>
    <release>0.2.31</release>
    <api>0.2.31</api>
   </version>
   <stability>
    <release>stable</release>
    <api>stable</api>
   </stability>
   <date>2003-03-24</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>no release notes</notes>
  </release>
  <release>
   <version>
    <release>0.2.2</release>
    <api>0.2.2</api>
   </version>
   <stability>
    <release>devel</release>
    <api>devel</api>
   </stability>
   <date>2003-02-04</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>New Feature: You can now choose whether to use the cache or not (Auth_PrefManager::useCache(true|false))
        Bugfix: When retrieving a preference it now checks if the query returns any rows, instead of checking the value.</notes>
  </release>
  <release>
   <version>
    <release>0.2.1</release>
    <api>0.2.1</api>
   </version>
   <stability>
    <release>devel</release>
    <api>devel</api>
   </stability>
   <date>2003-01-16</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>Bugfix release: The constructor (and everything else :S) now works.</notes>
  </release>
  <release>
   <version>
    <release>0.2.0</release>
    <api>0.2.0</api>
   </version>
   <stability>
    <release>devel</release>
    <api>devel</api>
   </stability>
   <date>2002-12-07</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>- Changed the package and class name to Auth_PrefManager, and the filename to PrefManager.php to comply with PEAR coding standards.</notes>
  </release>
  <release>
   <version>
    <release>0.11</release>
    <api>0.11</api>
   </version>
   <stability>
    <release>devel</release>
    <api>devel</api>
   </stability>
   <date>2002-12-07</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>First release.</notes>
  </release>
  <release>
   <version>
    <release>0.1</release>
    <api>0.1</api>
   </version>
   <stability>
    <release>devel</release>
    <api>devel</api>
   </stability>
   <date>2002-12-06</date>
   <license uri="http://www.php.net/license">PHP License</license>
   <notes>Preview release for the PEAR-Dev list.</notes>
  </release>
 </changelog>
</package>
test unusual orderings of package.xml
<?php
$package = new PEAR2_Pyrus_Package(__DIR__.'/../../Registry/AllRegistries/package.xml');

$info = $package->getInternalPackage()->getPackageFile()->info;
// set up some fake dependencies so we can test this too

$deps = $info->dependencies;
$deps['required']->package['pear.php.net/File']->min('1.2.0');
$deps['required']->subpackage['pear2.php.net/Foo']->min('1.0.0')->max('2.0.0')
                                        ->recommended('1.2.0')->exclude('1.1.0')->exclude('1.1.1');
$deps['required']->package['pear.php.net/Other']->conflicts();

$deps['optional']->package['pear.php.net/PEAR']->min('1.7.0');
$deps['optional']->subpackage['pear2.php.net/Bar']->min('1.5.0');
$deps['required']->package['pecl.php.net/PackageName']->min('1.1.0')->max('1.2.0')->recommended('1.1.1')
            ->exclude('1.1.0a1')->exclude('1.1.0a2')->providesextension('packagename');

$deps['required']->extension['phar']->min('2.0.0')->exclude('2.0.1');
$deps['required']->os['windows'] = true;
$deps['required']->os['vista'] = false;
$deps['required']->arch['i386'] = true;
$deps['required']->php->exclude('5.2.8');

$group = $deps['group']->name;
$group->hint = 'Install optional stuff as a group';
$group->package['pear2.php.net/PackageName1']->save();
$group->package['pear2.php.net/PackageName2']->min('1.2.0');
$group->subpackage['pear2.php.net/PackageName3']->recommended('1.2.1');
$group->extension['extension']->exclude('5.2.8')->exclude('5.2.9');
$group->package['pecl.php.net/PackageName']->min('1.1.0')->max('1.2.0')->recommended('1.1.1')
            ->exclude('1.1.0a1')->exclude('1.1.0a2')->providesextension('packagename');
--TEST--
PackageFile v2: test package.xml dependencies property, setting extension dep 2
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.extension.setting2.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, dep group package dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.group.package.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, setting arch dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.arch.setting.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, basic extension dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.extension.basic.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, setting required dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.required.setting.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependsOn(), uri-based packages
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$pf1 = new PEAR2_Pyrus_PackageFile_v2;
$pf1->name = 'P1';
$pf1->channel = 'pear2.php.net';

$pf2 = new PEAR2_Pyrus_PackageFile_v2;
$pf2->name = 'P2';
$pf2->uri = 'http://pear.example.com';

$test->assertEquals(false, $pf1->dependsOn($pf2), 'no relation');
$pf1->dependencies['group']->group1->package['__uri/P2']->uri('http://pear.example.com');
$test->assertEquals(true, $pf1->dependsOn($pf2), 'group relation');

unset($pf1->dependencies['group']);

$test->assertEquals(false, $pf1->dependsOn($pf2), 'no relation');
$pf1->dependencies['optional']->package['__uri/P2']->uri('http://pear.example.com');
$test->assertEquals(true, $pf1->dependsOn($pf2), 'optional relation');

unset($pf1->dependencies['optional']);

$test->assertEquals(false, $pf1->dependsOn($pf2), 'no relation');
$pf1->dependencies['required']->package['__uri/P2']->uri('http://pear.example.com');
$test->assertEquals(true, $pf1->dependsOn($pf2), 'required relation');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, complex subpackage dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.subpackage.complex.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, dep group subpackage dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.group.subpackage.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, os iterator
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->dependencies['required']->os['hi'] = true;
$pf->dependencies['required']->os['bye'] = false;
$pf->dependencies['required']->os['last'] = true;
$comp = array();
foreach ($pf->dependencies['required']->os as $key => $dep) {
    $comp[$key] = $dep->getInfo();
}
$test->assertEquals(array (
  0 => 
  array (
    'name' => 'hi',
  ),
  1 => 
  array (
    'name' => 'bye',
    'conflicts' => '',
  ),
  2 => 
  array (
    'name' => 'last',
  ),
), $comp, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, os dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.os.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, basic pearinstaller dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.pearinstaller.basic.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, basic php dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.php.basic.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, resetting php dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.php.reset.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, conflicting package dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.package.conflicting.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, errors
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$package = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
try {
    $a = $package->dependencies->min;
    throw new Exception('getting min worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Cannot retrieve dependency type, choose $pf->dependencies[\'required\']->' .
                        'min or $pf->dependencies[\'optional\']->min', $e->getMessage(), 'getting min');
}
try {
    $a = $package->dependencies->min = 1;
    throw new Exception('setting min worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Cannot set dependency type, choose $pf->dependencies[\'required\']->' .
                        'min or $pf->dependencies[\'optional\']->min', $e->getMessage(), 'setting min');
}
try {
    $a = $package->dependencies['required']->min;
    throw new Exception('unknown dep type worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Unknown dependency type: min', $e->getMessage(), 'Unknown dep type');
}

try {
    $package->dependencies['required']->min = 1;
    throw new Exception('unknown dep type set worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Unknown dependency type: min', $e->getMessage(), 'Unknown dep type set');
}

try {
    $a = $package->dependencies['optional']->arch;
    throw new Exception('getting optional->arch worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('arch dependency is not supported as an optional dependency',
                        $e->getMessage(), 'getting optional->arch');
}
try {
    $a = $package->dependencies['optional']->os;
    throw new Exception('getting optional->os worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('os dependency is not supported as an optional dependency',
                        $e->getMessage(), 'getting optional->os');
}

try {
    $package->dependencies['optional']->arch = 1;
    throw new Exception('setting optional->arch worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('arch dependency is not supported as an optional dependency',
                        $e->getMessage(), 'setting optional->arch');
}
try {
    $package->dependencies['optional']->os = 1;
    throw new Exception('setting optional->os worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('os dependency is not supported as an optional dependency',
                        $e->getMessage(), 'setting optional->os');
}

try {
    $package->dependencies['required']->arch = 1;
    throw new Exception('setting required->arch to 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Can only set arch to PEAR2_Pyrus_PackageFile_v2_Dependencies_Dep object',
                        $e->getMessage(), 'setting required->arch to 1');
}
try {
    $package->dependencies['required']->os = 1;
    throw new Exception('setting required->os to 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Can only set os to PEAR2_Pyrus_PackageFile_v2_Dependencies_Dep object',
                        $e->getMessage(), 'setting required->os to 1');
}

try {
    $package->dependencies['group']->blah->arch = 1;
    throw new Exception('setting group->arch worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Only package, subpackage, and ' .
                        'extension dependencies are supported in dependency groups, asked for arch',
                        $e->getMessage(), 'setting group->arch');
}
try {
    $package->dependencies['group']->blah->os = 1;
    throw new Exception('setting group->os worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Only package, subpackage, and ' .
                        'extension dependencies are supported in dependency groups, asked for os',
                        $e->getMessage(), 'setting group->os');
}

try {
    $a = $package->dependencies['group']->blah->arch;
    throw new Exception('getting group->arch worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Only package, subpackage, and ' .
                        'extension dependencies are supported in dependency groups, asked for arch',
                        $e->getMessage(), 'getting group->arch');
}
try {
    $a = $package->dependencies['group']->blah->os;
    throw new Exception('getting group->os worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Only package, subpackage, and ' .
                        'extension dependencies are supported in dependency groups, asked for os',
                        $e->getMessage(), 'getting group->os');
}

try {
    $package->dependencies['required']->package = 1;
    throw new Exception('setting required->package to 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Can only set package to PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object',
                        $e->getMessage(), 'setting required->package to 1');
}
try {
    $package->dependencies['required']->subpackage = 1;
    throw new Exception('setting required->subpackage to 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Can only set subpackage to PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object',
                        $e->getMessage(), 'setting required->subpackage to 1');
}
try {
    $package->dependencies['required']->extension = 1;
    throw new Exception('setting required->extension to 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Can only set extension to PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object',
                        $e->getMessage(), 'setting required->extension to 1');
}

try {
    $package->dependencies['optional']->package = 1;
    throw new Exception('setting optional->package to 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Can only set package to PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object',
                        $e->getMessage(), 'setting optional->package to 1');
}
try {
    $package->dependencies['optional']->subpackage = 1;
    throw new Exception('setting optional->subpackage to 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Can only set subpackage to PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object',
                        $e->getMessage(), 'setting optional->subpackage to 1');
}
try {
    $package->dependencies['optional']->extension = 1;
    throw new Exception('setting optional->extension to 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Can only set extension to PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object',
                        $e->getMessage(), 'setting optional->extension to 1');
}

try {
    $package->dependencies['group']->groupname->package = 1;
    throw new Exception('setting group->package to 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Can only set package to PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object',
                        $e->getMessage(), 'setting group->package to 1');
}
try {
    $package->dependencies['group']->groupname->subpackage = 1;
    throw new Exception('setting group->subpackage to 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Can only set subpackage to PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object',
                        $e->getMessage(), 'setting group->subpackage to 1');
}
try {
    $package->dependencies['group']->groupname->extension = 1;
    throw new Exception('setting group->extension to 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Can only set extension to PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object',
                        $e->getMessage(), 'setting group->extension to 1');
}
$test->assertEquals(false, isset($package->dependencies->oops), 'isset on dependencies');
$test->assertEquals(true, isset($package->dependencies['required']), 'isset 1');
unset($package->dependencies['required']);
$test->assertEquals(false, isset($package->dependencies['required']), 'isset 2');

try {
    $a = $package->dependencies['required']['required'];
    throw new Exception('getting required->required worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Cannot access $pf->dependencies[\'required\'][\'required\']',
                        $e->getMessage(), 'getting required->required');
}

try {
    $a = $package->dependencies['required']['required'] = 1;
    throw new Exception('setting required->required worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Cannot set $pf->dependencies[\'required\'][\'required\']',
                        $e->getMessage(), 'setting required->required');
}

try {
    $a = $package->dependencies['required']->package['channel/Foobar']->gronk(1);
    throw new Exception('setting gronk worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Unknown variable gronk, should be one of name, channel, uri, min, max, recommended, exclude, providesextension, conflicts',
                        $e->getMessage(), 'setting gronk');
}

try {
    $package->dependencies['optional']->package['channel/Foobar']->conflicts();
    throw new Exception('setting conflicts worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Unknown variable conflicts, should be one of name, channel, uri, min, max, recommended, exclude, providesextension',
                        $e->getMessage(), 'setting optional->conflicts');
}

try {
    $package->dependencies['required']->php->oops();
    throw new Exception('oops worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Unknown variable oops, must be one of min, max, exclude',
                        $e->getMessage(), 'setting optional->conflicts');
}

try {
    $package->dependencies['required'] = 1;
    throw new Exception('required = 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Cannot set required to anything' .
                            ' but a PEAR2_Pyrus_PackageFile_v2_Dependencies object',
                        $e->getMessage(), 'required = 1');
}

try {
    $package->dependencies['optional'] = 1;
    throw new Exception('optional = 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Cannot set optional to anything' .
                            ' but a PEAR2_Pyrus_PackageFile_v2_Dependencies object',
                        $e->getMessage(), 'optional = 1');
}

try {
    $package->dependencies['group'] = 1;
    throw new Exception('group = 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Cannot set group to anything' .
                            ' but a PEAR2_Pyrus_PackageFile_v2_Dependencies_Group object',
                        $e->getMessage(), 'group = 1');
}

try {
    $package->dependencies['required']->arch->foo(1);
    throw new Exception('foo = 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Unknown variable foo, must be one of pattern, conflicts',
                        $e->getMessage(), 'foo = 1');
}

try {
    $package->dependencies['required']->os->foo2(1);
    throw new Exception('foo2 = 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Unknown variable foo2, must be one of name, conflicts',
                        $e->getMessage(), 'foo2 = 1');
}

try {
    $package->dependencies['group']->groupname->foo = null;
    throw new Exception('group->foo = null worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Only package, subpackage, and ' .
                                    'extension dependencies are supported in dependency groups, asked for foo',
                        $e->getMessage(), 'group->foo = null');
}

try {
    $package->dependencies['group']->groupname->hint = 1;
    throw new Exception('group->hint = 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('hint must be a string, was integer',
                        $e->getMessage(), 'group->hint = 1');
}

try {
    $a = $package->dependencies['required']->package['channel/package']['min'];
    throw new Exception('[min] worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Use -> operator to access dependency properties',
                        $e->getMessage(), '[min]');
}

try {
    $package->dependencies['required']->package['channel/package']['min'];
    throw new Exception('[min] worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Use -> operator to access dependency properties',
                        $e->getMessage(), '[min]');
}

try {
    $package->dependencies['required']->package['channel/package']['min'];
    throw new Exception('[min] worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Use -> operator to access dependency properties',
                        $e->getMessage(), '[min]');
}

try {
    $package->dependencies['required']->package['channel/package']['min'] = 1;
    throw new Exception('[min] = 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Use -> operator to access dependency properties',
                        $e->getMessage(), '[min] = 1');
}

try {
    $package->dependencies['required']->package['channel/package'] = 1;
    throw new Exception('[channel/package] = 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Can only set $pf->dependencies[\'required\']->package[\'channel/package' .
                '\'] to PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object',
                        $e->getMessage(), '[channel/package] = 1');
}

try {
    $package->dependencies['required']->package['channel/package'] = 1;
    throw new Exception('[channel/package] = 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Can only set $pf->dependencies[\'required\']->package[\'channel/package' .
                '\'] to PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object',
                        $e->getMessage(), '[channel/package] = 1');
}

$fake = new PEAR2_Pyrus_PackageFile_v2;

try {
    $package->dependencies['required']->package['channel/package'] = $fake->dependencies['required']->package['oops/notsame']->min('1.0.0');
    throw new Exception('[channel/package] = oops/notsame worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Cannot set channel/package' .
                ' to oops/notsame, use $pf->dependencies[\'required\']->package[] to set a new value',
                        $e->getMessage(), '[channel/package] = oops/notsame');
}

try {
    $package->dependencies['required']->subpackage['channel/subpackage'] = $fake->dependencies['required']->subpackage['oops/notsame']->min('1.0.0');
    throw new Exception('[channel/subpackage] = oops/notsame worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Cannot set channel/subpackage' .
                ' to oops/notsame, use $pf->dependencies[\'required\']->subpackage[] to set a new value',
                        $e->getMessage(), '[channel/subpackage] = oops/notsame');
}

try {
    $package->dependencies['required']->extension['extension'] = $fake->dependencies['required']->extension['notsame']->min('1.0.0');
    throw new Exception('[extension] = notsame worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Cannot set extension' .
                ' to notsame, use $pf->dependencies[\'required\']->extension[] to set a new value',
                        $e->getMessage(), '[extension] = notsame');
}

try {
    $package->dependencies['required']->extension['extension'] = $fake->dependencies['required']->package['oops/notsame']->min('1.0.0');
    throw new Exception('[extension] = [package] worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Cannot set extension dependency to package dependency',
                        $e->getMessage(), '[extension] = [package]');
}

try {
    $a = $package->dependencies['required']->package['oops'];
    throw new Exception('[oops] worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Cannot access "oops", must use "channel/package" to specify a package dependency to access',
                        $e->getMessage(), '[oops]');
}

try {
    $package->dependencies['required']->package['oops'] = $fake->dependencies['required']->package['ok/name'];
    throw new Exception('[oops] = ok/name worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Cannot set "oops", must use "channel/package" to specify a package dependency to set',
                        $e->getMessage(), '[oops] = ok/name');
}

try {
    isset($package->dependencies['required']->package['oops/toomany']['fooey']);
    throw new Exception('isset([oops/toomany][fooey]) worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Use -> operator to access dependency properties',
                        $e->getMessage(), 'isset([oops/toomany][fooey])');
}

try {
    unset($package->dependencies['required']->package['oops/toomany']['fooey']);
    throw new Exception('unset([oops/toomany][fooey]) worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Use -> operator to access dependency properties',
                        $e->getMessage(), 'unset([oops/toomany][fooey])');
}

try {
    $a = $package->dependencies['required']->package->fooey;
    throw new Exception('$a = fooey worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Use [] operator to access packages',
                        $e->getMessage(), '$a = fooey');
}

try {
    $a = $package->dependencies['required']->package->fooey();
    throw new Exception('$a = fooey() worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Use [] operator to access packages',
                        $e->getMessage(), '$a = fooey()');
}

try {
    $a = $package->dependencies['required']->extension['fooey']->name('sneaky');
    throw new Exception('name(sneaky) worked and should not');
} catch (PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception $e) {
    $test->assertEquals('Cannot change dependency name, use unset() to remove the old dependency',
                        $e->getMessage(), 'name(sneaky)');
}

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, setting group dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.group.setting.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, setting optional dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.optional.setting.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, dep group complex package dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.group.package.complex.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, complex php dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.php.complex.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, setting subpackage dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.subpackage.setting.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependsOn(), channel-based packages
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$pf1 = new PEAR2_Pyrus_PackageFile_v2;
$pf1->name = 'P1';
$pf1->channel = 'pear2.php.net';

$pf2 = new PEAR2_Pyrus_PackageFile_v2;
$pf2->name = 'P2';
$pf2->channel = 'pear.example.com';

$test->assertEquals(false, $pf1->dependsOn($pf2), 'no relation');
$pf1->dependencies['group']->group1->package['pear.example.com/P2']->save();
$test->assertEquals(true, $pf1->dependsOn($pf2), 'group relation');

unset($pf1->dependencies['group']);

$test->assertEquals(false, $pf1->dependsOn($pf2), 'no relation');
$pf1->dependencies['optional']->package['pear.example.com/P2']->save();
$test->assertEquals(true, $pf1->dependsOn($pf2), 'optional relation');

unset($pf1->dependencies['optional']);

$test->assertEquals(false, $pf1->dependsOn($pf2), 'no relation');
$pf1->dependencies['required']->package['pear.example.com/P2']->save();
$test->assertEquals(true, $pf1->dependsOn($pf2), 'required relation');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, setting subpackage dep 2
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.subpackage.setting2.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml isSubpackageOf()
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$pf1 = new PEAR2_Pyrus_PackageFile_v2;
$pf1->name = 'P1';
$pf1->uri = 'http://localhost';

$pf2 = new PEAR2_Pyrus_PackageFile_v2;
$pf2->name = 'P2';
$pf2->uri = 'http://example.com';

$test->assertEquals(false, $pf2->isSubpackageOf($pf1), 'no relation');

$pf1->dependencies['group']->group1->subpackage['__uri/P2']->uri('http://example.com');
$test->assertEquals(true, $pf2->isSubpackageOf($pf1), 'group relation');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, setting package dep 2
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.package.setting2.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, setting extension dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.extension.setting.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, conflicting os dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.os.conflicting.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test subpackage.xml dependsOn(), uri-based subpackages
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$pf1 = new PEAR2_Pyrus_PackageFile_v2;
$pf1->name = 'P1';
$pf1->channel = 'pear2.php.net';

$pf2 = new PEAR2_Pyrus_PackageFile_v2;
$pf2->name = 'P2';
$pf2->uri = 'http://pear.example.com';

$test->assertEquals(false, $pf1->dependsOn($pf2), 'no relation');
$pf1->dependencies['group']->group1->subpackage['__uri/P2']->uri('http://pear.example.com');
$test->assertEquals(true, $pf1->dependsOn($pf2), 'group relation');

unset($pf1->dependencies['group']);

$test->assertEquals(false, $pf1->dependsOn($pf2), 'no relation');
$pf1->dependencies['optional']->subpackage['__uri/P2']->uri('http://pear.example.com');
$test->assertEquals(true, $pf1->dependsOn($pf2), 'optional relation');

unset($pf1->dependencies['optional']);

$test->assertEquals(false, $pf1->dependsOn($pf2), 'no relation');
$pf1->dependencies['required']->subpackage['__uri/P2']->uri('http://pear.example.com');
$test->assertEquals(true, $pf1->dependsOn($pf2), 'required relation');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml isSubpackage(), uri-based mixed with channel (3)
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$pf1 = new PEAR2_Pyrus_PackageFile_v2;
$pf1->name = 'P1';
$pf1->channel = 'pear2.php.net';

$pf2 = new PEAR2_Pyrus_PackageFile_v2;
$pf2->name = 'P2';
$pf2->uri = 'http://localhost';

$test->assertEquals(false, $pf1->isSubpackage($pf2), 'no relation');

$pf1->dependencies['group']->group1->subpackage['__uri/P2']->uri('http://example.com');
$test->assertEquals(false, $pf1->isSubpackage($pf2), 'group relation');

unset($pf1->dependencies['group']);

$pf1->dependencies['optional']->subpackage['__uri/P2']->uri('http://example.com');
$test->assertEquals(false, $pf1->isSubpackage($pf2), 'optional relation');

unset($pf1->dependencies['optional']);

$pf1->dependencies['required']->subpackage['__uri/P2']->uri('http://example.com');
$test->assertEquals(false, $pf1->isSubpackage($pf2), 'required relation');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, setting os dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.os.setting.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, dep group
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.group.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, pecl package dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.package.pecl.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml isSubpackage(), uri-based
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$pf1 = new PEAR2_Pyrus_PackageFile_v2;
$pf1->name = 'P1';
$pf1->uri = 'http://localhost';

$pf2 = new PEAR2_Pyrus_PackageFile_v2;
$pf2->name = 'P2';
$pf2->uri = 'http://example.com';

$test->assertEquals(false, $pf1->isSubpackage($pf2), 'no relation');

$pf1->dependencies['group']->group1->subpackage['__uri/P2']->uri('http://example.com');
$test->assertEquals(true, $pf1->isSubpackage($pf2), 'group relation');

unset($pf1->dependencies['group']);

$pf1->dependencies['optional']->subpackage['__uri/P2']->uri('http://example.com');
$test->assertEquals(true, $pf1->isSubpackage($pf2), 'optional relation');

unset($pf1->dependencies['optional']);

$pf1->dependencies['required']->subpackage['__uri/P2']->uri('http://example.com');
$test->assertEquals(true, $pf1->isSubpackage($pf2), 'required relation');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml isSubpackage(), uri-based mixed with channel
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$pf1 = new PEAR2_Pyrus_PackageFile_v2;
$pf1->name = 'P1';
$pf1->channel = 'pear2.php.net';

$pf2 = new PEAR2_Pyrus_PackageFile_v2;
$pf2->name = 'P2';
$pf2->uri = 'http://example.com';

$test->assertEquals(false, $pf1->isSubpackage($pf2), 'no relation');

$pf1->dependencies['group']->group1->subpackage['__uri/P2']->uri('http://example.com');
$test->assertEquals(true, $pf1->isSubpackage($pf2), 'group relation');

unset($pf1->dependencies['group']);

$pf1->dependencies['optional']->subpackage['__uri/P2']->uri('http://example.com');
$test->assertEquals(true, $pf1->isSubpackage($pf2), 'optional relation');

unset($pf1->dependencies['optional']);

$pf1->dependencies['required']->subpackage['__uri/P2']->uri('http://example.com');
$test->assertEquals(true, $pf1->isSubpackage($pf2), 'required relation');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, complex optional package dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.package.optional.complex.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, uri package dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.package.uri.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, dep group extension dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.group.extension.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, arch iterator
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->dependencies['required']->arch['hi'] = true;
$pf->dependencies['required']->arch['bye'] = false;
$pf->dependencies['required']->arch['last'] = true;
$comp = array();
foreach ($pf->dependencies['required']->arch as $key => $dep) {
    $comp[$key] = $dep->getInfo();
}
$test->assertEquals(array (
  0 => 
  array (
    'pattern' => 'hi',
  ),
  1 => 
  array (
    'pattern' => 'bye',
    'conflicts' => '',
  ),
  2 => 
  array (
    'pattern' => 'last',
  ),
), $comp, 'test');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, conflicting arch dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.arch.conflicting.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, arch dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.arch.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependsOn(), channel-based subpackages
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$pf1 = new PEAR2_Pyrus_PackageFile_v2;
$pf1->name = 'P1';
$pf1->channel = 'pear2.php.net';

$pf2 = new PEAR2_Pyrus_PackageFile_v2;
$pf2->name = 'P2';
$pf2->channel = 'pear.example.com';

$test->assertEquals(false, $pf1->dependsOn($pf2), 'no relation');
$pf1->dependencies['group']->group1->subpackage['pear.example.com/P2']->save();
$test->assertEquals(true, $pf1->dependsOn($pf2), 'group relation');

unset($pf1->dependencies['group']);

$test->assertEquals(false, $pf1->dependsOn($pf2), 'no relation');
$pf1->dependencies['optional']->subpackage['pear.example.com/P2']->save();
$test->assertEquals(true, $pf1->dependsOn($pf2), 'optional relation');

unset($pf1->dependencies['optional']);

$test->assertEquals(false, $pf1->dependsOn($pf2), 'no relation');
$pf1->dependencies['required']->subpackage['pear.example.com/P2']->save();
$test->assertEquals(true, $pf1->dependsOn($pf2), 'required relation');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml isSubpackage(), uri-based mixed with channel (2)
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$pf1 = new PEAR2_Pyrus_PackageFile_v2;
$pf1->name = 'P1';
$pf1->uri = 'http://localhost';

$pf2 = new PEAR2_Pyrus_PackageFile_v2;
$pf2->name = 'P2';
$pf2->channel = 'pear2.php.net';

$test->assertEquals(false, $pf1->isSubpackage($pf2), 'no relation');

$pf1->dependencies['group']->group1->subpackage['pear2.php.net/P2']->save();
$test->assertEquals(true, $pf1->isSubpackage($pf2), 'group relation');

unset($pf1->dependencies['group']);

$pf1->dependencies['optional']->subpackage['pear2.php.net/P2']->save();
$test->assertEquals(true, $pf1->isSubpackage($pf2), 'optional relation');

unset($pf1->dependencies['optional']);

$pf1->dependencies['required']->subpackage['pear2.php.net/P2']->save();
$test->assertEquals(true, $pf1->isSubpackage($pf2), 'required relation');

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, Package class extra coverage
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
$pf->fromArray(array('package' => array('dependencies' => array('required' => array('package' =>
                                        array('name' => 'try', 'channel' => 'first', 'exclude' => '1.2.0'))))));
$test->assertEquals(array('1.2.0'), $pf->dependencies['required']->package['first/try']->exclude, 'exclude');
// covers unset() on non-existing package
unset($pf->dependencies['required']->package['Hi/There']);
$test->assertEquals(false, isset($pf->dependencies['required']->package['Hi/There']), 'verify unset did not add it');
$test->assertEquals('required', $pf->dependencies['required']->package['Hi/There']->deptype, 'deptype');
$pf->dependencies['required']->package['Hi/There']->conflicts(true);
$test->assertEquals(true, $pf->dependencies['required']->package['Hi/There']->conflicts, 'conflicts');
$pf->dependencies['required']->package['first/try']->exclude(null);
$test->assertEquals(null, $pf->dependencies['required']->package['first/try']->exclude, 'exclude null');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, multiple exclude in php dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.php.exclude.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, complex optional subpackage dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.subpackage.optional.complex.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, setting package dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.package.setting.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, complex package dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.package.complex.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml dependencies property, complex pearinstaller dep
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$reg = new PEAR2_Pyrus_PackageFile_v2; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/extended/dependencies.pearinstaller.complex.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml isSubpackage()
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$pf1 = new PEAR2_Pyrus_PackageFile_v2;
$pf1->name = 'P1';
$pf1->channel = 'pear2.php.net';

$pf2 = new PEAR2_Pyrus_PackageFile_v2;
$pf2->name = 'P2';
$pf2->channel = 'pear2.php.net';

$test->assertEquals(false, $pf1->isSubpackage($pf2), 'no relation');

$pf1->dependencies['group']->group1->subpackage['pear2.php.net/P2']->save();
$test->assertEquals(true, $pf1->isSubpackage($pf2), 'group relation');

unset($pf1->dependencies['group']);

$pf1->dependencies['optional']->subpackage['pear2.php.net/P2']->save();
$test->assertEquals(true, $pf1->isSubpackage($pf2), 'optional relation');

unset($pf1->dependencies['optional']);

$pf1->dependencies['required']->subpackage['pear2.php.net/P2']->save();
$test->assertEquals(true, $pf1->isSubpackage($pf2), 'required relation');

?>
===DONE===
--EXPECT--
===DONE===<?php
include dirname(__FILE__) . '/../test_framework.php.inc';
--TEST--
PackageFile v2: test basic, simple methods
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';

$a = new PEAR2_Pyrus_PackageFile_v2;
$a->setPackageFile('foo/bar', 'bar');
$test->assertEquals('foo/bar', $a->getPackageFile(), 'packagefile');
$test->assertEquals('foo/bar', $a->packagefile, 'packagefile 2');
$test->assertEquals('bar', $a->getArchiveFile(), 'archivefile');
$test->assertEquals('foo', $a->filepath, 'archivefile 2');

$a->setFilelist(array('foo.php' => array('role' => 'test'), 'bar.php' => array('role' => 'php')));

$test->assertTrue($a->hasFile('foo.php'), 'hasfile1');
$test->assertTrue($a->hasFile('bar.php'), 'hasfile2');
$test->assertFalse($a->hasFile('no'), 'hasfile3');

$test->assertEquals(array('role' => 'test'), $a->getFile('foo.php'), 'foo');
$test->assertEquals(array('role' => 'php'), $a->getFile('bar.php'), 'bar');

try {
    $a->setFileAttribute('foo.php', 'noway', 'no');
    throw new \Exception('noway did not fail');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Cannot set invalid attribute noway for file foo.php', $e->getMessage(), 'noway message');
}

try {
    $a->setFileAttribute('foo.php', 'name', 'no');
    throw new \Exception('name did not fail');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Cannot change name of file foo.php', $e->getMessage(), 'name message');
}

try {
    $a->setFileAttribute('oops', 'role', 'test');
    throw new \Exception('oops did not fail');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Cannot set attribute role for non-existent file oops', $e->getMessage(), 'oops message');
}
$i = 1;
foreach (array('role', 'baseinstalldir', 'install-as') as $attr) {
    $a->setFileAttribute('foo.php', $attr, 'hi'.$i++);
}
$test->assertEquals(array (
  'role' => 'test',
  'attribs' => 
  array (
    'role' => 'hi1',
    'baseinstalldir' => 'hi2',
    'install-as' => 'hi3',
  ),
), $a->getFile('foo.php'), 'final');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml usestask property
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$reg = new PEAR2_Pyrus_PackageFile_v2;
require __DIR__ . '/../../Registry/AllRegistries/package/extended/usestask.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test basic package.xml properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../Registry/AllRegistries/package/basic/license.template';

// don't try this at home!
$newguy->fromArray(array('package' => array()));
$test->assertEquals(null, $newguy->license['name'], 'blank name');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml usestask property (2)
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$reg = new PEAR2_Pyrus_PackageFile_v2;
require __DIR__ . '/../../Registry/AllRegistries/package/extended/usestask2.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml usesrole property errors
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$reg = new PEAR2_Pyrus_PackageFile_v2;

try {
    $reg->usesrole['foo']['foo'];
    throw new Exception('[foo][foo] did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('use -> operator to access properties of a usesrole', $e->getMessage(), '[foo][foo]');
}

try {
    $reg->usesrole['foo']['foo'] = 1;
    throw new Exception('[foo][foo] = 1 did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('use -> operator to access properties of a usesrole', $e->getMessage(), '[foo][foo] = 1');
}

try {
    isset($reg->usesrole['foo']['foo']);
    throw new Exception('isset([foo][foo]) did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('use -> operator to access properties of a usesrole', $e->getMessage(), 'isset([foo][foo])');
}

try {
    unset($reg->usesrole['foo']['foo']);
    throw new Exception('unset([foo][foo]) did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('use -> operator to access properties of a usesrole', $e->getMessage(), 'unset([foo][foo])');
}


try {
    $reg->usesrole['foo'] = 1;
    throw new Exception('[foo] = 1 did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('Can only set usesrole to a PEAR2_Pyrus_PackageFile_v2_UsesRoleTask object', $e->getMessage(), '[foo] = 1');
}

try {
    $reg->usesrole['foo'] = $reg->usestask['foo'];
    throw new Exception('role = task did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('Cannot set usesrole to a usestask object', $e->getMessage(), 'role = task');
}


try {
    $reg->usesrole->foo;
    throw new Exception('->foo did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('use [] operator to access usesroles', $e->getMessage(), '->foo');
}

try {
    $reg->usesrole->foo = 1;
    throw new Exception('->foo = 1 did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('use [] operator to access usesroles', $e->getMessage(), '->foo = 1');
}

try {
    isset($reg->usesrole->foo);
    throw new Exception('isset(->foo) did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('use [] operator to access usesroles', $e->getMessage(), 'isset(->foo)');
}

try {
    unset($reg->usesrole->foo);
    throw new Exception('unset(->foo) did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('use [] operator to access usesroles', $e->getMessage(), 'unset(->foo)');
}

try {
    unset($reg->usesrole['foo']->foo);
    throw new Exception('unset([foo]->foo) did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('Unknown variable foo requested, should be one of role, package, channel, uri', $e->getMessage(), 'unset([foo]->foo)');
}

try {
    isset($reg->usesrole['foo']->foo);
    throw new Exception('isset([foo]->foo) did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('Unknown variable foo requested, should be one of role, package, channel, uri', $e->getMessage(), 'isset([foo]->foo)');
}

try {
    $reg->usesrole['foo']->foo();
    throw new Exception('[foo]->foo() did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('Unknown variable foo, must be one of role, package, channel, uri', $e->getMessage(), '[foo]->foo()');
}

try {
    $a = $reg->usesrole['foo']->foo;
    throw new Exception('$a = [foo]->foo did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('Unknown variable foo, must be one of role, package, channel, uri', $e->getMessage(), '$a = [foo]->foo');
}

try {
    $reg->usesrole['foo']->foo = 1;
    throw new Exception('[foo]->foo = 1 did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('Unknown variable foo, must be one of role, package, channel, uri', $e->getMessage(), '[foo]->foo = 1');
}

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml packagingcontents property
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../Registry/AllRegistries/package/basic/packagingcontents.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml release properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../Registry/AllRegistries/package/basic/release.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml usestask property errors
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$reg = new PEAR2_Pyrus_PackageFile_v2;

try {
    $reg->usestask['foo']['foo'];
    throw new Exception('[foo][foo] did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('use -> operator to access properties of a usestask', $e->getMessage(), '[foo][foo]');
}

try {
    $reg->usestask['foo']['foo'] = 1;
    throw new Exception('[foo][foo] = 1 did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('use -> operator to access properties of a usestask', $e->getMessage(), '[foo][foo] = 1');
}

try {
    isset($reg->usestask['foo']['foo']);
    throw new Exception('isset([foo][foo]) did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('use -> operator to access properties of a usestask', $e->getMessage(), 'isset([foo][foo])');
}

try {
    unset($reg->usestask['foo']['foo']);
    throw new Exception('unset([foo][foo]) did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('use -> operator to access properties of a usestask', $e->getMessage(), 'unset([foo][foo])');
}


try {
    $reg->usestask['foo'] = 1;
    throw new Exception('[foo] = 1 did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('Can only set usestask to a PEAR2_Pyrus_PackageFile_v2_UsesRoleTask object', $e->getMessage(), '[foo] = 1');
}

try {
    $reg->usestask['foo'] = $reg->usesrole['foo'];
    throw new Exception('task = role did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('Cannot set usestask to a usesrole object', $e->getMessage(), 'task = role');
}


try {
    $reg->usestask->foo;
    throw new Exception('->foo did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('use [] operator to access usestasks', $e->getMessage(), '->foo');
}

try {
    $reg->usestask->foo = 1;
    throw new Exception('->foo = 1 did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('use [] operator to access usestasks', $e->getMessage(), '->foo = 1');
}

try {
    isset($reg->usestask->foo);
    throw new Exception('isset(->foo) did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('use [] operator to access usestasks', $e->getMessage(), 'isset(->foo)');
}

try {
    unset($reg->usestask->foo);
    throw new Exception('unset(->foo) did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('use [] operator to access usestasks', $e->getMessage(), 'unset(->foo)');
}

try {
    unset($reg->usestask['foo']->foo);
    throw new Exception('unset([foo]->foo) did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('Unknown variable foo requested, should be one of task, package, channel, uri', $e->getMessage(), 'unset([foo]->foo)');
}

try {
    isset($reg->usestask['foo']->foo);
    throw new Exception('isset([foo]->foo) did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('Unknown variable foo requested, should be one of task, package, channel, uri', $e->getMessage(), 'isset([foo]->foo)');
}

try {
    $reg->usestask['foo']->foo();
    throw new Exception('[foo]->foo() did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('Unknown variable foo, must be one of task, package, channel, uri', $e->getMessage(), '[foo]->foo()');
}

try {
    $a = $reg->usestask['foo']->foo;
    throw new Exception('$a = [foo]->foo did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('Unknown variable foo, must be one of task, package, channel, uri', $e->getMessage(), '$a = [foo]->foo');
}

try {
    $reg->usestask['foo']->foo = 1;
    throw new Exception('[foo]->foo = 1 did not fail and should');
} catch (PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception $e) {
    $test->assertEquals('Unknown variable foo, must be one of task, package, channel, uri', $e->getMessage(), '[foo]->foo = 1');
}

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml allmaintainers property
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../Registry/AllRegistries/package/basic/allmaintainers.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test basic package.xml properties
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../setupFiles/setupPackageFile.php.inc';
$reg = $package; // simulate registry package using packagefile
require __DIR__ . '/../../Registry/AllRegistries/package/basic/basic.template';

// don't try this at home!
$reg->fromArray(array('package' => array()));
$test->assertEquals(false, $reg->{'api-version'}, 'api-version blank');
$test->assertEquals(false, $reg->{'api-state'}, 'api-state blank');
$test->assertEquals(false, $reg->{'release-version'}, 'api-version blank');
$test->assertEquals(false, $reg->state, 'state blank');
$test->assertEquals(false, $reg->bundledpackage, 'bundledpackage');
$test->assertEquals(false, $reg->releases, 'releases');

$reg->fromArray(array('package' => array('uri' => 'test', 'bundle' => '')));
$test->assertEquals(array(), $reg->bundledpackage->getInfo(), 'bundledpackage 2');
$test->assertEquals('__uri', $reg->channel, 'uri channel');

$test->assertEquals('2.0', $reg->getPackagexmlVersion(), '2.0 bundle');
$test->assertEquals(false, $reg->sourcepackage, 'sourcepackage bundle');

$reg->fromArray(array('package' => array('phprelease' => array('', ''))));
$test->assertEquals(array('', ''), $reg->installGroup, 'installGroup');

$test->assertEquals('2.0', $reg->getPackagexmlVersion(), '2.0 php');
$test->assertEquals(false, $reg->sourcepackage, 'sourcepackage php');

$reg->fromArray(array('package' => array('zendextsrcrelease' => '')));
$test->assertEquals('zendextsrc', $reg->getPackageType(), 'zendextsrc');

$test->assertEquals('2.1', $reg->getPackagexmlVersion(), '2.1 zendextsrc');
$test->assertEquals(false, $reg->sourcepackage, 'sourcepackage zendsrc');

$reg->fromArray(array('package' => array('zendextbinrelease' => '', 'srcpackage' => 'hi', 'srcchannel' => 'there')));
$test->assertEquals('zendextbin', $reg->getPackageType(), 'zendextbin');
$test->assertEquals(array('channel' => 'there', 'package' => 'hi'), $reg->sourcepackage, 'sourcepackage zend bin');

$test->assertEquals('2.1', $reg->getPackagexmlVersion(), '2.1 zendextbin');

$reg->fromArray(array('package' => array('extsrcrelease' => '')));
$test->assertEquals('extsrc', $reg->getPackageType(), 'extsrc');

$test->assertEquals('2.0', $reg->getPackagexmlVersion(), '2.0 extsrc');
$test->assertEquals(false, $reg->sourcepackage, 'sourcepackage src');

$reg->fromArray(array('package' => array('extbinrelease' => '', 'srcpackage' => 'hi', 'srcchannel' => 'there')));
$test->assertEquals('extbin', $reg->getPackageType(), 'zendextbin');
$test->assertEquals(array('channel' => 'there', 'package' => 'hi'), $reg->sourcepackage, 'sourcepackage bin');

$test->assertEquals('2.0', $reg->getPackagexmlVersion(), '2.0 extbin');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test SimpleProperty
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$package = new PEAR2_Pyrus_PackageFile_v2;

$package->fromArray(array('package' => array('contents' => array(
    'bundledpackage' => 'test'))));

$test->assertEquals(false, $package->bundledpackage, 'first test, no <bundle> tag present');

$package->fromArray(array('package' => array('contents' => array(
    'bundledpackage' => 'test'), 'bundle' => '')));

$test->assertEquals('test', $package->bundledpackage['test'], 'test');
$test->assertEquals(false, $package->bundledpackage['notfound'], 'notfound');

unset($package->bundledpackage['test']);
$test->assertEquals(false, $package->bundledpackage['test'], 'after unset');
unset($package->bundledpackage['test']);

$test->assertEquals(false, isset($package->bundledpackage['another']), 'isset before');
$test->assertEquals(false, $package->bundledpackage['another'], 'before set');
$test->assertEquals(0, count($package->bundledpackage), 'count 0');

$package->bundledpackage[] = 'another';

$test->assertEquals('another', $package->bundledpackage['another'], 'after set');
$test->assertEquals(true, isset($package->bundledpackage['another']), 'isset after');
$test->assertEquals(1, count($package->bundledpackage), 'count 1');

$package->bundledpackage[] = 'another';
$test->assertEquals(1, count($package->bundledpackage), 'still count 1');
$test->assertEquals('another', $package->bundledpackage['another'], 'after set 2');

foreach ($package->bundledpackage as $name => $name2) {
    $test->assertEquals($name, $name2, 'should be the same');
    $test->assertEquals('another', $name, 'another');
}

try {
    $package->bundledpackage[] = 1;
    throw new Exception('[] = 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Can only set bundledpackage to string', $e->getMessage(),
        '[] = 1');
}
?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml release configureoption property
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$reg = new PEAR2_Pyrus_PackageFile_v2;
require __DIR__ . '/../../Registry/AllRegistries/package/extended/release.configureoption.template';
?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml file access properties (2)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../Registry/AllRegistries/package/basic/file2.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml maintainer properties (2)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../Registry/AllRegistries/package/basic/maintainer2.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml properties, random extra coverage
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$pf = new PEAR2_Pyrus_PackageFile_v2;
// test array initialization to nada
$pf->fromArray(array('package' => array()));
$test->assertIsa('PEAR2_Pyrus_PackageFile_v2_Dependencies', $pf->dependencies, 'dependencies');
$test->assertIsa('PEAR2_Pyrus_PackageFile_v2_Release', $pf->release, 'release');
?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml setting release configureoption property
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$reg = new PEAR2_Pyrus_PackageFile_v2;
require __DIR__ . '/../../Registry/AllRegistries/package/extended/release.configureoption.setting.template';
?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml release configureoption property errors
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$reg = new PEAR2_Pyrus_PackageFile_v2;
require __DIR__ . '/../../Registry/AllRegistries/package/extended/release.configureoption.errors.template';
?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test SimpleProperty exceptions
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$package = new PEAR2_Pyrus_PackageFile_v2;
try {
    unset($package->version['foo']);
    throw new Exception('unset(foo) worked and should not');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Unknown version property foo', $e->getMessage(), 'unset(foo)');
}

try {
    unset($package->stability['foo']);
    throw new Exception('unset(foo) stability worked and should not');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Unknown stability property foo', $e->getMessage(), 'unset(foo) stability');
}

try {
    isset($package->version['foo']);
    throw new Exception('isset(foo) worked and should not');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Unknown version property foo', $e->getMessage(), 'isset(foo)');
}

try {
    isset($package->stability['foo']);
    throw new Exception('isset(foo) stability worked and should not');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Unknown stability property foo', $e->getMessage(), 'isset(foo) stability');
}

try {
    $package->version['foo'] = '1.0.0';
    throw new Exception('foo = 1.0.0 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Unknown version property foo', $e->getMessage(), 'foo = 1.0.0');
}

try {
    $package->stability['foo'] = '1.0.0';
    throw new Exception('foo = 1.0.0 stability worked and should not');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Unknown stability property foo', $e->getMessage(), 'foo = 1.0.0 stability');
}

try {
    $a = $package->version['foo'];
    throw new Exception('$a = foo worked and should not');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Unknown version property foo', $e->getMessage(), '$a = foo');
}

try {
    $a = $package->stability['foo'];
    throw new Exception('$a = foo stability worked and should not');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Unknown stability property foo', $e->getMessage(), '$a = foo stability');
}

try {
    $package->version['release'] = 1;
    throw new Exception('release = 1 worked and should not');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Can only set version to string', $e->getMessage(), 'release = 1');
}

try {
    $package->stability['release'] = 1;
    throw new Exception('release = 1 stability worked and should not');
} catch (PEAR2_Pyrus_PackageFile_Exception $e) {
    $test->assertEquals('Can only set stability to string', $e->getMessage(), 'release = 1 stability');
}
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml usesrole property
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$reg = new PEAR2_Pyrus_PackageFile_v2;
require __DIR__ . '/../../Registry/AllRegistries/package/extended/usesrole.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml file access properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../Registry/AllRegistries/package/basic/file.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
require __DIR__ . '/../setup.php.inc';
@mkdir(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
set_include_path(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'testit');
$c = PEAR2_Pyrus_Config::singleton(__DIR__.'/testit');
$c->bin_dir = __DIR__ . '/testit/bin';
restore_include_path();
$c->saveConfig();
require __DIR__ . '/../setupFiles/setupPackageFile.php.inc';
$reg = $package; // simulate registry package using packagefile--TEST--
PackageFile v2: test package.xml license property, direct set
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$reg = new PEAR2_Pyrus_PackageFile_v2;
require __DIR__ . '/../../Registry/AllRegistries/package/extended/setlicense.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml release properties (3)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../Registry/AllRegistries/package/basic/release3.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml usesrole property (2)
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$reg = new PEAR2_Pyrus_PackageFile_v2;
require __DIR__ . '/../../Registry/AllRegistries/package/extended/usesrole.template';

?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test SimpleProperty
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$package = new PEAR2_Pyrus_PackageFile_v2;

$test->assertEquals(true, isset($package->version['release']), 'isset release version before');
$test->assertEquals(true, isset($package->version['api']), 'isset api version before');
$test->assertEquals(true, isset($package->stability['release']), 'isset release stability before');
$test->assertEquals(true, isset($package->stability['api']), 'isset api stability before');

$test->assertEquals('0.1.0', $package->version['release'], 'release version before');
$test->assertEquals('0.1.0', $package->version['api'], 'api version before');
$test->assertEquals(array('release' => '0.1.0', 'api' => '0.1.0'), $package->version->getInfo(), 'getinfo');
$test->assertEquals(array('release' => 'devel', 'api' => 'alpha'), $package->stability->getInfo(), 'getinfo stability');
$test->assertEquals('devel', $package->stability['release'], 'release stability before');
$test->assertEquals('alpha', $package->stability['api'], 'api stability before');
unset($package->version['release']);
unset($package->version['api']);
unset($package->stability['release']);
unset($package->stability['api']);
$test->assertEquals(null, $package->version['release'], 'release version after');
$test->assertEquals(null, $package->version['api'], 'api version after');
$test->assertEquals(null, $package->stability['release'], 'release stability after');
$test->assertEquals(null, $package->stability['api'], 'api stability after');

$test->assertEquals(false, isset($package->version['release']), 'isset release version after');
$test->assertEquals(false, isset($package->version['api']), 'isset api version after');
$test->assertEquals(false, isset($package->stability['release']), 'isset release stability after');
$test->assertEquals(false, isset($package->stability['api']), 'isset api stability after');

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml maintainer properties
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../Registry/AllRegistries/package/basic/maintainer.template';

?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml release binarypackage property
--FILE--
<?php
require __DIR__ . '/../setup.php.inc';
$reg = new PEAR2_Pyrus_PackageFile_v2;
require __DIR__ . '/../../Registry/AllRegistries/package/extended/release.binarypackage.template';
?>
===DONE===
--EXPECT--
===DONE===--TEST--
PackageFile v2: test package.xml release properties (2)
--FILE--
<?php
require __DIR__ . '/setup.php.inc';
require __DIR__ . '/../../Registry/AllRegistries/package/basic/release2.template';

$a = new PEAR2_Pyrus_PackageFile_v2;
$a->fromArray(array('package' => array('contents' => array('dir' => array('attribs' => array('name' => '/'),
                                                                          'file' => array('attribs' => array('name' => 'test')))),
                                       'phprelease' => array('installcondition' => array('extension' => null)))));
$a->setFilelist(array('test' => array('attribs' => array('name' => 'test'))));
$a->release[0]->ignore('test');
$test->assertEquals(false, $a->release[0]->getInstallCondition(), 'install conditions');
?>
===DONE===
--CLEAN--
<?php
$dir = __DIR__ . '/testit';
include __DIR__ . '/../../clean.php.inc';
?>
--EXPECT--
===DONE===<?php
/**
 * PEAR2_Pyrus
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Base class for Pyrus.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus
{
    static function getDataPath()
    {
        static $val = false;
        if ($val) return $val;
        $val = dirname(dirname(dirname(__FILE__))) . '/data/pear2.php.net/PEAR2_Pyrus';
        return $val;
    }
}
?>
<?php
require __DIR__ .  '/../../../sandbox/Loader/src/PEAR2/Loader/PEAR2Svn.php';
$dev_directory = dirname(dirname(__DIR__));
PEAR2_Pyrus_Config::singleton('/home/cellog/testpear');
$a = new PEAR2_Pyrus_Package_Creator(array(
        //new PEAR2_Pyrus_Developer_Creator_Xml($dev_directory . 'newpyrus.xml'),
        //new PEAR2_Pyrus_Developer_Creator_Tar($dev_directory . 'newpyrus.tar'),
        //new PEAR2_Pyrus_Developer_Creator_Zip($dev_directory . 'PEAR2_Pyrus-0.1.0.zip'),
        new PEAR2_Pyrus_Developer_Creator_Phar_PHPArchive($dev_directory . '/pyrus.phar', '<?php
function __autoload($class)
{
    include \'phar://\' . PYRUS_PHAR_FILE . \'/src/\' . implode(\'/\', explode(\'_\', $class)) . \'.php\';
}
$frontend = new PEAR2_Pyrus_ScriptFrontend_Commands;
@array_shift($_SERVER[\'argv\']);
$frontend->run($_SERVER[\'argv\']);
'),
    ));
$b = new PEAR2_Pyrus_Package(__DIR__ . '/../../package.xml');
$rp = __DIR__ . '/../../../HTTP_Request/src/HTTP';
$a->render($b, array(
    'src/PEAR2/HTTP/Request.php' => $rp . '/Request.php',
    'src/PEAR2/HTTP/Request/Adapter.php' => $rp . '/Request/Adapter.php',
    'src/PEAR2/HTTP/Request/Adapter/Phpsocket.php' => $rp . '/Request/Adapter/Phpsocket.php',
    'src/PEAR2/HTTP/Request/Adapter/Phpstream.php' => $rp . '/Request/Adapter/Phpstream.php',
    'src/PEAR2/HTTP/Request/Exception.php' => $rp . '/Request/Exception.php',
    'src/PEAR2/HTTP/Request/Headers.php' => $rp . '/Request/Headers.php',
    'src/PEAR2/HTTP/Request/Response.php' => $rp . '/Request/Response.php',
    'src/PEAR2/HTTP/Request/Uri.php' => $rp . '/Request/Uri.php',
    'src/Net/URL2.php' => '/usr/local/lib/php/Net/URL2.php',
));
exit;
// this shows how it works
function __autoload($class)
{
    if (substr($class, 0, 5) != 'PEAR2') return false;
    $path = explode('_', substr($class, 11)); // strip PEAR2_Pyrus for CVS
    $path = dirname(__FILE__) . implode('/', $path) . '.php';
    include $path;
}
include $a = '/home/cellog/workspace/PEAR2/Exception/trunk/src/Exception.php';
include $b = '/home/cellog/workspace/PEAR2/MultiErrors/trunk/src/MultiErrors.php';
include '/home/cellog/workspace/PEAR2/MultiErrors/trunk/src/MultiErrors/Exception.php';
include '/home/cellog/workspace/PEAR2/Pyrus_Developer/src/Developer/PackageFile/v2.php';
include '/home/cellog/workspace/PEAR2/Pyrus_Developer/src/Developer/PackageFile/PEAR2SVN.php';
include '/home/cellog/workspace/PEAR2/Pyrus_Developer/src/Developer/PackageFile/PEAR2SVN/Filter.php';
//new PEAR2_Pyrus_Developer_PackageFile_PEAR2SVN(
//    '/home/cellog/workspace/PEAR2/Pyrus_Developer', 'PEAR2_Pyrus_Developer', 'pear2.php.net', false, false);
//exit;
//include '/home/cellog/workspace/PEAR2/Pyrus_Developer/Creator/Zip.php';
//include '/home/cellog/workspace/PEAR2/Pyrus_Developer/src/Developer/Creator/Phar.php';
//include '/home/cellog/workspace/PEAR2/Pyrus_Developer/Creator/Xml.php';
//include '/home/cellog/workspace/PEAR2/Pyrus_Developer/src/Developer/Creator/Exception.php';
//$a = new PEAR2_Pyrus_Package_Creator(array(
//        new PEAR2_Pyrus_Developer_Creator_Phar('/home/cellog/workspace/Pyrus/blah.phar',
//            '<?php echo "hi";__HALT_COMPILER();'),
//        new PEAR2_Pyrus_Developer_Creator_Tar('/tmp/blah.tgz'),
//        new PEAR2_Pyrus_Developer_Creator_Xml('/tmp/blah.xml'),
//    ), $a, '/home/cellog/workspace/PEAR2/Autoload/trunk/src/Autoload.php', $b);
//$b = new PEAR2_Pyrus_Package('/home/cellog/workspace/pear-core/PEAR-1.6.2.tgz');
//$a->render($b);
//exit;
define('OS_WINDOWS', false);
define('OS_UNIX', true);
include '/home/cellog/workspace/PEAR2/HTTP_Request/trunk/src/HTTP/Request/allfiles.php';
$g = new PEAR2_Pyrus_Config('/home/cellog/testpear');
try {
    PEAR2_Pyrus_Installer::begin();
    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('/home/cellog/workspace/PEAR2/Autoload/trunk/package.xml'));
    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('/home/cellog/workspace/PEAR2/Exception/trunk/package.xml'));
    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('/home/cellog/workspace/PEAR2/MultiErrors/trunk/package.xml'));
    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('/home/cellog/workspace/PEAR2/Pyrus_Developer/package.xml'));
    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('/home/cellog/workspace/Pyrus/package.xml'));
    PEAR2_Pyrus_Installer::commit();
} catch (Exception $e) {
    PEAR2_Pyrus_Installer::rollback();
    echo $e;
}
exit;
//$g = new PEAR2_Pyrus_Config('C:/development/pear-core/testpear');
$g = new PEAR2_Pyrus_Config('/home/cellog/testpear');
$g->saveConfig();
$g->bin_dir = 'home/cellog/testpear';
//$a = new PEAR2_Pyrus_Package('C:/development/pear-core/PEAR-1.5.0a1.tgz');
$a = new PEAR2_Pyrus_Package('/tmp/blah.tgz');
$b = new PEAR2_Pyrus_Installer;
$b->install($a);<?php
/**
 * PEAR2_Pyrus_AtomicFileTransaction
 *
 * This class implements a simple, nearly atomic way of handling file installation
 * transaction similar to the way a database handles a query transaction.
 *
 * To use, first call {@link PEAR2_Pyrus_AtomicFileTransaction::begin()} and
 * then remove old files with {@link PEAR2_Pyrus_AtomicFileTransaction::removePath()}
 * or install new files with {@link PEAR2_Pyrus_AtomicFileTransaction::createOrOpenPath()}.
 *
 * To abort, use {@link PEAR2_Pyrus_AtomicFileTransaction::rollback()}, and to
 * finish, use {@link PEAR2_Pyrus_AtomicFileTransaction::commit()} followed by
 * {@link PEAR2_Pyrus_AtomicFileTransaction::removeBackups()}.
 *
 * The separation of backup removal from committing allows attempting to modify the
 * registry in between file installation and removal of backups, so that in the
 * worst case, it is easy to completely roll back the file installation without
 * any loss of information, even after the process has terminated.
 *
 * To repair a broken commit or rollback, use
 * {@link PEAR2_Pyrus_AtomicFileTransaction::repair()}.
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Atomic file installation infrastructure, guarantees safe installation.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_AtomicFileTransaction
{
    static protected $allTransactObjects = array();
    static protected $intransaction = false;
    static protected $inrepair = false;
    protected $rolepath;
    protected $journalpath;
    protected $backuppath;
    protected $defaultMode;
    protected $committed = false;

    protected function __construct($rolepath)
    {
        $this->rolepath = $rolepath;
        $this->backuppath = dirname($rolepath) . DIRECTORY_SEPARATOR .
            '.old-' . basename($rolepath);
        $this->journalpath = dirname($rolepath) . DIRECTORY_SEPARATOR .
            '.journal-' . basename($rolepath);
        $this->defaultMode = PEAR2_Pyrus_Config::current()->umask;
    }

    /**
     * Repair from a previously failed transaction cut off mid-transaction
     */
    static function repair()
    {
        if (static::$intransaction) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Cannot repair while in a transaction');
        }
        static::$inrepair = true;
        static::$allTransactObjects = array();
        $config = PEAR2_Pyrus_Config::current();
        $remove = array();
        foreach ($config->systemvars as $var) {
            if (!strpos($var, '_dir')) {
                continue;
            }

            $path = $config->$var;
            $backuppath = dirname($path) . DIRECTORY_SEPARATOR . '.old-' . basename($path);
            if (file_exists($backuppath) && is_dir($backuppath)) {
                if (file_exists($path)) {
                    if (is_dir($path)) {
                        // this is the new stuff from journal path, so move it out of the way
                        $journalpath = dirname($path) . DIRECTORY_SEPARATOR . '.journal-' . basename($path);
                        $remove[] = $journalpath;
                        rename($path, $journalpath);
                    } else {
                        static::$inrepair = false;
                        throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                            'Repair failed - ' . $var . ' path ' . $path .
                            ' is not a directory.  Move this file out of the way and ' .
                            'try the repair again'
                        );
                    }
                }
                // restore backup
                rename($backuppath, $path);
            }
        }
        foreach ($remove as $path) {
            static::rmrf($path);
        }
        static::$inrepair = false;
    }

    /**
     * @param string|PEAR2_Pyrus_Installer_Role_Common $rolepath
     * @return PEAR2_Pyrus_AtomicFileTransaction
     */
    static function getTransactionObject($rolepath)
    {
        if ($rolepath instanceof PEAR2_Pyrus_Installer_Role_Common) {
            $rolepath = PEAR2_Pyrus_Config::current()->{$rolepath->getLocationConfig()};
        }
        if (isset(static::$allTransactObjects[$rolepath])) {
            return static::$allTransactObjects[$rolepath];
        }
        $ret = static::$allTransactObjects[$rolepath] = new PEAR2_Pyrus_AtomicFileTransaction($rolepath);

        if (static::$intransaction) {
            // start the transaction process for this atomic transaction object
            $errs =  new PEAR2_MultiErrors;
            try {
                $ret->beginTransaction();
            } catch (\Exception $e) {
                $errs->E_ERROR[] = $e;
                foreach (static::$allTransactObjects as $path2 => $transact) {
                    try {
                        $transact->removeJournalPath();
                    } catch (\Exception $e2) {
                        $errs->E_WARNING[] = $e2;
                    }
                }
                throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                    'Unable to begin transaction for ' . $rolepath, $errs
                );
            }
        }
        return $ret;
    }

    function removePath($relativepath, $strict = true)
    {
        if (!static::$intransaction) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Cannot remove ' . $relativepath .
                                                                  ' - not in a transaction');
        }
        $path = $this->journalpath . DIRECTORY_SEPARATOR . $relativepath;
        if (!file_exists($path)) {
            return;
        }
        if (is_dir($path)) {
            if (!@rmdir($path) && $strict) {
                throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                    'Cannot remove directory ' . $relativepath . ' in ' . $this->journalpath);
            }
        } else {
            if (!@unlink($path) && $strict) {
                throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                    'Cannot remove file ' . $relativepath . ' in ' . $this->journalpath);
            }
        }
    }

    function mkdir($relativepath, $mode = null)
    {
        if (!static::$intransaction) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Cannot create directory ' . $relativepath .
                                                                  ' - not in a transaction');
        }
        $path = $this->journalpath . DIRECTORY_SEPARATOR . str_replace('/', DIRECTORY_SEPARATOR, $relativepath);
        if (file_exists($path)) {
            if (is_dir($path)) {
                return;
            }
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Cannot create directory ' . $relativepath .
                                                                  ', it is a file');
        }
        if (!@mkdir($path, $mode, true)) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Unable to make directory ' .
                $relativepath . ' in ' . $this->journalpath);
        }
        if ($mode === null) {
            $mode = $this->defaultMode;
        }
        if ($mode) {
            $old = umask(0);
            chmod($path, $mode);
            umask($old);
        }
    }

    /**
     * To perform modifications on a path within the journal transaction
     */
    function openPath($relativepath)
    {
        if (!static::$intransaction) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Cannot open ' . $relativepath .
                                                                  ' - not in a transaction');
        }
        $path = $this->journalpath . DIRECTORY_SEPARATOR . str_replace('/', DIRECTORY_SEPARATOR, $relativepath);
        $fp = @fopen($path, 'rb+');
        if (!$fp) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Unable to open ' .
                $relativepath . ' for writing in ' . $this->journalpath);
        }
        return $fp;
    }

    function createOrOpenPath($relativepath, $contents = null, $mode = null)
    {
        if (!static::$intransaction) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Cannot create ' . $relativepath .
                                                                  ' - not in a transaction');
        }
        if ($mode === null) {
            $mode = $this->defaultMode;
        }
        $path = $this->journalpath . DIRECTORY_SEPARATOR . str_replace('/', DIRECTORY_SEPARATOR, $relativepath);
        if ($contents) {
            if (is_resource($contents)) {
                $fp = @fopen($path, 'wb');
                if (!$fp) {
                    throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Unable to open ' .
                        $relativepath . ' for writing in ' . $this->journalpath);
                }
                if (false === stream_copy_to_stream($contents, $fp)) {
                    fclose($fp);
                    throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Unable to copy to ' .
                        $relativepath . ' in ' . $this->journalpath);
                }
                fclose($fp);
            } else {
                if (!@file_put_contents($path, $contents)) {
                    throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Unable to write to ' .
                        $relativepath . ' in ' . $this->journalpath);
                }
            }
            if ($mode) {
                $old = umask(0);
                chmod($path, $mode);
                umask($old);
            }
            return $path;
        } else {
            $fp = @fopen($path, 'wb');
            if (!$fp) {
                throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Unable to open ' .
                    $relativepath . ' for writing in ' . $this->journalpath);
            }
            if ($mode) {
                $old = umask(0);
                chmod($path, $mode);
                umask($old);
            }
            return $fp;
        }
    }

    /**
     * Remove all empty directories on uninstall
     */
    static function rmEmptyDirs($dirtrees)
    {
        foreach ($dirtrees as $dirtree) {
            foreach ($dirtree as $dir) {
                foreach (static::$allTransactObjects as $path => $obj) {
                    if (0 === strpos($path, $dir)) {
                        // only remove empty directories, don't throw exception on
                        // non-empty directories
                        $obj->rmrf($dir, true, false);
                    }
                }
            }
        }
    }

    static function rmrf($path, $onlyEmptyDirs = false, $strict = true)
    {
        foreach (new RecursiveIteratorIterator(new RecursiveDirectoryIterator($path),
                                               RecursiveIteratorIterator::CHILD_FIRST)
                 as $file) {
            if ($file->getFilename() == '.' || $file->getFilename() == '..') {
                continue;
            }
            if (is_dir($file->getPathname())) {
                if (!rmdir($file->getPathname())) {
                    if (!$strict) {
                        return;
                    }
                    throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                        'Unable to fully remove ' . $path);
                }
            } else {
                if ($onlyEmptyDirs) {
                    if (!$strict) {
                        return;
                    }
                    throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                        'Unable to fully remove ' . $path . ', directory is not empty');
                    return;
                }
                if (!unlink($file->getPathname())) {
                    throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                        'Unable to fully remove ' . $path);
                }
            }
        }
        rmdir($path);
    }

    function copyToJournal()
    {
        try {
            $oldumask = umask();
            umask(000);
            foreach (new RecursiveIteratorIterator(new RecursiveDirectoryIterator($this->rolepath),
                                                   RecursiveIteratorIterator::SELF_FIRST)
                     as $file) {
                if ($file->getFilename() == '.' || $file->getFilename() == '..') {
                    continue;
                }
                $time = $file->getMTime();
                $atime = $file->getATime();
                $perms = $file->getPerms();
                $src = str_replace($this->rolepath . DIRECTORY_SEPARATOR, '', $file->getPathname());
                if (is_dir($file->getPathname())) {
                    if (!mkdir($this->journalpath . DIRECTORY_SEPARATOR . $src, $perms)) {
                        umask($oldumask);
                        throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                            'Unable to complete journal creation for transaction');
                    }
                    if (!touch($this->journalpath . DIRECTORY_SEPARATOR . $src, $time, $atime)) {
                        umask($oldumask);
                        throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                            'Unable to complete journal creation for transaction');
                    }
                    continue;
                }
                if (!copy($file->getPathName(), $this->journalpath . DIRECTORY_SEPARATOR . $src)) {
                    umask($oldumask);
                    throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                        'Unable to complete journal creation for transaction');
                }
                if (!touch($this->journalpath . DIRECTORY_SEPARATOR . $src, $time, $atime)) {
                    umask($oldumask);
                    throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                        'Unable to complete journal creation for transaction');
                }
                if (!chmod($this->journalpath . DIRECTORY_SEPARATOR . $src, $perms)) {
                    umask($oldumask);
                    throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                        'Unable to complete journal creation for transaction');
                }
            }
            umask($oldumask);
        } catch (\UnexpectedValueException $e) {
            // directory does not exist, so we ignore the exception and reset umask
            umask($oldumask);
            return;
        }
    }

    static function begin()
    {
        if (static::$intransaction) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Cannot begin - already in a transaction');
        }
        $errs = new PEAR2_MultiErrors;
        try {
            foreach (static::$allTransactObjects as $path => $transact) {
                $transact->beginTransaction();
            }
            static::$intransaction = true;
        } catch (\Exception $e) {
            static::$intransaction = true;
            $errs->E_ERROR = $e;
            $exit = false;
            foreach (static::$allTransactObjects as $path2 => $transact) {
                if ($exit) {
                    break;
                }
                if ($path2 === $path) {
                    $exit = true;
                }
                try {
                    $transact->removeJournalPath();
                } catch (\Exception $e2) {
                    $errs->E_WARNING[] = $e2;
                }
            }
        }
        if (count($errs)) {
            static::$intransaction = false;
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                'Unable to begin transaction', $errs
            );
        }
    }

    function beginTransaction()
    {
        if (!file_exists($this->journalpath)) {
create_journal:
            @mkdir($this->journalpath, 0755, true);
            if (!file_exists($this->journalpath)) {
                throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                    'unrecoverable transaction error: cannot create journal path ' . $this->journalpath);
            }
            $this->copyToJournal();
        } elseif (!is_dir($this->journalpath)) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                'unrecoverable transaction error: journal path ' . $this->journalpath .
                ' exists and is not a directory');
        } else {
            $this->rmrf($this->journalpath);
            goto create_journal;
        }
    }

    static function rollback()
    {
        if (!static::$intransaction) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Cannot rollback - not in a transaction');
        }
        foreach (static::$allTransactObjects as $transaction) {
            // restore the original source as quickly as possible
            $transaction->restoreBackup();
        }
        $failed = array();
        $errs = new PEAR2_MultiErrors;
        foreach (static::$allTransactObjects as $path => $transaction) {
            try {
                // ... and then delete the transaction
                $transaction->removeJournalPath();
            } catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
                $errs->E_WARNING[] = $e;
            }
        }
        static::$intransaction = false;
        if (count($errs)) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Warning: rollback did not succeed for all transactions',
                                                                  $errs);
        }
    }

    function restoreBackup()
    {
        if (!$this->committed) {
            return;
        }
        if (!file_exists($this->rolepath)) {
            rename($this->backuppath, $this->rolepath);
        } elseif (!file_exists($this->journalpath) && file_exists($this->rolepath)  && file_exists($this->backuppath)) {
            rename($this->rolepath, $this->journalpath);
            rename($this->backuppath, $this->rolepath);
        }
    }

    function removeJournalPath()
    {
        if (!static::$intransaction) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Cannot remove journal path - not in a transaction');
        }
        if (!file_exists($this->journalpath) || !is_dir($this->journalpath)) {
            return;
        }
        $this->rmrf($this->journalpath);
    }

    static function commit()
    {
        if (!static::$intransaction) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Cannot commit - not in a transaction');
        }
        $errs = new PEAR2_MultiErrors;
        try {
            foreach (static::$allTransactObjects as $transaction) {
                $transaction->backupAndCommit();
            }
        } catch (\Exception $e) {
            $errs->E_ERROR[] = $e;
            static::rollback();
        }
        if (count($errs->E_ERROR)) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('ERROR: commit failed',
                                                                  $errs);
        } elseif (count($errs->E_WARNING)) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Warning: removal of backups did not succeed',
                                                                  $errs);
        }
    }

    static function removeBackups()
    {
        if (!static::$intransaction) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Cannot remove backups - not in a transaction');
        }
        $errs = new PEAR2_MultiErrors;
        foreach (static::$allTransactObjects as $path => $transaction) {
            try {
                $transaction->removeBackup();
            } catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
                $errs->E_WARNING[] = $e;
            }
        }
        if (count($errs->E_WARNING)) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Warning: removal of backups did not succeed',
                                                                  $errs);
        }
        static::$intransaction = false;
    }

    function removeBackup()
    {
        if ($this->committed && file_exists($this->backuppath)) {
            $this->rmrf($this->backuppath);
        }
    }

    function backupAndCommit()
    {
        if (!static::$intransaction) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception('Cannot commit - not in a transaction');
        }
        if (file_exists($this->backuppath) || (file_exists($this->rolepath) && !rename($this->rolepath, $this->backuppath))) {
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                'CRITICAL - unable to complete transaction, rename of actual to backup path failed');
        }
        // here is the only critical moment - a failure in between these two renames
        // leaves us with no source
        if (!rename($this->journalpath, $this->rolepath)) {
            rename($this->backuppath, $this->rolepath);
            throw new PEAR2_Pyrus_AtomicFileTransaction_Exception(
                'CRITICAL - unable to complete transaction, rename of journal to actual path failed');
        }
        $this->committed = true;
    }
}<?php
/**
 * PEAR2_Pyrus_IRegistry
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Interface for a PEAR2 Pyrus managed installation registry
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
interface PEAR2_Pyrus_IRegistry
{
    public function install(PEAR2_Pyrus_IPackageFile $info, $replace = false);
    /**
     * Used by the registry package classes to update info in an installed package
     */
    public function replace(PEAR2_Pyrus_IPackageFile $info);
    public function uninstall($name, $channel);
    public function exists($package, $channel);
    public function info($package, $channel, $field);
    public function listPackages($channel);
    public function __get($var);
    /**
     * @return PEAR2_Pyrus_IPackageFile
     */
    public function toPackageFile($package, $channel);
    /**
     * Retrieve a list of package objects that depend on this package
     */
    public function getDependentPackages(PEAR2_Pyrus_IPackageFile $package);
    /**
     * Detect any files already installed that would be overwritten by
     * files inside the package represented by $package
     */
    public function detectFileConflicts(PEAR2_Pyrus_IPackageFile $package);
    /**
     * Returns a list of registries present in the PEAR installation at $path
     * @param string
     * @return array
     */
    static public function detectRegistries($path);
    /**
     * Completely remove all traces of a registry
     */
    static public function removeRegistry($path);
}
<?php
/**
 * PEAR2_Pyrus_Validate
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to version 3.0 of the PHP license
 * that is available through the world-wide-web at the following URI:
 * http://www.php.net/license/3_0.txt.  If you did not receive a copy of
 * the PHP License and are unable to obtain it through the web, please
 * send a note to license@php.net so we can mail you a copy immediately.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Validation class for package.xml - channel-level advanced validation
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Validate
{
/**#@+
 * Constants for install stage
 */
    const INSTALLING = 1;
    const UNINSTALLING = 2; // this is not bit-mapped like the others
    const NORMAL = 3;
    const DOWNLOADING = 4; // this is not bit-mapped like the others
    const PACKAGING = 7;
/**#@-*/
    var $packageregex = '[A-Za-z][a-zA-Z0-9_]+';
    /**
     * @var PEAR2_Pyrus_IPackageFile
     */
    var $_packagexml;
    /**
     * @var PEAR2_Pyrus_IChannelFile
     */
    var $channel;
    /**
     * @var int one of the PEAR2_Pyrus_Validate::* constants
     */
    var $_state = PEAR2_Pyrus_Validate::NORMAL;
    /**
     * @var PEAR2_MultiErrors
     */
    protected $failures;

    /**
     * Override this method to handle validation of normal package names
     * @param string
     * @return bool
     * @access protected
     */
    protected function _validPackageName($name)
    {
        return (bool) preg_match('/^' . $this->packageregex . '$/', $name);
    }

    /**
     * @param string package name to validate
     * @param string name of channel-specific validation package
     * @final
     */
    final function validPackageName($name, $validatepackagename = false)
    {
        if ($validatepackagename) {
            if (strtolower($name) == strtolower($validatepackagename)) {
                return (bool) preg_match('/^[a-zA-Z0-9_]+(?:\.[a-zA-Z0-9_]+)*$/', $name);
            }
        }
        return $this->_validPackageName($name);
    }

    /**
     * This validates a bundle name, and bundle names must conform
     * to the PEAR naming convention, so the method is final and static.
     * @param string
     * @final
     * @static
     */
    static final function validGroupName($name)
    {
        return (bool) preg_match('/^[A-Za-z][a-zA-Z0-9_]+$/', $name);
    }

    /**
     * Determine whether $state represents a valid stability level
     * @param string
     * @return bool
     * @static
     * @final
     */
    static final function validState($state)
    {
        return in_array($state, array('snapshot', 'devel', 'alpha', 'beta', 'stable'));
    }

    /**
     * Get a list of valid stability levels
     * @return array
     * @static
     * @final
     */
    static final function getValidStates()
    {
        return array('snapshot', 'devel', 'alpha', 'beta', 'stable');
    }

    /**
     * Determine whether a version is a properly formatted version number that can be used
     * by version_compare
     * @param string
     * @return bool
     * @static
     * @final
     */
    static final function validVersion($ver)
    {
        return (bool) preg_match('/^\d+(?:\.\d+)*(?:[a-zA-Z]+\d*)?$/', $ver);
    }

    /**
     * @param PEAR2_Pyrus_IPackageFile
     */
    function setPackageFile(PEAR2_Pyrus_IPackageFile $pf)
    {
        $this->_packagexml = $pf;
    }

    function setChannel(PEAR2_Pyrus_IChannelFile $chan)
    {
        $this->channel = $chan;
    }

    /**
     * @access private
     */
    protected function _addFailure($field, $reason)
    {
        $this->failures->E_ERROR[] =
            new PEAR2_Pyrus_Validate_Exception($reason, $field);
    }

    /**
     * @access private
     */
    protected function _addWarning($field, $reason)
    {
        $this->failures->E_WARNING[] =
            new PEAR2_Pyrus_Validate_Exception($reason, $field);
    }

    function getFailures()
    {
        return $this->failures;
    }

    /**
     * @param int one of the PEAR2_Pyrus_Validate::* constants
     */
    function validate($state = null)
    {
        if (!isset($this->_packagexml)) {
            return false;
        }
        if ($state !== null) {
            $this->_state = $state;
        }
        $this->failures = new PEAR2_MultiErrors;
        $this->validatePackageName();
        $this->validateVersion();
        $this->validateMaintainers();
        $this->validateDate();
        $this->validateSummary();
        $this->validateDescription();
        $this->validateLicense();
        $this->validateNotes();
        $this->validateTime();
        $this->validateStability();
        $this->validateDependencies();
        $this->validateMainFilelist();
        $this->validateReleaseFilelist();
        //$this->validateGlobalTasks();
        $this->validateChangelog();
        return !((bool) count($this->failures->E_ERROR));
    }

    /**
     * @access protected
     */
    function validatePackageName()
    {
        if ($this->_state == PEAR2_Pyrus_Validate::PACKAGING ||
              $this->_state == PEAR2_Pyrus_Validate::NORMAL) {
            if ($this->_packagexml->extends) {
                $version = $this->_packagexml->version['release'] . '';
                $name = $this->_packagexml->name;
                $test = array_shift($a = explode('.', $version));
                if ($test == '0') {
                    return true;
                }
                $vlen = strlen($test);
                $majver = substr($name, strlen($name) - $vlen);
                while ($majver && !is_numeric($majver{0})) {
                    $majver = substr($majver, 1);
                }
                if ($majver != $test) {
                    $this->_addWarning('package', "package $name extends package " .
                        $this->_packagexml->extends . ' and so the name should ' .
                        'have a postfix equal to the major version like "' .
                        $this->_packagexml->extends . $test . '"');
                    return true;
                } elseif (substr($name, 0, strlen($name) - $vlen) !=
                            $this->_packagexml->extends) {
                    $this->_addWarning('package', "package $name extends package " .
                        $this->_packagexml->extends . ' and so the name must ' .
                        'be an extension like "' . $this->_packagexml->extends .
                        $test . '"');
                    return true;
                }
            }
        }
        $vpackage = $this->channel->getValidationPackage();
        if ($this->validPackageName($this->_packagexml->name, $vpackage['_content'])) {
            return true;
        }
        $this->_addFailure('package', 'package name "' .
            $this->_packagexml->name . '" is invalid');
        return false;
    }

    /**
     * @access protected
     */
    function validateVersion()
    {
        if ($this->_packagexml->stability['release'] == 'snapshot') {
            // allow any version
            return true;
        }
        if ($this->_state != PEAR2_Pyrus_Validate::PACKAGING) {
            if (!$this->validVersion($this->_packagexml->version['release'])) {
                $this->_addFailure('version',
                    'Invalid version number "' . $this->_packagexml->version['release'] . '"');
                return false;
            }
        }
        $version = $this->_packagexml->version['release'];
        $versioncomponents = explode('.', $version);
        if (count($versioncomponents) != 3) {
            $this->_addWarning('version',
                'A version number should have 3 decimals (x.y.z)');
            return true;
        }
        $name = $this->_packagexml->name;
        // version must be based upon state
        switch ($this->_packagexml->stability['release']) {
            case 'devel' :
                if ($versioncomponents[0] . 'a' == '0a') {
                    return true;
                }
                if ($versioncomponents[0] == 0) {
                    $versioncomponents[0] = '0';
                    $this->_addWarning('version',
                        'version "' . $version . '" should be "' .
                        implode('.' ,$versioncomponents) . '"');
                } else {
                    $this->_addWarning('version',
                        'packages with devel stability must be < version 1.0.0');
                }
                return true;
            break;
            case 'alpha' :
            case 'beta' :
                // check for a package that extends a package,
                // like Foo and Foo2
                if ($this->_state == PEAR2_Pyrus_Validate::PACKAGING) {
                    if (substr($versioncomponents[2], 1, 2) == 'rc') {
                        $this->_addFailure('version', 'Release Candidate versions ' .
                            'must have capital RC, not lower-case rc');
                        return false;
                    }
                }
                if (!$this->_packagexml->extends) {
                    if ($versioncomponents[0] == '1') {
                        if ($versioncomponents[2]{0} == '0') {
                            if ($versioncomponents[2] == '0') {
                                // version 1.*.0000
                                $this->_addWarning('version',
                                    'version 1.' . $versioncomponents[1] .
                                        '.0 probably should not be alpha or beta');
                                return true;
                            } elseif (strlen($versioncomponents[2]) > 1 && !is_numeric($versioncomponents[2])) {
                                // version 1.*.0RC1 or 1.*.0beta24 etc.
                                return true;
                            } else {
                                // version 1.*.001 or something
                                $this->_addWarning('version',
                                    'version 1.' . $versioncomponents[1] .
                                        '.' . $versioncomponents[2] . ' probably should not be alpha or beta');
                                return true;
                            }
                        } else {
                            $this->_addWarning('version',
                                'bugfix versions (1.3.x where x > 0) probably should ' .
                                'not be alpha or beta');
                            return true;
                        }
                    } elseif ($versioncomponents[0] != '0') {
                        $this->_addWarning('version',
                            'major versions greater than 1 are not allowed for packages ' .
                            'without an <extends> tag or an identical postfix (foo2 v2.0.0)');
                        return true;
                    }
                    if ($versioncomponents[0] . 'a' == '0a') {
                        return true;
                    }
                    if ($versioncomponents[0] == 0) {
                        $versioncomponents[0] = '0';
                        $this->_addWarning('version',
                            'version "' . $version . '" should be "' .
                            implode('.' ,$versioncomponents) . '"');
                    }
                } else {
                    $vlen = strlen($versioncomponents[0] . '');
                    $majver = substr($name, strlen($name) - $vlen);
                    while ($majver && !is_numeric($majver{0})) {
                        $majver = substr($majver, 1);
                    }
                    if (($versioncomponents[0] != 0) && $majver != $versioncomponents[0]) {
                        $this->_addWarning('version', 'first version number "' .
                            $versioncomponents[0] . '" must match the postfix of ' .
                            'package name "' . $name . '" (' .
                            $majver . ')');
                        return true;
                    }
                    if ($versioncomponents[0] == $majver) {
                        if ($versioncomponents[2]{0} == '0') {
                            if ($versioncomponents[2] == '0') {
                                // version 2.*.0000
                                $this->_addWarning('version',
                                    "version $majver." . $versioncomponents[1] .
                                        '.0 probably should not be alpha or beta');
                                return false;
                            } elseif (strlen($versioncomponents[2]) > 1 && !is_numeric($versioncomponents[2])) {
                                // version 2.*.0RC1 or 1.*.0beta24 etc.
                                return true;
                            } else {
                                // version 2.*.001 or something
                                $this->_addWarning('version',
                                    'version ' . $version . ' probably should not be alpha or beta');
                                return true;
                            }
                        } else {
                            $this->_addWarning('version',
                                "bugfix versions ($majver.x.y where y > 0) should " .
                                'not be alpha or beta');
                            return true;
                        }
                    }
                    if ($versioncomponents[0] . 'a' == '0a') {
                        return true;
                    }
                    if ($versioncomponents[0] == 0) {
                        $versioncomponents[0] = '0';
                        $this->_addWarning('version',
                            'version "' . $version . '" should be "' .
                            implode('.' ,$versioncomponents) . '"');
                    }
                }
                return true;
            break;
            case 'stable' :
                if ($versioncomponents[0] == '0') {
                    $this->_addWarning('version', 'versions less than 1.0.0 cannot ' .
                    'be stable');
                    return true;
                }
                if (!is_numeric($versioncomponents[2])) {
                    if (preg_match('/\d+(rc|a|alpha|b|beta)\d*/i',
                          $versioncomponents[2])) {
                        $this->_addWarning('version', 'version "' . $version . '" or any ' .
                            'RC/beta/alpha version cannot be stable');
                        return true;
                    }
                }
                // check for a package that extends a package,
                // like Foo and Foo2
                if ($this->_packagexml->extends) {
                    $vlen = strlen($versioncomponents[0] . '');
                    $majver = substr($name, strlen($name) - $vlen);
                    while ($majver && !is_numeric($majver{0})) {
                        $majver = substr($majver, 1);
                    }
                    if (($versioncomponents[0] != 0) && $majver != $versioncomponents[0]) {
                        $this->_addWarning('version', 'first version number "' .
                            $versioncomponents[0] . '" must match the postfix of ' .
                            'package name "' . $name . '" (' .
                            $majver . ')');
                        return true;
                    }
                } elseif ($versioncomponents[0] > 1) {
                    $this->_addWarning('version', 'major version x in x.y.z may not be greater than ' .
                        '1 for any package that does not have an <extends> tag');
                }
                return true;
            break;
            default :
                return false;
            break;
        }
    }

    /**
     * @access protected
     */
    function validateMaintainers()
    {
        // maintainers can only be truly validated server-side for most channels
        // but allow this customization for those who wish it
        return true;
    }

    /**
     * @access protected
     */
    function validateDate()
    {
        if ($this->_state == PEAR2_Pyrus_Validate::NORMAL ||
              $this->_state == PEAR2_Pyrus_Validate::PACKAGING) {

            if (!preg_match('/(\d\d\d\d)\-(\d\d)\-(\d\d)/',
                  $this->_packagexml->date, $res) ||
                  count($res) < 4
                  || !checkdate($res[2], $res[3], $res[1])
                ) {
                $this->_addFailure('date', 'invalid release date "' .
                    $this->_packagexml->date . '"');
                return false;
            }


            if ($this->_state == PEAR2_Pyrus_Validate::PACKAGING &&
                  $this->_packagexml->date != date('Y-m-d')) {
                $this->_addWarning('date', 'Release Date "' .
                    $this->_packagexml->date . '" is not today');
            }
        }
        return true;
    }

    /**
     * @access protected
     */
    function validateTime()
    {
        if (!$this->_packagexml->time) {
            // default of no time value set
            return true;
        }
        // packager automatically sets time, so only validate if
        // pear validate is called
        if ($this->_state = PEAR2_Pyrus_Validate::NORMAL) {
            if (!preg_match('/\d\d:\d\d:\d\d/',
                  $this->_packagexml->time)) {
                $this->_addFailure('time', 'invalid release time "' .
                    $this->_packagexml->time . '"');
                return false;
            }
            if (strtotime($this->_packagexml->time) == -1) {
                $this->_addFailure('time', 'invalid release time "' .
                    $this->_packagexml->time . '"');
                return false;
            }
        }
        return true;
    }

    /**
     * @access protected
     */
    function validateStability()
    {
        $ret = true;
        $packagestability = $this->_packagexml->stability['release'];
        $apistability = $this->_packagexml->stability['api'];
        if (!self::validState($packagestability)) {
            $this->_addFailure('state', 'invalid release stability "' .
                $this->_packagexml->stability['release'] . '", must be one of: ' .
                implode(', ', self::getValidStates()));
            $ret = false;
        }
        $apistates = self::getValidStates();
        array_shift($apistates); // snapshot is not allowed
        if (!in_array($apistability, $apistates)) {
            $this->_addFailure('state', 'invalid API stability "' .
                $this->_packagexml->stability['api'] . '", must be one of: ' .
                implode(', ', $apistates));
            $ret = false;
        }
        return $ret;
    }

    /**
     * @access protected
     */
    function validateSummary()
    {
        return true;
    }

    /**
     * @access protected
     */
    function validateDescription()
    {
        return true;
    }

    /**
     * @access protected
     */
    function validateLicense()
    {
        return true;
    }

    /**
     * @access protected
     */
    function validateNotes()
    {
        return true;
    }

    /**
     * for package.xml 2.0 only - channels can't use package.xml 1.0
     * @access protected
     */
    function validateDependencies()
    {
        return true;
    }

    /**
     * for package.xml 2.0 only
     * @access protected
     */
    function validateMainFilelist()
    {
        return true; // placeholder for now
    }

    /**
     * for package.xml 2.0 only
     * @access protected
     */
    function validateReleaseFilelist()
    {
        return true; // placeholder for now
    }

    /**
     * @access protected
     */
    function validateChangelog()
    {
        return true;
    }
}
?>
<?php
/**
 * PEAR2_Pyrus_IFileTransaction
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Interface for file transactions
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
interface PEAR2_Pyrus_IFileTransaction
{
    public function check($data, &$errors);
    public function commit($data, &$errors);
    public function rollback($data, &$errors);
    public function cleanup();
}<?php
/**
 * PEAR2_Pyrus_ChannelRegistry
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Base class for Pyrus.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_ChannelRegistry implements ArrayAccess, IteratorAggregate, PEAR2_Pyrus_IChannelRegistry
{
    /**
     * Class to instantiate for singleton.
     *
     * This is useful for unit-testing and for extending the registry
     * @var string
     */
    static public $className = 'PEAR2_Pyrus_ChannelRegistry';
    /**
     * The parent registry
     *
     * This is used to implement cascading registries
     * @var PEAR2_Pyrus_ChannelRegistry
     */
    protected $parent;
    protected $path;
    protected $readonly;
    private $_registries = array();

    public function __construct($path, $registries = array('Sqlite3', 'Xml'), $readonly = false)
    {
        $this->path = $path;
        $this->readonly = $readonly;
        $exceptions = array();
        foreach ($registries as $registry) {
            try {
                $registry = ucfirst($registry);
                $registry = "PEAR2_Pyrus_ChannelRegistry_$registry";
                if (!class_exists($registry, true)) {
                    $exceptions[] = new PEAR2_Pyrus_ChannelRegistry_Exception(
                        'Unknown channel registry type: ' . $registry);
                    continue;
                }
                $this->_registries[] = new $registry($path, $readonly);
            } catch (PEAR2_Pyrus_ChannelRegistry_Exception $e) {
                $exceptions[] = $e;
            }
        }
        if (!count($this->_registries)) {
            throw new PEAR2_Pyrus_Registry_Exception(
                'Unable to initialize registry for path "' . $path . '"',
                $exceptions);
        }
    }

    public function setParent(PEAR2_Pyrus_ChannelRegistry $parent = null)
    {
        $this->parent = $parent;
    }

    /**
     * Add a channel to the registry.
     *
     * @param PEAR2_Pyrus_IChannel $channel Channel to add.
     */
    public function add(PEAR2_Pyrus_IChannel $channel, $update = false, $lastmodified = false)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot add channel, registry is read-only');
        }
        foreach ($this->_registries as $reg) {
            $reg->add($channel, $update, $lastmodified);
        }
    }

    public function update(PEAR2_Pyrus_IChannel $channel)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot update channel, registry is read-only');
        }
        foreach ($this->_registries as $reg) {
            $reg->update($channel);
        }
    }

    public function delete(PEAR2_Pyrus_IChannel $channel)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot delete channel, registry is read-only');
        }
        switch ($channel->name) {
            case 'pear.php.net' :
            case 'pear2.php.net' :
            case 'pecl.php.net' :
            case '__uri' :
                throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot delete default channel ' .
                    $channel->name);
        }
        foreach ($this->_registries as $reg) {
            $reg->delete($channel);
        }
    }

    public function get($channel, $strict = true)
    {
        try {
            return $this->_registries[0]->get($channel, $strict);
        } catch (Exception $e) {
            // don't fail on the default channels, these should always exist
            switch ($channel) {
                case 'pear.php.net' :
                    return $this->_registries[0]->getPearChannel();
                case 'pear2.php.net' :
                    return $this->_registries[0]->getPear2Channel();
                case 'pecl.php.net' :
                    return $this->_registries[0]->getPeclChannel();
                case '__uri' :
                    return $this->_registries[0]->getUriChannel();
            }
            throw $e;
        }
    }

    /**
     * Check if channel has been discovered and in the registry.
     *
     * @param string $channel Channel name or alias: pear.php.net, pear
     * @param bool   $strict  Do not check aliases.
     * 
     * @return bool
     */
    public function exists($channel, $strict = true)
    {
        if (!$this->_registries[0]->exists($channel, $strict)) {
            switch ($channel) {
                case 'pear.php.net' :
                case 'pear2.php.net' :
                case 'pecl.php.net' :
                case '__uri' :
                    return true;
            }
            if (!$strict) {
                switch ($channel) {
                    case 'pear' :
                    case 'pear2' :
                    case 'pecl' :
                        return true;
                }
            }
            return false;
        }
        return true;
    }

    public function parseName($name, $defaultChannel = 'pear2.php.net')
    {
        foreach ($this->_registries as $reg) {
            try {
                return $reg->parseName($name, $defaultChannel);
            } catch (Exception $e) {
                continue;
            }
        }
        if ($this->parent) {
            return $this->parent->parseName($name, $defaultChannel);
        }
        // recycle last exception
        throw new PEAR2_Pyrus_ChannelRegistry_Exception('Unable to process package name', $e);
    }

    public function parsedNameToString($name)
    {
        foreach ($this->_registries as $reg) {
            try {
                return $reg->parsedNameToString($name);
            } catch (Exception $e) {
                continue;
            }
        }
        if ($this->parent) {
            return $this->parent->parsedNameToString($name);
        }
        // recycle last exception
        throw new PEAR2_Pyrus_ChannelRegistry_Exception('Unable to convert to package name string', $e);
    }

    public function listChannels()
    {
        return $this->_registries[0]->listChannels();
    }

    public function offsetGet($offset)
    {
        return $this->get($offset);
    }

    public function offsetSet($offset, $value)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot add channel, registry is read-only');
        }
        if ($value instanceof PEAR2_Pyrus_IChannelFile) {
            $value = new PEAR2_Pyrus_Channel($value);
        }
        foreach ($this->_registries as $reg) {
            $reg->add($value);
        }
    }

    public function offsetExists($offset)
    {
        return $this->exists($offset);
    }

    public function offsetUnset($offset)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot delete channel, registry is read-only');
        }
        $chan = $this->get($offset, false);
        foreach ($this->_registries as $reg) {
            $reg->delete($chan);
        }
    }

    public function __call($method, $args)
    {
        return call_user_func_array(array($this->_registries[0], $method), $args);
    }

    public function getIterator()
    {
        return $this->_registries[0];
    }

    public function getParent()
    {
        return $this->parent;
    }

    public function getPath()
    {
        return $this->path;
    }
}
<?php
/**
 * PEAR2_Pyrus_Config_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for Pyrus configuration
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Config_Exception extends PEAR2_Exception {}<?php
/**
 * PEAR2_Pyrus_Config
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Pyrus's master configuration manager
 *
 * Unlike PEAR version 1.x, the new Pyrus configuration manager is tightly bound
 * to include_path, and will search through include_path for system configuration
 * Pyrus installations.
 *
 * The User configuration file will be looked for in these locations:
 *
 * Unix:
 *
 * - home directory
 * - current directory
 *
 * Windows:
 *
 * - local settings directory on windows for the current user.
 *   This is looked up directly in the windows registry using COM
 * - current directory
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Config_Snapshot extends PEAR2_Pyrus_Config
{
    /**
     * parse a configuration for a PEAR2 installation
     *
     * @param string $pearDirectory This can be either a single path, or a
     *                              PATH_SEPARATOR-separated list of directories
     * @param string $userfile
     */
    public function __construct($snapshot, PEAR2_Pyrus_Config $config = null)
    {
        self::constructDefaults();
        if (!$config) {
            $config = PEAR2_Pyrus_Config::current();
        }
        $this->loadConfigFile($config->path, $snapshot);
        $this->pearDir = $config->path;
    }

    /**
     * Extract configuration from system + user configuration files
     *
     * Configuration is stored in XML format, in two locations.
     *
     * The system configuration contains all of the important directory
     * configuration variables like data_dir, and the location of php.ini and
     * the php executable php.exe or php.  This configuration is tightly bound
     * to the repository, and cannot be moved.  As such, php_dir is auto-defined
     * as dirname(/path/to/pear/.config), or /path/to/pear.
     *
     * Only 1 user configuration file is allowed, and contains user-specific
     * settings, including the locations where to download package releases
     * and where to cache files downloaded from the internet.  If false is passed
     * in, PEAR2_Pyrus_Config will attempt to guess at the config file location as
     * documented in the class docblock {@link PEAR2_Pyrus_Config}.
     * @param string $pearDirectory
     * @param string|false $userfile
     */
    protected function loadConfigFile($pearDirectory, $snapshot = null)
    {
        if (!file_exists($pearDirectory . DIRECTORY_SEPARATOR . '.configsnapshots')) {
            // no configurations - this may be an extracted-from-disk install.
            // in this case, we use the defaults, as this is intended
            return;
        }
        $snapshotdir = $pearDirectory . DIRECTORY_SEPARATOR . '.configsnapshots';
        $snapshotfile = $snapshotdir . DIRECTORY_SEPARATOR . $snapshot;
        if (!file_exists($snapshotfile)) {
            if (preg_match('/^\\d{4}\\-\\d{2}\\-\\d{2} \\d{2}:\\d{2}:\\d{2}$/', $snapshot)) {
                // passed a date, locate a matching snapshot
                $us = new DateTime($snapshot);
                $dir = new RegexIterator(
                    new RecursiveDirectoryIterator($snapshotdir), '/configsnapshot\\-\\d{4}\\-\\d{2}\\-\\d{2} \\d{2}:\\d{2}:\\d{2}.xml/',
                    RegexIterator::MATCH,
                    RegexIterator::USE_KEY);
                foreach ($dir as $match) {
                    $matches[] = $match;
                }
                usort($matches, array($this, 'datediff'));
                unset($match);
                foreach ($matches as $match) {
                    $match = substr($match->getFileName(), strlen('configsnapshot-'));
                    $match = str_replace('.xml', '', $match);
                    $diff = $us->diff(new DateTime($match))->format("%r%s");
                    if (!$diff) {
                        // found a snapshot match
                        break;
                    }
                    if (!isset($last)) {
                        if ($diff > 0) {
                            // oldest snapshot is newer than us, resort to default config
                            return parent::loadConfigFile($pearDirectory);
                        }
                        $last = $match;
                        continue;
                    }

                    if ($diff < 0) {
                        $last = $match;
                        continue;
                    }
                    // the current snapshot is newer than our install
                    // the last snapshot was the one we used
                    $match = $last;
                    break;
                }
                if (!isset($match)) {
                    // no config snapshots
                    return parent::loadConfigFile($pearDirectory);
                }
                $snapshotfile = $snapshotdir . DIRECTORY_SEPARATOR . 'configsnapshot-' .
                    $match . '.xml';
            }
            if (!file_exists($snapshotfile)) {
                throw new PEAR2_Pyrus_Config_Exception('Cannot retrieve non-existent config ' .
                                                   'snapshot ' . $snapshot);
            }
        }

        PEAR2_Pyrus_Log::log(5, 'Loading configuration snapshot ' .
                             $snapshotfile . ' for ' . $pearDirectory);
        try {
            $this->helperLoadConfigFile($pearDirectory, $snapshotfile, 'snapshot');
        } catch (Exception $e) {
            // no config snapshots found, so simply load the existing config
            return parent::loadConfigFile($pearDirectory);
        }
    }

    function datediff($a, $b)
    {
        $us = new DateTime($a);
        $diff = $us->diff(new DateTime($match))->format("%r%s");
        if (!$diff) return 0;
        if ($diff > 0) return 1;
        return -1;
    }

    /**
     * Save both the user configuration file and the system file
     *
     * If the userfile is not passed in, it is saved in the default
     * location which is either in ~/.pear/pearconfig.xml or on Windows
     * in the Documents and Settings directory
     * @param string $userfile path to alternate user configuration file
     */
    function saveConfig($userfile = false)
    {
    }

    /**
     * Save a snapshot of the current config, and return the file name
     *
     * If the latest snapshot is the same as the existing configuration,
     * simply return the filename
     * @return string basename of the snapshot file of the current configuration
     */
    static public function configSnapshot()
    {
    }
}
<?php
/**
 * Channel Validator for the pecl.php.net channel
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Channel Validator for the pecl.php.net channel
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Validator_PECL extends PEAR2_Pyrus_Validate
{
    function validateVersion()
    {
        if ($this->_state == PEAR2_Pyrus_Validate::PACKAGING) {
            $version = $this->_packagexml->version['release'];
            $versioncomponents = explode('.', $version);
            $last = array_pop($versioncomponents);
            if (substr($last, 1, 2) == 'rc') {
                $this->_addFailure('version', 'Release Candidate versions must have ' .
                'upper-case RC, not lower-case rc');
                return false;
            }
        }
        return true;
    }

    function validatePackageName()
    {
        $ret = parent::validatePackageName();
        if (in_array($this->_packagexml->getPackageType(), array('extsrc', 'zendextsrc'))) {
            $package  = $this->_packagexml->name;
            $provides = $this->_packagexml->providesextension;
            if (strtolower($package) != strtolower($provides)) {
                $this->_addWarning('providesextension', 'package name "' .
                    $package . '" is different from extension name "' .
                    $provides . '"');
            }
        }

        return $ret;
    }
}<?php
/**
 * PEAR2_Pyrus_DirectedGraph
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Implements a graph data type, used for topological sorting of packages.
 *
 * This structure allows us to sort dependencies into the correct order for installation.
 * Iteration uses a depth-first search to perform a topological sort.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_DirectedGraph implements Iterator
{
    const WHITE = 0;
    const GRAY = 1;
    const BLACK = 2;
    protected $vertices = array();
    /**
     * Map data to abstract vertex
     *
     * @var array
     */
    protected $map = array();
    /**
     * Topologically sorted vertices
     * @var array
     */
    protected $blackVertices = array();

    /**
     * Add a data vertex
     *
     * @param object $data
     * @return PEAR2_Pyrus_DirectedGraph_Vertex
     */
    function add($data)
    {
        $vertex = new PEAR2_Pyrus_DirectedGraph_Vertex($data);
        $this->vertices[spl_object_hash($vertex)] = $vertex;
        $this->map[spl_object_hash($data)] = spl_object_hash($vertex);
        return $vertex;
    }

    /**
     * Connect two vertices in a directed graph
     *
     * This can be used with a fluent interface
     * @param object|PEAR2_Pyrus_DirectedGraph_Vertex $from
     * @param object|PEAR2_Pyrus_DirectedGraph_Vertex $to
     * @return PEAR2_Pyrus_DirectedGraph
     */
    function connect($from, $to)
    {
        if ($from instanceof PEAR2_Pyrus_DirectedGraph_Vertex) {
            $a = spl_object_hash($from);
        } else {
            if (!isset($this->map[spl_object_hash($from)])) {
                $a = $this->add($from);
            } else {
                $a = $this->vertices[$this->map[spl_object_hash($from)]];
            }
        }
        if ($to instanceof PEAR2_Pyrus_DirectedGraph_Vertex) {
            $b = spl_object_hash($to);
        } else {
            if (!isset($this->map[spl_object_hash($to)])) {
                $b = $this->add($to);
            } else {
                $b = $this->vertices[$this->map[spl_object_hash($to)]];
            }
        }
        $this->vertices[spl_object_hash($a)]->connect($b);
        return $this;
    }

    function current()
    {
        return current($this->blackVertices)->data;
    }

    function next()
    {
        return next($this->blackVertices);
    }

    function key()
    {
        return key($this->blackVertices);
    }

    function valid()
    {
        return current($this->blackVertices);
    }

    function rewind()
    {
        $this->topologicalSort();
    }

    /**
     * Sort the vertices by their connections
     */
    function topologicalSort()
    {
        $this->blackVertices = array();
        if (!count($this->vertices)) {
            return;
        }
        foreach ($this->vertices as $vertex) {
            $vertex->color(self::WHITE);
        }
        while (count($this->blackVertices) <  count($this->vertices)) {
            // select a vertex to start
            foreach ($this->vertices as $vertex) {
                if ($vertex->color() == self::BLACK) {
                    // already sorted
                    continue;
                }
                break;
            }
            do {
                // this vertex has been discovered
                $vertex->color(self::GRAY);
                if (!count($vertex)) {
                    // no adjacent edges
                    $this->blackVertices[] = $vertex;
                    $vertex->color(self::BLACK);
                    continue 2;
                }
                $black = true;
                // iterate over adjacent vertices to find a white vertex
                foreach ($vertex as $edge) {
                    if ($edge->color() == self::BLACK) {
                        continue;
                    }
                    if (!count($edge)) {
                        // no adjacent undiscovered vertices, we found a black one
                        $edge->color(self::BLACK);
                        $this->blackVertices[] = $edge;
                        continue;
                    }
                    $black = false;
                    $edge->color(self::GRAY);
                }
                if ($black) {
                    // found a new vertex
                    $this->blackVertices[] = $vertex;
                    $vertex->color(self::BLACK);
                } else {
                    foreach ($vertex as $edge) {
                        if ($edge->color() == self::BLACK) {
                            continue;
                        }
                        $vertex = $edge;
                        break;
                    }
                }
            } while (!$black);
        }
    }
}<?php
/**
 * PEAR2_Pyrus_IChannelRegistry
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Interface for PEAR2 channel registry.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
interface PEAR2_Pyrus_IChannelRegistry
{
    public function add(PEAR2_Pyrus_IChannel $channel, $update = false, $lastmodified = false);
    public function update(PEAR2_Pyrus_IChannel $channel);
    public function delete(PEAR2_Pyrus_IChannel $channel);
    public function get($channel, $strict = true);
    public function exists($channel, $strict = true);
    public function parseName($name);
    public function parsedNameToString($name);
    public function listChannels();
}
<?php
/**
 * PEAR2_Pyrus_ScriptRunner
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Post-install script runner for Pyrus
 *
 * This class handles the logic of navigating a post-install script's XML,
 * determining what questions to ask, and then passes the information to the
 * actual class.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_ScriptRunner
{
    protected $frontend;
    static protected $skipSections;

    function __construct($frontend)
    {
        $this->frontend = $frontend;
    }

    function run(PEAR2_Pyrus_IPackageFile $package)
    {
        foreach ($package->scriptfiles as $file) {
            $this->runPostinstallScripts($file, $package);
        }
    }

    /**
     * Instruct the runInstallScript method to skip a paramgroup that matches the
     * id value passed in.
     *
     * This method is useful for dynamically configuring which sections of a post-install script
     * will be run based on the user's setup, which is very useful for making flexible
     * post-install scripts without losing the cross-Frontend ability to retrieve user input
     * @param string
     */
    static function skipParamgroup($id)
    {
        self::$skipSections[$id] = true;
    }

    function runPostinstallScripts(PEAR2_Pyrus_PackageFile_v2_Files_File $scriptfile,
                                   PEAR2_Pyrus_IPackageFile $package)
    {
        foreach ($scriptfile->postinstallscript as $script) {
            $script->setupPostInstall();
            $this->runInstallScript($script);
        }
    }

    /**
     * @param PEAR2_Pyrus_Task_Postinstallscript $info contents of postinstallscript tag
     * @param object $script post-installation script
     * @param string install|upgrade
     */
    function runInstallScript(PEAR2_Pyrus_Task_Postinstallscript $info)
    {
        self::$skipSections = array();
        if (!count($info->paramgroup)) {
            $info->scriptobject->run(array(), '_default');
            return;
        }

        $completedPhases = array();

        try {
            foreach ($info->paramgroup as $group) {
                if (isset(self::$skipSections[$group->id])) {
                    // the post-install script chose to skip this section dynamically
                    continue;
                }
    
                if (isset($lastgroup)) {
                    if (!isset($answers)) {
                        $answers = null;
                    }
                    if (!$group->matchesConditionType($answers)) {
                        continue;
                    }
                }
    
                if (isset($group->instructions)) {
                    $this->frontend->display($group->instructions);
                }

                if (isset($answers)) {
                    $oldanswers = $answers;
                    $answers = array();
                } else {
                    $oldanswers = $answers = array();
                }
                if (isset($group->param)) {
                    if (method_exists($info->scriptobject, 'postProcessPrompts')) {
                        $prompts = $info->scriptobject->postProcessPrompts($group->param->getPrompts(), $group->id);
                        if (!is_array($prompts) || count($prompts) != count($group->param)) {
                            throw new PEAR2_Pyrus_Task_Exception('Error: post-install script did not ' .
                                'return proper post-processed prompts');
                        } else {
                            $testprompts = $group->param->getPrompts();
                            foreach ($prompts as $i => $prompt) {
                                if (!is_array($prompt) || !isset($prompt['prompt']) ||
                                      !isset($prompt['name']) ||
                                      ($prompt['name'] != $testprompts[$i]['name']) ||
                                      ($prompt['type'] != $testprompts[$i]['type'])
                                ) {
                                    throw new PEAR2_Pyrus_Task_Exception('Error: post-install script ' .
                                        'modified the variables or prompts, severe security risk');
                                }
                            }
                        }
    
                        $answers = $this->frontend->confirmDialog($prompts);
                    } else {
                        $answers = $this->frontend->confirmDialog($group->param->getPrompts());
                    }
                }
    
                if ((isset($answers) && $answers) || !isset($group->param)) {
                    if (!isset($answers)) {
                        $answers = array();
                    }
    
                    array_unshift($completedPhases, $group->id);
                    // script should throw an exception on failure
                    $info->scriptobject->run(array_merge($answers, $oldanswers), $group->id);
                } else {
                    $info->scriptobject->run($completedPhases, '_undoOnError');
                    return;
                }
                $answers = $this->mergeOldAnswers($oldanswers, $answers, $group->id);
            }
        } catch (\Exception $e) {
            $info->scriptobject->run($completedPhases, '_undoOnError');
            throw $e;
        }
    }

    function mergeOldAnswers($answers, $newanswers, $section)
    {
        foreach ($newanswers as $prompt => $answer) {
            $answers[$section . '::' . $prompt] = $answer;
        }
        if (!count($answers)) {
            $answers = null;
        }
        return $answers;
    }
}
<?php
// this shows how it works
function __autoload($class)
{
    if (substr($class, 0, 5) != 'PEAR2') return false;
    $path = explode('_', substr($class, 11)); // strip PEAR2_Pyrus for CVS
    $path = dirname(__FILE__) . implode('/', $path) . '.php';
    include $path;
}
include $a = '/home/cellog/workspace/PEAR2/Exception/trunk/src/Exception.php';
include $b = '/home/cellog/workspace/PEAR2/MultiErrors/trunk/src/MultiErrors.php';
include '/home/cellog/workspace/PEAR2/MultiErrors/trunk/src/MultiErrors/Exception.php';
include '/home/cellog/workspace/PEAR2/Pyrus_Developer/src/Developer/PackageFile/v2.php';
include '/home/cellog/workspace/PEAR2/Pyrus_Developer/src/Developer/PackageFile/PEAR2SVN.php';
include '/home/cellog/workspace/PEAR2/Pyrus_Developer/src/Developer/PackageFile/PEAR2SVN/Filter.php';
//new PEAR2_Pyrus_Developer_PackageFile_PEAR2SVN(
//    '/home/cellog/workspace/PEAR2/Pyrus_Developer', 'PEAR2_Pyrus_Developer', 'pear2.php.net', false, false);
//exit;
//include '/home/cellog/workspace/PEAR2/Pyrus_Developer/Creator/Zip.php';
//include '/home/cellog/workspace/PEAR2/Pyrus_Developer/src/Developer/Creator/Phar.php';
//include '/home/cellog/workspace/PEAR2/Pyrus_Developer/Creator/Xml.php';
//include '/home/cellog/workspace/PEAR2/Pyrus_Developer/src/Developer/Creator/Exception.php';
//$a = new PEAR2_Pyrus_Package_Creator(array(
//        new PEAR2_Pyrus_Developer_Creator_Phar('/home/cellog/workspace/Pyrus/blah.phar',
//            '<?php echo "hi";__HALT_COMPILER();'),
//        new PEAR2_Pyrus_Developer_Creator_Tar('/tmp/blah.tgz'),
//        new PEAR2_Pyrus_Developer_Creator_Xml('/tmp/blah.xml'),
//    ), $a, '/home/cellog/workspace/PEAR2/Autoload/trunk/src/Autoload.php', $b);
//$b = new PEAR2_Pyrus_Package('/home/cellog/workspace/pear-core/PEAR-1.6.2.tgz');
//$a->render($b);
//exit;
define('OS_WINDOWS', false);
define('OS_UNIX', true);
include '/home/cellog/workspace/PEAR2/HTTP_Request/trunk/src/HTTP/Request/allfiles.php';
$g = new PEAR2_Pyrus_Config('/home/cellog/testpear');
try {
    PEAR2_Pyrus_Installer::begin();
    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('/home/cellog/workspace/PEAR2/Autoload/trunk/package.xml'));
    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('/home/cellog/workspace/PEAR2/Exception/trunk/package.xml'));
    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('/home/cellog/workspace/PEAR2/MultiErrors/trunk/package.xml'));
    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('/home/cellog/workspace/PEAR2/Pyrus_Developer/package.xml'));
    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('/home/cellog/workspace/Pyrus/package.xml'));
//    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('pear.php.net/Console_Getopt'));
    PEAR2_Pyrus_Installer::commit();
} catch (Exception $e) {
    PEAR2_Pyrus_Installer::rollback();
    echo $e;
}
exit;
//$g = new PEAR2_Pyrus_Config('C:/development/pear-core/testpear');
$g = new PEAR2_Pyrus_Config('/home/cellog/testpear');
$g->saveConfig();
$g->bin_dir = 'home/cellog/testpear';
//$a = new PEAR2_Pyrus_Package('C:/development/pear-core/PEAR-1.5.0a1.tgz');
$a = new PEAR2_Pyrus_Package('/tmp/blah.tgz');
$b = new PEAR2_Pyrus_Installer;
$b->install($a);<?php
/**
 * PEAR2_Pyrus_ChannelRegistry_Base
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Base class for Pyrus managed channel registries
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
abstract class PEAR2_Pyrus_ChannelRegistry_Base
    implements PEAR2_Pyrus_IChannelRegistry, Iterator
{
    protected $path;
    protected $readonly;
    
    /**
     * Parse a package name, or validate a parsed package name array
     * @param string string of format
     *               [channel://][channame/]pname[-version|-state][/group=groupname]
     *               [http|https]://uri
     *
     * @return array
     */
    public function parseName($param, $defaultchannel = 'pear2.php.net')
    {
        $saveparam = $param;
        $components = @parse_url((string) $param);
        if (isset($components['scheme'])) {
            if ($components['scheme'] == 'http' || $components['scheme'] == 'https') {
                // uri package
                $param = array('uri' => $param, 'channel' => '__uri');
                return $param;
            } elseif($components['scheme'] != 'channel') {
                throw new PEAR2_Pyrus_ChannelRegistry_ParseException('parsePackageName(): only channel:// uris may ' .
                    'be downloaded, not "' . $param . '"', 'scheme');
            }
        }
        if (!isset($components['path'])) {
            throw new PEAR2_Pyrus_ChannelRegistry_ParseException('parsePackageName(): array $param ' .
                'must contain a valid package name in "' . $param . '"', 'path');
        }
        if (isset($components['host'])) {
            // remove the leading "/"
            $components['path'] = substr($components['path'], 1);
        }
        if (!isset($components['scheme'])) {
            if (strpos($components['path'], '/') !== false) {
                if ($components['path']{0} == '/') {
                    throw new PEAR2_Pyrus_ChannelRegistry_ParseException('parsePackageName(): this is not ' .
                        'a package name, it begins with "/" in "' . $param . '"', 'invalid');
                }
                $parts = explode('/', $components['path']);
                $components['host'] = array_shift($parts);
                if (count($parts) > 1) {
                    $components['path'] = array_pop($parts);
                    $components['host'] .= '/' . implode('/', $parts);
                } else {
                    $components['path'] = implode('/', $parts);
                }
            } else {
                $components['host'] = $defaultchannel;
            }
        } else {
            if (strpos($components['path'], '/')) {
                $parts = explode('/', $components['path']);
                $components['path'] = array_pop($parts);
                $components['host'] .= '/' . implode('/', $parts);
            }
        }

        $param = array(
            'package' => $components['path']
            );
        if (isset($components['host'])) {
            $param['channel'] = $components['host'];
        }
        if (isset($components['fragment'])) {
            $param['group'] = $components['fragment'];
        }
        if (isset($components['user'])) {
            $param['user'] = $components['user'];
        }
        if (isset($components['pass'])) {
            $param['pass'] = $components['pass'];
        }
        if (isset($components['query'])) {
            parse_str($components['query'], $param['opts']);
        }
        // check for extension
        $pathinfo = pathinfo($param['package']);
        if (isset($pathinfo['extension']) &&
              in_array(strtolower($pathinfo['extension']), array('tgz', 'tar', 'zip', 'tbz', 'phar'))) {
            $param['extension'] = $pathinfo['extension'];
            $param['package'] = substr($pathinfo['basename'], 0,
                strlen($pathinfo['basename']) - strlen($pathinfo['extension']) - 1);
        }
        // check for version
        if (strpos($param['package'], '-')) {
            $test = explode('-', $param['package']);
            if (count($test) != 2) {
                throw new PEAR2_Pyrus_ChannelRegistry_ParseException('parseName(): only one version/state ' .
                    'delimiter "-" is allowed in "' . $saveparam . '"', 'invalid');
            }
            list($param['package'], $param['version']) = $test;
        }
        // validation
        $info = $this->exists($param['channel'], false);
        if (!$info) {
            throw new PEAR2_Pyrus_ChannelRegistry_ParseException('unknown channel "' . $param['channel'] .
                '" in "' . $saveparam . '"', 'channel', $param);
        }
        try {
            $chan = $this->get($param['channel'], false);
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_ChannelRegistry_ParseException("Exception: corrupt registry, could not " .
                "retrieve channel " . $param['channel'] . " information", 'other', $e);
        }
        $param['channel'] = $chan->name;
        $validate = $chan->getValidationObject(false);
        $vpackage = $chan->getValidationPackage();
        // validate package name
        if (!$validate->validPackageName($param['package'], $vpackage['_content'])) {
            throw new PEAR2_Pyrus_ChannelRegistry_ParseException('parseName(): invalid package name "' .
                $param['package'] . '" in "' . $saveparam . '"', 'package');
        }
        if (isset($param['group'])) {
            if (!PEAR2_Pyrus_Validate::validGroupName($param['group'])) {
                throw new PEAR2_Pyrus_ChannelRegistry_ParseException('parseName(): dependency group "' . $param['group'] .
                    '" is not a valid group name in "' . $saveparam . '"', 'group');
            }
        }
        if (isset($param['version'])) {
            // check whether version is actually a state
            if (in_array(strtolower($param['version']), $validate->getValidStates())) {
                $param['state'] = strtolower($param['version']);
                unset($param['version']);
            } else {
                if (!$validate->validVersion($param['version'])) {
                    throw new PEAR2_Pyrus_ChannelRegistry_ParseException('parseName(): "' . $param['version'] .
                        '" is neither a valid version nor a valid state in "' .
                        $saveparam . '"', 'version/state');
                }
            }
        }
        return $param;
    }

    /**
     * @param array
     * @return string
     */
    function parsedNameToString($parsed, $brief = false)
    {
        if (is_string($parsed)) {
            return $parsed;
        }
        if (is_object($parsed)) {
            $p = $parsed;
            $parsed = array(
                'package' => $p->getPackage(),
                'channel' => $p->getChannel(),
                'version' => $p->getVersion(),
            );
        }
        if (isset($parsed['uri'])) {
            return $parsed['uri'];
        }
        if ($brief) {
            if ($channel = $this->getAlias($parsed['channel'])) {
                return $channel . '/' . $parsed['package'];
            }
        }
        $upass = '';
        if (isset($parsed['user'])) {
            $upass = $parsed['user'];
            if (isset($parsed['pass'])) {
                $upass .= ':' . $parsed['pass'];
            }
            $upass = "$upass@";
        }
        $ret = 'channel://' . $upass . $parsed['channel'] . '/' . $parsed['package'];
        if (isset($parsed['version']) || isset($parsed['state'])) {
            $ver = isset($parsed['version']) ? $parsed['version'] : '';
            $ver .= isset($parsed['state']) ? $parsed['state'] : '';
            $ret .= '-' . $ver;
        }
        if (isset($parsed['extension'])) {
            $ret .= '.' . $parsed['extension'];
        }
        if (isset($parsed['opts'])) {
            $ret .= '?';
            foreach ($parsed['opts'] as $name => $value) {
                $parsed['opts'][$name] = "$name=$value";
            }
            $ret .= implode('&', $parsed['opts']);
        }
        if (isset($parsed['group'])) {
            $ret .= '#' . $parsed['group'];
        }
        return $ret;
    }

    function current()
    {
        if (!isset($this->channelList)) {
            $this->rewind();
        }
        return $this->get(current($this->channelList));
    }

    function key()
    {
        return key($this->channelList);
    }

    function valid()
    {
        if (!isset($this->channelList)) {
            $this->rewind();
        }
        return current($this->channelList);
    }

    function next()
    {
        return next($this->channelList);
    }

    function rewind()
    {
        $this->channelList = $this->listChannels();
    }

    public function getPearChannel()
    {
        return $this->getDefaultChannel('pear.php.net');
    }

    public function getPear2Channel()
    {
        return $this->getDefaultChannel('pear2.php.net');
    }

    public function getPeclChannel()
    {
        return $this->getDefaultChannel('pecl.php.net');
    }

    public function getUriChannel()
    {
        return $this->getDefaultChannel('__uri');
    }
    
    protected function getDefaultChannel($channel)
    {
        $xml = PEAR2_Pyrus::getDataPath() . '/default_channels/' . $channel . '.xml';
        if (!file_exists($xml)) {
            $xml = dirname(dirname(dirname(__DIR__))).'/data/default_channels/' . $channel . '.xml';
        }
        return new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile($xml));
    }

    /**
     * Set up default channels, for uninitialized channel registries
     */
    protected function initDefaultChannels()
    {
        $pear = $this->getPearChannel();
        $pear2 = $this->getPear2Channel();
        $pecl = $this->getPeclChannel();
        $__uri = $this->getUriChannel();
        $this->add($pear);
        $this->add($pear2);
        $this->add($pecl);
        $this->add($__uri);
    }

    public function getPath()
    {
        return $this->path;
    }

    /**
     * @param string
     * @return int
     */
    function packageCount($channel)
    {
        return count($this->getRegistry()->listPackages($channel));
    }

    /**
     * @return PEAR2_Pyrus_IRegistry
     */
    function getRegistry()
    {
        $class = str_replace('Channel', '', get_class($this));
        $ret = new $class($this->path, $this->readonly);
        return $ret;
    }
}
<?php
/**
 * PEAR2_Pyrus_ChannelRegistry_Xml
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * An implementation of a Pyrus channel registry within XML files.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_ChannelRegistry_Xml extends PEAR2_Pyrus_ChannelRegistry_Base
{
    protected $channelpath;
    /**
     * Initialize the registry
     *
     * @param string $path
     */
    function __construct($path, $readonly = false)
    {
        $this->readonly = $readonly;
        $this->path = $path;
        $this->channelpath = $path . DIRECTORY_SEPARATOR . '.xmlregistry' . DIRECTORY_SEPARATOR .
            'channels'; 
        if (!$this->readonly) {
            if (!$this->exists('pear.php.net')) {
                $this->initDefaultChannels();
            }
        }
    }

    /**
     * Convert a name into a path-friendly name
     *
     * @param string $name
     */
    private function _mung($name)
    {
        return str_replace(array('/', '\\'), array('##', '###'), $name);
    }

    private function _unmung($name)
    {
        return str_replace(array('##', '###'), array('/', '\\'), $name);
    }

    /**
     * Get the filename to store a channel
     *
     * @param PEAR2_Pyrus_IChannel|string $channel Channel to save
     *
     * @return string
     */
    protected function getChannelFile($channel)
    {
        if ($channel instanceof PEAR2_Pyrus_IChannel) {
            $channel = $channel->name;
        }

        return $this->channelpath . DIRECTORY_SEPARATOR . 'channel-' .
            $this->_mung($channel) . '.xml';
    }

    /**
     * Get the filename for a channel alias.
     *
     * @param string $alias Alias to save
     *
     * @return string
     */
    protected function getAliasFile($alias)
    {
        return $this->channelpath . DIRECTORY_SEPARATOR . 'channelalias-' .
            $this->_mung($alias) . '.txt';
    }

    function channelFromAlias($alias)
    {
        if (file_exists($this->getAliasFile($alias))) {
            return file_get_contents($this->getAliasFile($alias));
        }
        return $alias;
    }

    /**
     * Check if the channel has been discovered.
     *
     * @param string $channel Name of the channel
     * @param bool   $strict  Allow aliases or not
     *
     * @return bool
     */
    function exists($channel, $strict = true)
    {
        if (file_exists($this->getChannelFile($channel))) {
            return true;
        }

        if ($strict) {
            return false;
        }

        return file_exists($this->getAliasFile($channel));
    }

    function add(PEAR2_Pyrus_IChannel $channel, $update = false, $lastmodified = false)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot add channel, registry is read-only');
        }

        $file = $this->getChannelFile($channel);
        if (@file_exists($file)) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Error: channel ' .
                $channel->alias . ' has already been discovered');
        }
        if (!@is_dir(dirname($file))) {
            mkdir(dirname($file), 0755, true);
        }

        file_put_contents($file, (string) $channel);
        $alias = $channel->alias;
        file_put_contents($this->getAliasFile($alias), $channel->name);
    }

    function update(PEAR2_Pyrus_IChannel $channel)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot update channel, registry is read-only');
        }

        $file = $this->getChannelFile($channel);
        if (!@file_exists($file)) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Error: channel ' .
                $channel->name . ' is unknown');
        }

        file_put_contents($file, (string) $channel);
        $alias = $channel->alias;
        file_put_contents($this->getAliasFile($alias), $channel->name);
    }

    function delete(PEAR2_Pyrus_IChannel $channel)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot delete channel, registry is read-only');
        }

        $name = $channel->name;
        if ($name == 'pear.php.net' || $name == 'pear2.php.net' || $name == 'pecl.php.net' || $name == '__uri') {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot delete default channel ' .
                $channel->name);
        }

        if ($this->packageCount($name)) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot delete channel ' .
                $name . ', packages are installed');
        }

        @unlink($this->getChannelFile($channel));
        @unlink($this->getAliasFile($channel->alias));
    }

    function get($channel, $strict = true)
    {
        if ($this->exists($channel, $strict)) {
            $channel = $this->channelFromAlias($channel);
            $chan = new PEAR2_Pyrus_ChannelFile($this->getChannelFile($channel));
            return new PEAR2_Pyrus_ChannelRegistry_Channel($this, $chan->getArray());
        }

        throw new PEAR2_Pyrus_ChannelRegistry_Exception('Unknown channel: ' . $channel);
    }

    /**
     * List all discovered channels
     *
     * @return array
     */
    function listChannels()
    {
        $ret = array();
        foreach (new RegexIterator(new DirectoryIterator($this->channelpath),
                                '/channel-(.+?)\.xml/', RegexIterator::GET_MATCH) as $file) {
            $ret[] = $this->get($this->_unmung($file[1]))->name;
        }

        return $ret;
    }
}
<?php
/**
 * PEAR2_Pyrus_ChannelRegistry_Sqlite3
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * An implementation of a Pyrus channel registry using Sqlite3 as the storage
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_ChannelRegistry_Sqlite3 extends PEAR2_Pyrus_ChannelRegistry_Base
{
    /**
     * The database resource
     *
     * @var SQLite3
     */
    static protected $databases = array();

    /**
     * Initialize the registry
     *
     * @param unknown_type $path
     */
    function __construct($path, $readonly = false)
    {
        $this->readonly = $readonly;
        if ($path && $path != ':memory:') {
            if (dirname($path . '.pear2registry') != $path) {
                $path = $path . DIRECTORY_SEPARATOR . '.pear2registry';
            }
        }
        $this->path = $path;
        $this->_init($path, $readonly);
    }

    private function _init($path, $readonly)
    {
        if (isset(self::$databases[$path]) && self::$databases[$path]) {
            return;
        }

        if (!$path) {
            $path = ':memory:';
        } elseif (!file_exists(dirname($path))) {
            if ($readonly) {
                throw new PEAR2_Pyrus_Registry_Exception('Cannot create SQLite3 channel registry, registry is read-only');
            }
            @mkdir(dirname($path), 0755, true);
        }

        if ($readonly && !file_exists($path)) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot create SQLite3 channel registry, registry is read-only');
        }

        self::$databases[$path] = new SQLite3($path);
        // hopefully this works
        if (self::$databases[$path]->lastErrorCode()) {
            $temp = self::$databases[$path];
            unset(self::$databases[$path]);
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot open SQLite3 channel registry: ' . $temp->lastErrorMsg());
        }

        $sql = 'SELECT version FROM pearregistryversion';
        if (@self::$databases[$path]->querySingle($sql) == '1.0.0') {
            $sql = 'SELECT COUNT(*) FROM channels';
            if (!self::$databases[$path]->querySingle($sql)) {
                if ($readonly) {
                    throw new PEAR2_Pyrus_Registry_Exception('Cannot create SQLite3 channel registry, registry is read-only');
                }
                $this->initDefaultChannels();
                return;
            }
            return;
        }

        if ($readonly) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot create SQLite3 channel registry, registry is read-only');
        }

        $a = new PEAR2_Pyrus_Registry_Sqlite3_Creator;
        $a->create(self::$databases[$path]);
        $this->initDefaultChannels();
    }

    function exists($channel, $strict = true)
    {
        if (!isset(self::$databases[$this->path])) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Error: no existing SQLite3 channel registry for ' . $this->path);
        }

        $sql = 'SELECT channel FROM channels WHERE alias = "' . self::$databases[$this->path]->escapeString($channel) . '"';
        if (!$strict && $a = self::$databases[$this->path]->querySingle($sql)) {
            return true;
        }

        $sql = 'SELECT channel FROM channels WHERE channel = "' . self::$databases[$this->path]->escapeString($channel) . '"';
        if ($a = self::$databases[$this->path]->querySingle($sql)) {
            return true;
        }

        return false;
    }

    function add(PEAR2_Pyrus_IChannel $channel, $update = false, $lastmodified = false)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot add channel, registry is read-only');
        }

        if (!isset(self::$databases[$this->path])) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Error: no existing SQLite3 channel registry for ' . $this->path);
        }

        self::$databases[$this->path]->exec('BEGIN');
        $sql = 'SELECT channel FROM channels WHERE channel = "' . self::$databases[$this->path]->escapeString($channel->name) . '"';
        if (self::$databases[$this->path]->querySingle($sql)) {
            if (!$update) {
                self::$databases[$this->path]->exec('ROLLBACK');
                throw new PEAR2_Pyrus_ChannelRegistry_Exception('Error: channel ' .
                    $channel->name . ' has already been discovered');
            }
            $this->delete($channel, true);
        } elseif ($update) {
            self::$databases[$this->path]->exec('ROLLBACK');
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Error: channel ' .
                $channel->name . ' is unknown');
        }

        $validate = $channel->getValidationPackage();

        $sql = '
            INSERT INTO channels
            (channel, summary, suggestedalias, alias, validatepackageversion,
            validatepackage, lastmodified)
            VALUES(
                :name, :summary, :suggestedalias,
                :alias, :version, :package, :lastmodified
            )';

        $stmt = self::$databases[$this->path]->prepare($sql);

        $stmt->bindValue(':name',           $cn = $channel->name);
        $stmt->bindValue(':summary',        $channel->summary);
        $stmt->bindValue(':suggestedalias', $channel->suggestedalias);
        $stmt->bindValue(':alias',          $channel->alias);
        $stmt->bindValue(':version',        $validate['attribs']['version']);
        $stmt->bindValue(':package',        $validate['_content']);
        $stmt->bindValue(':lastmodified',   $channel->lastModified());

        if (!$stmt->execute()) {
            self::$databases[$this->path]->exec('ROLLBACK');
            throw new PEAR2_Pyrus_Registry_Exception('Error: channel ' . $channel->name .
                ' could not be added to the SQLite3 registry');
        }
        $stmt->close();

        $sql = '
            INSERT INTO channel_servers
            (channel, server, ssl, port)
            VALUES(
                :channel, :server, :ssl, :port
            )';
        $stmt = self::$databases[$this->path]->prepare($sql);

        $stmt->bindValue(':channel', $cn);
        $stmt->bindValue(':server',  $cn);
        $stmt->bindValue(':ssl',     $channel->ssl, SQLITE3_INTEGER);
        $stmt->bindValue(':port',    $channel->port, SQLITE3_INTEGER);

        if (!$stmt->execute()) {
            self::$databases[$this->path]->exec('ROLLBACK');
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Error: channel ' . $channel->name .
                ' could not be added to the SQLite3 registry');
        }
        $stmt->close();

        if ($channel->name == '__uri') {
            // __uri pseudo-channel has no protocols or mirrors
            self::$databases[$this->path]->exec('COMMIT');
            return;
        }

        foreach ($channel->protocols->rest as $type => $baseurl) {
            $sql = '
                INSERT INTO channel_server_rest
                (channel, server, baseurl, type)
                VALUES(
                    :channel, :server, :func, :attrib
                )';

            $stmt = self::$databases[$this->path]->prepare($sql);

            $stmt->bindValue(':channel', $cn);
            $stmt->bindValue(':server',  $cn);
            $stmt->bindValue(':func',    $baseurl);
            $stmt->bindValue(':attrib',  $type);

            if (!$stmt->execute()) {
                self::$databases[$this->path]->exec('ROLLBACK');
                throw new PEAR2_Pyrus_ChannelRegistry_Exception('Error: channel ' . $channel->name .
                    ' could not be added to the SQLite3 registry');
            }
            $stmt->close();
        }

        $sql = '
            INSERT INTO channel_servers
            (channel, server, ssl, port)
            VALUES(
                :channel, :server, :ssl, :port
            )';
        $stmt = self::$databases[$this->path]->prepare($sql);
        foreach ($channel->mirrors as $mirror) {

            $ssl = 0;
            if ($mirror->ssl) {
                $ssl = 1;
            }

            $stmt->bindValue(':channel', $cn);
            $stmt->bindValue(':server',  $mn = $mirror->name);
            $stmt->bindValue(':ssl',     $ssl, SQLITE3_INTEGER);
            $stmt->bindValue(':port',    $mirror->port, SQLITE3_INTEGER);

            if (!$stmt->execute()) {
                self::$databases[$this->path]->exec('ROLLBACK');
                throw new PEAR2_Pyrus_ChannelRegistry_Exception('Error: channel ' . $channel->name .
                    ' could not be added to the registry');
            }

            $sql = '
                INSERT INTO channel_server_rest
                (channel, server, baseurl, type)
                VALUES(
                    :channel, :server, :func, :attrib
                )';

            $stmt1 = self::$databases[$this->path]->prepare($sql);
            foreach ($mirror->protocols->rest as $type => $baseurl) {

                $stmt1->bindValue(':channel', $cn);
                $stmt1->bindValue(':server',  $mn);
                $stmt1->bindValue(':func',    $baseurl);
                $stmt1->bindValue(':attrib',  $type);

                if (!$stmt1->execute()) {
                    self::$databases[$this->path]->exec('ROLLBACK');
                    throw new PEAR2_Pyrus_ChannelRegistry_Exception('Error: channel ' . $channel->name .
                        ' could not be added to the SQLite3 registry');
                }
            }
        }
        self::$databases[$this->path]->exec('COMMIT');
    }

    function update(PEAR2_Pyrus_IChannel $channel)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot update channel, registry is read-only');
        }

        return $this->add($channel, true);
    }

    function get($channel, $strict = true)
    {
        if (!isset(self::$databases[$this->path])) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Error: no existing SQLite3 channel registry for ' . $this->path);
        }

        if (!$this->exists($channel, $strict)) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Unknown channel: ' . $channel);
        }

        $chan = $this->getChannelObject($this->channelFromAlias($channel));
        return new PEAR2_Pyrus_ChannelRegistry_Channel($this, $chan->getArray());
    }

    function channelFromAlias($alias)
    {
        $sql = 'SELECT channel FROM channels WHERE alias = "' .
            self::$databases[$this->path]->escapeString($alias) . '"';
        if ($chan = self::$databases[$this->path]->querySingle($sql)) {
            return $chan;
        }
        $sql = 'SELECT channel FROM channels WHERE channel = "' .
            self::$databases[$this->path]->escapeString($alias) . '"';
        if ($chan = self::$databases[$this->path]->querySingle($sql)) {
            return $chan;
        }
        throw new PEAR2_Pyrus_ChannelFile_Exception('Unknown channel/alias: ' . $alias);
    }

    /**
     * @param string
     */
    protected function getChannelObject($channel)
    {
        $channel = $this->channelFromAlias($channel);
        $sql = 'SELECT * FROM channels WHERE channel = "' .
            self::$databases[$this->path]->escapeString($channel) . '"';

        $result = self::$databases[$this->path]->query($sql);
        if (!$result) {
            throw new PEAR2_Pyrus_ChannelFile_Exception('Failed to query channels table');
        }

        while ($res = $result->fetchArray(SQLITE3_ASSOC)) {
            break;
        }
        $ret = new PEAR2_Pyrus_ChannelFile_v1;
        $ret->name = $channel;
        $ret->suggestedalias = $res['suggestedalias'];
        if ($res['alias']) {
            $ret->alias = $res['alias'];
        }
        $ret->summary = $res['summary'];
        $ret->setValidationPackage($res['validatepackage'], $res['validatepackageversion']);
        $ret->lastModified = $res['lastmodified'];

        $sql = 'SELECT channel, server, ssl, port FROM channel_servers
            WHERE channel = "' .
            self::$databases[$this->path]->escapeString($channel) . '"';
        $result = self::$databases[$this->path]->query($sql);
        if (!$result) {
            throw new PEAR2_Pyrus_ChannelFile_Exception('Failed to query mirrors table');
        }

        while ($res = $result->fetchArray(SQLITE3_ASSOC)) {
            if ($res['server'] == $res['channel']) {
                $ret->port = $res['port'];
                $ret->ssl = $res['ssl'];
            } else {
                $ret->mirrors[$res['server']]->ssl = $res['ssl'];
                $ret->mirrors[$res['server']]->port = $res['port'];
            }
        }

        $sql = 'SELECT channel, server, baseurl, type FROM channel_server_rest
            WHERE channel= "' .
            self::$databases[$this->path]->escapeString($channel) . '"';
        $result = self::$databases[$this->path]->query($sql);
        if (!$result) {
            throw new PEAR2_Pyrus_ChannelFile_Exception('Failed to query rest table');
        }

        while ($res = $result->fetchArray(SQLITE3_ASSOC)) {
            if ($res['server'] == $res['channel']) {
                $ret->protocols->rest[$res['type']]->baseurl = $res['baseurl'];
            } else {
                $ret->mirrors[$res['server']]->protocols->rest[$res['type']]->baseurl = $res['baseurl'];
            }
        }
        return $ret;
    }

    function delete(PEAR2_Pyrus_IChannel $channel, $inupdate = false)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot delete channel, registry is read-only');
        }

        if (!isset(self::$databases[$this->path])) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Error: no existing SQLite3 channel registry for ' . $this->path);
        }

        $name = $channel->name;
        if ($name == 'pear.php.net' || $name == 'pear2.php.net' || $name == 'pecl.php.net' || $name == '__uri') {
            if (!$inupdate) {
                throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot delete default channel ' .
                    $channel->name);
            }
        }

        $sql = 'SELECT count(*) FROM packages WHERE channel = "' .
            self::$databases[$this->path]->escapeString($channel->name) . '"';
        if (self::$databases[$this->path]->querySingle($sql)) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot delete channel ' .
                $channel->name . ', packages are installed');
        }


        $sql = 'DELETE FROM channels WHERE channel = "' .
            self::$databases[$this->path]->escapeString($channel->name) . '"';
        if (!@self::$databases[$this->path]->exec($sql)) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot delete channel ' .
                $channel->name . ': ' . self::$databases[$this->path]->lastErrorMsg());
        }
    }

    public function listChannels()
    {
        if (!isset(self::$databases[$this->path])) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception(
                'Error: no existing SQLite3 channel registry for ' . $this->path);
        }

        $ret = array();
        $sql = 'SELECT channel FROM channels ORDER BY channel';
        $res = self::$databases[$this->path]->query($sql);
        while ($chan = $res->fetchArray(SQLITE_ASSOC)) {
            $ret[] = $chan['channel'];
        }

        return $ret;
    }
}
<?php
/**
 * PEAR2_Pyrus_ChannelRegistry_ParseException
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Base class for Exceptions when parsing channel registry.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_ChannelRegistry_ParseException extends PEAR2_Exception
{
    public $why;
    public $params;

    function __construct($message, $why, $params = array())
    {
        $this->why = $why;
        $this->params = $params;
        parent::__construct($message);
    }
}<?php
/**
 * PEAR2_Pyrus_ChannelRegistry_Mirror_Xml
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * A class for handling mirrors within an xml based channel registry.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_ChannelRegistry_Mirror_Xml extends PEAR2_Pyrus_Channel_Mirror
{
    private $_parent;
    function __construct(&$mirrorarray, PEAR2_Pyrus_IChannel $parent,
                         PEAR2_Pyrus_ChannelRegistry $reg)
    {
        parent::__construct($mirrorarray, $parent);
        $this->_parent = $reg;
    }

    public function toChannelObject()
    {
        $chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile((string) $this->parentChannel, true));
        return $chan;
    }

    public function resetREST()
    {
        parent::resetREST();
        $this->_parent->update($this->parentChannel);
    }

    public function setName($name)
    {
        parent::setName($name);
        $this->_parent->update($this->parentChannel);
    }

    public function setPort($port)
    {
        parent::setPort($port);
        $this->_parent->update($this->parentChannel);
    }

    public function setSSL($ssl = true)
    {
        parent::setSSL($ssl);
        $this->_parent->update($this->parentChannel);
    }

    public function setPath($protocol, $path)
    {
        parent::setPath($protocol, $path);
        $this->_parent->update($this->parentChannel);
    }

    public function addFunction($type, $version, $name)
    {
        parent::addFunction($type, $version, $name);
        $this->_parent->update($this->parentChannel);
    }

    public function setBaseUrl($resourceType, $url)
    {
        parent::setBaseURL($resourceType, $url);
        $this->_parent->update($this->parentChannel);
    }
}<?php
/**
 * PEAR2_Pyrus_ChannelRegistry_Mirror_Sqlite3
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Represents a mirror within a Sqlite3 channel registry.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_ChannelRegistry_Mirror_Sqlite3 extends PEAR2_Pyrus_ChannelRegistry_Channel_Sqlite3 implements PEAR2_Pyrus_Channel_IMirror
{
    private $_channel;
    private $_parent;

    function __construct(SQLite3 $db, $mirror, PEAR2_Pyrus_IChannel $parent)
    {
        if ($parent->name == '__uri') {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('__uri channel cannot have mirrors');
        }

        $this->_channel = $parent->name;
        parent::__construct($db, $this->_channel);
        $this->mirror = $mirror;
        $this->_parent = $parent;
    }

    function getChannel()
    {
        return $this->_channel;
    }

    function toChannelObject()
    {
        return $parent;
    }

    /**
     * @return string|false
     */
    function getName()
    {
        return $this->mirror;
    }
}<?php
/**
 * PEAR2_Pyrus_ChannelRegistry_Channel
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/PEAR2/Pyrus/
 */

/**
 * A class that represents individual channels within a channel registry
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/PEAR2/Pyrus/
 */
class PEAR2_Pyrus_ChannelRegistry_Channel extends PEAR2_Pyrus_ChannelFile_v1 implements PEAR2_Pyrus_IChannel
{
    private $_parent;
    function __construct(PEAR2_Pyrus_IChannelRegistry $parent, $data)
    {
        $this->_parent = $parent;
        parent::__construct($data);
    }

    function __get($var)
    {
        if ($var == 'remotepackages') {
            return new PEAR2_Pyrus_Channel_Remotepackages($this);
        } elseif ($var == 'remotepackage') {
            return new PEAR2_Pyrus_Channel_Remotepackage($this, false);
        }
        return parent::__get($var);
    }

    function __set($var, $value)
    {
        parent::__set($var, $value);
        $this->_parent->update($this);
    }

    function toChannelFile()
    {
        $ret = new PEAR2_Pyrus_ChannelFile_v1;
        $ret->fromArray($this->getArray());
        return $ret;
    }
}
<?php
/**
 * PEAR2_Pyrus_ChannelRegistry_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Base class for Exceptions with a Pyrus channel registry.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_ChannelRegistry_Exception extends PEAR2_Exception
{
}<?php
/**
 * PEAR2_Pyrus_ChannelRegistry_Pear1
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Gregory Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/PEAR2/Pyrus
 */

/**
 * This is the central registry, that is used for all installer options,
 * stored in .reg files for PEAR 1 compatibility
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Gregory Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/PEAR2/Pyrus
 */
class PEAR2_Pyrus_ChannelRegistry_Pear1 extends PEAR2_Pyrus_ChannelRegistry_Base
{
    private $_channelPath;
    private $_aliasPath;
    function __construct($path, $readonly = false)
    {
        $this->readonly = $readonly;
        if (!file_exists($path . '/.registry') && basename($path) !== 'php') {
            $path = $path . DIRECTORY_SEPARATOR . 'php';
        }
        $this->path = $path;
        $this->_channelPath = $this->path . DIRECTORY_SEPARATOR . '.channels';
        $this->_aliasPath = $this->_channelPath . DIRECTORY_SEPARATOR . '.alias';
        if (!file_exists($this->_channelPath) || !is_dir($this->_channelPath)) {
            if ($readonly) {
                throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot initialize ' .
                    'PEAR1 channel registry, directory does not exist and registry is read-only');
            }
            if (!@mkdir($this->_channelPath, 0755, true)) {
                throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot initialize ' .
                    'PEAR1 channel registry, channel directory could not be initialized');
            }
        }

        if (!file_exists($this->_aliasPath) || !is_dir($this->_aliasPath)) {
            if ($readonly) {
                throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot initialize ' .
                    'PEAR1 channel registry, aliasdirectory does not exist and registry is read-only');
            }
            if (!@mkdir($this->_aliasPath, 0755, true)) {
                throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot initialize ' .
                    'PEAR1 channel registry, channel aliasdirectory could not be initialized');
            }
        }
        if (!$this->readonly) {
            if (!$this->exists('pear.php.net')) {
                $this->initDefaultChannels();
            }
        }
    }

    private function _channelFileName($channel, $noaliases = false)
    {
        if (!$noaliases) {
            $c = $this->_channelAliasFileName($channel);
            if (file_exists($c)) {
                $channel = implode('', file($c));
            }
        }
        return $this->_channelPath . DIRECTORY_SEPARATOR . str_replace('/', '_',
            strtolower($channel)) . '.reg';
    }

    private function _channelAliasFileName($alias)
    {
        return $this->_channelPath . DIRECTORY_SEPARATOR . '.alias' .
              DIRECTORY_SEPARATOR . str_replace('/', '_', strtolower($alias)) . '.txt';
    }

    private function _channelFromAlias($alias)
    {
        $file = $this->_channelAliasFileName($alias);
        if (file_exists($file)) {
            return file_get_contents($file);
        }
        return $alias;
    }

    public function add(PEAR2_Pyrus_IChannel $channel, $update = false, $lastmodified = false)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot add channel, registry is read-only');
        }
        if (!is_writeable($this->_channelPath)) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot add channel ' .
                $channel->name . ', channel registry path is not writeable');
        }
        $channel->validate();
        if ($this->exists($channel->name)) {
            if (!$update) {
                throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot add channel ' .
                    $channel->name . ', channel already exists, use update to change');
            }
            $checker = $this->get($channel->name);
            if ($channel->alias != $checker->alias) {
                if (file_exists($this->_channelAliasFileName($checker->alias))) {
                    @unlink($this->_channelAliasFileName($checker->alias));
                }
            }
        } elseif ($update) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Error: channel ' .
                $channel->name . ' is unknown');
        }
        if ($channel->alias != $channel->name) {
            if (file_exists($this->_channelAliasFileName($channel->alias)) &&
                  $this->_channelFromAlias($channel->alias) != $channel->name) {
                $channel->alias = $channel->name;
            }
            $fp = @fopen($this->_channelAliasFileName($channel->alias), 'w');
            if (!$fp) {
                throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot add/update channel ' .
                    $channel->name . ', unable to open PEAR1 alias file');
            }
            fwrite($fp, $channel->name);
            fclose($fp);
        }
        $fp = @fopen($this->_channelFileName($channel->name), 'wb');
        if (!$fp) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot add/update channel ' .
                $channel->name . ', unable to open PEAR1 channel registry file');
        }
        $info = (string) $channel;
        $parser = new PEAR2_Pyrus_XMLParser;
        $info = $parser->parseString($info);
        $info = $info['channel'];
        if ($lastmodified) {
            $info['_lastmodified'] = $lastmodified;
        } else {
            $info['_lastmodified'] = date('r');
        }
        fwrite($fp, serialize($info));
        fclose($fp);
        return true;
    }

    public function update(PEAR2_Pyrus_IChannel $channel)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot update channel, registry is read-only');
        }
        return $this->add($channel, true);
    }

    public function delete(PEAR2_Pyrus_IChannel $channel)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot delete channel, registry is read-only');
        }
        $name = $channel->name;
        if ($name == 'pear.php.net' || $name == 'pear2.php.net' || $name == 'pecl.php.net' || $name == '__uri') {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot delete default channel ' .
                $channel->name);
        }
        if (!$this->exists($name)) {
            return true;
        }

        if ($this->packageCount($name)) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Cannot delete channel ' .
                $name . ', packages are installed');
        }
        @unlink($this->_channelFileName($name));
        @unlink($this->_channelAliasFileName($channel->alias));
    }

    public function get($channel, $strict = true)
    {
        if (!$this->exists($channel, $strict)) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Channel ' . $channel .
                ' does not exist');
        }
        $cont = file_get_contents($this->_channelFileName($channel, $strict));
        $a = @unserialize($cont);
        if (!$a || !is_array($a)) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Channel ' . $channel .
                ' PEAR1 registry file is corrupt');
        }
        try {
            $chan = new PEAR2_Pyrus_ChannelRegistry_Channel($this, $a);
            return $chan;
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Channel ' . $channel .
                ' PEAR1 registry file is invalid channel information', $e);
        }
    }

    public function exists($channel, $strict = true)
    {
        $chan = $this->_channelFileName($channel);
        if (file_exists($chan)) {
            return true;
        }
        return false;
    }

    function listChannels()
    {
        $ret = array();
        foreach (new RegexIterator(new DirectoryIterator($this->_channelPath),
                                '/^(.+?)\.reg/', RegexIterator::GET_MATCH) as $file) {
            $ret[] = $this->get(str_replace('_', '/', $file[1]))->name;
        }
        return $ret;
    }
}
<?php
/**
 * PEAR2_Pyrus_XMLWriter_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for the XMLWriter
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_XMLWriter_Exception extends PEAR2_Exception {}<?php
/**
 * PEAR2_Pyrus_Validate_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for Validate
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Validate_Exception extends PEAR2_Exception
{
    /**
     * package.xml field that failed channel-specific validation
     *
     * @var string
     */
    public $field;
    /**
     * The reason that validation failed
     *
     * @var string
     */
    public $reason;
    /**
     * Set up message/field combination for package.xml validation
     *
     * @param string $msg
     * @param string $field
     */
    public function __construct($msg, $field)
    {
        $this->reason = $msg;
        $msg = 'Channel validator error: field "' . $field . '" - ' .
                    $msg;
        parent::__construct($msg);
        $this->field = $field;
    }
}<?php
/**
 * PEAR2_Pyrus_Installer_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for Pyrus installer
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Installer_Exception extends PEAR2_Exception {}<role version="2.0" xmlns="http://pear2.php.net/dtd/customrole-2.0">
 <name>ext</name>
 <classprefix>PEAR2_Pyrus_Installer_Role</classprefix>
 <releasetypes>extbin</releasetypes>
 <releasetypes>zendextbin</releasetypes>
 <installable>1</installable>
 <locationconfig>ext_dir</locationconfig>
 <honorsbaseinstall>1</honorsbaseinstall>
 <unusualbaseinstall />
 <phpfile />
 <executable />
 <phpextension>1</phpextension>
</role><role version="2.0" xmlns="http://pear2.php.net/dtd/customrole-2.0">
 <name>script</name>
 <classprefix>PEAR2_Pyrus_Installer_Role</classprefix>
 <releasetypes>php</releasetypes>
 <releasetypes>extsrc</releasetypes>
 <releasetypes>extbin</releasetypes>
 <releasetypes>zendextsrc</releasetypes>
 <releasetypes>zendextbin</releasetypes>
 <installable>1</installable>
 <locationconfig>bin_dir</locationconfig>
 <honorsbaseinstall>1</honorsbaseinstall>
 <unusualbaseinstall />
 <phpfile />
 <executable>1</executable>
 <phpextension />
</role><role version="2.0" xmlns="http://pear2.php.net/dtd/customrole-2.0">
 <name>src</name>
 <classprefix>PEAR2_Pyrus_Installer_Role</classprefix>
 <releasetypes>extsrc</releasetypes>
 <releasetypes>zendextsrc</releasetypes>
 <installable>1</installable>
 <locationconfig>src_dir</locationconfig>
 <honorsbaseinstall />
 <unusualbaseinstall>1</unusualbaseinstall>
 <phpfile />
 <executable />
 <phpextension />
</role><?php
/**
 * PEAR2_Pyrus_Installer_Role_Script
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Script role
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Installer_Role_Script extends PEAR2_Pyrus_Installer_Role_Common {}
?><?php
/**
 * Base class for all installation roles.
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Base class for all installation roles.
 *
 * This class allows extensibility of file roles.  Packages with complex
 * customization can now provide custom file roles along with the possibility of
 * adding configuration values to match.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Installer_Role_Common
{
    /**
     * @var PEAR_Config
     * @access protected
     */
    protected $config;
    /**
     * @var array
     */
    protected $info;

    /**
     * @param PEAR2_Pyrus_Config
     */
    function __construct(PEAR2_Pyrus_Config $config, $info)
    {
        $this->config = $config;
        $this->info = $info;
    }

    /**
     * Retrieve configuration information about a file role from its XML info
     *
     * @param string $role role name
     * @return array
     */
    static function getInfo($role)
    {
        return PEAR2_Pyrus_Installer_Role::getInfo($role);
    }

    /**
     * Retrieve the location a packaged file should be placed in a package
     *
     * @param PEAR2_Pyrus_Package $pkg
     * @param array $atts
     * @return string
     */
    function getPackagingLocation(PEAR2_Pyrus_IPackageFile $pkg, $atts)
    {
        $role = $this->info['name'];

        $file = $atts['name'];
        // strip role from file path
        // so src/Path/To/File.php becomes Path/To/File.php,
        // data/package.xsd becomes package.xsd
        $newpath = $file;
        if ($role === 'php') {
            if (strpos($newpath, 'src') === 0) {
                $newpath = substr($newpath, 4);
            }
        } elseif (strpos($newpath, $role) === 0) {
            $newpath = substr($newpath, strlen($role) + 1);
        }
        if ($newpath === false) {
            $newpath = $file;
        }

        if ($newpath) {
            if ($newpath[0] == '/') {
                $newpath = substr($newpath, 1);
            }
            $file = $newpath;
        }

        if ($this->info['honorsbaseinstall']) {
            $dest_dir = $role;
            if (array_key_exists('baseinstalldir', $atts)) {
                if ($atts['baseinstalldir'] != '/') {
                    $dest_dir .= '/' . $atts['baseinstalldir'];
                }

                if (strlen($atts['baseinstalldir'])) {
                    $dest_dir .= '/';
                }
            } else {
                $dest_dir .= '/';
            }
        } elseif ($this->info['unusualbaseinstall']) {
            $dest_dir = $role . '/' . $pkg->channel . '/' . $pkg->name . '/';
            if (array_key_exists('baseinstalldir', $atts)) {
                if (strlen($atts['baseinstalldir']) && $atts['baseinstalldir'] != '/') {
                    $dest_dir .= $atts['baseinstalldir'];
                    if (strlen($atts['baseinstalldir'])) {
                        $dest_dir .= '/';
                    }
                }
            } else {
                if (dirname($file) != '.') {
                    $dest_dir .= dirname($file) . '/';
                }
            }
        } else {
            $dest_dir = $role . '/' . $pkg->channel . '/' . $pkg->name . '/';
        }

        return $dest_dir . $file;
    }

    function getRelativeLocation(PEAR2_Pyrus_IPackageFile $pkg, PEAR2_Pyrus_PackageFile_v2Iterator_FileTag $file,
                                 $retDir = false)
    {
        if (!$this->info['locationconfig']) {
            return false;
        }

        if ($this->info['honorsbaseinstall']) {
            $dest_dir = $save_destdir = '';
            if ($file->baseinstalldir) {
                $dest_dir .= $file->baseinstalldir;
            }
        } elseif ($this->info['unusualbaseinstall']) {
        	if (!$pkg->isNewPackage()) {
        		// Place files using the old doc dir structure
        		$dest_dir = $save_destdir = $pkg->name;
        	} else {
	            $dest_dir = $save_destdir =
	                $pkg->channel . DIRECTORY_SEPARATOR . $pkg->name;
        	}
            if ($file->baseinstalldir) {
                $dest_dir .= DIRECTORY_SEPARATOR . $file->baseinstalldir;
            }
        } else {
            $dest_dir = $save_destdir =
                $pkg->channel . DIRECTORY_SEPARATOR . $pkg->name;
        }

        if (dirname($file->name) != '.' && empty($file['install-as'])) {
            $newpath = dirname($file->name);
            if ($pkg->isNewPackage()) {
                // strip role from file path
                // so php/Path/To/File.php becomes Path/To/File.php,
                // data/package.xsd becomes package.xsd
                $r = strtolower(str_replace('PEAR2_Pyrus_Installer_Role_', '',
                      get_class($this)));
                if ($r === 'php') {
                    if (strpos($newpath, 'src') === 0) {
                        $newpath = substr($newpath, 4);
                        if ($newpath === false) {
                            $newpath = '';
                        }
                    }
                }
                if (strpos($newpath, $r) === 0) {
                    $newpath = substr($newpath, strlen($r) + 1);
                    if ($newpath === false) {
                        $newpath = '';
                    }
                }
            }
            if ($dest_dir && $newpath) {
                $dest_dir .= DIRECTORY_SEPARATOR;
            }
            $dest_dir .= $newpath;
        }

        if ($dest_dir) {
            $dest_dir .= DIRECTORY_SEPARATOR;
        }
        $dest_file = $dest_dir;
        if (empty($file['install-as'])) {
            $dest_file .= basename($file->name);
        } else {
            $dest_file .= $file['install-as'];
        }
        if ($retDir) {
            // Clean up the DIRECTORY_SEPARATOR mess
            $ds2 = DIRECTORY_SEPARATOR . DIRECTORY_SEPARATOR;

            list($dest_dir, $dest_file) = preg_replace(array('!\\\\+!', '!/!', "!$ds2+!"),
                                                        array(DIRECTORY_SEPARATOR, DIRECTORY_SEPARATOR,
                                                              DIRECTORY_SEPARATOR),
                                                        array($dest_dir, $dest_file));
            return array($dest_dir, $dest_file);
        }
        return $dest_file;
    }

    /**
     * Get the name of the configuration variable that specifies the location of this file
     * @return string|false
     */
    function getLocationConfig()
    {
        return $this->info['locationconfig'];
    }

    /**
     * Do any unusual setup here
     * @param PEAR_Installer
     * @param PEAR_PackageFile_v2
     * @param array file attributes
     * @param string file name
     */
    function setup($installer, $pkg, $atts, $file)
    {
    }

    function isExecutable()
    {
        return $this->info['executable'];
    }

    function isInstallable()
    {
        return $this->info['installable'];
    }

    function isExtension()
    {
        return $this->info['phpextension'];
    }
}<?php
/**
 * PEAR2_Pyrus_Installer_Role_Ext
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Ext role
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Installer_Role_Ext extends PEAR2_Pyrus_Installer_Role_Common {}
?><role version="2.0" xmlns="http://pear2.php.net/dtd/customrole-2.0">
 <name>www</name>
 <classprefix>PEAR2_Pyrus_Installer_Role</classprefix>
 <releasetypes>php</releasetypes>
 <releasetypes>extsrc</releasetypes>
 <releasetypes>extbin</releasetypes>
 <releasetypes>zendextsrc</releasetypes>
 <releasetypes>zendextbin</releasetypes>
 <installable>1</installable>
 <locationconfig>www_dir</locationconfig>
 <honorsbaseinstall />
 <unusualbaseinstall>1</unusualbaseinstall>
 <phpfile />
 <executable />
 <phpextension />
</role><role version="2.0" xmlns="http://pear2.php.net/dtd/customrole-2.0">
 <name>customtask</name>
 <classprefix>PEAR2_Pyrus_Installer_Role</classprefix>
 <releasetypes>php</releasetypes>
 <releasetypes>extsrc</releasetypes>
 <releasetypes>extbin</releasetypes>
 <releasetypes>zendextsrc</releasetypes>
 <releasetypes>zendextbin</releasetypes>
 <installable>1</installable>
 <locationconfig>data_dir</locationconfig>
 <honorsbaseinstall />
 <unusualbaseinstall>1</unusualbaseinstall>
 <phpfile />
 <executable />
 <phpextension />
</role><?php
/**
 * PEAR2_Pyrus_Installer_Role_Www
 * 
 * PHP version 5
 * 
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * www role
 * 
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Installer_Role_Www extends PEAR2_Pyrus_Installer_Role_Common {}
?><?php
/**
 * PEAR2_Pyrus_Installer_Role_Src
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Src role
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Installer_Role_Src extends PEAR2_Pyrus_Installer_Role_Common {}
?><role version="2.0" xmlns="http://pear2.php.net/dtd/customrole-2.0">
 <name>data</name>
 <classprefix>PEAR2_Pyrus_Installer_Role</classprefix>
 <releasetypes>php</releasetypes>
 <releasetypes>extsrc</releasetypes>
 <releasetypes>extbin</releasetypes>
 <releasetypes>zendextsrc</releasetypes>
 <releasetypes>zendextbin</releasetypes>
 <installable>1</installable>
 <locationconfig>data_dir</locationconfig>
 <honorsbaseinstall />
 <unusualbaseinstall>1</unusualbaseinstall>
 <phpfile />
 <executable />
 <phpextension />
</role><?php
/**
 * PEAR2_Pyrus_Installer_Role_Customrole
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Custom role xml file role
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Installer_Role_Customrole extends PEAR2_Pyrus_Installer_Role_Data {}
?><?php
/**
 * PEAR2_Pyrus_Installer_Role_Exception
 * 
 * PHP version 5
 * 
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception for roles
 * 
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Installer_Role_Exception extends PEAR2_Exception {}<role version="2.0" xmlns="http://pear2.php.net/dtd/customrole-2.0">
 <name>customcommand</name>
 <classprefix>PEAR2_Pyrus_Installer_Role</classprefix>
 <releasetypes>php</releasetypes>
 <releasetypes>extsrc</releasetypes>
 <releasetypes>extbin</releasetypes>
 <releasetypes>zendextsrc</releasetypes>
 <releasetypes>zendextbin</releasetypes>
 <installable>1</installable>
 <locationconfig>data_dir</locationconfig>
 <honorsbaseinstall />
 <unusualbaseinstall>1</unusualbaseinstall>
 <phpfile />
 <executable />
 <phpextension />
</role><?php
/**
 * PEAR2_Pyrus_Installer_Role_Test
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Test role
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Installer_Role_Test extends PEAR2_Pyrus_Installer_Role_Common {}
?><?php
/**
 * PEAR2_Pyrus_Installer_Role_Php
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * php role
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Installer_Role_Php extends PEAR2_Pyrus_Installer_Role_Common {}
?><role version="2.0" xmlns="http://pear2.php.net/dtd/customrole-2.0">
 <name>customrole</name>
 <classprefix>PEAR2_Pyrus_Installer_Role</classprefix>
 <releasetypes>php</releasetypes>
 <releasetypes>extsrc</releasetypes>
 <releasetypes>extbin</releasetypes>
 <releasetypes>zendextsrc</releasetypes>
 <releasetypes>zendextbin</releasetypes>
 <installable>1</installable>
 <locationconfig>data_dir</locationconfig>
 <honorsbaseinstall />
 <unusualbaseinstall>1</unusualbaseinstall>
 <phpfile />
 <executable />
 <phpextension />
</role><?php
/**
 * PEAR2_Pyrus_Installer_Role_Data
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Data role
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Installer_Role_Data extends PEAR2_Pyrus_Installer_Role_Common {}
?><?php
/**
 * PEAR2_Pyrus_Installer_Role_Customcommand
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Custom task xml file role
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Installer_Role_Customcommand extends PEAR2_Pyrus_Installer_Role_Data {}
?><?php
/**
 * PEAR2_Pyrus_Installer_Role_Customtask
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Custom task xml file role
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Installer_Role_Customtask extends PEAR2_Pyrus_Installer_Role_Data {}
?><role version="2.0" xmlns="http://pear2.php.net/dtd/customrole-2.0">
 <name>php</name>
 <classprefix>PEAR2_Pyrus_Installer_Role</classprefix>
 <releasetypes>php</releasetypes>
 <releasetypes>extsrc</releasetypes>
 <releasetypes>extbin</releasetypes>
 <releasetypes>zendextsrc</releasetypes>
 <releasetypes>zendextbin</releasetypes>
 <installable>1</installable>
 <locationconfig>php_dir</locationconfig>
 <honorsbaseinstall>1</honorsbaseinstall>
 <unusualbaseinstall />
 <phpfile>1</phpfile>
 <executable />
 <phpextension />
</role><role version="2.0" xmlns="http://pear2.php.net/dtd/customrole-2.0">
 <name>test</name>
 <classprefix>PEAR2_Pyrus_Installer_Role</classprefix>
 <releasetypes>php</releasetypes>
 <releasetypes>extsrc</releasetypes>
 <releasetypes>extbin</releasetypes>
 <releasetypes>zendextsrc</releasetypes>
 <releasetypes>zendextbin</releasetypes>
 <installable>1</installable>
 <locationconfig>test_dir</locationconfig>
 <honorsbaseinstall />
 <unusualbaseinstall>1</unusualbaseinstall>
 <phpfile />
 <executable />
 <phpextension />
</role><?php
/**
 * PEAR2_Pyrus_Installer_Role_Doc
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Doc role
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Installer_Role_Doc extends PEAR2_Pyrus_Installer_Role_Common {}
?><role version="2.0" xmlns="http://pear2.php.net/dtd/customrole-2.0">
 <name>doc</name>
 <classprefix>PEAR2_Pyrus_Installer_Role</classprefix>
 <releasetypes>php</releasetypes>
 <releasetypes>extsrc</releasetypes>
 <releasetypes>extbin</releasetypes>
 <releasetypes>zendextsrc</releasetypes>
 <releasetypes>zendextbin</releasetypes>
 <installable>1</installable>
 <locationconfig>doc_dir</locationconfig>
 <honorsbaseinstall />
 <unusualbaseinstall>1</unusualbaseinstall>
 <phpfile />
 <executable />
 <phpextension />
</role><?php
/**
 * PEAR2_Pyrus_Installer_Role
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Base class for installation roles for files.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Installer_Role
{
    static private $_roles;

    /**
     * Set up any additional configuration variables that file roles require
     *
     * Never call this directly, it is called by the PEAR_Config constructor
     * @param PEAR2_Pyrus_Config
     * @access private
     * @static
     */
    public static function initializeConfig(PEAR2_Pyrus_Config $config)
    {
        if (!isset(self::$_roles)) {
            self::registerRoles();
        }

        foreach (self::$_roles as $class => $info) {
            if (!$info['config_vars']) {
                continue;
            }

            $config->addConfigValue($info['config_vars']);
        }
    }

    /**
     * @param string package type
     * @param string role name
     * @static
     */
    static function factory($packagetype, $role)
    {
        if (!isset(self::$_roles)) {
            self::registerRoles();
        }

        if (!in_array($role, self::getValidRoles($packagetype))) {
            throw new PEAR2_Pyrus_Installer_Exception('Invalid role ' . $role .
                                                      'requested for package type ' . $packagetype);
        }

        $class = self::$_roles[$role]['classprefix'] . '_' . ucfirst($role);
        return new $class(PEAR2_Pyrus_Config::current(), self::$_roles[$role]);
    }

    /**
     * Get a list of file roles that are valid for the particular release type.
     *
     * For instance, src files serve no purpose in regular php releases.
     * @param string
     * @param bool clear cache
     * @return array
     * @static
     */
    static function getValidRoles($release, $clear = false)
    {
        if (!isset(self::$_roles)) {
            self::registerRoles();
        }

        static $ret = array();
        if ($clear) {
            $ret = array();
        }

        if (isset($ret[$release])) {
            return $ret[$release];
        }

        $ret[$release] = array();
        foreach (self::$_roles as $role => $okreleases) {
            if (in_array($release, $okreleases['releasetypes'])) {
                $ret[$release][] = $role;
            }
        }

        return $ret[$release];
    }

    /**
     * Get a list of roles that require their files to be installed
     *
     * Most roles must be installed, but src and package roles, for instance
     * are pseudo-roles.  src files are compiled into a new extension.  Package
     * roles are actually fully bundled releases of a package
     * @param bool clear cache
     * @return array
     * @static
     */
    static function getInstallableRoles($clear = false)
    {
        if (!isset(self::$_roles)) {
            self::registerRoles();
        }

        static $ret;
        if ($clear) {
            unset($ret);
        }

        if (!isset($ret)) {
            $ret = array();
            foreach (self::$_roles as $role => $okreleases) {
                if ($okreleases['installable']) {
                    $ret[] = $role;
                }
            }
        }

        return $ret;
    }

    /**
     * Return an array of roles that are affected by the baseinstalldir attribute
     *
     * Most roles ignore this attribute, and instead install directly into:
     * PackageName/filepath
     * so a tests file tests/file.phpt is installed into PackageName/tests/filepath.php
     * @param bool clear cache
     * @return array
     * @static
     */
    static function getBaseinstallRoles($clear = false)
    {
        if (!isset(self::$_roles)) {
            self::registerRoles();
        }

        static $ret;
        if ($clear) {
            unset($ret);
        }

        if (!isset($ret)) {
            $ret = array();
            foreach (self::$_roles as $role => $okreleases) {
                if ($okreleases['honorsbaseinstall']) {
                    $ret[] = $role;
                }
            }
        }

        return $ret;
    }

    /**
     * Return an array of file roles that should be analyzed for PHP content at package time,
     * like the "php" role.
     * @param bool clear cache
     * @return array
     * @static
     */
    static function getPhpRoles($clear = false)
    {
        if (!isset(self::$_roles)) {
            self::registerRoles();
        }

        static $ret;
        if ($clear) {
            unset($ret);
        }

        if (!isset($ret)) {
            $ret = array();
            foreach (self::$_roles as $role => $okreleases) {
                if ($okreleases['phpfile']) {
                    $ret[] = $role;
                }
            }
        }

        return $ret;
    }

    /**
     * Scan through the Command directory looking for classes
     * and see what commands they implement.
     * @param string which directory to look for classes, defaults to
     *               the Installer/Roles subdirectory of
     *               the directory from where this file (__FILE__) is
     *               included.
     *
     * @return bool TRUE on success, a PEAR error on failure
     * @access public
     * @static
     */
    static function registerRoles($dir = null)
    {
        self::$_roles = array();
        $parser = new PEAR2_Pyrus_XMLParser;
        if ($dir === null) {
            $dir = __DIR__ . '/Role';
        }

        if (!file_exists($dir) || !is_dir($dir)) {
            throw new PEAR2_Pyrus_Installer_Role_Exception("registerRoles: opendir($dir) failed");
        }

        $dp = @opendir($dir);
        if (empty($dp)) {
            throw new PEAR2_Pyrus_Installer_Role_Exception("registerRoles: opendir($dir) failed");
        }

        $schemapath = PEAR2_Pyrus::getDataPath() . '/customrole-2.0.xsd';
        if (!file_exists($schemapath)) {
            $schemapath = realpath(__DIR__ . '/../../../data/customrole-2.0.xsd');
        }
        while ($entry = readdir($dp)) {
            if ($entry{0} == '.' || substr($entry, -4) != '.xml') {
                continue;
            }

            $role = strtolower(basename($entry, '.xml'));
            // List of roles
            if (!isset(self::$_roles[$role])) {
                $file = "$dir/$entry";
                $data = $parser->parse($file, $schemapath);
                $data = $data['role'];
                if (!is_array($data['releasetypes'])) {
                    $data['releasetypes'] = array($data['releasetypes']);
                }
                self::$_roles[$role] = $data;
            }
        }

        closedir($dp);
        $roles = self::$_roles;
        ksort($roles);
        self::$_roles = $roles;
        self::getBaseinstallRoles(true);
        self::getInstallableRoles(true);
        self::getPhpRoles(true);
        self::getValidRoles('****', true);
        return true;
    }

    static function registerCustomRole($info)
    {
        self::$_roles[$info['name']] = $info;
        $roles = self::$_roles;
        ksort($roles);
        self::$_roles = $roles;
        self::getBaseinstallRoles(true);
        self::getInstallableRoles(true);
        self::getPhpRoles(true);
        self::getValidRoles('****', true);
        if (isset($info['configvar'])) {
            if (!isset($info['configvar'][0])) {
                $info['configvar'] = array($info['configvar']);
            }
            foreach ($info['configvar'] as $configvar) {
                $default = $configvar['default'];
                if (false !== strpos($default, '<?php')) {
                    $tmp = PEAR2_Pyrus_Config::current()->temp_dir . DIRECTORY_SEPARATOR .
                        '.configdefault.php';
                    if (!file_exists(dirname($tmp))) {
                        mkdir(dirname($tmp), 0755, true);
                    }
                    file_put_contents($tmp, $default);
                    $getDefault = function() use ($tmp) {
                        include $tmp;
                        return $default;
                    };
                    $default = $getDefault();
                }
                PEAR2_Pyrus_Config::addConfigValue($configvar['name'], $default, $configvar['configtype'] == 'system');
            }
        }
    }

    /**
     * Retrieve configuration information about a file role from its XML info
     *
     * @param string $role Role Classname, as in "PEAR2_Pyrus_Installer_Role_Data"
     * @return array
     */
    static function getInfo($role)
    {
        if (!isset(self::$_roles)) {
            self::registerRoles();
        }

        if (empty(self::$_roles[$role])) {
            throw new PEAR2_Pyrus_Installer_Role_Exception('Unknown Role: "' . $role . '"');
        }

        return self::$_roles[$role];
    }
}<?php
/**
 * PEAR2_Pyrus_IChannel
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Interface for channels
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
interface PEAR2_Pyrus_IChannel
{
    function __get($var);
    function __toString();
    public function getValidationObject($package = false);
    public function getValidationPackage();
}
<?php
/**
 * PEAR2_Pyrus_Config
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Pyrus's master configuration manager
 *
 * Unlike PEAR version 1.x, the new Pyrus configuration manager is tightly bound
 * to include_path, and will search through include_path for system configuration
 * Pyrus installations.  In addition, the configuration is minimal.  If no changes
 * have been made since instantiation, no attempt is made to write out the configuration
 * file
 *
 * The User configuration file will be looked for in these locations:
 *
 * Unix:
 *
 * - home directory
 * - current directory
 *
 * Windows:
 *
 * - local settings directory on windows for the current user.
 *   This is looked up directly in the windows registry using COM
 * - current directory
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Config
{
    /**
     * location of PEAR2 installation
     *
     * @var string
     */
    protected $pearDir;

    /**
     * location of user-specific configuration file
     *
     * @var string
     */
    protected $userFile;

    /**
     * registry for this {@link $pearDir} value
     *
     * @var PEAR2_Pyrus_Registry
     */
    protected $myregistry;

    /**
     * channel registry for this {@link $pearDir} value
     *
     * @var PEAR2_Pyrus_Channel_Registry
     */
    protected $mychannelRegistry;
    /**
     * registry for plugins, which are kept in the plugin_dir directory
     *
     * @var PEAR2_Pyrus_PluginRegistry
     */
    protected $mypluginregistry;

    /**
     * configuration values for this configuration object
     *
     * @var string
     */
    protected $values;

    static protected $explicitUserConfig = false;

    static protected $initializing = false;
    /**
     * mapping of path => PEAR2 configuration objects
     *
     * @var array
     */
    static protected $configs = array();

    /**
     * mapping of path => flag on modification
     *
     * If an index is not set, it has not been modified
     * @var array
     */
    static protected $configDirty = array();

    /**
     * The last instantiated configuration
     *
     * @var PEAR2_Pyrus_Config
     */
    static protected $current;

    /**
     * Default values for custom configuration values set by custom file roles.
     * @var array
     */
    static protected $customDefaults = array();

    /**
     * Default values for configuration.
     *
     * @php_dir@ is automatically replaced with the current
     * PEAR2 configuration location
     * @var array
     */
    static protected $defaults =
        array(
            'php_dir' => '@php_dir@/php', // pseudo-value in this implementation
            'ext_dir' => '@php_dir@/ext',
            'doc_dir' => '@php_dir@/docs',
            'bin_dir' => PHP_BINDIR,
            'data_dir' => '@php_dir@/data', // pseudo-value in this implementation
            'cfg_dir' => '@php_dir@/cfg',
            'www_dir' => '@php_dir@/www',
            'test_dir' => '@php_dir@/tests',
            'src_dir' => '@php_dir@/src',
            'php_bin' => '',
            'php_prefix' => '',
            'php_suffix' => '',
            'php_ini' => '',
            'default_channel' => 'pear2.php.net',
            'preferred_mirror' => 'pear2.php.net',
            'auto_discover' => 0,
            'http_proxy' => '',
            'cache_dir' => '@php_dir@/cache',
            'temp_dir' => '@php_dir@/temp',
            'download_dir' => '@php_dir@/downloads',
            'username' => '',
            'password' => '',
            'verbose' => 1,
            'preferred_state' => 'stable',
            'umask' => '0022',
            'cache_ttl' => 3600,
            'sig_type' => '',
            'sig_bin' => '',
            'sig_keyid' => '',
            'sig_keydir' => '',
            'my_pear_path' => '@php_dir@',
            'plugins_dir' => '@default_config_dir@',
        );

    /**
     * Mapping of user configuration file path => config values
     *
     * @var array
     */
    static protected $userConfigs = array();

    static protected $lastUserConfig = null;

    /**
     * Configuration variable names that are bound to the PEAR installation
     *
     * These are values that should not change for different users
     * @var array
     */
    static protected $pearConfigNames = array(
            'php_dir', // pseudo-value in this implementation
            'ext_dir',
            'cfg_dir',
            'doc_dir',
            'bin_dir',
            'data_dir', // pseudo-value in this implementation
            'www_dir',
            'test_dir',
            'src_dir',
            'php_bin',
            'php_ini',
            'php_prefix',
            'php_suffix',
        );

    /**
     * Custom configuration variable names that are bound to the PEAR installation
     *
     * These are values that should not change for different users, and are
     * set by custom file roles
     * @var array
     */
    static protected $customPearConfigNames = array();

    /**
     * Configuration variable names that are user-specific
     *
     * These are values that are user preferences rather than
     * information necessary for installation on the filesystem.
     * @var array
     */
    static protected $userConfigNames = array(
            'default_channel',
            'preferred_mirror',
            'auto_discover',
            'http_proxy',
            'cache_dir',
            'temp_dir',
            'download_dir',
            'username',
            'password',
            'verbose',
            'preferred_state',
            'umask',
            'cache_ttl',
            'sig_type',
            'sig_bin',
            'sig_keyid',
            'sig_keydir',
            'my_pear_path', // PATH_SEPARATOR-separated list of PEAR repositories to manage
            'plugins_dir', // full path to location where pyrus plugins are installed
        );
    /**
     * Configuration variable names that are user-specific
     *
     * These are values that are user preferences rather than
     * information necessary for installation on the filesystem, and
     * are set up by custom file roles
     * @var array
     */
    static protected $customUserConfigNames = array();

    /**
     * __get variables that cannot be used as custom config values
     * @var array
     */
    static protected $magicVars = array('registry',
                                        'channelregistry',
                                        'pluginregistry',
                                        'systemvars',
                                        'uservars',
                                        'mainsystemvars',
                                        'mainuservars',
                                        'userfile',
                                        'path');
    /**
     * Set up default configuration values that need to be determined at runtime
     *
     * The ext_dir variable, bin_dir variable, and php_ini are set up in
     * this method.
     */
    protected static function constructDefaults()
    {
        static $called = false;
        if ($called) {
            return;
        }

        $called = true;
        // set up default ext_dir
        if (getenv('PHP_PEAR_EXTENSION_DIR')) {
            self::$defaults['ext_dir'] = getenv('PHP_PEAR_EXTENSION_DIR');
            PEAR2_Pyrus_Log::log(5, 'used PHP_PEAR_EXTENSION_DIR environment variable');
        } elseif (ini_get('extension_dir')) {
            self::$defaults['ext_dir'] = ini_get('extension_dir');
            PEAR2_Pyrus_Log::log(5, 'used ini_get(extension_dir)');
        } elseif (defined('PEAR_EXTENSION_DIR')) {
            self::$defaults['ext_dir'] = PEAR_EXTENSION_DIR;
            PEAR2_Pyrus_Log::log(5, 'used PEAR_EXTENSION_DIR constant');
        }

        // set up default bin_dir
        if (getenv('PHP_PEAR_BIN_DIR')) {
            self::$defaults['bin_dir'] = getenv('PHP_PEAR_BIN_DIR');
            PEAR2_Pyrus_Log::log(5, 'used PHP_PEAR_BIN_DIR environment variable');
        } elseif (PATH_SEPARATOR == ';') {
            // we're on windows, and shouldn't use PHP_BINDIR
            do {
                if (!isset($_ENV) || !isset($_ENV['PATH'])) {
                    $path = getenv('PATH');
                } else {
                    $path = $_ENV['PATH'];
                }

                if (!$path) {
                    PEAR2_Pyrus_Log::log(5, 'used PHP_BINDIR on windows for bin_dir default');
                    break; // can't get PATH, so use PHP_BINDIR
                }

                $paths = explode(';', $path);
                foreach ($paths as $path) {
                    if ($path != '.' && is_writable($path)) {
                        // this place will do
                        PEAR2_Pyrus_Log::log(5, 'used ' . $path . ' for default bin_dir');
                        self::$defaults['bin_dir'] = $path;
                    }
                }
            } while (false);
        } else {
            PEAR2_Pyrus_Log::log(5, 'used PHP_BINDIR for bin_dir default');
        }

        // construct php_bin
        if (substr(PHP_OS, 0, 3) == 'WIN') {
            if (file_exists(self::$defaults['bin_dir'] . DIRECTORY_SEPARATOR . 'php.exe')) {
                self::$defaults['php_bin'] = self::$defaults['bin_dir'] . DIRECTORY_SEPARATOR . 'php.exe';
            } else {
                foreach (explode(PATH_SEPARATOR, $_ENV['PATH']) as $path) {
                    if (file_exists($path . DIRECTORY_SEPARATOR . 'php.exe')) {
                        self::$defaults['php_bin'] = $path . DIRECTORY_SEPARATOR . 'php.exe';
                    }
                }
            }
        } else {
            if (file_exists(self::$defaults['bin_dir'] . DIRECTORY_SEPARATOR . 'php')) {
                self::$defaults['php_bin'] = self::$defaults['bin_dir'] . DIRECTORY_SEPARATOR . 'php';
            } elseif (isset($_ENV['PATH'])) {
                foreach (explode(PATH_SEPARATOR, $_ENV['PATH']) as $path) {
                    if (file_exists($path . DIRECTORY_SEPARATOR . 'php')) {
                        self::$defaults['php_bin'] = $path . DIRECTORY_SEPARATOR . 'php';
                    }
                }
            }
        }

        foreach (array_merge(self::$pearConfigNames,
                             self::$userConfigNames) as $name) {
            // make sure we've got valid paths for the underlying OS
            self::$defaults[$name] = str_replace('/', DIRECTORY_SEPARATOR,
                                                 self::$defaults[$name]);
        }

        self::$defaults['php_ini'] = php_ini_loaded_file();
        if (self::$defaults['php_ini']) {
            PEAR2_Pyrus_Log::log(5, 'Used ' . self::$defaults['php_ini'] . ' for php.ini location');
        } else {
            PEAR2_Pyrus_Log::log(5, 'Could not find php.ini');
        }
    }

    /**
     * parse a configuration for a PEAR2 installation
     *
     * @param string $pearDirectory This can be either a single path, or a
     *                              PATH_SEPARATOR-separated list of directories
     * @param string $userfile
     */
    protected function __construct($pearDirectory = false, $userfile = false)
    {
        self::$initializing = true;
        self::constructDefaults();
        if ($pearDirectory) {
            $pearDirectory = str_replace(array('\\', '//', '/'),
                                         array('/',  '/', DIRECTORY_SEPARATOR),
                                         $pearDirectory);
        }

        $this->loadUserSettings($pearDirectory, $userfile);
        $pearDirectory = $this->setupCascadingRegistries($pearDirectory);
        if ($pearDirectory) {
            $this->loadConfigFile($pearDirectory);
        }
        self::$configs[$pearDirectory] = $this;
        $this->pearDir = $pearDirectory;

        // Always set the current config to the most recently created one.
        self::$current = $this;
        self::$initializing = false;
    }

    static function initializing()
    {
        return self::$initializing;
    }

    /**
     * Retrieve configuration for a PEAR2 installation
     *
     * @param string $pearDirectory
     * @param string $userfile
     * @return PEAR2_Pyrus_Config
     */
    static public function singleton($pearDirectory = false, $userfile = false)
    {
        if ($pearDirectory && file_exists($pearDirectory)) {
            $pearDirectory = realpath($pearDirectory);
        }
        if (isset(self::$configs[$pearDirectory])) {
            return self::$configs[$pearDirectory];
        }
        self::$configs[$pearDirectory] = new static($pearDirectory, $userfile);
        return self::$configs[$pearDirectory];
    }

    /**
     * set the paths to scan for pyrus installations
     */
    public function setCascadingRegistries($path)
    {
        $paths = explode(PATH_SEPARATOR, $path);

        $paths = array_unique($paths);
        $readonly = false;
        foreach ($paths as $path) {
            try {
                if ($path === '.') continue;
                
                $registry_class        = PEAR2_Pyrus_Registry::$className;
                $channelregistry_class = PEAR2_Pyrus_ChannelRegistry::$className;

                $registries = PEAR2_Pyrus_Registry::detectRegistries($path);
                if (!count($registries)) {
                    if ($readonly) {
                        // no installation present
                        continue;
                    }
                    $registries = array('Sqlite3', 'Xml');
                }

                $registry         = new $registry_class($path, $registries, $readonly);
                $channel_registry = new $channelregistry_class($path, $registries, $readonly);
                
                if (!$readonly) {
                    $this->myregistry        = $registry;
                    $this->mychannelRegistry = $channel_registry;
                }

                $readonly = true;
                
                $registry->setParent(); // clear any previous parent
                $channel_registry->setParent(); // clear any previous parent
                
                if (isset($last)) {
                    $last->setParent($registry);
                    $lastc->setParent($channel_registry);
                }

                $last  = $registry;
                $lastc = $channel_registry;
                
            } catch (Exception $e) {
                if (!$readonly) {
                    throw new PEAR2_Pyrus_Config_Exception(
                        'Cannot initialize primary registry in path ' .
                        $path, $e);
                } else {
                    // silently skip this registry
                    continue;
                }
            }
        }
        return $paths[0];
    }

    /**
     * @var string path to the configuration to set as the current config
     */
    static public function setCurrent($path)
    {
        if (isset(self::$configs[$path])) {
            self::$current = self::$configs[$path];
        } else {
            static::singleton($path);
        }
    }

    /**
     * Retrieve the currently active primary configuration
     * @return PEAR2_Pyrus_Config
     */
    static public function current()
    {
        if (isset(self::$current)) {
            return self::$current;
        }
        // default
        return static::singleton();
    }

    /**
     * Can be used to determine whether this user has ever run pyrus before
     */
    static public function userInitialized()
    {
        $userfile = static::getDefaultUserConfigFile();
        if (isset(self::$current)) {
            if (self::$current->userfile != $userfile) {
                // an explicit userfile was specified, so we assume this was intentional
                return true;
            }
        }
        if (!file_exists($userfile)) {
            // try cwd, this could work
            $test = realpath(getcwd() . DIRECTORY_SEPARATOR . 'pearconfig.xml');
            if ($test && file_exists($test)) {
                PEAR2_Pyrus_Log::log(5, 'User is initialized, found user configuration file in current directory' .
                    $userfile);
                return true;
            }
        } else {
            PEAR2_Pyrus_Log::log(5, 'User is initialized, found default user configuration file ' .
                $userfile);
            return true;
        }
        // no way to tell, must be explicit
        return false;
    }

    static public function getDefaultUserConfigFile()
    {
        if (class_exists('COM', false)) {
            return self::locateLocalSettingsDirectory() . DIRECTORY_SEPARATOR .
                'pear' . DIRECTORY_SEPARATOR . 'pearconfig.xml';
        } else {
            return self::locateLocalSettingsDirectory() . DIRECTORY_SEPARATOR .
                '.pear' . DIRECTORY_SEPARATOR . 'pearconfig.xml';
        }
    }

    /**
     * determines where user-specific configuration files should be saved.
     *
     * On unix, this is ~user/ or a location in /tmp based on the current directory.
     * On windows, this is your Documents and Settings folder.
     * @return string
     */
    static protected function locateLocalSettingsDirectory()
    {
        if (class_exists('COM', false)) {
            $shell = new COM('Wscript.Shell');
            $value = $shell->SpecialFolders('MyDocuments');
            return $value;
        }

        if (isset($_ENV['HOME'])) {
            return $_ENV['HOME'];
        } elseif ($e = getenv('HOME')) {
            return $e;
        }

        if (isset($_ENV['PWD'])) {
            $cwd = $_ENV['PWD'];
        } else {
            $cwd = getcwd();
        }
        
        return '/tmp/' . md5($cwd);
        
    }

    /**
     * Load the user configuration file
     *
     * This loads exclusively the user config
     * @return string path to the PEAR installation we are using
     */
    protected function loadUserSettings($pearDirectory, $userfile = false)
    {
        if (!$userfile) {
            if (self::$explicitUserConfig) {
                // never attempt to reload unless the user says so explicitly
                $this->userFile = self::$lastUserConfig;
                return;
            }
            $userfile = static::getDefaultUserConfigFile();

            if (!file_exists($userfile)) {
                $test = realpath(getcwd() . DIRECTORY_SEPARATOR . 'pearconfig.xml');
                if ($test && file_exists($test)) {
                    PEAR2_Pyrus_Log::log(5, 'Found user configuration file in current directory' .
                        $userfile);
                    $userfile = $test;
                }
            } else {
                PEAR2_Pyrus_Log::log(5, 'Found default user configuration file ' .
                    $userfile);
            }
        } else {
            self::$explicitUserConfig = true;
            PEAR2_Pyrus_Log::log(5, 'Using explicit user configuration file ' . $userfile);
        }

        $this->userFile = $userfile;
        self::$lastUserConfig = $userfile;
        if (!$userfile || !file_exists($userfile)) {
            PEAR2_Pyrus_Log::log(5, 'User configuration file ' . $userfile . ' not found');
            return;
        }

        if (isset(self::$userConfigs[$userfile])) {
            return;
        }

        libxml_use_internal_errors(true);
        libxml_clear_errors();
        $x = simplexml_load_file($userfile);
        if (!$x) {
            $errors = libxml_get_errors();
            $e = new PEAR2_MultiErrors;
            foreach ($errors as $err) {
                $e->E_ERROR[] = new PEAR2_Pyrus_Config_Exception(trim($err->message));
            }
            libxml_clear_errors();
            throw new PEAR2_Pyrus_Config_Exception(
                'Unable to parse invalid user PEAR configuration at "' . $userfile . '"',
                $e);
        }

        $unsetvalues = array_diff(array_keys((array) $x), array_merge(self::$userConfigNames, self::$customUserConfigNames));
        // remove values that are not recognized user config variables
        foreach ($unsetvalues as $value) {
            if ($value == '@attributes') {
                continue;
            }
            PEAR2_Pyrus_Log::log(5, 'Removing unrecognized user configuration value ' .
                $value);
            unset($x->$value);
        }

        if (self::initializing()) {
            self::$userConfigs[$userfile] = (array) $x;
            return;
        }
        $this->setupCascadingRegistries($pearDirectory);

        self::$userConfigs[$userfile] = (array) $x;
    }

    /**
     * automatically cascade include_path here if necessary
     */
    function cascadePath($pearDirectory)
    {
        $paths = explode(PATH_SEPARATOR, $pearDirectory);
        $primary = $paths[0];
        if (count($paths) == 1) {
            // add registries within include_path by default
            // if explicit path is specified, user knows what they
            // are doing, don't add include_path
            $include_path = explode(PATH_SEPARATOR, get_include_path());
            foreach ($include_path as $i => $path) {
                if ($path === '.') {
                    continue;
                }
                if (substr($path, strlen($path) - 3) == 'php' && $path[strlen($path) - 4] == DIRECTORY_SEPARATOR) {
                    // include_path goes to the php_dir which is always php, so our config
                    // file is in the parent directory.
                    $extra[] = dirname($path);
                } else {
                    $extra[] = $path;
                }
            }
            PEAR2_Pyrus_Log::log(1, 'Automatically cascading include_path components ' . implode(', ', $extra));
            array_unshift($extra, $primary);
            $paths = $extra;
        }
        $paths = array_unique($paths);
        $pearDirectory = implode(PATH_SEPARATOR, $paths);
        return $pearDirectory;
    }

    function setupCascadingRegistries($pearDirectory)
    {
        if (!$this->my_pear_path) {
            if (!$pearDirectory) {
                $pearDirectory = getcwd();
            }
            $this->my_pear_path = $this->cascadePath($pearDirectory);
            PEAR2_Pyrus_Log::log(5, 'Assuming my_pear_path is ' . $this->my_pear_path);
            $pearDirectory = $this->setCascadingRegistries($this->my_pear_path);
        } else {
            if (!$pearDirectory) {
                $pearDirectory = $this->setCascadingRegistries((string) $this->my_pear_path);
            } else {
                // ensure that $pearDirectory is a part of this cascading directory path
                $pearDirectory = $this->setCascadingRegistries((string)$pearDirectory .
                        PATH_SEPARATOR . $this->my_pear_path);
            }
        }

        return $pearDirectory;
    }

    /**
     * Extract configuration from system + user configuration files
     *
     * Configuration is stored in XML format, in two locations.
     *
     * The system configuration contains all of the important directory
     * configuration variables like data_dir, and the location of php.ini and
     * the php executable php.exe or php.  This configuration is tightly bound
     * to the repository, and cannot be moved.  As such, php_dir is auto-defined
     * as dirname(/path/to/pear/.config), or /path/to/pear.
     *
     * Only 1 user configuration file is allowed, and contains user-specific
     * settings, including the locations where to download package releases
     * and where to cache files downloaded from the internet.  If false is passed
     * in, PEAR2_Pyrus_Config will attempt to guess at the config file location as
     * documented in the class docblock {@link PEAR2_Pyrus_Config}.
     * @param string $pearDirectory
     * @param string|false $userfile
     */
    protected function loadConfigFile($pearDirectory)
    {
        if (isset(self::$configs[$pearDirectory]) ||
              !file_exists($pearDirectory . DIRECTORY_SEPARATOR . '.config')) {
            PEAR2_Pyrus_Log::log(5, 'Configuration not found for ' . $pearDirectory .
                ', assuming defaults');
            return;
        }
        PEAR2_Pyrus_Log::log(5, 'Loading configuration for ' . $pearDirectory);
        $this->helperLoadConfigFile($pearDirectory, $pearDirectory . DIRECTORY_SEPARATOR . '.config');
    }

    protected function helperLoadConfigFile($pearDirectory, $file, $extrainfo = '')
    {
        if ($extrainfo) {
            $extrainfo .= ' ';
        }
        libxml_use_internal_errors(true);
        libxml_clear_errors();
        $x = simplexml_load_file($file);
        if (!$x) {
            $errors = libxml_get_errors();
            $e = new PEAR2_MultiErrors;
            foreach ($errors as $err) {
                $e->E_ERROR[] = new PEAR2_Pyrus_Config_Exception(trim($err->message));
            }
            libxml_clear_errors();
            throw new PEAR2_Pyrus_Config_Exception(
                'Unable to parse invalid PEAR configuration ' . $extrainfo . 'at "' . $pearDirectory . '"',
                $e);
        }

        $unsetvalues = array_diff($keys = array_keys((array) $x), array_merge(self::$pearConfigNames, self::$customPearConfigNames));
        // remove values that are not recognized system config variables
        // both data_dir and php_dir are abstract values, delete them if present
        $unsetvalues[] = 'php_dir';
        $unsetvalues[] = 'data_dir';
        foreach ($unsetvalues as $value) {
            if (!in_array($value, $keys)) {
                continue;
            }

            PEAR2_Pyrus_Log::log(5, 'Removing unrecognized configuration ' . $extrainfo . 'value ' .
                $value);
            unset($x->$value);
        }
        $this->values = (array) $x;
    }

    /**
     * Save both the user configuration file and the system file
     *
     * If the userfile is not passed in, it is saved in the default
     * location which is either in ~/.pear/pearconfig.xml or on Windows
     * in the Documents and Settings directory
     * @param string $userfile path to alternate user configuration file
     */
    function saveConfig($userfile = false)
    {
        if (!$userfile) {
            if ($this->userFile) {
                $userfile = $this->userFile;
            } else {
                $userfile = self::getDefaultUserConfigFile();
            }
        }

        $userfile = str_replace(array('\\', '//', '/'),
                                array('/',  '/', DIRECTORY_SEPARATOR),
                                $userfile);

        $test = $userfile;
        while ($test && !file_exists($test)) {
            $test = dirname($test);
        }

        if (!is_writable($test)) {
            throw new PEAR2_Pyrus_Config_Exception('Cannot save configuration, no' .
                ' filesystem permissions to modify user configuration file ' . $userfile);
        }

        $test = $this->pearDir . '.config';
        while ($test && !file_exists($test)) {
            $test = dirname($test);
        }

        if (!is_writable($test)) {
            throw new PEAR2_Pyrus_Config_Exception('Cannot save configuration, no' .
                ' filesystem permissions to modify PEAR directory ' . $this->pearDir . '.config');
        }

        $x = simplexml_load_string('<pearconfig version="1.0"></pearconfig>');
        foreach (self::$userConfigNames as $var) {
            $x->$var = (string) $this->$var;
        }

        foreach (self::$customUserConfigNames as $var) {
            $x->$var = (string) $this->$var;
        }

        $userfiledir = dirname($userfile);
        if (!file_exists($userfiledir) && !@mkdir($userfiledir, 0777, true)) {
            throw new PEAR2_Pyrus_Config_Exception(
                'Unable to create directory ' . $userfiledir . ' to save ' .
                'user configuration ' . $userfile);
        }
        file_put_contents($userfile, $x->asXML());

        if (!isset(static::$configDirty[$this->pearDir])) {
            // no changes have been made to the config, no need to write it out
            return;
        }

        $system = $this->pearDir . '.config';
        if (dirname($system) != $this->pearDir) {
            $system = $this->pearDir . DIRECTORY_SEPARATOR . '.config';
        }
        if (!file_exists(dirname($system)) && !@mkdir(dirname($system), 0777, true)) {
            throw new PEAR2_Pyrus_Config_Exception(
                'Unable to create directory ' . dirname($system) . ' to save ' .
                'system configuration ' . $system);
        }

        $x = simplexml_load_string('<pearconfig version="1.0"></pearconfig>');
        $path = dirname($system) . DIRECTORY_SEPARATOR;
        foreach (self::$pearConfigNames as $var) {
            if ($var === 'php_dir' || $var === 'data_dir') {
                continue; // both of these are abstract
            }
            $x->$var = $this->$var;
        }

        foreach (self::$customPearConfigNames as $var) {
            $x->$var = $this->$var;
        }
        file_put_contents($system, $x->asXML());
        unset(static::$configDirty[$this->pearDir]);
        // save a snapshot for installation purposes
        static::configSnapshot();
    }

    /**
     * Save a snapshot of the current config, and return the file name
     *
     * If the latest snapshot is the same as the existing configuration,
     * simply return the filename
     * @return string basename of the snapshot file of the current configuration
     */
    static public function configSnapshot()
    {
        $conf = self::current();
        $snapshotdir = $conf->pearDir . DIRECTORY_SEPARATOR . '.configsnapshots';
        if (!file_exists($snapshotdir)) {
            // this will be simple - no snapshots exist yet
            if (!@mkdir($snapshotdir, 0755, true)) {
                throw new PEAR2_Pyrus_Config_Exception(
                    'Unable to create directory ' . $snapshotdir . ' to save ' .
                    'system configuration snapshots');
            }

            $snapshot = 'configsnapshot-' . date('Y-m-d H:i:s') . '.xml';
            $x = simplexml_load_string('<pearconfig version="1.0"></pearconfig>');
            foreach (self::$pearConfigNames as $var) {
                $x->$var = $conf->$var;
            }

            foreach (self::$customPearConfigNames as $var) {
                $x->$var = $conf->$var;
            }

            PEAR2_Pyrus_Log::log(5, 'Saving configuration snapshot ' . $snapshot);
            file_put_contents($snapshotdir . DIRECTORY_SEPARATOR . $snapshot, $x->asXML());
            return $snapshot;
        }
        // scan existing snapshots, if any, for a match
        $dir = opendir($snapshotdir);
        while (false !== ($snapshot = readdir($dir))) {
            if ($snapshot[0] == '.') continue;
            $x = simplexml_load_file($snapshotdir . DIRECTORY_SEPARATOR . $snapshot);
            foreach (self::$pearConfigNames as $var) {
                if ($x->$var != $conf->$var) continue 2;
            }

            foreach (self::$customPearConfigNames as $var) {
                if (!isset($x->var) || $x->$var != $conf->$var) continue 2;
            }

            // found a match
            PEAR2_Pyrus_Log::log(5, 'Found matching configuration snapshot ' . $snapshot);
            return $snapshot;
        }
        PEAR2_Pyrus_Log::log(5, 'No matching configuration snapshot found');
        // no matches found
        $snapshot = 'configsnapshot-' . date('Y-m-d H:i:s') . '.xml';
        $i = 0;
        while (file_exists($snapshotdir . DIRECTORY_SEPARATOR . $snapshot)) {
            $i++;
            // keep appending ".1" until we get a unique filename
            $snapshot = 'configsnapshot-' . date('Y-m-d H:i:s') . str_repeat('.1', $i) . '.xml';
        }
        // save the snapshot
        $x = simplexml_load_string('<pearconfig version="1.0"></pearconfig>');
        foreach (self::$pearConfigNames as $var) {
            $x->$var = $conf->$var;
        }

        foreach (self::$customPearConfigNames as $var) {
            $x->$var = $conf->$var;
        }

        PEAR2_Pyrus_Log::log(5, 'Saving configuration snapshot ' . $snapshot);
        file_put_contents($snapshotdir . DIRECTORY_SEPARATOR . $snapshot, $x->asXML());
        return $snapshot;
    }

    /**
     * Load a configuration
     */
    static public function addConfigValue($key, $default, $system = true)
    {
        if (in_array($key, self::$magicVars, true)) {
            throw new PEAR2_Pyrus_Config_Exception('Invalid custom configuration variable '
                                                   . $key . ', already in use for retrieving configuration information');
        }

        if (!preg_match('/^[a-z0-9-_]+\\z/', $key)) {
            throw new PEAR2_Pyrus_Config_Exception('Invalid custom configuration variable name "'.  $key . '"');
        }

        if ($system) {
            if (in_array($key, self::$pearConfigNames)) {
                throw new PEAR2_Pyrus_Config_Exception('Cannot override existing configuration value "' . $key . '"');
            }

            if (in_array($key, self::$customPearConfigNames)) {
                throw new PEAR2_Pyrus_Config_Exception('Cannot override existing custom configuration value "' . $key . '"');
            }

            if (in_array($key, self::$userConfigNames)) {
                throw new PEAR2_Pyrus_Config_Exception('Cannot override existing user configuration value "' . $key . '" with system value');
            }

            if (in_array($key, self::$customUserConfigNames)) {
                throw new PEAR2_Pyrus_Config_Exception('Cannot override existing custom user configuration value "' . $key . '" with system value');
            }
            $var = 'customPearConfigNames';
        } else {
            if (in_array($key, self::$userConfigNames)) {
                throw new PEAR2_Pyrus_Config_Exception('Cannot override existing configuration value "' . $key . '"');
            }

            if (in_array($key, self::$customUserConfigNames)) {
                throw new PEAR2_Pyrus_Config_Exception('Cannot override existing custom configuration value "' . $key . '"');
            }

            if (in_array($key, self::$pearConfigNames)) {
                throw new PEAR2_Pyrus_Config_Exception('Cannot override existing configuration value "' . $key . '" with user value');
            }

            if (in_array($key, self::$customPearConfigNames)) {
                throw new PEAR2_Pyrus_Config_Exception('Cannot override existing custom system configuration value "' . $key . '" with user value');
            }
            $var = 'customUserConfigNames';
        }
        self::${$var}[count(self::${$var})] = $key;
        self::$customDefaults[$key] = $default;
    }

    public function defaultValue($key)
    {
        if (isset(self::$defaults[$key])) {
            if ($key === 'verbose') {
                // this prevents a rather nasty loop if logging is checking on verbose
                return self::$defaults['verbose'];
            }
            PEAR2_Pyrus_Log::log(5, 'Replacing @php_dir@ for config variable ' .
                                 $key .
                ' default value "' . self::$defaults[$key] . '"');
            $ret = str_replace('@php_dir@', $this->pearDir, self::$defaults[$key]);
            PEAR2_Pyrus_Log::log(5, 'Replacing @default_config_dir@ for config variable ' .
                                 $key .
                ' default value "' . self::$defaults[$key] . '"');
            return str_replace('@default_config_dir@', dirname($this->userFile), $ret);
        }
        PEAR2_Pyrus_Log::log(5, 'Replacing @php_dir@ for config variable ' .
                             $key .
            ' default value "' . self::$customDefaults[$key] . '"');
        $ret = str_replace('@php_dir@', $this->pearDir, self::$customDefaults[$key]);
        PEAR2_Pyrus_Log::log(5, 'Replacing @default_config_dir@ for config variable ' .
                             $key .
            ' default value "' . self::$customDefaults[$key] . '"');
        return str_replace('@default_config_dir@', dirname($this->userFile), $ret);
    }

    public function __get($key)
    {
        if (in_array($key, array_merge(self::$pearConfigNames, self::$userConfigNames,
                                          self::$customPearConfigNames,
                                          self::$customUserConfigNames))) {
            if ((!isset(self::$userConfigs[$this->userFile][$key])
                && !isset($this->values[$key])) || $key === 'php_dir'
                || $key === 'data_dir'
            ) {
                if (isset(self::$defaults[$key])) {
                    if ($key === 'verbose') {
                        // this prevents a rather nasty loop if logging is checking on verbose
                        return self::$defaults['verbose'];
                    }
                    PEAR2_Pyrus_Log::log(5, 'Replacing @php_dir@ for config variable ' .
                                         $key .
                        ' default value "' . self::$defaults[$key] . '"');
                    $ret = str_replace('@php_dir@', $this->pearDir, self::$defaults[$key]);
                    PEAR2_Pyrus_Log::log(5, 'Replacing @default_config_dir@ for config variable ' .
                                         $key .
                        ' default value "' . self::$defaults[$key] . '"');
                    return str_replace('@default_config_dir@', dirname($this->userFile), $ret);
                } else {
                    PEAR2_Pyrus_Log::log(5, 'Replacing @php_dir@ for config variable ' .
                                         $key .
                        ' default value "' . self::$customDefaults[$key] . '"');
                    $ret = str_replace('@php_dir@', $this->pearDir, self::$customDefaults[$key]);
                    PEAR2_Pyrus_Log::log(5, 'Replacing @default_config_dir@ for config variable ' .
                                         $key .
                        ' default value "' . self::$customDefaults[$key] . '"');
                    return str_replace('@default_config_dir@', dirname($this->userFile), $ret);
                }
            }

            if (in_array($key, array_merge(self::$pearConfigNames,
                                             self::$customPearConfigNames))) {
                PEAR2_Pyrus_Log::log(5, 'Replacing @php_dir@ for config variable ' . $key .
                    ' value "' . $this->values[$key] . '"');
                $ret = str_replace('@php_dir@', $this->pearDir, $this->values[$key]);
                PEAR2_Pyrus_Log::log(5, 'Replacing @default_config_dir@ for config variable ' .
                                     $key .
                    ' default value "' . $this->values[$key] . '"');
                return str_replace('@default_config_dir@', dirname($this->userFile), $ret);
            }

            return self::$userConfigs[$this->userFile][$key];
        }

        if ($key == 'registry') {
            return $this->myregistry;
        }

        if ($key == 'pluginregistry') {
            if (!isset($this->mypluginregistry)) {
                $this->mypluginregistry = new PEAR2_Pyrus_PluginRegistry($this->__get('plugins_dir'));
            }
            return $this->mypluginregistry;
        }

        if ($key == 'channelregistry') {
            return $this->mychannelRegistry;
        }

        if ($key == 'systemvars') {
            return array_merge(self::$pearConfigNames, self::$customPearConfigNames);
        }

        if ($key == 'uservars') {
            return array_merge(self::$userConfigNames, self::$customUserConfigNames);
        }

        if ($key == 'mainsystemvars') {
            return self::$pearConfigNames;
        }

        if ($key == 'mainuservars') {
            return self::$userConfigNames;
        }

        if ($key == 'userfile') {
            return $this->userFile;
        }

        if ($key == 'path') {
            return $this->pearDir;
        }

        if ($key == 'customsystemvars') {
            return self::$customPearConfigNames;
        }

        if ($key == 'customuservars') {
            return self::$customUserConfigNames;
        }

        throw new PEAR2_Pyrus_Config_Exception(
            'Unknown configuration variable "' . $key . '" in location ' .
            $this->pearDir);
    }

    public function __unset($key)
    {
        if (in_array($key, self::$magicVars, true)) {
            throw new PEAR2_Pyrus_Config_Exception('Cannot unset magic value ' . $key);
        }

        if ($key === 'php_dir' || $key === 'data_dir') {
            throw new PEAR2_Pyrus_Config_Exception('Cannot unset ' . $key);
        }

        if (isset($this->values[$key])) {
            unset($this->values[$key]);
            static::$configDirty[$this->pearDir] = 1;
            return;
        }

        if (isset(self::$userConfigs[$this->userFile][$key])) {
            unset(self::$userConfigs[$this->userFile][$key]);
        }
    }

    public function __isset($key)
    {
        if (in_array($key, self::$magicVars, true)) {
            return true;
        }

        if ($key === 'php_dir' || $key === 'data_dir') {
            return true;
        }

        if (in_array($key, self::$pearConfigNames)
            || in_array($key, self::$customPearConfigNames)) {
            return isset($this->values[$key]);
        }

        return isset(self::$userConfigs[$this->userFile][$key]);
    }

    public function __set($key, $value)
    {
        if (in_array($key, self::$magicVars, true)) {
            throw new PEAR2_Pyrus_Config_Exception('Cannot set magic configuration variable ' . $key);
        }

        if ($key == 'php_dir') {
            throw new PEAR2_Pyrus_Config_Exception('Cannot set php_dir, move the repository to change this value');
        }

        if ($key == 'data_dir') {
            throw new PEAR2_Pyrus_Config_Exception('Cannot set data_dir, move the repository to change this value');
        }

        if (!isset(self::$defaults[$key]) && !isset(self::$customDefaults[$key])) {
            throw new PEAR2_Pyrus_Config_Exception(
                'Unknown configuration variable "' . $key . '" in location ' .
                $this->pearDir);
        }

        if (in_array($key, self::$pearConfigNames)
            || in_array($key, self::$customPearConfigNames)) {
            $this->values[$key] = $value;
            static::$configDirty[$this->pearDir] = 1;
            return;
        }

        self::$userConfigs[$this->userFile][$key] = $value;
    }

    /**
     * Parse a string to determine which package file is requested
     *
     * This differentiates between the three kinds of packages:
     *
     *  - local files
     *  - remote static URLs
     *  - dynamic abstract package names
     * @param string $pname
     * @return string|array A string is returned if this is a file, otherwise an array
     *                      containing information is returned
     */
    static public function parsePackageName($pname, $assumeabstract = false)
    {
        if (!$assumeabstract && @file_exists($pname) && @is_file($pname)) {
            return $pname;
        }
        return self::current()->channelregistry->parseName($pname);
    }

    static public function parsedPackageNameToString($name)
    {
        return self::current()->channelregistry->parsedNameToString($name);
    }
}
<?php
/**
 * PEAR2_Pyrus_Dependency_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception for dependencies
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Dependency_Exception extends PEAR2_Exception {}<?php
/**
 * PEAR2_Pyrus_Dependency_Validator, advanced dependency validation
 *
 * PHP versions 4 and 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Dependency check for PEAR2 packages
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Dependency_Validator
{
    /**
     * @var PEAR2_MultiErrors
     */
    protected $errs;
    /**
     * One of the PEAR2_Pyrus_Validate::* states
     * @see PEAR2_Pyrus_Validate::NORMAL
     * @var integer
     */
    var $_state;
    /**
     * @var PEAR2_Pyrus_OSGuess
     */
    var $_os;
    /**
     * Package to validate
     * @var PEAR2_Pyrus_Package
     */
    var $_currentPackage;
    /**
     * @param PEAR2_Pyrus_Package
     * @param int installation state (one of PEAR2_Pyrus_Validate::*)
     * @param PEAR2_MultiErrors
     */
    function __construct($package, $state = PEAR2_Pyrus_Validate::INSTALLING,
                         PEAR2_MultiErrors $errs)
    {
        $this->_state = $state;
        $this->_currentPackage = $package;
        $this->errs = $errs;
    }

    function _getExtraString($dep)
    {
        $extra = ' (';
        if ($dep->type != 'extension' && isset($dep->uri)) {
            return '';
        }
        if (isset($dep->recommended)) {
            $extra .= 'recommended version ' . $dep->recommended;
        } else {
            if (isset($dep->min)) {
                $extra .= 'version >= ' . $dep->min;
            }
            if (isset($dep->max)) {
                if ($extra != ' (') {
                    $extra .= ', ';
                }
                $extra .= 'version <= ' . $dep->max;
            }
            if (isset($dep->exclude)) {
                if (!is_array($dep->exclude)) {
                    $dep->exclude = array($dep->exclude);
                }
                if ($extra != ' (') {
                    $extra .= ', ';
                }
                $extra .= 'excluded versions: ';
                foreach ($dep->exclude as $i => $exclude) {
                    if ($i) {
                        $extra .= ', ';
                    }
                    $extra .= $exclude;
                }
            }
        }
        $extra .= ')';
        if ($extra == ' ()') {
            $extra = '';
        }
        return $extra;
    }

    /**
     * This makes unit-testing a heck of a lot easier
     */
    function getPHP_OS()
    {
        return PHP_OS;
    }

    /**
     * This makes unit-testing a heck of a lot easier
     */
    function getsysname()
    {
        $this->_os = new PEAR2_Pyrus_OSGuess;
        return $this->_os->getSysname();
    }

    /**
     * Specify a dependency on an OS.  Use arch for detailed os/processor information
     *
     * There are two generic OS dependencies that will be the most common, unix and windows.
     * Other options are linux, freebsd, darwin (OS X), sunos, irix, hpux, aix
     */
    function validateOsDependency(PEAR2_Pyrus_PackageFile_v2_Dependencies_Dep $dep)
    {
        if ($this->_state != PEAR2_Pyrus_Validate::INSTALLING &&
              $this->_state != PEAR2_Pyrus_Validate::DOWNLOADING) {
            return true;
        }
        if ($dep->name == '*') {
            return true; // no one will do conflicts with *, so assume no conflicts
        }
        switch (strtolower($dep->name)) {
            case 'windows' :
                if ($dep->conflicts) {
                    if (strtolower(substr($this->getPHP_OS(), 0, 3)) == 'win') {
                        if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) &&
                              !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                            return $this->raiseError("Cannot install %s on Windows");
                        } else {
                            return $this->warning("warning: Cannot install %s on Windows");
                        }
                    }
                } else {
                    if (strtolower(substr($this->getPHP_OS(), 0, 3)) != 'win') {
                        if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) &&
                              !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                            return $this->raiseError("Can only install %s on Windows");
                        } else {
                            return $this->warning("warning: Can only install %s on Windows");
                        }
                    }
                }
            break;
            case 'unix' :
                $unices = array('linux', 'freebsd', 'darwin', 'sunos', 'irix', 'hpux', 'aix');
                if ($dep->conflicts) {
                    if (in_array(strtolower($this->getSysname()), $unices)) {
                        if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) &&
                              !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                            return $this->raiseError("Cannot install %s on any Unix system");
                        } else {
                            return $this->warning(
                                "warning: Cannot install %s on any Unix system");
                        }
                    }
                } else {
                    if (!in_array(strtolower($this->getSysname()), $unices)) {
                        if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) &&
                              !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                            return $this->raiseError("Can only install %s on a Unix system");
                        } else {
                            return $this->warning(
                                "warning: Can only install %s on a Unix system");
                        }
                    }
                }
            break;
            default :
                if ($dep->conflicts) {
                    if (strtolower($dep->name) == strtolower($this->getSysname())) {
                        if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) &&
                              !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                            return $this->raiseError('Cannot install %s on ' . $dep->name .
                                ' operating system');
                        } else {
                            return $this->warning('warning: Cannot install %s on ' .
                                $dep->name . ' operating system');
                        }
                    }
                } else {
                    if (strtolower($dep->name) != strtolower($this->getSysname())) {
                        if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) &&
                              !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                            return $this->raiseError('Cannot install %s on ' .
                                $this->getSysname() .
                                ' operating system, can only install on ' . $dep->name);
                        } else {
                            return $this->warning('warning: Cannot install %s on ' .
                                $this->getSysname() .
                                ' operating system, can only install on ' . $dep->name);
                        }
                    }
                }
        }
        return true;
    }

    /**
     * This makes unit-testing a heck of a lot easier
     */
    function matchSignature($pattern)
    {
        $this->_os = new PEAR2_Pyrus_OSGuess;
        return $this->_os->matchSignature($pattern);
    }

    /**
     * Specify a complex dependency on an OS/processor/kernel version,
     * Use OS for simple operating system dependency.
     *
     * This is the only dependency that accepts an eregable pattern.  The pattern
     * will be matched against the php_uname() output parsed by OS_Guess
     */
    function validateArchDependency($dep)
    {
        if ($this->_state != PEAR2_Pyrus_Validate::INSTALLING) {
            return true;
        }
        if ($this->matchSignature($dep->pattern)) {
            if ($dep->conflicts) {
                if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                    return $this->raiseError('%s Architecture dependency failed, cannot match "' .
                        $dep->pattern . '"');
                }
                return $this->warning('warning: %s Architecture dependency failed, ' .
                    'cannot match "' . $dep->pattern . '"');
            }
            return true;
        } else {
            if ($dep->conflicts) {
                return true;
            }
            if (!isset(PEAR2_Pyrus_Installer::$options['nodeps'])
                && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                return $this->raiseError('%s Architecture dependency failed, does not ' .
                    'match "' . $dep->pattern . '"');
            }
            return $this->warning('warning: %s Architecture dependency failed, does ' .
                'not match "' . $dep->pattern . '"');
        }
    }

    /**
     * This makes unit-testing a heck of a lot easier
     */
    function extension_loaded($name)
    {
        return extension_loaded($name);
    }

    /**
     * This makes unit-testing a heck of a lot easier
     */
    function phpversion($name = null)
    {
        if ($name !== null) {
            return phpversion($name);
        } else {
            return phpversion();
        }
    }

    function validateExtensionDependency(PEAR2_Pyrus_PackageFile_v2_Dependencies_Package $dep)
    {
        if ($this->_state != PEAR2_Pyrus_Validate::INSTALLING &&
              $this->_state != PEAR2_Pyrus_Validate::DOWNLOADING) {
            return true;
        }
        $required = $dep->deptype == 'required';
        $loaded = $this->extension_loaded($dep->name);
        $extra = $this->_getExtraString($dep);
        if (!isset($dep->min) && !isset($dep->max) &&
              !isset($dep->recommended) && !isset($dep->exclude)) {
            if ($loaded) {
                if ($dep->conflicts) {
                    if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                        return $this->raiseError('%s conflicts with PHP extension "' .
                            $dep->name . '"' . $extra);
                    } else {
                        return $this->warning('warning: %s conflicts with PHP extension "' .
                            $dep->name . '"' . $extra);
                    }
                }
                return true;
            } else {
                if ($dep->conflicts) {
                    return true;
                }
                if ($required) {
                    if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                        return $this->raiseError('%s requires PHP extension "' .
                            $dep->name . '"' . $extra);
                    } else {
                        return $this->warning('warning: %s requires PHP extension "' .
                            $dep->name . '"' . $extra);
                    }
                } else {
                    return $this->warning('%s can optionally use PHP extension "' .
                        $dep->name . '"' . $extra);
                }
            }
        }
        if (!$loaded) {
            if ($dep->conflicts) {
                return true;
            }
            if (!$required) {
                return $this->warning('%s can optionally use PHP extension "' .
                    $dep->name . '"' . $extra);
            } else {
                if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                    return $this->raiseError('%s requires PHP extension "' . $dep->name .
                        '"' . $extra);
                }
                    return $this->warning('warning: %s requires PHP extension "' . $dep->name .
                        '"' . $extra);
            }
        }
        $version = (string) $this->phpversion($dep->name);
        if (empty($version)) {
            $version = '0';
        }
        $fail = false;
        if (isset($dep->min)) {
            if (!version_compare($version, $dep->min, '>=')) {
                $fail = true;
            }
        }
        if (isset($dep->max)) {
            if (!version_compare($version, $dep->max, '<=')) {
                $fail = true;
            }
        }
        if ($fail && !$dep->conflicts) {
            if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                return $this->raiseError('%s requires PHP extension "' . $dep->name .
                    '"' . $extra . ', installed version is ' . $version);
            } else {
                return $this->warning('warning: %s requires PHP extension "' . $dep->name .
                    '"' . $extra . ', installed version is ' . $version);
            }
        } elseif (!isset($dep->exclude) && (isset($dep->min) || isset($dep->max)) && !$fail && $dep->conflicts) {
            if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                return $this->raiseError('%s conflicts with PHP extension "' .
                    $dep->name . '"' . $extra . ', installed version is ' . $version);
            } else {
                return $this->warning('warning: %s conflicts with PHP extension "' .
                    $dep->name . '"' . $extra . ', installed version is ' . $version);
            }
        }
        if (isset($dep->exclude)) {
            // exclude ordinarily tells the installer "install anything but these versions"
            // when paired with conflicts, it becomes "install only these versions"
            $conflicts = $dep->conflicts;
            foreach ($dep->exclude as $exclude) {
                if (version_compare($version, $exclude, '==')) {
                    if ($conflicts) {
                        $fail = false;
                        break;
                    }
                    goto conflict_error;
                } else {
                    if ($conflicts) {
                        $fail = true;
                    }
                }
            }
        }
        if ($fail) {
conflict_error:
            if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                return $this->raiseError('%s is not compatible with version ' . $version . ' of PHP extension "' .
                    $dep->name . '", installed version is ' . $version);
            } else {
                return $this->warning('warning: %s is not compatible with version ' . $version . ' of PHP extension "' .
                    $dep->name . '", installed version is ' . $version);
            }
        }
        if (isset($dep->recommended)) {
            if (version_compare($version, $dep->recommended, '==')) {
                return true;
            } else {
                if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                    return $this->raiseError('%s dependency: PHP extension ' . $dep->name .
                        ' version "' . $version . '"' .
                        ' is not the recommended version "' . $dep->recommended .
                        '", but may be compatible, use --force to install');
                } else {
                    return $this->warning('warning: %s dependency: PHP extension ' .
                        $dep->name . ' version "' . $version . '"' .
                        ' is not the recommended version "' . $dep->recommended . '"');
                }
            }
        }
        return true;
    }

    function validatePhpDependency(PEAR2_Pyrus_PackageFile_v2_Dependencies_Dep $dep)
    {
        if ($this->_state != PEAR2_Pyrus_Validate::INSTALLING &&
              $this->_state != PEAR2_Pyrus_Validate::DOWNLOADING) {
            return true;
        }
        $version = $this->phpversion();
        $extra = $this->_getExtraString($dep);
        if (isset($dep->min)) {
            if (!version_compare($version, $dep->min, '>=')) {
                if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                    return $this->raiseError('%s requires PHP' .
                        $extra . ', installed version is ' . $version);
                } else {
                    return $this->warning('warning: %s requires PHP' .
                        $extra . ', installed version is ' . $version);
                }
            }
        }
        if (isset($dep->max)) {
            if (!version_compare($version, $dep->max, '<=')) {
                if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                    return $this->raiseError('%s requires PHP' .
                        $extra . ', installed version is ' . $version);
                } else {
                    return $this->warning('warning: %s requires PHP' .
                        $extra . ', installed version is ' . $version);
                }
            }
        }
        if (isset($dep->exclude)) {
            foreach ($dep->exclude as $exclude) {
                if (version_compare($version, $exclude, '==')) {
                    if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) &&
                          !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                        return $this->raiseError('%s is not compatible with PHP version ' .
                            $exclude);
                    } else {
                        return $this->warning(
                            'warning: %s is not compatible with PHP version ' .
                            $exclude);
                    }
                }
            }
        }
        return true;
    }

    /**
     * This makes unit-testing a heck of a lot easier
     */
    function getPEARVersion()
    {
        return '2.0.0a1' === '@'.'PACKAGE_VERSION@' ? '2.0.0' : '2.0.0a1';
    }

    function validatePearinstallerDependency(PEAR2_Pyrus_PackageFile_v2_Dependencies_Dep $dep)
    {
        $pearversion = $this->getPEARVersion();
        $extra = $this->_getExtraString($dep);
        if (version_compare($pearversion, $dep->min, '<')) {
            if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                return $this->raiseError('%s requires PEAR Installer' . $extra .
                    ', installed version is ' . $pearversion);
            } else {
                return $this->warning('warning: %s requires PEAR Installer' . $extra .
                    ', installed version is ' . $pearversion);
            }
        }
        if (isset($dep->max)) {
            if (version_compare($pearversion, $dep->max, '>')) {
                if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                    return $this->raiseError('%s requires PEAR Installer' . $extra .
                        ', installed version is ' . $pearversion);
                } else {
                    return $this->warning('warning: %s requires PEAR Installer' . $extra .
                        ', installed version is ' . $pearversion);
                }
            }
        }
        if (isset($dep->exclude)) {
            foreach ($dep->exclude as $exclude) {
                if (version_compare($exclude, $pearversion, '==')) {
                    if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                        return $this->raiseError('%s is not compatible with PEAR Installer ' .
                            'version ' . $exclude);
                    } else {
                        return $this->warning('warning: %s is not compatible with PEAR ' .
                            'Installer version ' . $exclude);
                    }
                }
            }
        }
        return true;
    }

    function validateSubpackageDependency(PEAR2_Pyrus_PackageFile_v2_Dependencies_Package $dep, $params)
    {
        return $this->validatePackageDependency($dep, $params);
    }

    /**
     * @param array dependency information (2.0 format)
     * @param boolean whether this is a required dependency
     * @param array a list of downloaded packages to be installed, if any
     */
    function validatePackageDependency(PEAR2_Pyrus_PackageFile_v2_Dependencies_Package $dep, $params)
    {
        if ($this->_state != PEAR2_Pyrus_Validate::INSTALLING &&
              $this->_state != PEAR2_Pyrus_Validate::DOWNLOADING) {
            return true;
        }
        $required = $dep->deptype == 'required';
        if (isset($dep->providesextension)) {
            if ($this->extension_loaded($dep->providesextension)) {
                $req = $required ? 'required' : 'optional';
                $info = $dep->getInfo();
                $info['name'] = $info['providesextension'];
                $subdep = new PEAR2_Pyrus_PackageFile_v2_Dependencies_Package(
                    $req, 'extension', null, $info, 0);
                $ret = $this->validateExtensionDependency($subdep);
                if ($ret === true) {
                    return true;
                }
            }
        }
        if ($this->_state == PEAR2_Pyrus_Validate::INSTALLING) {
            return $this->_validatePackageInstall($dep);
        }
        if ($this->_state == PEAR2_Pyrus_Validate::DOWNLOADING) {
            return $this->_validatePackageDownload($dep, $params);
        }
    }

    function _validatePackageDownload(PEAR2_Pyrus_PackageFile_v2_Dependencies_Package $dep, $params)
    {
        $required = $dep->deptype === 'required';
        $depname = PEAR2_Pyrus_Config::parsedPackageNameToString(array('package' => $dep->name,
                                                                       'channel' => $dep->channel), true);
        $found = false;
        foreach ($params as $param) {
            if ($param->name == $dep->name && $param->channel == $dep->channel) {
                $found = true;
                break;
            }
        }
        if ($found) {
            $version = $param->version['release'];
            $installed = false;
            $downloaded = true;
        } else {
            if (PEAR2_Pyrus_Config::current()->registry->exists($dep->name, $dep->channel)) {
                $installed = true;
                $downloaded = false;
                $version = PEAR2_Pyrus_Config::current()->registry->info($dep->name,
                    $dep->channel, 'version');
            } else {
                $version = 'not installed or downloaded';
                $installed = false;
                $downloaded = false;
            }
        }
        $extra = $this->_getExtraString($dep);
        if (!isset($dep->min) && !isset($dep->max) &&
              !isset($dep->recommended) && !isset($dep->exclude)) {
            if ($installed || $downloaded) {
                $installed = $installed ? 'installed' : 'downloaded';
                if ($dep->conflicts) {
                    $rest = ", $installed version is " . $version;
                    if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                        return $this->raiseError('%s conflicts with package "' . $depname . '"' .
                            $extra . $rest);
                    } else {
                        return $this->warning('warning: %s conflicts with package "' . $depname . '"' .
                            $extra . $rest);
                    }
                }
                return true;
            } else {
                if ($dep->conflicts) {
                    return true;
                }
                if ($required) {
                    if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                        return $this->raiseError('%s requires package "' . $depname . '"' .
                            $extra);
                    } else {
                        return $this->warning('warning: %s requires package "' . $depname . '"' .
                            $extra);
                    }
                } else {
                    return $this->warning('%s can optionally use package "' . $depname . '"' .
                        $extra);
                }
            }
        }
        if (!$installed && !$downloaded) {
            if ($dep->conflicts) {
                return true;
            }
            if ($required) {
                if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                    return $this->raiseError('%s requires package "' . $depname . '"' .
                        $extra);
                } else {
                    return $this->warning('warning: %s requires package "' . $depname . '"' .
                        $extra);
                }
            } else {
                return $this->warning('%s can optionally use package "' . $depname . '"' .
                    $extra);
            }
        }
        $fail = false;
        if (isset($dep->min)) {
            if (version_compare($version, $dep->min, '<')) {
                $fail = true;
            }
        }
        if (isset($dep->max)) {
            if (version_compare($version, $dep->max, '>')) {
                $fail = true;
            }
        }
        if ($fail && !$dep->conflicts) {
            $installed = $installed ? 'installed' : 'downloaded';
            $dep = PEAR2_Pyrus_Config::parsedPackageNameToString(array('package' => $dep->name,
                                                                       'channel' => $dep->channel), true);
            if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                return $this->raiseError('%s requires package "' . $depname . '"' .
                    $extra . ", $installed version is " . $version);
            } else {
                return $this->warning('warning: %s requires package "' . $depname . '"' .
                    $extra . ", $installed version is " . $version);
            }
        } elseif (!isset($dep->exclude) && (isset($dep->min) || isset($dep->max)) && !$fail &&
              $dep->conflicts) {
            $installed = $installed ? 'installed' : 'downloaded';
            if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                return $this->raiseError('%s conflicts with package "' .
                    $depname . '"' . $extra . ', ' . $installed . ' version is ' . $version);
            } else {
                return $this->warning('warning: %s conflicts with package "' .
                    $depname . '"' . $extra . ', ' . $installed . ' version is ' . $version);
            }
        }
        if (isset($dep->exclude)) {
            // exclude ordinarily tells the installer "install anything but these versions"
            // when paired with conflicts, it becomes "install only these versions"
            $conflicts = $dep->conflicts;
            foreach ($dep->exclude as $exclude) {
                if (version_compare($version, $exclude, '==')) {
                    if ($conflicts) {
                        $fail = false;
                        break;
                    }
                    goto conflict_error;
                } else {
                    if ($conflicts) {
                        $fail = true;
                    }
                }
            }
        } elseif ($dep->conflicts) {
            return true;
        }
        if ($fail) {
conflict_error:
            $installed = $installed ? 'installed' : 'downloaded';
            if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                return $this->raiseError('%s is not compatible with version ' . $version . ' of package "' .
                    $depname . '", ' . $installed . ' version is ' . $version);
            } else {
                return $this->warning('warning: %s is not compatible with version ' . $version . ' of package "' .
                    $depname . '", ' . $installed . ' version is ' . $version);
            }
        }
        if (isset($dep->recommended)) {
            if (version_compare($version, $dep->recommended, '==')) {
                return true;
            } else {
                if (!$found && $installed) {
                    $param = PEAR2_Pyrus_Config::current()->registry->package[$dep->channel . '/' . $dep->name];
                }
                if ($param) {
                    $found = false;
                    foreach ($params as $parent) {
                        if ($parent->name == $this->_currentPackage['package'] &&
                              $parent->channel == $this->_currentPackage['channel']) {
                            $found = true;
                            break;
                        }
                    }
                    if ($found) {
                        if ($param->isCompatible($parent)) {
                            return true;
                        }
                    }
                }
                $installed = $installed ? 'installed' : 'downloaded';
                if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force']) &&
                      !isset(PEAR2_Pyrus_Installer::$options['loose'])) {
                    return $this->raiseError('%s dependency package "' . $depname .
                        '" ' . $installed . ' version ' . $version .
                        ' is not the recommended version ' . $dep->recommended .
                        ', but may be compatible, use --force to install');
                } else {
                    return $this->warning('warning: %s dependency package "' . $depname .
                        '" ' . $installed . ' version ' . $version .
                        ' is not the recommended version ' . $dep->recommended);
                }
            }
        }
        return true;
    }

    function _validatePackageInstall($dep)
    {
        return $this->_validatePackageDownload($dep, array());
    }

    function validatePackageUninstall($dep, $param)
    {
        if ($dep->conflicts) {
            return true; // uninstall OK - these packages conflict (probably installed with --force)
        }
        $required = $dep->deptype == 'required';
        $depname = PEAR2_Pyrus_Config::parsedPackageNameToString(array('package' => $dep->name,
                                                                       'channel' => $dep->channel), true);
        $extra = $this->_getExtraString($dep);
        if (!isset($dep->min) && !isset($dep->max) && !isset($dep->exclude)) {
            if ($required) {
                if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                    return $this->raiseError('"' . $depname . '" is required by ' .
                        'installed package %s' . $extra);
                } else {
                    return $this->warning('warning: "' . $depname . '" is required by ' .
                        'installed package %s' . $extra);
                }
            } else {
                return $this->warning('"' . $depname . '" can be optionally used by ' .
                        'installed package %s' . $extra);
            }
        }
        $version = $param->version['release'];
        $fail = false;
        if (isset($dep->min)) {
            if (version_compare($version, $dep->min, '>=')) {
                $fail = true;
            } else {
                goto nofail;
            }
        }
        if (isset($dep->max)) {
            if (version_compare($version, $dep->max, '<=')) {
                $fail = true;
            }
        }
nofail:
        if (isset($dep->exclude)) {
            $fail = true;
            foreach ($dep->exclude as $exclude) {
                if (version_compare($version, $exclude, '==')) {
                    // rare case - we conflict with the installed package,
                    // so uninstalling is just fine
                    $fail = false;
                    break;
                }
            }
        }
        if ($fail) {
            if ($required) {
                if (!isset(PEAR2_Pyrus_Installer::$options['nodeps']) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                    return $this->raiseError($depname . $extra . ' is required by installed package' .
                        ' "%s"');
                } else {
                    return $this->warning('warning: ' . $depname . $extra .
                        ' is required by installed package "%s"');
                }
            } else {
                return $this->warning($depname . $extra . ' can be optionally used by installed package' .
                        ' "%s"');
            }
        }
        return true;
    }

    /**
     * validate a downloaded package against installed packages
     *
     * @param $pkg downloaded package package.xml object
     * @param array $params full list of packages to install
     * @return bool
     */
    function validateDownloadedPackage(PEAR2_Pyrus_IPackageFile $pkg, $params = array())
    {
        $me = $pkg->channel . '/' . $pkg->name;
        $reg = PEAR2_Pyrus_Config::current()->registry;
        $deppackages = $reg->getDependentPackages($pkg);
        $fail = false;
        if ($deppackages) {
            $actual = array();
            // first, remove packages that will be installed
            foreach ($deppackages as $package) {
                foreach ($params as $packd) {
                    if (strtolower($packd->name) == strtolower($package->name) &&
                          $packd->channel == $package->channel) {
                        PEAR2_Pyrus_Log::log(3, 'skipping installed package check of "' .
                                    PEAR2_Pyrus_Config::parsedPackageNameToString(
                                        array('channel' => $package->channel, 'package' => $package->name),
                                        true) .
                                    '", version "' . $packd->version['release'] . '" will be ' .
                                    'downloaded and installed');
                        continue 2;
                    }
                }
                $actual[] = $package;
            }
            foreach ($actual as $package) {
                $checker = new PEAR2_Pyrus_Dependency_Validator(
                    array('channel' => $package->channel, 'package' => $package->name),
                    $this->_state, $this->errs);
                foreach ($params as $packd) {
                    $deps = $package->dependencies['required']->package;
                    if (isset($deps[$me])) {
                        $ret = $checker->_validatePackageDownload($deps[$me], array($pkg, $package));
                    }
                    $deps = $package->dependencies['required']->subpackage;
                    if (isset($deps[$me])) {
                        $ret = $checker->_validatePackageDownload($deps[$me], array($pkg));
                    }
                    $deps = $package->dependencies['optional']->package;
                    if (isset($deps[$me])) {
                        $ret = $checker->_validatePackageDownload($deps[$me], array($pkg, $package));
                    }
                    $deps = $package->dependencies['optional']->subpackage;
                    if (isset($deps[$me])) {
                        $ret = $checker->_validatePackageDownload($deps[$me], array($pkg));
                    }
                }
            }
        }
        if (count($this->errs->E_ERROR)) {
            return $this->raiseError(
                '%s cannot be installed, conflicts with installed packages');
        }
        return true;
    }

    function raiseError($msg)
    {
        if (isset(PEAR2_Pyrus_Installer::$options['ignore-errors'])) {
            return $this->warning($msg);
        }
        $this->errs->E_ERROR[] = new PEAR2_Pyrus_Dependency_Exception(sprintf($msg, PEAR2_Pyrus_Config::parsedPackageNameToString(
            $this->_currentPackage, true)));
        return false;
    }

    function warning($msg)
    {
        $this->errs->E_WARNING[] = new PEAR2_Pyrus_Dependency_Exception(sprintf($msg, PEAR2_Pyrus_Config::parsedPackageNameToString(
            $this->_currentPackage, true)));
        return true;
    }
}
?>
<?php
/**
 * PEAR2_Pyrus_PluginRegistry
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Registry manager for Pyrus plugins
 *
 * The plugin manager is a standard Pyrus registry, but also has
 * specialized commands to retrieve command plugins, custom roles/tasks, and scripts
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PluginRegistry extends PEAR2_Pyrus_Registry
{
    protected $pluginRegistryPath;
    static protected $config;
    static protected $commandMap = array();
    static protected $autoloadMap = array();
    static protected $frontend;

    function __construct($path = null)
    {
        if ($path === null) {
            $this->pluginRegistryPath = PEAR2_Pyrus_Config::current()->plugins_dir;
        } else {
            $this->pluginRegistryPath = $path;
        }
        $current = PEAR2_Pyrus_Config::current();
        self::$config = PEAR2_Pyrus_Config::singleton($this->pluginRegistryPath);
        PEAR2_Pyrus_Config::setCurrent($current->path);
        parent::__construct($this->pluginRegistryPath, array('Sqlite3', 'Xml'));
    }

    /**
     * Scan the plugin registry for custom roles, tasks and commands,
     * and register them as existing.
     */
    function scan()
    {
        static $scanned = false;
        if ($scanned) {
            return;
        }
        $scanned = true;
        $parser = new PEAR2_Pyrus_XMLParser;
        $schemapath = PEAR2_Pyrus::getDataPath();
        if (!file_exists(PEAR2_Pyrus::getDataPath() . '/channel-1.0.xsd')) {
            $schemapath = realpath(__DIR__ . '/../../data');
        }
        $roleschema = $schemapath . '/customrole-2.0.xsd';
        $taskschema = $schemapath . '/customtask-2.0.xsd';
        $commandschema = $schemapath . '/customcommand-2.0.xsd';

        try {
            foreach (PEAR2_Pyrus_Config::current()->channelregistry as $channel) {
                foreach ($this->listPackages($channel->name) as $package) {
                    $chan = $channel->name;
                    $files = $this->info($package, $chan, 'installedfiles');
                    // each package may only have 1 role, task or command
                    foreach ($files as $path => $info) {
                        switch ($info['role']) {
                            case 'customrole' :
                                $roleinfo = $parser->parse($path, $roleschema);
                                $roleinfo = $roleinfo['role'];
                                static::makeAutoloader($roleinfo, 'role');
                                PEAR2_Pyrus_Installer_Role::registerCustomRole($roleinfo);
                                continue 2;
                            case 'customtask' :
                                $taskinfo = $parser->parse($path, $taskschema);
                                $taskinfo = $taskinfo['task'];
                                static::makeAutoloader($taskinfo, 'task');
                                PEAR2_Pyrus_PackageFile_v2::registerCustomTask($taskinfo);
                                continue 2;
                            case 'customcommand' :
                                $commands = $parser->parse($path, $commandschema);
                                $this->addCommand($commands['commands']['command']);
                                continue 2;
                        }
                    }
                }
            }
        } catch (Exception $e) {
            PEAR2_Pyrus_Log::log(0, 'Unable to add all custom roles/tasks/commands: ' . $e);
        }
    }

    static function registerFrontend($frontend)
    {
        self::$frontend = $frontend;
    }

    static function addCommand($commands)
    {
        if (!isset($commands[0])) {
            $commands = array($commands);
        }
        foreach ($commands as $command) {
            if (isset(self::$commandMap[$command['name']])) {
                throw new PEAR2_Pyrus_PluginRegistry_Exception($command['name'] . ' is' .
                                                               ' already mapped and cannot be re-used');
            }
            self::$commandMap[$command['name']] = $command;
            static::makeAutoloader($command, 'command');
            if (null !== self::$frontend) {
                self::$frontend->mapCommand($command);
            }
        }
    }

    static function getCommandInfo($command = null)
    {
        if (null === $command) {
            return self::$commandMap;
        }
        if (isset(self::$commandMap[$command])) {
            return self::$commandMap[$command];
        }
        return false;    
    }

    static function makeAutoloader($info, $type)
    {
        if (isset($info['autoloadpath']) && !isset(self::$autoloadMap[$info['autoloadpath']])) {
            $fullpath = realpath(self::$config->php_dir . DIRECTORY_SEPARATOR .
                $info['autoloadpath']);
            if (!$fullpath) {
                throw new PEAR2_Pyrus_PluginRegistry_Exception(
                    'Unable to create autoloader for custom ' . $type . $info['name'] .
                    ', autoload path ' . $info['autoloadpath'] . ' does not exist');
            }
            $autoloader = function($class) use ($fullpath) {
                if (file_exists($fullpath . '/' . str_replace('_', '/', $class) . '.php')) {
                    include $fullpath . '/' . str_replace('_', '/', $class) . '.php';
                }
            };
            spl_autoload_register($autoloader);
        }
    }
}
<?php
/**
 * PEAR_REST_13
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */


/**
 * Implement REST 1.3
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_REST_13 extends PEAR2_Pyrus_REST_10
{
    /**
     * Retrieve information about a remote package to be downloaded from a REST server
     *
     * This is smart enough to resolve the minimum PHP version dependency prior to download
     * @param string $base The uri to prepend to all REST calls
     * @param array $packageinfo an array of format:
     * <pre>
     *  array(
     *   'package' => 'packagename',
     *   'channel' => 'channelname',
     *  ['state' => 'alpha' (or valid state),]
     *  -or-
     *  ['version' => '1.whatever']
     * </pre>
     * @param string $prefstate Current preferred_state config variable value
     * @param bool $installed the installed version of this package to compare against
     * @return array|false|PEAR_Error see {@link returnDownloadURL(()}
     */
    function getDownloadURL($base, $packageinfo, $prefstate, $installed)
    {
        $channel = $packageinfo['channel'];
        $package = $packageinfo['package'];
        $states = PEAR2_Pyrus_Installer::betterStates($prefstate, true);
        if (!$states) {
            throw new PEAR2_Pyrus_REST_Exception('"' . $prefstate . '" is not a valid state');
        }
        $state   = isset($packageinfo['state'])   ? $packageinfo['state']   : null;
        $version = isset($packageinfo['version']) ? $packageinfo['version'] : null;
        try {
            $info = $this->rest->retrieveData($base . 'r/' . strtolower($package) . '/allreleases2.xml');
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_REST_Exception('No releases available for package "' .
                $channel . '/' . $package . '"', $e);
        }
        if (!isset($info['r'])) {
            return false;
        }
        $release = $found = false;
        if (!is_array($info['r']) || !isset($info['r'][0])) {
            $info['r'] = array($info['r']);
        }
        $skippedphp = false;
        foreach ($info['r'] as $release) {
            if (!isset($this->options['force']) && ($installed &&
                  version_compare($release['v'], $installed, '<'))) {
                continue;
            }
            if (isset($state)) {
                // try our preferred state first
                if ($release['s'] == $state) {
                    if (!isset($version) && version_compare($release['m'], phpversion(), '>')) {
                        // skip releases that require a PHP version newer than our PHP version
                        $skippedphp = $release;
                        continue;
                    }
                    $found = true;
                    break;
                }
                // see if there is something newer and more stable
                // bug #7221
                if (in_array($release['s'], PEAR2_Pyrus_Installer::betterStates($state), true)) {
                    if (!isset($version) && version_compare($release['m'], phpversion(), '>')) {
                        // skip releases that require a PHP version newer than our PHP version
                        $skippedphp = $release;
                        continue;
                    }
                    $found = true;
                    break;
                }
            } elseif (isset($version)) {
                if ($release['v'] == $version) {
                    if (!isset($this->options['force']) &&
                          !isset($version) &&
                          version_compare($release['m'], phpversion(), '>')) {
                        // skip releases that require a PHP version newer than our PHP version
                        $skippedphp = $release;
                        continue;
                    }
                    $found = true;
                    break;
                }
            } else {
                if (in_array($release['s'], $states)) {
                    if (version_compare($release['m'], phpversion(), '>')) {
                        // skip releases that require a PHP version newer than our PHP version
                        $skippedphp = $release;
                        continue;
                    }
                    $found = true;
                    break;
                }
            }
        }
        if (!$found && $skippedphp) {
            $found = null;
        }
        return $this->returnDownloadURL($base, $package, $release, $info, $found, $skippedphp);
    }

    function getDepDownloadURL($base, $dependency, $deppackage,
                               $prefstate = 'stable', $installed = false)
    {
        $channel = $dependency['channel'];
        $package = $dependency['name'];
        $states = PEAR2_Pyrus_Installer::betterStates($prefstate, true);
        if (!$states) {
            throw new PEAR2_Pyrus_REST_Exception('"' . $prefstate . '" is not a valid state');
        }
        $state   = isset($dependency['state'])   ? $dependency['state']   : null;
        $version = isset($dependency['version']) ? $dependency['version'] : null;
        // FIXME aren't we just doing the same thing twice over here ?
        $info = $this->rest->retrieveData($base . 'r/' . strtolower($package) .  '/allreleases2.xml');
        try {
            $info = $this->rest->retrieveData($base . 'r/' . strtolower($package) . '/allreleases2.xml');
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_REST_Exception('Package "' . $deppackage['channel'] . '/' . $deppackage['package']
                . '" dependency "' . $channel . '/' . $package . '" has no releases', $e);
        }
        if (!is_array($info) || !isset($info['r'])) {
            return false;
        }
        $exclude = array();
        $min = $max = $recommended = false;
        $pinfo['package'] = $dependency['name'];
        $min = isset($dependency['min']) ? $dependency['min'] : false;
        $max = isset($dependency['max']) ? $dependency['max'] : false;
        $recommended = isset($dependency['recommended']) ? $dependency['recommended'] : false;
        if (isset($dependency['exclude'])) {
            if (!isset($dependency['exclude'][0])) {
                $exclude = array($dependency['exclude']);
            }
        }

        $skippedphp = $release = $found = false;
        if (!is_array($info['r']) || !isset($info['r'][0])) {
            $info['r'] = array($info['r']);
        }
        foreach ($info['r'] as $release) {
            if (!isset($this->options['force']) && ($installed &&
                  version_compare($release['v'], $installed, '<'))) {
                continue;
            }
            if (in_array($release['v'], $exclude)) { // skip excluded versions
                continue;
            }
            // allow newer releases to say "I'm OK with the dependent package"
            if (isset($release['co'])) {
                if (!is_array($release['co']) || !isset($release['co'][0])) {
                    $release['co'] = array($release['co']);
                }
                foreach ($release['co'] as $entry) {
                    if (isset($entry['x']) && !is_array($entry['x'])) {
                        $entry['x'] = array($entry['x']);
                    } elseif (!isset($entry['x'])) {
                        $entry['x'] = array();
                    }
                    if ($entry['c'] == $deppackage['channel'] &&
                          strtolower($entry['p']) == strtolower($deppackage['package']) &&
                          version_compare($deppackage['version'], $entry['min'], '>=') &&
                          version_compare($deppackage['version'], $entry['max'], '<=') &&
                          !in_array($release['v'], $entry['x'])) {
                        if (version_compare($release['m'], phpversion(), '>')) {
                            // skip dependency releases that require a PHP version
                            // newer than our PHP version
                            $skippedphp = $release;
                            continue;
                        }
                        $recommended = $release['v'];
                        break;
                    }
                }
            }
            if ($recommended) {
                if ($release['v'] != $recommended) { // if we want a specific
                    // version, then skip all others
                    continue;
                } else {
                    if (!in_array($release['s'], $states)) {
                        // the stability is too low, but we must return the
                        // recommended version if possible
                        return $this->returnDownloadURL($base, $package, $release, $info, true);
                    }
                }
            }
            if ($min && version_compare($release['v'], $min, 'lt')) { // skip too old versions
                continue;
            }
            if ($max && version_compare($release['v'], $max, 'gt')) { // skip too new versions
                continue;
            }
            if ($installed && version_compare($release['v'], $installed, '<')) {
                continue;
            }
            if (in_array($release['s'], $states)) { // if in the preferred state...
                if (version_compare($release['m'], phpversion(), '>')) {
                    // skip dependency releases that require a PHP version
                    // newer than our PHP version
                    $skippedphp = $release;
                    continue;
                }
                $found = true; // ... then use it
                break;
            }
        }
        if (!$found && $skippedphp) {
            $found = null;
        }
        return $this->returnDownloadURL($base, $package, $release, $info, $found, $skippedphp);
    }
}<?php
/**
 * PEAR2_Pyrus_REST_11 - implement faster list-all/remote-list command
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Implement REST 1.1
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_REST_11 extends PEAR2_Pyrus_REST_10
{

    function listAll($base, $dostable, $basic = true)
    {
        $categorylist = $this->_rest->retrieveData($base . 'c/categories.xml');
        if (PEAR::isError($categorylist)) {
            return $categorylist;
        }
        $ret = array();
        if (!is_array($categorylist['c']) || !isset($categorylist['c'][0])) {
            $categorylist['c'] = array($categorylist['c']);
        }
        PEAR::pushErrorHandling(PEAR_ERROR_RETURN);

        foreach ($categorylist['c'] as $progress => $category) {
            $category = $category['_content'];
            $packagesinfo = $this->_rest->retrieveData($base .
                'c/' . urlencode($category) . '/packagesinfo.xml');

            if (PEAR::isError($packagesinfo)) {
                continue;
            }

            if (!is_array($packagesinfo) || !isset($packagesinfo['pi'])) {
                continue;
            }

            if (!is_array($packagesinfo['pi']) || !isset($packagesinfo['pi'][0])) {
                $packagesinfo['pi'] = array($packagesinfo['pi']);
            }

            foreach ($packagesinfo['pi'] as $packageinfo) {
                $info = $packageinfo['p'];
                $package = $info['n'];
                $releases = isset($packageinfo['a']) ? $packageinfo['a'] : false;
                unset($latest);
                unset($unstable);
                unset($stable);
                unset($state);

                if ($releases) {
                    if (!isset($releases['r'][0])) {
                        $releases['r'] = array($releases['r']);
                    }
                    foreach ($releases['r'] as $release) {
                        if (!isset($latest)) {
                            if ($dostable && $release['s'] == 'stable') {
                                $latest = $release['v'];
                                $state = 'stable';
                            }
                            if (!$dostable) {
                                $latest = $release['v'];
                                $state = $release['s'];
                            }
                        }
                        if (!isset($stable) && $release['s'] == 'stable') {
                            $stable = $release['v'];
                            if (!isset($unstable)) {
                                $unstable = $stable;
                            }
                        }
                        if (!isset($unstable) && $release['s'] != 'stable') {
                            $unstable = $release['v'];
                            $state = $release['s'];
                        }
                        if (isset($latest) && !isset($state)) {
                            $state = $release['s'];
                        }
                        if (isset($latest) && isset($stable) && isset($unstable)) {
                            break;
                        }
                    }
                }

                if ($basic) { // remote-list command
                    if (!isset($latest)) {
                        $latest = false;
                    }
                    if ($dostable) {
                        // $state is not set if there are no releases
                        if (isset($state) && $state == 'stable') {
                            $ret[$package] = array('stable' => $latest);
                        } else {
                            $ret[$package] = array('stable' => '-n/a-');
                        }
                    } else {
                        $ret[$package] = array('stable' => $latest);
                    }
                    continue;
                }

                // list-all command
                $deps = array();
                if (!isset($unstable)) {
                    $unstable = false;
                    $state = 'stable';
                    if (isset($stable)) {
                        $latest = $unstable = $stable;
                    }
                } else {
                    $latest = $unstable;
                }

                if (!isset($latest)) {
                    $latest = false;
                }

                if ($latest && isset($packageinfo['deps'])) {
                    if (!is_array($packageinfo['deps']) ||
                          !isset($packageinfo['deps'][0])) {
                        $packageinfo['deps'] = array($packageinfo['deps']);
                    }
                    $d = false;
                    foreach ($packageinfo['deps'] as $dep) {
                        if ($dep['v'] == $latest) {
                            $d = unserialize($dep['d']);
                        }
                    }
                    if ($d) {
                        if (isset($d['required'])) {
                            if (!class_exists('PEAR_PackageFile_v2')) {
                                require_once 'PEAR/PackageFile/v2.php';
                            }
                            if (!isset($pf)) {
                                $pf = new PEAR_PackageFile_v2;
                            }
                            $pf->setDeps($d);
                            $tdeps = $pf->getDeps();
                        } else {
                            $tdeps = $d;
                        }
                        foreach ($tdeps as $dep) {
                            if ($dep['type'] !== 'pkg') {
                                continue;
                            }
                            $deps[] = $dep;
                        }
                    }
                }

                $info = array('stable' => $latest, 'summary' => $info['s'],
                    'description' =>
                    $info['d'], 'deps' => $deps, 'category' => $info['ca']['_content'],
                    'unstable' => $unstable, 'state' => $state);
                $ret[$package] = $info;
            }
        }
        PEAR::popErrorHandling();
        return $ret;
    }

    /**
     * List all categories of a REST server
     *
     * @param string $base base URL of the server
     * @return array of categorynames
     */
    function listCategories($base)
    {
        $categorylist = $this->_rest->retrieveData($base . 'c/categories.xml');
        if (PEAR::isError($categorylist)) {
            return $categorylist;
        }
        if (!is_array($categorylist) || !isset($categorylist['c'])) {
            return array();
        }
        if (isset($categorylist['c']['_content'])) {
            // only 1 category
            $categorylist['c'] = array($categorylist['c']);
        }
        return $categorylist['c'];
    }

    /**
     * List packages in a category of a REST server
     *
     * @param string $base base URL of the server
     * @param string $category name of the category
     * @param boolean $info also download full package info
     * @return array of packagenames
     */
    function listCategory($base, $category, $info=false)
    {
        if ($info == false) {
            $url = '%s'.'c/%s/packages.xml';
        } else {
            $url = '%s'.'c/%s/packagesinfo.xml';
        }
        $url = sprintf($url,
                    $base,
                    urlencode($category));

        // gives '404 Not Found' error when category doesn't exist
        $packagelist = $this->_rest->retrieveData($url);
        if (PEAR::isError($packagelist)) {
            return $packagelist;
        }
        if (!is_array($packagelist)) {
            return array();
        }

        if ($info == false) {
            if (!isset($packagelist['p'])) {
                return array();
            }
            if (!is_array($packagelist['p']) ||
                !isset($packagelist['p'][0])) { // only 1 pkg
                $packagelist = array($packagelist['p']);
            } else {
                $packagelist = $packagelist['p'];
            }
            return $packagelist;
        } else {
            // info == true
            if (!isset($packagelist['pi'])) {
                return array();
            }
            if (!is_array($packagelist['pi']) ||
                !isset($packagelist['pi'][0])) { // only 1 pkg
                $packagelist_pre = array($packagelist['pi']);
            } else {
                $packagelist_pre = $packagelist['pi'];
            }

            $packagelist = array();
            foreach ($packagelist_pre as $i => $item) {
                // compatibility with r/<latest.txt>.xml
                if (isset($item['a']['r'][0])) {
                    // multiple releases
                    $item['p']['v'] = $item['a']['r'][0]['v'];
                    $item['p']['st'] = $item['a']['r'][0]['s'];
                } elseif (isset($item['a'])) {
                    // first and only release
                    $item['p']['v'] = $item['a']['r']['v'];
                    $item['p']['st'] = $item['a']['r']['s'];
                }

                $packagelist[$i] = array('attribs' => $item['p']['r'],
                                         '_content' => $item['p']['n'],
                                         'info' => $item['p']);
            }
        }

        return $packagelist;
    }
}
?><?php
/**
 * PEAR_REST_10
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Implement REST 1.0
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_REST_10
{
    /**
     * @var PEAR2_Pyrus_REST
     */
    protected $rest;
    protected $options;
    function __construct($options = array())
    {
        $this->options = $options;
        $this->rest = new PEAR2_Pyrus_REST($this->options);
    }

    /**
     * Retrieve information about a remote package to be downloaded from a REST server
     *
     * @param string $base The uri to prepend to all REST calls
     * @param array $packageinfo an array of format:
     * <pre>
     *  array(
     *   'package' => 'packagename',
     *   'channel' => 'channelname',
     *  ['state' => 'alpha' (or valid state),]
     *  -or-
     *  ['version' => '1.whatever']
     * </pre>
     * @param string $prefstate Current preferred_state config variable value
     * @param bool $installed the installed version of this package to compare against
     * @return array|false|PEAR_Error see {@link returnDownloadURL()}
     */
    function getDownloadURL($base, $packageinfo, $prefstate, $installed)
    {
        $channel = $packageinfo['channel'];
        $package = $packageinfo['package'];
        $states = PEAR2_Pyrus_Installer::betterStates($prefstate, true);
        if (!$states) {
            throw new PEAR2_Pyrus_REST_Exception('"' . $prefstate . '" is not a valid state');
        }
        $state   = isset($packageinfo['state'])   ? $packageinfo['state']   : null;
        $version = isset($packageinfo['version']) ? $packageinfo['version'] : null;
        try {
            $info = $this->rest->retrieveData($base . 'r/' . strtolower($package) . '/allreleases.xml');
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_REST_Exception('No releases available for package "' .
                $channel . '/' . $package . '"', $e);
        }
        if (!isset($info['r'])) {
            return false;
        }
        $release = $found = false;
        if (!is_array($info['r']) || !isset($info['r'][0])) {
            $info['r'] = array($info['r']);
        }
        foreach ($info['r'] as $release) {
            if (!isset($this->options['force']) && ($installed &&
                  version_compare($release['v'], $installed, '<'))) {
                continue;
            }
            if (isset($state)) {
                // try our preferred state first
                if ($release['s'] == $state) {
                    $found = true;
                    break;
                }
                // see if there is something newer and more stable
                // bug #7221
                if (in_array($release['s'], PEAR2_Pyrus_Installer::betterStates($state), true)) {
                    $found = true;
                    break;
                }
            } elseif (isset($version)) {
                if ($release['v'] == $version) {
                    $found = true;
                    break;
                }
            } else {
                if (in_array($release['s'], $states)) {
                    $found = true;
                    break;
                }
            }
        }
        return $this->returnDownloadURL($base, $package, $release, $info, $found);
    }

    function getDepDownloadURL($base, $dependency, $deppackage,
                               $prefstate = 'stable', $installed = false)
    {
        $channel = $dependency['channel'];
        $package = $dependency['name'];
        $states = PEAR2_Pyrus_Installer::betterStates($prefstate, true);
        if (!$states) {
            throw new PEAR2_Pyrus_REST_Exception('"' . $prefstate . '" is not a valid state');
        }
        $state   = isset($dependency['state'])   ? $dependency['state']   : null;
        $version = isset($dependency['version']) ? $dependency['version'] : null;
        try {
            $info = $this->rest->retrieveData($base . 'r/' . strtolower($package) . '/allreleases.xml');
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_REST_Exception('Package "' . $deppackage['channel'] . '/' . $deppackage['package']
                . '" dependency "' . $channel . '/' . $package . '" has no releases', $e);
        }
        if (!is_array($info) || !isset($info['r'])) {
            return false;
        }
        $exclude = array();
        $min = $max = $recommended = false;
        $min = isset($dependency['min']) ? $dependency['min'] : false;
        $max = isset($dependency['max']) ? $dependency['max'] : false;
        $recommended = isset($dependency['recommended']) ?
            $dependency['recommended'] : false;
        if (isset($dependency['exclude'])) {
            if (!isset($dependency['exclude'][0])) {
                $exclude = array($dependency['exclude']);
            }
        }
        $release = $found = false;
        if (!is_array($info['r']) || !isset($info['r'][0])) {
            $info['r'] = array($info['r']);
        }
        foreach ($info['r'] as $release) {
            if (!isset($this->options['force']) && ($installed &&
                  version_compare($release['v'], $installed, '<'))) {
                continue;
            }
            if (in_array($release['v'], $exclude)) { // skip excluded versions
                continue;
            }
            // allow newer releases to say "I'm OK with the dependent package"
            if (isset($release['co'])) {
                if (!is_array($release['co']) || !isset($release['co'][0])) {
                    $release['co'] = array($release['co']);
                }
                foreach ($release['co'] as $entry) {
                    if (isset($entry['x']) && !is_array($entry['x'])) {
                        $entry['x'] = array($entry['x']);
                    } elseif (!isset($entry['x'])) {
                        $entry['x'] = array();
                    }
                    if ($entry['c'] == $deppackage['channel'] &&
                          strtolower($entry['p']) == strtolower($deppackage['package']) &&
                          version_compare($deppackage['version'], $entry['min'], '>=') &&
                          version_compare($deppackage['version'], $entry['max'], '<=') &&
                          !in_array($release['v'], $entry['x'])) {
                        $recommended = $release['v'];
                        break;
                    }
                }
            }
            if ($recommended) {
                if ($release['v'] != $recommended) { // if we want a specific
                    // version, then skip all others
                    continue;
                } else {
                    if (!in_array($release['s'], $states)) {
                        // the stability is too low, but we must return the
                        // recommended version if possible
                        return $this->returnDownloadURL($base, $package, $release, $info, true);
                    }
                }
            }
            if ($min && version_compare($release['v'], $min, 'lt')) { // skip too old versions
                continue;
            }
            if ($max && version_compare($release['v'], $max, 'gt')) { // skip too new versions
                continue;
            }
            if ($installed && version_compare($release['v'], $installed, '<')) {
                continue;
            }
            if (in_array($release['s'], $states)) { // if in the preferred state...
                $found = true; // ... then use it
                break;
            }
        }
        return $this->returnDownloadURL($base, $package, $release, $info, $found);
    }

    /**
     * Take raw data and return the array needed for processing a download URL
     *
     * @param string $base REST base uri
     * @param string $package Package name
     * @param array $release an array of format array('v' => version, 's' => state)
     *                       describing the release to download
     * @param array $info list of all releases as defined by allreleases.xml
     * @param bool|null $found determines whether the release was found or this is the next
     *                    best alternative.  If null, then versions were skipped because
     *                    of PHP dependency
     * @return array|PEAR_Error
     * @access private
     */
    protected function returnDownloadURL($base, $package, $release, $info, $found, $phpversion = false)
    {
        if (!$found) {
            $release = $info['r'][0];
        }
        try {
            $pinfo = $this->rest->retrieveCacheFirst($base . 'p/' . strtolower($package) . '/' .
            'info.xml');
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_REST_Exception('Package "' . $package .
                '" does not have REST info xml available', $e);
        }
        try {
            $releaseinfo = $this->rest->retrieveCacheFirst($base . 'r/' . strtolower($package) . '/' .
            $release['v'] . '.xml');
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_REST_Exception('Package "' . $package . '" Version "' . $release['v'] .
                '" does not have REST xml available', $e);
        }
        try {
            $packagexml = $this->rest->retrieveCacheFirst($base . 'r/' . strtolower($package) . '/' .
            'package.' . $release['v'] . '.xml', false, true);
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_REST_Exception('Package "' . $package . '" Version "' . $release['v'] .
                '" does not have REST dependency information available', $e);
        }
        $allinfo = $this->rest->retrieveData($base . 'r/' . strtolower($package) .
            '/allreleases.xml');
        if (!is_array($allinfo['r']) || !isset($allinfo['r'][0])) {
            $allinfo['r'] = array($allinfo['r']);
        }
        $compatible = false;
        foreach ($allinfo['r'] as $release) {
            if ($release['v'] != $releaseinfo['v']) {
                continue;
            }
            if (!isset($release['co'])) {
                break;
            }
            $compatible = array();
            if (!is_array($release['co']) || !isset($release['co'][0])) {
                $release['co'] = array($release['co']);
            }
            foreach ($release['co'] as $entry) {
                $comp = array();
                $comp['name'] = $entry['p'];
                $comp['channel'] = $entry['c'];
                $comp['min'] = $entry['min'];
                $comp['max'] = $entry['max'];
                if (isset($entry['x']) && !is_array($entry['x'])) {
                    $comp['exclude'] = $entry['x'];
                }
                $compatible[] = $comp;
            }
            if (count($compatible) == 1) {
                $compatible = $compatible[0];
            }
            break;
        }
        if (isset($pinfo['dc']) && isset($pinfo['dp'])) {
            if (is_array($pinfo['dp'])) {
                $deprecated = array('channel' => (string) $pinfo['dc'],
                                    'package' => trim($pinfo['dp']['_content']));
            } else {
                $deprecated = array('channel' => (string) $pinfo['dc'],
                                    'package' => trim($pinfo['dp']));
            }
        } else {
            $deprecated = false;
        }
        if ($found) {
            return
                array('version' => $releaseinfo['v'],
                      'info' => $packagexml,
                      'package' => $releaseinfo['p']['_content'],
                      'stability' => $releaseinfo['st'],
                      'url' => $releaseinfo['g'],
                      'compatible' => $compatible,
                      'deprecated' => $deprecated,
                );
        } else {
            return
                array('version' => $releaseinfo['v'],
                      'package' => $releaseinfo['p']['_content'],
                      'stability' => $releaseinfo['st'],
                      'info' => $packagexml,
                      'compatible' => $compatible,
                      'deprecated' => $deprecated,
                      'php' => $phpversion
                );
        }
    }

    function listPackages($base)
    {
        try {
            $packagelist = $this->rest->retrieveData($base . 'p/packages.xml');
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_REST_Exception('Cannot list packages', $e);
        }
        if (!is_array($packagelist) || !isset($packagelist['p'])) {
            return array();
        }
        if (!is_array($packagelist['p'])) {
            $packagelist['p'] = array($packagelist['p']);
        }
        return $packagelist['p'];
    }

    /**
     * List all categories of a REST server
     *
     * @param string $base base URL of the server
     * @return array of categorynames
     */
    function listCategories($base)
    {
        $categories = array();

        // c/categories.xml does not exist;
        // check for every package its category manually
        // This is SLOOOWWWW : ///
        try {
            $packagelist = $this->rest->retrieveData($base . 'p/packages.xml');
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_REST_Exception('Could not list categories', $e);
        }
        if (!is_array($packagelist) || !isset($packagelist['p'])) {
            $ret = array();
            return $ret;
        }
        if (!is_array($packagelist['p'])) {
            $packagelist['p'] = array($packagelist['p']);
        }

        try {
            foreach ($packagelist['p'] as $package) {
                $inf = $this->rest->retrieveData($base . 'p/' . strtolower($package) . '/info.xml');
                $cat = $inf['ca']['_content'];
                if (!isset($categories[$cat])) {
                    $categories[$cat] = $inf['ca'];
                }
            }
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_REST_Exception('Could not list categories', $e);
        }
        return array_values($categories);
    }

    /**
     * List a category of a REST server
     *
     * @param string $base base URL of the server
     * @param string $category name of the category
     * @param boolean $info also download full package info
     * @return array of packagenames
     */
    function listCategory($base, $category, $info=false)
    {
        // gives '404 Not Found' error when category doesn't exist
        try {
            $packagelist = $this->rest->retrieveData($base.'c/'.urlencode($category).'/packages.xml');
        } catch (PEAR2_Pyrus_REST_HTTPException $e) {
            throw new PEAR2_Pyrus_REST_Exception('Unknown category ' . $category, $e);
        }
        if (!is_array($packagelist) || !isset($packagelist['p'])) {
            return array();
        }
        if (!is_array($packagelist['p']) ||
            !isset($packagelist['p'][0])) { // only 1 pkg
            $packagelist = array($packagelist['p']);
        } else {
            $packagelist = $packagelist['p'];
        }

        if ($info == true) {
            // get individual package info
            foreach ($packagelist as $i => $packageitem) {
                $url = sprintf('%s'.'r/%s/latest.txt',
                        $base,
                        strtolower($packageitem['_content']));
                try {
                    $version = $this->rest->retrieveData($url);
                } catch (Exception $e) {
                    break; // skipit
                }
                $url = sprintf('%s'.'r/%s/%s.xml',
                        $base,
                        strtolower($packageitem['_content']),
                        $version);
                try {
                    $info = $this->rest->retrieveData($url);
                } catch (Exception $e) {
                    break; // skipit
                }
                $packagelist[$i]['info'] = $info;
            }
        }

        return $packagelist;
    }


    function listAll($base, $dostable, $basic = true, $searchpackage = false, $searchsummary = false)
    {
        try {
            $packagelist = $this->rest->retrieveData($base . 'p/packages.xml');
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_REST_Exception('Could not retrieve package list to list all',
                $e);
        }
        $ret = array();
        if (!is_array($packagelist) || !isset($packagelist['p'])) {
            return $ret;
        }
        if (!is_array($packagelist['p'])) {
            $packagelist['p'] = array($packagelist['p']);
        }

        // only search-packagename = quicksearch !
        if ($searchpackage && (!$searchsummary || empty($searchpackage))) {
            $newpackagelist = array();
            foreach ($packagelist['p'] as $package) {
                if (!empty($searchpackage) && stristr($package, $searchpackage) !== false) {
                    $newpackagelist[] = $package;
                }
            }
            $packagelist['p'] = $newpackagelist;
        }
        foreach ($packagelist['p'] as $progress => $package) {
            if ($basic) { // remote-list command
                try {
                    if ($dostable) {
                        $latest = $this->rest->retrieveData($base . 'r/' . strtolower($package) .
                            '/stable.txt');
                    } else {
                        $latest = $this->rest->retrieveData($base . 'r/' . strtolower($package) .
                            '/latest.txt');
                    }
                } catch (Exception $e) {
                    $latest = false;
                }
                $info = array('stable' => $latest);
            } else { // list-all command
                try {
                    $inf = $this->rest->retrieveData($base . 'p/' . strtolower($package) . '/info.xml');
                } catch (Exception $e) {
                    throw new PEAR2_Pyrus_REST_Exception(
                        'Cannot list all, can\'t get package info for ' . $package, $e);
                }
                if ($searchpackage) {
                    $found = (!empty($searchpackage) && stristr($package, $searchpackage) !== false);
                    if (!$found && !(isset($searchsummary) && !empty($searchsummary)
                        && (stristr($inf['s'], $searchsummary) !== false
                            || stristr($inf['d'], $searchsummary) !== false)))
                    {
                        continue;
                    };
                }
                try {
                    $releases = $this->rest->retrieveData($base . 'r/' . strtolower($package) .
                        '/allreleases.xml');
                } catch (Exception $e) {
                    continue;
                }
                if (!isset($releases['r'][0])) {
                    $releases['r'] = array($releases['r']);
                }
                unset($latest);
                unset($unstable);
                unset($stable);
                unset($state);
                foreach ($releases['r'] as $release) {
                    if (!isset($latest)) {
                        if ($dostable && $release['s'] == 'stable') {
                            $latest = $release['v'];
                            $state = 'stable';
                        }
                        if (!$dostable) {
                            $latest = $release['v'];
                            $state = $release['s'];
                        }
                    }
                    if (!isset($stable) && $release['s'] == 'stable') {
                        $stable = $release['v'];
                        if (!isset($unstable)) {
                            $unstable = $stable;
                        }
                    }
                    if (!isset($unstable) && $release['s'] != 'stable') {
                        $latest = $unstable = $release['v'];
                        $state = $release['s'];
                    }
                    if (isset($latest) && !isset($state)) {
                        $state = $release['s'];
                    }
                    if (isset($latest) && isset($stable) && isset($unstable)) {
                        break;
                    }
                }
                $deps = array();
                if (!isset($unstable)) {
                    $unstable = false;
                    $state = 'stable';
                    if (isset($stable)) {
                        $latest = $unstable = $stable;
                    }
                } else {
                    $latest = $unstable;
                }
                if (!isset($latest)) {
                    $latest = false;
                }
                if ($latest) {
                    try {
                        $d = $this->rest->retrieveCacheFirst($base . 'r/' . strtolower($package) . '/deps.' .
                           $latest . '.txt');
                        $d = unserialize($d);
                        if ($d) {
                            $pf = new PEAR2_Pyrus_PackageFile_v2;
                            $deps = $pf->dependencies;
                        }
                    } catch (Exception $e) {
                        $deps = false;
                    }
                }
                if (!isset($stable)) {
                    $stable = '-n/a-';
                }
                if (!$searchpackage) {
                    $info = array('stable' => $latest, 'summary' => $inf['s'], 'description' =>
                        $inf['d'], 'deps' => $deps, 'category' => $inf['ca']['_content'],
                        'unstable' => $unstable, 'state' => $state);
                } else {
                    $info = array('stable' => $stable, 'summary' => $inf['s'], 'description' =>
                        $inf['d'], 'deps' => $deps, 'category' => $inf['ca']['_content'],
                        'unstable' => $unstable, 'state' => $state);
                }
            }
            $ret[$package] = $info;
        }
        return $ret;
    }

    function listLatestUpgrades($base, $pref_state, $installed, $channel, &$reg)
    {
        try {
            $packagelist = $this->rest->retrieveData($base . 'p/packages.xml');
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_REST_Exception('Could not retrieve latest upgrades', $e);
        }
        $ret = array();
        if (!is_array($packagelist) || !isset($packagelist['p'])) {
            return $ret;
        }
        if (!is_array($packagelist['p'])) {
            $packagelist['p'] = array($packagelist['p']);
        }
        foreach ($packagelist['p'] as $package) {
            if (!isset($installed[strtolower($package)])) {
                continue;
            }
            $inst_version = $reg->packageInfo($package, 'version', $channel);
            $inst_state = $reg->packageInfo($package, 'release_state', $channel);
            try {
                $info = $this->rest->retrieveData($base . 'r/' . strtolower($package) .
                    '/allreleases.xml');
            } catch (Exception $e) {
                continue; // no remote releases
            }
            if (!isset($info['r'])) {
                continue;
            }
            $found = false;
            $release = false;
            if (!is_array($info['r']) || !isset($info['r'][0])) {
                $info['r'] = array($info['r']);
            }
            // $info['r'] is sorted by version number
            foreach ($info['r'] as $release) {
                if ($inst_version && version_compare($release['v'], $inst_version, '<=')) {
                    // not newer than the one installed
                    break;
                }

                // new version > installed version
                if (!$pref_state) {
                    // every state is a good state
                    $found = true;
                    break;
                } else {
                    $new_state = $release['s'];
                    // if new state >= installed state: go
                    if (in_array($new_state, PEAR2_Pyrus_Installer::betterStates($inst_state, true))) {
                        $found = true;
                        break;
                    } else {
                        // only allow to lower the state of package,
                        // if new state >= preferred state: go
                        if (in_array($new_state, PEAR2_Pyrus_Installer::betterStates($pref_state, true))) {
                            $found = true;
                            break;
                        }
                    }
                }
            }
            if (!$found) {
                continue;
            }
            try {
                $relinfo = $this->rest->retrieveCacheFirst($base . 'r/' . strtolower($package) . '/' .
                $release['v'] . '.xml');
            } catch (Exception $e) {
                throw new PEAR2_Pyrus_REST_Exception('Cannot retrieve latest upgrade release' .
                    ' information for package ' . $package, $e);
            }
            $ret[$package] = array(
                    'version' => $release['v'],
                    'state' => $release['s'],
                    'filesize' => $relinfo['f'],
                );
        }
        return $ret;
    }

    function packageInfo($base, $package)
    {
        try {
            $pinfo = $this->rest->retrieveData($base . 'p/' . strtolower($package) . '/info.xml');
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_REST_Exception('Unknown package: "' . $package . '"', $e);
        }
        $releases = array();
        try {
            $allreleases = $this->rest->retrieveData($base . 'r/' . strtolower($package) .
                '/allreleases.xml');
            if (!is_array($allreleases['r']) || !isset($allreleases['r'][0])) {
                $allreleases['r'] = array($allreleases['r']);
            }
            $pf = new PEAR2_Pyrus_PackageFile_v2;
            foreach ($allreleases['r'] as $release) {
                try {
                    $ds = $this->rest->retrieveCacheFirst($base . 'r/' . strtolower($package) . '/deps.' .
                        $release['v'] . '.txt');
                } catch (Exception $e) {
                    continue;
                }
                if (!isset($latest)) {
                    $latest = $release['v'];
                }
                $pf->dependencies = unserialize($ds);
                $ds = $pf->dependencies;
                try {
                    $info = $this->rest->retrieveCacheFirst($base . 'r/' . strtolower($package)
                        . '/' . $release['v'] . '.xml');
                } catch (Exception $e) {
                    continue;
                }
                $releases[$release['v']] = array(
                    'doneby' => $info['m'],
                    'license' => $info['l'],
                    'summary' => $info['s'],
                    'description' => $info['d'],
                    'releasedate' => $info['da'],
                    'releasenotes' => $info['n'],
                    'state' => $release['s'],
                    'deps' => $ds ? $ds : array(),
                );
            }
        } catch (Exception $e) {
            $latest = '';
        }
        if (isset($pinfo['dc']) && isset($pinfo['dp'])) {
            if (is_array($pinfo['dp'])) {
                $deprecated = array('channel' => (string) $pinfo['dc'],
                                    'package' => trim($pinfo['dp']['_content']));
            } else {
                $deprecated = array('channel' => (string) $pinfo['dc'],
                                    'package' => trim($pinfo['dp']));
            }
        } else {
            $deprecated = false;
        }
        return array(
            'name' => $pinfo['n'],
            'channel' => $pinfo['c'],
            'category' => $pinfo['ca']['_content'],
            'stable' => $latest,
            'license' => $pinfo['l'],
            'summary' => $pinfo['s'],
            'description' => $pinfo['d'],
            'releases' => $releases,
            'deprecated' => $deprecated,
            );
    }
}
?><?php
/**
 * PEAR2_Pyrus_REST_HTTPException
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception for REST HTTP
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_REST_HTTPException extends PEAR2_Pyrus_REST_Exception {}<?php
/**
 * PEAR2_Pyrus_REST_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for REST
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_REST_Exception extends PEAR2_Exception {}<?php
/**
 * PEAR2_Pyrus_IPackage
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Interface for packages
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
interface PEAR2_Pyrus_IPackage extends ArrayAccess, PEAR2_Pyrus_IPackageFile
{
    function getFileContents($file, $asstream = false);
    function getFilePath($file);
    function getFrom();
    function isStatic();
    function isUpgradeable();
    function __call($func, $args);
    /**
     * This allows a package to flexibly access its package.xml and return it
     * @return PEAR2_Pyrus_IPackageFile
     */
    function getPackageFileObject();
    /**
     * Used by the download command to relocate a local tarball to the
     * download directory
     */
    function copyTo($where);
}
<?php
/**
 * PEAR2_Pyrus_Channel
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Base class for Pyrus.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Channel implements PEAR2_Pyrus_IChannel
{
    protected $internal;
    
    /**
     * Construct a PEAR2_Pyrus_Channel object
     *
     */
    function __construct(PEAR2_Pyrus_IChannelFile $info)
    {
        $this->internal = $info;
    }

    function __get($var)
    {
        return $this->internal->$var;
    }
    
    function __set($var, $value)
    {
        $this->internal->$var = $value;
    }
    
    function __toString()
    {
        return $this->internal->__toString();
    }
    
    function __call($func, $args)
    {
        // delegate to the internal object
        return call_user_func_array(array($this->internal, $func), $args);
    }
    
    public function getValidationObject($package = false)
    {
        return $this->internal->getValidationObject($package);
    }
    
    public function getValidationPackage()
    {
        return $this->internal->getValidationPackage();
    }
}
<?php
/**
 * PEAR2_Pyrus_ILog
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Interface for loggin in Pyrus
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
interface PEAR2_Pyrus_ILog
{
    public function log($level, $message);
}<?php
/**
 * PEAR2_Pyrus_DirectedGraph_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception for directedgraph
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_DirectedGraph_Exception extends PEAR2_Exception {}<?php
/**
 * PEAR2_Pyrus_DirectedGraph_Vertex
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Class to represent vertices within the dependency directed graph.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_DirectedGraph_Vertex implements ArrayAccess, Countable, Iterator
{
    const WHITE = PEAR2_Pyrus_DirectedGraph::WHITE;
    const GRAY = PEAR2_Pyrus_DirectedGraph::GRAY;
    const BLACK = PEAR2_Pyrus_DirectedGraph::BLACK;
    protected $color = self::WHITE;
    public $data;
    protected $connections = array();

    /**
     * Encapsulate data within a directed graph vertex
     *
     * @param object $data
     */
    function __construct($data)
    {
        if (!is_object($data)) {
            throw new PEAR2_Pyrus_DirectedGraph_Exception('data must be an object, was ' .
                gettype($data));
        }

        $this->data = $data;
    }

    /**
     * Connect to another vertex
     *
     * @param PEAR2_Pyrus_DirectedGraph_Vertex $to
     */
    function connect(PEAR2_Pyrus_DirectedGraph_Vertex $to)
    {
        $this->connections[spl_object_hash($to)] = $to;
    }

    /**
     * Set the color of a visited node
     *
     * WHITE = unvisited, GRAY = visited, BLACK = finished
     *
     * @param self::WHITE|self::GRAY|self::BLACK|null $color if null, return the current color
     * @return int
     */
    function color($color = null)
    {
        if ($color === null) {
            return $this->color;
        }

        $this->color = $color;
    }

    function count()
    {
        $count = count($this->connections);
        foreach ($this->connections as $node) {
            if ($node->color() != self::WHITE) {
                --$count;
            }
        }

        return $count;
    }

    function offsetGet($var)
    {
        return $this->connections[$var];
    }

    function offsetSet($var, $value)
    {
        if ($value instanceof PEAR2_Pyrus_DirectedGraph_Vertex) {
            $this->connect($value);
        }
    }

    function offsetExists($var)
    {
        return isset($this->connections[$var]);
    }

    function offsetUnset($var)
    {
        unset($this->connections[$var]);
    }

    function current()
    {
        return current($this->connections);
    }

    function next()
    {
        return next($this->connections);
    }

    function key()
    {
        return key($this->connections);
    }

    function valid()
    {
        return current($this->connections);
    }

    function rewind()
    {
        reset($this->connections);
    }
}<?php
/**
 * PEAR2_Pyrus_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Base Exception class for Pyrus.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Exception extends PEAR2_Exception {}<?php
/**
 * PEAR_PackageFile_v2, package.xml version 2.1
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * File representing a package.xml file version 2.1
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2 implements PEAR2_Pyrus_IPackageFile
{
    static protected $customtasks = array();
    public $rootAttributes = array(
                                 'version' => '2.1',
                                 'xmlns' => 'http://pear.php.net/dtd/package-2.1',
                                 'xmlns:tasks' => 'http://pear.php.net/dtd/tasks-1.0',
                                 'xmlns:xsi' => 'http://www.w3.org/2001/XMLSchema-instance',
                                 'xsi:schemaLocation' => 'http://pear.php.net/dtd/tasks-1.0
     http://pear.php.net/dtd/tasks-1.0.xsd
     http://pear.php.net/dtd/package-2.1
     http://pear.php.net/dtd/package-2.1.xsd',
                             );
    /**
     * Parsed package information
     *
     * For created-from-scratch packagefiles, set some basic information needed.
     * @var array
     * @access private
     */
    protected $packageInfo = array('attribs' => array(
        'version' => '2.1',
        'xmlns' => 'http://pear.php.net/dtd/package-2.1',
        'xmlns:tasks' => 'http://pear.php.net/dtd/tasks-1.0',
        'xmlns:xsi' => 'http://www.w3.org/2001/XMLSchema-instance',
        'xsi:schemaLocation' => 'http://pear.php.net/dtd/tasks-1.0
     http://pear.php.net/dtd/tasks-1.0.xsd
     http://pear.php.net/dtd/package-2.1
     http://pear.php.net/dtd/package-2.1.xsd',
    ),
        'version' => array(
            'release' => '0.1.0',
            'api' => '0.1.0',
        ),
        'stability' => array(
            'release' => 'devel',
            'api' => 'alpha',
        ),
        'license' => array('attribs' => array('uri' => 'http://www.opensource.org/licenses/bsd-license.php'),
            '_content' => 'New BSD License',
        ),
        'dependencies' => array(
            'required' => array(
                'php' => array('min' => '5.2.0'),
                'pearinstaller' => array('min' => '2.0.0a1'),
            ),
        ),
        'phprelease' => array(),
    );

    /**
     * Set if the XML has been validated against schema
     *
     * @var unknown_type
     */
    private $_schemaValidated = false;

    protected $filelist = array();
    protected $baseinstalldirs = array();
    private $_dirtree = array();

    /**
     * Mapping of __get variables to method handlers
     * @var array
     */
    protected $getMap = array(
        'allmaintainers' => 'getAllMaintainers',
        'api-version' => 'getApiVersion',
        'api-state' => 'getApiState',
        'bundledpackage' => 'getBundledPackage',
        'channel' => 'getChannel',
        'compatible' => 'getCompatible',
        'configureoption' => 'getConfigureOption',
        'contents' => 'getContents',
        'date' => 'tag',
        'dependencies' => 'getDependencies',
        'description' => 'tag',
        'filepath' => 'getFilePath',
        'files' => 'getFiles',
        'installcontents' => 'getInstallContents',
        'installGroup' => 'getInstallGroup',
        'license' => 'getLicense',
        'maintainer' => 'getMaintainer',
        'name' => 'tag',
        'notes' => 'tag',
        'packagefile' => 'getPackageFile',
        'packagingcontents' => 'getPackagingContents',
        'providesextension' => 'tag',
        'rawdeps' => 'getRawDeps',
        'release' => 'getRelease',
        'release-version' => 'getReleaseVersion',
        'releases' => 'getReleases',
        'schemaOK' => 'getSchemaOK',
        'scriptfiles' => 'getScriptFiles',
        'sourcepackage' => 'getSourcePackage',
        'srcpackage' => 'tag',
        'srcchannel' => 'tag',
        'srcuri' => 'tag',
        'stability' => 'tag',
        'state' => 'getState',
        'summary' => 'tag',
        'time' => 'tag',
        'type' => 'getPackageType',
        'usesrole' => 'getUsesRoleTask',
        'usestask' => 'getUsesRoleTask',
        'version' => 'tag',
    );

    protected $setMap = array(
        'packagefile' => 'setPackageFile',
        'filepath' => 'setFilePath',
        'contents' => 'setContents',
        'channel' => 'setTag',
        'uri' => 'setTag',
        'state' => 'setState',
        'sourcepackage' => 'setSourcePackage',
        'license' => 'setLicense',
        'version' => 'setVersion',
        'stability' => 'setStability',
        'providesextension' => 'setTag',
        'srcpackage' => 'setTag',
        'srcuri' => 'setTag',
        'name' => 'setTag',
        'summary' => 'setTag',
        'description' => 'setTag',
        'date' => 'setTag',
        'time' => 'setTag',
        'notes' => 'setTag',
        'extends' => 'setTag',
        'type' => 'setType',
        'packagerversion' => 'setPackagerVersion'
    );

    protected $rawMap = array(
        'rawdependencies' => 'dependencies',
        'rawlicense' => 'license',
        'rawcontents' => 'contents',
        'rawconfigureoption' => array('setRawConfigureoption'), // array says call this function
        'rawrelease' => array('setRawRelease'), // array says call this function
        'rawcompatible' => 'compatible',
        'rawstability' => 'stability',
        'rawversion' => 'version',
        'rawusesrole' => 'usesrole',
        'rawusestask' => 'usestask',
        'rawlead' => 'lead',
        'rawdeveloper' => 'developer',
        'rawcontributor' => 'contributor',
        'rawhelper' => 'helper',
    );

    /**
     * path to package.xml or false if this is an abstract parsed-from-string xml
     * @var string|false
     * @access private
     */
    protected $_packageFile = false;

    /**
     * path to archive containing this package file, or false if this is a package.xml
     * or abstract parsed-from-string xml
     * @var string|false
     * @access private
     */
    protected $_archiveFile = false;

    /**
     * Optional Dependency group requested for installation
     * @var string
     * @access private
     */
    var $_requestedGroup = false;

    /**
     * Namespace prefix used for tasks in this package.xml - use tasks: whenever possible
     */
    var $_tasksNs;

    function setPackagefile($file, $archive = false)
    {
        $this->_packageFile = $file;
        $this->_archiveFile = $archive ? $archive : $file;
    }

    function getBundledPackage()
    {
        if ($this->getPackageType() !== 'bundle') {
            return false;
        }
        if (!isset($this->packageInfo['contents'])) {
            $this->packageInfo['contents'] = array();
        }
        if (!isset($this->packageInfo['contents']['bundledpackage'])) {
            $this->packageInfo['contents']['bundledpackage'] = array();
        }
        return new PEAR2_Pyrus_PackageFile_v2_BundledPackage($this, $this->packageInfo['contents']['bundledpackage']);
    }

    function getContents()
    {
        // allows stuff like:
        // foreach ($pf->contents as $file) {
        //     echo $file->name;
        //     $file->installed_as = 'hi';
        // }
        return new PEAR2_Pyrus_PackageFile_v2Iterator_File(
                new PEAR2_Pyrus_PackageFile_v2Iterator_FileAttribsFilter(
                new PEAR2_Pyrus_PackageFile_v2Iterator_FileContents(
                    $this->packageInfo['contents'], 'contents', $this)),
                    RecursiveIteratorIterator::LEAVES_ONLY);
    }

    function getInstallContents()
    {
        PEAR2_Pyrus_PackageFile_v2Iterator_FileInstallationFilter::setParent($this);
        return new PEAR2_Pyrus_PackageFile_v2Iterator_FileInstallationFilter(
                new ArrayIterator(
                    $this->filelist));
    }

    function getPackagingContents()
    {
        PEAR2_Pyrus_PackageFile_v2Iterator_PackagingIterator::setParent($this);
        return new PEAR2_Pyrus_PackageFile_v2Iterator_PackagingIterator(
                    $this->filelist);
    }

    function getScriptFiles()
    {
        return new PEAR2_Pyrus_PackageFile_v2Iterator_ScriptFileFilterIterator($this->filelist, $this);
    }

    function getPackageFile()
    {
        return $this->_packageFile;
    }

    function getFilePath()
    {
        return dirname($this->_packageFile);
    }

    function getInstallGroup()
    {
        $rel = $this->getPackageType();
        if ($rel != 'bundle') $rel .= 'release';
        $ret = $this->packageInfo[$rel];
        if (!isset($ret[0])) {
            return array($ret);
        }
        return $ret;
    }

    function getChannel()
    {
        if (isset($this->packageInfo['uri'])) {
            return '__uri';
        }
        return $this->tag('channel');
    }

    function getState()
    {
        if (!isset($this->packageInfo['stability']) ||
              !isset($this->packageInfo['stability']['release'])) {
            return false;
        }
        return $this->packageInfo['stability']['release'];
    }

    function getApiVersion()
    {
        if (!isset($this->packageInfo['version']) ||
              !isset($this->packageInfo['version']['api'])) {
            return false;
        }
        return $this->packageInfo['version']['api'];
    }

    function getReleaseVersion()
    {
        if (!isset($this->packageInfo['version']) ||
              !isset($this->packageInfo['version']['release'])) {
            return false;
        }
        return $this->packageInfo['version']['release'];
    }

    function getApiState()
    {
        if (!isset($this->packageInfo['stability']) ||
              !isset($this->packageInfo['stability']['api'])) {
            return false;
        }
        return $this->packageInfo['stability']['api'];
    }

    function getAllMaintainers()
    {
        $ret = array('lead' => array(), 'developer' => array(), 'helper' => array(), 'contributor' => array());
        foreach ($this->maintainer as $maintainer) {
            $ret[$maintainer->role][] = $maintainer;
        }
        return $ret;
    }

    function getReleases()
    {
        $type = $this->getPackageType();
        if ($type != 'bundle') {
            $type .= 'release';
        }
        if ($type && isset($this->packageInfo[$type])) {
            return $this->packageInfo[$type];
        }
        return false;
    }

    function getSourcePackage()
    {
        if (isset($this->packageInfo['extbinrelease']) ||
              isset($this->packageInfo['zendextbinrelease'])) {
            return array('channel' => $this->packageInfo['srcchannel'],
                         'package' => $this->packageInfo['srcpackage']);
        }
        return false;
    }

    function getLicense()
    {
        if (!isset($this->packageInfo['license'])) {
            $this->packageInfo['license'] = array();
        }
        return new PEAR2_Pyrus_PackageFile_v2_License($this, $this->packageInfo['license']);
    }

    function getFiles()
    {
        return new PEAR2_Pyrus_PackageFile_v2_Files($this, $this->filelist);
    }

    function getUsesRoleTask($var)
    {
        if (!isset($this->packageInfo[$var])) {
            return new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask($this, array(),
                                                               str_replace('uses', '', $var));
        }
        $info = $this->packageInfo[$var];
        if (count($info) && !isset($info[0])) {
            $info = array($info);
        }
        return new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask($this, $info, str_replace('uses', '', $var));
    }

    function getMaintainer()
    {
        $info = array();
        foreach (array('lead', 'developer', 'contributor', 'helper') as $type) {
            if (isset($this->packageInfo[$type])) {
                $info[$type] = $this->packageInfo[$type];
                if (!isset($info[$type][0])) {
                    $info[$type] = array($info[$type]);
                }
            } else {
                $info[$type] = array();
            }
        }
        return new PEAR2_Pyrus_PackageFile_v2_Developer($this, $info);
    }

    function getRawDeps()
    {
        return isset($this->packageInfo['dependencies']) ?
            $this->packageInfo['dependencies'] : false;
    }

    function getDependencies()
    {
        if (!isset($this->packageInfo['dependencies'])) {
            $this->packageInfo['dependencies'] = array();
        }
        return new PEAR2_Pyrus_PackageFile_v2_Dependencies(
            $this,
            $this->packageInfo['dependencies']);
    }

    function getRelease()
    {
        $t = $this->getPackageType();
        if (!$t) {
            $this->type = 'php';
            $t = 'phprelease';
        } else {
            if ($t != 'bundle') {
                $t .= 'release';
            }
        }
        if (!isset($this->packageInfo[$t]) || !is_array($this->packageInfo[$t])) {
            $this->packageInfo[$t] = array();
        }
        return new PEAR2_Pyrus_PackageFile_v2_Release(
            $this, $this->packageInfo[$t], $this->filelist);
    }

    function getCompatible()
    {
        if (!isset($this->packageInfo['compatible'])) {
            $compatible = array();
        } else {
            $compatible = $this->packageInfo['compatible'];
        }
        return new PEAR2_Pyrus_PackageFile_v2_Compatible(
            $this,
            $compatible);
    }

    function getConfigureOption()
    {
        if (!isset($this->packageInfo['configureoption'])) {
            $configureoption = array();
        } else {
            $configureoption = $this->packageInfo['configureoption'];
            if (count($configureoption) && !isset($configureoption[0])) {
                $configureoption = array($configureoption);
            }
        }
        return new PEAR2_Pyrus_PackageFile_v2_Configureoption($this, $configureoption);
    }

    function getSchemaOK()
    {
        return $this->_schemaValidated;
    }

    function getArchiveFile()
    {
        return $this->_archiveFile;
    }

    /**
     * Directly set the array that defines this packagefile
     *
     * WARNING: no validation.  This should only be performed by internal methods
     * inside Pyrus or by inputting an array saved from an existing PEAR_PackageFile_v2
     * @param array
     */
    function fromArray($pinfo)
    {
        $this->_schemaValidated = true;
        $this->packageInfo = $pinfo['package'];
    }

    function fromPackageFile(PEAR2_Pyrus_IPackageFile $package)
    {
        $this->fromArray($package->toArray());
        $this->setFilelist($package->getFileList());
        $this->setBaseInstallDirs($package->getBaseInstallDirs());
    }

    function hasFile($file)
    {
        return isset($this->filelist[$file]);
    }

    function getFile($file)
    {
        return $this->filelist[$file];
    }

    function setFilelist(array $list)
    {
        $this->filelist = $list;
    }

    function getFileList()
    {
        return $this->filelist;
    }

    function setFilelistFile($file, $info)
    {
        if ($info === null) {
            if (array_key_exists($file, $this->filelist)) {
                unset($this->filelist[$file]);
            }
            return;
        }
        $this->filelist[$file] = $info;
    }

    function setBaseInstallDirs(array $list)
    {
        $this->baseinstalldirs = $list;
    }

    function getBaseInstallDirs()
    {
        return $this->baseinstalldirs;
    }

    /**
     * @param string full path to file
     * @param string attribute name
     * @param string attribute value
     * @return bool success of operation
     */
    function setFileAttribute($filename, $attr, $value)
    {
        if (!in_array($attr, array('role', 'name', 'baseinstalldir', 'install-as'), true)) {
            // check to see if this is a task
            if ($this->isValidTask($attr)) {
                if (!isset($this->filelist[$filename][$attr])) {
                    $this->filelist[$filename][$attr] = $value;
                } else {
                    if (!isset($this->filelist[$filename][$attr][0])) {
                        $this->filelist[$filename][$attr] = array($this->filelist[$filename][$attr]);
                    }
                    $this->filelist[$filename][$attr][] = $value;
                }
                return;
            }
            throw new PEAR2_Pyrus_PackageFile_Exception(
                'Cannot set invalid attribute ' . $attr . ' for file ' . $filename);
        }
        if (!isset($this->filelist[$filename])) {
            throw new PEAR2_Pyrus_PackageFile_Exception(
                'Cannot set attribute ' . $attr . ' for non-existent file ' . $filename);
        }
        if ($attr == 'name') {
            throw new PEAR2_Pyrus_PackageFile_Exception('Cannot change name of file ' .
                $filename);
        }
        $this->filelist[$filename]['attribs'][$attr] = $value;
    }

    function isValidTask($name)
    {
        $tasksns = $this->getTasksNs();
        if (strlen($name) <= strlen($tasksns) + 1) {
            return false;
        }
        if (substr($name, 0, strlen($tasksns)) === $tasksns) {
            if ($name[strlen($tasksns)] == ':') {
                return true;
            }
        }
        return false;
    }

    /**
     * Used by uninstallation to set directory locations to erase
     * @param string $path
     */
    function setDirtree($path)
    {
        $this->_dirtree[$path] = true;
    }

    function getDirtree()
    {
        return $this->_dirtree;
    }

    function isNewPackage()
    {
        return version_compare($this->dependencies['required']->pearinstaller->min,
                               '2.0.0a1', '>=');
    }

    /**
     * Determines whether this package claims it is compatible with the version of
     * the package that has a recommended version dependency
     *
     * This function should only be called when the package has a recommended
     * version tag in a package or subpackage dependency on the package
     * represented by $pf, as no check is done to see whether $this
     * depends on $pf
     * @return boolean
     */
    function isCompatible(PEAR2_Pyrus_IPackageFile $pf)
    {
        if (!isset($this->packageInfo['compatible'])) {
            return false;
        }
        if (!isset($this->packageInfo['channel'])) {
            return false;
        }
        $me = $pf->version['release'];
        $found = false;
        foreach ($this->compatible as $info) {
            if (strtolower($info->name) == strtolower($pf->name)) {
                if ($info->channel == $pf->channel) {
                    $found = true;
                    break;
                }
            }
        }
        if (!$found) {
            return false;
        }
        if (isset($info->exclude)) {
            foreach ($info->exclude as $exclude) {
                if (version_compare($me, $exclude, '==')) {
                    return false;
                }
            }
        }
        if (version_compare($me, $info->min, '>=') && version_compare($me, $info->max, '<=')) {
            return true;
        }
        return false;
    }

    function isSubpackageOf(PEAR2_Pyrus_IPackageFile $p)
    {
        return $p->isSubpackage($this);
    }

    /**
     * Determines whether the passed in package is a subpackage of this package.
     *
     * No version checking is done, only name verification.
     * @return bool
     */
    function isSubpackage(PEAR2_Pyrus_IPackageFile $p)
    {
        foreach (array('required', 'optional', 'group') as $type) {
            if ($type === 'group') {
                foreach ($this->dependencies['group'] as $group) {
                    foreach ($group->subpackage as $dep) {
                        if (strtolower($dep->name) == strtolower($p->name)) {
                            if (isset($dep->channel)) {
                                if ($dep->channel == $p->channel) {
                                    return true;
                                }
                            } else {
                                if ($dep->uri == $p->uri) {
                                    return true;
                                }
                            }
                        }
                    }
                }
            }
            foreach ($this->dependencies[$type]->subpackage as $dep) {
                if (strtolower($dep->name) == strtolower($p->name)) {
                    if (isset($dep->channel)) {
                        if ($dep->channel == $p->channel) {
                            return true;
                        }
                    } else {
                        if ($dep->uri == $p->uri) {
                            return true;
                        }
                    }
                }
            }
        }
        return false;
    }

    function isEqual(PEAR2_Pyrus_IPackageFile $pkg)
    {
        if ($this->channel === '__uri') {
            return $pkg->name === $this->name && $pkg->uri === $this->uri;
        }

        return $pkg->name === $this->name && $pkg->channel === $this->channel;
    }

    /**
     * Returns true if any dependency, optional or required, exists on the package specified
     */
    function dependsOn(PEAR2_Pyrus_IPackageFile $pkg)
    {
        $uri = $pkg->uri;
        $package = $pkg->name;
        $channel = $pkg->channel;

        $deps = $this->dependencies;
        foreach (array('package', 'subpackage') as $type) {
            foreach (array('required', 'optional') as $needed) {
                foreach ($deps[$needed]->$type as $dep) {
                    if (strtolower($dep->name) == strtolower($package)) {
                        if (isset($dep->channel)) {
                            if ($dep->channel == strtolower($channel)) {
                                return true;
                            }
                        } else {
                            if ($dep->uri === $uri) {
                                return true;
                            }
                        }
                    }
                }
            }
            foreach ($deps['group'] as $group) {
                foreach ($group->$type as $dep) {
                    if (strtolower($dep->name) == strtolower($package)) {
                        if (isset($dep->channel)) {
                            if (strtolower($dep->channel) == strtolower($channel)) {
                                return true;
                            }
                        } else {
                            if ($dep->uri === $uri) {
                                return true;
                            }
                        }
                    }
                }
            }
        }
        return false;
    }

    /**
     * @return php|extsrc|extbin|zendextsrc|zendextbin|bundle|false
     */
    function getPackageType()
    {
        if (isset($this->packageInfo['phprelease'])) {
            return 'php';
        }
        if (isset($this->packageInfo['extsrcrelease'])) {
            return 'extsrc';
        }
        if (isset($this->packageInfo['extbinrelease'])) {
            return 'extbin';
        }
        if (isset($this->packageInfo['zendextsrcrelease'])) {
            return 'zendextsrc';
        }
        if (isset($this->packageInfo['zendextbinrelease'])) {
            return 'zendextbin';
        }
        if (isset($this->packageInfo['bundle'])) {
            return 'bundle';
        }
        return false;
    }

    function hasDeps()
    {
        return isset($this->packageInfo['dependencies']);
    }

    function getPackagexmlVersion()
    {
        if (isset($this->packageInfo['zendextsrcrelease'])) {
            return '2.1';
        }
        if (isset($this->packageInfo['zendextbinrelease'])) {
            return '2.1';
        }
        return '2.0';
    }

    /**
     * validate dependencies against the local registry, packages to be installed,
     * and environment (php version, OS, architecture, enabled extensions)
     *
     * @param array $toInstall an array of PEAR2_Pyrus_Package objects
     * @param PEAR2_MultiErrors $errs
     */
    function validateDependencies(array $toInstall, PEAR2_MultiErrors $errs)
    {
        $dep = new PEAR2_Pyrus_Dependency_Validator($this->packageInfo['name'],
            PEAR2_Pyrus_Validate::DOWNLOADING, $errs);
        $dep->validatePhpDependency($this->dependencies['required']->php);
        $dep->validatePearinstallerDependency($this->dependencies['required']->pearinstaller);
        foreach (array('required', 'optional') as $required) {
            foreach ($this->dependencies[$required]->package as $d) {
                $dep->validatePackageDependency($d, $toInstall);
            }
            foreach ($this->dependencies[$required]->subpackage as $d) {
                $dep->validateSubpackageDependency($d, $toInstall);
            }
            foreach ($this->dependencies[$required]->extension as $d) {
                $dep->validateExtensionDependency($d);
            }
        }
        foreach ($this->dependencies['required']->arch as $d) {
            $dep->validateArchDependency($d);
        }
        foreach ($this->dependencies['required']->os as $d) {
            $dep->validateOsDependency($d);
        }
    }

    function getValidator($state = PEAR2_Pyrus_Validate::NORMAL)
    {
        return new PEAR2_Pyrus_PackageFile_v2_Validator;
    }

    function getTasksNs()
    {
        if (!isset($this->_tasksNs)) {
            if (isset($this->packageInfo['attribs'])) {
                foreach ($this->packageInfo['attribs'] as $name => $value) {
                    if ($value == 'http://pear.php.net/dtd/tasks-1.0') {
                        $this->_tasksNs = str_replace('xmlns:', '', $name);
                        break;
                    }
                }
            }
        }
        return $this->_tasksNs;
    }

    /**
     * Determine whether a task name is a valid task.  Custom tasks may be defined
     * using subdirectories by putting a "-" in the name, as in <tasks:mycustom-task>
     *
     * Note that this method will auto-load the task class file and test for the existence
     * of the name with "-" replaced by "_" as in PEAR/Task/mycustom/task.php makes class
     * PEAR_Task_mycustom_task
     * @param string
     * @return boolean
     */
    function getTask($task)
    {
        $this->getTasksNs();
        // transform all '-' to '/' and 'tasks:' to '' so tasks:replace becomes replace
        $task = $tasktest = str_replace($this->_tasksNs . ':', '', $task);
        $task = str_replace('-', ' ', $task);
        $task = str_replace(' ', '/', ucwords($task));
        if (isset(static::$customtasks[$tasktest])) {
            $test = static::$customtasks[$tasktest]['classprefix'] . '_' . str_replace('/', '_', $task);
        } else {
            $test = 'PEAR2_Pyrus_Task_' . str_replace('/', '_', $task);
        }
        if (class_exists($test, true)) {
            return $test;
        }
        return false;
    }

    static function registerCustomTask($taskinfo)
    {
        static::$customtasks[$taskinfo['name']] = $taskinfo;
    }

    function getBaseInstallDir($file)
    {
        $file = dirname($file);
        while ($file !== '.' && $file != '/') {
            if (isset($this->baseinstalldirs[$file])) {
                return $this->baseinstalldirs[$file];
            }
            $file = dirname($file);
        }
        if (isset($this->baseinstalldirs[''])) {
            return $this->baseinstalldirs[''];
        }
        return false;
    }

    function __get($var)
    {
        if (isset($this->getMap[$var])) {
            return $this->{$this->getMap[$var]}($var);
        }
        return $this->tag($var);
    }

    function setTag($var, $value)
    {
        if ($var === 'uri') {
            if (isset($this->packageInfo['channel'])) {
                unset($this->packageInfo['channel']);
            }
        }
        if ($var === 'channel') {
            if (isset($this->packageInfo['uri'])) {
                unset($this->packageInfo['uri']);
            }
        }
        if ($value === null && isset($this->packageInfo[$var])) {
            unset($this->packageInfo[$var]);
            return;
        }
        $this->packageInfo[$var] = $value;
    }

    function setLicense($var, $value)
    {
        if ($value instanceof PEAR2_Pyrus_PackageFile_v2_License) {
            return $this->rawlicense = $value->getInfo();
        }
        $licensemap =
            array(
                'php' => 'http://www.php.net/license',
                'php license' => 'http://www.php.net/license',
                'lgpl' => 'http://www.gnu.org/copyleft/lesser.html',
                'bsd' => 'http://www.opensource.org/licenses/bsd-license.php',
                'bsd style' => 'http://www.opensource.org/licenses/bsd-license.php',
                'bsd-style' => 'http://www.opensource.org/licenses/bsd-license.php',
                'mit' => 'http://www.opensource.org/licenses/mit-license.php',
                'gpl' => 'http://www.gnu.org/copyleft/gpl.html',
                'apache' => 'http://www.opensource.org/licenses/apache2.0.php'
            );
        if (isset($licensemap[strtolower($value)])) {
            $this->rawlicense = array(
                'attribs' => array('uri' =>
                    $licensemap[strtolower($value)]),
                '_content' => $value
                );
        } else {
            // don't use bogus uri
            $this->rawlicense = (string) $value;
        }
    }

    function setType($var, $value)
    {
        if (!is_string($value)) {
            throw new PEAR2_Pyrus_PackageFile_Exception('package.xml type must be a ' .
            'string, was a ' . gettype($value));
        }
        if ($value != 'bundle') {
            $value .= 'release';
        }
        if (in_array($value, $a = array('phprelease', 'extsrcrelease', 'extbinrelease',
                                        'zendextsrcrelease', 'zendextbinrelease', 'bundle'))) {
            foreach ($a as $type) {
                if ($value == $type) {
                    if (!isset($this->packageInfo[$type])) {
                        $this->packageInfo[$type] = array();
                    }
                    continue;
                }
                if (isset($this->packageInfo[$type])) {
                    unset($this->packageInfo[$type]);
                }
            }
        }
    }

    function setRawConfigureopion($var, $value)
    {
        $t = $this->getPackageType();
        if ($t != 'bundle') {
            $t .= 'release';
        }
        if ($value === null) {
            if (isset($this->packageInfo[$t]['configureoption'])) {
                unset($this->packageInfo[$t]['configureoption']);
            }
        } else {
            $this->packageInfo[$t]['configureoption'] = $value;
        }
    }

    function setRawRelease($var, $value)
    {
        $t = $this->getPackageType();
        if ($t != 'bundle') {
            $t .= 'release';
        }
        $this->packageInfo[$t] = $value;
    }

    function setPackagerVersion($var, $value)
    {
        $this->packageInfo['attribs']['packagerversion'] = $value;
    }

    function __set($var, $value)
    {
        if ($var === 'dependencies' && $value === null) {
            $this->packageInfo['dependencies'] = array();
            return;
        }
        if ($var === 'release' && $value === null) {
            $rel = $this->getPackageType();
            if ($rel) {
                if (isset($this->packageInfo[$rel . 'release'])) {
                    $rel .= 'release';
                }
                $this->packageInfo[$rel] = '';
            }
            return;
        }
        if (isset($this->setMap[$var])) {
            return $this->{$this->setMap[$var]}($var, $value);
        }
        if (isset($this->rawMap[$var])) {
            $actual = $this->rawMap[$var];
            if (is_array($actual)) {
                $actual = $actual[0];
                return $this->$actual($var, $value);
            }
            if ($value === null) {
                if (isset($this->packageInfo[$actual])) {
                    unset($this->packageInfo[$actual]);
                }
            } else {
                $this->packageInfo[$actual] = $value;
            }
            return;
        }
        throw new PEAR2_Pyrus_PackageFile_Exception('Cannot set ' . $var . ' directly');
    }

    /**
     * Return the contents of a tag
     * @param string $name
     */
    protected function tag($name)
    {
        if (!isset($this->packageInfo[$name]) && in_array($name, array('version',
                'stability',
                'providesextension', 'usesrole', 'usestask', 'srcpackage', 'srcuri',
                ), true)) {
            $this->packageInfo[$name] = array();
        }
        switch ($name) {
            case 'stability' :
            case 'version' :
                if (!isset($this->packageInfo[$name])) {
                    $this->packageInfo[$name] = array();
                }
                $info = $this->packageInfo[$name];
                if (!isset($info['release'])) {
                    $info['release'] = null;
                }
                if (!isset($info['api'])) {
                    $info['api'] = null;
                }
                return new PEAR2_Pyrus_PackageFile_v2_SimpleProperty(
                                $this, $info, $name);
        }
        if (!isset($this->packageInfo[$name])) {
            return false;
        }
        return $this->packageInfo[$name];
    }

    /**
     * Update the changelog based on the current information
     */
    function updateChangelog()
    {
        $license = $this->license;
        if ($license instanceof ArrayObject) {
            $license = $license->getArrayCopy();
        }
        $info = array(
            'version' => array(
                'release' => $this->version['release'],
                'api' => $this->version['api']
            ),
            'stability' => array(
                'release' => $this->stability['release'],
                'api' => $this->stability['api']
            ),
            'date' => $this->date,
            'license' => $license,
            'notes' => $this->notes,
        );

        if (!is_array($this->packageInfo['changelog'])) {
            $this->packageInfo['changelog'] = $info;
        } elseif (!isset($this->packageInfo['changelog'][0])) {
            $this->packageInfo['changelog'] = array($info, $this->packageInfo['changelog']);
        } else {
            array_unshift($this->packageInfo['changelog'], $info);
        }
    }

    function __toString()
    {
        $this->packageInfo['attribs'] = $this->rootAttributes;
        $this->packageInfo['date'] = date('Y-m-d');
        $this->packageInfo['time'] = date('H:i:s');
        $arr = $this->toArray();
        return (string) new PEAR2_Pyrus_XMLWriter($arr);
    }

    function toRaw()
    {
        return $this;
    }

    function toArray($forpackaging = false)
    {
        $this->packageInfo['contents'] = array(
            'dir' => array(
                'attribs' => array('name' => '/'),
                'file' => array()
            ));
        uksort($this->filelist, 'strnatcasecmp');
        $a = array_reverse($this->filelist, 1);
        if ($forpackaging) {
            PEAR2_Pyrus_PackageFile_v2Iterator_PackagingIterator::setParent($this);
            $a = new PEAR2_Pyrus_PackageFile_v2Iterator_PackagingIterator($a);
        }
        $temp = array();
        foreach ($a as $name => $stuff) {
            if ($forpackaging) {
                // map old to new name
                $temp[$stuff['attribs']['name']] = $name;
            }
            // if we are packaging, $name is the new name
            $stuff['attribs']['name'] = $name;
            $this->packageInfo['contents']['dir']['file'][] = $stuff;
        }
        if (count($this->packageInfo['contents']['dir']['file']) == 1) {
            $this->packageInfo['contents']['dir']['file'] =
                $this->packageInfo['contents']['dir']['file'][0];
        }
        $arr = array();
        foreach (array('attribs', 'name', 'channel', 'uri', 'extends', 'summary',
                'description', 'lead',
                'developer', 'contributor', 'helper', 'date', 'time', 'version',
                'stability', 'license', 'notes', 'contents', 'compatible',
                'dependencies', 'providesextension', 'usesrole', 'usestask', 'srcpackage', 'srcuri',
                'phprelease', 'extsrcrelease', 'zendextsrcrelease', 'zendextbinrelease',
                'extbinrelease', 'bundle', 'changelog') as $index)
        {
            if (!isset($this->packageInfo[$index])) {
                continue;
            }
            $arr[$index] = $this->packageInfo[$index];
        }
        if ($forpackaging) {
            // process releases
            $reltag = $this->getPackageType();
            if ($reltag != 'bundle') {
                $reltag .= 'release';
                if (is_array($arr[$reltag])) {
                    if (!isset($arr[$reltag][0])) {
                        $arr[$reltag] = array($arr[$reltag]);
                    }
                    foreach ($arr[$reltag] as $i => $inf) {
                        if (!isset($inf['filelist'])) {
                            continue;
                        }
                        $inf = $inf['filelist'];
                        if (isset($inf['install'])) {
                            if (!isset($inf['install'][0])) {
                                if (isset($temp[$inf['install']['attribs']['name']])) {
                                    $arr[$reltag][$i]['filelist']['install']['attribs']
                                                       ['name'] =
                                        $temp[$inf['install']['attribs']['name']];
                                }
                            } else {
                                foreach ($inf['install'] as $j => $morinf) {
                                    if (isset($temp[$morinf['attribs']['name']])) {
                                        $arr[$reltag][$i]['filelist']['install'][$j]
                                                           ['attribs']['name'] =
                                            $temp[$morinf['attribs']['name']];
                                    }
                                }
                            }
                        }
                        if (isset($inf['ignore'])) {
                            if (!isset($inf['ignore'][0])) {
                                if (isset($temp[$inf['ignore']['attribs']['name']])) {
                                    $arr[$reltag][$i]['filelist']['ignore']
                                                       ['attribs']['name'] =
                                        $temp[$inf['ignore']['attribs']['name']];
                                }
                            } else {
                                foreach ($inf['ignore'] as $j => $morinf) {
                                    if (isset($temp[$morinf['attribs']['name']])) {
                                        $arr[$reltag][$i]['filelist']['ignore'][$j]
                                                           ['attribs']['name'] =
                                            $temp[$morinf['attribs']['name']];
                                    }
                                }
                            }
                        }
                    }
                    if (count($arr[$reltag]) == 1) {
                        $arr[$reltag] = $arr[$reltag][0];
                    }
                }
            }
        }
        $reltag = $this->getPackageType();
        if ($reltag != 'bundle') {
            $reltag .= 'release';
            $sortInstallAs = function ($a, $b)
                {
                    return strnatcasecmp($a['attribs']['name'], $b['attribs']['name']);
                };
            if (!is_array($arr[$reltag])) {
                // do nothing
            } elseif (!isset($arr[$reltag][0])) {
                if (isset($arr[$reltag]['filelist']) && isset($arr[$reltag]['filelist']['install'])
                    && isset($arr[$reltag]['filelist']['install'][0])) {
                    usort($arr[$reltag]['filelist']['install'], $sortInstallAs);
                }
                if (isset($arr[$reltag]['filelist']) && isset($arr[$reltag]['filelist']['ignore'])
                    && isset($arr[$reltag]['filelist']['ignore'][0])) {
                    usort($arr[$reltag]['filelist']['ignore'], $sortInstallAs);
                }
            } else {
                foreach ($arr[$reltag] as $i => $contents) {
                    if (!isset($contents['filelist'])) {
                        continue;
                    }
                    if (isset($contents['filelist']['install']) && isset($contents['filelist']['install'][0])) {
                        usort($arr[$reltag][$i]['filelist']['install'], $sortInstallAs);
                    }
                    if (isset($contents['filelist']['ignore']) && isset($contents['filelist']['ignore'][0])) {
                        usort($arr[$reltag][$i]['filelist']['ignore'], $sortInstallAs);
                    }
                }
            }
        }
        if (isset($this->packageInfo['dependencies'])) {
            if (isset($this->packageInfo['dependencies']['required'])) {
                $arr['dependencies']['required'] = array();
                foreach (array('php', 'pearinstaller', 'package', 'subpackage',
                            'extension', 'os', 'arch') as $index) {
                    if (!isset($this->packageInfo['dependencies']['required'][$index])) {
                        continue;
                    }
                    $arr['dependencies']['required'][$index] =
                        $this->packageInfo['dependencies']['required'][$index];
                }
            }
            if (isset($this->packageInfo['dependencies']['optional'])) {
                $arr['dependencies']['optional'] = array();
                foreach (array('package', 'subpackage', 'extension') as $index) {
                    if (!isset($this->packageInfo['dependencies']['optional'][$index])) {
                        continue;
                    }
                    $arr['dependencies']['optional'][$index] =
                        $this->packageInfo['dependencies']['optional'][$index];
                }
            }
            if (isset($this->packageInfo['dependencies']['group'])) {
                if (isset($this->packageInfo['dependencies']['group'][0])) {
                    foreach ($this->packageInfo['dependencies']['group'] as $i => $g) {
                        $arr['dependencies']['group'][$i] = array();
                        foreach (array('attribs', 'package', 'subpackage', 'extension') as $index) {
                            if (!isset($g[$index])) {
                                continue;
                            }
                            $arr['dependencies']['group'][$i][$index] = $g[$index];
                        }
                    }
                } else {
                    $a = $this->packageInfo['dependencies']['group'];
                    $arr['dependencies']['group'] = array();
                    foreach (array('attribs', 'package', 'subpackage', 'extension') as $index) {
                        if (!isset($a[$index])) {
                            continue;
                        }
                        $arr['dependencies']['group'][$index] = $a[$index];
                    }
                }
            }
        }
        return array('package' => $arr);
    }
}
<?php
/**
 * PEAR2_Pyrus_PackageFile_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for PackageFile
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_Exception extends PEAR2_Exception {}<?php
/**
 * package.xml parsing class, package.xml version 2.0
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Parser for package.xml version 2.0
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_Parser_v2 extends PEAR2_Pyrus_XMLParser
{
    private $_inContents = false;
    private $_path = '';
    private $_files = array();
    /**
     * Mapping of directories within package.xml and their baseinstalldir settings
     * @var array
     */
    private $_baseinstalldirs = array();
    private $_lastDepth = 0;
    private $_lastFileDepth = 0;
    private $_inFile = 0;
    private $_curFile;
    /**
     * Unindent given string
     *
     * @param string $str The string that has to be unindented.
     * @return string
     * @access private
     */
    function _unIndent($str)
    {
        // remove leading newlines
        $str = preg_replace('/^[\r\n]+/', '', $str);
        // find whitespace at the beginning of the first line
        $indent_len = strspn($str, " \t");
        $indent = substr($str, 0, $indent_len);
        $data = '';
        // remove the same amount of whitespace from following lines
        foreach (explode("\n", $str) as $line) {
            if (substr($line, 0, $indent_len) == $indent) {
                $data .= substr($line, $indent_len) . "\n";
            }
        }
        return $data;
    }

    /**
     * post-process data
     *
     * @param string $data
     * @param string $element element name
     */
    function postProcess($data, $element)
    {
        if ($element == 'notes') {
            return trim($this->_unIndent($data));
        }
        return trim($data);
    }

    /**
     * @param string
     * @param string file name of the package.xml
     * @param string|false name of the archive this package.xml came from, if any
     * @param string class name to instantiate and return.  This must be PEAR_PackageFile_v2 or
     *               a subclass
     * @return PEAR2_Pyrus_PackageFile_v2
     */
    function parse($data, $file = false, $class = 'PEAR2_Pyrus_PackageFile_v2', $state = PEAR2_Pyrus_Validate::NORMAL)
    {
        $this->_inContents = false;
        $this->_path = '';
        $this->_files = array();
        $this->_lastDepth = $this->_lastFileDepth = 0;
        $this->_inFile = 0;
        $ret = new $class;
        if (!$ret instanceof PEAR2_Pyrus_PackageFile_v2) {
            throw new PEAR2_Pyrus_PackageFile_Exception('Class ' . $class .
                ' passed to parse() must be a child class of PEAR2_Pyrus_PackageFile_v2');
        }

        if (preg_match('/<package[^>]+version="2.1"/', $data)) {
            $schema = PEAR2_Pyrus::getDataPath() . '/package-2.1.xsd';
            // for running out of cvs
            if (!file_exists($schema)) {
                $schema = dirname(dirname(dirname(dirname(dirname(__FILE__))))) . '/data/package-2.1.xsd';
            }
        } elseif (preg_match('/<package[^>]+version="2.0"/', $data)) {
            $schema = PEAR2_Pyrus::getDataPath() . '/package-2.0.xsd';
            // for running out of cvs
            if (!file_exists($schema)) {
                $schema = dirname(dirname(dirname(dirname(dirname(__FILE__))))) . '/data/package-2.0.xsd';
            }
        } else {
            throw new PEAR2_Pyrus_PackageFile_Exception('Cannot process package.xml version 1.0');
        }
        try {
            $ret->fromArray(parent::parseString($data, $schema));
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_PackageFile_Exception('Invalid package.xml', $e);
        }
        $ret->setFileList($this->_files);
        $ret->setBaseInstallDirs($this->_baseinstalldirs);
        $ret->setPackagefile($file);
        return $ret;
    }

    /**
     * Merge a tag into the array
     * @see PEAR2_Pyrus_XMLParser::mergeTag()
     *
     * @param array  $arr     The array representation of the XML
     * @param string $tag     The tag name
     * @param array  $attribs Associative array of attributes for this tag
     * @param string $name    The tag name
     * @param int    $depth   The current depth within the XML document
     *
     * @return array
     */
    protected function mergeTag($arr, $tag, $attribs, $name, $depth)
    {
        $arr = parent::mergeTag($arr, $tag, $attribs, $name, $depth);
        if ($this->_inContents) {
            if ($this->_inFile) {
                if ($depth < $this->_inFile) {
                    $this->_inFile = 0;
                }
            }
            if ($name === 'dir') {
                while ($this->_lastDepth >= $depth) {
                    $this->_path = dirname($this->_path);
                    if ($this->_path == '.') {
                        $this->_path = '';
                    } else {
                        $this->_path .= '/';
                    }
                    $this->_lastDepth--;
                }
                $this->_lastDepth = $depth;
                $this->_lastFileDepth = $depth + 1;
                $origpath = $path = $attribs['name'];
                if ($path === '/') {
                    $path = '';
                } else {
                    $path .= '/';
                }
                $this->_path .= $path;
                if (isset($attribs['baseinstalldir'])) {
                    $this->_baseinstalldirs[$origpath] = $attribs['baseinstalldir'];
                } else {
                    if (isset($this->_baseinstalldirs[dirname($path)])) {
                        $this->_baseinstalldirs[$origpath] = $this->_baseinstalldirs[dirname($path)];
                    }
                }
            } elseif ($name === 'file') {
                while ($this->_lastFileDepth > $depth) {
                    $this->_path = dirname($this->_path);
                    if ($this->_path == '.') {
                        $this->_path = '';
                    } else {
                        $this->_path .= '/';
                    }
                    $this->_lastFileDepth--;
                    $this->_lastDepth--;
                }
                $path = $this->_path . $attribs['name'];
                if (isset($arr['file'][0])) {
                    $newarr = $arr['file'][count($arr['file']) - 1];
                } else {
                    $newarr = $arr['file'];
                }
                $newarr['attribs']['name'] =
                    $path;
                $this->_files[$path] = $newarr;
                $this->_curFile = $path;
                $this->_inFile = $depth;
            } elseif ($this->_inFile) {
                // add tasks
                $this->_files[$this->_curFile][$name] = $arr[$name];
            }
        } elseif ($name === 'contents') {
            $this->_inContents = true;
        }
        return $arr;
    }
}
?>
<?php
/**
 * PEAR2_Pyrus_PackageFile_v2_SImpleProperty
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Represents a simple array property like version or stability
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_SimpleProperty implements ArrayAccess
{
    protected $info;
    protected $name;
    protected $parent;

    /**
     * @param array The content of this element.  All allowed indices should be initialized to null
     */
    function __construct($parent, $info, $name)
    {
        $this->parent = $parent;
        $this->info = $info;
        $this->name = $name;
    }

    function offsetUnset($var)
    {
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_Exception('Unknown ' . $this->name . ' property ' . $var);
        }
        $this->info[$var] = null;
        $this->save();
    }

    function offsetGet($var)
    {
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_Exception('Unknown ' . $this->name . ' property ' . $var);
        }
        return $this->info[$var];
    }

    function offsetSet($var, $value)
    {
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_Exception('Unknown ' . $this->name . ' property ' . $var);
        }
        if (!is_string($value)) {
            throw new PEAR2_Pyrus_PackageFile_Exception('Can only set ' . $this->name . ' to string');
        }
        $this->info[$var] = $value;
        $this->save();
    }

    function offsetExists($var)
    {
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_Exception('Unknown ' . $this->name . ' property ' . $var);
        }
        return isset($this->info[$var]);
    }

    function getInfo()
    {
        return $this->info;
    }

    function save()
    {
        $info = $this->info;
        foreach(array_keys($this->info) as $key) {
            if (null === $info[$key]) {
                unset($info[$key]);
            }
        }
        $this->parent->{'raw' . $this->name} = $info;
    }
}<?php
/**
 * PEAR2_Pyrus_PackageFile_v2_Developer
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Manage an individual maintainer in package.xml
 *
 * To be used like:
 *
 * <code>
 * // add developer
 * $pf->maintainer['cellog']
 *    ->name('Greg Beaver')
 *    ->role('lead')
 *    ->email('cellog@php.net')
 *    ->active('yes');
 * echo $pf->maintainer['cellog']->name;
 * isset($pf->maintainer['cellog']); // test for maintainer in package.xml
 * unset($pf->maintainer['cellog']); // remove from package.xml
 * </code>
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_Developer implements ArrayAccess, Iterator
{
    protected $parent;
    protected $role;
    protected $index;
    protected $info;
    private $_curRole;

    function __construct($parent, $info, $role = null, $index = null)
    {
        $this->parent = $parent;
        $this->info = $info;
        $this->role = $role;
        $this->index = $index;
    }

    function current()
    {
        $info = current($this->info[current($this->_curRole)]);
        foreach(array('name', 'user', 'email', 'active') as $key) {
            if (!array_key_exists($key, $info)) {
                $info[$key] = null;
            }
        }
        return new PEAR2_Pyrus_PackageFile_v2_Developer($this, $info, current($this->_curRole),
                                                        key($this->info[current($this->_curRole)]));
    }

    function key()
    {
        return key($this->info[current($this->_curRole)]);
    }

    function next()
    {
        $a = next($this->info[current($this->_curRole)]);
        while (!current($this->info[current($this->_curRole)])) {
            next($this->_curRole);
            if (!current($this->_curRole)) {
                return false;
            }
            reset($this->info[current($this->_curRole)]);
            if (count($this->info[current($this->_curRole)])) {
                return true;
            }
        }
        return $a;
    }

    function rewind()
    {
        $this->_curRole = array_keys($this->info);
        reset($this->info[current($this->_curRole)]);
    }

    function valid()
    {
        while (current($this->_curRole) && !current($this->info[current($this->_curRole)])) {
            next($this->_curRole);
            if (!current($this->_curRole)) {
                return false;
            }
            reset($this->info[current($this->_curRole)]);
            if (count($this->info[current($this->_curRole)])) {
                return true;
            }
        }
        return current($this->_curRole);
    }

    /**
     * Search for a maintainer, find them and return the maintainer role
     *
     * @param string $handle
     * @return array|false the role (lead, developer, contributor, helper)/index
     */
    function locateMaintainerRole($handle)
    {
        foreach ($this->info as $role => $devs) {
            foreach ($devs as $i => $developer) {
                if ($developer['user'] == $handle) {
                    return array($role, $i);
                }
            }
        }
        return false;
    }

    function __get($var)
    {
        if (!isset($this->info['user']) || !is_string($this->info['user'])) {
            throw new PEAR2_Pyrus_PackageFile_v2_Developer_Exception(
                'Cannot access developer info for unknown developer');
        }
        if ($var === 'role') {
            return $this->role;
        }
        if (!isset($this->info[$var])) {
            if (!array_key_exists($var, $this->info)) {
                $keys = $this->info;
                unset($keys['user']);
                $keys = array_keys($keys);
                throw new PEAR2_Pyrus_PackageFile_v2_Developer_Exception(
                    'Unknown variable ' . $var . ', should be one of ' . implode(', ', $keys));
            }
            return null;
        }
        return $this->info[$var];
    }

    function __call($var, $args)
    {
        if (!isset($this->info['user']) || !is_string($this->info['user'])) {
            throw new PEAR2_Pyrus_PackageFile_v2_Developer_Exception(
                'Cannot set developer info for unknown developer');
        }
        if ($var == 'role') {
            $oldrole = $this->role;
            $this->role = $args[0];
            $this->save($oldrole);
            return $this;
        }
        if (!array_key_exists($var, $this->info) || $var == 'user') {
            throw new PEAR2_Pyrus_PackageFile_v2_Developer_Exception(
                'Cannot set unknown value ' . $var);
        }
        if (count($args) != 1) {
            throw new PEAR2_Pyrus_PackageFile_v2_Developer_Exception(
                'Can only set ' . $var . ' to 1 value');
        }
        if (!is_string($args[0])) {
            throw new PEAR2_Pyrus_PackageFile_v2_Developer_Exception(
                'Invalid value for ' . $var . ', must be a string');
        }
        $this->info[$var] = $args[0];
        $this->save($this->role);
        return $this;
    }

    function offsetGet($var)
    {
        if (isset($this->info['user']) && is_string($this->info['user'])) {
            throw new PEAR2_Pyrus_PackageFile_v2_Developer_Exception(
                'Use -> to access properties of a developer');
        }
        if (!is_string($var)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Developer_Exception('Developer handle cannot be numeric');
        }
        $developer = $var;
        if ($role = $this->locateMaintainerRole($developer)) {
            $info = $this->info[$role[0]][$role[1]];
            foreach (array('name' => null, 'user' => $var, 'email' => null, 'active' => 'yes') as $key => $null) {
                if (!isset($info[$key])) {
                    $info[$key] = null;
                }
            }
            return new PEAR2_Pyrus_PackageFile_v2_Developer($this, $info, $role[0], $role[1]);
        }
        return new PEAR2_Pyrus_PackageFile_v2_Developer($this,
            array('name' => null, 'user' => $var, 'email' => null, 'active' => 'yes'), null, null);
    }

    function offsetSet($var, $value)
    {
        if (isset($this->info['user']) && is_string($this->info['user'])) {
            throw new PEAR2_Pyrus_PackageFile_v2_Developer_Exception(
                'Use -> to access properties of a developer');
        }
        if (!is_string($var)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Developer_Exception('Developer handle cannot be numeric');
        }
        if (!($value instanceof PEAR2_Pyrus_PackageFile_v2_Developer)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Developer_Exception(
                'Can only set a developer to a PEAR2_Pyrus_PackageFile_v2_Developer object'
            );
        }
        if (false !== ($i = $this->locateMaintainerRole($var))) {
            // remove old developer role, set new role
            unset($this->info[$i[0]][$i[1]]);
        }
        $i = count($this->info[$value->role]);
        $this->info[$value->role][] = $value->getInfo();
        $this->info[$value->role][$i]['user'] = $var;
        $this->save();
    }

    /**
     * Remove a developer from package.xml (by handle)
     * @param string $var
     */
    function offsetUnset($var)
    {
        if (isset($this->info['user']) && is_string($this->info['user'])) {
            throw new PEAR2_Pyrus_PackageFile_v2_Developer_Exception(
                'Use -> to retrieve properties of a developer');
        }
        // remove developer
        $role = $this->locateMaintainerRole($var);
        if (!$role) {
            // already non-existent
            return;
        }
        unset($this->info[$role[0]][$role[1]]);
        $this->save();
    }

    /**
     * Test whether developer exists in package.xml (by handle)
     * @param string $var
     * @return bool
     */
    function offsetExists($var)
    {
        if (isset($this->info['user']) && is_string($this->info['user'])) {
            throw new PEAR2_Pyrus_PackageFile_v2_Developer_Exception(
                'Use -> to retrieve properties of a developer');
        }
        return (bool) $this->locateMaintainerRole($var);
    }

    /**
     * Retrieve the new index of this developer, newly added to this role
     * @return int
     */
    function getNewIndex($user, $role)
    {
        $i = $this->locateMaintainerRole($user);
        if (false === $i) {
            return count($this->info[$role]) - 1;
        }
        return $i[1];
    }

    function getInfo()
    {
        return $this->info;
    }

    function toArray()
    {
        $info = $this->info;
        $ret = array('name' => null, 'user' => null, 'email' => null, 'active' => null);
        foreach ($info as $key => $value) {
            $ret[$key] = $value;
        }
        return $ret;
    }

    function setInfo($info, $oldrole, $index, $role)
    {
        foreach (array_keys($info) as $key) {
            if ($info[$key] === null) {
                unset($info[$key]);
            }
        }
        if ($role !== null && $oldrole != $role) {
            // we just changed the role.
            if ($oldrole && isset($this->info[$oldrole][$index])) {
                unset($this->info[$oldrole][$index]);
                $this->info[$oldrole] = array_values($this->info[$oldrole]);
            }
            if (!count($info)) {
                // essentially remove the old one and wait for data to save the new
                return;
            }
            $this->info[$role][] = $info;
        } else {
            $this->info[$role][$index] = $info;
        }
    }

    /**
     * Save changes
     */
    protected function save($oldrole = null)
    {
        if ($this->parent instanceof self) {
            if ($this->role === null) {
                return;
            }
            $this->parent->setInfo($this->info, $oldrole, $this->index, $this->role);
            if ($this->role !== null && $oldrole != $this->role) {
                $this->index = $this->parent->getNewIndex($this->info['user'], $this->role);
            }
            $this->parent->save();
        } else {
            foreach ($this->info as $role => $info) {
                if (is_string($info)) {
                    $info = array($info);
                } else {
                    $info = array_values($info);
                }
                if (!count($info)) {
                    $this->parent->{'raw' . $role} = null;
                } else {
                    if (count($info) == 1) {
                        $info = $info[0];
                    }
                    $this->parent->{'raw' . $role} = $info;
                }
            }
        }
    }
}<?php
/**
 * PEAR2_Pyrus_PackageFile_v2_Files
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Represents the files within a package file
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_Files implements ArrayAccess, Iterator
{
    protected $info;
    protected $parent;

    function __construct($parent, $info)
    {
        $this->parent = $parent;
        $this->info = $info;
    }

    function offsetUnset($var)
    {
        unset($this->info[$var]);
        $this->parent->setFilelistFile($var, null);
    }

    function offsetGet($var)
    {
        if (isset($this->info[$var])) {
            return new PEAR2_Pyrus_PackageFile_v2_Files_File($this, $this->parent, $this->info[$var]);
        }
        return null;
    }

    function offsetSet($var, $value)
    {
        if ($value instanceof ArrayObject) {
            $value = $value->getArrayCopy();
        }
        if (!is_array($value)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Files_Exception('File must be an array of '
                . 'attributes and tasks');
        }

        if (!isset($value['attribs'])) {
            // no tasks is assumed
            $value = array('attribs' => $value);
        }

        $value['attribs']['name'] = $var;
        if (!isset($value['attribs']['role'])) {
            throw new PEAR2_Pyrus_PackageFile_v2_Files_Exception('File role must be set for' .
                ' file ' . $var);
        }

        $this->info[$var] = $value;
        $this->parent->setFilelistFile($var, $value);
    }

    function offsetExists($var)
    {
        return isset($this->info[$var]);
    }

    function valid()
    {
        return $this->key();
    }

    function next()
    {
        return next($this->info);
    }

    function current()
    {
        return $this[$this->key()];
    }

    function key()
    {
        return key($this->info);
    }

    function rewind()
    {
        reset($this->info);
    }
}<?php
class PEAR2_Pyrus_PackageFile_v2_UsesRoleTask implements ArrayAccess, Iterator, Countable
{
    protected $parent;
    protected $info;
    protected $type;
    protected $index;
    function __construct($parent, array $info, $type, $index = null)
    {
        $this->parent = $parent;
        $this->info = $info;
        $this->type = $type;
        $this->index = $index;
    }

    function current()
    {
        $info = current($this->info);
        foreach (array($this->type, 'package', 'channel', 'uri') as $key) {
            if (!array_key_exists($key, $info)) {
                $info[$key] = null;
            }
        }
        return new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask($this, $info, $this->type, key($this->info));
    }

    function count()
    {
        return count($this->info);
    }

    function rewind()
    {
        reset($this->info);
    }

    function key()
    {
        $info = current($this->info);
        return $info[$this->type];
    }

    function next()
    {
        return next($this->info);
    }

    function valid()
    {
        return current($this->info);
    }

    function locateRoleTask($name)
    {
        foreach ($this->info as $i => $dep)
        {
            if (isset($dep[$this->type]) && $dep[$this->type] == $name) {
                return $i;
            }
        }
        return false;
    }

    function offsetGet($var)
    {
        if ($this->index !== null) {
            throw new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception(
                'use -> operator to access properties of a uses' . $this->type);
        }
        $i = $this->locateRoleTask($var);
        if (false === $i) {
            $i = count($this->info);
            $info = array($this->type => $var, 'package' => null, 'channel' => null, 'uri' => null);
        } else {
            $info = $this->info[$i];
            foreach (array($this->type, 'package', 'channel', 'uri') as $key) {
                if (!array_key_exists($key, $this->info[$i])) {
                    $info[$key] = null;
                }
            }
        }
        return new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask($this, $info, $this->type, $i);
    }

    function offsetSet($var, $value)
    {
        if ($this->index !== null) {
            throw new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception(
                'use -> operator to access properties of a uses' . $this->type);
        }
        if (!($value instanceof PEAR2_Pyrus_PackageFile_v2_UsesRoleTask)) {
            throw new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception(
                'Can only set uses' . $this->type . ' to a PEAR2_Pyrus_PackageFile_v2_UsesRoleTask object');
        }
        if ($value->type != $this->type) {
            throw new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception(
                'Cannot set uses' . $this->type . ' to a uses' . $value->type . ' object');
        }
        $i = $this->locateRoleTask($var);
        if (false === $i) {
            $i = count($this->info);
        }
        $this->info[$i] = array($this->type => $var,
                                'package' => $value->package,
                                'channel' => $value->channel,
                                'uri' => $value->uri);
        $this->save();
    }

    function offsetExists($var)
    {
        if ($this->index !== null) {
            throw new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception(
                'use -> operator to access properties of a uses' . $this->type);
        }
        $i = $this->locateRoleTask($var);
        return $i !== false;
    }

    function offsetUnset($var)
    {
        if ($this->index !== null) {
            throw new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception(
                'use -> operator to access properties of a uses' . $this->type);
        }
        $i = $this->locateRoleTask($var);
        if ($i === false) {
            return;
        }
        unset($this->info[$i]);
        $this->info = array_values($this->info);
        $this->save();
    }

    function __unset($var)
    {
        if ($this->index === null) {
            throw new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception(
                'use [] operator to access uses' . $this->type . 's');
        }
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception(
                'Unknown variable ' . $var . ' requested, should be one of ' .
                implode(', ', array_keys($this->info))
            );
        }
        $this->info[$var] = null;
        $this->save();
    }

    function __isset($var)
    {
        if ($this->index === null) {
            throw new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception(
                'use [] operator to access uses' . $this->type . 's');
        }
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception(
                'Unknown variable ' . $var . ' requested, should be one of ' .
                implode(', ', array_keys($this->info))
            );
        }
        return isset($this->info[$var]);
    }

    function __set($var, $value)
    {
        return $this->__call($var, array($value));
    }

    function __call($var, $args)
    {
        if ($this->index === null) {
            throw new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception(
                'use [] operator to access uses' . $this->type . 's');
        }
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception('Unknown variable ' . $var . ', must be one of ' .
                            implode(', ', array_keys($this->info)));
        }
        if ($args[0] === null) {
            $this->info[$var] = null;
            $this->save();
            return $this;
        }
        if ($var === 'channel' || $var === 'package') {
            $this->info['uri'] = null;
        } elseif ($var === 'uri') {
            $this->info['channel'] = null;
            $this->info['package'] = null;
        }
        $this->info[$var] = $args[0];
        $this->save();
        return $this;
    }

    function __get($var)
    {
        if ($this->index === null) {
            throw new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception(
                'use [] operator to access uses' . $this->type . 's');
        }
        if ($var === 'type') {
            return 'uses' . $this->type;
        }
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception('Unknown variable ' . $var . ', must be one of ' .
                            implode(', ', array_keys($this->info)));
        }
        if (!isset($this->info[$var])) {
            return null;
        }
        return $this->info[$var];
    }

    function getInfo()
    {
        return $this->info;
    }

    function setInfo($info, $index)
    {
        foreach (array_keys($info) as $key) {
            if ($info[$key] === null) {
                unset($info[$key]);
            }
        }
        $this->info[$index] = $info;
    }

    function save()
    {
        if ($this->parent instanceof self) {
            $this->parent->setInfo($this->info, $this->index);
            $this->parent->save();
            return;
        }
        $info = $this->info;
        if (count($info) == 1) {
            $info = $info[0];
        }
        $this->parent->{'rawuses' . $this->type} = $info;
    }
}
?><?php
/**
 * PEAR2_Pyrus_PackageFile_v2_Developer_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for developer exceptions in a package file.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_Developer_Exception extends PEAR2_Exception {}<?php
/**
 * PEAR2_Pyrus_PackageFile_v2_Release
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Manage a release in package.xml
 *
 * To be used like:
 *
 * <code>
 * // release is a PHP package
 * $pf->type = 'php';
 * // release is an extension source package
 * $pf->type = 'extsrc';
 * $pf->release[0]->installconditions['php']->min('5.2.0');
 * // defaults to "min"
 * $pf->release[0]->installconditions['php'] = '5.2.0';
 * // defaults to "pattern"
 * $pf->release[0]->installconditions['arch'] = 'i386';
 * $pf->release[0]->installconditions['arch']->pattern('i386')->conflicts();
 * // defaults to "name"
 * $pf->release[0]->installconditions['os'] = 'windows';
 * // defaults to existing
 * $pf->release[0]->installconditions['extension'][0]->name('PDO');
 * $pf->release[0]->installconditions['extension'][0]->name('PDO')->min('1.0');
 * $pf->release[0]->ignore('path/to/file.ext');
 * $pf->release[0]->installAs('path/to/anotherfile.ext', 'new/name.php');
 * // add another release
 * $i = count($pf->release);
 * $pf->release[$i]->ignore('path/to/anotherfile.ext');
 * $pf->release[$i]->installAs('path/to/file.ext', 'new/name.php');
 * // remove release
 * unset($pf->release[1]);
 * // remove all releases
 * $pf->release = null;
 * </code>
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_Release implements ArrayAccess, Countable
{
    private $_parent;
    private $_packageInfo;
    private $_filelist;
    protected $index;
    protected $info = array();

    function __construct($parent, $packageInfo, array $filelist, $index = null)
    {
        $this->_parent = $parent;
        $this->_packageInfo = $packageInfo;
        $this->_filelist = $filelist;
        if ($index !== null) {
            $this->index = $index;
            $this->info = $packageInfo;
        } else {
            if (isset($packageInfo[0])) {
                $this->info = $packageInfo;
            } else if (count($packageInfo)) {
                $this->info = array($packageInfo);
            }
        }
    }

    function __isset($var)
    {
        if (!isset($this->index)) {
            return false;
        }
        return isset($this->info[$var]);
    }

    function __get($var)
    {
        if (!isset($this->index)) {
            return null;
        }
        if ($var === 'configureoption') {
            if (!isset($this->info['configureoption'])) {
                $info = array();
            } else {
                $info = $this->info['configureoption'];
                if (!is_array($info) || !isset($info[0])) {
                    $info = array($info);
                }
            }
            return new PEAR2_Pyrus_PackageFile_v2_Release_ConfigureOption($this, $info);
        }
        if ($var === 'binarypackage') {
            if (!isset($this->info['binarypackage'])) {
                $info = array();
            } else {
                $info = $this->info['binarypackage'];
                if (!is_array($info)) {
                    $info = array($info);
                }
            }
            return new PEAR2_Pyrus_PackageFile_v2_Release_BinaryPackage($this, $info);
        }
        if ($var === 'installconditions') {
            if (!isset($this->info['installcondition'])) {
                $this->info['installcondition'] = array();
            }
            $conditions =
                new PEAR2_Pyrus_PackageFile_v2_Release_InstallCondition($this, $this->info['installcondition']);
            return $conditions;
        }
        throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Unknown variable ' . $var .
            ', installconditions is the only supported variable');
    }

    function setBinaryPackage($info)
    {
        $this->info['binarypackage'] = $info;
    }

    function setConfigureOption($info)
    {
        $this->info['configureoption'] = $info;
    }

    function count()
    {
        if (isset($this->index)) {
            return 1;
        }
        return count($this->info);
    }

    function offsetGet($var)
    {
        if (is_int($var) && !isset($this->index)) {
            if (isset($this->info[0])) {
                if (!isset($this->info[$var])) {
                    if ($var != count($this)) {
                        throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception(
                            'Can only set the ' .
                            'next highest release index ' . count($this) . ', not ' . $var);
                    }
                    $this->info[$var] = array();
                }
                return new PEAR2_Pyrus_PackageFile_v2_Release($this,
                           $this->info[$var], $this->_filelist, $var);
            } else {
                if ($var !== 0) {
                    throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Can only set the ' .
                        'next highest release index 0, not ' . $var);
                }
                $this->info[$var] = array();
                return new PEAR2_Pyrus_PackageFile_v2_Release($this,
                           $this->info[$var], $this->_filelist, $var);
            }
        }
    }

    /**
     * @return array
     */
    function getInstallCondition()
    {
        if (!isset($this->index)) {
            return null;
        }
        if (!isset($this->info['installcondition'])) {
            return false;
        }
        return $this->info['installcondition'];
    }

    function getInstallAs()
    {
        if (!isset($this->index)) {
            return null;
        }
        if (!isset($this->info['filelist'])) {
            return false;
        }
        if (!isset($this->info['filelist']['install'])) {
            return false;
        }
        return $this->info['filelist']['install'];
    }

    function getIgnore()
    {
        if (!isset($this->index)) {
            return null;
        }
        if (!isset($this->info['filelist'])) {
            return false;
        }
        if (!isset($this->info['filelist']['ignore'])) {
            return false;
        }
        return $this->info['filelist']['ignore'];
    }

    function ignores($file)
    {
        $ignore = $this->getIgnore();
        if (!$ignore) {
            return false;
        }
        if (!isset($ignore[0])) {
            $ignore = array($ignore);
        }
        foreach ($ignore as $ignored) {
            if ($ignored['attribs']['name'] == $file) {
                return true;
            }
        }
        return false;
    }

    function installsAs($file)
    {
        $install = $this->getInstallAs();
        if (!$install) {
            return $file;
        }
        if (!isset($install[0])) {
            $install = array($install);
        }
        foreach ($install as $as) {
            if ($as['attribs']['name'] == $file) {
                return $as['attribs']['as'];
            }
        }
        return $file;
    }

    function offsetSet($var, $value)
    {
        if ($var === null) {
            $var = count($this->info);
        }

        if (is_int($var)) {
            if ($value instanceof PEAR2_Pyrus_PackageFile_v2_Release) {
                $this->info[$var] = array('installcondition' => $value->getInstallCondition(),
                                          'install' => $value->getInstallAs(),
                                          'ignore' => $value->getIgnore());
                $this->save();
                return;
            }
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Cannot set ' . $var . ' to non-PEAR2_Pyrus_PackageFile_v2_Release');
        }
        throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Cannot set ' . $var);
    }

    /**
     * @param string $var
     */
    function offsetUnset($var)
    {
        unset($this->info[$var]);
        $this->save();
    }

    /**
     * @param string $var
     * @return bool
     */
    function offsetExists($var)
    {
        return isset($this->info[$var]);
    }

    function ignore($file)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Cannot ignore ' .
                            'file ' . $file . ' without specifying which release section to ignore it in');
        }
        if (isset($this->_filelist[$file])) {
            if (!isset($this->info['filelist'])) {
                $this->info['filelist'] = array();
            }
            if (!isset($this->info['filelist']['ignore'])) {
                $this->info['filelist']['ignore'] = array(array('attribs' => array('name' => $file)));
            } else {
                if (!isset($this->info['filelist']['ignore'][0])) {
                    $this->info['filelist']['ignore'] = array($this->info['filelist']['ignore']);
                }
                $this->info['filelist']['ignore'][] = array('attribs' => array('name' => $file));
            }
            $this->save();
            return;
        }

        throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Unknown file ' . $file .
            ' - add to filelist before ignoring');
    }

    function installAs($file, $newname)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Cannot install ' .
                            'file ' . $file . ' to ' . $newname .
                            ' without specifying which release section to install it in');
        }

        if (isset($this->_filelist[$file])) {
            if (!isset($this->info['filelist'])) {
                $this->info['filelist'] = array();
            }
            if (!isset($this->info['filelist']['install'])) {
                $this->info['filelist']['install'] = array(array('attribs' =>
                    array('name' => $file, 'as' => $newname)));
            } else {
                if (!isset($this->info['filelist']['install'][0])) {
                    $this->info['filelist']['install'] = array($this->info['filelist']['install']);
                }
                $this->info['filelist']['install'][] = array('attribs' =>
                    array('name' => $file, 'as' => $newname));
            }
            $this->save();
            return;
        }

        throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Unknown file ' . $file .
            ' - add to filelist before adding install as tag');
    }

    function setInstallCondition(PEAR2_Pyrus_PackageFile_v2_Release_InstallCondition $c)
    {
        $this->info['installcondition'] = $c->getInfo();
        $this->save();
    }

    function setReleaseInfo($index, $info)
    {
        $this->info[$index] = $info;
    }

    /**
     * Saves results to the parent packagefile object
     */
    function save()
    {
        if (isset($this->index)) {
            $this->_parent->setReleaseInfo($this->index, $this->info);
            return $this->_parent->save();
        }
        $newXml = $this->info;
        foreach ($newXml as $index => $info) {
            if (isset($info['filelist'])) {
                if (isset($info['filelist']['ignore']) && count($info['filelist']['ignore']) == 1 && !isset($info['filelist']['ignore']['attribs'])) {
                    $newXml[$index]['filelist']['ignore'] = $newXml[$index]['filelist']['ignore'][0];
                }
                if (isset($info['filelist']['install']) && count($info['filelist']['install']) == 1 && !isset($info['filelist']['install']['attribs'])) {
                    $newXml[$index]['filelist']['install'] = $newXml[$index]['filelist']['install'][0];
                }
                if (array_key_exists('ignore', $info['filelist']) && !count($info['filelist']['ignore'])) {
                    unset($newXml[$index]['filelist']['ignore']);
                }
                if (array_key_exists('install', $info['filelist']) && !count($info['filelist']['install'])) {
                    unset($newXml[$index]['filelist']['install']);
                }
            }
            if (array_key_exists('installcondition', $info) && count($info['installcondition'])) {
                foreach (array('php', 'os', 'arch') as $key) {
                    if (!isset($info['installcondition'][$key])) {
                        continue;
                    }
                    foreach (array_keys($info['installcondition'][$key]) as $ikey) {
                        if ($info['installcondition'][$key][$ikey] === null) {
                            unset($newXml[$index]['installcondition'][$key][$ikey]);
                        }
                    }
                    if (!count($newXml[$index]['installcondition'][$key])) {
                        unset($newXml[$index]['installcondition'][$key]);
                    }
                }
                if (array_key_exists('extension', $info['installcondition']) && !count($info['installcondition']['extension'])) {
                    unset($newXml[$index]['installcondition']['extension']);
                }
                if (isset($info['installcondition']['extension'])) {
                    if (!isset($info['installcondition']['extension'][0])) {
                        $newXml[$index]['installcondition']['extension'] = $info['installcondition']['extension'] =
                            array($info['installcondition']['extension']);
                    }
                    foreach ($info['installcondition']['extension'] as $extkey => $ext) {
                        foreach (array_keys($ext) as $key) {
                            if ($ext[$key] === null) {
                                unset($newXml[$index]['installcondition']['extension'][$extkey][$key]);
                            }
                        }
                        if (!count($newXml[$index]['installcondition']['extension'][$extkey])) {
                            unset($newXml[$index]['installcondition']['extension'][$extkey]);
                        }
                    }
                    if (count($newXml[$index]['installcondition']['extension']) == 1) {
                        $newXml[$index]['installcondition']['extension'] =
                            array_values($newXml[$index]['installcondition']['extension']);
                        $newXml[$index]['installcondition']['extension'] =
                            $newXml[$index]['installcondition']['extension'][0];
                    } elseif (count($newXml[$index]['installcondition']['extension']) == 0) {
                        unset($newXml[$index]['installcondition']['extension']);
                    }
                }

                if (!count($newXml[$index]['installcondition'])) {
                    unset($newXml[$index]['installcondition']);
                    continue;
                }
            } else {
                unset($newXml[$index]['installcondition']);
            }
        }
        if (count($newXml) == 1) {
            $newXml = $newXml[0];
        }
        $this->_parent->rawrelease = $newXml;
    }
}<?php
/**
 * PEAR2_Pyrus_PackageFile_v2_Dependencies
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Manage dependencies
 *
 * To be used like:
 * <code>
 * // reset deps
 * $reg->dependencies = null;
 * // for PHP dep
 * // defaults to min
 * $reg->dependencies['required']->php = '5.3.0';
 * $reg->dependencies['required']->php->min('5.3.1')->max('7.0.0')->exclude('6.1.2');
 * 
 * $reg->dependencies['required']->php = null;
 * 
 * $reg->dependencies['required']->php->exclude('6.1.2')->exclude('6.1.3');
 * $reg->dependencies['required']->php->exclude(null);
 * 
 * // for PEAR Installer dep
 * // defaults to min
 * $reg->dependencies['required']->pearinstaller = '2.0.0';
 * $reg->dependencies['required']->pearinstaller->min('2.0.1')->max('3.0.0');
 * 
 * // for required/optional package deps or subpackage deps
 * $reg->dependencies->required->package['channel/PackageName']->min('1.1.0')->max('1.2.0')->recommended('1.1.1')
 *     ->exclude('1.1.0a1')->exclude('1.1.0a2');
 * $reg->dependencies['optional']->package['channel/PackageName']->min('1.1.0')->max('1.2.0')->recommended('1.1.1')
 *     ->exclude('1.1.0a1')->exclude('1.1.0a2');
 * 
 * $reg->dependencies->required->subpackage['channel/subpackageName']->min('1.1.0')->max('1.2.0')->recommended('1.1.1')
 *     ->exclude('1.1.0a1')->exclude('1.1.0a2');
 * $reg->dependencies->optional->subpackage['channel/subpackageName']->min('1.1.0')->max('1.2.0')->recommended('1.1.1')
 *     ->exclude('1.1.0a1')->exclude('1.1.0a2');
 * 
 * // for conflicting package dep
 * $reg->dependencies['required']->subpackage['channel/PackageName']->conflicts();
 * $reg->dependencies['required']->subpackage['channel/PackageName']->conflicts(false);
 * 
 * // for PECL extension deps (optional or required same as packages)
 * $reg->dependencies['required']->package['channel/PackageName']->providesextension('packagename');
 * 
 * // for extension deps (required or optional same as packages)
 * $reg->dependencies['required']->extension['extname']->min('1.0.0')->max('1.2.0')->recommended('1.1.1');
 * 
 * // for regular arch deps
 * $reg->dependencies['required']->arch['i386'] = true; // only works on i386
 * 
 * // for conflicting arch deps
 * $reg->dependencies['required']->arch['*(ix|ux)'] = false; // doesn't work on unix/linux
 * 
 * // for regular OS deps
 * $reg->dependencies['required']->os['windows'] = true; // only works on windows
 * 
 * // for conflicting OS deps
 * $reg->dependencies['required']->os['freebsd'] = false; // doesn't work on FreeBSD
 * 
 * // dependency group setup
 * $group = $reg->dependencies['group']->groupname;
 * $group->hint = 'Install optional stuff as a group';
 * 
 * $group->package['channel/PackageName1']->save();
 * $group->package['channel/PackageName2']->min('1.2.0');
 * $group->subpackage['channel/PackageName3']->min('1.3.0');
 * 
 * $group->extension['extension']->save();
 * </code>
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_Dependencies implements ArrayAccess
{
    protected $parent;
    protected $info = array();
    protected $deptype = null;

    function __construct($parent, $info, $deptype = null)
    {
        $this->parent = $parent;
        $this->info = $info;
        $this->deptype = $deptype;
    }

    function __get($var)
    {
        if ($this->deptype === null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception(
                'Cannot retrieve dependency type, choose $pf->dependencies[\'required\']->' .
                $var . ' or $pf->dependencies[\'optional\']->' . $var);
        }
        $depname = 'name';
        if (!isset($this->info[$var])) {
            switch ($var) {
                case 'arch' :
                    $depname = 'pattern';
                    // break intentionally omitted
                case 'os' :
                    if ($this->deptype === 'optional' || $this->deptype === 'group') {
                        throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception(
                                $var . ' dependency is not supported as an optional dependency');
                    }
                    $info = array();
                    break;
                case 'php' :
                    $info = array('min' => null, 'max' => null, 'exclude' => null);
                    break;
                case 'pearinstaller' :
                    $info = array('min' => null, 'max' => null, 'exclude' => null, 'recommended' => null);
                    break;
                case 'package' :
                case 'subpackage' :
                case 'extension' :
                    $info = array();
                    return new PEAR2_Pyrus_PackageFile_v2_Dependencies_Package($this->deptype, $var, $this, $info);
                default :
                    throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Unknown dependency type: '.
                        $var);
            }
        } else {
            $info = $this->info[$var];
            if (!is_array($info)) {
                $info = array($info);
            }
            $keys = array();
            switch ($var) {
                case 'php' :
                    $keys = array('min' => null, 'max' => null, 'exclude' => null);
                    break;
                case 'pearinstaller' :
                    $keys = array('min' => null, 'max' => null, 'exclude' => null, 'recommended' => null);
                    break;
                case 'package' :
                case 'subpackage' :
                case 'extension' :
                    if (count($info) && !isset($info[0])) {
                        $info = array($info);
                    }
                    return new PEAR2_Pyrus_PackageFile_v2_Dependencies_Package($this->deptype, $var, $this, $info);
            }
            foreach ($keys as $key => $null) {
                if (!array_key_exists($key, $info)) {
                    $info[$key] = $null;
                }
            }
        }
        return new PEAR2_Pyrus_PackageFile_v2_Dependencies_Dep($this, $info, $var);
    }

    function __set($var, $value)
    {
        if ($this->deptype === null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception(
                'Cannot set dependency type, choose $pf->dependencies[\'required\']->' .
                $var . ' or $pf->dependencies[\'optional\']->' . $var);
        }
        if ($value === null) {
            unset($this->info[$var]);
            $this->save();
            return;
        }
        $info = array();
        switch ($var) {
            case 'php' :
                if (is_string($value)) {
                    $info['min'] = $value;
                }
                break;
            case 'pearinstaller' :
                if (is_string($value)) {
                    $info['min'] = $value;
                }
                break;
            case 'arch' :
            case 'os' :
                if ($this->deptype === 'optional' || $this->deptype === 'group') {
                    throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception(
                            $var . ' dependency is not supported as an optional dependency');
                }
                if (!($value instanceof PEAR2_Pyrus_PackageFile_v2_Dependencies_Dep)) {
                    throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception(
                        'Can only set ' . $var . ' to PEAR2_Pyrus_PackageFile_v2_Dependencies_Dep object'
                    );
                }
                $this->info[$var] = $value->getInfo();
                $this->save();
                return;
            case 'package' :
            case 'subpackage' :
            case 'extension' :
                if (!($value instanceof PEAR2_Pyrus_PackageFile_v2_Dependencies_Package)) {
                    throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception(
                        'Can only set ' . $var . ' to PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object'
                    );
                }
                $this->info[$var] = $value->getInfo();
                $this->save();
                return;
            default :
                throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Unknown dependency type: ' . $var);
        }
        $this->info[$var] = $info;
        $this->save();
    }

    function __isset($var)
    {
        if ($this->deptype === null) {
            return false;
        }
        return isset($this->info[$var]) && !empty($this->info[$var]);
    }

    function offsetGet($var)
    {
        if ($this->deptype !== null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Cannot access ' .
                                    '$pf->dependencies[\'' . $this->deptype . '\'][\'' . $var . '\']');
        }
        if ($var === 'required' || $var === 'optional') {
            if (!isset($this->info[$var]) || !is_array($this->info[$var])) {
                $this->info[$var] = array();
            }
            return new PEAR2_Pyrus_PackageFile_v2_Dependencies($this, $this->info[$var], $var);
        }
        if ($var === 'group') {
            if (!isset($this->info[$var]) || !is_array($this->info[$var])) {
                $this->info[$var] = array();
            }
            return new PEAR2_Pyrus_PackageFile_v2_Dependencies_Group($this, $this->info['group']);
        }
    }

    function offsetSet($var, $value)
    {
        if ($this->deptype !== null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Cannot set ' .
                                    '$pf->dependencies[\'' . $this->deptype . '\'][\'' . $var . '\']');
        }
        if ($var === 'group') {
            if (!($value instanceof PEAR2_Pyrus_PackageFile_v2_Dependencies_Group)) {
                throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Cannot set group to anything' .
                            ' but a PEAR2_Pyrus_PackageFile_v2_Dependencies_Group object');
            }
            $this->info['group'] = $value->getInfo();
            $this->save();
            return;
        }
        if ($var === 'required' || $var === 'optional') {
            if (!($value instanceof PEAR2_Pyrus_PackageFile_v2_Dependencies)) {
                throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Cannot set ' . $var . ' to anything' .
                            ' but a PEAR2_Pyrus_PackageFile_v2_Dependencies object');
            }
            $this->info[$var] = $value->getInfo();
            $this->save();
            return;
        }
        throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Only required, optional, or group indices' .
                        ' are supported, was passed ' . $var);
    }

    function offsetExists($var)
    {
        return isset($this->info[$var]) && !empty($this->info[$var]);
    }

    function offsetUnset($var)
    {
        unset($this->info[$var]);
        $this->save();
    }

    function setInfo($deptype, $info)
    {
        foreach ($info as $key => $null) {
            if ($null === null) {
                unset($info[$key]);
            }
        }
        if (!count($info)) {
            unset($this->info[$deptype]);
            return;
        }
        $this->info[$deptype] = $info;
    }

    function getInfo()
    {
        return $this->info;
    }

    function save()
    {
        if ($this->deptype !== null) {
            $this->parent->setInfo($this->deptype, $this->info);
            return $this->parent->save();
        }
        $this->parent->rawdependencies = $this->info;
    }
}<?php
/**
 * PEAR2_Pyrus_PackageFile_v2_License_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for exceptions when handling package license.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_License_Exception extends PEAR2_Exception {}<?php
/**
 * Manage compatible packages with this one
 *
 * To be used like:
 * <code>
 * // add a new compatible declaration or replace an existing one
 * $pf->compatible['pear.php.net/Archive_Tar']
 *         ->min('1.2')
 *         ->max('1.3.0')
 *         ->exclude('1.2.1', '1.2.2');
 * // remove a compatibility declaration
 * unset($pf->compatible['pear.php.net/Archive_Tar']);
 * // test for existence of compatible declaration
 * isset($pf->compatible['pear.php.net/Archive_Tar']);
 * // display info:
 * echo $pf->compatible['pear.php.net/Archive_Tar']->min;
 * foreach ($pf->compatible as $package => $info) {
 *     echo $info->min;
 *     echo $info->max;
 *     if (isset($info->exclude)) {
 *         foreach ($info->exclude as $version) {
 *             echo $version;
 *         }
 *     }
 * }
 * </code>
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_Compatible implements ArrayAccess, Iterator, Countable
{
    protected $info;
    protected $index = null;
    protected $parent;

    function __construct($parent, array $info, $index = null)
    {
        $this->parent = $parent;
        if (!($parent instanceof self) && !isset($info[0]) && count($info)) {
            $info = array($info);
        }
        $this->info = $info;
        $this->index = $index;
    }

    function count()
    {
        return count($this->info);
    }

    function current()
    {
        $i = key($this->info);
        return new PEAR2_Pyrus_PackageFile_v2_Compatible($this, $this->info[$i], $i);
    }

    function rewind()
    {
        reset($this->info);
    }

    function key()
    {
        $i = key($this->info);
        return $this->info[$i]['channel'] . '/' . $this->info[$i]['name'];
    }

    function next()
    {
        return next($this->info);
    }

    function valid()
    {
        return current($this->info);
    }

    function locateCompatible($name)
    {
        $stuff = explode('/', $name);
        $name = array_pop($stuff);
        $channel = implode('/', $stuff);
        foreach ($this->info as $i => $compat)
        {
            if (isset($compat['name']) && $compat['name'] == $name
                && isset($compat['channel']) && $compat['channel'] == $channel) {
                return $i;
            }
        }
        return false;
    }

    function offsetGet($var)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Compatible_Exception('Use -> operator to access compatible package properties');
        }
        $i = $this->locateCompatible($var);
        if (false === $i) {
            $i = count($this->info);
            if (!strpos($var, '/')) {
                throw new PEAR2_Pyrus_PackageFile_v2_Compatible_Exception('Cannot access "' . $var .
                    '", must use "channel/package" to specify a compatible package to access');
            }
            $stuff = explode('/', $var);
            $name = array_pop($stuff);
            $channel = implode('/', $stuff);
            $this->info[$i] = array('name' => $name, 'channel' => $channel,
                                        'min' => null, 'max' => null,
                                        'exclude' => null);
        } else {
            foreach (array('name', 'channel', 'min', 'max', 'exclude') as $key) {
                if (!array_key_exists($key, $this->info[$i])) {
                    $this->info[$i][$key] = null;
                }
            }
        }
        return new PEAR2_Pyrus_PackageFile_v2_Compatible($this, $this->info[$i], $i);
    }

    function offsetSet($var, $value)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Compatible_Exception('Use -> operator to access compatible package properties');
        }
        if (!($value instanceof self)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Compatible_Exception('Can only set $pf->compatible[\'' .
                $var . '\'] to PEAR2_Pyrus_PackageFile_v2_Compatible object');
        }
        if ($var === null) {
            $var = $value->channel . '/' . $value->name;
        }
        if (!strpos($var, '/')) {
            throw new PEAR2_Pyrus_PackageFile_v2_Compatible_Exception('Cannot set "' . $var .
                '", must use "channel/package" to specify a compatible package to set');
        }
        $stuff = explode('/', $var);
        $name = array_pop($stuff);
        $channel = implode('/', $stuff);
        if ($value->name != $name || $value->channel != $channel) {
            throw new PEAR2_Pyrus_PackageFile_v2_Compatible_Exception('Cannot set ' .
                $channel . '/' . $name . ' to ' .
                $value->channel . '/' . $value->name .
                ', use $pf->compatible[] to set a new value');
        }
        if (false === ($i = $this->locateCompatible($var))) {
            $i = count($this->info);
        }
        $this->info[$i] = $value->getInfo();
        $this->save();
    }

    function offsetExists($var)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Compatible_Exception('Use -> operator to access compatible package properties');
        }
        $i = $this->locateCompatible($var);
        return $i !== false;
    }

    function offsetUnset($var)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Compatible_Exception('Use -> operator to access compatible package properties');
        }
        $i = $this->locateCompatible($var);
        if ($i === false) {
            return;
        }
        unset($this->info[$i]);
        $this->info = array_values($this->info);
        $this->save();
    }

    function __isset($var)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Compatible_Exception('Use [] operator to access compatible packages');
        }
        if (!isset($this->info[$var])) {
            return null;
        }
        return isset($this->info[$var]);
    }

    function __get($var)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Compatible_Exception('Use [] operator to access compatible packages');
        }
        if (!isset($this->info[$var])) {
            return null;
        }
        if ($var === 'exclude') {
            $ret = $this->info['exclude'];
            if (!is_array($ret)) {
                return array($ret);
            }
        }
        return $this->info[$var];
    }

    function __set($var, $value)
    {
        return $this->__call($var, array($value));
    }

    function __call($var, $args)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Compatible_Exception('Use [] operator to access compatible packages');
        }
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Compatible_Exception(
                'Unknown variable ' . $var . ', should be one of ' . implode(', ', array_keys($this->info))
            );
        }
        if ($var === 'name' || $var === 'channel') {
            throw new PEAR2_Pyrus_PackageFile_v2_Compatible_Exception(
                'Cannot change compatible package name, use unset() to remove the old compatible package'
            );
        }
        if (!count($args) || $args[0] === null) {
            unset($this->info[$var]);
            $this->save();
            return $this;
        }
        if ($var == 'exclude') {
            if (!isset($this->info[$var])) {
                $this->info[$var] = $args;
            } else {
                $this->info[$var] = array_merge($this->info[$var], $args);
            }
        } else {
            $this->info[$var] = $args[0];
        }
        $this->save();
        return $this;
    }

    function getInfo()
    {
        return $this->info;
    }

    function setInfo($index, $info)
    {
        foreach ($info as $key => $null) {
            if ($null === null) {
                unset($info[$key]);
            }
        }
        $this->info[$index] = $info;
    }

    function save()
    {
        if ($this->parent instanceof self) {
            $this->parent->setInfo($this->index, $this->info);
            $this->parent->save();
        } else {
            $info = $this->info;
            if (count($info) == 1) {
                $info = $info[0];
            }
            $this->parent->rawcompatible = $info;
        }
    }
}
?><?php
/**
 * PEAR2_Pyrus_PackageFile_v2_Files_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for file exceptions in a package file.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_Configureoption_Exception extends PEAR2_Exception {}<?php
class PEAR2_Pyrus_PackageFile_v2_Configureoption implements ArrayAccess, Iterator, Countable
{
    protected $parent;
    protected $info;
    protected $index;
    function __construct($parent, array $info, $index = null)
    {
        $this->parent = $parent;
        $this->info = $info;
        $this->index = $index;
    }

    function current()
    {
        $info = current($this->info);
        foreach (array('name', 'default', 'prompt') as $key) {
            if (!array_key_exists($key, $info)) {
                $info[$key] = null;
            }
        }
        return new PEAR2_Pyrus_PackageFile_v2_Configureoption($this, $info, key($this->info));
    }

    function count()
    {
        return count($this->info);
    }

    function rewind()
    {
        reset($this->info);
    }

    function key()
    {
        $info = current($this->info);
        return $info['name'];
    }

    function next()
    {
        return next($this->info);
    }

    function valid()
    {
        return current($this->info);
    }

    function locateConfigureOption($name)
    {
        foreach ($this->info as $i => $dep)
        {
            if (isset($dep['name']) && $dep['name'] == $name) {
                return $i;
            }
        }
        return false;
    }

    function offsetGet($var)
    {
        if ($this->index !== null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Configureoption_Exception(
                'use -> operator to access properties of a configureoption');
        }
        $i = $this->locateConfigureOption($var);
        if (false === $i) {
            $i = count($this->info);
            $info = array('name' => $var, 'default' => null, 'prompt' => null);
        } else {
            $info = $this->info[$i];
            foreach (array('name', 'default', 'prompt') as $key) {
                if (!array_key_exists($key, $this->info[$i])) {
                    $info[$key] = null;
                }
            }
        }
        return new PEAR2_Pyrus_PackageFile_v2_Configureoption($this, $info, $i);
    }

    function offsetSet($var, $value)
    {
        if ($this->index !== null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Configureoption_Exception(
                'use -> operator to access properties of a configureoption');
        }
        if (!($value instanceof PEAR2_Pyrus_PackageFile_v2_Configureoption)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Configureoption_Exception(
                'Can only set configureoption to a PEAR2_Pyrus_PackageFile_v2_Configureoption object');
        }
        $i = $this->locateConfigureOption($var);
        if (false === $i) {
            $i = count($this->info);
        }
        $this->info[$i] = array('name' => $var,
                                'default' => $value->default,
                                'prompt' => $value->prompt);
        $this->save();
    }

    function offsetExists($var)
    {
        if ($this->index !== null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Configureoption_Exception(
                'use -> operator to access properties of a configureoption');
        }
        $i = $this->locateConfigureOption($var);
        return $i !== false;
    }

    function offsetUnset($var)
    {
        if ($this->index !== null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Configureoption_Exception(
                'use -> operator to access properties of a configureoption');
        }
        $i = $this->locateConfigureOption($var);
        if ($i === false) {
            return;
        }
        unset($this->info[$i]);
        $this->info = array_values($this->info);
        $this->save();
    }

    function __unset($var)
    {
        if ($this->index === null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Configureoption_Exception(
                'use [] operator to access configureoption' . 's');
        }
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Configureoption_Exception(
                'Unknown variable ' . $var . ' requested, should be one of ' .
                implode(', ', array_keys($this->info))
            );
        }
        $this->info[$var] = null;
        $this->save();
    }

    function __isset($var)
    {
        if ($this->index === null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Configureoption_Exception(
                'use [] operator to access configureoption' . 's');
        }
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Configureoption_Exception(
                'Unknown variable ' . $var . ' requested, should be one of ' .
                implode(', ', array_keys($this->info))
            );
        }
        return isset($this->info[$var]);
    }

    function __set($var, $value)
    {
        return $this->__call($var, array($value));
    }

    function __call($var, $args)
    {
        if ($this->index === null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Configureoption_Exception(
                'use [] operator to access configureoptions');
        }
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Configureoption_Exception('Unknown variable ' . $var .
                                                                           ', must be one of ' .
                            implode(', ', array_keys($this->info)));
        }
        if ($args[0] === null) {
            $this->info[$var] = null;
            $this->save();
            return $this;
        }
        $this->info[$var] = $args[0];
        $this->save();
        return $this;
    }

    function __get($var)
    {
        if ($this->index === null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Configureoption_Exception(
                'use [] operator to access configureoptions');
        }
        if ($var === 'type') {
            return 'configureoption';
        }
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Configureoption_Exception('Unknown variable ' . $var .
                                                                           ', must be one of ' .
                            implode(', ', array_keys($this->info)));
        }
        if (!isset($this->info[$var])) {
            return null;
        }
        return $this->info[$var];
    }

    function getInfo()
    {
        return $this->info;
    }

    function setInfo($info, $index)
    {
        foreach (array_keys($info) as $key) {
            if ($info[$key] === null) {
                unset($info[$key]);
            }
        }
        $this->info[$index] = $info;
    }

    function save()
    {
        if ($this->parent instanceof self) {
            $this->parent->setInfo($this->info, $this->index);
            $this->parent->save();
            return;
        }
        $info = $this->info;
        if (count($info) == 1) {
            $info = $info[0];
        }
        $this->parent->rawconfigureoption = $info;
    }
}
?><?php
/**
 * PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for compatiblility exceptions in a package file.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_UsesRoleTask_Exception extends PEAR2_Exception {}<?php
class PEAR2_Pyrus_PackageFile_v2_Dependencies_Group implements Iterator
{
    protected $parent;
    protected $info = array();
    protected $index = null;

    function __construct($parent, $info, $index = null)
    {
        $this->parent = $parent;
        $this->info = $info;
        $this->index = $index;
    }

    function locateGroup($name)
    {
        if (count($this->info) && !isset($this->info[0])) {
            $this->info = array($this->info);
        }
        foreach ($this->info as $i => $group)
        {
            if (isset($group['attribs']) && isset($group['attribs']['name']) && $group['attribs']['name'] == $name) {
                return $i;
            }
        }
        return false;
    }

    function current()
    {
        $i = key($this->info);
        return new PEAR2_Pyrus_PackageFile_v2_Dependencies_Group($this, $this->info[$i], $i);
    }

    function rewind()
    {
        if (count($this->info) && !isset($this->info[0])) {
            $this->info = array($this->info);
        }
        reset($this->info);
    }

    function key()
    {
        $i = key($this->info);
        return $this->info[$i]['attribs']['name'];
    }

    function next()
    {
        return next($this->info);
    }

    function valid()
    {
        return current($this->info);
    }

    function __get($group)
    {
        if (isset($this->index)) {
            if ($group == 'hint') {
                if (!isset($this->info['attribs']['hint'])) {
                    return null;
                }
                return $this->info['attribs']['hint'];
            }
            if ($group == 'name') {
                if (!isset($this->info['attribs']['name'])) {
                    return null;
                }
                return $this->info['attribs']['name'];
            }
            $var = $group;
            if (!isset($this->info[$var])) {
                switch ($var) {
                    case 'package' :
                    case 'subpackage' :
                    case 'extension' :
                        $this->info[$var] = array();
                        break;
                    default :
                        throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception(
                                        'Only package, subpackage, and ' .
                                        'extension dependencies are supported in dependency groups, asked for ' .
                                        $var);
                }
            } else {
                switch ($var) {
                    case 'package' :
                    case 'subpackage' :
                    case 'extension' :
                        if (count($this->info[$var]) && !isset($this->info[$var][0])) {
                            $this->info[$var] = array($this->info[$var]);
                        }
                        break;
                }
            }
            return new PEAR2_Pyrus_PackageFile_v2_Dependencies_Package('group', $var, $this, $this->info[$var]);
        }
        $i = $this->locateGroup($group);
        if (false === $i) {
            $i = count($this->info);
            $this->info[] = array('attribs' => array('hint' => null, 'name' => $group));
        }
        return new PEAR2_Pyrus_PackageFile_v2_Dependencies_Group($this, $this->info[$i], $i);
    }

    function __set($group, $value)
    {
        if (isset($this->index)) {
            if ($group == 'hint') {
                if ($value === null) {
                    if (!isset($this->info['attribs']) || !isset($this->info['attribs']['hint'])) {
                        return;
                    }
                    unset($this->info['attribs']['hint']);
                    $this->save();
                    return;
                }
                if (!is_string($value)) {
                    throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('hint must be a string, was ' . gettype($value));
                }
                if (!isset($this->info['attribs'])) {
                    $this->info['attribs'] = array();
                }
                $this->info['attribs']['hint'] = $value;
                $this->save();
                return;
            }
            $info = array();
            switch ($group) {
                case 'package' :
                case 'subpackage' :
                case 'extension' :
                    if ($value === null) {
                        unset($this->info[$group]);
                        $this->save();
                        return;
                    }
                    if (!($value instanceof PEAR2_Pyrus_PackageFile_v2_Dependencies_Package)) {
                        throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception(
                            'Can only set ' . $group . ' to PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object'
                        );
                    }
                    $this->info[$group] = $value->getInfo();
                    $this->save();
                    break;
                default :
                    throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception(
                                    'Only package, subpackage, and ' .
                                    'extension dependencies are supported in dependency groups, asked for ' .
                                    $group);
            }
        }
    }

    function __isset($group)
    {
        if (isset($this->index)) {
            if ($group == 'hint') {
                return isset($this->info['attribs']['hint']);
            }
            return isset($this->info[$group]) && !empty($this->info[$group]);
        }
        return false !== $this->locateGroup($group);
    }

    function __unset($group)
    {
        if (isset($this->index)) {
            if ($group == 'hint') {
                $this->info['attribs']['hint'] = null;
                $this->save();
                return;
            }
            unset($this->info[$group]);
            $this->save();
            return;
        }
        $i = $this->locateGroup($group);
        if ($i !== false) {
            unset($this->info[$i]);
            $this->save();
        }
    }

    function getInfo()
    {
        return $this->info;
    }

    function setInfo($index, $info)
    {
        $this->info[$index] = $info;
    }

    function save()
    {
        if ($this->parent instanceof self) {
            $this->parent->setInfo($this->index, $this->info);
        } else {
            $info = $this->info;
            if (count($info) == 1) {
                $info = $info[0];
            }
            $this->parent->setInfo('group', $info);
        }
        $this->parent->save();
    }
}
?><?php
/**
 * PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for dependency exceptions in a package file.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception extends PEAR2_Exception {}<?php
/**
 * This class is used for package, subpackage, and extension deps
 */
class PEAR2_Pyrus_PackageFile_v2_Dependencies_Package implements ArrayAccess, Iterator
{
    protected $info;
    protected $index = null;
    protected $parent;
    protected $type;
    protected $deptype;

    function __construct($deptype, $type, $parent, array $info, $index = null)
    {
        $this->parent = $parent;
        $this->info = $info;
        $this->index = $index;
        $this->type = $type;
        $this->deptype = $deptype;
    }

    function current()
    {
        $i = key($this->info);
        switch ($this->type) {
            case 'package' :
            case 'subpackage' :
                $keys = array('name' => null, 'channel' => null, 'uri' => null,
                                            'min' => null, 'max' => null,
                                            'recommended' => null, 'exclude' => null,
                                            'providesextension' => null, 'conflicts' => null);
                if ($this->deptype != 'required') {
                    unset($keys['conflicts']);
                }
                break;
            case 'extension' :
                $keys = array('name' => null, 'min' => null, 'max' => null,
                                            'recommended' => null, 'exclude' => null, 'conflicts' => null);
                if ($this->deptype != 'required') {
                    unset($keys['conflicts']);
                }
                break;
        }
        foreach ($keys as $key => $null) {
            if (!array_key_exists($key, $this->info[$i])) {
                $this->info[$i][$key] = null;
            }
        }
        return new PEAR2_Pyrus_PackageFile_v2_Dependencies_Package($this->deptype, $this->type, $this, $this->info[$i], $i);
    }

    function rewind()
    {
        reset($this->info);
    }

    function key()
    {
        $i = key($this->info);
        if ($this->type == 'extension') {
            return $this->info[$i]['name'];
        }
        $channel = isset($this->info[$i]['channel']) ? $this->info[$i]['channel'] : '__uri';
        return $channel . '/' . $this->info[$i]['name'];
    }

    function next()
    {
        return next($this->info);
    }

    function valid()
    {
        return current($this->info);
    }

    function locateDep($name)
    {
        if ($this->type == 'extension') {
            foreach ($this->info as $i => $dep)
            {
                if (isset($dep['name']) && $dep['name'] == $name) {
                    return $i;
                }
            }
            return false;
        }
        $stuff = explode('/', $name);
        $name = array_pop($stuff);
        $channel = implode('/', $stuff);
        foreach ($this->info as $i => $dep)
        {
            if ($channel == '__uri') {
                if (isset($dep['name']) && $dep['name'] == $name && isset($dep['uri'])) {
                    return $i;
                }
                continue;
            }
            if (isset($dep['name']) && $dep['name'] == $name
                && isset($dep['channel']) && $dep['channel'] == $channel) {
                return $i;
            }
        }
        return false;
    }

    function offsetGet($var)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Use -> operator to access dependency properties');
        }
        $i = $this->locateDep($var);
        if (false === $i) {
            $i = count($this->info);
            switch ($this->type) {
                case 'package' :
                case 'subpackage' :
                    if (!strpos($var, '/')) {
                        throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Cannot access "' . $var .
                            '", must use "channel/package" to specify a package dependency to access');
                    }
                    $stuff = explode('/', $var);
                    $name = array_pop($stuff);
                    $channel = implode('/', $stuff);
                    if ($channel === '__uri') {
                        // use fake uri, user must set it
                        $this->info[$i] = array('name' => $name, 'channel' => null, 'uri' => '__uri',
                                                    'min' => null, 'max' => null,
                                                    'recommended' => null, 'exclude' => null,
                                                    'providesextension' => null, 'conflicts' => null);
                    } else {
                        $this->info[$i] = array('name' => $name, 'channel' => $channel, 'uri' => null,
                                                    'min' => null, 'max' => null,
                                                    'recommended' => null, 'exclude' => null,
                                                    'providesextension' => null, 'conflicts' => null);
                    }
                    if ($this->deptype != 'required') {
                        unset($this->info[$i]['conflicts']);
                    }
                    break;
                case 'extension' :
                    $this->info[$i] = array('name' => $var, 'min' => null, 'max' => null,
                                                'recommended' => null, 'exclude' => null, 'conflicts' => null);
                    if ($this->deptype != 'required') {
                        unset($this->info[$i]['conflicts']);
                    }
                    break;
            }
        } else {
            switch ($this->type) {
                case 'package' :
                case 'subpackage' :
                    $keys = array('name' => $var, 'channel' => null, 'uri' => null,
                                                'min' => null, 'max' => null,
                                                'recommended' => null, 'exclude' => null,
                                                'providesextension' => null, 'conflicts' => null);
                    if ($this->deptype != 'required') {
                        unset($keys['conflicts']);
                    }
                    break;
                case 'extension' :
                    $keys = array('name' => $var, 'min' => null, 'max' => null,
                                                'recommended' => null, 'exclude' => null, 'conflicts' => null);
                    if ($this->deptype != 'required') {
                        unset($keys['conflicts']);
                    }
                    break;
            }
            foreach ($keys as $key => $null) {
                if (!array_key_exists($key, $this->info[$i])) {
                    $this->info[$i][$key] = null;
                }
            }
        }
        return new PEAR2_Pyrus_PackageFile_v2_Dependencies_Package($this->deptype, $this->type, $this, $this->info[$i], $i);
    }

    function offsetSet($var, $value)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Use -> operator to access dependency properties');
        }
        if (!($value instanceof self)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Can only set $pf->dependencies[\'' .
                $this->deptype . '\']->' . $this->type . '[\'' . $var .
                '\'] to PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object');
        }
        if ($this->type !== $value->type) {
            if (!(($this->type === 'package' && $value->type === 'subpackage') ||
                ($this->type === 'subpackage' && $value->type === 'package'))) {
                throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Cannot set ' . $this->type .
                    ' dependency to ' . $value->type . ' dependency');
            }
        }
        if ($var === null) {
            if ($this->type === 'extension') {
                $var = $value->name;
            } else {
                $var = $value->channel . '/' . $value->name;
            }
        }
        if ($this->type !== 'extension' && !strpos($var, '/')) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Cannot set "' . $var .
                '", must use "channel/package" to specify a package dependency to set');
        }
        if ($this->type === 'extension') {
            if ($value->name != $var) {
                throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Cannot set ' .
                    $var . ' to ' .
                    $value->name .
                    ', use $pf->dependencies[\'' .
                    $this->deptype . '\']->extension[] to set a new value');
            }
        } else {
            $stuff = explode('/', $var);
            $name = array_pop($stuff);
            $channel = implode('/', $stuff);
            if ($value->name != $name || $value->channel != $channel) {
                throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Cannot set ' .
                    $channel . '/' . $name . ' to ' .
                    $value->channel . '/' . $value->name .
                    ', use $pf->dependencies[\'' .
                    $this->deptype . '\']->' . $this->type . '[] to set a new value');
            }
        }
        if (false === ($i = $this->locateDep($var))) {
            $i = count($this->info);
        }
        $this->info[$i] = $value->getInfo();
        $this->save();
    }

    function offsetExists($var)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Use -> operator to access dependency properties');
        }
        $i = $this->locateDep($var);
        return $i !== false;
    }

    function offsetUnset($var)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Use -> operator to access dependency properties');
        }
        $i = $this->locateDep($var);
        if ($i === false) {
            return;
        }
        unset($this->info[$i]);
        $this->info = array_values($this->info);
        $this->save();
    }

    function __get($var)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Use [] operator to access ' . $this->type .
                                                                        's');
        }
        if ($var == 'conflicts') {
            return isset($this->info[$var]);
        }
        if ($var === 'deptype') {
            return $this->deptype;
        }
        if ($var === 'type') {
            return $this->type;
        }
        if ($var === 'channel' && isset($this->info['uri'])) {
            return '__uri';
        }
        if (!isset($this->info[$var])) {
            return null;
        }
        if ($var === 'exclude') {
            $ret = $this->info['exclude'];
            if (!is_array($ret)) {
                return array($ret);
            }
        }
        return $this->info[$var];
    }

    function __isset($var)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Use [] operator to access ' . $this->type .
                                                                        's');
        }
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception(
                'Unknown variable ' . $var . ', should be one of ' . implode(', ', array_keys($this->info))
            );
        }
        return isset($this->info[$var]);
    }

    function __unset($var)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Use [] operator to access ' . $this->type .
                                                                        's');
        }
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception(
                'Unknown variable ' . $var . ', should be one of ' . implode(', ', array_keys($this->info))
            );
        }
        $this->info[$var] = null;
    }

    function __set($var, $value)
    {
        return $this->__call($var, array($value));
    }

    function __call($var, $args)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Use [] operator to access ' . $this->type .
                                                                        's');
        }
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception(
                'Unknown variable ' . $var . ', should be one of ' . implode(', ', array_keys($this->info))
            );
        }
        if (count($args) && $args[0] !== null && $var === 'channel' && isset($this->info['uri'])) {
            $this->info['uri'] = null;
            $this->info['channel'] = $args[0];
            $this->save();
            return;
        }
        if (count($args) && $args[0] !== null && $var === 'uri' && isset($this->info['channel'])) {
            $this->info['channel'] = null;
            $this->info['uri'] = $args[0];
            $this->save();
            return;
        }
        if ($var === 'name' || $var === 'channel') {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception(
                'Cannot change dependency name, use unset() to remove the old dependency'
            );
        }
        if ($var == 'conflicts') {
            if (count($args)) {
                if ($args[0]) {
                    $this->info['conflicts'] = '';
                } else {
                    $this->info['conflicts'] = null;
                }
            } else {
                $this->info['conflicts'] = '';
            }
            $this->save();
            return $this;
        }
        if (!count($args) || $args[0] === null) {
            $this->info[$var] = null;
            $this->save();
            return $this;
        }
        if ($var == 'exclude') {
            if (!isset($this->info[$var])) {
                $this->info[$var] = $args;
            } else {
                if (!is_array($this->info[$var])) {
                    $this->info[$var] = array($this->info[$var]);
                }
                $this->info[$var] = array_merge($this->info[$var], $args);
            }
        } else {
            $this->info[$var] = $args[0];
        }
        $this->save();
        return $this;
    }

    function getInfo()
    {
        return $this->info;
    }

    function setInfo($index, $info)
    {
        foreach ($info as $key => $null) {
            if ($null === null) {
                unset($info[$key]);
                continue;
            }
            if (is_array($null) && count($null) == 1) {
                $info[$key] = $null[0];
            }
        }
        $this->info[$index] = $info;
    }

    function save()
    {
        if ($this->parent instanceof self) {
            $this->parent->setInfo($this->index, $this->info);
        } else {
            $info = $this->info;
            if (count($info) == 1) {
                $info = $info[0];
            }
            $this->parent->setInfo($this->type, $info);
        }
        $this->parent->save();
    }
}
?><?php
class PEAR2_Pyrus_PackageFile_v2_Dependencies_Dep implements ArrayAccess, Iterator
{
    protected $parent;
    protected $info;
    protected $type;
    function __construct($parent, array $info, $type)
    {
        $this->parent = $parent;
        $this->info = $info;
        $this->type = $type;
    }

    function current()
    {
        return new self($this, current($this->info), $this->type);
    }

    function rewind()
    {
        if (count($this->info) && !isset($this->info[0])) {
            $this->info = array($this->info);
        }
        reset($this->info);
    }

    function key()
    {
        return key($this->info);
    }

    function next()
    {
        return next($this->info);
    }

    function valid()
    {
        return current($this->info);
    }

    function __call($var, $args)
    {
        if (!array_key_exists($var, $this->info)) {
            if ($this->type == 'os') {
                if ($var == 'name' || $var == 'conflicts') {
                    goto set_ok;
                }
                $keys = array('name', 'conflicts');
            } elseif ($this->type == 'arch') {
                if ($var == 'pattern' || $var == 'conflicts') {
                    goto set_ok;
                }
                $keys = array('pattern', 'conflicts');
            } else {
                $keys = array_keys($this->info);
            }
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Unknown variable ' . $var . ', must be one of ' .
                            implode(', ', $keys));
        }
set_ok:
        if ($args[0] === null) {
            $this->info[$var] = null;
            $this->save();
            return $this;
        }
        if ($var == 'exclude') {
            if (!isset($this->info[$var])) {
                $this->info[$var] = $args;
            } else {
                if (!is_array($this->info[$var])) {
                    $this->info[$var] = array($this->info[$var]);
                }
                $this->info[$var] = array_merge($this->info[$var], $args);
            }
        } elseif ($var == 'conflicts') {
            if ($args[0]) {
                $this->info[$var] = '';
            } else {
                $this->info[$var] = null;
            }
        } else {
            $this->info[$var] = $args[0];
        }
        $this->save();
        return $this;
    }

    function __get($var)
    {
        if (!isset($this->info[$var])) {
            return null;
        }
        if ($var == 'exclude') {
            $ret = $this->info['exclude'];
            if (!is_array($ret)) {
                return array($ret);
            }
        } elseif ($var == 'conflicts') {
            if (isset($this->info['conflicts'])) {
                return true;
            }
            return false;
        }
        return $this->info[$var];
    }

    function __set($var, $value)
    {
        $this->__call($var, array($value));
    }

    function __isset($var)
    {
        return isset($this->info[$var]);
    }

    function locateDep($name)
    {
        if (count($this->info) && !isset($this->info[0])) {
            $this->info = array($this->info);
        }
        foreach ($this->info as $i => $dep)
        {
            $pattern = ($this->type == 'os') ? 'name' : 'pattern';
            if (isset($dep[$pattern]) && $dep[$pattern] == $name) {
                return $i;
            }
        }
        return false;
    }

    function offsetGet($var)
    {
        $i = $this->locateDep($var);
        if (false === $i) {
            return null;
        }
        return !isset($this->info[$i]['conflicts']);
    }

    function offsetSet($var, $value)
    {
        $i = $this->locateDep($var);
        if (false === $i) {
            $i = count($this->info);
            $pattern = ($this->type == 'os') ? 'name' : 'pattern';
            $this->info[] = array($pattern => $var);
        }
        if ($value) {
            if (isset($this->info[$i]['conflicts'])) {
                unset($this->info[$i]['conflicts']);
            }
        } else {
            $this->info[$i]['conflicts'] = '';
        }
        $this->save();
    }

    function offsetExists($var)
    {
        return false !== $this->locateDep($var);
    }

    function offsetUnset($var)
    {
        $i = $this->locateDep($var);
        if ($i === false) {
            return;
        }
        unset($this->info[$i]);
        $this->info = array_values($this->info);
        $this->save();
    }

    function getInfo()
    {
        return $this->info;
    }

    function save()
    {
        $info = $this->info;
        if ($this->type === 'php' || $this->type === 'pearinstaller') {
            foreach ($info as $key => $val) {
                if ($key === 'exclude' && is_array($val) && count($val) == 1) {
                    $info[$key] = $val[0];
                }
            }
        } else {
            if (is_array($info) && count($info) == 1 && isset($info[0])) {
                $info = $info[0];
            }
        }
        $this->parent->setInfo($this->type, $info);
        $this->parent->save();
        return $this;
    }
}
?><?php
/**
 * PEAR2_Pyrus_PackageFile_v2_Files_File
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Class for manipulating a filelist's file contents
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_Files_File extends ArrayObject
{
    protected $pkg;
    protected $parent;
    protected $tasksNs;

    function __construct(PEAR2_Pyrus_PackageFile_v2_Files $parent, PEAR2_Pyrus_PackageFile_v2 $ultraparent, array $info)
    {
        $this->parent = $parent;
        $this->pkg = $ultraparent;
        $this->tasksNs = $ultraparent->getTasksNs() . ':';
        parent::__construct($info);
    }

    function __get($var)
    {
        $task = str_replace('-', ' ', $var);
        $task = str_replace(' ', '/', ucwords($task));
        $task = str_replace('/', '_', $task);
        $c = 'PEAR2_Pyrus_Task_' . $task;
        if (isset($this[$this->tasksNs . $var])) {
            $inf = $this[$this->tasksNs . $var];
            if (isset($inf[0])) {
                $ret = array();
                foreach ($inf as $info) {
                    $ret[] = new $c($this->pkg, PEAR2_Pyrus_Validate::NORMAL, $info, $this['attribs'], null);
                }
                goto return_multi;
            } else {
                $c = 'PEAR2_Pyrus_Task_' . str_replace('-', '_', $var);
                $ret = array(new $c($this->pkg, PEAR2_Pyrus_Validate::NORMAL, $inf, $this['attribs'], null));
                goto return_multi;
            }
        }
        $ret = array();
return_multi:
        return new PEAR2_Pyrus_Task_MultipleProxy($this->pkg, $ret, $this['attribs'], $var);
    }

    function __set($var, $value)
    {
        if (!($value instanceof PEAR2_Pyrus_Task_Common) && !($value instanceof PEAR2_Pyrus_Task_MultipleProxy)) {
            throw new PEAR2_Pyrus_PackageFile_Exception('Can only change tasks via __set() to an instance ' .
                                                        'of PEAR2_Pyrus_Task_Common');
        }
        $this[$this->tasksNs . $var] = $value->getInfo();
        $this->pkg->setFilelistFile($this['attribs']['name'], $this->getArrayCopy());
    }
}<?php
/**
 * PEAR2_Pyrus_PackageFile_v2_Files_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for file exceptions in a package file.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_Files_Exception extends PEAR2_Exception {}<?php
/**
 * PEAR2_Pyrus_PackageFile_v2_License
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Represents the files within a package file
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_License implements ArrayAccess
{
    protected $parent;
    protected $info;

    function __construct($parent, $info)
    {
        $this->parent = $parent;
        $this->info = $info;
    }

    function getInfo()
    {
        return $this->info;
    }

    function offsetUnset($var)
    {
        if ($var == 'name') {
            if (is_array($this->info) && isset($this->info['_content'])) {
                unset($this->info['_content']);
            } elseif (is_string($this->info)) {
                $this->info = array();
            }
            $this->save();
            return;
        }
        if ($var == 'uri') {
            unset($this->info['attribs']['uri']);
            if (!count($this->info['attribs'])) {
                unset($this->info['attribs']);
                if (isset($this->info['_content'])) {
                    $this->info = $this->info['_content'];
                }
            }
            $this->save();
            return;
        }
        if ($var == 'path') {
            unset($this->info['attribs']['path']);
            if (!count($this->info['attribs'])) {
                unset($this->info['attribs']);
                if (isset($this->info['_content'])) {
                    $this->info = $this->info['_content'];
                }
            }
            $this->save();
            return;
        }
    }

    function offsetGet($var)
    {
        if ($var == 'uri') {
            if (is_array($this->info) && isset($this->info['attribs']) && isset($this->info['attribs']['uri'])) {
                return $this->info['attribs']['uri'];
            }
            return null;
        }
        if ($var == 'path') {
            if (is_array($this->info) && isset($this->info['attribs']) && isset($this->info['attribs']['path'])) {
                return $this->info['attribs']['path'];
            }
            return null;
        }
        if ($var == 'name') {
            if (is_array($this->info) && isset($this->info['_content'])) {
                return $this->info['_content']; 
            }
            if (!is_array($this->info)) {
                return $this->info;
            }
        }
        return null;
    }

    function offsetSet($var, $value)
    {
        if (!is_string($value)) {
            throw new PEAR2_Pyrus_PackageFile_v2_License_Exception('Can only set license to string');
        }

        if ($var == 'path' || $var == 'uri') {
            if (!is_array($this->info) || !isset($this->info['attribs'])) {
                if (!is_array($this->info)) {
                    $this->info = array('_content' => $this->info);
                }
                $this->info['attribs'] = array();
            }
        } else {
            if ($var == 'name') {
                if (!is_array($this->info)) {
                    $this->info = $value;
                    $this->save();
                    return;
                }
                $this->info['_content'] = $value;
                $this->save();
                return;
            }
            throw new PEAR2_Pyrus_PackageFile_v2_License_Exception('Unknown license trait ' . $var . ', cannot set value');
        }
        $this->info['attribs'][$var] = $value;
        $this->save();
    }

    function offsetExists($var)
    {
        if ($var == 'uri') {
            return isset($this->info['attribs']) && isset($this->info['attribs']['uri']);
        }
        if ($var == 'path') {
            return isset($this->info['attribs']) && isset($this->info['attribs']['path']);
        }
        if ($var == 'name') {
            if (!is_array($this->info)) {
                return sizeof($this->info);
            }
            return isset($this->info['_content']);
        }
        return false;
    }

    function save()
    {
        $this->parent->rawlicense = $this->info;
    }
}<?php
class PEAR2_Pyrus_PackageFile_v2_Release_ConfigureOption implements ArrayAccess, Iterator, Countable
{
    protected $parent;
    protected $info;
    protected $index;
    function __construct($parent, array $info, $index = null)
    {
        $this->parent = $parent;
        $this->info = $info;
        $this->index = $index;
    }

    function current()
    {
        $info = current($this->info);
        foreach (array('name', 'default', 'prompt') as $key) {
            if (!array_key_exists($key, $info)) {
                $info[$key] = null;
            }
        }
        return new PEAR2_Pyrus_PackageFile_v2_Release_ConfigureOption($this, $info, key($this->info));
    }

    function count()
    {
        return count($this->info);
    }

    function rewind()
    {
        reset($this->info);
    }

    function key()
    {
        $info = current($this->info);
        return $info['name'];
    }

    function next()
    {
        return next($this->info);
    }

    function valid()
    {
        return current($this->info);
    }

    function locateConfigureOption($name)
    {
        foreach ($this->info as $i => $dep)
        {
            if (isset($dep['name']) && $dep['name'] == $name) {
                return $i;
            }
        }
        return false;
    }

    function offsetGet($var)
    {
        if ($this->index !== null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception(
                'use -> operator to access properties of a configureoption');
        }
        $i = $this->locateConfigureOption($var);
        if (false === $i) {
            $i = count($this->info);
            $info = array('name' => $var, 'default' => null, 'prompt' => null);
        } else {
            $info = $this->info[$i];
            foreach (array('name', 'default', 'prompt') as $key) {
                if (!array_key_exists($key, $this->info[$i])) {
                    $info[$key] = null;
                }
            }
        }
        return new PEAR2_Pyrus_PackageFile_v2_Release_ConfigureOption($this, $info, $i);
    }

    function offsetSet($var, $value)
    {
        if ($this->index !== null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception(
                'use -> operator to access properties of a configureoption');
        }
        if (!($value instanceof PEAR2_Pyrus_PackageFile_v2_Release_ConfigureOption)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception(
                'Can only set configureoption to a PEAR2_Pyrus_PackageFile_v2_Release_ConfigureOption object');
        }
        if ($var !== null && $var !== $value->name) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception(
                'use [] or [\'' . $value->name . '\'] to set this configureoption');
        }
        $i = $this->locateConfigureOption($var);
        if (false === $i) {
            $i = count($this->info);
        }
        $this->info[$i] = array('name' => $value->name,
                                'default' => $value->default,
                                'prompt' => $value->prompt);
        $this->save();
    }

    function offsetExists($var)
    {
        if ($this->index !== null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception(
                'use -> operator to access properties of a configureoption');
        }
        $i = $this->locateConfigureOption($var);
        return $i !== false;
    }

    function offsetUnset($var)
    {
        if ($this->index !== null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception(
                'use -> operator to access properties of a configureoption');
        }
        $i = $this->locateConfigureOption($var);
        if ($i === false) {
            return;
        }
        unset($this->info[$i]);
        $this->info = array_values($this->info);
        $this->save();
    }

    function __unset($var)
    {
        if ($this->index === null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception(
                'use [] operator to access configureoptions');
        }
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception(
                'Unknown variable ' . $var . ', must be one of ' .
                implode(', ', array_keys($this->info))
            );
        }
        $this->info[$var] = null;
        $this->save();
    }

    function __isset($var)
    {
        if ($this->index === null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception(
                'use [] operator to access configureoptions');
        }
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception(
                'Unknown variable ' . $var . ', must be one of ' .
                implode(', ', array_keys($this->info))
            );
        }
        return isset($this->info[$var]);
    }

    function __set($var, $value)
    {
        return $this->__call($var, array($value));
    }

    function __call($var, $args)
    {
        if ($this->index === null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception(
                'use [] operator to access configureoptions');
        }
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Unknown variable ' . $var . ', must be one of ' .
                            implode(', ', array_keys($this->info)));
        }
        if ($args[0] === null) {
            $this->info[$var] = null;
            $this->save();
            return $this;
        }
        $this->info[$var] = $args[0];
        $this->save();
        return $this;
    }

    function __get($var)
    {
        if ($this->index === null) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception(
                'use [] operator to access configureoptions');
        }
        if (!array_key_exists($var, $this->info)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Unknown variable ' . $var . ', must be one of ' .
                            implode(', ', array_keys($this->info)));
        }
        if (!isset($this->info[$var])) {
            return null;
        }
        return $this->info[$var];
    }

    function getInfo()
    {
        return $this->info;
    }

    function setInfo($info, $index)
    {
        foreach (array_keys($info) as $key) {
            if ($info[$key] === null) {
                unset($info[$key]);
            }
        }
        $this->info[$index] = $info;
    }

    function save()
    {
        if ($this->parent instanceof self) {
            $this->parent->setInfo($this->info, $this->index);
            $this->parent->save();
            return;
        }
        $info = $this->info;
        if (count($info) == 1) {
            $info = $info[0];
        }
        $this->parent->setConfigureOption($info);
        $this->parent->save();
    }
}
?><?php
/**
 * PEAR2_Pyrus_PackageFile_v2_Release_BinaryPackage
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Represents a binarypackage tag in an extsrcrelease or zendextsrcrelease tag
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_Release_BinaryPackage implements ArrayAccess, Iterator, Countable
{
    protected $info;
    protected $parent;

    /**
     * @param array The content of this element.  All allowed indices should be initialized to null
     */
    function __construct($parent, $info)
    {
        $this->parent = $parent;
        $this->info = array_flip(array_values($info));
    }

    function count()
    {
        return count($this->info);
    }

    function current()
    {
        return key($this->info);
    }

    function next()
    {
        return next($this->info);
    }

    function rewind()
    {
        reset($this->info);
    }

    function valid()
    {
        return key($this->info);
    }

    function key()
    {
        return key($this->info);
    }

    function offsetUnset($var)
    {
        unset($this->info[$var]);
        $this->save();
    }

    function offsetGet($var)
    {
        if (!isset($this->info[$var])) {
            return null;
        }
        return $var;
    }

    function offsetSet($var, $value)
    {
        if (!is_string($value)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Can only set binarypackage to string');
        }
        $this->info[$value] = 1;
        $this->save();
    }

    function offsetExists($var)
    {
        return isset($this->info[$var]);
    }

    function getInfo()
    {
        $ret = array_keys($this->info);
        if (count($ret) == 1) {
            return $ret[0];
        }
        return $ret;
    }

    function save()
    {
        $info = array_keys($this->info);
        $this->parent->setBinaryPackage($this->getInfo());
        $this->parent->save();
    }
}<?php
/**
 * PEAR2_Pyrus_PackageFile_v2_Releaseinstallcondition
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Manage a release's installation conditions in package.xml
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_Release_InstallCondition implements ArrayAccess
{
    protected $parent;
    protected $index = null;
    protected $installcondition;
    protected $info = array();
    function __construct($parent, array $info, $condition = null, $index = null)
    {
        $this->parent = $parent;
        $this->info = $info;
        if ($condition !== null) {
            $this->installcondition = $condition;
        }
        if ($index !== null) {
            $this->index = $index;
        }
    }

    function getInfo()
    {
        return $this->info;
    }

    function __get($var)
    {
        if ($var === 'installcondition') {
            return isset($this->installcondition) ? $this->installcondition : false;
        }
        if (isset($this->info[$var])) {
            if ($var === 'conflicts') {
                return $this->info[$var] !== null;
            }
            return $this->info[$var];
        }
        if ($var === 'conflicts') {
            return false;
        }
        return null;
    }

    function __call($var, $args)
    {
        if (!isset($this->installcondition)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Cannot set variables for unknown install condition');
        }
        if (array_key_exists($var, $this->info)) {
            if (!count($args) && $var == 'conflicts') {
                $args = array('');
            }
            $this->info[$var] = $args[0];
            $this->save();
        }
        return $this;
    }

    function offsetGet($var)
    {
        if (isset($this->installcondition) && !isset($this->index) && $this->installcondition == 'extension') {
            if (!is_string($var)) {
                throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Access extension installconditions by name, not number');
            }
            if (false === ($i = $this->locateExtension($var))) {
                $i = count($this->info);
                $this->info[$i] =
                    array('name' => $var, 'min' => null, 'max' => null, 'exclude' => null, 'conflicts' => null);
            } else {
                foreach (array('name' => null, 'min' => null, 'max' => null, 'exclude' => null, 'conflicts' => null) as $key => $val) {
                    if (!array_key_exists($key, $this->info[$i])) {
                        $this->info[$i][$key] = null;
                    }
                }
            }
            return new PEAR2_Pyrus_PackageFile_v2_Release_InstallCondition($this,
                       $this->info[$i], 'extension', $i);
        }
        if (!is_string($var)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Cannot access numeric index');
        }
        $var = strtolower($var);
        switch ($var) {
            case 'php' :
                if (!isset($this->info[$var])) {
                    $this->info[$var] = array('min' => null, 'max' => null, 'exclude' => null);
                } else {
                    foreach (array('min' => null, 'max' => null, 'exclude' => null) as $key => $val) {
                        if (!array_key_exists($key, $this->info[$var])) {
                            $this->info[$var][$key] = null;
                        }
                    }
                }
                break;
            case 'os' :
                if (!isset($this->info[$var])) {
                    $this->info[$var] = array('name' => null, 'conflicts' => null);
                } else {
                    settype($this->info[$var], 'array');
                    foreach (array('name' => null, 'conflicts' => null) as $key => $val) {
                        if (!array_key_exists($key, $this->info[$var])) {
                            $this->info[$var][$key] = null;
                        }
                    }
                }
                break;
            case 'arch' :
                if (!isset($this->info[$var])) {
                    $this->info[$var] = array('pattern' => null, 'conflicts' => null);
                } else {
                    foreach (array('pattern' => null, 'conflicts' => null) as $key => $val) {
                        if (!array_key_exists($key, $this->info[$var])) {
                            $this->info[$var][$key] = null;
                        }
                    }
                }
                break;
            case 'extension' :
                if (!isset($this->info[$var])) {
                    $this->info[$var] = array();
                } else {
                    if (!isset($this->info['extension'][0])) {
                        $this->info['extension'] = array($this->info['extension']);
                    }
                    foreach (array('name' => null, 'min' => null, 'max' => null, 'exclude' => null, 'conflicts' => null) as $key => $val) {
                        foreach ($this->info['extension'] as $index => $ext) {
                            if (!array_key_exists($key, $ext)) {
                                $this->info['extension'][$index][$key] = null;
                            }
                        }
                    }
                }
                break;
            default :
                throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Cannot access unknown install condition ' . $var);
        }
        return new PEAR2_Pyrus_PackageFile_v2_Release_InstallCondition($this, $this->info[$var],
                   $var);
    }

    protected function locateExtension($ext)
    {
        foreach ($this->info as $i => $test) {
            if (!isset($test['name'])) {
                continue;
            }
            if ($test['name'] === $ext) {
                return $i;
            }
        }
        return false;
    }

    function offsetSet($var, $value)
    {
        $info = array();
        if (isset($this->installcondition) && $this->installcondition == 'extension') {
            if (!($value instanceof PEAR2_Pyrus_PackageFile_v2_Release_InstallCondition)) {
                throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Cannot set extension to anything but a' .
                            ' PEAR2_Pyrus_PackageFile_v2_Release_InstallCondition object');
            }
        } else {
            switch ($var) {
                case 'php' :
                    if (is_string($value)) {
                        $info['min'] = $value;
                    }
                    break;
                case 'arch' :
                    if (is_string($value)) {
                        $info['pattern'] = $value;
                    }
                    break;
                case 'os' :
                    if (is_string($value)) {
                        $info['name'] = $value;
                    }
                    break;
                case 'extension' :
                    throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Set extension install condition by name');
                default :
                    throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Unknown install condition ' .
                        $var);
            }
        }
        if ($value instanceof PEAR2_Pyrus_PackageFile_v2_Release_InstallCondition && $value->installcondition) {
            if (!isset($this->installcondition) || $this->installcondition != 'extension') {
                if ($value->installcondition != $var) {
                    throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Cannot set ' . $var .
                                ' to another install condition (' . $value->installcondition . ')');
                }
                if (!isset($this->info[$var])) {
                    switch ($var) {
                        case 'php' :
                            $this->info[$var] = array('min' => null, 'max' => null, 'exclude' => null);
                            break;
                        case 'os' :
                            $this->info[$var] = array('name' => null, 'conflicts' => null);
                            break;
                        case 'arch' :
                            $this->info[$var] = array('pattern' => null, 'conflicts' => null);
                            break;
                    }
                }
                foreach ($this->info[$var] as $n => $unused) {
                    $this->info[$var][$n] = $value->$n;
                }
            } else {
                if ($value->installcondition != 'extension') {
                    throw new PEAR2_Pyrus_PackageFile_v2_Release_Exception('Cannot set extension ' . $var .
                                ' to another install condition (' . $value->installcondition . ')');
                }
                $ext = $this->locateExtension($var);
                if (!$ext) {
                    $ext = count($this->info);
                    $this->info[$ext] = array('name' => $var, 'min' => null, 'max' => null, 'exclude' => null, 'conflicts' => null);
                }
                foreach (array('min' => null, 'max' => null, 'exclude' => null, 'conflicts' => null) as $n => $unused) {
                    if ($n == 'conflicts') {
                        if ($value->conflicts) {
                            $this->info[$ext]['conflicts'] = '';
                        } else {
                            $this->info[$ext]['conflicts'] = null;
                        }
                        continue;
                    }
                    $this->info[$ext][$n] = $value->$n;
                }
            }
        } else {
            foreach ($info as $key => $val) {
                $this->info[$var][$key] = $val;
            }
        }
        $this->save();
    }

    function offsetExists($var)
    {
        if ($this->installcondition == 'extension' && !isset($this->index)) {
            return ($this->locateExtension($var) !== false);
        }
        return isset($this->info[$var]);
    }

    function offsetUnset($var)
    {
        if ($this->installcondition == 'extension' && !isset($this->index)) {
            if (($i = $this->locateExtension($var)) !== false) {
                unset($this->info[$i]);
            }
            return;
        }
        unset($this->info[$var]);
        $this->save();
    }

    function setInstallCondition($obj, $type, $index = null)
    {
        if (!$this->parent) {
            return;
        }
        if ($index !== null) {
            $this->info[$index] = $obj->getInfo();
            return $this->parent->setInstallCondition($this, $type);
        }
        if (isset($this->index)) {
            $this->parent->setInstallCondition($this, $type, $this->index);
        } else {
            if (!isset($this->info[$type])) {
                $this->info[$type] = array();
            }
            $this->info[$type] = $obj->getInfo();
            $this->parent->setInstallCondition($this);
        }
    }

    function save()
    {
        if (!$this->parent) {
            return;
        }
        if (isset($this->installcondition)) {
            $this->parent->setInstallCondition($this, $this->installcondition, $this->index);
        } else {
            $this->parent->setInstallCondition($this);
        }
    }
}

?><?php
/**
 * PEAR2_Pyrus_PackageFile_v2_Release_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for release info in a package file.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_Release_Exception extends PEAR2_Exception {}<?php
/**
 * PEAR2_Pyrus_PackageFile_v2_BundledPackage
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Represents bundled packages in a package.xml bundle package type
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_BundledPackage implements ArrayAccess, Countable, Iterator
{
    protected $info;
    protected $parent;

    /**
     * @param array The content of this element.  All allowed indices should be initialized to null
     */
    function __construct($parent, $info)
    {
        $this->parent = $parent;
        if (is_string($info)) {
            $info = array($info);
        }
        $this->info = $info;
    }

    function count()
    {
        return count($this->info);
    }

    function current()
    {
        return current($this->info);
    }

    function next()
    {
        next($this->info);
    }

    function key()
    {
        return current($this->info);
    }

    function valid()
    {
        return current($this->info);
    }

    function rewind()
    {
        reset($this->info);
    }

    function locatePackage($package)
    {
        foreach ($this->info as $i => $bundle) {
            if ($bundle === $package) {
                return $i;
            }
        }
        return false;
    }

    function offsetUnset($var)
    {
        $i = $this->locatePackage($var);
        if ($i === false) {
            return;
        }
        unset($this->info[$i]); 
        $this->save();
    }

    function offsetGet($var)
    {
        $i = $this->locatePackage($var);
        if ($i === false) {
            return false;
        }
        return $var;
    }

    function offsetSet($var, $value)
    {
        if (!is_string($value)) {
            throw new PEAR2_Pyrus_PackageFile_Exception('Can only set bundledpackage to string');
        }
        // $var is ignored
        $i = $this->locatePackage($value);
        if ($i === false) {
            $i = count($this->info);
        }
        $this->info[$i] = $value;
        $this->save();
    }

    function offsetExists($var)
    {
        $i = $this->locatePackage($var);
        return $i !== false;
    }

    function getInfo()
    {
        return $this->info;
    }

    function save()
    {
        $info = $this->info;
        if (count($info) == 1) {
            $info = $info[0];
        }
        $this->parent->rawcontents = array('bundledpackage' => $info);
    }
}<?php
/**
 * PEAR2_Pyrus_PackageFile_v2_Validator
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Private validation class used by PEAR2_Pyrus_PackageFile_v2 - do not use directly, its
 * sole purpose is to split up the PEAR/PackageFile/v2.php file to make it smaller
 *
 * @access     private
 * @category   pear
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_Validator
{
    const VERSION = '2.0.0a1';
    /**
     * @var array
     */
    var $_packageInfo;
    /**
     * @var PEAR2_Pyrus_PackageFile_v2
     */
    var $_pf;
    /**
     * @var PEAR2_Pyrus_ErrorStack
     */
    var $_stack;
    /**
     * @var int
     */
    var $_isValid = 0;
    /**
     * @var int
     */
    var $_filesValid = 0;
    /**
     * @var int
     */
    var $_curState = 0;
    protected $errors;

    function getErrors()
    {
        return $this->errors;
    }

    /**
     * @param PEAR2_Pyrus_PackageFile_v2
     * @param int
     */
    function validate(PEAR2_Pyrus_IPackage $pf, $state = PEAR2_Pyrus_Validate::NORMAL)
    {
        $this->errors = new PEAR2_MultiErrors;
        if (!$pf->schemaOK) {
            // this package.xml was created from scratch, not loaded from an existing
            // package.xml
            $dom = new DOMDocument;
            libxml_use_internal_errors(true);
            libxml_clear_errors();
            $dom->loadXML($pf);
            $a = $pf->toArray();
            if ($a['package']['attribs']['version'] == '2.1') {
                $schema = PEAR2_Pyrus::getDataPath() . '/package-2.1.xsd';
                // for running out of cvs
                if (!file_exists($schema)) {
                    $schema = dirname(dirname(dirname(dirname(dirname(__FILE__))))) . '/data/package-2.1.xsd';
                }
            } else {
                $schema = PEAR2_Pyrus::getDataPath() . '/package-2.0.xsd';
                // for running out of cvs
                if (!file_exists($schema)) {
                    $schema = dirname(dirname(dirname(dirname(dirname(__FILE__))))) . '/data/package-2.0.xsd';
                }
            }
            $dom->schemaValidate($schema);
            $causes = array();
            foreach (libxml_get_errors() as $error) {
                $this->errors->E_ERROR[] = new PEAR2_Pyrus_PackageFile_Exception("Line " .
                     $error->line . ': ' . $error->message);
            }
            if (count($this->errors)) {
                throw new PEAR2_Pyrus_PackageFile_Exception('Invalid package.xml, does' .
                    ' not validate against schema', $this->errors);
            }
        }
        $this->_pf = $pf;
        $this->_curState = $state;
        $this->_packageInfo = $this->_pf->toArray();
        $this->_packageInfo = $this->_packageInfo['package'];
        if (!isset($this->_packageInfo) || !is_array($this->_packageInfo)) {
            return false;
        }
        $myversion = self::VERSION;
        if ($myversion === '2.0.0a1') {
            // we're running from CVS, assume we're 2.0.0
            $myversion = '2.0.0';
        }
        $test = $this->_packageInfo;
        if (isset($test['dependencies']) &&
              isset($test['dependencies']['required']) &&
              isset($test['dependencies']['required']['pearinstaller']) &&
              isset($test['dependencies']['required']['pearinstaller']['min']) &&
              version_compare($myversion,
                $test['dependencies']['required']['pearinstaller']['min'], '<')) {
            $this->errors->E_ERROR[] = new PEAR2_Pyrus_PackageFile_Exception(
                'This package.xml requires PEAR version ' .
                $test['dependencies']['required']['pearinstaller']['min'] .
                ' to parse properly, we are version ' . $myversion);
        }
        $fail = false;
        foreach ($pf->contents as $file) {
            // leverage the hidden iterators to do our validation
            $name = $file->dir . $file->name;
            if ($name[0] == '.' && $name[1] == '/') {
                // name is something like "./doc/whatever.txt"
                $this->errors->E_ERROR[] = new PEAR2_Pyrus_Package_Exception(
                    'File "' . $name . '" cannot begin with "."');
                continue;
            }
            if (!$this->_validateRole($file->role)) {
                if (isset($this->_packageInfo['usesrole'])) {
                    $roles = $this->_packageInfo['usesrole'];
                    if (!isset($roles[0])) {
                        $roles = array($roles);
                    }
                    foreach ($roles as $role) {
                        if ($role['role'] = $file->role) {
                            if (isset($role['uri'])) {
                                $package = $role['uri'];
                            } else {
                                $package = PEAR2_Pyrus_Config::
                                    parsedPackageNameToString(array('package' =>
                                        $role['package'], 'channel' => $role['channel']),
                                        true);
                            }
                            $msg = 'This package contains role "' . $file->role .
                                '" and requires package "' . $package
                                 . '" to be used';
                            $this->errors->E_WARNING[] =
                                new PEAR2_Pyrus_PackageFile_Exception($msg);
                        }
                    }
                }
                $this->errors->E_ERROR[] =
                    new PEAR2_Pyrus_PackageFile_Exception(
                    'File "' . $name . '" has invalid role "' .
                    $file->role . '", should be one of ' . implode(', ',
                    PEAR2_Pyrus_Installer_Role::getValidRoles($this->_pf->getPackageType())));
            }
            if (count($file->tasks) && $this->_curState != PEAR2_Pyrus_Validate::DOWNLOADING) { // has tasks
                $save = $file->getArrayCopy();
                foreach ($file->tasks as $task => $value) {
                    if ($tagClass = $this->_pf->getTask($task)) {
                        if (!is_array($value) || !isset($value[0])) {
                            $value = array($value);
                        }
                        foreach ($value as $v) {
                            try {
                                $ret = $tagClass::validateXml($this->_pf, $v, $save['attribs'], $file->name);
                            } catch (PEAR2_Pyrus_Task_Exception $e) {
                                $this->errors->E_ERROR[] =
                                    new PEAR2_Pyrus_PackageFile_Exception('Invalid task $task', $e);
                            }
                        }
                    } else {
                        if (isset($this->_packageInfo['usestask'])) {
                            $roles = $this->_packageInfo['usestask'];
                            if (!isset($roles[0])) {
                                $roles = array($roles);
                            }
                            foreach ($roles as $role) {
                                if ($role['task'] = $task) {
                                    if (isset($role['uri'])) {
                                        $package = $role['uri'];
                                    } else {
                                        $package = PEAR2_Pyrus_Config::
                                            parsedPackageNameToString(array('package' =>
                                                $role['package'], 'channel' => $role['channel']),
                                                true);
                                    }
                                    $msg = 'This package contains task "' .
                                        str_replace($this->_pf->getTasksNs() . ':', '', $task) .
                                        '" and requires package "' . $package
                                         . '" to be used';
                                    $this->errors->E_WARNING[] =
                                        new PEAR2_Pyrus_PackageFile_Exception($msg);
                                }
                            }
                        }
                        $this->errors->E_ERROR[] =
                            new PEAR2_Pyrus_PackageFile_Exception(
                            'Unknown task "' . $task . '" passed in file <file name="' .
                            $name . '">');
                    }
                }
            }
        }
        $this->_validateRelease();
        if (count($this->errors->E_ERROR)) {
            throw new PEAR2_Pyrus_PackageFile_Exception('Invalid package.xml', $this->errors);
        }
        try {
            $validator = PEAR2_Pyrus_Config::current()
                ->channelregistry[$this->_pf->channel]
                ->getValidationObject($this->_pf->name);
        } catch (PEAR2_Pyrus_Config_Exception $e) {
            throw new PEAR2_Pyrus_PackageFile_Exception(
                'Unable to process channel-specific configuration for channel ' .
                $this->_pf->getChannel(), $e);
        } catch (Exception $e) {
            $valpack = PEAR2_Pyrus_Config::current()
                ->channelregistry[$this->_pf->channel]->getValidationPackage();
            $this->errors->E_ERROR[] = new PEAR2_Pyrus_PackageFile_Exception(
                'Unknown channel ' . $this->_pf->channel);
            $this->errors->E_ERROR[] = new PEAR2_Pyrus_PackageFile_Exception(
                'package "' . $this->_pf->channel . '/' . $this->_pf->name .
                '" cannot be properly validated without validation package "' .
                $this->_pf->channel . '/' . $valpack['name'] . '-' . $valpack['version'] . '"');
        }
        try {
            $validator->setPackageFile($this->_pf);
            $validator->setChannel(PEAR2_Pyrus_Config::current()
                ->channelregistry[$this->_pf->channel]);
            $validator->validate($state);
            // merge in errors from channel-specific validation
            $this->errors[] = $validator->getFailures();
        } catch (\Exception $e) {
            $this->errors->E_ERROR[] = $e;
        }
        if (count($this->errors->E_ERROR)) {
            throw new PEAR2_Pyrus_PackageFile_Exception('Invalid package.xml',
                $this->errors);
        }
        if ($state == PEAR2_Pyrus_Validate::PACKAGING) {
            if ($this->_pf->type == 'bundle') {
                if (!$this->_analyzeBundledPackages()) {
                    throw new PEAR2_Pyrus_PackageFile_Exception('Invalid package.xml',
                        $this->errors);
                }
            } else {
                if (!$this->_analyzePhpFiles()) {
                    throw new PEAR2_Pyrus_PackageFile_Exception('Invalid package.xml',
                        $this->errors);
                }
            }
        }
        return $state;
    }

    function _validateFilelist($list)
    {
        $ignored_or_installed = array();
        if (isset($list['install'])) {
            if (!isset($list['install'][0])) {
                $list['install'] = array($list['install']);
            }
            foreach ($list['install'] as $file) {
                if (array_key_exists($file['attribs']['name'], $ignored_or_installed)) {
                    $this->errors->E_ERROR[] = new PEAR2_Pyrus_PackageFile_Exception(
                        'Only one <install> tag is allowed for file "' .
                        $file['attribs']['name'] . '"');
                }
                if (!isset($this->_pf->files[$file['attribs']['name']])) {
                    $this->errors->E_ERROR[] = new PEAR2_Pyrus_PackageFile_Exception(
                        '<install as> file "' . $file['attribs']['name'] . '" is not in <contents>');
                }
                if (!isset($ignored_or_installed[$file['attribs']['name']])) {
                    $ignored_or_installed[$file['attribs']['name']] = array();
                }
                $ignored_or_installed[$file['attribs']['name']][] = 1;
            }
        }
        if (isset($list['ignore'])) {
            if (!isset($list['ignore'][0])) {
                $list['ignore'] = array($list['ignore']);
            }
            foreach ($list['ignore'] as $file) {
                if (array_key_exists($file['attribs']['name'], $ignored_or_installed)) {
                    $this->errors->E_ERROR[] = new PEAR2_Pyrus_PackageFile_Exception(
                        'Cannot have both <ignore> and <install> tags for file "' .
                        $file['attribs']['name'] . '"');
                }
                if (!isset($this->_pf->files[$file['attribs']['name']])) {
                    $this->errors->E_ERROR[] = new PEAR2_Pyrus_PackageFile_Exception(
                        '<ignore> file "' . $file['attribs']['name'] . '" is not in <contents>');
                }
            }
        }
    }

    function _validateRelease()
    {
        if (isset($this->_packageInfo['phprelease'])) {
            $release = 'phprelease';
            $releases = $this->_packageInfo['phprelease'];
            if (!is_array($releases)) {
                return true;
            }
            if (!isset($releases[0])) {
                $releases = array($releases);
            }
        }
        foreach (array('', 'zend') as $prefix) {
            $releasetype = $prefix . 'extsrcrelease';
            if (isset($this->_packageInfo[$releasetype])) {
                $release = $releasetype;
                $releases = $this->_packageInfo[$releasetype];
                if (!is_array($releases)) {
                    return true;
                }
                if (!isset($releases[0])) {
                    $releases = array($releases);
                }
            }
            $releasetype = 'extbinrelease';
            if (isset($this->_packageInfo[$releasetype])) {
                $release = $releasetype;
                $releases = $this->_packageInfo[$releasetype];
                if (!is_array($releases)) {
                    return true;
                }
                if (!isset($releases[0])) {
                    $releases = array($releases);
                }
            }
        }
        if (isset($this->_packageInfo['bundle'])) {
            $release = 'bundle';
            $releases = $this->_packageInfo['bundle'];
            if (!is_array($releases) || !isset($releases[0])) {
                $releases = array($releases);
            }
        }
        foreach ($releases as $rel) {
            if (is_array($rel) && array_key_exists('filelist', $rel)) {
                if ($rel['filelist']) {
                    $this->_validateFilelist($rel['filelist']);
                }
            }
        }
    }

    /**
     * This is here to allow role extension through plugins
     * @param string
     */
    function _validateRole($role)
    {
        return in_array($role, PEAR2_Pyrus_Installer_Role::getValidRoles($this->_pf->getPackageType()));
    }

    function _analyzeBundledPackages()
    {
        if (!$this->_pf->type == 'bundle') {
            return false;
        }
        if (!$this->_pf->packagefile) {
            return false;
        }
        $dir_prefix = $this->_pf->filepath;
        foreach ($this->_pf->bundledpackage as $package) {
            if (!file_exists($dir_prefix . DIRECTORY_SEPARATOR . $package)) {
                $this->errors->E_ERROR[] = new PEAR2_Pyrus_PackageFile_Exception(
                    'File "' . $dir_prefix . DIRECTORY_SEPARATOR . $package .
                    '" in package.xml does not exist');
                continue;
            }
            PEAR2_Pyrus_Log::log(1, "Analyzing bundled package $package");
            try {
                $ret = new PEAR2_Pyrus_Package_Tar($dir_prefix . DIRECTORY_SEPARATOR .
                    $package);
            } catch (Exception $e) {
                $this->errors->E_ERROR[] = new PEAR2_Pyrus_PackageFile_Exception(
                    'File "' . $dir_prefix . DIRECTORY_SEPARATOR . $package .
                    '" in package.xml is not valid', $e);
                continue;
            }
        }
        return true;
    }

    function _analyzePhpFiles()
    {
        if (!$this->_pf->packagefile) {
            throw new PEAR2_Pyrus_PackageFile_Exception(
                'Cannot validate files, no path to package file is set (use setPackageFile())');
        }
        foreach ($this->_pf->contents as $fa) {
            if (!file_exists($this->_pf->getFilePath($fa->name))) {
                $this->errors->E_ERROR[] = new PEAR2_Pyrus_PackageFile_Exception(
                    'File "' . $this->_pf->getFilePath($fa->name) .
                    '" in package.xml does not exist');
                continue;
            }
            $this->analyzeSourceCode($this->_pf->getFilePath($fa->name));
        }
        return !count($this->errors->E_ERROR);
    }

    /**
     * Analyze the source code of the given PHP file
     *
     * @param  string Filename of the PHP file
     * @param  boolean whether to analyze $file as the file contents
     * @return mixed
     */
    function analyzeSourceCode($file, $string = false)
    {
        if (!function_exists("token_get_all")) {
            throw new PEAR2_Pyrus_PackageFile_Exception(
                'Parser error: token_get_all() function must exist to analyze source code');
        }
        if (!($this->errors instanceof PEAR2_MultiErrors)) {
            $this->errors = new PEAR2_MultiErrors;
        }
        if ($string) {
            $contents = $file;
        } else {
            if (!$fp = @fopen($file, "r")) {
                return false;
            }
            fclose($fp);
            $contents = file_get_contents($file);
        }
        $tokens = token_get_all($contents);
/*
        for ($i = 0; $i < sizeof($tokens); $i++) {
            @list($token, $data) = $tokens[$i];
            if (is_string($token)) {
                var_dump($token);
            } else {
                print token_name($token) . ' ';
                var_dump(rtrim($data));
            }
        }
*/
        $look_for = 0;
        $paren_level = 0;
        $bracket_level = 0;
        $brace_level = 0;
        $lastphpdoc = '';
        $current_class = '';
        $current_interface = '';
        $current_class_level = -1;
        $current_function = '';
        $current_function_level = -1;
        $declared_classes = array();
        $declared_interfaces = array();
        $declared_functions = array();
        $declared_methods = array();
        $used_classes = array();
        $used_functions = array();
        $extends = array();
        $implements = array();
        $nodeps = array();
        $inquote = false;
        $interface = false;
        for ($i = 0; $i < sizeof($tokens); $i++) {
            if (is_array($tokens[$i])) {
                list($token, $data) = $tokens[$i];
            } else {
                $token = $tokens[$i];
                $data = '';
            }
            if ($inquote) {
                if ($token != '"' && $token != T_END_HEREDOC) {
                    continue;
                } else {
                    $inquote = false;
                    continue;
                }
            }
            switch ($token) {
                case T_WHITESPACE :
                    continue;
                case ';':
                    if ($interface) {
                        $current_function = '';
                        $current_function_level = -1;
                    }
                    break;
                case '"':
                case T_START_HEREDOC:
                    $inquote = true;
                    break;
                case T_CURLY_OPEN:
                case T_DOLLAR_OPEN_CURLY_BRACES:
                case '{': $brace_level++; continue 2;
                case '}':
                    $brace_level--;
                    if ($current_class_level == $brace_level) {
                        $current_class = '';
                        $current_class_level = -1;
                    }
                    if ($current_function_level == $brace_level) {
                        $current_function = '';
                        $current_function_level = -1;
                    }
                    continue 2;
                case '[': $bracket_level++; continue 2;
                case ']': $bracket_level--; continue 2;
                case '(': $paren_level++;   continue 2;
                case ')': $paren_level--;   continue 2;
                case T_INTERFACE:
                    $interface = true;
                case T_CLASS:
                    if (($current_class_level != -1) || ($current_function_level != -1)) {
                        if ($string) {
                            $this->errors->E_ERROR[] = new PEAR2_Pyrus_PackageFile_Exception(
                                'Parser error: invalid PHP found in file');
                        } else {
                            $this->errors->E_ERROR[] = new PEAR2_Pyrus_PackageFile_Exception(
                                'Parser error: invalid PHP found in file "' . $file . '"');
                        }
                        return false;
                    }
                case T_FUNCTION:
                case T_NEW:
                case T_EXTENDS:
                case T_IMPLEMENTS:
                    $look_for = $token;
                    continue 2;
                case T_STRING:
                    if ($look_for == T_CLASS) {
                        $current_class = $data;
                        $current_class_level = $brace_level;
                        $declared_classes[] = $current_class;
                    } elseif ($look_for == T_INTERFACE) {
                        $current_interface = $data;
                        $current_class_level = $brace_level;
                        $declared_interfaces[] = $current_interface;
                    } elseif ($look_for == T_IMPLEMENTS) {
                        $implements[$current_class] = $data;
                    } elseif ($look_for == T_EXTENDS) {
                        $extends[$current_class] = $data;
                    } elseif ($look_for == T_FUNCTION) {
                        if ($current_class) {
                            $current_function = "$current_class::$data";
                            $declared_methods[$current_class][] = $data;
                        } elseif ($current_interface) {
                            $current_function = "$current_interface::$data";
                            $declared_methods[$current_interface][] = $data;
                        } else {
                            $current_function = $data;
                            $declared_functions[] = $current_function;
                        }
                        $current_function_level = $brace_level;
                        $m = array();
                    } elseif ($look_for == T_NEW) {
                        $used_classes[$data] = true;
                    }
                    $look_for = 0;
                    continue 2;
                case T_VARIABLE:
                    $look_for = 0;
                    continue 2;
                case T_DOC_COMMENT:
                case T_COMMENT:
                    if (preg_match('!^/\*\*\s!', $data)) {
                        $lastphpdoc = $data;
                        if (preg_match_all('/@nodep\s+(\S+)/', $lastphpdoc, $m)) {
                            $nodeps = array_merge($nodeps, $m[1]);
                        }
                    }
                    continue 2;
                case T_DOUBLE_COLON:
                    if ($tokens[$i - 1][0] == T_VARIABLE) {
                        continue;
                    }
                    if (!($tokens[$i - 1][0] == T_WHITESPACE || $tokens[$i - 1][0] == T_STRING)) {
                        if ($string) {
                            $this->errors->E_ERROR[] = new PEAR2_Pyrus_PackageFile_Exception(
                                'Parser error: invalid PHP found in file');
                        } else {
                            $this->errors->E_ERROR[] = new PEAR2_Pyrus_PackageFile_Exception(
                                'Parser error: invalid PHP found in file "' . $file . '"');
                        }
                        return false;
                    }
                    $class = $tokens[$i - 1][1];
                    if (strtolower($class) != 'parent') {
                        $used_classes[$class] = true;
                    }
                    continue 2;
            }
        }
        return array(
            "source_file" => $file,
            "declared_classes" => $declared_classes,
            "declared_interfaces" => $declared_interfaces,
            "declared_methods" => $declared_methods,
            "declared_functions" => $declared_functions,
            "used_classes" => array_diff(array_keys($used_classes), $nodeps),
            "inheritance" => $extends,
            "implements" => $implements,
            );
    }
}
?><?php
/**
 * PEAR2_Pyrus_PackageFile_v2_Compatible_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for compatiblility exceptions in a package file.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2_Compatible_Exception extends PEAR2_Exception {}<?php
/**
 * PEAR2_Pyrus_PackageFile_IValidator
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Interface for package file validators
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
interface PEAR2_Pyrus_PackageFile_IValidator
{
    public function extendedValidate(array $packageinfo);
}<?php
/**
 * PEAR2_Pyrus_PackageFile_v2Iterator_PackagingIterator
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * iterator for packaging
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2Iterator_PackagingIterator extends ArrayIterator
{
    static private $_parent;
    static function setParent(PEAR2_Pyrus_IPackageFile $parent)
    {
        self::$_parent = $parent;
    }

    function key()
    {
        $curfile = $this->current();
        $role =
            PEAR2_Pyrus_Installer_Role::factory(self::$_parent->getPackageType(), $curfile['attribs']['role']);
        // add the install-as attribute to retrieve packaging location
        return $role->getPackagingLocation(self::$_parent, $curfile['attribs']);
    }

    function current()
    {
        $curfile = parent::current();
        $curfile['attribs']['name'] = parent::key();
        if ($base = self::$_parent->getBaseInstallDir($curfile['attribs']['name'])) {
            $curfile['attribs']['baseinstalldir'] = $base;
        }
        if (isset($curfile['attribs']['md5sum'])) {
            unset($curfile['attribs']['md5sum']);
        }
        return $curfile;
    }
}<?php
/**
 * PEAR2_Pyrus_PackageFile_v2Iterator_FileContents
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Traverse the current <dir> in the <contents> tag
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2Iterator_FileContents extends RecursiveArrayIterator
{
    protected $tag;
    protected $dir = '';
    private $_packagefile;
    function __construct($arr, $tag, PEAR2_Pyrus_PackageFile_v2 $parent, $dir = '')
    {
        $this->tag = $tag;
        $this->dir = $dir;
        $this->_packagefile = $parent;
        if ($arr instanceof PEAR2_Pyrus_PackageFile_v2Iterator_FileTag) {
            $arr = $arr->getArrayCopy();
        }
        parent::__construct($arr);
    }

    function getChildren ()
    {
        $arr = $this->current();
        $now = '';
        if ($this->key() == 'dir' && !isset($arr[0])) {
            $now = $arr['attribs']['name'];
            if (!$this->dir && $now == '/') {
                $now = '';
            }
        }
        $dir = $this->dir;
        if ($now && $dir) {
            if ($dir[strlen($dir) - 1] != '/') {
                $dir .= '/';
            }
        }
        if (isset($arr['attribs'])) unset($arr['attribs']);
        if (isset($arr[0])) {
            return new PEAR2_Pyrus_PackageFile_v2Iterator_FileContentsMulti($arr, $this->key(),
                $this->_packagefile, $dir . $now);
        }
        return new PEAR2_Pyrus_PackageFile_v2Iterator_FileContents($arr, $this->key(),
            $this->_packagefile, $dir . $now);
    }

    function hasChildren()
    {
        $arr = $this->current();
        if (!($arr instanceof PEAR2_Pyrus_PackageFile_v2Iterator_FileTag) && !is_array($arr)) {
            return false;
        }
        if (isset($arr['file']) || isset($arr['dir']) || isset($arr[0])) {
            return true;
        }
        return false;
    }

    function current()
    {
        $x = parent::current();
        return new PEAR2_Pyrus_PackageFile_v2Iterator_FileTag($x, $this->dir, $this->_packagefile);
    }
}
<?php
/**
 * PEAR2_Pyrus_PackageFile_v2Iterator_File
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Traverse the complete <contents> tag, one <dir> at a time
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2Iterator_File extends RecursiveIteratorIterator
{
    function next()
    {
        parent::next();
        $x = $this->current();
        if (isset($x[0])) {
            parent::next();
            $x = $this->current();
        }
    }
}<?php
/**
 * PEAR2_Pyrus_PackageFile_v2Iterator_ScriptFileFilterIterator
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Class which iterates over all files, only returning those that contain script tasks.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2Iterator_ScriptFileFilterIterator extends FilterIterator
{
    private $_inner;
    private $_parent;
    private $_tasksNs;
    function __construct(array $arr, PEAR2_Pyrus_IPackageFile $parent)
    {
        $this->_parent = $parent;
        $this->_tasksNs = $this->_parent->getTasksNs();
        parent::__construct($this->_inner = new ArrayIterator($arr));
    }

    function accept()
    {
        if (!$this->_inner->valid()) {
            return false;
        }

        $file = $this->key();
        foreach ($this->_inner->current() as $key => $value) {
            if (strpos($key, $this->_tasksNs . ':') !== 0) {
                continue;
            }

            $task = str_replace(array($this->_tasksNs . ':', '-'), array('', ' '), $key);
            $task = str_replace(' ', '/', ucwords($task));
            $task = str_replace('/', '_', $task);
            $class = 'PEAR2_Pyrus_Task_' . $task;
            if (!class_exists($class, true)) {
                continue;
            }
            if ($class::TYPE == 'script') {
                return true;
            }
        }
        return false;
    }

    function current()
    {
        return $this->_parent->files[$this->_inner->key()];
    }
}<?php
/**
 * PEAR2_Pyrus_PackageFile_v2Iterator_FileContentsMulti
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * iterator for tags with multiple sub-tags
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2Iterator_FileContentsMulti extends PEAR2_Pyrus_PackageFile_v2Iterator_FileContents
{
    function key()
    {
        return $this->tag;
    }
}
<?php
/**
 * PEAR2_Pyrus_PackageFile_v2Iterator_FileInstallationFilter
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * filtered iterator for file installation
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2Iterator_FileInstallationFilter extends FilterIterator
{
    static private $_parent;
    static private $_installGroup;
    static function setParent(PEAR2_Pyrus_PackageFile_v2 $parent)
    {
        self::$_parent = $parent;
        $errs = new PEAR2_MultiErrors;
        $depchecker = new PEAR2_Pyrus_Dependency_Validator(
            array('channel' => self::$_parent->channel,
                  'package' => self::$_parent->package),
            PEAR2_Pyrus_Validate::INSTALLING, $errs);
        foreach (self::$_parent->installGroup as $instance) {
            try {
                if (isset($instance['installconditions'])) {
                    $installconditions = $instance['installconditions'];
                    if (is_array($installconditions)) {
                        foreach ($installconditions as $type => $conditions) {
                            if (!isset($conditions[0])) {
                                $conditions = array($conditions);
                            }
                            foreach ($conditions as $condition) {
                                $ret = $depchecker->{"validate{$type}Dependency"}($condition);
                            }
                        }
                    }
                }
            } catch (Exception $e) {
                // can't use this release
                continue;
            }
            $release = array('install' => array(), 'ignore' => array());
            // this is the release to use
            if (isset($instance['filelist'])) {
                // ignore files
                if (isset($instance['filelist']['ignore'])) {
                    $ignore = isset($instance['filelist']['ignore'][0]) ?
                        $instance['filelist']['ignore'] :
                        array($instance['filelist']['ignore']);
                    foreach ($ignore as $ig) {
                        $release['ignore'][$ig['attribs']['name']] = true;
                    }
                }
                // install files as this name
                if (isset($instance['filelist']['install'])) {
                    $installas = isset($instance['filelist']['install'][0]) ?
                        $instance['filelist']['install'] :
                        array($instance['filelist']['install']);
                    foreach ($installas as $as) {
                        $release['install'][$as['attribs']['name']] =
                            $as['attribs']['as'];
                    }
                }
            }
            self::$_installGroup = $release;
            return;
        }
    }

    function current()
    {
        $file = $this->key();
        $curfile = parent::current();
        if (isset(self::$_installGroup['install'][$file])) {
            // add the install-as attribute for these files
            $curfile['attribs']['install-as'] =
                self::$_installGroup['install'][$file];
        }
        if ($b = self::$_parent->getBaseInstallDir($file)) {
            $curfile['attribs']['baseinstalldir'] = $b;
        }
        return new PEAR2_Pyrus_PackageFile_v2Iterator_FileTag($curfile,
            '', self::$_parent);
    }

    function accept()
    {
        $file = $this->getInnerIterator()->key();
        if (isset(self::$_installGroup['ignore'][$file])) {
            // skip ignored files
            return false;
        }
        return true;
    }
}<?php
/**
 * PEAR2_Pyrus_PackageFile_v2Iterator_FileAttribsFilter
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Filter out the attributes meta-information when traversing the file list
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2Iterator_FileAttribsFilter extends RecursiveFilterIterator
{
    function accept()
    {
        $it = $this->getInnerIterator();
        if (!$it->valid()) {
            return false;
        }
        $key = $it->key();
        if ($key === 'attribs') {
            return false;
        }
        return true;
    }
}
<?php
/**
 * PEAR2_Pyrus_PackageFile_v2Iterator_FileTag
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Store the path to the current file recursively
 *
 * Information can be accessed in three ways:
 *
 * - $file['attribs'] as an array directly
 * - $file->name      as object member, to access attributes
 * - $file->tasks     as pseudo-object, to access each task
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile_v2Iterator_FileTag extends ArrayObject
{
    public $dir;
    /**
     * @var PEAR2_Pyrus_PackageFile_v2
     */
    private $_packagefile;
    function __construct($a, $t, $parent)
    {
        $this->_packagefile = $parent;
        parent::__construct($a);
        if ($t === '.') $t = '';
        $this->dir = $t;
        if ($this->dir && $this->dir != '/') $this->dir .= '/';
    }

    /**
     * Hide the install-as attribute (it is merged into the "name" attribute)
     *
     * @param string $offset
     * @return mixed
     */
    function offsetGet($offset)
    {
        if ($offset == 'attribs') {
            $ret = parent::offsetGet('attribs');
            if (isset($ret['install-as'])) {
                unset($ret['install-as']);
            }
            return $ret;
        }
        if ($offset == 'install-as') {
            $ret = parent::offsetGet('attribs');
            if (!isset($ret['install-as'])) {
                return null;
            }
            return $ret['install-as'];
        }
    }

    function __get($var)
    {
        if ($var == 'packagedname') {
            return $this->dir . $this['attribs']['name'];
        }
        if ($var == 'name') {
            $attribs = parent::offsetGet('attribs');
            if (isset($attribs['install-as'])) {
                return $attribs['install-as'];
            }
            return $this->dir . $this['attribs']['name'];
        }
        if ($var == 'tasks') {
            $ret = $this->getArrayCopy();
            unset($ret['attribs']);
            return $ret;
        }
        if ($var == 'install-as') {
            $attribs = parent::offsetGet('attribs');
            return $attribs['install-as'];
        }
        if (!isset($this['attribs'][$var])) {
            return null;
        }
        return $this['attribs'][$var];
    }

    /**
     * Allow setting of attributes and tasks directly
     *
     * @param string $var
     * @param string|object $value
     */
    function __set($var, $value)
    {
        if (strpos($var, $this->_packagefile->getTasksNs()) === 0) {
            // setting a file task
            if ($value instanceof PEAR2_Pyrus_Task_Common) {
                $this->_packagefile->setFileAttribute($this->dir .
                    $this['attribs']['name'], $var, $value->getInfo());
                return;
            }
            throw new PEAR2_Pyrus_PackageFile_Exception('Cannot set ' . $var . ' to non-' .
                'PEAR2_Pyrus_Task_Common object in file ' . $this->dir .
                $this['attribs']['name']);
        }
        $this->_packagefile->setFileAttribute($this->dir . $this['attribs']['name'],
            $var, $value);
        parent::__construct($this->_packagefile->files[$this->dir . $this['attribs']['name']]);
    }

    function __unset($var)
    {
        if (isset($this['attribs'][$var])) {
            unset($this['attribs'][$var]);
        }
    }
}
<?php
/**
 * PEAR2_Pyrus_XMLParser_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for the XMLParser
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_XMLParser_Exception extends PEAR2_Exception {}<?php
/**
 * Process an XML file, convert it to an array
 *
 * PHP version 5
 *
 * @category   PEAR2
 * @package    PEAR2_Pyrus
 * @subpackage XML
 * @author     Greg Beaver <cellog@php.net>
 * @copyright  2008 The PEAR Group
 * @license    http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version    SVN: $Id$
 * @link       http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Process an XML file, convert it to an array
 *
 * @category   PEAR2
 * @package    PEAR2_Pyrus
 * @subpackage XML
 * @author     Greg Beaver <cellog@php.net>
 * @copyright  2008 The PEAR Group
 * @license    http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link       http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_XMLParser
{
    protected $reader;
    function __construct()
    {
        $this->reader = new XMLReader;
    }

    /**
     * Parse a string containing XML
     *
     * @param string $string The raw XML data
     * @param string $schema Path to the xml schema file for validation
     *
     * @return array
     */
    function parseString($string, $schema = false)
    {
        $this->reader->XML($string);
        return $this->_parse($string, $schema, false);
    }

    /**
     * Using XMLReader, unserialize XML into an array
     *
     * This unserializer has limitations on the XML it can parse, for simplicity:
     *
     *  - Only a single text node (the last one) will be processed, so this code:
     *    <pre>
     *     <?xml version="1.0" ?><test>hi<tag/>there</test>
     *    </pre>
     *    results in <code>array('test' => array('tag' => '', '_content' => 'there'))</code>
     *  - tag ordering is not preserved in all cases:
     *    <pre>
     *     <?xml version="1.0" ?><test><tag /><another /> <tag /></test>
     *    </pre>
     *    results in
     *    <code>array('test' => array('tag' => array('', ''), 'another' => ''))</code>
     *
     * @param string $file   file URI to process
     * @param string $schema path to the xml schema file for validation
     *
     * @return array
     */
    function parse($file, $schema = false)
    {
        if (!$this->reader->open($file)) {
            throw new PEAR2_Pyrus_XMLParser_Exception('Cannot open ' . $file .
                ' for parsing');
        }
        return $this->_parse($file, $schema, true);
    }

    /**
     * Merge tag into the array
     *
     * @param array  $arr     The array representation of the XML
     * @param string $tag     The tag name
     * @param array  $attribs Associative array of attributes for this tag
     * @param string $name    The tag name
     * @param int    $depth   The current depth within the XML document
     *
     * @return array
     */
    protected function mergeTag($arr, $tag, $attribs, $name, $depth)
    {
        if ($attribs) {
            // tag has attributes
            if (is_string($tag) && $tag !== '') {
                $tag = array('attribs' => $attribs, '_content' => $tag);
            } else {
                if (!is_array($tag)) {
                    $tag = array();
                }
                $tag['attribs'] = $attribs;
            }
        }
        if (is_array($arr) && isset($arr[$name]) && is_array($arr[$name]) &&
              isset($arr[$name][0])) {
            // tag exists as a sibling
            $where = count($arr[$name]);
            if (!isset($arr[$name][$where])) {
                $arr[$name][$where] = $tag;
                return $arr;
            }
            if (!is_array($arr[$name][$where])) {
                if (strlen($arr[$name][$where])) {
                    $arr[$name][$where] = array('_content' => $arr[$name][$where]);
                } else {
                    $arr[$name][$where] = array();
                }
            }
            $arr[$name][$where] = $tag;
        } else {
            if (!is_array($arr)) {
                $arr = array();
            }
            if (isset($arr[$name])) {
                // new sibling
                $arr[$name] = array($arr[$name], $tag);
                return $arr;
            }
            $arr[$name] = $tag;
        }
        return $arr;
    }

    protected function mergeValue($arr, $value)
    {
        if (is_array($arr) && isset($arr[0])) {
            // multiple siblings
            $arr[count($arr) - 1] = $this->mergeActualValue(
                $arr[count($arr) - 1], $value);
        } elseif (is_array($arr)) {
            $arr = $this->mergeActualValue($arr, $value);
        } else {
            $arr = $value;
        }
        return $arr;
    }

    protected function mergeActualValue($me, $value)
    {
        if (count($me)) {
            $me['_content'] = $value;
        } else {
            $me = $value;
        }
        return $me;
    }

    private function _parse($file, $schema, $isfile)
    {
        libxml_use_internal_errors(true);
        libxml_clear_errors();
        $arr = $this->_recursiveParse();
        $this->reader->close();
        $causes = array();
        foreach (libxml_get_errors() as $error) {
            $causes[] = new PEAR2_Pyrus_XMLParser_Exception("Line " .
                 $error->line . ': ' . $error->message);
        }
        if (count($causes)) {
            throw new PEAR2_Pyrus_XMLParser_Exception('Invalid XML document', $causes);
        }
        if ($schema) {
            $a = new DOMDocument();
            if ($isfile) {
                $a->load($file);
            } else {
                $a->loadXML($file);
            }
            /*
             from Rob Richards talk, use
             $a->setSchema($schema);
             and then check $a->isValid() in the _recursiveParse() and
             log errors - much more efficient
            */
            libxml_use_internal_errors(true);
            libxml_clear_errors();
            $a->schemaValidate($schema);
            $causes = array();
            foreach (libxml_get_errors() as $error) {
                $causes[] = new PEAR2_Pyrus_XMLParser_Exception("Line " .
                     $error->line . ': ' . $error->message);
            }
            libxml_clear_errors();
            if (count($causes)) {
                throw new PEAR2_Pyrus_XMLParser_Exception('Invalid XML document', $causes);
            }
        }

        return $arr;
    }

    private function _recursiveParse($arr = array())
    {
        while (@$this->reader->read()) {
            $depth = $this->reader->depth;
            if ($this->reader->nodeType == XMLReader::ELEMENT) {
                $tag = $this->reader->name;

                $attribs = array();
                if ($this->reader->isEmptyElement) {
                    if ($this->reader->hasAttributes) {
                        $attr = $this->reader->moveToFirstAttribute();
                        while ($attr) {
                            $attribs[$this->reader->name] = $this->reader->value;
                            $attr = $this->reader->moveToNextAttribute();
                        }
                        $depth = $this->reader->depth;
                        $arr = $this->mergeTag($arr, '', $attribs, $tag, $depth);
                        continue;
                    }
                    $depth = $this->reader->depth;
                    $arr = $this->mergeTag($arr, '', array(), $tag, $depth);
                    continue;
                }
                if ($this->reader->hasAttributes) {
                    $attr = $this->reader->moveToFirstAttribute();
                    while ($attr) {
                        $attribs[$this->reader->name] = $this->reader->value;
                        $attr = $this->reader->moveToNextAttribute();
                    }
                }
                $depth = $this->reader->depth;
                $arr = $this->mergeTag($arr, '', $attribs, $tag, $depth);
                if (is_array($arr[$tag]) && isset($arr[$tag][0])) {
                    // seek to last sibling
                    $arr[$tag][count($arr[$tag]) - 1] =
                        $this->_recursiveParse($arr[$tag][count($arr[$tag]) - 1]);
                } else {
                    $arr[$tag] = $this->_recursiveParse($arr[$tag]);
                }
                continue;
            }
            if ($this->reader->nodeType == XMLReader::END_ELEMENT) {
                return $arr;
            }
            if ($this->reader->nodeType == XMLReader::TEXT ||
                  $this->reader->nodeType == XMLReader::CDATA) {
                $arr = $this->mergeValue($arr, $this->reader->value);
            }
        }
        return $arr;
    }
}
<?php
/**
 * PEAR2_Pyrus_PECLBuild
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Class handling building of PECL packages
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PECLBuild
{
    protected $ui;
    protected $buildDirectory;
    /* don't think we need this, but will reserve judgement until I hear from internals@
    protected $zend_extension_api_no = 1;
    protected $zend_module_api_no = 1;
    protected $php_api_version = 1;
    */

    function __construct($ui)
    {
        $this->ui = $ui;
    }

    function installBuiltStuff(PEAR2_Pyrus_Registry_Package_Base $pkg, array $built)
    {
        foreach ($built as $ext) {
            $info = pathinfo($ext['file']);
            if ($info['extension'] === 'so' || $info['extension'] === 'dll') {
                if (extension_loaded(basename($ext['file'], $info['extension']))) {
                    $this->raiseError("Extension '" . basename($ext['file'], $info['extension']) .
                                      "' already loaded. " .
                                      'Please unload it in your php.ini file ' .
                                      'prior to install or upgrade');
                }
                $role = 'ext';
            } else {
                $role = 'src';
            }

            $copyto = $dest = $ext['dest'];
            $packagingroot = '';
            if (isset(PEAR2_Pyrus_Installer::$options['packagingroot'])) {
                $packagingroot = PEAR2_Pyrus_Installer::$options['packagingroot'];
                $copyto = $this->_prependPath($dest, $packagingroot);
            }

            if ($copyto != $dest) {
                $this->log(1, "Installing '$dest' as '$copyto'");
            } else {
                $this->log(1, "Installing '$dest'");
            }

            $copydir = dirname($copyto);
            if (file_exists($copydir)) {
                if (!is_dir($copydir)) {
                    throw new PEAR2_Pyrus_PECLBuild_Exception('Cannot install extension, ' .
                                                              $copydir . ' exists and is a file (should be directory)');
                }
            } else {
                $oldmode = umask(PEAR2_Pyrus_Config::current()->umask);
                if (!mkdir($copydir, 0777, true)) {
                    umask($oldmode);
                    throw new PEAR2_Pyrus_PECLBuild_Exception("failed to mkdir $copydir");
                }
                umask($oldmode);

                $this->log(3, "+ mkdir $copydir");
            }

            if (!@copy($ext['file'], $copyto)) {
                throw new PEAR2_Pyrus_PECLBuild_Exception("failed to write $copyto ($php_errormsg)");
            }

            $oldmode = umask(PEAR2_Pyrus_Config::current()->umask);
            if (!@chmod($copyto, 0777)) {
                $this->log(0, "failed to change mode of $copyto ($php_errormsg)");
            }
            umask($oldmode);

            $pkg->files[$ext['file']] = array('attribs' => array(
                'role' => $role,
                'name' => $ext['packagexml_name'],
                'installed_as' => $dest,
    /* don't think we need this, but will reserve judgement until I hear from internals@
                'php_api' => $ext['php_api'],
                'zend_mod_api' => $ext['zend_mod_api'],
                'zend_ext_api' => $ext['zend_ext_api'],
    */
                ));
        }
    }

    function listInstalledStuff($dir)
    {
        foreach (new \RecursiveIteratorIterator(
                            new \RecursiveDirectoryIterator($dir,
                                                            0|\RecursiveDirectoryIterator::SKIP_DOTS),
                            \RecursiveIteratorIterator::SELF_FIRST) as $file) {
            $info = stat($file);
            $uname = posix_getpwuid($info['uid']);
            $uname = $uname['name'];
            $gname = posix_getgrgid($info['gid']);
            $gname = $gname['name'];
            $perms = fileperms($file);
            foreach (array('s' => 0xC000, 'l' => 0xA000, '-' => 0x8000, 'b' => 0x6000,
                           'd' => 0x4000, 'c' => 0x2000, 'p' => 0x1000)
                     as $letter => $mask) {
                if (($perms & $mask) === $mask) {
                    $perminfo = $letter;
                    break;
                }
            }
            if (!isset($perminfo)) {
                $perminfo = 'u';
            }

            // Owner
            $perminfo .= (($perms & 0x0100) ? 'r' : '-');
            $perminfo .= (($perms & 0x0080) ? 'w' : '-');
            $perminfo .= (($perms & 0x0040) ?
                        (($perms & 0x0800) ? 's' : 'x' ) :
                        (($perms & 0x0800) ? 'S' : '-'));

            // Group
            $perminfo .= (($perms & 0x0020) ? 'r' : '-');
            $perminfo .= (($perms & 0x0010) ? 'w' : '-');
            $perminfo .= (($perms & 0x0008) ?
                        (($perms & 0x0400) ? 's' : 'x' ) :
                        (($perms & 0x0400) ? 'S' : '-'));

            // World
            $perminfo .= (($perms & 0x0004) ? 'r' : '-');
            $perminfo .= (($perms & 0x0002) ? 'w' : '-');
            $perminfo .= (($perms & 0x0001) ?
                        (($perms & 0x0200) ? 't' : 'x' ) :
                        (($perms & 0x0200) ? 'T' : '-'));
            $date = new DateTime;
            $date->setTimestamp($info['mtime']);
    
            echo $info['ino'], ' ', str_pad(($info['blocks']/2), 3, ' ', STR_PAD_LEFT), ' ', $perminfo, ' ',
                 $info['nlink'], ' ', $uname, ' ', $gname, ' ',
                 str_pad($info['size'], 10, ' ', STR_PAD_LEFT), ' ', $date->format('Y-m-d H:i'), ' ', $file, "\n";
        }
    }

    /**
     * @param string
     * @param string
     */
    protected function harvestInstDir($dest_prefix, $dirname, $instroot)
    {
        $defaultExtDir = PEAR2_Pyrus_Config::current()->defaultValue('ext_dir');
        $ext_dir = PEAR2_Pyrus_Config::current()->ext_dir;
        if ($ext_dir != $defaultExtDir) {
            $extReplace = $defaultExtDir;
        } else {
            $extReplace = '****';
        }
        $built_files = array();
        foreach (new \RecursiveIteratorIterator(
                    new \RecursiveDirectoryIterator($dirname,
                                                    0|\RecursiveDirectoryIterator::SKIP_DOTS)) as $file) {
            
            $built_files[] = array(
                        'file' => (string) $file,
                        'dest' => str_replace(
                                    $extReplace,
                                    $ext_dir,
                                    $dest_prefix . '/' . str_replace($dirname . DIRECTORY_SEPARATOR, '', $file)),
                        'packagexml_name' => substr($file, strlen($dirname) + 1),
    /* don't think we need this, but will reserve judgement until I hear from internals@
                        'php_api' => $this->php_api_version,
                        'zend_mod_api' => $this->zend_module_api_no,
                        'zend_ext_api' => $this->zend_extension_api_no,
    */
                        );
        }
        return $built_files;
    }

    /**
     * Build an extension from source.  Runs "phpize" in the source
     * directory, and compiles there.
     *
     * @param PEAR2_Pyrus_IPackage $pkg package object
     *
     * @param mixed $callback callback function used to report output,
     * see PEAR_Builder::_runCommand for details
     *
     * @return array an array of associative arrays with built files,
     * format:
     * array( array( 'file' => '/path/to/ext.so',
     *               'php_api' => YYYYMMDD,
     *               'zend_mod_api' => YYYYMMDD,
     *               'zend_ext_api' => YYYYMMDD ),
     *        ... )
     *
     * @access public
     *
     * @see PEAR_Builder::_runCommand
     */
    function build(PEAR2_Pyrus_Registry_Package_Base $pkg, $callback = null)
    {
        $config = PEAR2_Pyrus_Config::current();
        if (preg_match('/(\\/|\\\\|^)([^\\/\\\\]+)?php(.+)?$/',
                       $config->php_bin, $matches)) {
            if (isset($matches[2]) && strlen($matches[2]) &&
                trim($matches[2]) != trim($config->php_prefix)) {
                $this->log(0, 'WARNING: php_bin ' . $config->php_bin .
                           ' appears to have a prefix ' . $matches[2] . ', but' .
                           ' config variable php_prefix does not match');
            }
            if (isset($matches[3]) && strlen($matches[3]) &&
                trim($matches[3]) != trim($config->php_suffix)) {
                $this->log(0, 'WARNING: php_bin ' . $config->php_bin .
                           ' appears to have a suffix ' . $matches[3] . ', but' .
                           ' config variable php_suffix does not match');
            }
        }

        $this->current_callback = $callback;
        if ($pkg->isNewPackage()) {
            $dir = $config->src_dir . DIRECTORY_SEPARATOR .
                $pkg->channel . DIRECTORY_SEPARATOR . $pkg->name;
        } else {
            $dir = $config->src_dir . DIRECTORY_SEPARATOR . $pkg->name;
        }
        $this->buildDirectory = $dir;
        $old_cwd = getcwd();
        if (!file_exists($dir) || !is_dir($dir) || !chdir($dir)) {
            throw new PEAR2_Pyrus_PECLBuild_Exception('could not chdir to package directory ' . $dir);
        }
        if (!is_writable($dir)) {
            throw new PEAR2_Pyrus_PECLBuild_Exception('cannot build in package directory ' . $dir .
                                                      ', directory not writable');
        }
        $this->log(0, "cleaning build directory $dir");
        $this->_runCommand($config->php_prefix
                                . "phpize" .
                                $config->php_suffix . ' --clean',
                                null,
                                array('PATH' => $config->php_bin . ':' . getenv('PATH')));
        $this->log(0, "building in $dir");
        if (!$this->_runCommand($config->php_prefix
                                . "phpize" .
                                $config->php_suffix,
                                null, /*array($this, 'phpizeCallback'),*/
                                array('PATH' => $config->php_bin . ':' . getenv('PATH')))) {
            throw new PEAR2_Pyrus_PECLBuild_Exception('phpize failed - if running phpize manually from ' . $dir .
                                                      ' works, please open a bug for pyrus with details');
        }

        // {{{ start of interactive part
        $configure_command = "$dir/configure";
        if (count($pkg->configureoption)) {
            foreach ($pkg->configureoption as $o) {
                list($r) = $this->ui->ask($o->prompt, array(), $o->default);
                if (substr($o->name, 0, 5) == 'with-' &&
                    ($r == 'yes' || $r == 'autodetect')) {
                    $configure_command .= ' --' . $o->name;
                } else {
                    $configure_command .= ' --' . $o->name . '=' . trim($r);
                }
            }
        }
        // }}} end of interactive part

        $inst_dir = $dir . '/.install';
        $this->log(1, "building in $dir");
        if (!file_exists($inst_dir) && !mkdir($inst_dir, 0755, true) || !is_dir($inst_dir)) {
            throw new PEAR2_Pyrus_PECLBuild_Exception('could not create temporary install dir: ' . $inst_dir);
        }

        if (getenv('MAKE')) {
            $make_command = getenv('MAKE');
        } else {
            $make_command = 'make';
        }
        $to_run = array(
            $configure_command,
            $make_command,
            "$make_command INSTALL_ROOT=\"$inst_dir\" install",
            );
        if (!file_exists($dir) || !is_dir($dir) || !chdir($dir)) {
            throw new PEAR2_Pyrus_PECLBuild_Exception('could not chdir to ' . $dir);
        }
        $env = $_ENV;
        // this next line is modified by the installer at packaging time
        if ('@PEAR-VER@' == '@'.'PEAR-VER@') {
            // we're running from svn
            $env['PHP_PEAR_VERSION'] = '2.0.0a1';
        } else {
            $env['PHP_PEAR_VERSION'] = '@PEAR-VER@';
        }
        foreach ($to_run as $cmd) {
            try {
                if (!$this->_runCommand($cmd, $callback, $env)) {
                    throw new PEAR2_Pyrus_PECLBuild_Exception("`$cmd' failed");
                }
            } catch (\Exception $e) {
                chdir($old_cwd);
                throw $e;
            }
        }

        $this->listInstalledStuff($inst_dir);

        if (!file_exists('modules') || !is_dir('modules')) {
            chdir($old_cwd);
            throw new PEAR2_Pyrus_PECLBuild_Exception("no `modules' directory found");
        }
        $built_files = array();
        $prefix = exec($config->php_prefix
                        . "php-config" .
                       $config->php_suffix . " --prefix");
        $built_files = $this->harvestInstDir($prefix, $inst_dir . DIRECTORY_SEPARATOR . $prefix, $inst_dir);
        chdir($old_cwd);
        return $built_files;
    }

    /**
     * Message callback function used when running the "phpize"
     * program.  Extracts the API numbers used.  Ignores other message
     * types than "cmdoutput".
     *
     * @param string $what the type of message
     * @param mixed $data the message
     *
     * @return void
     *
     * @access public
     */
    /* don't think we need this, but will reserve judgement until I hear from internals@
    function phpizeCallback($what, $data)
    {
        if ($what != 'cmdoutput') {
            return;
        }
        $this->log(1, rtrim($data));
        if (preg_match('/You should update your .aclocal.m4/', $data)) {
            return;
        }
        $matches = array();
        if (preg_match('/^((?:[a-zA-Z]+ ?)+):\s+(\d+)/', $data, $matches)) {
            $member = preg_replace('/[^a-z]/', '_', strtolower($matches[1]));
            $apino = (int)$matches[2];
            if (isset($this->$member)) {
                $this->$member = $apino;
            }
        }
    }*/

    /**
     * Run an external command, using a message callback to report
     * output.  The command will be run through popen and output is
     * reported for every line with a "cmdoutput" message with the
     * line string, including newlines, as payload.
     *
     * @param string $command the command to run
     *
     * @param mixed $callback (optional) function to use as message
     * callback
     *
     * @return bool whether the command was successful (exit code 0
     * means success, any other means failure)
     *
     * @access private
     */
    function _runCommand($command, $callback = null, $env = null)
    {
        $this->log(1, "running: $command 2>&1");

        $exitcode = $this->system_with_timeout($command . ' 2>&1', $this->buildDirectory, $callback, $env);
        return ($exitcode == 0);
    }

    /**
     * Ported from PHP 5.3's run-tests.php
     */
    function system_with_timeout($commandline, $cwd, $callback = null, $env = null, $stdin = null, $timeout = 60)
    {
        $data = '';

        $bin_env = array();
        foreach((array)$env as $key => $value) {
            $bin_env[(binary)$key] = (binary)$value;
        }

        $proc = proc_open($commandline, array(
            0 => array('pipe', 'r'),
            1 => array('pipe', 'w'),
            2 => array('pipe', 'w')
            ), $pipes, $cwd, $bin_env, array('suppress_errors' => true, 'binary_pipes' => true));

        if (!$proc) {
            return false;
        }

        if (!is_null($stdin)) {
            fwrite($pipes[0], (binary) $stdin);
        }
        fclose($pipes[0]);

        while (true) {
            /* hide errors from interrupted syscalls */
            $r = $pipes;
            $w = null;
            $e = null;

            $n = @stream_select($r, $w, $e, $timeout);

            if ($n === false) {
                break;
            } else if ($n === 0) {
                /* timed out */
                proc_terminate($proc);
                throw new PEAR2_Pyrus_PECLBuild_Exception('Error: Process timed out');
            } else if ($n > 0) {
                $called = false;
                while ($line = fgets($pipes[1], 1024)) {
                    $called = true;
                    if ($callback) {
                        call_user_func($callback, 'cmdoutput', $line);
                    } else {
                        $this->log(0, rtrim($line));
                    }
                }
                if (!$called) {
                    break;
                }
            }
        }

        $stat = proc_get_status($proc);

        if ($stat['signaled']) {
            $code = proc_close($proc);
            throw new PEAR2_Pyrus_PECLBuild_Exception('Process was stopped with a signal: ' . $stat['stopsig']);
        }

        $code = proc_close($proc);
        $code = $stat['exitcode'];
        return $code;
    }

    function log($level, $msg)
    {
        if ($this->current_callback) {
            call_user_func($this->current_callback, 'output', $msg);
            return;
        }
        return PEAR2_Pyrus_Log::log($level, $msg);
    }
}<?php
function __autoload($class)
{
    if (substr($class, 0, 4) != 'PEAR') return false;
    $path = explode('_', substr($class, 11)); // strip PEAR2_Pyrus for CVS
    $path = dirname(__FILE__) . implode('\\', $path) . '.php';
    include $path;
}
include $a = 'C:/development/PEAR2/Exception/trunk/src/Exception.php';
include $b = 'C:/development/PEAR2/MultiErrors/trunk/src/MultiErrors.php';
include 'C:/development/PEAR2/MultiErrors/trunk/src/MultiErrors/Exception.php';
//include 'C:/development/PEAR2/Pyrus_Developer/src/Developer/PackageFile/PEAR2SVN.php';
//include 'C:/development/PEAR2/Pyrus_Developer/src/Developer/PackageFile/PEAR2SVN/Filter.php';
//include 'C:/development/PEAR2/Pyrus_Developer/src/Developer/PackageFile/v2.php';
//new PEAR2_Pyrus_Developer_PackageFile_PEAR2SVN(
//    'C:/development/PEAR2/Autoload', 'PEAR2_Autoload', 'pear2.php.net',
//        false, false);
////    'C:/development/PEAR2/Pyrus', 'PEAR2_Pyrus', 'pear2.php.net');
//new PEAR2_Pyrus_Package('C:/development/PEAR2/Pyrus_Developer/package.xml');
//exit;
//include 'C:/development/PEAR2/HTTP/Request/src/HTTP/Request/allfiles.php';
//include 'C:/development/PEAR2/Pyrus_Developer/Creator/Zip.php';
//include 'C:/development/PEAR2/Pyrus_Developer/Creator/Tar.php';
//include 'C:/development/PEAR2/Pyrus_Developer/Creator/Xml.php';
//include 'C:/development/PEAR2/Pyrus_Developer/Creator/Exception.php';
//$a = new PEAR2_Pyrus_Package_Creator(array(
//        new PEAR2_Pyrus_Developer_Creator_Zip('C:/development/PEAR2/blah.zip'),
//        new PEAR2_Pyrus_Developer_Creator_Tar('C:/development/PEAR2/blah.tgz'),
//        new PEAR2_Pyrus_Developer_Creator_Xml('C:/development/PEAR2/blah.xml'),
//    ), $a, 'C:/development/PEAR2/Autoload/Autoload.php', $b);
//$b = new PEAR2_Pyrus_Package('C:/development/pear-core/PEAR-1.6.0.tgz');
//$a->render($b);
//exit;
//$pf = new PEAR2_Pyrus_PackageFile_v2;
//$pf->name = 'test';
//$pf->channel = 'pear.php.net';
//$pf->summary = 'test';
//$pf->description = 'testing';
//$pf->maintainer['cellog']->name('Greg Beaver')->role('lead')->email('cellog@php.net')
//    ->active('yes');
//$a = new DateTime();
//$pf->date = $a->format('Y-m-d');
//$pf->version['release'] = '1.0.0';
//$pf->version['api'] = '1.0.0';
//$pf->stability['release'] = 'stable';
//$pf->stability['api'] = 'stable';
//$pf->license = 'PHP License';
//$pf->notes = 'test';
//$pf->dependencies->required->php = array('min' => '5.2.0');
//$pf->dependencies->required->pearinstaller = array('min' => '5.2.0', 'exclude' => '1.2.3');
//$pf->files['test/me.php'] = array('attribs' => array('role' => 'php'));
//$pf = new PEAR2_Pyrus_package(dirname(__FILE__) . '/test.xml');
//foreach ($pf->packagingcontents as $name => $file) {
//    var_dump($name, $file);
//}
//exit;
define('OS_WINDOWS', true);
define('OS_UNIX', false);
$g = PEAR2_Pyrus_Config::singleton('C:/development/pear-core/testpear');
//$g = new PEAR2_Pyrus_Config('/home/cellog/testpear');
try {
    PEAR2_Pyrus_Installer::$options['force'] = true;
    PEAR2_Pyrus_Installer::begin();
    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('C:/development/PEAR2/Autoload/trunk/package.xml'));
    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('C:/development/PEAR2/Exception/trunk/package.xml'));
    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('C:/development/PEAR2/MultiErrors/trunk/package.xml'));
    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('C:/development/PEAR2/Pyrus_Developer/package.xml'));
//    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('C:/development/PEAR2/Pyrus/trunk/pyrus.phar'));
    PEAR2_Pyrus_Installer::prepare(new PEAR2_Pyrus_Package('C:/development/PEAR2/Pyrus/trunk/package.xml'));
    PEAR2_Pyrus_Installer::commit();
} catch (Exception $e) {
    PEAR2_Pyrus_Installer::rollback();
    echo $e;
}
exit;
<?php
/**
 * PEAR2_Pyrus_ChannelFile
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Base class for a PEAR2 package file
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_ChannelFile implements PEAR2_Pyrus_IChannelFile
{
    protected $info;
    public $path;

    /**
     * Take a local channel.xml and parse it.
     * @param string file name, or xml string
     */
    function __construct($file, $isxml = false, $isremote = false)
    {
        $this->path = $file;
        $parser = new PEAR2_Pyrus_ChannelFile_Parser_v1;
        if ($isxml) {
            $data = $file;
        } elseif ($isremote) {
            if (strpos($file, 'http://') === 0
                || strpos($file, 'https://') === 0) {
                $data = $this->_fromURL($file);
            } else {
                try {
                    $xml_url = 'https://' . $file . '/channel.xml';
                    $data = $this->_fromURL($xml_url);
                } catch (\Exception $e) {
                    // try insecure
                    try {
                        $xml_url = 'http://' . $file . '/channel.xml';
                        $data = $this->_fromURL($xml_url);
                    } catch (\Exception $e2) {
                        // failed, re-throw original error
                        throw $e;
                    }
                }
            }
        } else {
            $data = @file_get_contents($file);
        }
        if ($data === false || empty($data)) {
            throw new PEAR2_Pyrus_ChannelFile_Exception('Unable to open channel xml file '
                . $file . ' or file was empty.');
        }
        $this->info = $parser->parse($data);
    }

    function __get($var)
    {
        return $this->info->$var;
    }
    
    function __set($var, $value)
    {
        $this->info->$var = $value;
    }
    
    function __call($func, $args)
    {
        // delegate to the internal object
        if (!is_callable(array($this->info, $func))) {
            throw new PEAR2_Pyrus_ChannelFile_Exception('unknown method: ' . @get_class($this->info) . '::' .
                                                        $func);
        }
        return call_user_func_array(array($this->info, $func), $args);
    }
    
    function __toString()
    {
        return $this->info->__toString();
    }

    /**
     * Attempts to get the xml from the URL specified.
     * 
     * @param string $xml_url URL to the channel xml http://pear.php.net/channel.xml
     * 
     * @return string Channel XML
     */
    protected function _fromURL($xml_url)
    {
        $http = new PEAR2_HTTP_Request($xml_url);
        $response = $http->sendRequest();
        return $response->body;
    }
}
<?php
/**
 * Extension to PEAR2_Console_CommandLine
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * This class serves one purpose, removing the exit() call from displayUsage()
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_ScriptFrontend extends PEAR2_Console_CommandLine
{
    public function addCommand($name, $params=array())
    {
        if ($name instanceof PEAR2_Pyrus_ScriptFrontend_Command) {
            $command = $name;
        } else {
            $params['name'] = $name;
            $command        = new PEAR2_Pyrus_ScriptFrontend_Command($params);
        }
        $command->parent                = $this;
        $this->commands[$command->name] = $command;
        return $command;
    }

    /**
     * Display the usage help message to the user, but don't exit
     *
     * @param int $exitCode the exit code number
     *
     * @return void
     * @access public
     */
    public function displayUsage($exitCode = 1)
    {
        echo "\n", $this->renderer->usage();
    }
}<?php
/**
 * PEAR2_Pyrus_Uninstaller
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Pyrus Uninstaller class
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Uninstaller
{
    /**
     * Flag that determines the behavior of {@link begin()}
     *
     * If true, begin() will do nothing.  If false, then
     * {@link self::$installPackages} will be reset to an empty array
     * @var bool
     */
    protected static $inTransaction = false;
    /**
     * Packages that will be uninstalled
     *
     * This list is used when {@link commit()} is called to determine
     * the packages to install
     * @var array
     */
    protected static $uninstallPackages = array();

    /**
     * Packages that were uninstalled
     *
     * This list is used when {@link rollback()} is called to determine
     * the packages that should be restored
     * @var array
     */
    protected static $uninstalledPackages = array();

    /**
     * Packages that have been installed and also successfully registered as uninstalled
     *
     * This list is used when {@link rollback()} is called to determine
     * the packages that should be removed from the registry
     * @var array
     */
    protected static $registeredPackages = array();


    /**
     * Installer options.  Valid indices are:
     *
     * - ignore_errors
     * @var array
     */
    public static $options = array();
    /**
     * Prepare uninstallation of packages
     */
    static function begin()
    {
        if (!self::$inTransaction) {
            self::$uninstallPackages = array();
            self::$uninstalledPackages = array();
            self::$inTransaction = true;
        }
    }

    /**
     * Add a package to the list of packages to be removed
     *
     * This function checks to see if an identical package is already being downloaded,
     * and manages removing duplicates or erroring out on a conflict
     * @param PEAR2_Pyrus_Package $package
     */
    static function prepare($packageName)
    {
        try {
            $package = PEAR2_Pyrus_Config::current()->registry->package[$packageName];
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_Uninstaller_Exception('Invalid package name ' .
                                                        $packageName, $e);
        }
        if (isset(self::$uninstallPackages[$package->channel . '/' . $package->name])) {
            return;
        }
        self::$uninstallPackages[$package->channel . '/' . $package->name] = $package;
        return $package;
    }

    /**
     * Cancel installation
     */
    static function rollback()
    {
        if (self::$inTransaction) {
            self::$inTransaction = false;
            $reg = PEAR2_Pyrus_Config::current()->registry;
            $err = new PEAR2_MultiErrors;
            foreach (self::$registeredPackages as $package) {
                try {
                    $reg->uninstall($package[0]->name, $package[0]->channel);
                    if ($package[1]) {
                        $reg->install($package[1]);
                    }
                } catch (Exception $e) {
                    $err->E_ERROR[] = $e;
                }
            }
            self::$uninstallPackages = array();
            self::$uninstalledPackages = array();
            self::$registeredPackages = array();
            if (count($err)) {
                throw new PEAR2_Pyrus_Installer_Exception('Could not successfully rollback', $err);
            }
        }
    }

    /**
     * Install packages slated for installation during transaction
     */
    static function commit()
    {
        if (!self::$inTransaction) {
            return false;
        }
        try {
            $installer = new PEAR2_Pyrus_Uninstaller;
            // validate dependencies
            $errs = new PEAR2_MultiErrors;
            foreach (self::$uninstallPackages as $package) {
                $package->validateUninstallDependencies(self::$uninstallPackages, $errs);
            }
            if (count($errs->E_ERROR)) {
                throw new PEAR2_Pyrus_Installer_Exception('Dependency validation failed ' .
                    'for some installed packages, installation aborted', $errs);
            }
            // create dependency connections and load them into the directed graph
            $graph = new PEAR2_Pyrus_DirectedGraph;
            foreach (self::$uninstallPackages as $package) {
                $package->makeUninstallConnections($graph, self::$uninstallPackages);
            }
            // topologically sort packages and install them via iterating over the graph
            PEAR2_Pyrus_AtomicFileTransaction::begin();
            $actual = array();
            foreach ($graph as $package) {
                $actual[] = $package;
            }
            $reg = PEAR2_Pyrus_Config::current()->registry;
            // easy reverse topological sort
            array_reverse($actual);
            foreach ($actual as $package) {
                $installer->uninstall($package, $reg);
                self::$uninstalledPackages[] = $package;
            }
            $dirtrees = array();
            foreach (self::$uninstalledPackages as $package) {
                $dirtrees[] = $reg->info($package->name, $package->channel, 'dirtree');
                $previous = $reg->toPackageFile($package->name, $package->channel, true);
                self::$registeredPackages[] = array($package, $previous);
                $reg->uninstall($package->name, $package->channel);
            }
            PEAR2_Pyrus_AtomicFileTransaction::rmEmptyDirs($dirtrees);
            PEAR2_Pyrus_AtomicFileTransaction::commit();
            PEAR2_Pyrus_AtomicFileTransaction::removeBackups();
            self::$uninstallPackages = array();
            PEAR2_Pyrus_Config::current()->saveConfig();
        } catch (Exception $e) {
            self::rollback();
            throw $e;
        }
    }

    /**
     * Uninstall a package
     *
     * Remove files
     * @param PEAR2_Pyrus_Package $package
     */
    function uninstall(PEAR2_Pyrus_IPackageFile $package, PEAR2_Pyrus_IRegistry $reg)
    {
        if (!empty($this->_options['register-only'])) {
            // pretty much nothing happens if we are only registering the install
            return;
        }
        try {
            $config = new PEAR2_Pyrus_Config_Snapshot($package->date . ' ' . $package->time);
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_Installer_Exception('Cannot retrieve files, config ' .
                                    'snapshot could not be processed', $e);
        }
        $configpaths = array();
        foreach (PEAR2_Pyrus_Installer_Role::getValidRoles($package->getPackageType()) as $role) {
            // set up a list of file role => configuration variable
            // for storing in the registry
            $roleobj =
                PEAR2_Pyrus_Installer_Role::factory($package->getPackageType(), $role);
            $configpaths[$role] = $config->{$roleobj->getLocationConfig()};
        }
        $ret = array();
        foreach ($reg->info($package->name, $package->channel, 'installedfiles') as $file) {
            $transact = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject($file['configpath']);
            $transact->removePath($file['relativepath']);
        }
    }
}
<?php
/**
 * Basic requirement for implementing a packagefile
 */
interface PEAR2_Pyrus_IPackageFile
{
    function __get($var);
    function __set($var, $value);
    function __toString();
    function toArray($forpackaging = false);
    function getValidator();
}
<?php
/**
 * PEAR2_Pyrus_PackageFile
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Base class for a PEAR2 package file
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PackageFile
{
    public $info;
    public $path;
    function __construct($package, $class = 'PEAR2_Pyrus_PackageFile_v2', $isstring = false)
    {
        if ($package instanceof PEAR2_Pyrus_IPackageFile) {
            $this->path = $package->getFilePath();
            return $this->info = $package;
        }
        $this->path = $package;
        $parser = new PEAR2_Pyrus_PackageFile_Parser_v2;
        if ($isstring) {
            $data = $package;
        } else {
            $data = file_get_contents($package);
        }
        if ($data === false || empty($data)) {
            throw new PEAR2_Pyrus_PackageFile_Exception('Unable to open package xml file '
                . $package . ' or file was empty.');
        }
        $this->info = $parser->parse($data, $package, $class);
    }

    function __toString()
    {
        return $this->info->__toString();
    }

    function getValidator()
    {
        return $this->info->getValidator();
    }

    function getPackageFileObject()
    {
        return $this->info;
    }
}
<?php
/**
 * PEAR2_Pyrus_XMLWriter
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Process an array, and serialize it into XML
 *
 * @category   PEAR2
 * @package    PEAR2_Pyrus
 * @subpackage XML
 * @author     Greg Beaver <cellog@php.net>
 * @copyright  2008 The PEAR Group
 * @license    http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link       http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_XMLWriter
{
    private $_array;
    private $_state;
    /**
     * @var XMLWriter
     */
    private $_writer;
    private $_iter;
    private $_tagStack;
    private $_namespaces;
    private $_tag;
    private $_expectedDepth;
    private $_type;
    private $_lastkey;
    
    /**
     * Construct a new xml writer object.
     * <code>
     * $xmlarray = array('channel'=>array('name'=>'pear2.php.net'));
     * $channel = new PEAR2_Pyrus_XMLWriter($xmlarray);
     * </code>
     * 
     * @param array $array Array representing the XML data.
     */
    function __construct(array $array)
    {
        if (count($array) != 1) {
            throw new PEAR2_Pyrus_XMLWriter_Exception('Cannot serialize array to' .
                'XML, array must have exactly 1 element');
        }
        $this->_array  = $array;
        $this->_writer = new XMLWriter;
    }

    /**
     * Return the raw xml string representation.
     * 
     * @return string
     */
    function __toString()
    {
        $this->_writer->openMemory();
        return $this->_serialize();
    }

    function toFile($file)
    {
        $this->_writer->openUri($file);
        return $this->_serialize();
    }

    private function _pushState()
    {
        $this->_state[] = array($this->_type, $this->_tag, $this->_expectedDepth,
            $this->_namespaces);
    }

    private function _popState()
    {
        $save = $this->_namespaces;
        
        list($this->_type, $this->_tag, $this->_expectedDepth, $this->_namespaces) =
            array_pop($this->_state);
        foreach ($save as $ns) {
            if (!isset($this->_namespaces[$ns])) {
                // all namespaces must exist - only overriding is allowed
                $this->_namespaces = $save;
                return;
            }
        }
    }

    private function _finish($key, $values)
    {
        switch ($this->_type) {
        case 'Attribs' :
                $this->_popState();
                return false;
        case 'Tag' :
                $this->_popState();
                $this->_writer->endElement();
                return false;
        case 'Sibling' :
                $this->_popState();
                return false;
        }
    }

    private function _startElement($key, $values)
    {
        // new element
        if (strpos($key, ':')) {
            // namespaced element
            list($ns, $element) = explode(':', $key);
        }
        if (isset($element) && !isset($this->_namespaces[$ns])) {
            if (is_string($values)) {
                if (strlen($values)) {
                    $this->_writer->writeElementNs($ns, $element, $this->_namespaces[$ns], $values);
                } else {
                    $this->_writer->writeElementNs($ns, $element, $this->_namespaces[$ns]);
                }
            } else {
                $this->_writer->startElementNs($ns, $element, $this->_namespaces[$ns]);
            }
        } else {
            if (is_string($values) || is_int($values)) {
                if (strlen($values)) {
                    $this->_writer->writeElement($key, $values);
                } else {
                    $this->_writer->writeElement($key);
                }
            } else {
                $this->_writer->startElement($key);
            }
        }
    }

    /**
     * Handle an individual tag/element in the XML
     * 
     * @param mixed $key    The key for this element.
     * @param mixed $values The contents of this tag/element.
     */
    private function _handleTag($key, $values)
    {
        if (is_int($key)) {
            $this->_type          = 'Sibling';
            $this->_expectedDepth = $this->_iter->getDepth();
            $this->_pushState();
            // handle sibling tags
            return '_handleSibling';
        }
        $this->_startElement($key, $values);
        if (!is_string($values)) {
            $this->_expectedDepth = $this->_iter->getDepth();
            $this->_pushState();
            $this->_tag = $key;
        }
        // cycle to next key
        return false;
    }

    private function _handleSibling($key, $values)
    {
        if (is_int($key) && $this->_iter->getDepth() == $this->_expectedDepth) {
            if ($key) {
                $this->_startElement($this->_tag, $values);
                if (!is_string($values)) {
                    $this->_pushState();
                }
            } else {
                if (is_string($values)) {
                    $this->_writer->text($values);
                    $this->_writer->endElement();
                }
            }
        }
        if (!is_string($values)) {
            $this->_type          = 'Tag';
            $this->_expectedDepth = $this->_iter->getDepth() + 1;
            // handle internal tags
        }
        // cycle to next key
        return false;
    }

    private function _handleAttribs($key, $values)
    {
        // xmlwriter converts these to &#10; and &#13;.  Bad.
        $values = str_replace(array("\n","\r"), array('', ''), $values);
        if (strpos($key, ':')) {
            // namespaced
            list($ns, $attr) = explode(':', $key);
            if ($ns == 'xmlns' || isset($this->_namespaces[$ns])) {
                if ($ns == 'xmlns') {
                    // new namespace declaration
                    $this->_namespaces[$attr] = $values;
                }
                $this->_writer->writeAttribute($key, $values);
            } else {
                $this->_writer->writeAttributeNS($ns, $attr, $values, $values);
            }
        } else { // default namespace
            $this->_writer->writeAttribute($key, $values);
        }
        // cycle to next key
        return false;
    }

    /**
     * @access private
     * 
     * @return bool
     */
    public static function _filter($a)
    {
        if ($a === false) {
            return false;
        }
        return true;
    }

    /**
     * Utilize custom serialization for XMLWriter object, to convert object
     * to SQL.
     * 
     * @return string
     */
    private function _serialize()
    {
        $this->_writer->setIndent(true);
        $this->_writer->setIndentString(' ');
        $this->_writer->startDocument('1.0', 'UTF-8');
        $this->_namespaces    = array();
        $this->_tagStack      = array();
        $this->_state         = array();
        $this->_type          = 'Tag';
        $this->_expectedDepth = 0;
        $this->_lastkey       = array();
        $lastdepth            = 0;
        foreach ($this->_iter = new RecursiveIteratorIterator(
                        new RecursiveArrayIterator($this->_array),
                        RecursiveIteratorIterator::SELF_FIRST) as $key => $values) {
            $depth = $this->_iter->getDepth();
            while ($depth < $this->_expectedDepth) {
                // finished with this tag
                $this->_finish($key, $values);
                $lastdepth--;
            }
            if (isset($this->_lastkey[$depth]) && $key != $this->_lastkey[$depth]) {
                while ($lastdepth > $depth) {
                    $this->_finish($key, $values);
                    $lastdepth--;
                }
            }
            $this->_lastkey[$depth] = $key;
            foreach ($this->_lastkey as $d => &$k) {
                if ($d > $depth) {
                    $k = false;
                }
            }
            $this->_lastkey = array_filter($this->_lastkey,
                array('PEAR2_Pyrus_XMLWriter', '_filter'));
            $lastdepth = $depth;
            if ($this->_type !== 'Attribs') {
                if ($key === '_content') {
                    $this->_writer->text($values);
                    continue;
                }
                if ($key === 'attribs') {
                    // attributes are 1 depth higher
                    $this->_pushState();
                    $this->_expectedDepth = $this->_iter->getDepth() + 1;
                    $this->_type          = 'Attribs';
                    // cycle to first attribute
                    continue;
                }
            }
            $next = '_handle' . $this->_type;
            while ($next = $this->{$next}($key, $values));
        }
        while ($lastdepth) {
            $this->_finish($key, $values);
            $lastdepth--;
        }
        $this->_writer->endDocument();
        return $this->_writer->flush();
    }
}<?php
/**
 * PEAR2_Pyrus_Log
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Standard logging class for Pyrus
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Log
{
    static public $log = array();
    static public $maxlevel = 7;
    static protected $observers = array();
    static public function log($level, $message)
    {
        if (count(self::$observers)) {
            foreach (self::$observers as $observer) {
                $observer->log($level, $message);
            }
        }
        for ($i = $level; $i <= self::$maxlevel; $i++) {
            self::$log[$i][] = $message;
        }
    }

    static public function attach(PEAR2_Pyrus_ILog $observer)
    {
        self::$observers[spl_object_hash($observer)] = $observer;
    }

    static public function detach(PEAR2_Pyrus_ILog $observer)
    {
        unset(self::$observers[spl_object_hash($observer)]);
    }
}<?php
/**
 * <tasks:replace> - read/write version
 *
 * PHP versions 4 and 5
 *
 * LICENSE: This source file is subject to version 3.0 of the PHP license
 * that is available through the world-wide-web at the following URI:
 * http://www.php.net/license/3_0.txt.  If you did not receive a copy of
 * the PHP License and are unable to obtain it through the web, please
 * send a note to license@php.net so we can mail you a copy immediately.
 *
 * @category   pear
 * @package    PEAR
 * @author     Greg Beaver <cellog@php.net>
 * @copyright  1997-2006 The PHP Group
 * @license    http://www.php.net/license/3_0.txt  PHP License 3.0
 * @version    CVS: $Id: rw.php,v 1.1 2006/12/28 20:42:32 cellog Exp $
 * @link       http://pear.php.net/package/PEAR
 * @since      File available since Release 1.4.0a10
 */
/**
 * Base class
 */
require_once 'PEAR/Task/Replace.php';
/**
 * Abstracts the replace task xml.
 * @category   pear
 * @package    PEAR
 * @author     Greg Beaver <cellog@php.net>
 * @copyright  1997-2006 The PHP Group
 * @license    http://www.php.net/license/3_0.txt  PHP License 3.0
 * @version    Release: @package_version@
 * @link       http://pear.php.net/package/PEAR
 * @since      Class available since Release 1.4.0a10
 */
class PEAR_Task_Replace_rw extends PEAR_Task_Replace
{
    function PEAR_Task_Replace_rw(&$pkg, &$config, &$logger, $fileXml)
    {
        parent::PEAR_Task_Common($config, $logger, PEAR_TASK_PACKAGE);
        $this->_contents = $fileXml;
        $this->_pkg = &$pkg;
        $this->_params = array();
    }

    function validate()
    {
        return $this->validateXml($this->_pkg, $this->_params, $this->config, $this->_contents);
    }

    function setInfo($from, $to, $type)
    {
        $this->_params = array('attribs' => array('from' => $from, 'to' => $to, 'type' => $type));
    }

    function getName()
    {
        return 'replace';
    }

    function getXml()
    {
        return $this->_params;
    }
}
?><?php
/**
 * PEAR2_Pyrus_Task_MultipleProxy, container for multiple tasks to be executed
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
/**
 * A container for multiple tasks
 *
 * This is used when a file contains multiple copies of the same task name,
 * such as multiple <tasks:replace> tags
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Task_MultipleProxy extends \ArrayObject implements \IteratorAggregate, \SplObserver
{
    protected $name;
    protected $parent;
    protected $fileattribs;
    /**
     * @param PEAR2_Pyrus_IPackage|PEAR2_Pyrus_IPackageFile
     * @param array a group of tasks
     */
    function __construct($parent, array $tasks, $fileattribs, $name)
    {
        $this->parent = $parent;
        $this->name = $name;
        $this->fileattribs = $fileattribs;
        parent::__construct($tasks);
        foreach ($tasks as $task) {
            $task->attach($this);
        }
    }

    /**
     * Begin a task processing session.  All multiple tasks will be processed after each file
     * has been successfully installed, all simple tasks should perform their task here and
     * return any errors using the custom throwError() method to allow forward compatibility
     *
     * This method MUST NOT write out any changes to disk
     * @param PEAR_Pyrus_IPackageFile
     * @param resource open file pointer, set to the beginning of the file
     * @param string the eventual final file location (informational only)
     * @return string|false false to skip this file, otherwise return the new contents
     * @throws PEAR2_Pyrus_Task_Exception on errors, throw this exception
     * @abstract
     */
    function startSession($fp, $dest)
    {
        foreach ($this as $task) {
            $task->startSession($fp, $dest);
            if (!rewind($fp)) {
                throw new PEAR2_Pyrus_Task_Exception('task ' . $this->name .
                                                          ' closed the file pointer, invalid task');
            }
        }
    }

    function isPreProcessed()
    {
        foreach ($this as $task) {
            if (!$task->isPreProcessed()) {
                return false;
            }
        }
        return true;
    }

    /**
     * Iterate over each task and aggregate their content, then pass it to the parent
     * package object
     */
    function getInfo()
    {
        $ret = array();
        foreach ($this as $task) {
            $ret[] = $task->getInfo();
        }
        if (count($ret) == 1) {
            $ret = $ret[0];
        }
        return $ret;
    }

    function add()
    {
        $task = str_replace('-', ' ', $this->name);
        $task = str_replace(' ', '/', ucwords($task));
        $task = str_replace('/', '_', $task);
        $c = 'PEAR2_Pyrus_Task_' . $task;
        $ret = new $c($this->parent, PEAR2_Pyrus_Validate::NORMAL, array(), $this->fileattribs, null);
        $this[] = $ret;
        $ret->attach($this);
        return $ret;
    }

    function update(SplSubject $subject)
    {
        $ret = $subject->getInfo();
        if (empty($ret)) {
            foreach ($this as $i => $task) {
                if ($subject === $task) {
                    unset($this[$i]);
                    $this->exchangeArray(array_values($this->getArrayCopy()));
                    break;
                }
            }
        }
        $this->parent->files[$this->fileattribs['name']]->{$this->name} = $this;
    }
}
?><?php
/**
 * PEAR_Task_Common, base class for installer tasks
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
/**
 * A task is an operation that manipulates the contents of a file.
 *
 * Simple tasks operate on 1 file.  Multiple tasks are executed after all files have been
 * processed and installed, and are designed to operate on all files containing the task.
 * The Post-install script task simply takes advantage of the fact that it will be run
 * after installation, replace is a simple task.
 *
 * Combining tasks is possible, but ordering is significant.
 *
 * <file name="test.php" role="php">
 *  <tasks:replace from="@data-dir@" to="data_dir" type="pear-config"/>
 *  <tasks:postinstallscript/>
 * </file>
 *
 * This will first replace any instance of @data-dir@ in the test.php file
 * with the path to the current data directory.  Then, it will include the
 * test.php file and run the script it contains to configure the package post-installation.
 *
 * The observer pattern is used, so that updates from a MultipleProxy from one
 * member task can be used to save changes to the parent file object.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
abstract class PEAR2_Pyrus_Task_Common extends \ArrayObject implements \SplSubject
{
    const PACKAGE = 1;
    const INSTALL = 2;
    const PACKAGEANDINSTALL = 3;
    const POSTINSTALL = 4; // this is used by post-install scripts
    /**
     * Valid types for this version are 'simple' and 'multiple'
     *
     * - simple tasks operate on the contents of a file and write out changes to disk
     * - multiple tasks operate on the contents of many files and write out the
     *   changes directly to disk
     *
     * Child task classes must override this property.
     * @access protected
     */
    const TYPE = 'simple';
    /**
     * Determines which install phase this task is executed under
     */
    const PHASE = PEAR2_Pyrus_Task_Common::INSTALL;
    /**
     * @param PEAR_Config
     * @param PEAR_Common
     */

    static $multiple = array();

    protected $installphase;
    protected $xml;
    protected $taskAttributes;
    protected $lastVersion;
    protected $pkg;
    protected $observers = array();

    /**
     * Initialize a task instance with the parameters
     * @param PEAR2_Pyrus_Package|PEAR2_Pyrus_IPackageFile package information
     * @param int install phase
     * @param array raw, parsed xml
     * @param array attributes from the <file> tag containing this task
     * @param string|null last installed version of this package
     */
    function __construct($pkg, $phase, $xml, $attribs, $lastversion)
    {
        $this->pkg = $pkg;
        $this->installphase = $phase;
        $this->xml = $xml;
        $this->taskAttributes = $attribs;
        $this->lastVersion = $lastversion;
        if (static::TYPE == 'multiple') {
            self::$multiple[get_class($this)][] = $this;
        }
    }

    /**
     * Validate the basic contents of a task tag.
     *
     * On error, one of the PEAR2_Pyrus_Task_Exception_* exceptions should be thrown.
     *
     *  - {@link PEAR2_Pyrus_Task_Exception_NoAttributes}: use this exception for
     *    missing attributes that should be present.
     *  - {@link PEAR2_Pyrus_Task_Exception_MissingAttribute}: use this exception
     *    for a specific missing attribute.
     *  - {@link PEAR2_Pyrus_Task_Exception_WrongAttributeValue}: use this
     *    exception for an incorrect value for an attribute.
     *  - {@link PEAR2_Pyrus_Task_Exception_InvalidTask}: use this exception for
     *    general validation errors
     *
     * It is also possible to throw multiple validation errors, by using a
     * {@link PEAR2_MultiErrors} object as a cause parameter to
     * {@link PEAR2_Pyrus_Task_Exception}.
     * @param PEAR_Pyrus_IPackageFile
     * @param array
     * @param array the entire parsed <file> tag
     * @param string the filename of the package.xml
     * @throws PEAR2_Pyrus_Task_Exception
     * @throws PEAR2_Pyrus_Task_Exception_NoAttributes
     * @throws PEAR2_Pyrus_Task_Exception_MissingAttribute
     * @throws PEAR2_Pyrus_Task_Exception_WrongAttributeValue
     * @throws PEAR2_Pyrus_Task_Exception_InvalidTask
     * @abstract
     */
    static function validateXml(PEAR2_Pyrus_IPackage $pkg, $xml, $fileXml, $file)
    {
    }

    /**
     * Begin a task processing session.  All multiple tasks will be processed after each file
     * has been successfully installed, all simple tasks should perform their task here and
     * return any errors using the custom throwError() method to allow forward compatibility
     *
     * This method MUST NOT write out any changes to disk
     * @param PEAR_Pyrus_IPackageFile
     * @param resource open file pointer, set to the beginning of the file
     * @param string the eventual final file location (informational only)
     * @return string|false false to skip this file, otherwise return the new contents
     * @throws PEAR2_Pyrus_Task_Exception on errors, throw this exception
     * @abstract
     */
    function startSession($fp, $dest)
    {
    }

    function setupPostInstall()
    {
    }

    /**
     * This method is used to process each of the tasks for a particular multiple class
     * type.  Simple tasks need not implement this method.
     * @param array an array of tasks
     * @access protected
     * @static
     * @abstract
     */
    function run($tasks)
    {
    }

    final static function hasPostinstallTasks()
    {
        return count(self::$multiple);
    }

    final static function runPostinstallTasks()
    {
        foreach (self::$multiple as $class => $tasks) {
            $class::run(self::$multiple[$class]);
        }
        self::$multiple[$class] = array();
    }

    function isPreProcessed()
    {
        return false;
    }

    function getInfo()
    {
        return $this->xml;
    }

    function attach(SplObserver $observer)
    {
        $this->observers[] = $observer;
    }

    function detach(SplObserver $observed)
    {
        foreach ($this->observers as $i => $observer) {
            if ($observer === $observed) {
                unset($this->observers[$i]);
                $this->observers = array_values($this->observers);
                return;
            }
        }
    }

    function notify()
    {
        foreach ($this->observers as $observer) {
            $observer->update($this);
        }
    }
}
?><?php
/**
 * <tasks:postinstallscript> paramgroup param object
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Implements the postinstallscript file task <param> tag
 *
 * Sample usage:
 *
 * <code>
 * $task->paramgroup['nameid']->instructions('hi there')
 *  ->condition($task->paramgroup['previous']->param['paramname'], '>=', '25')
 *  ->param['paramname']->prompt('blah')->type('string')->defaultValue('hi');
 * </code>
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Task_Postinstallscript_Paramgroup_Param implements ArrayAccess, Iterator, Countable
{
    protected $info;
    protected $index = null;
    protected $parent;
    protected $tasksNs;

    function __construct($tasksNs, $parent, array $info, $index = null)
    {
        if ($tasksNs) {
            if ($tasksNs[strlen($tasksNs)-1] != ':') {
                $tasksNs .= ':';
            }
        } else {
            $tasksNs = '';
        }
        $this->tasksNs = $tasksNs;
        $this->parent = $parent;
        $this->info = $info;
        $this->index = $index;
    }

    function count()
    {
        return count($this->info);
    }

    function current()
    {
        $i = key($this->info);
        foreach (array('name', 'prompt', 'type', 'default') as $key) {
            if (!array_key_exists($this->tasksNs . $key, $this->info[$i])) {
                $this->info[$i][$this->tasksNs . $key] = null;
            }
        }
        return new self($this->tasksNs, $this, $this->info[$i], $i);
    }

    function rewind()
    {
        reset($this->info);
    }

    function key()
    {
        $i = key($this->info);
        return $this->info[$i][$this->tasksNs . 'id'];
    }

    function next()
    {
        return next($this->info);
    }

    function valid()
    {
        return current($this->info);
    }

    function locateParam($name)
    {
        foreach ($this->info as $i => $param)
        {
            if (isset($param[$this->tasksNs . 'name']) && $param[$this->tasksNs . 'name'] == $name) {
                return $i;
            }
        }
        return false;
    }

    function offsetGet($var)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_Task_Exception('Use -> operator to access param properties');
        }
        $i = $this->locateParam($var);
        if (false === $i) {
            $i = count($this->info);
            $this->info[$i] = array($this->tasksNs . 'name' => $var,
                                    $this->tasksNs . 'prompt' => null,
                                    $this->tasksNs . 'type' => null,
                                    $this->tasksNs . 'default' => null);
        } else {
            foreach (array('name', 'prompt', 'type', 'default') as $key) {
                if (!array_key_exists($this->tasksNs . $key, $this->info[$i])) {
                    $this->info[$i][$this->tasksNs . $key] = null;
                }
            }
        }
        return new self($this->tasksNs, $this, $this->info[$i], $i);
    }

    function offsetSet($var, $value)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_PackageFile_v2_Dependencies_Exception('Use -> operator to access param properties');
        }
        if (!($value instanceof self)) {
            throw new PEAR2_Pyrus_Task_Exception('Can only set $param[\'' .
                $var .
                '\'] to PEAR2_Pyrus_Task_Postinstallscript_Paramgroup_Param object');
        }
        if ($var === null) {
            $var = $value->id;
        }
        if ($value->id != $var) {
            throw new PEAR2_Pyrus_Task_Exception('Cannot set ' .
                $var . ' to ' .
                $value->id .
                ', use $param[] to set a new value');
        }
        if (false === ($i = $this->locateParam($var))) {
            $i = count($this->info);
        }
        $this->info[$i] = $value->getInfo();
        $this->save();
    }

    function offsetExists($var)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_Task_Exception('Use -> operator to access param properties');
        }
        $i = $this->locateParam($var);
        return $i !== false;
    }

    function offsetUnset($var)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_Task_Exception('Use -> operator to access param properties');
        }
        $i = $this->locateParam($var);
        if ($i === false) {
            return;
        }
        unset($this->info[$i]);
        $this->info = array_values($this->info);
        $this->save();
    }

    function __get($var)
    {
        if ($var === 'paramgroup') {
            if ($this->parent instanceof self) {
                return $this->parent->paramgroup;
            }
            return $this->parent;
        }
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_Task_Exception('Use [] operator to access params');
        }
        if (!array_key_exists($this->tasksNs . $var, $this->info)) {
            $info = array_keys($this->info);
            $a = $this->tasksNs;
            array_walk($info, function(&$key) use ($a) {$key = str_replace($a, '', $key);});
            throw new PEAR2_Pyrus_Task_Exception(
                'Unknown variable ' . $var . ', should be one of ' . implode(', ', $info)
            );
        }
        return $this->info[$this->tasksNs . $var];
    }

    function __isset($var)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_Task_Exception('Use [] operator to access paramgroups');
        }
        if (!array_key_exists($this->tasksNs . $var, $this->info)) {
            $info = array_keys($this->info);
            $a = $this->tasksNs;
            array_walk($info, function(&$key) use ($a) {$key = str_replace($a, '', $key);});
            throw new PEAR2_Pyrus_Task_Exception(
                'Unknown variable ' . $var . ', should be one of ' . implode(', ', $info)
            );
        }
        return isset($this->info[$this->tasksNs . $var]);
    }

    function __unset($var)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_Task_Exception('Use [] operator to access params');
        }
        if (!array_key_exists($this->tasksNs . $var, $this->info)) {
            $info = array_keys($this->info);
            $a = $this->tasksNs;
            array_walk($info, function(&$key) use ($a) {$key = str_replace($a, '', $key);});
            throw new PEAR2_Pyrus_Task_Exception(
                'Unknown variable ' . $var . ', should be one of ' . implode(', ', $info)
            );
        }
        $this->info[$this->tasksNs . $var] = null;
        $this->save();
    }

    function __set($var, $value)
    {
        return $this->__call($var, array($value));
    }

    function __call($var, $args)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_Task_Exception('Use [] operator to access params');
        }
        if (!array_key_exists($this->tasksNs . $var, $this->info)) {
            $info = array_keys($this->info);
            $a = $this->tasksNs;
            array_walk($info, function(&$key) use ($a) {$key = str_replace($a, '', $key);});
            throw new PEAR2_Pyrus_Task_Exception(
                'Unknown variable ' . $var . ', should be one of ' . implode(', ', $info)
            );
        }
        if (!count($args) || $args[0] === null) {
            $this->info[$this->tasksNs . $var] = null;
            $this->save();
            return $this;
        }
        $this->info[$this->tasksNs . $var] = $args[0];
        $this->save();
        return $this;
    }

    function getInfo()
    {
        return $this->info;
    }

    /**
     * Return $this->info, but without the tasks: namespace
     */
    function getPrompts()
    {
        $prompts = array();
        $info = $this->info;
        if (count($info) && !isset($info[0])) {
            $info = array($info);
        }
        foreach ($info as $i => $prompt) {
            foreach ($prompt as $key => $thing) {
                $prompts[$i][str_replace($this->tasksNs, '', $key)] = $thing;
            }
        }
        return $prompts;
    }

    function setInfo($index, $info)
    {
        foreach ($info as $key => $null) {
            if ($null === null) {
                unset($info[$key]);
                continue;
            }
            if (is_array($null) && count($null) == 1) {
                $info[$key] = $null[0];
            }
        }
        $this->info[$index] = $info;
    }

    function save()
    {
        if ($this->parent instanceof self) {
            $this->parent->setInfo($this->index, $this->info);
        } else {
            $info = $this->info;
            if (!count($info)) {
                $info = null;
            }
            $this->parent->setParams($info);
        }
        $this->parent->save();
    }
}
?><?php
/**
 * <tasks:postinstallscript> paramgroup object
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Implements the postinstallscript file task <paramgroup> tag
 *
 * Sample usage:
 *
 * <code>
 * $task->paramgroup['nameid']->instructions('hi there')
 *  ->condition($task->paramgroup['previous']->param['paramname'], '>=', '25')
 *  ->param['paramname']->prompt('blah')->type('string')->defaultValue('hi');
 * </code>
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Task_Postinstallscript_Paramgroup implements ArrayAccess, Iterator, Countable
{
    protected $info;
    protected $index = null;
    protected $parent;
    protected $tasksNs;

    function __construct($tasksNs, $parent, array $info, $index = null)
    {
        if ($tasksNs) {
            if ($tasksNs[strlen($tasksNs)-1] != ':') {
                $tasksNs .= ':';
            }
        } else {
            $tasksNs = '';
        }
        $this->tasksNs = $tasksNs;
        $this->parent = $parent;
        $this->info = $info;
        $this->index = $index;
    }

    /**
     * Determines whether the <conditiontype> tag in this paramgroup is satisfied by
     * the last <paramgroup>.
     *
     * If this is a simple paramgroup with no conditiontype, this always returns true.
     * Otherwise, this processes the conditiontype, and determines whether the variable
     * specified was satisfied by the last executed paramgroup
     * @return bool
     */
    function matchesConditionType(array $answers = null)
    {
        if (!isset($this->name)) {
            return true;
        }
        if (!isset($answers)) {
            throw new PEAR2_Pyrus_Task_Exception('Invalid post-install script, <conditiontype> can only ' .
                                                 'be used if the previous paramgroup has prompts');
        }

        if (isset($answers[$this->name])) {
            switch ($this->conditiontype) {
                case '=' :
                    if ($answers[$this->name] == $this->value) {
                        return true;
                    }
                break;
                case '!=' :
                    if ($answers[$this->name] != $this->value) {
                        return true;
                    }
                break;
                case 'preg_match' :
                    if (@preg_match('/' . $this->value . '/',
                          $answers[$this->name])) {
                        return true;
                    }
                break;
                default :
                return false;
            }
        }
        return false;
    }

    function count()
    {
        return count($this->info);
    }

    function current()
    {
        $i = key($this->info);
        foreach (array('id', 'instructions', 'name', 'conditiontype', 'value', 'param') as $key) {
            if (!array_key_exists($this->tasksNs . $key, $this->info[$i])) {
                $this->info[$i][$this->tasksNs . $key] = null;
            }
        }
        return new self($this->tasksNs, $this, $this->info[$i], $i);
    }

    function rewind()
    {
        reset($this->info);
    }

    function key()
    {
        $i = key($this->info);
        return $this->info[$i][$this->tasksNs . 'id'];
    }

    function next()
    {
        return next($this->info);
    }

    function valid()
    {
        return current($this->info);
    }

    function locateParamgroup($id)
    {
        foreach ($this->info as $i => $paramgroup)
        {
            if (isset($paramgroup[$this->tasksNs . 'id']) && $paramgroup[$this->tasksNs . 'id'] == $id) {
                return $i;
            }
        }
        return false;
    }

    function offsetGet($var)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_Task_Exception('Use -> operator to access paramgroup properties');
        }
        $i = $this->locateParamgroup($var);
        if (false === $i) {
            $i = count($this->info);
            $this->info[$i] = array($this->tasksNs . 'id' => $var,
                                    $this->tasksNs . 'instructions' => null,
                                    $this->tasksNs . 'name' => null,
                                    $this->tasksNs . 'conditiontype' => null,
                                    $this->tasksNs . 'value' => null,
                                    $this->tasksNs . 'param' => null);
        } else {
            foreach (array('id', 'instructions', 'name', 'conditiontype', 'value', 'param') as $key) {
                if (!array_key_exists($this->tasksNs . $key, $this->info[$i])) {
                    $this->info[$i][$this->tasksNs . $key] = null;
                }
            }
        }
        return new self($this->tasksNs, $this, $this->info[$i], $i);
    }

    function offsetSet($var, $value)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_Task_Exception('Use -> operator to access paramgroup properties');
        }
        if (!($value instanceof self)) {
            throw new PEAR2_Pyrus_Task_Exception('Can only set $paramgroup[\'' .
                $var .
                '\'] to PEAR2_Pyrus_Task_Postinstallscript_Paramgroup object');
        }
        if ($var === null) {
            $var = $value->id;
        }
        if ($value->id != $var) {
            throw new PEAR2_Pyrus_Task_Exception('Cannot set ' .
                $var . ' to ' .
                $value->id .
                ', use $paramgroup[] to set a new value');
        }
        if (false === ($i = $this->locateParamgroup($var))) {
            $i = count($this->info);
        }
        $this->info[$i] = $value->getInfo();
        $this->save();
    }

    function offsetExists($var)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_Task_Exception('Use -> operator to access paramgroup properties');
        }
        $i = $this->locateParamgroup($var);
        return $i !== false;
    }

    function offsetUnset($var)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_Task_Exception('Use -> operator to access paramgroup properties');
        }
        $i = $this->locateParamgroup($var);
        if ($i === false) {
            return;
        }
        unset($this->info[$i]);
        $this->info = array_values($this->info);
        $this->save();
    }

    function __get($var)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_Task_Exception('Use [] operator to access paramgroups');
        }
        if (!array_key_exists($this->tasksNs . $var, $this->info)) {
            $info = array_keys($this->info);
            $a = $this->tasksNs;
            array_walk($info, function(&$key) use ($a) {$key = str_replace($a, '', $key);});
            throw new PEAR2_Pyrus_Task_Exception(
                'Unknown variable ' . $var . ', should be one of ' . implode(', ', $info)
            );
        }
        if ($var === 'param') {
            $ret = $this->info[$this->tasksNs . 'param'];
            if ($ret === null) {
                $ret = array();
            } elseif (is_array($ret) && !isset($ret[0])) {
                $ret = array($ret);
            }
            return new PEAR2_Pyrus_Task_Postinstallscript_Paramgroup_Param($this->tasksNs, $this, $ret);
        }
        return $this->info[$this->tasksNs. $var];
    }

    function __isset($var)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_Task_Exception('Use [] operator to access paramgroups');
        }
        if (!array_key_exists($this->tasksNs. $var, $this->info)) {
            $info = array_keys($this->info);
            $a = $this->tasksNs;
            array_walk($info, function(&$key) use ($a) {$key = str_replace($a, '', $key);});
            throw new PEAR2_Pyrus_Task_Exception(
                'Unknown variable ' . $var . ', should be one of ' . implode(', ', $info)
            );
        }
        return isset($this->info[$this->tasksNs. $var]);
    }

    function __unset($var)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_Task_Exception('Use [] operator to access paramgroups');
        }
        if (!array_key_exists($this->tasksNs. $var, $this->info)) {
            $info = array_keys($this->info);
            $a = $this->tasksNs;
            array_walk($info, function(&$key) use ($a) {$key = str_replace($a, '', $key);});
            throw new PEAR2_Pyrus_Task_Exception(
                'Unknown variable ' . $var . ', should be one of ' . implode(', ', $info)
            );
        }
        $this->info[$this->tasksNs. $var] = null;
        $this->save();
    }

    function __set($var, $value)
    {
        return $this->__call($var, array($value));
    }

    function __call($var, $args)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_Task_Exception('Use [] operator to access paramgroups');
        }
        if (!array_key_exists($this->tasksNs. $var, $this->info)) {
            $info = array_keys($this->info);
            $a = $this->tasksNs;
            array_walk($info, function(&$key) use ($a) {$key = str_replace($a, '', $key);});
            throw new PEAR2_Pyrus_Task_Exception(
                'Unknown variable ' . $var . ', should be one of ' . implode(', ', $info)
            );
        }
        if (!count($args) || $args[0] === null) {
            $this->info[$this->tasksNs. $var] = null;
            $this->save();
            return $this;
        }
        if ($var == 'param') {
            if (!isset($this->info[$this->tasksNs. $var])) {
                $this->info[$this->tasksNs. $var] = $args;
            } else {
                if (!is_array($this->info[$this->tasksNs. $var])) {
                    $this->info[$this->tasksNs. $var] = array($this->info[$this->tasksNs. $var]);
                }
                $this->info[$this->tasksNs. $var] = array_merge($this->info[$this->tasksNs. $var], $args);
            }
        } else {
            if ($var === 'name') {
                if (!strpos($args[0], '::')) {
                    throw new PEAR2_Pyrus_Task_Exception('name must reference a previous paramgroup\'s param with ' .
                                                         'syntax paramgroup::paramname');
                }
                $name = explode('::', $args[0]);
                if (count($name) != 2) {
                    throw new PEAR2_Pyrus_Task_Exception('name must reference a previous paramgroup\'s param with ' .
                                                         'syntax paramgroup::paramname');
                }
                if ($name[0] == $this->id) {
                    throw new PEAR2_Pyrus_Task_Exception('name must reference a previous paramgroup\'s param.  ' .
                                                         $args[0] . ' references this paramgroup');
                }
                if (!isset($this->parent[$name[0]])) {
                    throw new PEAR2_Pyrus_Task_Exception('name must reference a previous paramgroup\'s param.  ' .
                                                         'paramgroup "' . $name[0] . '" is not yet created');
                }
                if (!isset($this->parent[$name[0]]->param[$name[1]])) {
                    throw new PEAR2_Pyrus_Task_Exception('name must reference a previous paramgroup\'s param.  ' .
                                                         'paramgroup "' . $name[0] . '" param "' .
                                                         $name[1] . '" is not yet created');
                }
            }
            $this->info[$this->tasksNs. $var] = $args[0];
        }
        $this->save();
        return $this;
    }

    function getInfo()
    {
        return $this->info;
    }

    function setInfo($index, $info)
    {
        foreach ($info as $key => $null) {
            if ($null === null) {
                unset($info[$key]);
                continue;
            }
            if (is_array($null) && count($null) == 1) {
                $info[$key] = $null[0];
            }
        }
        $this->info[$index] = $info;
    }

    function setParams($info)
    {
        if ($info === null) {
            unset($this->info[$this->tasksNs. 'param']);
            return;
        }
        if (count($info) == 1) {
            $info = $info[0];
        }
        $this->info[$this->tasksNs. 'param'] = $info;
    }

    /**
     * Set the condition for this paramgroup
     * @param PEAR2_Pyrus_Task_Postinstallscript_Paramgroup_Param $parameter the
     *        previous parameter whose value we use for the condition check
     * @param string $operator one of =, !=, or preg_match
     * @param string $value the value to match the parameter against
     */
    function condition(PEAR2_Pyrus_Task_Postinstallscript_Paramgroup_Param $parameter = null, $operator = null,
                       $value = null)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_Task_Exception('Use [] operator to access paramgroups');
        }
        if ($parameter === null) {
            $this->name = null;
            $this->conditiontype = null;
            $this->value = null;
            return;
        }
        $this->name = $parameter->paramgroup->id . '::' . $parameter->name;
        if ($operator != '=' && $operator != '!=' && $operator != 'preg_match') {
            throw new PEAR2_Pyrus_Task_Exception('Invalid operator for post-install script condition, ' .
                                                 ' must be one of =, != or preg_match');
        }
        $this->conditiontype = $operator;
        $this->value = $value;
    }

    function save()
    {
        if ($this->parent instanceof self) {
            $this->parent->setInfo($this->index, $this->info);
            $this->parent->save();
        } else {
            $info = $this->info;
            if (count($info) == 1) {
                $info = $info[0];
            } elseif (!count($info)) {
                $info = null;
            }
            $this->parent->setParamgroups($info);
        }
    }
}
?><?php
/**
 * <tasks:unixeol> - read/write version
 *
 * PHP versions 4 and 5
 *
 * LICENSE: This source file is subject to version 3.0 of the PHP license
 * that is available through the world-wide-web at the following URI:
 * http://www.php.net/license/3_0.txt.  If you did not receive a copy of
 * the PHP License and are unable to obtain it through the web, please
 * send a note to license@php.net so we can mail you a copy immediately.
 *
 * @category   pear
 * @package    PEAR
 * @author     Greg Beaver <cellog@php.net>
 * @copyright  1997-2006 The PHP Group
 * @license    http://www.php.net/license/3_0.txt  PHP License 3.0
 * @version    CVS: $Id: rw.php,v 1.1 2006/12/28 20:42:32 cellog Exp $
 * @link       http://pear.php.net/package/PEAR
 * @since      File available since Release 1.4.0a10
 */
/**
 * Base class
 */
require_once 'PEAR/Task/Unixeol.php';
/**
 * Abstracts the unixeol task xml.
 * @category   pear
 * @package    PEAR
 * @author     Greg Beaver <cellog@php.net>
 * @copyright  1997-2006 The PHP Group
 * @license    http://www.php.net/license/3_0.txt  PHP License 3.0
 * @version    Release: @package_version@
 * @link       http://pear.php.net/package/PEAR
 * @since      Class available since Release 1.4.0a10
 */
class PEAR_Task_Unixeol_rw extends PEAR_Task_Unixeol
{
    function PEAR_Task_Unixeol_rw(&$pkg, &$config, &$logger, $fileXml)
    {
        parent::PEAR_Task_Common($config, $logger, PEAR_TASK_PACKAGE);
        $this->_contents = $fileXml;
        $this->_pkg = &$pkg;
        $this->_params = array();
    }

    function validate()
    {
        return true;
    }

    function getName()
    {
        return 'unixeol';
    }

    function getXml()
    {
        return '';
    }
}
?><?php
/**
 * PEAR2_Pyrus_Task_Exception_InvalidTask
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for Pyrus Tasks that are invalid for other reasons
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Task_Exception_InvalidTask extends PEAR2_Pyrus_Task_Exception
{
    function __construct($task, $file, $reason)
    {
        parent::__construct('task <' . $task . '> in file ' . $file .
                    ' is invalid because of "' . $reason . '"');
    }
}<?php
/**
 * PEAR2_Pyrus_Task_Exception_MissingAttribute
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for Pyrus Tasks that are invalid due to a missing attribute
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Task_Exception_MissingAttribute extends PEAR2_Exception
{
    function __construct($task, $attribute, $file)
    {
        parent::__construct('task <' . $task . '> is missing attribute "' . $attribute .
                    '" in file ' . $file);
    }
}<?php
/**
 * PEAR2_Pyrus_Task_Exception_NoAttributes
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for Pyrus Tasks that are invalid because there are no attributes present
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Task_Exception_NoAttributes extends PEAR2_Exception
{
    function __construct($task, $file)
    {
        parent::__construct('task <' . $task . '> has no attributes in file ' . $file);
    }
}<?php
/**
 * PEAR2_Pyrus_Task_Exception_WrongAttributeValue
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for Pyrus Tasks that are invalid because the attribute value is invalid
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Task_Exception_WrongAttributeValue extends PEAR2_Exception
{
    function __construct($task, $attribute, $wrongvalue, $file, array $validvalues)
    {
        parent::__construct('task <' . $task . '> attribute "' . $attribute .
                    '" has the wrong value "' . $wrongvalue . '" '.
                    'in file ' . $file . ', expecting one of "' . implode (', ', $validvalues) . '"');
    }
}<?php
/**
 * <tasks:windowseol>
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Implements the windows line endsings file task.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Task_Windowseol extends PEAR2_Pyrus_Task_Common
{
    const TYPE = 'simple';
    const PHASE = PEAR2_Pyrus_Task_Common::PACKAGEANDINSTALL;
    var $_replacements;

    /**
     * Initialize a task instance with the parameters
     * @param array raw, parsed xml
     * @param array attributes from the <file> tag containing this task
     * @param string|null last installed version of this package
     */
    function __construct($pkg, $phase, $xml, $attribs, $lastversion)
    {
        parent::__construct($pkg, $phase, $xml, $attribs, $lastversion);
    }

    /**
     * Validate the basic contents of a <qindowseol> tag
     * @param PEAR_Pyrus_IPackageFile
     * @param array
     * @param array the entire parsed <file> tag
     * @param string the filename of the package.xml
     * @throws PEAR2_Pyrus_Task_Exception_InvalidTask
     */
    static function validateXml(PEAR2_Pyrus_IPackage $pkg, $xml, $fileXml, $file)
    {
        if (is_array($xml) && count($xml) || $xml === '') {
            throw new PEAR2_Pyrus_Task_Exception_InvalidTask('windowseol', $file, 'no attributes allowed');
        }
        return true;
    }

    /**
     * Replace all line endings with windows line endings
     *
     * See validateXml() source for the complete list of allowed fields
     * @param PEAR2_Pyrus_IPackage
     * @param resource open file pointer, set to the beginning of the file
     * @param string the eventual final file location (informational only)
     * @return string
     */
    function startSession($fp, $dest)
    {
        $contents = stream_get_contents($fp);
        PEAR2_Pyrus_Log::log(3, "replacing all line endings with \\r\\n in $dest");
        $contents = preg_replace("/\r\n|\n\r|\r|\n/", "\r\n", $contents);
        rewind($fp);
        ftruncate($fp, 0);
        fwrite($fp, $contents);
        return true;
    }

    function isPreProcessed()
    {
        return true;
    }
}
?><?php
/**
 * PEAR2_Pyrus_Task_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for Pyrus Tasks
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Task_Exception extends PEAR2_Exception
{
    /**#@+
     * Error codes for task validation routines
     */
    const NOATTRIBS = 1;
    const MISSING_ATTRIB = 2;
    const WRONG_ATTRIB_VALUE = 3;
    const INVALID = 4;
    /**#@-*/
}<?php
/**
 * <tasks:postinstallscript>
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Implements the postinstallscript file task.
 *
 * Note that post-install scripts are handled separately from installation, by the
 * "pyrus run-scripts" command
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Task_Postinstallscript extends PEAR2_Pyrus_Task_Common
{
    const TYPE = 'script';
    const PHASE = PEAR2_Pyrus_Task_Common::POSTINSTALL;
    protected $scriptClass;
    protected $obj;

    /**
     * Initialize a task instance with the parameters
     * @param array raw, parsed xml
     * @param array attributes from the <file> tag containing this task
     * @param string|null last installed version of this package, if any (useful for upgrades)
     */
    function __construct($pkg, $phase, $xml, $attribs, $lastversion)
    {
        parent::__construct($pkg, $phase, $xml, $attribs, $lastversion);
        $this->scriptClass = str_replace(array('/', '.php'), array('_', ''), $attribs['name']) . '_postinstall';
        $this->_filename = $attribs['name'];
    }

    /**
     * Validate the basic contents of a <postinstallscript> tag
     * @param PEAR_Pyrus_IPackageFile
     * @param array
     * @param array the entire parsed <file> tag
     * @param string the filename of the package.xml
     * @throws PEAR2_Pyrus_Task_Exception_InvalidTask
     */
    static function validateXml(PEAR2_Pyrus_IPackage $pkg, $xml, $fileXml, $file)
    {
        if ($fileXml['role'] != 'php') {
            throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file,
                                                             'Post-install script "' .
                                                             $fileXml['name'] . '" must be role="php"');
        }
        try {
            $filecontents = $pkg->getFileContents($fileXml['name']);
        } catch (\Exception $e) {
            throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file,
                                                             'Post-install script "' .
                                                             $fileXml['name'] . '" is not valid: ' .
                                                             $e->getMessage(), $e);
        }

        $validator = $pkg->getValidator();
        $analysis = $validator->analyzeSourceCode($filecontents, true);
        if (!$analysis) {
            $warnings = array();
            // iterate over the problems
            foreach ($validator->getErrors() as $warn) {
                $warnings[] = $warn->getMessage();
            }
            $warnings = implode($warnings);
            throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file, 
                                                             'Analysis of post-install script "' .
                                                             $fileXml['name'] . '" failed: ' . $warnings,
                                                             $validator->getErrors());
        }
        if (count($analysis['declared_classes']) != 1) {
            throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file,
                                                             'Post-install script "' .
                                                             $fileXml['name'] .
                                                             '" must declare exactly 1 class');
        }
        $class = $analysis['declared_classes'][0];
        if ($class != str_replace(array('/', '.php'), array('_', ''),
              $fileXml['name']) . '_postinstall') {
            throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file,
                                                             'Post-install script "' .
                                                             $fileXml['name'] . '" class "' .
                                                             $class . '" must be named "' .
                                                             str_replace(array('/', '.php'),
                                                                         array('_', ''),
                                                                         $fileXml['name']) .
                                                             '_postinstall"');
        }
        if (!isset($analysis['declared_methods'][$class])) {
            throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file,
                                                             'Post-install script "' .
                                                             $fileXml['name'] .
                                                             '" must declare methods init() and run()');
        }
        $methods = array('init' => 0, 'run' => 1);
        foreach ($analysis['declared_methods'][$class] as $method) {
            if (isset($methods[$method])) {
                unset($methods[$method]);
            }
        }
        if (count($methods)) {
            throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file,
                                                             'Post-install script "' .
                                                             $fileXml['name'] .
                                                             '" must declare methods init() and run()');
        }
        $definedparams = array();
        $tasksNamespace = $pkg->getTasksNs() . ':';
        if (!isset($xml[$tasksNamespace . 'paramgroup'])) {
            return true;
        }
        $params = $xml[$tasksNamespace . 'paramgroup'];
        if (!is_array($params) || !isset($params[0])) {
            $params = array($params);
        }
        foreach ($params as $param) {
            if (!isset($param[$tasksNamespace . 'id'])) {
                throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file,
                                                             'Post-install script "' .
                                                             $fileXml['name'] .
                                                             '" <paramgroup> must have ' .
                                                             'an <id> tag');
            }
            if (isset($param[$tasksNamespace . 'name'])) {
                if (!in_array($param[$tasksNamespace . 'name'], $definedparams)) {
                    throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file,
                                                                     'Post-install script "' .
                                                                     $fileXml['name'] . '" ' .
                                                                     '<paramgroup> id "' .
                                                                     $param[$tasksNamespace .'id'] .
                                                                     '" conditiontype parameter "' .
                                                                     $param[$tasksNamespace . 'name'] .
                                                                     '" has not been previously defined');
                }
                if (!isset($param[$tasksNamespace . 'conditiontype'])) {
                    throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file,
                                                                     'Post-install script "' .
                                                                     $fileXml['name'] . '" ' .
                                                                     '<paramgroup> id "' .
                                                                     $param[$tasksNamespace . 'id'] .
                                                                     '" must have a ' .
                                                                     '<conditiontype> tag ' .
                                                                     'containing either "=", ' .
                                                                     '"!=", or "preg_match"');
                }
                if (!in_array($param[$tasksNamespace . 'conditiontype'],
                      array('=', '!=', 'preg_match'))) {
                    throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file,
                                                                     'Post-install script "' .
                                                                     $fileXml['name'] . '" ' .
                                                                     '<paramgroup> id "' .
                                                                     $param[$tasksNamespace . 'id'] .
                                                                     '" must have a ' .
                                                                     '<conditiontype> tag ' .
                                                                     'containing either "=", ' .
                                                                     '"!=", or "preg_match"');
                }
                if (!isset($param[$tasksNamespace . 'value'])) {
                    throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file,
                                                                     'Post-install script "' .
                                                                     $fileXml['name'] . '" ' .
                                                                     '<paramgroup> id "' .
                                                                     $param[$tasksNamespace . 'id'] .
                                                                     '" must have a ' .
                                                                     '<value> tag containing ' .
                                                                     'expected parameter value');
                }
            }
            if (isset($param[$tasksNamespace . 'instructions'])) {
                if (!is_string($param[$tasksNamespace . 'instructions'])) {
                    throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file,
                                                                     'Post-install script "' .
                                                                     $fileXml['name'] . '" ' .
                                                                     '<paramgroup> id "' .
                                                                     $param[$tasksNamespace . 'id'] .
                                                                     '" <instructions> must be simple text');
                }
            }
            if (!isset($param[$tasksNamespace . 'param'])) {
                continue; // <param> is no longer required
            }
            $subparams = $param[$tasksNamespace . 'param'];
            if (!is_array($subparams) || !isset($subparams[0])) {
                $subparams = array($subparams);
            }
            foreach ($subparams as $subparam) {
                if (!isset($subparam[$tasksNamespace . 'name'])) {
                    throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file,
                                                                     'Post-install script "' .
                                                                     $fileXml['name'] . '" parameter for ' .
                                                                     '<paramgroup> id "' .
                                                                     $param[$tasksNamespace . 'id'] .
                                                                     '" must have ' .
                                                                     'a <name> tag');
                }
                if (!preg_match('/[a-zA-Z0-9]+/',
                      $subparam[$tasksNamespace . 'name'])) {
                    throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file,
                                                                     'Post-install script "' .
                                                                     $fileXml['name'] . '" parameter "' .
                                                                     $subparam[$tasksNamespace . 'name'] .
                                                                     '" for ' .
                                                                     '<paramgroup> id "' .
                                                                     $param[$tasksNamespace . 'id'] .
                                                                     '" is not a valid name.  Must ' .
                                                                     'contain only alphanumeric characters');
                }
                if (!isset($subparam[$tasksNamespace . 'prompt'])) {
                    throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file,
                                                                     'Post-install script "' .
                                                                     $fileXml['name'] . '" parameter "' .
                                                                     $subparam[$tasksNamespace . 'name'] .
                                                                     '" for ' .
                                                                     '<paramgroup> id "' .
                                                                     $param[$tasksNamespace . 'id'] .
                                                                     '" must have a ' .
                                                                     '<prompt> tag');
                }
                if (!isset($subparam[$tasksNamespace . 'type'])) {
                    throw new PEAR2_Pyrus_Task_Exception_InvalidTask('postinstallscript', $file,
                                                                     'Post-install script "' .
                                                                     $fileXml['name'] . '" parameter "' .
                                                                     $subparam[$tasksNamespace . 'name'] .
                                                                     '" for ' .
                                                                     '<paramgroup> id "' .
                                                                     $param[$tasksNamespace . 'id'] .
                                                                     '" must have a ' .
                                                                     '<type> tag');
                }
                $definedparams[] = $param[$tasksNamespace . 'id'] . '::' .
                $subparam[$tasksNamespace . 'name'];
            }
        }
        return true;
    }

    /**
     * Unlike other tasks, the installed file name is passed in instead of the file contents,
     * because this task is handled post-installation
     * @param PEAR2_Pyrus_IPackage
     * @param string path to the post-install script
     * @return bool false to skip this file
     */
    function setupPostInstall()
    {
        $files = PEAR2_Pyrus_Config::current()->registry->info($this->pkg->name, $this->pkg->channel,
                                                               'installedfiles');
        foreach ($files as $path => $info) {
            if ($info['name'] == $this->_filename) {
                break;
            }
        }
        PEAR2_Pyrus_Log::log(0, 'Including external post-installation script "' .
            $path . '" - any errors are in this script');
        include $path;
        if (class_exists($this->scriptClass)) {
            PEAR2_Pyrus_Log::log(0, 'Inclusion succeeded');
        } else {
            throw new PEAR2_Pyrus_Task_Exception('init of post-install script class "' . $this->scriptClass
                . '" failed');
        }
        $this->obj = new $this->scriptClass;
        PEAR2_Pyrus_Log::log(1, 'running post-install script "' . $this->scriptClass . '->init()"');
        try {
            $this->obj->init($this->pkg, $this->lastVersion);
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_Task_Exception('init of post-install script "' . $this->scriptClass .
                '->init()" failed', $e);
        }
        PEAR2_Pyrus_Log::log(0, 'init succeeded');
        return true;
    }

    /**
     * No longer used
     * @see PEAR_PackageFile_v2::runPostinstallScripts()
     * @param array an array of tasks
     * @param string install or upgrade
     * @access protected
     * @static
     */
    function run($tasks)
    {
    }

    function __get($var)
    {
        if ($var === 'scriptobject') {
            return $this->obj;
        }
        if ($var === 'paramgroup') {
            if (!isset($this->xml) || !is_array($this->xml) || !isset($this->xml['paramgroup'])) {
                $params = array();
            } else {
                $params = $this->xml['paramgroup'];
                if (count($params) && !isset($params[0])) {
                    $params = array($params);
                }
            }
            return new PEAR2_Pyrus_Task_Postinstallscript_Paramgroup($this->pkg->getTasksNs(),
                                                                     $this, $params);
        }
        throw new PEAR2_Pyrus_Task_Exception('Invalid variable ' . $var . ' requested from Post-install script task');
    }

    function setParamgroups($info)
    {
        if ($info === null) {
            unset($this->xml['paramgroup']);
            return;
        }
        $this->xml['paramgroup'] = $info;
        $this->notify();
    }
}
?><?php
/**
 * <tasks:replace>
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Implements the replace file task.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Task_Replace extends PEAR2_Pyrus_Task_Common
{
    const TYPE = 'simple';
    const PHASE = PEAR2_Pyrus_Task_Common::PACKAGEANDINSTALL;
    var $_replacements;

    /**
     * Initialize a task instance with the parameters
     * @param array raw, parsed xml
     * @param array attributes from the <file> tag containing this task
     * @param string|null last installed version of this package
     */
    function __construct($pkg, $phase, $xml, $attribs, $lastversion)
    {
        parent::__construct($pkg, $phase, $xml, $attribs, $lastversion);
        $this->_replacements = isset($xml['attribs']) ? array($xml) : $xml;
    }

    /**
     * Validate the basic contents of a <replace> tag
     * @param PEAR_Pyrus_IPackageFile
     * @param array
     * @param array the entire parsed <file> tag
     * @param string the filename of the package.xml
     * @throws PEAR2_Pyrus_Task_Exception_InvalidTask
     */
    static function validateXml(PEAR2_Pyrus_IPackage $pkg, $xml, $fileXml, $file)
    {
        if (!isset($xml['attribs'])) {
            throw new PEAR2_Pyrus_Task_Exception_NoAttributes('replace', $file);
        }
        $errs = new PEAR2_MultiErrors;
        foreach (array('type', 'to', 'from') as $attrib) {
            if (!isset($xml['attribs'][$attrib])) {
                $errs->E_ERROR[] =
                    new PEAR2_Pyrus_Task_Exception_MissingAttribute('replace',
                                                                    $attrib, $file);
            }
        }
        if ($count = count($errs->E_ERROR)) {
            if ($count == 1) {
                throw $errs->E_ERROR[0];
            }
            throw new PEAR2_Pyrus_Task_Exception('Invalid replace task, multiple missing attributes', $errs);
        }
        if ($xml['attribs']['type'] == 'pear-config') {
            $config = PEAR2_Pyrus_Config::current();
            if (!in_array($xml['attribs']['to'], $config->systemvars)) {
                throw new PEAR2_Pyrus_Task_Exception_WrongAttributeValue('replace',
                                                                         'to', $xml['attribs']['to'],
                                                                         $file,
                                                                         $config->systemvars);
            }
        } elseif ($xml['attribs']['type'] == 'php-const') {
            if (defined($xml['attribs']['to'])) {
                return true;
            } else {
                throw new PEAR2_Pyrus_Task_Exception_WrongAttributeValue('replace',
                                                                         'to', $xml['attribs']['to'],
                                                                         $file,
                                                                         array('valid PHP constant'));
            }
        } elseif ($xml['attribs']['type'] == 'package-info') {
            if (in_array($xml['attribs']['to'],
                array('name', 'summary', 'channel', 'notes', 'extends', 'description',
                    'release_notes', 'license', 'release-license', 'license-uri',
                    'version', 'api-version', 'state', 'api-state', 'release_date',
                    'date', 'time'))) {
                return true;
            } else {
                throw new PEAR2_Pyrus_Task_Exception_WrongAttributeValue('replace',
                                                                         'to', $xml['attribs']['to'],
                                                                         $file,
                    array('name', 'summary', 'channel', 'notes', 'extends', 'description',
                    'release_notes', 'license', 'release-license', 'license-uri',
                    'version', 'api-version', 'state', 'api-state', 'release_date',
                    'date', 'time'));
            }
        } else {
            throw new PEAR2_Pyrus_Task_Exception_WrongAttributeValue('replace',
                                                                     'type', $xml['attribs']['type'],
                                                                     $file,
                                                                     array('pear-config',
                                                                           'package-info',
                                                                           'php-const'));
        }
        return true;
    }

    /**
     * Do a package.xml 1.0 replacement, with additional package-info fields available
     *
     * See validateXml() source for the complete list of allowed fields
     * @param PEAR2_Pyrus_IPackage
     * @param resource open file pointer, set to the beginning of the file
     * @param string the eventual final file location (informational only)
     * @return string|false
     */
    function startSession($fp, $dest)
    {
        $contents = stream_get_contents($fp);
        $subst_from = $subst_to = array();
        foreach ($this->_replacements as $a) {
            $a = $a['attribs'];
            $to = '';
            if ($a['type'] == 'pear-config') {
                if ($this->installphase == PEAR2_Pyrus_Task_Common::PACKAGE) {
                    return false;
                }
                $to = PEAR2_Pyrus_Config::current()->{$a['to']};
                if (is_null($to)) {
                    PEAR2_Pyrus_Log::log(0, "$dest: invalid pear-config replacement: $a[to]");
                    return false;
                }
            } elseif ($a['type'] == 'php-const') {
                if ($this->installphase == PEAR2_Pyrus_Task_Common::PACKAGE) {
                    return false;
                }
                if (defined($a['to'])) {
                    $to = constant($a['to']);
                } else {
                    PEAR2_Pyrus_Log::log(0, "$dest: invalid php-const replacement: $a[to]");
                    return false;
                }
            } else {
                if ($t = $this->pkg->{$a['to']}) {
                    if ($a['to'] == 'version') {
                        $t = $t['release'];
                    }
                    $to = $t;
                } else {
                    PEAR2_Pyrus_Log::log(0, "$dest: invalid package-info replacement: $a[to]");
                    return false;
                }
            }
            if (!is_null($to)) {
                $subst_from[] = $a['from'];
                $subst_to[] = $to;
            }
        }
        PEAR2_Pyrus_Log::log(3, "doing " . sizeof($subst_from) .
            " substitution(s) for $dest");
        if (sizeof($subst_from)) {
            $contents = str_replace($subst_from, $subst_to, $contents);
        }
        rewind($fp);
        ftruncate($fp, 0);
        fwrite($fp, $contents);
        return true;
    }

    function isPreProcessed()
    {
        if ($this->_replacements[0]['attribs']['type'] == 'package-info') {
            return true;
        }
        return false;
    }
}
?><?php
/**
 * <tasks:windowseol> - read/write version
 *
 * PHP versions 4 and 5
 *
 * LICENSE: This source file is subject to version 3.0 of the PHP license
 * that is available through the world-wide-web at the following URI:
 * http://www.php.net/license/3_0.txt.  If you did not receive a copy of
 * the PHP License and are unable to obtain it through the web, please
 * send a note to license@php.net so we can mail you a copy immediately.
 *
 * @category   pear
 * @package    PEAR
 * @author     Greg Beaver <cellog@php.net>
 * @copyright  1997-2006 The PHP Group
 * @license    http://www.php.net/license/3_0.txt  PHP License 3.0
 * @version    CVS: $Id: rw.php,v 1.1 2006/12/28 20:42:32 cellog Exp $
 * @link       http://pear.php.net/package/PEAR
 * @since      File available since Release 1.4.0a10
 */
/**
 * Base class
 */
require_once 'PEAR/Task/Windowseol.php';
/**
 * Abstracts the windowseol task xml.
 * @category   pear
 * @package    PEAR
 * @author     Greg Beaver <cellog@php.net>
 * @copyright  1997-2006 The PHP Group
 * @license    http://www.php.net/license/3_0.txt  PHP License 3.0
 * @version    Release: @package_version@
 * @link       http://pear.php.net/package/PEAR
 * @since      Class available since Release 1.4.0a10
 */
class PEAR_Task_Windowseol_rw extends PEAR_Task_Windowseol
{
    function PEAR_Task_Windowseol_rw(&$pkg, &$config, &$logger, $fileXml)
    {
        parent::PEAR_Task_Common($config, $logger, PEAR_TASK_PACKAGE);
        $this->_contents = $fileXml;
        $this->_pkg = &$pkg;
        $this->_params = array();
    }

    function validate()
    {
        return true;
    }

    function getName()
    {
        return 'windowseol';
    }

    function getXml()
    {
        return '';
    }
}
?><?php
/**
 * <tasks:unixeol>
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Implements the unix line endings file task.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Task_Unixeol extends PEAR2_Pyrus_Task_Common
{
    const TYPE = 'simple';
    const PHASE = PEAR2_Pyrus_Task_Common::PACKAGEANDINSTALL;
    var $_replacements;

    /**
     * Initialize a task instance with the parameters
     * @param array raw, parsed xml
     * @param array attributes from the <file> tag containing this task
     * @param string|null last installed version of this package
     */
    function __construct($pkg, $phase, $xml, $attribs, $lastversion)
    {
        parent::__construct($pkg, $phase, $xml, $attribs, $lastversion);
    }

    /**
     * Validate the basic contents of a <unixeol> tag
     * @param PEAR_Pyrus_IPackageFile
     * @param array
     * @param array the entire parsed <file> tag
     * @param string the filename of the package.xml
     * @throws PEAR2_Pyrus_Task_Exception_InvalidTask
     */
    static function validateXml(PEAR2_Pyrus_IPackage $pkg, $xml, $fileXml, $file)
    {
        if (is_array($xml) && count($xml) || $xml === '') {
            throw new PEAR2_Pyrus_Task_Exception_InvalidTask('unixeol', $file, 'no attributes allowed');
        }
        return true;
    }

    /**
     * Replace all line endings with line endings customized for the current OS
     *
     * See validateXml() source for the complete list of allowed fields
     * @param PEAR2_Pyrus_IPackage
     * @param resource open file pointer, set to the beginning of the file
     * @param string the eventual final file location (informational only)
     * @return string
     */
    function startSession($fp, $dest)
    {
        $contents = stream_get_contents($fp);
        PEAR2_Pyrus_Log::log(3, "replacing all line endings with \\n in $dest");
        $contents = preg_replace("/\r\n|\n\r|\r|\n/", "\n", $contents);
        rewind($fp);
        ftruncate($fp, 0);
        fwrite($fp, $contents);
        return true;
    }

    function isPreProcessed()
    {
        return true;
    }
}
?><?php
/**
 * PEAR2_Pyrus_FileTransactions
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Base class for Pyrus.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_FileTransactions
{
    private $fileOperations = array();
    static private $_registeredTransactions =
        array(
            'backup' => false,
            'chmod' => false,
            'delete' => false,
            'removebackup' => false,
            'mkdir' => false,
            /* to enable the next three, use registerTransaction() */
//            'rename' => false,
//            'rmdir' => false,
//            'installedas' => false,
        );

    /**
     * Add a file operation to the current file transaction.
     *
     * @see begin()
     * @param string $type This can be one of:
     *    - rename:  rename a file ($data has 3 values)
     *    - backup:  backup an existing file ($data has 1 value)
     *    - removebackup:  clean up backups created during install ($data has 1 value)
     *    - chmod:   change permissions on a file ($data has 2 values)
     *    - delete:  delete a file ($data has 1 value)
     *    - rmdir:   delete a directory if empty ($data has 1 value)
     *    - installedas: mark a file as installed ($data has 4 values).
     * @param array $data For all file operations, this array must contain the
     *    full path to the file or directory that is being operated on.  For
     *    the rename command, the first parameter must be the file to rename,
     *    the second its new name, the third whether this is a PHP extension.
     *
     *    The installedas operation contains 4 elements in this order:
     *    1. Filename as listed in the filelist element from package.xml
     *    2. Full path to the installed file
     *    3. Full path from the php_dir configuration variable used in this
     *       installation
     *    4. Relative path from the php_dir that this file is installed in
     */
    function __call($type, $data)
    {
        if ($type == 'chmod') {
            $octmode = decoct($data[0]);
            PEAR2_Pyrus_Log::log(3, "adding to transaction: $type $octmode $data[1]");
        } else {
            PEAR2_Pyrus_Log::log(3, "adding to transaction: $type " . implode(" ", $data));
        }
        $this->fileOperations[] = array($type, $data);
    }

    function begin($rollback_in_case = false)
    {
        if (count($this->fileOperations) && $rollback_in_case) {
            $this->rollback();
        }
        $this->fileOperations = array();
    }

    function commit()
    {
        $n = count($this->fileOperations);
        PEAR2_Pyrus_Log::log(2, "about to commit $n file operations");
        // {{{ first, check permissions and such manually
        $errors = array();

        foreach ($this->fileOperations as $tr) {
            list($type, $data) = $tr;
            switch ($type) {
                case 'backup' :
                    break;
                case 'chmod' :
                    // check that file is writable
                    if (!is_writable($data[1])) {
                        $errors[] = "permission denied ($type): $data[1] " . decoct($data[0]);
                    }
                    break;
                case 'delete' :
                    if (!file_exists($data[0])) {
                        PEAR2_Pyrus_Log::log(2, "warning: file $data[0] doesn'" .
                            "t exist, can't be deleted");
                    }
                    // check that directory is writable
                    if (file_exists($data[0])) {
                        if (!is_writable(dirname($data[0]))) {
                            $errors[] = "permission denied ($type): $data[0]";
                        } else {
                            // make sure the file to be deleted can be opened for writing
                            $fp = false;
                            if (!is_dir($data[0]) &&
                                  (!is_writable($data[0]) || !($fp = @fopen($data[0], 'a')))) {
                                $errors[] = "permission denied ($type): $data[0]";
                            } elseif ($fp) {
                                fclose($fp);
                            }
                        }
                    }
                    break;
                case 'mkdir' :
                case 'removebackup' :
                    break;
                default :
                    $callback = self::$_registeredTransactions[$type];
                    $callback->check($data, $errors);
            }
        }
        if (count($errors) > 0) {
            foreach ($errors as $error) {
                if (!isset($this->_options['soft'])) {
                    PEAR2_Pyrus_Log::log(1, $error);
                }
            }
            if (!isset($this->_options['ignore-errors'])) {
                return false;
            }
        }
        $this->_dirtree = array();
        foreach ($this->fileOperations as $tr) {
            list($type, $data) = $tr;
            switch ($type) {
                case 'backup' :
                    if (!@copy($data[0], $data[0] . '.bak')) {
                        PEAR2_Pyrus_Log::log(1, 'Could not copy ' . $data[0] . ' to ' . $data[0] .
                            '.bak ' . $php_errormsg);
                        return false;
                    }
                    PEAR2_Pyrus_Log::log(3, "+ backup $data[0] to $data[0].bak");
                    break;
                case 'chmod' :
                    if (!@chmod($data[1], $data[0])) {
                        PEAR2_Pyrus_Log::log(1, 'Could not chmod ' . $data[1] . ' to ' .
                            decoct($data[0]) . ' ' . $php_errormsg);
                        return false;
                    }
                    $octmode = decoct($data[0]);
                    PEAR2_Pyrus_Log::log(3, "+ chmod $octmode $data[1]");
                    break;
                case 'delete' :
                    if (file_exists($data[0])) {
                        if (!@unlink($data[0])) {
                            PEAR2_Pyrus_Log::log(1, 'Could not delete ' . $data[0] . ' ' .
                                $php_errormsg);
                            return false;
                        }
                        PEAR2_Pyrus_Log::log(3, "+ rm $data[0]");
                    }
                    break;
                case 'mkdir' :
                    break;
                case 'removebackup' :
                    if (file_exists($data[0] . '.bak') && is_writable($data[0] . '.bak')) {
                        unlink($data[0] . '.bak');
                        PEAR2_Pyrus_Log::log(3, "+ rm backup of $data[0] ($data[0].bak)");
                    }
                    break;
                default :
                    $callback = self::$_registeredTransactions[$type];
                    $callback->commit($data, $errors);
            }
        }
        PEAR2_Pyrus_Log::log(2, "successfully committed $n file operations");
        $this->fileOperations = array();
        return true;
    }

    function registerTransaction($name, PEAR2_Pyrus_IFileTransaction $callback)
    {
        if (in_array($name, array_keys(self::$_registeredTransactions), true)) {
            throw new PEAR2_Pyrus_FileTransactions_Exception('transaction type ' . $name .
                ' is already registered');
        }
        self::$_registeredTransactions[$name] = $callback;
    }

    function rollback()
    {
        $n = count($this->fileOperations);
        PEAR2_Pyrus_Log::log(2, "rolling back $n file operations");
        foreach ($this->fileOperations as $tr) {
            list($type, $data) = $tr;
            switch ($type) {
                case 'backup' :
                    if (file_exists($data[0] . '.bak')) {
                        @unlink($data[0]);
                        @copy($data[0] . '.bak', $data[0]);
                        PEAR2_Pyrus_Log::log(3, "+ restore $data[0] from $data[0].bak");
                    }
                    break;
                case 'chmod' :
                case 'delete' :
                case 'removebackup' :
                    break;
                case 'mkdir' :
                    @rmdir($data[0]);
                    PEAR2_Pyrus_Log::log(3, "+ rmdir $data[0]");
                    break;
                default :
                    $callback = self::$_registeredTransactions[$type];
                    $callback->rollback($data, $errors);
            }
        }
        foreach (self::$_registeredTransactions as $callback) {
            if (!$callback) {
                continue;
            }
            $callback->cleanup();
        }
        $this->fileOperations = array();
    }
}<?php
/**
 * PEAR2_Pyrus_PECLBuild_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception for a Pyrus PECL package builder.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PECLBuild_Exception extends PEAR2_Exception
{
}<?php
/**
 * PEAR2_Pyrus_Package
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Abstract representation of a package
 *
 * specific package types are:
 *
 * - package.xml
 * - package.tgz/package.tar
 * - package.phar
 * - remote undownloaded package
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Package implements PEAR2_Pyrus_IPackage
{
    /**
     * This is strictly for unit-testing purposes
     * @var string
     */
    public $archivefile;
    /**
     * The actual package representation
     *
     * @var PEAR2_Pyrus_Package_Xml|PEAR2_Pyrus_Package_Tar|PEAR2_Pyrus_Package_Phar
     */
    protected $internal;
    protected $from;

    function __construct($packagedescription, $forceremote = false)
    {
        if (!$packagedescription) {
            return;
        }
        if ($forceremote) {
            $this->internal = new PEAR2_Pyrus_Package_Remote($packagedescription);
        } else {
            $class = $this->parsePackageDescription($packagedescription);
            $this->internal = new $class($packagedescription, $this);
        }
    }

    function setFrom($from)
    {
        $this->from = $from;
    }

    function __get($var)
    {
        return $this->internal->$var;
    }

    function __set($var, $value)
    {
        return $this->internal->__set($var, $value);
    }

    function __call($func, $args)
    {
        // delegate to the internal object
        return call_user_func_array(array($this->internal, $func), $args);
    }

    function getValidator()
    {
        return $this->internal->getValidator();
    }

    function toArray($forpackaging = false)
    {
        return $this->internal->toArray($forpackaging);
    }

    function getFileContents($file, $asstream = false)
    {
        return $this->internal->getFileContents($file, $asstream);
    }

    function getFilePath($file)
    {
        return $this->internal->getFilePath($file);
    }

    function isNewPackage()
    {
        return $this->internal->isNewPackage();
    }

    function isUpgradeable()
    {
        return $this->internal->isUpgradeable();
    }

    function getFrom()
    {
        if ($this->from) {
            return $this->from->getFrom();
        }
        return $this;
    }

    function getPackageFileObject()
    {
        return $this->internal->getPackageFileObject();
    }

    function getInternalPackage()
    {
        return $this->internal;
    }

    function setInternalPackage(PEAR2_Pyrus_IPackage $internal)
    {
        $this->internal = $internal;
    }

    function __toString()
    {
        return $this->internal->__toString();
    }

    function offsetExists($offset)
    {
        return isset($this->internal[$offset]);
    }

    function offsetGet($offset)
    {
        return $this->internal[$offset];
    }

    function offsetSet($offset, $value)
    {
        $this->internal[$offset] = $value;
    }

    function offsetUnset($offset)
    {
        unset($this->internal[$offset]);
    }

    function isStatic()
    {
        return $this->internal->isStatic();
    }

    function isRemote()
    {
        return $this->internal instanceof PEAR2_Pyrus_Package_Remote ||
                    $this->internal instanceof PEAR2_Pyrus_Channel_Remotepackage || (
                    $this->internal instanceof PEAR2_Pyrus_Package && $this->internal->isRemote());
    }

    function download()
    {
        if ($this->internal instanceof PEAR2_Pyrus_Package_Remote) {
            $this->internal = $this->internal->download();
        }
    }

    function copyTo($where)
    {
        $this->internal->copyTo($where);
    }

    static function parsePackageDescription($package)
    {
        if (strpos($package, 'http://') === 0 || strpos($package, 'https://') === 0) {
            return 'PEAR2_Pyrus_Package_Remote';
        }
        try {
            if (@file_exists($package) && @is_file($package)) {
                $info = pathinfo($package);
                if (!isset($info['extension']) || !strlen($info['extension'])) {
                    // guess based on first 4 characters
                    $f = @fopen($package, 'r');
                    if ($f) {
                        $first5 = fread($f, 5);
                        fclose($f);
                        if ($first5 == '<?xml') {
                            return 'PEAR2_Pyrus_Package_Xml';
                        }
                        return 'PEAR2_Pyrus_Package_Phar';
                    }
                } else {
                    if (extension_loaded('phar') && strtolower($info['extension']) != 'xml') {
                        return 'PEAR2_Pyrus_Package_Phar';
                    }
                    switch (strtolower($info['extension'])) {
                        case 'xml' :
                            return 'PEAR2_Pyrus_Package_Xml';
                        default:
                            throw new PEAR2_Pyrus_Package_Exception('Cannot read archives with phar extension');
                    }
                }
            }
            $info = PEAR2_Pyrus_Config::parsePackageName($package);
            return 'PEAR2_Pyrus_Package_Remote';
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_Package_Exception('package "' . $package . '" is unknown', $e);
        }
    }
}
<?php
/**
 * PEAR2_Pyrus_Channel_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception for channels
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Channel_Exception extends PEAR2_Exception {}<?php
/**
 * PEAR2_Pyrus_Channel_Remotepackages
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Remote REST iteration handler for package listing
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Channel_Remotepackages implements ArrayAccess, Iterator
{
    protected $parent;
    public $stability = null;
    protected $rest;
    protected $packageList;

    function __construct(PEAR2_Pyrus_IChannel $channelinfo)
    {
        $this->parent = $channelinfo;
        if (!isset($this->parent->protocols->rest['REST1.0'])) {
            throw new PEAR2_Pyrus_Channel_Exception('Cannot access remote packages without REST1.0 protocol');
        }
        $this->rest = new PEAR2_Pyrus_REST;
    }

    function offsetGet($var)
    {
        if ($var !== 'devel' && $var !== 'alpha' && $var !== 'beta' && $var !== 'stable') {
            throw new PEAR2_Pyrus_Channel_Exception('Invalid stability requested, must be one of ' .
                                                    'devel, alpha, beta, stable');
        }
        $a = clone $this;
        $a->stability = $var;
        return $a;
    }

    function offsetSet($var, $value)
    {
        throw new PEAR2_Pyrus_Channel_Exception('remote channel info is read-only');
    }

    function offsetUnset($var)
    {
        throw new PEAR2_Pyrus_Channel_Exception('remote channel info is read-only');
    }

    function offsetExists($var)
    {
        // implement this
    }

    function valid()
    {
        return current($this->packageList);
    }

    function current()
    {
        if ($this->stability) {
            $info = current($this->packageList);
            $lowerpackage = $info[0];
            $releases = $info[1];
        } else {
            $lowerpackage = current($this->packageList);
        }
        $info = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.0']->baseurl .
                                                'p/' . $lowerpackage . '/info.xml');
        if (isset($releases)) {
            $pxml = new PEAR2_Pyrus_Channel_Remotepackage($this->parent, $releases);
        } else {
            $pxml = new PEAR2_Pyrus_Channel_Remotepackage($this->parent);
        }
        $pxml->channel = $info['c'];
        $pxml->name = $info['n'];
        $pxml->license = $info['l'];
        $pxml->summary = $info['s'];
        $pxml->description = $info['d'];
        return $pxml;
    }

    function getPackage($package)
    {
        $lowerpackage = strtolower($package);
        if (isset($this->parent->protocols->rest['REST1.3'])) {
            $info = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.3']->baseurl .
                                                    'r/' . $lowerpackage . '/allreleases2.xml');
        } else {
            $info = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.0']->baseurl .
                                                    'r/' . $lowerpackage . '/allreleases.xml');
        }
        if (!isset($info['r'][0])) {
            $info['r'] = array($info['r']);
        }
        // filter the package list for packages of this stability or better
        $ok = PEAR2_Pyrus_Installer::betterStates($this->stability, true);
        $releases = array();
        foreach ($info['r'] as $release) {
            if (!in_array($release['s'], $ok)) {
                continue;
            }
            if (!isset($release['m'])) {
                $release['m'] = '5.2.0';
            }
            $releases[] = $release;
        }
        $info = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.0']->baseurl .
                                                'p/' . $lowerpackage . '/info.xml');
        $pxml = new PEAR2_Pyrus_Channel_Remotepackage($this->parent, $releases);
        $pxml->channel = $info['c'];
        $pxml->name = $info['n'];
        $pxml->license = $info['l'];
        $pxml->summary = $info['s'];
        $pxml->description = $info['d'];
        return $pxml;
    }

    function key()
    {
        return key($this->packageList);
    }

    function next()
    {
        return next($this->packageList);
    }

    function rewind()
    {
        $this->packageList = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.0']->baseurl .
                                                             'p/packages.xml');
        $this->packageList = $this->packageList['p'];
        if (!is_array($this->packageList)) {
            $this->packageList = array($this->packageList);
        }
        if (isset($this->stability)) {
            // filter the package list for packages of this stability or better
            $ok = PEAR2_Pyrus_Installer::betterStates($this->stability, true);
            $filtered = array();
            foreach ($this->packageList as $lowerpackage) {
                if (isset($this->parent->protocols->rest['REST1.3'])) {
                    $info = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.3']->baseurl .
                                                            'r/' . $lowerpackage . '/allreleases2.xml');
                } else {
                    $info = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.0']->baseurl .
                                                            'r/' . $lowerpackage . '/allreleases.xml');
                }
                if (!isset($info['r'][0])) {
                    $info['r'] = array($info['r']);
                }
                $releases = array();
                foreach ($info['r'] as $release) {
                    if (!in_array($release['s'], $ok)) {
                        continue;
                    }
                    if (!isset($release['m'])) {
                        $release['m'] = '5.2.0';
                    }
                    $releases[] = $release;
                }
                if (!count($releases)) {
                    continue;
                }
                $filtered[] = array($lowerpackage, $releases);
            }
            $this->packageList = $filtered;
        }
    }
}<?php
/**
 * PEAR2_Pyrus_Channel_Remotepackage
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Remote REST iteration handler
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Channel_Remotepackage extends PEAR2_Pyrus_PackageFile_v2 implements ArrayAccess, Iterator
{
    protected $parent;
    protected $rest;
    protected $releaseList;
    protected $remotedeps;
    protected $remoteAbridgedInfo;
    protected $versionSet = false;
    protected $minimumStability;
    protected $explicitVersion;
    /**
     * Flag used to determine whether this package has been tested for upgradeability
     */
    protected $isUpgradeable = null;

    function __construct(PEAR2_Pyrus_IChannelFile $channelinfo, $releases = null)
    {
        $this->parent = $channelinfo;
        if (!isset($this->parent->protocols->rest['REST1.0'])) {
            throw new PEAR2_Pyrus_Channel_Exception('Cannot access remote packages without REST1.0 protocol');
        }
        // instruct parent::__set() to call $this->setRawVersion() when setting rawversion
        $this->rawMap['rawversion'] = array('setRawVersion');
        $this->rest = new PEAR2_Pyrus_REST;
        $this->releaseList = $releases;
        $this->minimumStability = PEAR2_Pyrus_Config::current()->preferred_state;
        $this->explicitVersion = false;
    }

    /**
     * Sets the minimum stability allowed.
     *
     * This is set by a call to a package such as "pyrus install Pname-stable"
     * or "pyrus install Pname-beta"
     *
     * The stability is only changed if it is less stable than preferred_state.
     * @param string
     */
    function setExplicitState($stability)
    {
        $states = PEAR2_Pyrus_Installer::betterStates($this->minimumStability);
        $newstates = PEAR2_Pyrus_Installer::betterStates($stability);
        if (count($newstates) > count($states)) {
            $this->minimumStability = $stability;
        }
    }

    function setExplicitVersion($version)
    {
        $this->explicitVersion = $version;
    }

    function setUpgradeable()
    {
        $this->isUpgradeable = true;
    }

    function isUpgradeable()
    {
        return $this->isUpgradeable;
    }

    function isPlugin()
    {
        return false; // until there is some REST in place, we have to return false
    }

    function setRawVersion($var, $value)
    {
        if (isset($this->parent->protocols->rest['REST1.3'])) {
            $a = $this->remoteAbridgedInfo = $this->rest->retrieveCacheFirst(
                                                        $this->parent->protocols->rest['REST1.3']->baseurl .
                                                        'r/' . strtolower($this->name) . '/v2.' . $value['release'] . '.xml');
            $this->packageInfo['version']['api'] = $a['a'];
        } else {
            $a = $this->remoteAbridgedInfo = $this->rest->retrieveCacheFirst(
                                                        $this->parent->protocols->rest['REST1.0']->baseurl .
                                                        'r/' . strtolower($this->name) . '/v2.' . $value['release'] . '.xml');
        }
        $this->packageInfo['version'] = $value;
        $this->stability['release'] = $a['st'];
        $this->license['name'] = $a['l'];
        $this->summary = $a['s'];
        $this->description = $a['d'];
        list($this->date, $this->time) = explode(' ', $a['da']);
        $this->notes = $a['n'];
        $this->versionSet = true;
    }

    function download()
    {
        if (!$this->versionSet) {
            // this happens when doing a simple download outside of an install
            $this->rewind();
            $ok = PEAR2_Pyrus_Installer::betterStates($this->minimumStability, true);
            foreach ($this->releaseList as $versioninfo) {
                if (isset($versioninfo['m'])) {
                    // minimum PHP version required
                    if (version_compare($versioninfo['m'], $this->getPHPVersion(), '>=')) {
                        continue;
                    }
                }

                if (!in_array($versioninfo['s'], $ok) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                    // release is not stable enough
                    continue;
                }
                $this->version['release'] = $versioninfo['v'];
                break;
            }
        }
        $url = $this->remoteAbridgedInfo['g'];
        // first try to download .phar, then .tgz, then .tar, then .zip
        $errs = new PEAR2_MultiErrors;
        try {
            return new PEAR2_Pyrus_Package_Remote($url . '.phar');
        } catch (Exception $e) {
            $errs->E_ERROR[] = $e;
        }
    
        try {
            return new PEAR2_Pyrus_Package_Remote($url . '.tgz');
        } catch (Exception $e) {
            $errs->E_ERROR[] = $e;
        }

        try {
            return new PEAR2_Pyrus_Package_Remote($url . '.tar');
        } catch (Exception $e) {
            $errs->E_ERROR[] = $e;
        }

        try {
            return new PEAR2_Pyrus_Package_Remote($url . '.zip');
        } catch (Exception $e) {
            $errs->E_ERROR[] = $e;
            throw new PEAR2_Pyrus_Package_Exception(
                'Could not download abstract package ' .
                $this->channel . '/' .
                $this->name, $errs);
        }
    }

    function offsetGet($var)
    {
        $lowerpackage = strtolower($var);
        try {
            $info = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.0']->baseurl .
                                                    'p/' . $lowerpackage . '/info.xml');
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_Channel_Exception('package ' . $var . ' does not exist', $e);
        }
        if (is_string($this->releaseList)) {
            $ok = PEAR2_Pyrus_Installer::betterStates($this->releaseList, true);
            if (isset($this->parent->protocols->rest['REST1.3'])) {
                $rinfo = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.3']->baseurl .
                                                        'r/' . $lowerpackage . '/allreleases2.xml');
            } else {
                $rinfo = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.0']->baseurl .
                                                        'r/' . $lowerpackage . '/allreleases.xml');
            }
            if (!isset($rinfo['r'][0])) {
                $rinfo['r'] = array($rinfo['r']);
            }
            $releases = array();
            foreach ($rinfo['r'] as $release) {
                if (!in_array($release['s'], $ok)) {
                    continue;
                }
                if (!isset($release['m'])) {
                    $release['m'] = '5.2.0';
                }
                $releases[] = $release;
            }
            $this->releaseList = $releases;
        }
        $pxml = clone $this;
        $pxml->channel = $info['c'];
        $pxml->name = $info['n'];
        $pxml->license = $info['l'];
        $pxml->summary = $info['s'];
        $pxml->description = $info['d'];
        return $pxml;
    }

    function offsetSet($var, $value)
    {
        throw new PEAR2_Pyrus_Channel_Exception('remote channel info is read-only');
    }

    function offsetUnset($var)
    {
        throw new PEAR2_Pyrus_Channel_Exception('remote channel info is read-only');
    }

    /**
     * This is very expensive, use sparingly if at all
     */
    function offsetExists($var)
    {
        try {
            $info = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.0']->baseurl .
                                                    'p/' . strtolower($var) . '/info.xml');
        } catch (Exception $e) {
            return false;
        }
        return true;
    }

    function valid()
    {
        return current($this->releaseList);
    }

    function current()
    {
        $info = current($this->releaseList);
        if (!isset($info['m'])) {
            $info['m'] = '5.2.0'; // guess something lower than us
        }
        // setting this allows us to retrieve information specific to this
        // version
        $this->version['release'] = $info['v'];
        return array('stability' => $info['s'], 'minimumphp' => $info['m']);
    }

    function key()
    {
        $info = current($this->releaseList);
        return $info['v'];
    }

    function next()
    {
        return next($this->releaseList);
    }

    function rewind()
    {
        if ($this->releaseList) {
            return reset($this->releaseList);
        }
        if (!$this->name) {
            throw new PEAR2_Pyrus_Channel_Exception('Cannot iterate without first choosing a remote package');
        }
        if (isset($this->parent->protocols->rest['REST1.3'])) {
            $info = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.3']->baseurl .
                                                    'r/' . strtolower($this->name) . '/allreleases2.xml');
        } else {
            $info = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.0']->baseurl .
                                                    'r/' . strtolower($this->name) . '/allreleases.xml');
        }
        $this->releaseList = $info['r'];
        if (!isset($this->releaseList[0])) {
            $this->releaseList = array($this->releaseList);
        }
    }

    function getDependencies()
    {
        // dynamically retrieve the dependencies from the remote server when requested
        $deps = unserialize($this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.0']->baseurl .
                                                    'r/' . strtolower($this->name) . '/deps.' .
                                                    $this->version['release'] . '.txt'));
        if ($deps) {
            $this->packageInfo['dependencies'] = $deps;
        }
        return parent::getDependencies();
    }

    function getMaintainer()
    {
        if (isset($this->parent->protocols->rest['REST1.2'])) {
            $maintainers = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.2']->baseurl .
                                                    'p/' . strtolower($this->name) . '/maintainers2.xml');
            $maintainers = $maintainers['m'];
            if (!isset($maintainers[0])) {
                $maintainers = array($maintainers);
            }
            $info = array('lead' => array(), 'developer' => array(), 'contributor' => array(), 'helper' => array());
            foreach ($maintainers as $maintainer) {
                $minfo = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.0']->baseurl .
                                                    'm/' . $maintainer['h'] . '/info.xml');
                $info[$maintainer['r']][] = array('name' => $minfo['n'],
                                                  'user' => $maintainer['h'],
                                                  'email' => '*hidden*',
                                                  'active' => 'yes');
            }
        } else {
            $maintainers = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.0']->baseurl .
                                                    'p/' . strtolower($this->name) . '/maintainers.xml');
            $maintainers = $maintainers['m'];
            if (!isset($maintainers[0])) {
                $maintainers = array($maintainers);
            }
            $info = array('lead' => array(), 'developer' => array(), 'contributor' => array(), 'helper' => array());
            foreach ($maintainers as $maintainer) {
                $minfo = $this->rest->retrieveCacheFirst($this->parent->protocols->rest['REST1.0']->baseurl .
                                                    'm/' . $maintainer['h'] . '/info.xml');
                $info['lead'][] = array('name' => $minfo['n'],
                                        'user' => $maintainer['h'],
                                        'email' => '*hidden*',
                                        'active' => 'yes');
            }
        }
        foreach ($info as $role => $peoples) {
            foreach ($peoples as $dev) {
                $this->packageInfo[$role][] = $dev;
            }
        }
        return parent::getMaintainer();
    }

    /**
     * For unit testing purposes
     */
    function getPHPVersion()
    {
        return phpversion();
    }
    /**
     * Figure out which version is best, and use this, or error out if none work
     * @param PEAR2_Pyrus_PackageFile_v2_Dependencies_Package $compositeDep
     *        the composite of all dependencies on this package, as calculated
     *        by {@link PEAR2_Pyrus_Package_Dependency::getCompositeDependency()}
     */
    function figureOutBestVersion(PEAR2_Pyrus_PackageFile_v2_Dependencies_Package $compositeDep)
    {
        // set up release list if not done yet
        $this->rewind();
        $ok = PEAR2_Pyrus_Installer::betterStates($this->minimumStability, true);
        $v = $this->explicitVersion;
        $n = $this->channel . '/' . $this->name;
        $failIfExplicit = function() use ($v, $n) {
            if ($v && $versioninfo['v'] == $v) {
                throw new PEAR2_Pyrus_Channel_Exception($n .
                                                        ' Cannot be installed, it does not satisfy ' .
                                                        'all dependencies');
            }
        };
        foreach ($this->releaseList as $versioninfo) {
            if (isset($versioninfo['m'])) {
                // minimum PHP version required
                if (version_compare($versioninfo['m'], $this->getPHPVersion(), '>=')) {
                    $failIfExplicit();
                    continue;
                }
            }
            // now check for versions satisfying the dependency
            if (isset($compositeDep->min)) {
                if (version_compare($versioninfo['v'], $compositeDep->min, '<')) {
                    $failIfExplicit();
                    continue;
                }
            }
            if (isset($compositeDep->exclude)) {
                foreach ($compositeDep->exclude as $exclude) {
                    if ($versioninfo['v'] == $exclude) {
                        $failIfExplicit();
                        continue 2;
                    }
                }
            }
            if (isset($compositeDep->max)) {
                if (version_compare($versioninfo['v'], $compositeDep->max, '>')) {
                    $failIfExplicit();
                    continue;
                }
            }
            if (isset($compositeDep->recommended)) {
                if ($versioninfo['v'] == $compositeDep->recommended) {
                    // we're done.  That was easy.
                    $this->version['release'] = $versioninfo['v'];
                    return;
                }
                continue;
            }

            if (!in_array($versioninfo['s'], $ok) && !isset(PEAR2_Pyrus_Installer::$options['force'])) {
                // release is not stable enough
                continue;
            }
            if ($this->explicitVersion && $versioninfo['v'] != $this->explicitVersion) {
                continue;
            }
            // found one
            if ($this->versionSet && $versioninfo['v'] != $this->version['release']) {
                // inform the installer we need to reset dependencies
                $this->version['release'] = $versioninfo['v'];
                return true;
            }
            $this->version['release'] = $versioninfo['v'];
            return;
        }
        throw new PEAR2_Pyrus_Channel_Exception('Unable to locate a package release for ' .
                                                $this->channel . '/' . $this->name .
                                                ' that can satisfy all dependencies');
    }
}<?php
/**
 * PEAR2_Pyrus_Channel_IMirror
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Interface for channel mirrors
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
interface PEAR2_Pyrus_Channel_IMirror
{
    public function getChannel();
}<?php
/**
 * PEAR2_Pyrus_Registry_Base
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Base class for a Pyrus Registry
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
abstract class PEAR2_Pyrus_Registry_Base implements PEAR2_Pyrus_IRegistry
{
    protected $packagename;
    protected $packageList = array();

    /**
     * Used by the registry package classes to update info in an installed package
     */
    public function replace(PEAR2_Pyrus_IPackageFile $info)
    {
        return $this->install($info, true);
    }

    function cloneRegistry(PEAR2_Pyrus_Registry_Base $registry)
    {
        try {
            $packageiterator = $registry->package;
            foreach (PEAR2_Pyrus_Config::current()->channelregistry->listChannels() as $channel) {
                $packageiterator->setIteratorChannel($channel);
                foreach ($packageiterator as $package) {
                    if ($this->exists($package->name, $package->channel)) {
                        $old = $this->toPackageFile($package->name, $package->channel);
                        if ($old->date == $package->date && $old->time == $package->time) {
                            continue;
                        }
                    }
                    $this->replace($package);
                }
            }
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot clone registry', $e);
        }
    }
}
<?php
/**
 * PEAR2_Pyrus_Registry_Xml
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * This is the central registry, that is used for all installer options,
 * stored in xml files
 *
 * It is designed for providing redundancy to the Sqlite3 registry and for
 * managing simple installation situations such as bundling a few packages
 * inside another application, or for distributing a registry with an
 * unzip-and-go application that can be used to construct an Sqlite3 registry.
 *
 * File conflict resolution can be done manually, via detectFileConflicts()
 * and is extremely slow, as each installed package must be processed in order
 * to determine the list of installed files.
 * 
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Registry_Xml extends PEAR2_Pyrus_Registry_Base
{
    protected $readonly;
    private $_path;

    function __construct($path, $readonly = false)
    {
        $this->_path = $path;
        $this->readonly = $readonly;
    }

    private function _nameRegistryPath(PEAR2_Pyrus_IPackageFile $info = null,
                                     $channel = null, $package = null, $version = null)
    {
        $channel = $info !== null ? $info->channel : $channel;
        $package = $info !== null ? $info->name : $package;
        $path = $this->_namePath($channel, $package);
        $version = $info !== null ? $info->version['release'] : $version;
        return $path . DIRECTORY_SEPARATOR . $version . '-package.xml';
    }

    private function _namePath($channel, $package)
    {
        return $this->_path . DIRECTORY_SEPARATOR .
            '.xmlregistry' . DIRECTORY_SEPARATOR . 'packages' . DIRECTORY_SEPARATOR .
            str_replace('/', '!', $channel) .
            DIRECTORY_SEPARATOR . $package;
    }

    /**
     * Create the Channel!PackageName-Version-package.xml file
     *
     * @param PEAR2_Pyrus_IPackageFile $pf
     */
    function install(PEAR2_Pyrus_IPackageFile $info, $replace = false)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot install package, registry is read-only');
        }
        // remove previously installed version for upgrade
        $this->uninstall($info->name, $info->channel);
        $packagefile = $this->_nameRegistryPath($info);
        if (!@is_dir(dirname($packagefile))) {
            mkdir(dirname($packagefile), 0755, true);
        }

        if (!$replace) {
            $info->date = date('Y-m-d');
            $info->time = date('H:i:s');
        }
        foreach ($info->files as $name => $file) {
            unset($file->{'install-as'});
        }
        $arr = $info->toArray();
        file_put_contents($packagefile, (string) new PEAR2_Pyrus_XMLWriter($arr));
    }

    function uninstall($package, $channel)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot install package, registry is read-only');
        }
        if (!$this->exists($package, $channel)) {
            return;
        }
        $packagefile = glob($this->_namePath($channel, $package) .
            DIRECTORY_SEPARATOR . '*.xml');
        if (!$packagefile || !isset($packagefile[0])) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot find registry for package ' .
                $channel . '/' . $package);
        }
        unlink($packagefile[0]);
        rmdir(dirname($packagefile[0]));
    }

    public function exists($package, $channel)
    {
        $packagefile = $this->_namePath($channel, $package);
        return @file_exists($packagefile) && @is_dir($packagefile);
    }

    public function info($package, $channel, $field)
    {
        if (!$this->exists($package, $channel)) {
            throw new PEAR2_Pyrus_Registry_Exception('Unknown package ' . $channel .
                '/' . $package);
        }
        $packagefile = glob($this->_namePath($channel, $package) .
            DIRECTORY_SEPARATOR . '*.xml');
        if (!$packagefile || !isset($packagefile[0])) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot find registry for package ' .
                $channel . '/' . $package);
        }
        
        $packageobject = new PEAR2_Pyrus_Package($packagefile[0]);

        if ($field === null) {
            return $packageobject->getInternalPackage()->getPackageFile()->getPackageFileObject();
        }

        if ($field == 'version') {
            $field = 'release-version';
        } elseif ($field == 'installedfiles') {
            $ret = array();
            try {
                $config = new PEAR2_Pyrus_Config_Snapshot($packageobject->date . ' ' . $packageobject->time);
            } catch (Exception $e) {
                throw new PEAR2_Pyrus_Registry_Exception('Cannot retrieve files, config ' .
                                        'snapshot could not be processed', $e);
            }
            $roles = array();
            foreach (PEAR2_Pyrus_Installer_Role::getValidRoles($packageobject->getPackageType()) as $role) {
                // set up a list of file role => configuration variable
                // for storing in the registry
                $roles[$role] =
                    PEAR2_Pyrus_Installer_Role::factory($packageobject->getPackageType(), $role);
            }
            $ret = array();
            foreach ($packageobject->installcontents as $file) {
                $relativepath = $roles[$file->role]->getRelativeLocation($packageobject, $file);
                if (!$relativepath) {
                    continue;
                }
                $filepath = $config->{$roles[$file->role]->getLocationConfig()} .
                    DIRECTORY_SEPARATOR . $relativepath;
                $attrs = $file->getArrayCopy();
                $ret[$filepath] = $attrs['attribs'];
                $ret[$filepath]['installed_as'] = $filepath;
                $ret[$filepath]['relativepath'] = $relativepath;
                $ret[$filepath]['configpath'] = $config->{$roles[$file->role]->getLocationConfig()};
            }
            return $ret;
        } elseif ($field == 'dirtree') {
            $files = $this->info($package, $channel, 'installedfiles');
            foreach ($files as $file => $unused) {
                do {
                    $file = dirname($file);
                    if (strlen($file) > strlen($this->_path)) {
                        $ret[$file] = 1;
                    }
                } while (strlen($file) > strlen($this->_path));
            }
            $ret = array_keys($ret);
            usort($ret, 'strnatcasecmp');
            return array_reverse($ret);
        }

        return $packageobject->$field;
    }

    public function listPackages($channel)
    {
        $dir = $this->_namePath($channel, '');
        if (!@file_exists($dir)) {
            return array();
        }
        $ret = array();
        try {
            $parser = new PEAR2_Pyrus_XMLParser;
            foreach (new DirectoryIterator($dir) as $file) {
                if ($file->isDot()) {
                    continue;
                }
                try {
                    foreach (new DirectoryIterator($file->getPathName()) as $registries) {
                        if ($registries->isDir()) {
                            continue;
                        }
                        $a = $parser->parse($registries->getPathName());
                        $ret[] = $a['package']['name'];
                    }
                } catch (Exception $e) {
                    PEAR2_Pyrus_Log::log(0, 'Warning: corrupted XML registry entry: ' .
                        $file->getPathName() . ': ' . $e);
                }
            }
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_Registry_Exception('Could not open channel directory for ' .
                'channel ' . $channel, $e);
        }
        return $ret;
    }

    public function toPackageFile($package, $channel)
    {
        if (!$this->exists($package, $channel)) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot retrieve package file object ' .
                'for package ' . $channel . '/' . $package . ', it is not installed');
        }
        $packagefile = $this->info($package, $channel, null);
        
        return $packagefile;
    }

    public function __get($var)
    {
        if ($var == 'package') {
            return new PEAR2_Pyrus_Registry_Xml_Package($this);
        }
    }

    /**
     * This is EXTREMELY inefficient, and should only be used
     * if an Sqlite3 registry is unavailable
     */
    public function getDependentPackages(PEAR2_Pyrus_IPackageFile $package)
    {
        // first construct a list of all installed packages
        $all = array();
        $config = PEAR2_Pyrus_Config::current();
        foreach ($config->channelregistry as $channel) {
            foreach ($this->listPackages($channel->name) as $packagename) {
                $all[] = $this->package[$channel->name . '/' . $packagename];
            }
        }

        $ret = array();
        // now scan them to see which packages depend on this one
        foreach ($all as $test) {
            if ($test->isEqual($package)) {
                continue;
            }
            if ($test->dependsOn($package)) {
                $ret[] = $test;
            }
        }
        return $ret;
    }

    /**
     * Detect any files already installed that would be overwritten by
     * files inside the package represented by $package
     */
    public function detectFileConflicts(PEAR2_Pyrus_IPackageFile $package)
    {
        // construct list of all installed files
        $allfiles = array();
        $filesByPackage = array();
        $config = PEAR2_Pyrus_Config::current();
        foreach ($config->channelregistry as $channel) {
            foreach ($this->listPackages($channel->name) as $packagename) {
                $files = $this->info($packagename, $channel->name, 'installedfiles');
                $newfiles = array();
                foreach ($files as $file) {
                    $newfiles[$file['installed_as']] = $file;
                }
                $filesByPackage[$channel->name . '/' . $packagename] = $newfiles;
                $allfiles = array_merge($allfiles, $newfiles);
            }
        }

        // now iterate over each file in the package, and note all the conflicts
        $roles = array();
        foreach (PEAR2_Pyrus_Installer_Role::getValidRoles($package->getPackageType()) as $role) {
            // set up a list of file role => configuration variable
            // for storing in the registry
            $roles[$role] =
                PEAR2_Pyrus_Installer_Role::factory($package->getPackageType(), $role);
        }
        $ret = array();
        foreach ($package->installcontents as $file) {
            $relativepath = $roles[$file->role]->getRelativeLocation($package, $file);
            if (!$relativepath) {
                continue;
            }
            $testpath = $config->{$roles[$file->role]->getLocationConfig()} .
                    DIRECTORY_SEPARATOR . $relativepath;
            if (isset($allfiles[$testpath])) {
                foreach ($filesByPackage as $pname => $files) {
                    if (isset($files[$testpath])) {
                        $ret[] = array($relativepath => $pname);
                        break;
                    }
                }
            }
        }
        return $ret;
    }

    /**
     * Returns a list of registries present in the PEAR installation at $path
     * @param string
     * @return array
     */
    static public function detectRegistries($path)
    {
        if (file_exists($path . '/.xmlregistry') || is_dir($path . '/.xmlregistry')) {
            return array('Xml');
        }
        return array();
    }

    /**
     * Completely remove all traces of an xml registry
     */
    static public function removeRegistry($path)
    {
        if (!file_exists($path . '/.xmlregistry')) {
            return;
        }
        try {
            PEAR2_Pyrus_AtomicFileTransaction::rmrf(realpath($path . DIRECTORY_SEPARATOR . '.xmlregistry'));
        } catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot remove XML registry: ' . $e->getMessage(), $e);
        }
    }
}
<?php
/**
 * PEAR2_Pyrus_Registry_Sqlite3
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * This is the central registry, that is used for all installer options,
 * stored as an SQLite3 database
 *
 * Registry information that must be stored:
 *
 * - A list of installed packages
 * - the files in each package
 * - known channels
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @author    Helgi √ûormar √ûorbj√∂rnsson <helgi@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Registry_Sqlite3 extends PEAR2_Pyrus_Registry_Base
{
    /**
     * The database resources, stored by path
     *
     * This allows singleton access to the database by separate objects
     * @var SQLite3
     */
    static protected $databases = array();
    private $_path;
    protected $readonly;

    /**
     * Initialize the registry
     *
     * @param unknown_type $path
     */
    function __construct($path, $readonly = false)
    {
        $this->readonly = $readonly;
        if ($path && $path != ':memory:') {
            if (dirname($path) . DIRECTORY_SEPARATOR . '.pear2registry' != $path) {
                $path = $path . DIRECTORY_SEPARATOR . '.pear2registry';
            }
        }
        $this->_init($path, $readonly);
        $this->_path = $path ? $path : ':memory:';
    }

    private function _init($path, $readonly)
    {
        if (!$path) {
            $path = ':memory:';
        }
    
        if (isset(static::$databases[$path]) && static::$databases[$path]) {
            return;
        }

        if (!file_exists(dirname($path))) {
            if ($readonly) {
                throw new PEAR2_Pyrus_Registry_Exception('Cannot create SQLite3 registry, registry is read-only');
            }
            @mkdir(dirname($path), 0755, true);
        }

        @(static::$databases[$path] = new SQLite3($path));
        // ScottMac needs to fix sqlite3 FIXME
        if (static::$databases[$path]->lastErrorCode()) {
            $error = static::$databases[$path]->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot open SQLite3 registry: ' . $error);
        }

        $sql = 'SELECT version FROM pearregistryversion';
        if (@static::$databases[$path]->querySingle($sql) == '1.0.0') {
            return;
        }

        if ($readonly) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot create SQLite3 registry, registry is read-only');
        }

        $a = new PEAR2_Pyrus_Registry_Sqlite3_Creator;
        try {
            $a->create(static::$databases[$path]);
        } catch (Exception $e) {
            unset(static::$databases[$path]);
            $a = get_class($e);
            throw new $a('Database initialization failed', 0, $e);
        }
    }

    function getDatabase()
    {
        return $this->_path;
    }

    /**
     * Add an installed package to the registry
     *
     * @param PEAR2_Pyrus_IPackageFile $info
     */
    function install(PEAR2_Pyrus_IPackageFile $info, $replace = false)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot install package, registry is read-only');
        }

        if (!isset(static::$databases[$this->_path])) {
            throw new PEAR2_Pyrus_Registry_Exception('Error: no existing SQLite3 registry for ' . $this->_path);
        }

        try {
            // this ensures upgrade will work
            static::$databases[$this->_path]->exec('BEGIN');
            $this->uninstall($info->name, $info->channel);
        } catch (Exception $e) {
            // ignore errors
        }

        if (!$replace) {
            $info = $info->toRaw();
            // this avoids potential exception on setting date/time
            // which can happen if $info is a registry package that
            // has been uninstalled
            $info->date = date('Y-m-d');
            $info->time = date('H:i:s');
        }

        $licloc = $info->license;
        $licuri = $info->license['uri'];
        $licpath = $info->license['path'];
        $time = ($info->time ? $info->time : null);

        $sql = '
            INSERT INTO packages
              (name, channel, version, apiversion, summary,
               description, stability, apistability, releasedate,
               releasetime, license, licenseuri, licensepath,
               releasenotes, lastinstalledversion, installedwithpear,
               installtimeconfig)
            VALUES(:name, :channel, :versionrelease, :versionapi, :summary,
                :description, :stabilityrelease, :stabilityapi, :date, :time,
                :license, :licenseuri, :licensepath, :notes, :lastinstalledv,
                :lastinstalledp, :lastinstalltime
            )';

        $stmt = static::$databases[$this->_path]->prepare($sql);
        // this odd code eliminates notices
        $n = $info->name;
        $stmt->bindParam(':name',              $n);
        $c = $info->channel;
        $stmt->bindParam(':channel',           $c);
        $rv = $info->version['release'];
        $stmt->bindParam(':versionrelease',    $rv);
        $av = $info->version['api'];
        $stmt->bindParam(':versionapi',        $av);
        $s = $info->summary;
        $stmt->bindParam(':summary',           $s);
        $d = $info->description;
        $stmt->bindParam(':description',       $d);
        $rs = $info->stability['release'];
        $stmt->bindParam(':stabilityrelease',  $rs);
        $ra = $info->stability['api'];
        $stmt->bindParam(':stabilityapi',      $ra);
        $a = $info->date;
        $stmt->bindParam(':date',              $a);
        $stmt->bindParam(':time',              $time);
        $lname = $info->license['name'];
        $stmt->bindParam(':license',           $lname);
        $stmt->bindParam(':licenseuri',        $licuri, ($licuri === null) ? SQLITE3_NULL : SQLITE3_TEXT);
        $stmt->bindParam(':licensepath',       $licpath, ($licpath === null) ? SQLITE3_NULL : SQLITE3_TEXT);
        $t = $info->notes;
        $stmt->bindParam(':notes',             $t);
        $o = null;
        $stmt->bindParam(':lastinstalledv',    $o, SQLITE3_NULL);
        $v = '2.0.0';
        $stmt->bindParam(':lastinstalledp',    $v);
        $configsnapshot = PEAR2_Pyrus_Config::configSnapshot();
        $stmt->bindParam(':lastinstalltime',   $configsnapshot);

        if (!@$stmt->execute()) {
            static::$databases[$this->_path]->exec('ROLLBACK');
            throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                $info->channel . '/' . $info->name . ' could not be installed in registry: ' . static::$databases[$this->_path]->lastErrorMsg());
        }
        $stmt->close();

        $sql = '
            INSERT INTO maintainers
              (packages_name, packages_channel, role, name, user, email, active)
            VALUES
                (:name, :channel, :role, :m_name, :m_user, :m_email, :m_active)';

        $stmt = static::$databases[$this->_path]->prepare($sql);
        $n = $info->name;
        $c = $info->channel;
        foreach ($info->allmaintainers as $role => $maintainers) {
            foreach ($maintainers as $maintainer) {
                $stmt->clear();
                $stmt->bindParam(':name',     $n);
                $stmt->bindParam(':channel',  $c);
                $stmt->bindParam(':role',     $role);
                $mn = $maintainer->name;
                $stmt->bindParam(':m_name',   $mn);
                $mu = $maintainer->user;
                $stmt->bindParam(':m_user',   $mu);
                $me = $maintainer->email;
                $stmt->bindParam(':m_email',  $me);
                $ma = $maintainer->active;
                $stmt->bindParam(':m_active', $ma);

                if (!@$stmt->execute()) {
                    static::$databases[$this->_path]->exec('ROLLBACK');
                    throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                        $info->channel . '/' . $info->name . ' could not be installed in registry');
                }
            }
        }
        $stmt->close();

        $curconfig = PEAR2_Pyrus_Config::current();
        $roles     = array();

        $sql = '
            INSERT INTO configureoptions
              (packages_name, packages_channel, name, prompt, defaultValue)
            VALUES(:name, :channel, :oname, :prompt, :default)';

        $stmt = static::$databases[$this->_path]->prepare($sql);

        $stmt->bindValue(':name',     $n);
        $stmt->bindValue(':channel',  $c);
        
        foreach ($info->configureoption as $option) {
            $stmt->bindValue(':oname', $option->name);
            $stmt->bindValue(':prompt', $option->prompt);
            if ($option->default === null) {
                $stmt->bindValue(':default', null, SQLITE3_NULL);
            } else {
                $stmt->bindValue(':default', $option->default);
            }
        }

        $sql = '
            INSERT INTO files
              (packages_name, packages_channel, packagepath, configpath, role,
               relativepath, origpath, baseinstalldir, tasks)
            VALUES(:name, :channel, :path, :configpath, :role, :relativepath, :origpath, :baseinstall, :tasks)';

        $stmt = static::$databases[$this->_path]->prepare($sql);

        $stmt->bindParam(':name',     $n);
        $stmt->bindParam(':channel',  $c);
        foreach (PEAR2_Pyrus_Installer_Role::getValidRoles($info->getPackageType()) as $role) {
            // set up a list of file role => configuration variable
            // for storing in the registry
            $roles[$role] =
                PEAR2_Pyrus_Installer_Role::factory($info->getPackageType(), $role);
        }

        foreach ($info->installcontents as $file) {
            $relativepath = $roles[$file->role]->getRelativeLocation($info, $file);
            if (!$relativepath) {
                continue;
            }

            $stmt->bindParam(':relativepath', $relativepath);
            $p = $curconfig->{$roles[$file->role]->getLocationConfig()};
            $stmt->bindParam(':configpath',         $p);
            $stmt->bindValue(':path', $p . DIRECTORY_SEPARATOR . $relativepath);
            $o = $file['attribs']['name'];
            $stmt->bindParam(':origpath',     $o);
            $r = $file->role;
            $stmt->bindParam(':role',         $r);
            $bi = $file->baseinstalldir;
            $stmt->bindParam(':baseinstall',  $bi);
            $stmt->bindValue(':tasks',        serialize($file->tasks));

            if (!@$stmt->execute()) {
                static::$databases[$this->_path]->exec('ROLLBACK');
                throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                    $info->channel . '/' . $info->name . ' could not be installed in registry');
            }
        }
        $stmt->close();

        $sql = '
            INSERT INTO baseinstalldirs
              (packages_name, packages_channel, dirname, baseinstall)
            VALUES(:name, :channel, :dirname, :baseinstall)';

        $stmt = static::$databases[$this->_path]->prepare($sql);

        foreach ($info->getBaseInstallDirs() as $dir => $base) {
            $stmt->bindParam(':name',        $n);
            $stmt->bindParam(':channel',     $c);
            $stmt->bindParam(':dirname',     $dir);
            $stmt->bindParam(':baseinstall', $base);

            if (!@$stmt->execute()) {
                static::$databases[$this->_path]->exec('ROLLBACK');
                throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                    $info->channel . '/' . $info->name . ' could not be installed in registry');
            }
        }
        $stmt->close();

        if (count($info->compatible)) {
            $sql = '
                INSERT INTO compatible_releases
                    (packages_name, packages_channel,
                     compat_package, compat_channel, min, max)
                VALUES
                    (:name, :channel, :cname, :cchannel, :min, :max)';
            $stmt = static::$databases[$this->_path]->prepare($sql);

            $stmt->bindValue(':name', $n);
            $stmt->bindValue(':channel', $c);

            $sql2 = '
                INSERT INTO compatible_releases_exclude
                    (packages_name, packages_channel,
                     compat_package, compat_channel, exclude)
                VALUES
                    (:name, :channel, :cname, :cchannel, :exclude)';
            $stmt2 = static::$databases[$this->_path]->prepare($sql2);

            $stmt2->bindValue(':name', $n);
            $stmt2->bindValue(':channel', $c);
            foreach ($info->compatible as $compatible) {
                $stmt->bindValue(':cname', $compatible->name);
                $stmt->bindValue(':cchannel', $compatible->channel);
                $stmt->bindValue(':min', $compatible->min);
                $stmt->bindValue(':max', $compatible->max);
                if (!@$stmt->execute()) {
                    static::$databases[$this->_path]->exec('ROLLBACK');
                    throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                        $info->channel . '/' . $info->name . ' could not be installed in registry');
                }
                if (isset($compatible->exclude)) {
                    $stmt2->bindValue(':cname', $compatible->name);
                    $stmt2->bindValue(':cchannel', $compatible->channel);
                    foreach ($compatible->exclude as $exclude) {
                        $stmt2->bindValue(':exclude', $exclude);
                        if (!@$stmt2->execute()) {
                            static::$databases[$this->_path]->exec('ROLLBACK');
                            throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                                $info->channel . '/' . $info->name . ' could not be installed in registry');
                        }
                    }
                }
            }
        }

        $sql = '
            INSERT INTO extension_dependencies
                (required, packages_name, packages_channel, extension,
                 conflicts, min, max, recommended)
            VALUES
                (:required, :name, :channel, :extension,
                 :conflicts, :min, :max, :recommended)';
        $stmt = static::$databases[$this->_path]->prepare($sql);
        $first = true;
        foreach (array('required', 'optional') as $required) {
            foreach ($info->dependencies[$required]->extension as $d) {
                // $d is a PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object
                $dmin         = $d->min;
                $dmax         = $d->max;
                $drecommended = $d->recommended;
                $ext          = $d->name;

                if (!$first) {
                    $stmt->clear();
                    $first = false;
                }
                $req = ($required == 'required' ? 1 : 0);
                $stmt->bindParam(':required', $req, SQLITE3_INTEGER);
                $stmt->bindParam(':name', $n);
                $stmt->bindParam(':channel', $c);
                $stmt->bindParam(':extension', $ext);
                $con = $d->conflicts;
                $stmt->bindParam(':conflicts', $con, SQLITE3_INTEGER);
                $stmt->bindParam(':min', $dmin);
                $stmt->bindParam(':max', $dmax);
                $stmt->bindParam(':recommended', $drecommended);

                if (!@$stmt->execute()) {
                    static::$databases[$this->_path]->exec('ROLLBACK');
                    throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                        $info->channel . '/' . $info->name . ' could not be installed in registry');
                }

                if (isset($d->exclude)) {
                    $sql = '
                        INSERT INTO extension_dependencies_exclude
                         (required, packages_name, packages_channel,
                          extension, exclude, conflicts)
                        VALUES(:required, :name, :channel, :extension,
                               :exclude, :conflicts)';

                    $stmt1 = static::$databases[$this->_path]->prepare($sql);
                    foreach ($d->exclude as $exclude) {
                        $stmt1->clear();
                        $req = ($required == 'required' ? 1 : 0);
                        $stmt1->bindParam(':required', $req, SQLITE3_INTEGER);
                        $stmt1->bindParam(':name', $n);
                        $stmt1->bindParam(':channel', $c);
                        $stmt1->bindParam(':extension', $ext);
                        $stmt1->bindParam(':exclude', $exclude);
                        $con = $d->conflicts;
                        $stmt1->bindParam(':conflicts', $con, SQLITE3_INTEGER);

                        if (!@$stmt1->execute()) {
                            static::$databases[$this->_path]->exec('ROLLBACK');
                            throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                                $info->channel . '/' . $info->name . ' could not be installed in registry');
                        }
                    }
                    $stmt1->close();
                }
            }
        }
        $stmt->close();

        $sql = '
            INSERT INTO package_dependencies
                (required, packages_name, packages_channel, deppackage,
                 depchannel, conflicts, min, max, recommended, is_subpackage, providesextension)
            VALUES
                (:required, :name, :channel, :dep_package, :dep_channel,
                 :conflicts, :min, :max, :recommended, :sub, :ext)';
        $stmt = static::$databases[$this->_path]->prepare($sql);

        $first = true;
        foreach (array('required', 'optional') as $required) {
            foreach (array('package', 'subpackage') as $package) {
                foreach ($info->dependencies[$required]->$package as $d) {
                    // $d is a PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object
                    $dchannel     = $d->channel;
                    $dmin         = $d->min;
                    $dmax         = $d->max;
                    $drecommended = $d->recommended;
                    $dname        = $d->name;
                    $sub          = $package == 'subpackage';
                    $ext          = $d->providesextension;

                    if (!$first) {
                        $stmt->clear();
                        $first = false;
                    }
                    $req = ($required == 'required' ? 1 : 0);
                    $stmt->bindParam(':required', $req, SQLITE3_INTEGER);
                    $stmt->bindParam(':name', $n);
                    $stmt->bindParam(':channel', $c);
                    $stmt->bindParam(':dep_package', $dname);
                    $stmt->bindParam(':dep_channel', $dchannel);
                    $con = $d->conflicts;
                    $stmt->bindParam(':conflicts', $con, SQLITE3_INTEGER);
                    $stmt->bindParam(':min', $dmin);
                    $stmt->bindParam(':max', $dmax);
                    $stmt->bindParam(':recommended', $drecommended);
                    $stmt->bindParam(':sub', $sub);
                    if ($ext) {
                        $stmt->bindParam(':ext', $ext);
                    } else {
                        $stmt->bindParam(':ext', $ext, SQLITE3_NULL);
                    }

                    if (!@$stmt->execute()) {
                        static::$databases[$this->_path]->exec('ROLLBACK');
                        throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                            $info->channel . '/' . $info->name . ' could not be installed in registry');
                    }

                    if (isset($d->exclude)) {

                        $sql = '
                            INSERT INTO package_dependencies_exclude
                             (required, packages_name, packages_channel,
                              deppackage, depchannel, exclude, conflicts, is_subpackage)
                            VALUES(:required, :name, :channel, :dep_package,
                                :dep_channel, :exclude, :conflicts, :sub)';

                        $stmt1 = static::$databases[$this->_path]->prepare($sql);
                        foreach ($d->exclude as $exclude) {
                            $stmt1->clear();
                            $req = ($required == 'required' ? 1 : 0);
                            $stmt1->bindParam(':required', $req, SQLITE3_INTEGER);
                            $stmt1->bindParam(':name', $n);
                            $stmt1->bindParam(':channel', $c);
                            $stmt1->bindParam(':dep_package', $dname);
                            $stmt1->bindParam(':dep_channel', $dchannel);
                            $stmt1->bindParam(':exclude', $exclude);
                            $stmt1->bindParam(':sub', $sub);
                            $con = $d->conflicts;
                            $stmt1->bindParam(':conflicts', $con, SQLITE3_INTEGER);

                            if (!@$stmt1->execute()) {
                                static::$databases[$this->_path]->exec('ROLLBACK');
                                throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                                    $info->channel . '/' . $info->name . ' could not be installed in registry');
                            }
                        }
                        $stmt1->close();
                    }
                }
            }
        }
        $stmt->close();

        $sql = '
            INSERT INTO php_dependencies
              (packages_name, packages_channel, min, max)
            VALUES
                (:name, :channel, :min, :max)';

        $min = $info->dependencies['required']->php->min;
        $max = $info->dependencies['required']->php->max;
        $stmt = static::$databases[$this->_path]->prepare($sql);

        $stmt->bindParam(':name', $n);
        $stmt->bindParam(':channel', $c);
        $stmt->bindParam(':min', $min);
        if ($max === null) {
            $stmt->bindParam(':max', $max, SQLITE3_NULL);
        } else {
            $stmt->bindParam(':max', $max);
        }
        if (!@$stmt->execute()) {
            static::$databases[$this->_path]->exec('ROLLBACK');
            throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                $info->channel . '/' . $info->name . ' could not be installed in registry');
        }
        $stmt->close();

        $sql = '
            INSERT INTO php_dependencies_exclude
              (packages_name, packages_channel, exclude)
            VALUES
                (:name, :channel, :exclude)';
        $stmt = static::$databases[$this->_path]->prepare($sql);

        if ($info->dependencies['required']->php->exclude) {
            foreach ($info->dependencies['required']->php->exclude as $exclude) {
                $stmt->bindParam(':name', $n);
                $stmt->bindParam(':channel', $c);
                $stmt->bindParam(':exclude', $exclude);
                if (!$stmt->execute()) {
                    static::$databases[$this->_path]->exec('ROLLBACK');
                    throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                        $info->channel . '/' . $info->name . ' could not be installed in registry');
                }
            }
        }
        $stmt->close();

        $sql = '
            INSERT INTO pearinstaller_dependencies
              (packages_name, packages_channel, min, max)
            VALUES
                (:name, :channel, :min, :max)';

        $min = $info->dependencies['required']->pearinstaller->min;
        $max = $info->dependencies['required']->pearinstaller->max;
        $stmt = static::$databases[$this->_path]->prepare($sql);

        $stmt->bindParam(':name', $n);
        $stmt->bindParam(':channel', $c);
        $stmt->bindParam(':min', $min);
        if ($max === null) {
            $stmt->bindParam(':max', $max, SQLITE3_NULL);
        } else {
            $stmt->bindParam(':max', $max);
        }
        if (!@$stmt->execute()) {
            static::$databases[$this->_path]->exec('ROLLBACK');
            throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                $info->channel . '/' . $info->name . ' could not be installed in registry');
        }
        $stmt->close();

        $sql = '
            INSERT INTO pearinstaller_dependencies_exclude
              (packages_name, packages_channel, exclude)
            VALUES
                (:name, :channel, :exclude)';
        $stmt = static::$databases[$this->_path]->prepare($sql);

        if ($info->dependencies['required']->pearinstaller->exclude) {
            foreach ($info->dependencies['required']->pearinstaller->exclude as $exclude) {
                $stmt->bindParam(':name', $n);
                $stmt->bindParam(':channel', $c);
                $stmt->bindParam(':exclude', $exclude);
                if (!$stmt->execute()) {
                    static::$databases[$this->_path]->exec('ROLLBACK');
                    throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                        $info->channel . '/' . $info->name . ' could not be installed in registry');
                }
            }
        }
        $stmt->close();

        if (isset($info->dependencies['required']->os)) {
            $sql = '
                INSERT INTO os_dependencies
                  (packages_name, packages_channel, osname, conflicts)
                VALUES
                    (:name, :channel, :os, :conflicts)';
            $stmt = static::$databases[$this->_path]->prepare($sql);

            foreach ($info->dependencies['required']->os as $dep) {

                $stmt->clear();
                $stmt->bindParam(':name', $n);
                $stmt->bindParam(':channel', $c);
                $name = $dep->name;
                $stmt->bindParam(':os', $name);
                $conflicts = $dep->conflicts;
                $stmt->bindParam(':conflicts', $conflicts, SQLITE3_INTEGER);
                if (!@$stmt->execute()) {
                    static::$databases[$this->_path]->exec('ROLLBACK');
                    throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                        $info->channel . '/' . $info->name . ' could not be installed in registry');
                }
            }
            $stmt->close();
        }

        if (isset($info->dependencies['required']->arch)) {
            $sql = '
                INSERT INTO arch_dependencies
                  (packages_name, packages_channel, pattern, conflicts)
                VALUES
                    (:name, :channel, :arch, :conflicts)';

            $stmt = static::$databases[$this->_path]->prepare($sql);
            foreach ($info->dependencies['required']->arch as $dep) {

                $stmt->clear();
                $stmt->bindParam(':name', $n);
                $stmt->bindParam(':channel', $c);
                $name = $dep->pattern;
                $stmt->bindParam(':arch', $name);
                $conflicts = isset($dep->conflicts);
                $stmt->bindParam(':conflicts', $conflicts, SQLITE3_INTEGER);
                if (!@$stmt->execute()) {
                    static::$databases[$this->_path]->exec('ROLLBACK');
                    throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                        $info->channel . '/' . $info->name . ' could not be installed in registry');
                }
            }
            $stmt->close();
        }

        foreach ($info->dependencies['group'] as $group) {
            $gn = $group->name;
            $gh = $group->hint;

            $sql = '
                INSERT INTO dep_groups
                    (packages_name, packages_channel, groupname, grouphint)
                VALUES
                    (:name, :channel, :groupname, :grouphint)';
            $stmt = static::$databases[$this->_path]->prepare($sql);
            $stmt->bindParam(':name', $n);
            $stmt->bindParam(':channel', $c);
            $stmt->bindParam(':groupname', $gn);
            $stmt->bindParam(':grouphint', $gh);

            if (!@$stmt->execute()) {
                static::$databases[$this->_path]->exec('ROLLBACK');
                throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                    $info->channel . '/' . $info->name . ' could not be installed in registry');
            }
            $stmt->close();

            $sql = '
                INSERT INTO extension_dependencies
                    (required, packages_name, packages_channel, extension,
                     conflicts, min, max, recommended, groupname)
                VALUES
                    (0, :name, :channel, :extension,
                     :conflicts, :min, :max, :recommended, :groupname)';

            $stmt = static::$databases[$this->_path]->prepare($sql);
            foreach ($group->extension as $d) {
                // $d is a PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object
                $dmin         = $d->min;
                $dmax         = $d->max;
                $drecommended = $d->recommended;
                $ext          = $d->name;

                $stmt->clear();
                $stmt->bindParam(':name', $n);
                $stmt->bindParam(':channel', $c);
                $stmt->bindParam(':extension', $ext);
                $con = $d->conflicts;
                $stmt->bindParam(':conflicts', $con, SQLITE3_INTEGER);
                $stmt->bindParam(':min', $dmin);
                $stmt->bindParam(':max', $dmax);
                $stmt->bindParam(':recommended', $drecommended);
                $stmt->bindParam(':groupname', $gn);

                if (!@$stmt->execute()) {
                    static::$databases[$this->_path]->exec('ROLLBACK');
                    throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                        $info->channel . '/' . $info->name . ' could not be installed in registry');
                }

                if (isset($d->exclude)) {
                    $sql = '
                        INSERT INTO extension_dependencies_exclude
                         (required, packages_name, packages_channel,
                          extension, exclude, conflicts, groupname)
                        VALUES(0, :name, :channel, :extension,
                               :exclude, :conflicts, :groupname)';

                    $stmt1 = static::$databases[$this->_path]->prepare($sql);
                    foreach ($d->exclude as $exclude) {
                        $stmt1->clear();
                        $stmt1->bindParam(':name', $n);
                        $stmt1->bindParam(':channel', $c);
                        $stmt1->bindParam(':extension', $ext);
                        $stmt1->bindParam(':exclude', $exclude);
                        $con = $d->conflicts;
                        $stmt1->bindParam(':conflicts', $con, SQLITE3_INTEGER);
                        $stmt1->bindParam(':groupname', $gn);

                        if (!@$stmt1->execute()) {
                            static::$databases[$this->_path]->exec('ROLLBACK');
                            throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                                $info->channel . '/' . $info->name . ' could not be installed in registry');
                        }
                    }
                    $stmt1->close();
                }
            }
            $stmt->close();
    
            $sql = '
                INSERT INTO package_dependencies
                  (required, packages_name, packages_channel, deppackage,
                   depchannel, conflicts, min, max, recommended, is_subpackage, groupname, providesextension)
                VALUES
                    (0, :name, :channel, :dep_package, :dep_channel, :conflicts, :min, :max, :recommended, :sub,
                     :group, :ext)';

            $stmt = static::$databases[$this->_path]->prepare($sql);
            foreach (array('package', 'subpackage') as $package) {
                foreach ($group->$package as $d) {
                    // $d is a PEAR2_Pyrus_PackageFile_v2_Dependencies_Package object
                    $dchannel     = $d->channel;
                    $dmin         = $d->min;
                    $dmax         = $d->max;
                    $dname        = $d->name;
                    $drecommended = $d->recommended;
                    $sub          = $package == 'subpackage';
                    $ext          = $d->providesextension;

                    $stmt->clear();
                    $stmt->bindParam(':name', $n);
                    $stmt->bindParam(':channel', $c);
                    $stmt->bindParam(':dep_package', $dname);
                    $stmt->bindParam(':dep_channel', $dchannel);
                    $con = $d->conflicts;
                    $stmt->bindParam(':conflicts', $con, SQLITE3_INTEGER);
                    $stmt->bindParam(':min', $dmin);
                    $stmt->bindParam(':max', $dmax);
                    $stmt->bindParam(':recommended', $drecommended);
                    $stmt->bindParam(':sub', $sub);
                    $stmt->bindParam(':group', $gn);
                    if ($ext) {
                        $stmt->bindParam(':ext', $ext);
                    } else {
                        $stmt->bindParam(':ext', $ext, SQLITE3_NULL);
                    }

                    if (!@$stmt->execute()) {
                        static::$databases[$this->_path]->exec('ROLLBACK');
                        throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                            $info->channel . '/' . $info->name . ' could not be installed in registry');
                    }

                    if (isset($d->exclude)) {

                        $sql = '
                            INSERT INTO package_dependencies_exclude
                             (required, packages_name, packages_channel,
                              deppackage, depchannel, exclude, conflicts, is_subpackage, groupname)
                            VALUES(0, :name, :channel, :dep_package,
                                :dep_channel, :exclude, :conflicts, :sub, :group)';

                        $stmt1 = static::$databases[$this->_path]->prepare($sql);
                        foreach ($d->exclude as $exclude) {
                            $stmt1->clear();
                            $req = 0;
                            $stmt1->bindParam(':required', $req, SQLITE3_INTEGER);
                            $stmt1->bindParam(':name',        $n);
                            $stmt1->bindParam(':channel',     $c);
                            $stmt1->bindParam(':dep_package', $dname);
                            $stmt1->bindParam(':dep_channel', $dchannel);
                            $stmt1->bindParam(':exclude',     $exclude);
                            $stmt1->bindParam(':sub', $sub);
                            $stmt1->bindParam(':group', $gn);
                            $con = $d->conflicts;
                            $stmt1->bindParam(':conflicts', $con, SQLITE3_INTEGER);

                            if (!@$stmt1->execute()) {
                                static::$databases[$this->_path]->exec('ROLLBACK');
                                throw new PEAR2_Pyrus_Registry_Exception('Error: package ' .
                                    $info->channel . '/' . $info->name . ' could not be installed in registry');
                            }
                        }
                        $stmt1->close();
                    }
                }
            }
        }
        $stmt->close();

        static::$databases[$this->_path]->exec('COMMIT');
    }

    function uninstall($package, $channel)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot uninstall package, registry is read-only');
        }

        if (!isset(static::$databases[$this->_path])) {
            throw new PEAR2_Pyrus_Registry_Exception('Error: no existing SQLite3 registry for ' . $this->_path);
        }

        $channel = PEAR2_Pyrus_Config::current()->channelregistry[$channel]->name;
        if (!$this->exists($package, $channel)) {
            throw new PEAR2_Pyrus_Registry_Exception('Unknown package ' . $channel . '/' .
                $package);
        }

        $sql = 'DELETE FROM packages WHERE name = "' .
              static::$databases[$this->_path]->escapeString($package) . '" AND channel = "' .
              static::$databases[$this->_path]->escapeString($channel) . '"';
        static::$databases[$this->_path]->exec($sql);
    }

    function exists($package, $channel)
    {
        if (!isset(static::$databases[$this->_path])) {
            throw new PEAR2_Pyrus_Registry_Exception('Error: no existing SQLite3 registry for ' . $this->_path);
        }

        $sql = 'SELECT
                    COUNT(name)
                FROM packages
                WHERE
                    name = :name AND channel = :channel
            ';
        $stmt = static::$databases[$this->_path]->prepare($sql);
        $stmt->bindParam(':name',    $package);
        $stmt->bindParam(':channel', $channel);
        $result = @$stmt->execute();

        if (!$result) {
            $error = static::$databases[$this->_path]->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot search for package ' . $channel . '/' . $package .
                ': ' . $error);
        }
        $ret = $result->fetchArray(SQLITE3_NUM);
        return $ret[0];
    }

    function info($package, $channel, $field)
    {
        if (!isset(static::$databases[$this->_path])) {
            throw new PEAR2_Pyrus_Registry_Exception('Error: no existing SQLite3 registry for ' . $this->_path);
        }

        if ($field == 'api-state') {
            $field = 'apistability';
        } elseif ($field == 'state') {
            $field = 'stability';
        } elseif ($field == 'release-version') {
            $field = 'version';
        } elseif ($field == 'api-version') {
            $field = 'apiversion';
        } elseif ($field == 'notes') {
            $field = 'releasenotes';
        } elseif ($field == 'date') {
            $field = 'releasedate';
        } elseif ($field == 'time') {
            $field = 'releasetime';
        } elseif ($field == 'installedfiles') {
            $ret = array();
            $sql = 'SELECT
                        configpath, relativepath, role, origpath, baseinstalldir
                    FROM files
                    WHERE
                        packages_name = :name AND packages_channel = :channel';

            $stmt = static::$databases[$this->_path]->prepare($sql);
            $stmt->bindParam(':name',    $package);
            $stmt->bindParam(':channel', $channel);
            $result = @$stmt->execute();

            if (!$result) {
                $error = static::$databases[$this->_path]->lastErrorMsg();
                throw new PEAR2_Pyrus_Registry_Exception('Cannot retrieve ' . $field .
                    ': ' . $error);
            }

            while ($file = $result->fetchArray(SQLITE3_ASSOC)) {
                if ($file['baseinstalldir']) {
                    $ret[$file['configpath'] . DIRECTORY_SEPARATOR . $file['relativepath']] =
                                                      array('role' => $file['role'],
                                                       'name' => $file['origpath'],
                                                       'baseinstalldir' => $file['baseinstalldir'],
                                                       'installed_as' => $file['configpath'] . DIRECTORY_SEPARATOR . $file['relativepath'],
                                                       'relativepath' => $file['relativepath'],
                                                       'configpath' => $file['configpath'],
                                                      );
                } else {
                    $ret[$file['configpath'] . DIRECTORY_SEPARATOR . $file['relativepath']] =
                                                      array('role' => $file['role'],
                                                       'name' => $file['origpath'],
                                                       'installed_as' => $file['configpath'] . DIRECTORY_SEPARATOR . $file['relativepath'],
                                                       'relativepath' => $file['relativepath'],
                                                       'configpath' => $file['configpath'],
                                                      );
                }
            }
            $stmt->close();

            return $ret;
        } elseif ($field == 'dirtree') {
            // if we are :memory: this can't work
            if ($this->_path === ':memory:') {
                return array();
            }

            $actual = dirname($this->_path);

            $files = $this->info($package, $channel, 'installedfiles');
            foreach ($files as $file => $unused) {
                do {
                    $file = dirname($file);
                    if (strlen($file) > strlen($actual)) {
                        $ret[$file] = 1;
                    }
                } while (strlen($file) > strlen($actual));
            }
            $ret = array_keys($ret);
            usort($ret, 'strnatcasecmp');
            return array_reverse($ret);
        }

        $sql = ' SELECT ' . $field . ' FROM packages WHERE
            name = \'' . static::$databases[$this->_path]->escapeString($package) . '\' AND
            channel = \'' . static::$databases[$this->_path]->escapeString($channel) . '\'';

        $info = @static::$databases[$this->_path]->querySingle($sql);
        if (static::$databases[$this->_path]->lastErrorCode()) {
            $error = static::$databases[$this->_path]->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot retrieve ' . $field .
                ': ' . $error);
        }

        return $info;
    }

    /**
     * List all packages in a given channel
     *
     * @param string $channel name of the channel being queried
     *
     * @return array One dimensional array with the package name as value
     */
    public function listPackages($channel)
    {
        if (!isset(static::$databases[$this->_path])) {
            throw new PEAR2_Pyrus_Registry_Exception('Error: no existing SQLite3 registry for ' . $this->_path);
        }

        $ret = array();
        $sql = 'SELECT name FROM packages WHERE channel = :channel ORDER BY name';
        $stmt = static::$databases[$this->_path]->prepare($sql);
        $stmt->bindParam(':channel', $channel);
        $result = @$stmt->execute();

        while ($res = $result->fetchArray(SQLITE3_NUM)) {
            $ret[] = $res[0];
        }

        return $ret;
    }

    function __get($var)
    {
        if ($var === 'package') {
            return new PEAR2_Pyrus_Registry_Sqlite3_Package($this);
        }
    }

    /**
     * Extract a packagefile object from the registry
     * @return PEAR2_Pyrus_PackageFile_v2
     */
    function toPackageFile($package, $channel)
    {
        if (!isset(static::$databases[$this->_path])) {
            throw new PEAR2_Pyrus_Registry_Exception('Error: no existing SQLite3 registry for ' . $this->_path);
        }
        if (!$this->exists($package, $channel)) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot retrieve package file object ' .
                'for package ' . $channel . '/' . $package . ', it is not installed');
        }
        $ret = new PEAR2_Pyrus_PackageFile_v2;
        $ret->name        = $package;
        $ret->channel     = $channel;
        $ret->summary     = $this->info($package, $channel, 'summary');
        $ret->description = $this->info($package, $channel, 'description');

        $sql = 'SELECT * FROM maintainers
                WHERE packages_name = :name AND packages_channel = :channel';

        $stmt = static::$databases[$this->_path]->prepare($sql);
        $stmt->bindParam(':name',    $package);
        $stmt->bindParam(':channel', $channel);
        $result = @$stmt->execute();

        if (!$result) {
            throw new PEAR2_Pyrus_Registry_Exception('Could not retrieve package file object' .
                ' for package ' . $channel . '/' . $package . ', no maintainers registered');
        }

        while ($maintainer = $result->fetchArray(SQLITE3_ASSOC)) {
            $ret->maintainer[$maintainer['user']]
                ->name($maintainer['name'])
                ->role($maintainer['role'])
                ->email($maintainer['email'])
                ->active($maintainer['active']);
        }
        $stmt->close();

        $ret->date = $this->info($package, $channel, 'date');
        // FIXME why are we querying the same info twice ?
        if ($a = $this->info($package, $channel, 'time')) {
            $ret->time = $this->info($package, $channel, 'time');
        }

        $ret->version['release']   = $this->info($package, $channel, 'version');
        $ret->version['api']       = $this->info($package, $channel, 'apiversion');
        $ret->stability['release'] = $this->info($package, $channel, 'stability');
        $ret->stability['api']     = $this->info($package, $channel, 'apistability');
        $uri     = $this->info($package, $channel, 'licenseuri');
        $path    = $this->info($package, $channel, 'licensepath');
        $license = $this->info($package, $channel, 'license');
        if ($uri) {
            $ret->rawlicense = array('attribs' => array('uri' => $uri), '_content' => $license);
        } elseif ($path) {
            $ret->rawlicense = array('attribs' => array('path' => $path), '_content' => $license);
        } else {
            $ret->license = $license;
        }
        $ret->notes = $this->info($package, $channel, 'releasenotes');

        $sql = 'SELECT * FROM files
                WHERE packages_name = :name AND packages_channel = :channel';

        $stmt = static::$databases[$this->_path]->prepare($sql);
        $stmt->bindParam(':name',    $package);
        $stmt->bindParam(':channel', $channel);
        $result = @$stmt->execute();

        if (!$result) {
            throw new PEAR2_Pyrus_Registry_Exception('Could not retrieve package file object' .
                ' for package ' . $channel . '/' . $package . ', no files registered');
        }

        while ($file = $result->fetchArray(SQLITE3_ASSOC)) {
            $ret->files[$file['origpath']] = array_merge(
                                                array('attribs' => array('role' => $file['role'])),
                                                unserialize($file['tasks']));
            if ($file['baseinstalldir']) {
                $ret->setFileAttribute($file['origpath'], 'baseinstalldir', $file['baseinstalldir']);
            }
        }
        $stmt->close();

        $sql = 'SELECT dirname, baseinstall FROM baseinstalldirs
                WHERE packages_name = :name AND packages_channel = :channel';

        $stmt = static::$databases[$this->_path]->prepare($sql);
        $stmt->bindParam(':name',    $package);
        $stmt->bindParam(':channel', $channel);
        $result = @$stmt->execute();

        if (!$result) {
            throw new PEAR2_Pyrus_Registry_Exception('Could not retrieve package file object' .
                ' for package ' . $channel . '/' . $package . ', no files registered');
        }

        $dirs = array();
        while ($dir = $result->fetchArray(SQLITE3_ASSOC)) {
            $dirs[$dir['dirname']] = $dir['baseinstall'];
        }
        $ret->setBaseInstallDirs($dirs);
        $stmt->close();

        $sql = 'SELECT * FROM configureoptions
                WHERE
                    packages_name = "' . static::$databases[$this->_path]->escapeString($package) . '" AND
                    packages_channel = "' . static::$databases[$this->_path]->escapeString($channel) . '"';
        $a = static::$databases[$this->_path]->query($sql);

        while ($option = $a->fetchArray()) {
            $ret->configureoption[$option['name']]->prompt($option['prompt'])->default($option['defaultValue']);
        }
        $this->fetchCompatible($ret);
        $this->fetchDeps($ret);
        $ret->release = null;
        return $ret;
    }

    function fetchCompatible(PEAR2_Pyrus_IPackageFile $ret)
    {
        $package = $ret->name;
        $channel = $ret->channel;
        $sql = 'SELECT * FROM compatible_releases
                WHERE
                    packages_name = "' . static::$databases[$this->_path]->escapeString($package) . '" AND
                    packages_channel = "' . static::$databases[$this->_path]->escapeString($channel) . '"';
        $a = static::$databases[$this->_path]->query($sql);

        while ($dep = $a->fetchArray(SQLITE3_ASSOC)) {
            $ret->compatible[$dep['compat_channel'] . '/' . $dep['compat_package']]->min =
                $dep['min'];
            $ret->compatible[$dep['compat_channel'] . '/' . $dep['compat_package']]->max =
                $dep['max'];
        }

        $sql = 'SELECT * FROM compatible_releases_exclude
                WHERE
                    packages_name = "' . static::$databases[$this->_path]->escapeString($package) . '" AND
                    packages_channel = "' . static::$databases[$this->_path]->escapeString($channel) . '"';
        $a = static::$databases[$this->_path]->query($sql);

        while ($dep = $a->fetchArray(SQLITE3_ASSOC)) {
            $ret->compatible[$dep['compat_channel'] . '/' . $dep['compat_package']]->exclude =
                $dep['exclude'];
        }
    }

    function fetchDeps(PEAR2_Pyrus_IPackageFile $ret)
    {
        $package = $ret->name;
        $channel = $ret->channel;
        $sql = 'SELECT * FROM php_dependencies
                WHERE
                    packages_name = "' . static::$databases[$this->_path]->escapeString($package) . '" AND
                    packages_channel = "' . static::$databases[$this->_path]->escapeString($channel) . '"';
        $a = static::$databases[$this->_path]->query($sql);

        while ($dep = $a->fetchArray()) {
            $ret->dependencies['required']->php->min = $dep['min'];
            $ret->dependencies['required']->php->max = $dep['max'];
        }

        $sql = 'SELECT * FROM php_dependencies_exclude
                WHERE
                    packages_name = "' . static::$databases[$this->_path]->escapeString($package) . '" AND
                    packages_channel = "' . static::$databases[$this->_path]->escapeString($channel) . '"';
        $a = static::$databases[$this->_path]->query($sql);

        while ($dep = $a->fetchArray()) {
            $ret->dependencies['required']->php->exclude($dep['exclude']);
        }

        $sql = 'SELECT * FROM pearinstaller_dependencies
                WHERE
                    packages_name = "' . static::$databases[$this->_path]->escapeString($package) . '" AND
                    packages_channel = "' . static::$databases[$this->_path]->escapeString($channel) . '"';
        $a = static::$databases[$this->_path]->query($sql);

        while ($dep = $a->fetchArray()) {
            $ret->dependencies['required']->pearinstaller->min = $dep['min'];
            $ret->dependencies['required']->pearinstaller->max = $dep['max'];
        }

        $sql = 'SELECT * FROM pearinstaller_dependencies_exclude
                WHERE
                    packages_name = "' . static::$databases[$this->_path]->escapeString($package) . '" AND
                    packages_channel = "' . static::$databases[$this->_path]->escapeString($channel) . '"';
        $a = static::$databases[$this->_path]->query($sql);

        while ($dep = $a->fetchArray()) {
            $ret->dependencies['required']->pearinstaller->exclude($dep['exclude']);
        }

        $sql = 'SELECT * FROM os_dependencies
                WHERE
                    packages_name = "' . static::$databases[$this->_path]->escapeString($package) . '" AND
                    packages_channel = "' . static::$databases[$this->_path]->escapeString($channel) . '"';
        $a = static::$databases[$this->_path]->query($sql);

        while ($dep = $a->fetchArray(SQLITE3_ASSOC)) {
            $ret->dependencies['required']->os[$dep['osname']] = !$dep['conflicts'];
            $rawdeps = $ret->rawdeps;
        }

        $sql = 'SELECT * FROM arch_dependencies
                WHERE
                    packages_name = "' . static::$databases[$this->_path]->escapeString($package) . '" AND
                    packages_channel = "' . static::$databases[$this->_path]->escapeString($channel) . '"';
        $a = static::$databases[$this->_path]->query($sql);

        while ($dep = $a->fetchArray()) {
            $ret->dependencies['required']->arch[$dep['pattern']] = !$dep['conflicts'];
        }

        $sql = 'SELECT * FROM package_dependencies
                WHERE
                    packages_name = "' . static::$databases[$this->_path]->escapeString($package) . '" AND
                    packages_channel = "' . static::$databases[$this->_path]->escapeString($channel) . '"';
                //ORDER BY required, deppackage, depchannel, conflicts';
        $package_deps = static::$databases[$this->_path]->query($sql);

        $sql = 'SELECT * FROM package_dependencies_exclude
                WHERE
                    packages_name = "' . static::$databases[$this->_path]->escapeString($package) . '" AND
                    packages_channel = "' . static::$databases[$this->_path]->escapeString($channel) . '"';
                //ORDER BY required, deppackage, depchannel, conflicts, exclude';
        $excludes = static::$databases[$this->_path]->query($sql);
        if (!$package_deps) {
            $ret = $this->fetchDepGroups($ret);
            return $ret;
        }

        $provides = array();
        while ($dep = $package_deps->fetchArray(SQLITE3_ASSOC)) {
            $required = $dep['required'] ? 'required' : 'optional';
            $package = $dep['is_subpackage'] ? 'subpackage' : 'package';
            if ($dep['groupname']) {
                $group = $dep['groupname'];
                $d = $ret->dependencies['group']->$group->{$package}[$dep['depchannel'] . '/' . $dep['deppackage']];
            } else {
                $d = $ret->dependencies[$required]->{$package}[$dep['depchannel'] . '/' . $dep['deppackage']];
            }
            $d->min($dep['min']);
            $d->max($dep['max']);
            if ($dep['conflicts']) {
                $d->conflicts();
            }
            $d->recommended($dep['recommended']);
            $provides[] = $dep;
        }

        while ($dep = $excludes->fetchArray(SQLITE3_ASSOC)) {
            $required = $dep['required'] ? 'required' : 'optional';
            $package = $dep['is_subpackage'] ? 'subpackage' : 'package';

            if ($dep['groupname']) {
                $group = $dep['groupname'];
                $d = $ret->dependencies['group']->$group->{$package}[$dep['depchannel'] . '/' . $dep['deppackage']];
            } else {
                $d = $ret->dependencies[$required]->{$package}[$dep['depchannel'] . '/' . $dep['deppackage']];
            }

            $d->exclude($dep['exclude']);
        }
        foreach ($provides as $dep){
            $required = $dep['required'] ? 'required' : 'optional';
            $package = $dep['is_subpackage'] ? 'subpackage' : 'package';
            if ($dep['groupname']) {
                $group = $dep['groupname'];
                $ret->dependencies['group']->$group->{$package}[$dep['depchannel'] . '/' . $dep['deppackage']]->providesextension($dep['providesextension']);
            } else {
                $ret->dependencies[$required]->{$package}[$dep['depchannel'] . '/' . $dep['deppackage']]->providesextension($dep['providesextension']);
            }
        }

        $ret = $this->fetchExtensionDeps($ret);
        $ret = $this->fetchDepGroups($ret);
        return $ret;
    }

    function fetchDepGroups(PEAR2_Pyrus_IPackageFile $ret)
    {
        $package = $ret->name;
        $channel = $ret->channel;

        $sql = 'SELECT * FROM dep_groups
                WHERE
                    packages_name = "' . static::$databases[$this->_path]->escapeString($package) . '" AND
                    packages_channel = "' . static::$databases[$this->_path]->escapeString($channel) . '"';
        $groups = static::$databases[$this->_path]->query($sql);
        if ($groups) {
            while ($group = $groups->fetchArray(SQLITE3_ASSOC)) {
                $ret->dependencies['group']->{$group['groupname']}->hint = $group['grouphint'];
            }
        }
        return $ret;
    }

    function fetchExtensionDeps(PEAR2_Pyrus_IPackageFile $ret)
    {
        $package = $ret->name;
        $channel = $ret->channel;
        $sql = 'SELECT * FROM extension_dependencies
                WHERE
                    packages_name = "' . static::$databases[$this->_path]->escapeString($package) . '" AND
                    packages_channel = "' . static::$databases[$this->_path]->escapeString($channel) . '"';
        $extension_deps = static::$databases[$this->_path]->query($sql);

        $sql = 'SELECT * FROM extension_dependencies_exclude
                WHERE
                    packages_name = "' . static::$databases[$this->_path]->escapeString($package) . '" AND
                    packages_channel = "' . static::$databases[$this->_path]->escapeString($channel) . '"';
        $excludes = static::$databases[$this->_path]->query($sql);
        if (!$extension_deps) {
            return $ret;
        }
        while ($dep = $extension_deps->fetchArray(SQLITE3_ASSOC)) {
            $required = $dep['required'] ? 'required' : 'optional';
            if ($dep['groupname']) {
                $group = $dep['groupname'];
                $d = $ret->dependencies['group']->$group->extension[$dep['extension']];
            } else {
                $d = $ret->dependencies[$required]->extension[$dep['extension']];
            }
            $d->min($dep['min']);
            $d->max($dep['max']);
            if ($dep['conflicts']) {
                $d->conflicts();
            }
            $d->recommended($dep['recommended']);
            $provides[] = $dep;
        }

        while ($dep = $excludes->fetchArray(SQLITE3_ASSOC)) {
            $required = $dep['required'] ? 'required' : 'optional';

            if ($dep['groupname']) {
                $group = $dep['groupname'];
                $d = $ret->dependencies['group']->$group->extension[$dep['extension']];
            } else {
                $d = $ret->dependencies[$required]->extension[$dep['extension']];
            }

            $d->exclude($dep['exclude']);
        }

        return $ret;
    }

    public function getDependentPackages(PEAR2_Pyrus_IPackageFile $package)
    {
        if (!isset(static::$databases[$this->_path])) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Error: no existing SQLite3 channel registry for ' . $this->_path);
        }

        $ret = array();
        $sql = 'SELECT
                    packages_channel, packages_name
                FROM package_dependencies
                WHERE
                    deppackage = :name AND depchannel = :channel
                ORDER BY packages_channel, packages_name';
        $stmt = static::$databases[$this->_path]->prepare($sql);
        $pn = $package->name;
        $stmt->bindParam(':name', $pn, SQLITE3_TEXT);
        $pp = $package->channel;
        $stmt->bindParam(':channel', $pp, SQLITE3_TEXT);
        $result = @$stmt->execute();

        while ($res = $result->fetchArray()) {
            try {
                $ret[] = $this->package[$res[0] . '/' . $res[1]];
            } catch (Exception $e) {
                throw new PEAR2_Pyrus_ChannelRegistry_Exception('Could not retrieve ' .
                    'dependent package ' . $res[0] . '/' . $res[1], $e);
            }
        }

        return $ret;
    }

    /**
     * Detect any files already installed that would be overwritten by
     * files inside the package represented by $package
     */
    public function detectFileConflicts(PEAR2_Pyrus_IPackageFile $package)
    {
        if (!isset(static::$databases[$this->_path])) {
            throw new PEAR2_Pyrus_ChannelRegistry_Exception('Error: no existing SQLite3 channel registry for ' . $this->_path);
        }

        $ret = array();
        $sql = 'SELECT
                    packages_channel, packages_name
                FROM files
                WHERE
                    packagepath = :path
                ORDER BY packages_channel, packages_name';
        $stmt = static::$databases[$this->_path]->prepare($sql);
        // now iterate over each file in the package, and note all the conflicts
        $roles = array();
        foreach (PEAR2_Pyrus_Installer_Role::getValidRoles($package->getPackageType()) as $role) {
            // set up a list of file role => configuration variable
            // for storing in the registry
            $roles[$role] =
                PEAR2_Pyrus_Installer_Role::factory($package->getPackageType(), $role);
        }
        $ret = array();
        $config = PEAR2_Pyrus_Config::current();
        foreach ($package->installcontents as $file) {
            $stmt->reset();
            $relativepath = $roles[$file->role]->getRelativeLocation($package, $file);
            if (!$relativepath) {
                continue;
            }
            $testpath = $config->{$roles[$file->role]->getLocationConfig()} .
                    DIRECTORY_SEPARATOR . $relativepath;
            $stmt->bindParam(':path', $testpath, SQLITE3_TEXT);
            $result = $stmt->execute();

            while ($res = $result->fetchArray(SQLITE3_ASSOC)) {
                $ret[] = array($relativepath => $res['packages_channel'] . '/' . $res['packages_name']);
            }
        }
        return $ret;
    }

    /**
     * Returns a list of registries present in the PEAR installation at $path
     * @param string
     * @return array
     */
    static public function detectRegistries($path)
    {
        if (file_exists($path . '/.pear2registry') || is_file($path . '/.pear2registry')) {
            return array('Sqlite3');
        }
        return array();
    }

    /**
     * Completely remove all traces of an sqlite3 registry
     */
    static public function removeRegistry($path)
    {
        if ($path === ':memory:') {
            unset(static::$databases[$path]);
            return;
        }
        if (dirname($path) . DIRECTORY_SEPARATOR . '.pear2registry' != $path) {
            $path = $path . DIRECTORY_SEPARATOR . '.pear2registry';
        }
        if (!file_exists($path)) {
            return;
        }
        if (isset(static::$databases[$path])) {
            static::$databases[$path]->close();
            unset(static::$databases[$path]);
        }
        if (!@unlink($path)) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot remove Sqlite3 registry: Unable to remove SQLite database');
        }
    }
}<?php
/**
 * PEAR2_Pyrus_Registry_Pear1_Package
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Package within the PEAR 1.x registry
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Registry_Pear1_Package extends PEAR2_Pyrus_Registry_Package_Base
{
    function fromPackageFile(PEAR2_Pyrus_IPackageFile $package)
    {
        PEAR2_Pyrus_PackageFile_v2::fromPackageFile($package);
        if (isset($this->packageInfo['contents']['dir']['attribs']['baseinstalldir'])) {
            $this->baseinstalldirs = array('/' => $this->packageInfo['contents']['dir']['attribs']['baseinstalldir']);
        }
    }
}<?php
/**
 * PEAR_DependencyDB, advanced installed packages dependency database for
 * Pear1 registry
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Track dependency relationships between installed packages
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Tomas V.V.Cox <cox@idec.net.com>
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Registry_Pear1_DependencyDB
{
    /**
     * Filename of the dependency DB (usually .depdb)
     * @var string
     * @access private
     */
    var $_depdb = false;
    /**
     * File name of the lockfile (usually .depdblock)
     * @var string
     * @access private
     */
    var $_lockfile = false;
    /**
     * Open file resource for locking the lockfile
     * @var resource|false
     * @access private
     */
    var $_lockFp = false;
    /**
     * API version of this class, used to validate a file on-disk
     * @var string
     * @access private
     */
    var $_version = '1.0';

    function __construct($path)
    {
        $this->_depdb = $path . DIRECTORY_SEPARATOR . '.depdb';

        $this->_lockfile = dirname($this->_depdb) . DIRECTORY_SEPARATOR . '.depdblock';
    }

    function hasWriteAccess()
    {
        if (!file_exists($this->_depdb)) {
            $dir = $this->_depdb;
            while ($dir && $dir != '.') {
                $dir = dirname($dir); // cd ..
                if ($dir != '.' && file_exists($dir)) {
                    if (is_writeable($dir)) {
                        return true;
                    }
                    return false;
                }
            }
            return false;
        }
        return is_writeable($this->_depdb);
    }

    /**
     * Get a list of installed packages that depend on this package
     * @return array
     */
    function getDependentPackages(PEAR2_Pyrus_IPackageFile $pkg)
    {
        $data = $this->_getDepDB();

        if (isset($data['packages']) && isset($data['packages'][$pkg->channel][strtolower($pkg->name)])) {
            return $data['packages'][$pkg->channel][strtolower($pkg->name)];
        }
        return array();
    }

    /**
     * Get a list of the actual dependencies of installed packages that depend on
     * a package.
     * @return array
     */
    function getDependentPackageDependencies(PEAR2_Pyrus_IPackageFile $pkg)
    {
        $data = $this->_getDepDB();
        $channel = $pkg->channel;
        $package = strtolower($pkg->name);

        $depend = $this->getDependentPackages($pkg);
        if (!$depend) {
            return array();
        }

        $dependencies = array();
        foreach ($depend as $info) {
            $temp = $this->getDependencies($info);
            foreach ($temp as $dep) {
                if (isset($dep['dep'], $dep['dep']['channel'], $dep['dep']['name']) &&
                      $dep['dep']['channel'] == $channel &&
                      strtolower($dep['dep']['name']) == $package
                ) {
                    if (!isset($dependencies[$info['channel']])) {
                        $dependencies[$info['channel']] = array();
                    }

                    if (!isset($dependencies[$info['channel']][$info['package']])) {
                        $dependencies[$info['channel']][$info['package']] = array();
                    }
                    $dependencies[$info['channel']][$info['package']][] = $dep;
                }
            }
        }

        return $dependencies;
    }

    /**
     * Get a list of dependencies of this installed package
     * @return array
     */
    function getDependencies(PEAR2_Pyrus_IPackageFile $pkg)
    {
        $channel = $pkg->channel;
        $package = strtolower($pkg->name);

        $data = $this->_getDepDB();
        if (isset($data['dependencies'][$channel][$package])) {
            return $data['dependencies'][$channel][$package];
        }

        return false;
    }

    /**
     * Determine whether $parent depends on $child, near or deep
     */
    function dependsOn(PEAR2_Pyrus_IPackageFile $parent, PEAR2_Pyrus_IPackageFile $child)
    {
        $c = array();
        return $this->_dependsOn($parent, $child, $c);
    }

    function _dependsOn($parent, $child, &$checked)
    {
        $data = $this->_getDepDB();
        $channel = $parent->channel;
        $package = strtolower($parent->name);

        $depchannel = $child->channel;
        $deppackage = strtolower($child->name);

        if (isset($checked[$channel][$package][$depchannel][$deppackage])) {
            return false; // avoid endless recursion
        }

        $checked[$channel][$package][$depchannel][$deppackage] = true;
        if (!isset($data['dependencies'][$channel][$package])) {
            return false;
        }

        foreach ($data['dependencies'][$channel][$package] as $info) {
            if (isset($info['dep']['uri'])) {
                if ($info['dep']['uri'] === $child->uri) {
                    return true;
                }
                return false;
            }

            if (strtolower($info['dep']['channel']) == $depchannel &&
                  strtolower($info['dep']['name']) == $deppackage) {
                return true;
            }
        }

        foreach ($data['dependencies'][$channel][$package] as $info) {
            if (isset($info['dep']['uri'])) {
                if ($this->_dependsOn(array(
                        'uri' => $info['dep']['uri'],
                        'package' => $info['dep']['name']), $child, $checked)) {
                    return true;
                }
            } else {
                if ($this->_dependsOn(array(
                        'channel' => $info['dep']['channel'],
                        'package' => $info['dep']['name']), $child, $checked)) {
                    return true;
                }
            }
        }

        return false;
    }

    /**
     * Register dependencies of a package that is being installed or upgraded
     */
    function installPackage(PEAR2_Pyrus_IPackageFile $package)
    {
        $data = $this->_getDepDB();
        $this->_setPackageDeps($data, $package);
        $this->_writeDepDB($data);
    }

    /**
     * Remove dependencies of a package that is being uninstalled, or upgraded.
     *
     * Upgraded packages first uninstall, then install
     */
    function uninstallPackage($channel, $package)
    {
        $package = strtolower($package);
        $data = $this->_getDepDB();

        if (!isset($data['dependencies'][$channel][$package])) {
            return true;
        }

        foreach ($data['dependencies'][$channel][$package] as $dep) {
            $found      = false;
            $depchannel = isset($dep['dep']['uri']) ? '__uri' : strtolower($dep['dep']['channel']);
            $depname    = strtolower($dep['dep']['name']);
            if (isset($data['packages'][$depchannel][$depname])) {
                foreach ($data['packages'][$depchannel][$depname] as $i => $info) {
                    if ($info['channel'] == $channel && $info['package'] == $package) {
                        $found = true;
                        break;
                    }
                }
            }

            if ($found) {
                unset($data['packages'][$depchannel][$depname][$i]);
                if (!count($data['packages'][$depchannel][$depname])) {
                    unset($data['packages'][$depchannel][$depname]);
                    if (!count($data['packages'][$depchannel])) {
                        unset($data['packages'][$depchannel]);
                    }
                } else {
                    $data['packages'][$depchannel][$depname] =
                        array_values($data['packages'][$depchannel][$depname]);
                }
            }
        }

        unset($data['dependencies'][$channel][$package]);
        if (!count($data['dependencies'][$channel])) {
            unset($data['dependencies'][$channel]);
        }

        if (!count($data['dependencies'])) {
            unset($data['dependencies']);
        }

        if (!count($data['packages'])) {
            unset($data['packages']);
        }

        $this->_writeDepDB($data);
    }

    /**
     * Rebuild the dependency DB by reading registry entries.
     */
    function rebuildDB()
    {
        $depdb = array('_version' => $this->_version);
        if (!$this->hasWriteAccess()) {
            // allow startup for read-only with older Registry
            return $depdb;
        }
        $reg = PEAR2_Pyrus_Config::current()->registry;

        foreach (PEAR2_Pyrus_Config::current()->channelregistry as $channel) {
            foreach ($reg->listPackages($channel->name) as $package) {
                $this->_setPackageDeps($depdb, $package);
            }
        }

        $this->_writeDepDB($depdb);
    }

    /**
     * Register usage of the dependency DB to prevent race conditions
     * @param int one of the LOCK_* constants
     */
    private function _lock($mode = LOCK_EX)
    {
        if (stristr(php_uname(), 'Windows 9')) {
            return;
        }

        if ($mode != LOCK_UN && is_resource($this->_lockFp)) {
            // XXX does not check type of lock (LOCK_SH/LOCK_EX)
            return;
        }

        $open_mode = 'w';
        // XXX People reported problems with LOCK_SH and 'w'
        if ($mode === LOCK_SH) {
            if (!file_exists($this->_lockfile)) {
                touch($this->_lockfile);
            } elseif (!is_file($this->_lockfile)) {
                throw new PEAR2_Pyrus_Registry_Exception('could not create Dependency lock file, ' .
                    'it exists and is not a regular file');
            }
            $open_mode = 'r';
        }

        if (!is_resource($this->_lockFp)) {
            $this->_lockFp = @fopen($this->_lockfile, $open_mode);
        }

        if (!is_resource($this->_lockFp)) {
            throw new PEAR2_Pyrus_Registry_Exception("could not create Dependency lock file" .
                                     (isset($php_errormsg) ? ": " . $php_errormsg : ""));
        }

        if (!(int)flock($this->_lockFp, $mode)) {
            switch ($mode) {
                case LOCK_SH: $str = 'shared';    break;
                case LOCK_EX: $str = 'exclusive'; break;
                case LOCK_UN: $str = 'unlock';    break;
                default:      $str = 'unknown';   break;
            }

            throw new PEAR2_Pyrus_Registry_Exception("could not acquire $str lock ($this->_lockfile)");
        }
    }

    /**
     * Release usage of dependency DB
     * @access private
     */
    function _unlock()
    {
        $this->_lock(LOCK_UN);
        if (is_resource($this->_lockFp)) {
            fclose($this->_lockFp);
        }
        $this->_lockFp = null;
    }

    /**
     * Load the dependency database from disk
     * @return array
     */
    function _getDepDB()
    {
        if (!$this->hasWriteAccess()) {
            return array('_version' => $this->_version);
        }

        if (!file_exists($this->_depdb)) {
            return array('_version' => $this->_version);
        }

        if (!$fp = fopen($this->_depdb, 'r')) {
            throw new PEAR2_Pyrus_Registry_Exception("Could not open dependencies file `" .
                                                     $this->_depdb . "'");
        }

        $rt = get_magic_quotes_runtime();
        set_magic_quotes_runtime(0);
        clearstatcache();
        fclose($fp);
        $data = unserialize(file_get_contents($this->_depdb));
        set_magic_quotes_runtime($rt);
        return $data;
    }

    /**
     * Write out the dependency database to disk
     * @param array the database
     * @return true|PEAR_Error
     * @access private
     */
    function _writeDepDB($deps)
    {
        $this->_lock(LOCK_EX);

        if (!$fp = fopen($this->_depdb, 'wb')) {
            $this->_unlock();
            throw new PEAR2_Pyrus_Registry_Exception("Could not open dependencies file `" .
                                                     $this->_depdb . "' for writing");
        }

        $rt = get_magic_quotes_runtime();
        set_magic_quotes_runtime(0);
        fwrite($fp, serialize($deps));
        set_magic_quotes_runtime($rt);
        fclose($fp);
        $this->_unlock();
    }

    /**
     * Register all dependencies from a package in the dependencies database, in essence
     * "installing" the package's dependency information
     * @param array the database
     * @param PEAR_PackageFile_v1|PEAR_PackageFile_v2
     * @access private
     */
    function _setPackageDeps(&$data, PEAR2_Pyrus_IPackageFile $pkg)
    {
        $deps = $pkg->rawdeps;

        if (!$deps) {
            return;
        }

        if (!is_array($data)) {
            $data = array();
        }

        if (!isset($data['dependencies'])) {
            $data['dependencies'] = array();
        }

        $channel = $pkg->channel;
        $package = strtolower($pkg->name);

        if (!isset($data['dependencies'][$channel])) {
            $data['dependencies'][$channel] = array();
        }

        $data['dependencies'][$channel][$package] = array();
        if (isset($deps['required']['package'])) {
            if (!isset($deps['required']['package'][0])) {
                $deps['required']['package'] = array($deps['required']['package']);
            }

            foreach ($deps['required']['package'] as $dep) {
                $this->_registerDep($data, $pkg, $dep, 'required');
            }
        }

        if (isset($deps['optional']['package'])) {
            if (!isset($deps['optional']['package'][0])) {
                $deps['optional']['package'] = array($deps['optional']['package']);
            }

            foreach ($deps['optional']['package'] as $dep) {
                $this->_registerDep($data, $pkg, $dep, 'optional');
            }
        }

        if (isset($deps['required']['subpackage'])) {
            if (!isset($deps['required']['subpackage'][0])) {
                $deps['required']['subpackage'] = array($deps['required']['subpackage']);
            }

            foreach ($deps['required']['subpackage'] as $dep) {
                $this->_registerDep($data, $pkg, $dep, 'required');
            }
        }

        if (isset($deps['optional']['subpackage'])) {
            if (!isset($deps['optional']['subpackage'][0])) {
                $deps['optional']['subpackage'] = array($deps['optional']['subpackage']);
            }

            foreach ($deps['optional']['subpackage'] as $dep) {
                $this->_registerDep($data, $pkg, $dep, 'optional');
            }
        }

        if (isset($deps['group'])) {
            if (!isset($deps['group'][0])) {
                $deps['group'] = array($deps['group']);
            }

            foreach ($deps['group'] as $group) {
                if (isset($group['package'])) {
                    if (!isset($group['package'][0])) {
                        $group['package'] = array($group['package']);
                    }

                    foreach ($group['package'] as $dep) {
                        $this->_registerDep($data, $pkg, $dep, 'optional',
                            $group['attribs']['name']);
                    }
                }

                if (isset($group['subpackage'])) {
                    if (!isset($group['subpackage'][0])) {
                        $group['subpackage'] = array($group['subpackage']);
                    }

                    foreach ($group['subpackage'] as $dep) {
                        $this->_registerDep($data, $pkg, $dep, 'optional',
                            $group['attribs']['name']);
                    }
                }
            }
        }

        if ($data['dependencies'][$channel][$package] == array()) {
            unset($data['dependencies'][$channel][$package]);
            if (!count($data['dependencies'][$channel])) {
                unset($data['dependencies'][$channel]);
            }
        }
    }

    /**
     * @param array the database
     * @param PEAR2_Pyrus_IPackageFile
     * @param array the specific dependency
     * @param required|optional whether this is a required or an optional dep
     * @param string|false dependency group this dependency is from, or false for ordinary dep
     */
    function _registerDep(&$data, PEAR2_Pyrus_IPackageFile $pkg, $dep, $type, $group = false)
    {
        $info = array(
            'dep'   => $dep,
            'type'  => $type,
            'group' => $group
        );

        if (isset($dep['name'])) {
            $dep['name'] = strtolower($dep['name']);
        }
        $depchannel = isset($dep['channel']) ? $dep['channel'] : '__uri';
        if (!isset($data['dependencies'])) {
            $data['dependencies'] = array();
        }

        $channel = $pkg->channel;
        $package = strtolower($pkg->name);

        if (!isset($data['dependencies'][$channel])) {
            $data['dependencies'][$channel] = array();
        }

        if (!isset($data['dependencies'][$channel][$package])) {
            $data['dependencies'][$channel][$package] = array();
        }

        $data['dependencies'][$channel][$package][] = $info;
        if (isset($data['packages'][$depchannel][$dep['name']])) {
            $found = false;
            foreach ($data['packages'][$depchannel][$dep['name']] as $i => $p) {
                if ($p['channel'] == $channel && $p['package'] == $package) {
                    $found = true;
                    break;
                }
            }

            if (!$found) {
                $data['packages'][$depchannel][$dep['name']][] = array(
                    'channel' => $channel,
                    'package' => $package
                );
            }
        } else {
            if (!isset($data['packages'])) {
                $data['packages'] = array();
            }

            if (!isset($data['packages'][$depchannel])) {
                $data['packages'][$depchannel] = array();
            }

            if (!isset($data['packages'][$depchannel][$dep['name']])) {
                $data['packages'][$depchannel][$dep['name']] = array();
            }

            $data['packages'][$depchannel][$dep['name']][] = array(
                'channel' => $channel,
                'package' => $package
            );
        }
    }
}<?php
/**
 * PEAR2_Pyrus_Registry_Xml_Package
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Package within the xml registry
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Registry_Xml_Package extends PEAR2_Pyrus_Registry_Package_Base
{
}<?php
/**
 * PEAR2_Pyrus_Registry_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for Pyrus Registry
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Registry_Exception extends PEAR2_Exception {}
<?php
/**
 * PEAR2_Pyrus_Registry_Sqlite3_Package
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Package within the sqlite3 registry
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Registry_Sqlite3_Package extends PEAR2_Pyrus_Registry_Package_Base
{
    public $dirty = false;

    function __set($var, $value)
    {
        if (!isset($this->packagename)) {
            throw new PEAR2_Pyrus_Registry_Exception('Attempt to retrieve ' . $var .
                ' from unknown package');
        }
        PEAR2_Pyrus_PackageFile_v2::__set($var, $value);
        // occasionally, this next line will result in failure to install when incomplete data is there,
        // so we silently skip the save, and mark the packagefile as dirty
        try {
            $this->reg->replace($this);
            $this->dirty = false;
        } catch (PEAR2_Pyrus_Registry_Exception $e) {
            $this->dirty = true;
        }
    }
}<?php
/**
 * PEAR2_Pyrus_Registry_Sqlite3_Creator
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Initialize a sqlite3 registry
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Registry_Sqlite3_Creator
{
    /**
     * Initialize the database for the registry
     *
     * Registry information that must be stored:
     *
     * - A list of installed packages
     * - the files in each package
     * - known channels
     */
    function create(SQLite3 $database)
    {
        if (!@$database->exec('BEGIN')) {
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE TABLE packages (
           name TEXT(80) NOT NULL,
           channel TEXT(255) NOT NULL,
           version TEXT(20) NOT NULL,
           apiversion TEXT(20) NOT NULL,
           summary TEXT NOT NULL,
           description TEXT NOT NULL,
           stability TEXT(8) NOT NULL,
           apistability TEXT(8) NOT NULL,
           releasedate DATE NOT NULL,
           releasetime TIME,
           license TEXT(50) NOT NULL,
           licenseuri TEXT,
           licensepath TEXT,
           releasenotes TEXT,
           lastinstalledversion TEXT(20),
           installedwithpear TEXT(20),
           installtimeconfig TEXT(50),
           PRIMARY KEY (name, channel)
          );';
        $worked = $database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE TABLE configureoptions (
           packages_name TEXT(80) NOT NULL,
           packages_channel TEXT(255) NOT NULL,
           name TEXT(255) NOT NULL,
           prompt TEXT(255) NOT NULL,
           defaultValue TEXT(255),
           PRIMARY KEY (packages_name, packages_channel, name)
          );';
        $worked = $database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE TABLE maintainers (
           packages_name TEXT(80) NOT NULL,
           packages_channel TEXT(255) NOT NULL,
           role TEXT(11) NOT NULL,
           name TEXT(200) NOT NULL,
           user TEXT(20) NOT NULL,
           email TEXT(100) NOT NULL,
           active CHAR(3) NOT NULL,
           PRIMARY KEY (packages_name, packages_channel, user)
          );';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        // configpath is absolute path to role directory
        // relativepath is relative to role directory
        // packagepath is absolute path to full file path
        // this makes moving the database simple, just reconstruct packagepath from
        // the file role + the relative path
        $query = '
          CREATE TABLE files (
           packages_name TEXT(80) NOT NULL,
           packages_channel TEXT(255) NOT NULL,
           configpath TEXT(255) NOT NULL,
           packagepath TEXT(255) NOT NULL,
           role TEXT(30) NOT NULL,
           relativepath TEXT(255) NOT NULL,
           origpath TEXT(255) NOT NULL,
           baseinstalldir TEXT(255),
           tasks TEXT NOT NULL,
           PRIMARY KEY (packagepath, role),
           UNIQUE (packages_name, packages_channel, origpath)
          );';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE TABLE baseinstalldirs (
           packages_name TEXT(80) NOT NULL,
           packages_channel TEXT(255) NOT NULL,
           dirname TEXT(255) NOT NULL,
           baseinstall TEXT(255) NOT NULL,
           PRIMARY KEY (packages_name, packages_channel, dirname)
          );';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
            CREATE TABLE dep_groups (
             packages_name TEXT(80) NOT NULL,
             packages_channel TEXT(255) NOT NULL,
             groupname TEXT(80) NOT NULL,
             grouphint TEXT(255) NOT NULL,
             PRIMARY KEY (packages_name, packages_channel, groupname)
            );';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE TABLE compatible_releases (
           packages_name TEXT(80) NOT NULL,
           packages_channel TEXT(255) NOT NULL,
           compat_package TEXT(80) NOT NULL,
           compat_channel TEXT(255) NOT NULL,
           min TEXT(20) NOT NULL,
           max TEXT(20) NOT NULL,
           PRIMARY KEY (packages_name, packages_channel, compat_package, compat_channel)
          );';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE TABLE compatible_releases_exclude (
           packages_name TEXT(80) NOT NULL,
           packages_channel TEXT(255) NOT NULL,
           compat_package TEXT(80) NOT NULL,
           compat_channel TEXT(255) NOT NULL,
           exclude TEXT(20) NOT NULL,
           PRIMARY KEY (packages_name, packages_channel, compat_package, compat_channel, exclude)
          );';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE TABLE extension_dependencies (
           required BOOL NOT NULL,
           packages_name TEXT(80) NOT NULL,
           packages_channel TEXT(255) NOT NULL,
           extension TEXT(80) NOT NULL,
           conflicts BOOL NOT NULL,
           min TEXT(20),
           max TEXT(20),
           recommended TEXT(20),
           groupname TEXT(80),
           PRIMARY KEY (required, packages_name, packages_channel, extension, groupname)
          );';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE TABLE extension_dependencies_exclude (
           required BOOL NOT NULL,
           packages_name TEXT(80) NOT NULL,
           packages_channel TEXT(255) NOT NULL,
           extension TEXT(80) NOT NULL,
           conflicts BOOL NOT NULL,
           exclude TEXT(20) NOT NULL,
           groupname TEXT(80),
           PRIMARY KEY (required, packages_name, packages_channel, extension,
                exclude, groupname)
          );';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE TABLE package_dependencies (
           required BOOL NOT NULL,
           packages_name TEXT(80) NOT NULL,
           packages_channel TEXT(255) NOT NULL,
           deppackage TEXT(80) NOT NULL,
           depchannel TEXT(255) NOT NULL,
           conflicts BOOL NOT NULL,
           min TEXT(20),
           max TEXT(20),
           recommended TEXT(20),
           is_subpackage BOOL NOT NULL,
           groupname TEXT(80),
           providesextension TEXT(80),
           PRIMARY KEY (required, packages_name, packages_channel, deppackage,
                depchannel, is_subpackage, groupname)
          );';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE TABLE package_dependencies_exclude (
           required BOOL NOT NULL,
           packages_name TEXT(80) NOT NULL,
           packages_channel TEXT(255) NOT NULL,
           deppackage TEXT(80) NOT NULL,
           depchannel TEXT(255) NOT NULL,
           conflicts BOOL NOT NULL,
           exclude TEXT(20) NOT NULL,
           is_subpackage BOOL NOT NULL,
           groupname TEXT(80),
           PRIMARY KEY (required, packages_name, packages_channel, deppackage, depchannel,
                exclude, is_subpackage, groupname)
          );';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
            CREATE TABLE os_dependencies (
             packages_name TEXT(80) NOT NULL,
             packages_channel TEXT(255) NOT NULL,
             osname TEXT(80),
             conflicts BOOL,
             PRIMARY KEY (packages_name, packages_channel, osname)
            )';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
            CREATE TABLE arch_dependencies (
             packages_name TEXT(80) NOT NULL,
             packages_channel TEXT(255) NOT NULL,
             pattern TEXT(80),
             conflicts BOOL,
             PRIMARY KEY (packages_name, packages_channel, pattern)
            )';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
            CREATE TABLE php_dependencies (
             packages_name TEXT(80) NOT NULL,
             packages_channel TEXT(255) NOT NULL,
             min TEXT(20),
             max TEXT(20),
             PRIMARY KEY (packages_name, packages_channel)
            )';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
             CREATE TABLE php_dependencies_exclude (
              packages_name TEXT(80) NOT NULL,
              packages_channel TEXT(255) NOT NULL,
              exclude TEXT(20) NOT NULL,
              PRIMARY KEY (packages_name, packages_channel, exclude)
             )';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
            CREATE TABLE pearinstaller_dependencies (
             packages_name TEXT(80) NOT NULL,
             packages_channel TEXT(255) NOT NULL,
             min TEXT(20),
             max TEXT(20),
             PRIMARY KEY (packages_name, packages_channel)
            )';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
             CREATE TABLE pearinstaller_dependencies_exclude (
              packages_name TEXT(80) NOT NULL,
              packages_channel TEXT(255) NOT NULL,
              exclude TEXT(20) NOT NULL,
              PRIMARY KEY (packages_name, packages_channel, exclude)
             )';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE TABLE channels (
           channel TEXT NOT NULL,
           summary TEXT NOT NULL,
           suggestedalias TEXT(50) NOT NULL,
           alias TEXT(50) NOT NULL,
           validatepackageversion TEXT(20) NOT NULL default "default",
           validatepackage NOT NULL default "PEAR_Validate",
           lastmodified TEXT,
           PRIMARY KEY (channel),
           UNIQUE(alias)
          );';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE TABLE channel_servers (
           channel TEXT NOT NULL,
           server TEXT NOT NULL,
           ssl integer NOT NULL default 0,
           port integer NOT NULL default 80,
           PRIMARY KEY (channel, server)
          );';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE TABLE channel_server_rest (
           channel TEXT NOT NULL,
           server TEXT NOT NULL,
           type TEXT NOT NULL,
           baseurl TEXT NOT NULL,
           PRIMARY KEY (channel, server, baseurl, type)
          );';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE TABLE pearregistryversion (
           version TEXT(20) NOT NULL
          );

          INSERT INTO pearregistryversion VALUES("1.0.0");
        ';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
            CREATE TRIGGER package_delete DELETE ON packages
              FOR EACH ROW BEGIN
                DELETE FROM maintainers
                WHERE
                  maintainers.packages_name = old.name AND
                  maintainers.packages_channel = old.channel;
                DELETE FROM files
                WHERE
                  files.packages_name = old.name AND
                  files.packages_channel = old.channel;
                DELETE FROM baseinstalldirs
                WHERE
                  baseinstalldirs.packages_name = old.name AND
                  baseinstalldirs.packages_channel = old.channel;
                DELETE FROM package_dependencies
                WHERE
                  package_dependencies.packages_name = old.name AND
                  package_dependencies.packages_channel = old.channel;
                DELETE FROM package_dependencies_exclude
                WHERE
                  package_dependencies_exclude.packages_name = old.name AND
                  package_dependencies_exclude.packages_channel = old.channel;
                DELETE FROM os_dependencies
                WHERE
                  os_dependencies.packages_name = old.name AND
                  os_dependencies.packages_channel = old.channel;
                DELETE FROM arch_dependencies
                WHERE
                  arch_dependencies.packages_name = old.name AND
                  arch_dependencies.packages_channel = old.channel;
                DELETE FROM php_dependencies
                WHERE
                  php_dependencies.packages_name = old.name AND
                  php_dependencies.packages_channel = old.channel;
                DELETE FROM php_dependencies_exclude
                WHERE
                  php_dependencies_exclude.packages_name = old.name AND
                  php_dependencies_exclude.packages_channel = old.channel;
                DELETE FROM pearinstaller_dependencies
                WHERE
                  pearinstaller_dependencies.packages_name = old.name AND
                  pearinstaller_dependencies.packages_channel = old.channel;
                DELETE FROM pearinstaller_dependencies_exclude
                WHERE
                  pearinstaller_dependencies_exclude.packages_name = old.name AND
                  pearinstaller_dependencies_exclude.packages_channel = old.channel;
                DELETE FROM extension_dependencies
                WHERE
                  extension_dependencies.packages_name = old.name AND
                  extension_dependencies.packages_channel = old.channel;
                DELETE FROM extension_dependencies_exclude
                WHERE
                  extension_dependencies_exclude.packages_name = old.name AND
                  extension_dependencies_exclude.packages_channel = old.channel;
                DELETE FROM dep_groups
                WHERE
                  dep_groups.packages_name = old.name AND
                  dep_groups.packages_channel = old.channel;
              END;
        ';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
            CREATE TRIGGER channel_check BEFORE DELETE ON channels
            BEGIN
             SELECT RAISE(ROLLBACK, \'Cannot delete channel, installed packages use it\')
             WHERE old.channel IN (SELECT channel FROM packages);
            END;';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE TRIGGER channel_delete DELETE ON channels
            FOR EACH ROW BEGIN
              DELETE FROM channel_servers
              WHERE
                channel_servers.channel = old.channel;
              DELETE FROM channel_server_rest
              WHERE
                channel_server_rest.channel = old.channel;
            END;
        ';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE VIEW deps AS
            SELECT
                packages_name,
                packages_channel
                deppackage,
                depchannel,
                null as exclude,
                conflicts,
                min,
                max
            FROM package_dependencies
            UNION
            SELECT
                packages_name,
                packages_channel
                deppackage,
                depchannel,
                exclude,
                conflicts,
                null as min,
                null as max
            FROM package_dependencies_exclude
        ';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }

        $query = '
          CREATE VIEW protocols AS
            SELECT
                channel,
                server,
                baseurl as function,
                type as version,
                "rest" as protocol
            FROM channel_server_rest
        ';
        $worked = @$database->exec($query);
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }
        $worked = @$database->exec('COMMIT');
        if (!$worked) {
            @$database->exec('ROLLBACK');
            $error = $database->lastErrorMsg();
            throw new PEAR2_Pyrus_Registry_Exception('Cannot initialize SQLite3 registry: ' . $error);
        }
    }
}
<?php
/**
 * PEAR2_Pyrus_Registry_Pear1
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Helgi ﬁormar ﬁorbjˆrnsson <dufuz@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/PEAR2/Pyrus
 */

/**
 * This is the central registry, that is used for all installer options,
 * stored in .reg files for PEAR 1 compatibility
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Helgi ﬁormar ﬁorbjˆrnsson <dufuz@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/PEAR2/Pyrus
 */
class PEAR2_Pyrus_Registry_Pear1 extends PEAR2_Pyrus_Registry_Base
{
    static public $dependencyDBClass = 'PEAR2_Pyrus_Registry_Pear1_DependencyDB';
    protected $_path;
    protected $filemap;

    function __construct($path)
    {
        if (!file_exists($path . '/.registry') && basename($path) !== 'php') {
            $path = $path . DIRECTORY_SEPARATOR . 'php';
        }
        $this->_path = $path;
        $this->filemap = $this->_path . DIRECTORY_SEPARATOR . '.filemap';
    }

    protected function rebuildFileMap()
    {
        $config = PEAR2_Pyrus_Config::current();
        $channels = array();
        foreach ($config->channelregistry as $channel) {
            $channels[$channel->name] = $this->listPackages($channel->name);
        }
        $files = array();
        foreach (PEAR2_Pyrus_Installer_Role::getValidRoles('php') as $role) {
            // set up a list of file role => configuration variable
            // for storing in the registry
            $roles[$role] =
                PEAR2_Pyrus_Installer_Role::factory('php', $role)->getLocationConfig();
        }
        foreach (PEAR2_Pyrus_Installer_Role::getValidRoles('extsrc') as $role) {
            // set up a list of file role => configuration variable
            // for storing in the registry
            if (isset($roles[$role])) {
                continue;
            }
            $roles[$role] =
                PEAR2_Pyrus_Installer_Role::factory('extsrc', $role)->getLocationConfig();
        }
        foreach ($channels as $channel => $packages) {
            foreach ($packages as $package) {
                foreach ($this->info($package, $channel, 'installedfiles') as $name => $attrs) {

                    $name = str_replace($config->{$roles[$attrs['role']]}, '', $name);
                    $file = str_replace('\\', '/', $name);

                    $file = preg_replace(',^/+,', '', $file);
                    if (!isset($files[$attrs['role']])) {
                        $files[$attrs['role']] = array();
                    }
                    if ($channel != 'pear.php.net') {
                        $files[$attrs['role']][$file] = array($channel,
                            strtolower($package));
                    } else {
                        $files[$attrs['role']][$file] = strtolower($package);
                    }
                }
            }
        }

        if (!@is_dir(dirname($this->filemap))) {
            mkdir(dirname($this->filemap), 0755, true);
        }
        $fp = fopen($this->filemap, 'wb');
        if (!$fp) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot write out Pear1 filemap');
        }

        fwrite($fp, serialize($files));
        fclose($fp);
    }

    protected function readFileMap()
    {
        if (!file_exists($this->filemap)) {
            return array();
        }

        $fp = @fopen($this->filemap, 'r');
        if (!$fp) {
            throw new PEAR2_Pyrus_Registry_Exception('Could not open Pear1 registry filemap "' . $this->filemap . '"');
        }

        clearstatcache();
        $rt = get_magic_quotes_runtime();
        set_magic_quotes_runtime(0);
        $fsize = filesize($this->filemap);
        $data = stream_get_contents($fp);
        fclose($fp);
        set_magic_quotes_runtime($rt);
        $tmp = unserialize($data);
        if (!$tmp && $fsize > 7) {
            throw new PEAR2_Pyrus_Registry_Exception('Invalid Pear1 registry filemap data');
        }
        return $tmp;
    }

    private function _nameRegistryPath(PEAR2_Pyrus_IPackageFile $info = null,
                                     $channel = null, $package = null, $version = null)
    {
        $channel = $info !== null ? $info->channel : $channel;
        $package = $info !== null ? $info->name    : $package;
        $path = $this->_namePath($channel, $package);
        return $path . '.reg';
    }

    private function _namePath($channel, $package)
    {
        if ($channel == 'pear.php.net') {
            $channel = '';
        } else {
            $channel = '.channel.' . strtolower($channel) . DIRECTORY_SEPARATOR;
        }

        return $this->_path . DIRECTORY_SEPARATOR .
            '.registry' . DIRECTORY_SEPARATOR . $channel . strtolower($package);
    }

    /**
     * Create the .registry/package.reg or file
     *
     * @param PEAR2_Pyrus_IPackageFile $pf
     */
    function install(PEAR2_Pyrus_IPackageFile $info, $replace = false)
    {
        $packagefile = $this->_nameRegistryPath($info);
        if (!@is_dir(dirname($packagefile))) {
            mkdir(dirname($packagefile), 0755, true);
        }

        if (!$replace) {
            $info->date = date('Y-m-d');
            $info->time = date('H:i:s');
        }

        $arr = $info->toArray();
        $arr = $arr['package'];
        $arr['old']['version'] = $info->version['release'];
        $arr['old']['release_date'] = $info->date;
        $arr['old']['release_state'] = $info->state;
        $license = $info->license['name'];
        $arr['old']['release_license'] = $license;
        $arr['old']['release_notes'] = $info->notes;
        $deps = array();
        $deps[] = array_merge(array('type' => 'php'), $info->dependencies['required']->php->getInfo());
        $map = array(
            'php' => 'php',
            'package' => 'pkg',
            'subpackage' => 'pkg',
            'extension' => 'ext',
            'os' => 'os',
            'pearinstaller' => 'pkg',
            );
        foreach (array('package', 'subpackage', 'extension') as $dtype) {
            foreach (array('required', 'optional') as $optorrequired) {
                $optional = ($optorrequired == 'optional');
                foreach ($info->dependencies['required']->package as $dep) {
                    $s = array('type' => $map[$dtype]);
                    if (isset($dep->channel)) {
                        $s['channel'] = $dep->channel;
                    }
                    if (isset($dep->uri)) {
                        $s['uri'] = $dep->uri;
                    }
                    if (isset($dep->name)) {
                        $s['name'] = $dep->name;
                    }
                    if ($dep->conflicts) {
                        $s['rel'] = 'not';
                    } else {
                        if (!isset($dep->min) &&
                              !isset($dep->max)) {
                            $s['rel'] = 'has';
                            $s['optional'] = $optional;
                        } elseif (isset($dep->min) &&
                              isset($dep->max)) {
                            $s['rel'] = 'ge';
                            $s1 = $s;
                            $s1['rel'] = 'le';
                            $s['version'] = $dep->min;
                            $s1['version'] = $dep->max;
                            if (isset($dep->channel)) {
                                $s1['channel'] = $dep->channel;
                            }
                            $s['name'] = $dep->name;
                            $s1['name'] = $dep->name;
                            $s['optional'] = $optional;
                            $s1['optional'] = $optional;
                            $deps[] = $s1;
                        } elseif (isset($dep->min)) {
                            $s['rel'] = 'ge';
                            if (isset($dep->exclude)) {
                                foreach ($dep->exclude as $exclude) {
                                    if ($exclude == $dep->min) {
                                        $s['rel'] = 'gt';
                                        break;
                                    }
                                }
                            }
                            $s['version'] = $dep->min;
                            $s['optional'] = $optional;
                            $s['name'] = $dep->name;
                        } elseif (isset($dep->max)) {
                            $s['rel'] = 'le';
                            if (isset($dep->exclude)) {
                                foreach ($dep->exclude as $exclude) {
                                    if ($exclude == $dep->max) {
                                        $s['rel'] = 'lt';
                                        break;
                                    }
                                }
                            }
                            $s['version'] = $dep->max;
                            $s['optional'] = $optional;
                            $s['name'] = $dep->name;
                        }
                    }
                }
            }
        }
        $arr['old']['release_deps'] = $deps;
        $maintainers = $info->allmaintainers;
        $maint = array();
        foreach (array('lead', 'developer', 'contributor', 'helper') as $role) {
            foreach ($maintainers[$role] as $maintainer) {
                $m = $maintainer->getInfo();
                $m = array_merge(array('role' => $role), $m);
                $m['handle'] = $m['user'];
                unset($m['handle']);
                $maint[] = $m;
            }
        }
        $arr['filelist'] = $info->getFilelist();
        foreach (PEAR2_Pyrus_Installer_Role::getValidRoles($info->getPackageType()) as $role) {
            // set up a list of file role => configuration variable
            // for storing in the registry
            $roles[$role] =
                PEAR2_Pyrus_Installer_Role::factory($info->getPackageType(), $role);
        }
        $config = PEAR2_Pyrus_Config::current();
        $dirtree = array();
        foreach ($info->installcontents as $file) {
            $relativepath = $roles[$file->role]->getRelativeLocation($info, $file);
            if (!$relativepath) {
                continue;
            }
            $arr['filelist'][$file['attribs']['name']] = $arr['filelist'][$file['attribs']['name']]['attribs'];
            $installedas = $config->{$roles[$file->role]->getLocationConfig()} .
                DIRECTORY_SEPARATOR . $relativepath;
            $arr['filelist'][$file['attribs']['name']]['installed_as'] = $installedas;
            $len = strlen($installedas) - strlen($relativepath) - 2;
            do {
                $installedas = dirname($installedas);
                if (strlen($installedas) > $len) {
                    $dirtree[$installedas] = 1;
                }
            } while (strlen($installedas) > $len);
        }
        $arr['filelist']['dirtree'] = array_keys($dirtree);
        $arr['old']['maintainers'] = $maint;
        $arr['xsdversion'] = '2.0';
        $arr['_lastmodified'] = time();

        file_put_contents($packagefile, serialize($arr));
        $this->rebuildFileMap();
        $classname = self::$dependencyDBClass;
        $dep = new $classname($this->_path);
        $dep->installPackage($info);
    }

    function uninstall($package, $channel)
    {
        $packagefile = $this->_nameRegistryPath(null, $channel, $package);
        @unlink($packagefile);
        $classname = self::$dependencyDBClass;
        $dep = new $classname($this->_path);
        $dep->uninstallPackage($channel, $package);
        $this->rebuildFileMap();
    }

    public function exists($package, $channel)
    {
        $packagefile = $this->_nameRegistryPath(null, $channel, $package);
        return @file_exists($packagefile) && @!is_dir($packagefile);
    }

    public function info($package, $channel, $field)
    {
        if (!$this->exists($package, $channel)) {
            throw new PEAR2_Pyrus_Registry_Exception('Unknown package ' . $channel .
                '/' . $package);
        }

        $pf = $this->toPackageFile($package, $channel);

        if ($field === null) {
            return $pf;
        }

        if ($field == 'version') {
            $field = 'release-version';
        }
        if ($field == 'installedfiles' || $field == 'dirtree') {
            $packagefile = $this->_namePath($channel, $package) . '.reg';
            if (!$packagefile || !isset($packagefile[0])) {
                throw new PEAR2_Pyrus_Registry_Exception('Cannot find registry for package ' .
                    $channel . '/' . $package);
            }

            $packagecontents = file_get_contents($packagefile);
            $data = @unserialize($packagecontents);
            if ($data === false) {
                throw new PEAR2_Pyrus_Registry_Exception('Cannot retrieve package file object ' .
                    'for package ' . $channel . '/' . $package . ', PEAR 1.x registry file might be corrupt!');
            }
            if ($field == 'dirtree') {
                $ret = $data['filelist']['dirtree'];
                usort($ret, 'strnatcasecmp');
                return array_reverse($ret);
            }

            $roles = array();
            $configpaths = array();
            $config = PEAR2_Pyrus_Config::current();
            foreach (PEAR2_Pyrus_Installer_Role::getValidRoles($pf->getPackageType()) as $role) {
                // set up a list of file role => configuration variable
                // for storing in the registry
                $roles[$role] =
                    PEAR2_Pyrus_Installer_Role::factory($pf->getPackageType(), $role);
                $configpaths[$role] = $config->{$roles[$role]->getLocationConfig()};
            }
            $ret = array();
            foreach ($data['filelist'] as $file) {
                if (!isset($file['installed_as'])) {
                    continue;
                }
                if (0 !== strpos($file['installed_as'], $configpaths[$file['role']])) {
                    // this was installed with a different configuration, so don't guess
                    $file['relativepath'] = basename($file['installed_as']);
                    $file['configpath'] = dirname($file['installed_as']);
                } else {
                    $file['relativepath'] = substr($file['installed_as'], strlen($configpaths[$file['role']]) + 1);
                    $file['configpath'] = $configpaths[$file['role']];
                }
                $ret[$file['installed_as']] = $file;
            }
            return $ret;
        }
        return $pf->$field;
    }

    public function listPackages($channel)
    {
        $dir = $this->_namePath($channel, '');
        if (!@file_exists($dir)) {
            return array();
        }

        $ret = array();
        try {
            foreach (new DirectoryIterator($dir) as $file) {
                if ($file->isDot() || !$file->isFile()) continue;
                $a = @unserialize(file_get_contents($file->getPathName()));
                // $a['name'] is not set on v1 regs
                if ($a !== false && isset($a['name'])) {
                    $ret[] = $a['name'];
                } elseif ($a !== false && isset($a['package'])) {
                    $ret[] = $a['package'];
                } else {
                    PEAR2_Pyrus_Log::log(0, 'Warning: corrupted REG registry entry: ' .
                        $file->getPathName());
                }
            }
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_Registry_Exception('Could not open channel directory for ' .
                'channel ' . $channel, $e);
        }
        return $ret;
    }

    public function toPackageFile($package, $channel)
    {
        if (!$this->exists($package, $channel)) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot retrieve package file object ' .
                'for package ' . $channel . '/' . $package . ', it is not installed');
        }

        $packagefile = $this->_nameRegistryPath(null, $channel, $package);
        if (!$packagefile) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot find registry for package ' .
                $channel . '/' . $package);
        }

        $contents = file_get_contents($packagefile);
        if (!$contents) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot find registry for package ' .
                $channel . '/' . $package);
        }

        $data = @unserialize($contents);
        if ($data === false) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot retrieve package file object ' .
                'for package ' . $channel . '/' . $package . ', PEAR 1.x registry file might be corrupt!');
        }

        if (isset($data['xsdversion']) && $data['xsdversion'] == '1.0'
            || !isset($data['attribs'])
            || isset($data['attribs']) && $data['attribs']['version'] == '1.0') {
            // make scrappy minimal package.xml we can use for dependencies/info
            $pf = new PEAR2_Pyrus_PackageFile_v2;
            $pf->name = $data['package'];
            $pf->channel = 'pear.php.net';
            $pf->version['release'] = $pf->version['api'] = $data['version'];
            $pf->stability['release'] = $pf->stability['api'] = $data['release_state'];
            $pf->notes = $data['release_notes'];
            $pf->license['name'] = $data['release_license'];
            $pf->date = $data['release_date'];
            foreach ($data['maintainers'] as $maintainer) {
                $pf->maintainer[$maintainer['handle']]->name($maintainer['name'])
                   ->active('yes')->role($maintainer['role'])->email($maintainer['email']);
            }
            // we don't care what the ancient package depends on, really, so make it valid
            // and forget about it
            $pf->dependencies['required']->php->min = phpversion();
            $pf->dependencies['required']->pearinstaller->min = '1.4.0';
            unset($data['filelist']['dirtree']);
            foreach ($data['filelist'] as $file => $info) {
                $pf->files[$file] = array('attribs' => $info);
            }
        } else {
            // create packagefile v2 here
            $pf = new PEAR2_Pyrus_PackageFile_v2;
            $pf->fromArray(array('package' => $data));
            $contents = $data['contents']['dir']['file'];
            if (!isset($contents[0])) {
                $contents = array($contents);
            }
            foreach ($contents as $file) {
                $pf->files[$file['attribs']['name']] = $file;
            }
        }
        return $pf;
    }

    public function __get($var)
    {
        if ($var == 'package') {
            return new PEAR2_Pyrus_Registry_Pear1_Package($this);
        }
    }

    public function getDependentPackages(PEAR2_Pyrus_IPackageFile $package)
    {
        $class = self::$dependencyDBClass;
        $dep = new $class($this->_path);
        $ret = $dep->getDependentPackages($package);
        foreach ($ret as $i => $package) {
            $ret[$i] = $this->package[$package['channel'] . '/' . $package['package']];
        }
        return $ret;
    }

    /**
     * Detect any files already installed that would be overwritten by
     * files inside the package represented by $package
     */
    public function detectFileConflicts(PEAR2_Pyrus_IPackageFile $package)
    {
        $filemap = $this->readFileMap();
        if (!$filemap) {
            return array();
        }

        // now iterate over each file in the package, and note all the conflicts
        $roles = array();
        foreach (PEAR2_Pyrus_Installer_Role::getValidRoles($package->getPackageType()) as $role) {
            // set up a list of file role => configuration variable
            // for storing in the registry
            $roles[$role] =
                PEAR2_Pyrus_Installer_Role::factory($package->getPackageType(), $role);
        }
        $ret = array();
        foreach ($package->installcontents as $file) {
            $relativepath = $roles[$file->role]->getRelativeLocation($package, $file);
            if (!$relativepath) {
                continue;
            }
            if (isset($filemap[$file->role][$relativepath])) {
                if (is_array($filemap[$file->role][$relativepath])) {
                    $ret[] = array($relativepath => $filemap[$file->role][$relativepath][0] . '/' .
                        $this->info($filemap[$file->role][$relativepath][1],
                                    $filemap[$file->role][$relativepath][0], 'name'));
                } else {
                    $ret[] = array($relativepath =>
                                   'pear.php.net/' . $this->info($filemap[$file->role][$relativepath],
                                                                 'pear.php.net',
                                                                 'name'));
                }
            }
        }
        return $ret;
    }

    /**
     * Returns a list of registries present in the PEAR installation at $path
     * @param string
     * @return array
     */
    static public function detectRegistries($path)
    {
        if (file_exists($path . '/.registry') || is_dir($path . '/.registry')) {
            return array('Pear1');
        }
        if (basename($path) !== 'php') {
            $path = $path . DIRECTORY_SEPARATOR . 'php';
        }
        if (file_exists($path . '/.registry') || is_dir($path . '/.registry')) {
            return array('Pear1');
        }
        return array();
    }

    /**
     * Completely remove all traces of a PEAR 1.x registry
     */
    static public function removeRegistry($path)
    {
        $path = $path . DIRECTORY_SEPARATOR . 'php';
        if (!file_exists($path . '/.registry')) {
            return;
        }
        try {
            PEAR2_Pyrus_AtomicFileTransaction::rmrf(realpath($path . DIRECTORY_SEPARATOR . '.xmlregistry'));
        } catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot remove Pear1 registry: ' . $e->getMessage(), $e);
        }
        $errs = new PEAR2_MultiErrors;
        try {
            if (file_exists($path . '/.channels')) {
                PEAR2_Pyrus_AtomicFileTransaction::rmrf(realpath($path . DIRECTORY_SEPARATOR . '.channels'));
            }
        } catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
            $errs->E_ERROR[] = new PEAR2_Pyrus_Registry_Exception('Cannot remove Pear1 registry: ' . $e->getMessage(), $e);
        }
        foreach (array('.filemap', '.lock', '.depdb', '.depdblock') as $file) {
            if (file_exists($path . DIRECTORY_SEPARATOR . $file)
                && !@unlink(realpath($path . DIRECTORY_SEPARATOR . $file))) {
                $errs->E_ERROR[] = new PEAR2_Pyrus_Registry_Exception(
                            'Cannot remove Pear1 registry: Unable to remove ' . $file);
            }
        }
        if (count($errs->E_ERROR)) {
            throw new PEAR2_Pyrus_Registry_Exception('Unable to remove Pear1 registry', $errs);
        }
    }
}
<?php
/**
 * PEAR2_Pyrus_Registry_Package_Base
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Registry package class base
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
abstract class PEAR2_Pyrus_Registry_Package_Base extends PEAR2_Pyrus_PackageFile_v2
                                                 implements ArrayAccess, PEAR2_Pyrus_IPackageFile, Iterator
{

    protected $packagename;
    protected $package;
    protected $channel;
    protected $reg;
    protected $iteratorPackages;
    protected $iteratorChannel;

    function __construct(PEAR2_Pyrus_Registry_Base $cloner)
    {
        $this->reg = $cloner;
    }

    function current()
    {
        $package = current($this->iteratorPackages);
        return $this[$this->iteratorChannel . '/' . $package];
    }

    function key()
    {
        return current($this->iteratorPackages);
    }

    function rewind()
    {
        if (!$this->iteratorChannel) {
            $this->iteratorChannel = PEAR2_Pyrus_Config::current()->default_channel;
        }
        $this->iteratorPackages = $this->reg->listPackages($this->iteratorChannel);
    }

    function next()
    {
        return next($this->iteratorPackages);
    }

    function valid()
    {
        if (!current($this->iteratorPackages)) {
            $this->iteratorChannel = false;
            return false;
        }
        return true;
    }

    function setIteratorChannel($channel)
    {
        $this->iteratorChannel = $channel;
    }

    function fromPackageFile(PEAR2_Pyrus_IPackageFile $package)
    {
        parent::fromPackageFile($package);
        // reconstruct filelist/baseinstalldirs
        // this assumes that the filelist has been flattened, which is
        // always true for registries
        // it also assumes we are not a bundle, which is also always true for
        // registries as bundles are not installable
        $contents = $this->packageInfo['contents']['dir']['file'];
        if (!isset($contents[0])) {
            $contents = array($contents);
        }
        foreach ($contents as $file) {
            $this->filelist[$file['attribs']['name']] = $file;
        }
        if (isset($this->packageInfo['contents']['dir']['attribs']['baseinstalldir'])) {
            $this->baseinstalldirs = array('/' => $this->packageInfo['contents']['dir']['attribs']['baseinstalldir']);
        }
    }

    function offsetExists($offset)
    {
        $info = PEAR2_Pyrus_Config::current()->channelregistry->parseName($offset);
        return $this->reg->exists($info['package'], $info['channel']);
    }

    function offsetGet($offset)
    {
        $this->packagename = $offset;
        $info = PEAR2_Pyrus_Config::current()->channelregistry->parseName($this->packagename);
        $this->package = $info['package'];
        $this->channel = $info['channel'];
        $intermediate = $this->reg->toPackageFile($info['package'], $info['channel']);
        $this->fromPackageFile($intermediate);
        $ret = clone $this;
        $this->packagename = null;
        $this->package = null;
        $this->channel = null;
        return $ret;
    }

    function offsetSet($offset, $value)
    {
        $this->reg->install($value);
    }

    function offsetUnset($offset)
    {
        $info = PEAR2_Pyrus_Config::current()->channelregistry->parseName($offset);
        $this->reg->uninstall($info['package'], $info['channel']);
    }

    function toRaw()
    {
        $info = new PEAR2_Pyrus_PackageFile_v2;
        $info->fromArray(array('package' => $this->packageInfo));
        return $info;
    }

    function __get($var)
    {
        if (!isset($this->packagename)) {
            throw new PEAR2_Pyrus_Registry_Exception('Attempt to retrieve ' . $var .
                ' from unknown package');
        }
        return parent::__get($var);
    }

    function __set($var, $value)
    {
        if (!isset($this->packagename)) {
            throw new PEAR2_Pyrus_Registry_Exception('Attempt to retrieve ' . $var .
                ' from unknown package');
        }
        parent::__set($var, $value);
        $this->reg->replace($this);
    }

    function getSchemaOK()
    {
        return true;
    }

    /**
     * Create vertices/edges of a directed graph for dependencies of this package
     *
     * Iterate over dependencies and create edges from this package to those it
     * depends upon
     * @param PEAR2_Pyrus_DirectedGraph $graph
     * @param array $packages channel/package indexed array of PEAR2_Pyrus_Package objects
     */
    function makeUninstallConnections(PEAR2_Pyrus_DirectedGraph $graph, array $packages)
    {
        $graph->add($this);
        foreach (array('required', 'optional') as $required) {
            foreach (array('package', 'subpackage') as $package) {
                foreach ($this->dependencies[$required]->$package as $d) {
                    if ($d->conflicts) {
                        continue;
                    }
                    if (isset($packages[$d->channel . '/' . $d->name])) {
                        $graph->connect($this, $packages[$d->channel . '/' . $d->name]);
                    }
                }
            }
        }
        foreach ($this->dependencies['group'] as $group) {
            foreach (array('package', 'subpackage') as $package) {
                foreach ($group->$package as $d) {
                    if (isset($packages[$d->channel . '/' . $d->name])) {
                        $graph->connect($this, $packages[$d->channel . '/' . $d->name]);
                    }
                }
            }
        }
    }

    public function validateUninstallDependencies(array $uninstallPackages,
                                                  PEAR2_MultiErrors $errs)
    {
        $ret = true;
        foreach ($uninstallPackages as $package) {
            foreach ($this->reg->getDependentPackages($package) as $deppackage) {
                $dep = new PEAR2_Pyrus_Dependency_Validator(
                    array('channel' => $deppackage->channel, 'package' => $deppackage->name),
                    PEAR2_Pyrus_Validate::UNINSTALLING, $errs);
                foreach ($uninstallPackages as $test) {
                    if ($deppackage->isEqual($test)) {
                        // we are uninstalling both the package that is depended upon
                        // and the parent package, so all dependencies are nulled
                        continue 2;
                    }
                }
                foreach (array('package', 'subpackage') as $packaged) {
                    $deps = $deppackage->dependencies['required']->$packaged;
                    if (isset($deps[$package->channel . '/' . $package->name])) {
                        $ret = $ret && $dep->validatePackageUninstall($deps[$package->channel . '/' . $package->name], $package);
                    }
                    $deps = $deppackage->dependencies['optional']->$packaged;
                    if (isset($deps[$package->channel . '/' . $package->name])) {
                        $ret = $ret && $dep->validatePackageUninstall($deps[$package->channel . '/' . $package->name], $package);
                    }
                }
            }
        }
        return $ret;
    }
}<?php
/**
 * PEAR2_Pyrus_Installer
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Pyrus Installer class
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Installer
{
    /**
     * Flag that determines the behavior of {@link begin()}
     *
     * If true, begin() will do nothing.  If false, then
     * {@link static::$installPackages} will be reset to an empty array
     * @var bool
     */
    protected static $inTransaction = false;

    /**
     * Packages that will be installed
     *
     * This list is used when {@link commit()} is called to determine
     * the packages to install
     * @var array
     */
    protected static $installPackages = array();

    /**
     * Packages that were installed
     *
     * This list is used when {@link rollback()} is called to determine
     * the packages that should be removed
     * @var array
     */
    protected static $installedPackages = array();

    /**
     * Packages that have been installed and also successfully registered as installed
     *
     * This list is used when {@link rollback()} is called to determine
     * the packages that should be removed from the registry
     * @var array
     */
    protected static $registeredPackages = array();

    /**
     * Packages that were removed during installation
     *
     * This list is used when {@link rollback()} is called to restore state
     * the packages to install
     * @var array
     */
    protected static $removedPackages = array();

    protected static $lastCurrent;

    /**
     * Installer options.  Valid indices are:
     *
     * - upgrade (upgrade or install packages)
     * - optionaldeps (also automatically download/install optional deps)
     * - force
     * @var array
     */
    public static $options = array();
    /**
     * Prepare installation of packages
     */
    static function begin()
    {
        if (!static::$inTransaction) {
            if (isset(static::$options['install-plugins'])) {
                self::$lastCurrent = PEAR2_Pyrus_Config::current();
                PEAR2_Pyrus_Config::setCurrent(PEAR2_Pyrus_Config::current()->plugins_dir);
            }
            static::$installPackages = array();
            static::$installedPackages = array();
            static::$removedPackages = array();
            static::$inTransaction = true;
        }
    }

    /**
     * Add a package to the list of packages to be downloaded
     *
     * This function checks to see if an identical package is already being downloaded,
     * and manages removing duplicates or erroring out on a conflict
     * @param PEAR2_Pyrus_Package $package
     */
    static function prepare(PEAR2_Pyrus_IPackage $package)
    {
        if ($package->isPlugin()) {
            if (!isset(static::$options['install-plugins'])) {
                PEAR2_Pyrus_Log::log(0, 'Skipping plugin ' . $package->channel . '/' . $package->name .
                                     ', use plugin-install/plugin-upgrade to manage plugins');
                return;
            }
        }
        if (!isset(static::$installPackages[$package->channel . '/' . $package->name])) {
            // checking of validity for upgrade is done by PEAR2_Pyrus_Package_Dependency::retrieve(),
            // so all deps that make it this far can be added
            if (PEAR2_Pyrus_Config::current()->registry->exists(
                  $package->name, $package->channel)) {
                if (!$package->isUpgradeable()) {
                    if (!isset(static::$options['force'])) {
                        // installed package is the same or newer version than this one
                        PEAR2_Pyrus_Log::log(1, 'Skipping installed package ' .
                            $package->channel . '/' . $package->name);
                        return;
                    }
                }
            }
            static::$installPackages[$package->channel . '/' . $package->name] = $package;
            return;
        }
        $clone = static::$installPackages[$package->channel . '/' . $package->name];
        if ($package->isStatic() && !$clone->isStatic()) {
            // always prefer explicitly versioned over abstract
            static::$installPackages[$package->channel . '/' . $package->name] = $package;
            return;
        }
        if (!$package->isStatic() && !$clone->isStatic()) {
            // identical, ignore this package
            return;
        }
        // compare version
        if ($package->isStatic() && $clone->isStatic() && $package->version['release'] === $clone->version['release']) {
            // identical, ignore this package
            return;
        }
        if (!static::$options['force']) {
            //
            static::rollback();
            throw new PEAR2_Pyrus_Installer_Exception('Cannot install ' .
                $package->channel . '/' . $package->name . ', two conflicting' .
                ' versions are required by packages that depend on it (' .
                $package->version['release'] . ' and ' . $clone->version['release']);
        }
        PEAR2_Pyrus_Log::log(0, 'Warning: two conflicting versions of ' .
            $package->channel . '/' . $package->name .
            ' are required by packages that depend on it (' .
            $package->version['release'] . ' and ' . $clone->version['release']);
    }

    /**
     * Download and prepare all dependencies
     *
     * @param PEAR2_Pyrus_Package $package
     */
    static function prepareDependencies(PEAR2_Pyrus_IPackage $package)
    {
        foreach (array('package', 'subpackage') as $p) {
            foreach ($package->dependencies['required']->$p as $dep) {
                if ($dep->conflicts) {
                    continue;
                }
                PEAR2_Pyrus_Package_Dependency::retrieve(get_called_class(), static::$installPackages, $dep, $package);
            }
        }
        if ($package->requestedGroup) {
            foreach (array('package', 'subpackage') as $p) {
                foreach ($package->dependencies['group']->{$package->requestedGroup}->$p as $dep) {
                    if ($dep->conflicts) {
                        continue;
                    }
                    PEAR2_Pyrus_Package_Dependency::retrieve(get_called_class(), static::$installPackages, $dep, $package);
                }
            }
        }
        if (!isset(static::$options['optionaldeps'])) {
            return;
        }
        foreach (array('package', 'subpackage') as $p) {
            foreach ($package->dependencies['optional']->$p as $dep) {
                if ($dep->conflicts) {
                    continue;
                }
                PEAR2_Pyrus_Package_Dependency::retrieve(get_called_class(), static::$installPackages, $dep, $package);
            }
        }
    }

    /**
     * Cancel installation
     */
    static function rollback()
    {
        if (static::$inTransaction) {
            static::$inTransaction = false;
            $reg = PEAR2_Pyrus_Config::current()->registry;
            $err = new PEAR2_MultiErrors;
            foreach (static::$registeredPackages as $package) {
                try {
                    if (!$reg->exists($package[0]->name, $package[0]->channel)) {
                        continue;
                    }
                    $reg->uninstall($package[0]->name, $package[0]->channel);
                    if ($package[1]) {
                        $reg->install($package[1]);
                    }
                } catch (Exception $e) {
                    $err->E_ERROR[] = $e;
                }
            }
            foreach (static::$removedPackages as $package) {
                if (!$reg->exists($package->name, $package->channel)) {
                    try {
                        $reg->uninstall($package->name, $package->channel);
                    } catch (Exception $e) {
                        $err->E_ERROR[] = $e;
                    }
                }
                try {
                    $reg->install($package->getPackageFile()->info);
                } catch (Exception $e) {
                    $err->E_ERROR[] = $e;
                }
            }
            static::$installPackages = array();
            static::$installedPackages = array();
            static::$registeredPackages = array();
            static::$removedPackages = array();
            if (isset(static::$options['install-plugins'])) {
                PEAR2_Pyrus_Config::setCurrent(self::$lastCurrent->path);
            }
            if (count($err)) {
                throw new PEAR2_Pyrus_Installer_Exception('Could not successfully rollback', $err);
            }
        }
    }

    /**
     * Prior to committing, ensure all dependencies are resolved properly.
     *
     * This is split off from commit() solely for unit testing purposes
     */
    static function preCommitDependencyResolve()
    {
        if (!static::$inTransaction) {
            return false;
        }
        if (!count(static::$installPackages)) {
            return;
        }
        $done = true;
        $allpackages = $packages = static::$installPackages;
        do {
            foreach ($allpackages as $package => $info) {
                if (!$info->isRemote()) {
                    // anything downloaded is good
                    static::prepareDependencies($info);
                    continue;
                }
                $dep = PEAR2_Pyrus_Package_Dependency::getCompositeDependency($info);
                try {
                    if (true === $info->figureOutBestVersion($dep)) {
                        // we just changed version from a previously calculated version,
                        // so restart
                        $unset = PEAR2_Pyrus_Package_Dependency::removePackage($info);
                        foreach ($unset as $p) {
                            unset(static::$installPackages[$p]);
                        }
                        // just added some new packages that affect dependencies
                        $done = false;
                        continue 2;
                    }
                    static::prepareDependencies($info);
                } catch (PEAR2_Pyrus_Channel_Exception $e) {
                    throw new PEAR2_Pyrus_Installer_Exception('Dependency validation failed ' .
                        'for some packages to install, installation aborted', $e);
                }
            }
            $packages = array();
            foreach (array_diff(array_keys(static::$installPackages), array_keys($allpackages)) as $package) {
                $packages[$package] = static::$installPackages[$package];
            }
            $allpackages = static::$installPackages;
            $done = !count($packages);
        } while (!$done);
        if (!isset(self::$options['force'])) {
            // now iterate over the list and remove any packages that are installed with this version
            $packages = static::$installPackages;
            $reg = PEAR2_Pyrus_Config::current()->registry;
            foreach ($packages as $key => $package) {
                if ($reg->info($package->name, $package->channel, 'version') === $package->version['release']) {
                    unset(static::$installPackages[$key]);
                }
            }
        }
    }

    /**
     * Install packages slated for installation during transaction
     */
    static function commit()
    {
        if (!static::$inTransaction) {
            return false;
        }
        try {
            static::preCommitDependencyResolve();
            $installer = new PEAR2_Pyrus_Installer;
            // validate dependencies
            $errs = new PEAR2_MultiErrors;
            foreach (static::$installPackages as $package) {
                $package->validateDependencies(static::$installPackages, $errs);
            }
            if (count($errs->E_ERROR)) {
                throw new PEAR2_Pyrus_Installer_Exception('Dependency validation failed ' .
                    'for some packages to install, installation aborted', $errs);
            }
            // download non-local packages
            foreach (static::$installPackages as $package) {
                $package->download();
                if ($package->isPlugin()) {
                    // check for downloaded packages
                    if (!isset(static::$options['install-plugins'])) {
                        PEAR2_Pyrus_Log::log(0, 'Skipping plugin ' . $package->channel . '/' . $package->name .
                                             ', use plugin-install/plugin-upgrade to manage plugins');
                        unset(static::$installPackages[$package->channel . '/' . $package->name]);
                    }
                }
            }

            // now validate everything to the fine-grained level
            foreach (static::$installPackages as $package) {
                $package->validate(PEAR2_Pyrus_Validate::INSTALLING);
            }

            // create dependency connections and load them into the directed graph
            $graph = new PEAR2_Pyrus_DirectedGraph;
            foreach (static::$installPackages as $package) {
                $package->makeConnections($graph, static::$installPackages);
            }
            // topologically sort packages and install them via iterating over the graph
            try {
                PEAR2_Pyrus_AtomicFileTransaction::begin();
                foreach ($graph as $package) {
                    if (isset(static::$installedPackages[$package->channel . '/' . $package->name])) {
                        continue;
                    }
                    $installer->install($package);
                    static::$installedPackages[$package->channel . '/' . $package->name] = $package;
                }
                PEAR2_Pyrus_AtomicFileTransaction::commit();
            } catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
                PEAR2_Pyrus_AtomicFileTransaction::rollback();
                throw new PEAR2_Pyrus_Installer_Exception('Installation of ' . $package->channel .
                                                          '/' . $package->name . ' failed', $e);
            }
            $reg = PEAR2_Pyrus_Config::current()->registry;
            foreach (static::$installedPackages as $package) {
                try {
                    $previous = $reg->toPackageFile($package->name, $package->channel, true);
                } catch (\Exception $e) {
                    $previous = null;
                }
                $reg->install($package->getPackageFile()->info);
                static::$registeredPackages[] = array($package, $previous);
            }
            static::$installPackages = array();
            PEAR2_Pyrus_Config::current()->saveConfig();
            // success
            PEAR2_Pyrus_AtomicFileTransaction::removeBackups();
            static::$inTransaction = false;
            if (isset(static::$options['install-plugins'])) {
                PEAR2_Pyrus_Config::setCurrent(self::$lastCurrent->path);
            }
        } catch (Exception $e) {
            static::rollback();
            throw $e;
        }
    }

    static function getInstalledPackages()
    {
        return static::$installedPackages;
    }

    /**
     * Install a fully downloaded package
     *
     * Using PEAR2_Pyrus_FileTransactions and the woPEAR2_Pyrus_PEAR2_Installer_Role* to
     * group files in appropriate locations, the install() method then passes
     * on the registration of installation to PEAR2_Pyrus_Registry.  If necessary,
     * PEAR2_Pyrus_Config will update the install-time snapshots of configuration
     * @param PEAR2_Pyrus_Package $package
     */
    function install(PEAR2_Pyrus_IPackage $package)
    {
        $this->_options = array();
        try {
            $lastversion = PEAR2_Pyrus_Config::current()->registry->info(
                                    $package->name, $package->channel, 'version');
        } catch (Exception $e) {
            $lastversion = null;
        }
        $globalreplace = array('attribs' =>
                    array('from' => '@' . 'PACKAGE_VERSION@',
                          'to' => 'version',
                          'type' => 'package-info'));

        foreach ($package->installcontents as $file) {
            $channel = $package->channel;
            // {{{ assemble the destination paths
            if (!in_array($file->role,
                  PEAR2_Pyrus_Installer_Role::getValidRoles($package->getPackageType()))) {
                throw new PEAR2_Pyrus_Installer_Exception('Invalid role `' .
                        $file->role .
                        "' for file " . $file->name);
            }
            $role = PEAR2_Pyrus_Installer_Role::factory($package->getPackageType(), $file->role);
            $role->setup($this, $package, $file['attribs'], $file->name);
            if (!$role->isInstallable()) {
                continue;
            }

            $transact = PEAR2_Pyrus_AtomicFileTransaction::getTransactionObject($role);

            $info = $role->getRelativeLocation($package, $file, true);
            $dir = $info[0];
            $dest_file = $info[1];

            // }}}

            // pretty much nothing happens if we are only registering the install
            if (isset($this->_options['register-only'])) {
                continue;
            }
            try {
                $transact->mkdir($dir, 0755);
            } catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
                throw new PEAR2_Pyrus_Installer_Exception("failed to mkdir $dir", $e);
            }
            PEAR2_Pyrus_Log::log(3, "+ mkdir $dir");

            if ($file->md5sum) {
                $md5sum = md5_file($package->getFilePath($file->packagedname));
                if (strtolower($md5sum) == strtolower($file->md5sum)) {
                    PEAR2_Pyrus_Log::log(2, "md5sum ok: $dest_file");
                } else {
                    if (empty($options['force'])) {
                        if (!isset($options['ignore-errors'])) {
                            throw new PEAR2_Pyrus_Installer_Exception(
                                "bad md5sum for file $file");
                        } else {
                            if (!isset($options['soft'])) {
                                PEAR2_Pyrus_Log::log(0,
                                    "warning : bad md5sum for file $dest_file");
                            }
                        }
                    } else {
                        if (!isset($options['soft'])) {
                            PEAR2_Pyrus_Log::log(0,
                                "warning : bad md5sum for file $dest_file");
                        }
                    }
                }
            }

            if (strpos(PHP_OS, 'WIN') === false) {
                if ($role->isExecutable()) {
                    $mode = (~octdec(PEAR2_Pyrus_Config::current()->umask) & 0777);
                    PEAR2_Pyrus_Log::log(3, "+ chmod +x $dest_file");
                } else {
                    $mode = (~octdec(PEAR2_Pyrus_Config::current()->umask) & 0666);
                }
            } else {
                $mode = null;
            }

            try {
                $transact->createOrOpenPath($dest_file, $package->getFileContents($file->packagedname, true), $mode);
            } catch (PEAR2_Pyrus_AtomicFileTransaction_Exception $e) {
                throw new PEAR2_Pyrus_Installer_Exception(
                    "failed writing to $dest_file", $e);
            }

            $tasks = $file->tasks;
            // only add the global replace task if it is not preprocessed
            if ($package->isNewPackage() && !$package->isPreProcessed()) {
                if (isset($tasks['tasks:replace'])) {
                    if (isset($tasks['tasks:replace'][0])) {
                        $tasks['tasks:replace'][] = $globalreplace;
                    } else {
                        $tasks['tasks:replace'] = array($tasks['tasks:replace'],
                            $globalreplace);
                    }
                } else {
                    $tasks['tasks:replace'] = $globalreplace;
                }
            }
            $fp = false;
            foreach (new PEAR2_Pyrus_Package_Creator_TaskIterator($tasks, $package,
                                                                  PEAR2_Pyrus_Task_Common::INSTALL, $lastversion)
                      as $name => $task) {
                if (!$fp) {
                    $fp = $transact->openPath($dest_file);
                }
                $task->startSession($fp, $dest_file);
                if (!rewind($fp)) {
                    throw new PEAR2_Pyrus_Installer_Exception('task ' . $name .
                                                              ' closed the file pointer, invalid task');
                }
            }
            if ($fp) {
                fclose($fp);
            }
        }
    }

    /**
     * Return an array containing all of the states that are more stable than
     * or equal to the passed in state
     *
     * @param string Release state
     * @param boolean Determines whether to include $state in the list
     * @return false|array False if $state is not a valid release state
     */
    static function betterStates($state, $include = false)
    {
        static $states = array('snapshot', 'devel', 'alpha', 'beta', 'stable');
        $i = array_search($state, $states);
        if ($i === false) {
            return false;
        }
        if ($include) {
            $i--;
        }
        return array_slice($states, $i + 1);
    }
}
<?php
/**
 * PEAR2_Pyrus_Package_Base
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Base class for representing a package in Pyrus
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
abstract class PEAR2_Pyrus_Package_Base implements PEAR2_Pyrus_IPackage
{
    protected $packagefile;
    /**
     * The original source of this package
     *
     * This is a chain documenting the steps it took to get this
     * package instantiated, for instance Tar->Abstract
     * @var PEAR2_Pyrus_IPackage
     */
    protected $from;

    function __construct(PEAR2_Pyrus_PackageFile $packagefile, $parent = null)
    {
        $this->packagefile = $packagefile;
        $this->from = $parent;
    }

    function isStatic()
    {
        return true;
    }

    /**
     * Used to determine whether a package is designed for Pyrus, or for the PEAR installer
     *
     * @return bool
     */
    function isNewPackage()
    {
        return version_compare($this->dependencies['required']->pearinstaller->min,
                               '2.0.0a1', '>=');
    }

    function isUpgradeable()
    {
        if (!isset(PEAR2_Pyrus_Installer::$options['upgrade'])) {
            // we don't attempt to upgrade a dep unless we're upgrading
            return false;
        }
        $reg = PEAR2_Pyrus_Config::current()->registry;
        $version = $reg->info($this->name, $info->channel, 'version');
        if (version_compare($this->version, $version, '<=')) {
            return false;
        }
        return true;
    }

    function isPlugin()
    {
        foreach ($this->installcontents as $file) {
            if ($file->role === 'customrole' || $file->role === 'customtask' || $file->role === 'customcommand') {
                return true;
            }
        }
        return false;
    }

    /**
     * This test tells the installer whether to run any package-info
     * replacement tasks.
     *
     * The XML package has not had any package-info transformations.  Packages
     * in tar/zip/phar format have had package-info replacements.
     * @return bool if false, the installer will run all packag-einfo replacements
     */
    function isPreProcessed()
    {
        return true;
    }

    function setFrom(PEAR2_Pyrus_IPackage $from)
    {
        $this->from = $from;
    }

    function getFrom()
    {
        if ($this->from) {
            return $this->from->getFrom();
        }

        return $this;
    }

    /**
     * Sort files/directories for removal
     *
     * Files are always removed first, followed by directories in
     * path order
     * @param unknown_type $a
     * @param unknown_type $b
     * @return unknown
     */
    static function sortstuff($a, $b)
    {
        // files can be removed in any order
        if (is_file($a) && is_file($b)) return 0;
        if (is_dir($a) && is_file($b)) return 1;
        if (is_dir($b) && is_file($a)) return -1;
        $countslasha = substr_count($a, DIRECTORY_SEPARATOR);
        $countslashb = substr_count($b, DIRECTORY_SEPARATOR);
        if ($countslasha > $countslashb) return -1;
        if ($countslashb > $countslasha) return 1;
        // if not subdirectories, tehy can be removed in any order
        return 0;
    }

    /**
     * Create vertices/edges of a directed graph for dependencies of this package
     *
     * Iterate over dependencies and create edges from this package to those it
     * depends upon
     * @param PEAR2_Pyrus_DirectedGraph $graph
     * @param array $packages channel/package indexed array of PEAR2_Pyrus_Package objects
     */
    function makeConnections(PEAR2_Pyrus_DirectedGraph $graph, array $packages)
    {
        $graph->add($this->getFrom());
        foreach (array('required', 'optional') as $required) {
            foreach (array('package', 'subpackage') as $package) {
                foreach ($this->dependencies[$required]->$package as $d) {
                    if ($d->conflicts) {
                        continue;
                    }

                    if (isset($packages[$d->channel . '/' . $d->name])) {
                        $graph->connect($this, $packages[$d->channel . '/' . $d->name]);
                    }
                }
            }
        }

        foreach ($this->dependencies['group'] as $group) {
            foreach (array('package', 'subpackage') as $package) {
                foreach ($group->$package as $d) {
                    if ($d->conflicts) {
                        continue;
                    }

                    if (isset($packages[$d->channel . '/' . $d->name])) {
                        $graph->connect($this, $packages[$d->channel . '/' . $d->name]);
                    }
                }
            }
        }
    }

    function offsetExists($offset)
    {
        return $this->packagefile->info->hasFile($offset);
    }

    function offsetGet($offset)
    {
        if (strpos($offset, 'contents://') === 0) {
            return $this->getFileContents(substr($offset, 11));
        }

        return $this->packagefile->info->getFile($offset);
    }

    function offsetSet($offset, $value)
    {
        return;
    }

    function offsetUnset($offset)
    {
        return;
    }

    function getPackageFile()
    {
        return $this->packagefile;
    }

    function __call($func, $args)
    {
        // delegate to the internal object
        return call_user_func_array(array($this->packagefile->info, $func), $args);
    }

    function __get($var)
    {
        return $this->packagefile->info->$var;
    }

    function __set($var, $value)
    {
        return $this->packagefile->info->$var = $value;
    }

    function getValidator()
    {
        return $this->packagefile->info->getValidator();
    }

    function toArray($forpackaging = false)
    {
        return $this->packagefile->info->toArray($forpackaging);
    }

    function __toString()
    {
        return $this->packagefile->__toString();
    }

    function validate($state = PEAR2_Pyrus_Validate::NORMAL)
    {
        $validator = $this->packagefile->getValidator();
        if (!$validator->validate($this, $state)) {
            throw new PEAR2_Pyrus_PackageFile_Exception('Invalid package.xml', $validator->getErrors());
        }
    }

    function getPackageFileObject()
    {
        return $this->packagefile;
    }

    function getFileContents($file, $asstream = false)
    {
        if (!isset($this[$file])) {
            throw new PEAR2_Pyrus_Package_Exception('file ' . $file . ' is not in this package');
        }
        if ($asstream) {
            $fp = fopen($this->getFilePath($file), 'rb');
            return $fp;
        } else {
            $ret = file_get_contents($this->getFilePath($file));
            if (!$ret) {
                $ret = '';
            }
            return $ret;
        }
    }
}
<?php
/**
 * PEAR2_Pyrus_Package_Xml
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Package represented just by the package.xml file
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Package_Xml extends PEAR2_Pyrus_Package_Base
{
    private $_file;
    function __construct($package, PEAR2_Pyrus_Package $parent, PEAR2_Pyrus_PackageFile $info = null)
    {
        $this->_file = $package;
        if ($info === null) {
            $info = new PEAR2_Pyrus_PackageFile($package);
        }
        parent::__construct($info, $parent);
    }

    /**
     * This test tells the installer whether to run any package-info
     * replacement tasks.
     *
     * The XML package has not had any package-info transformations.  Packages
     * in tar/zip/phar format have had package-info replacements.
     * @return bool if false, the installer will run all packag-einfo replacements
     */
    function isPreProcessed()
    {
        return false;
    }

    function copyTo($where)
    {
        throw new PEAR2_Pyrus_Package_Exception('download/copy not supported for extracted packages');
    }

    function getFilePath($file)
    {
        return dirname($this->_file) . DIRECTORY_SEPARATOR . $file;
    }
}
<?php
/**
 * PEAR2_Pyrus_Package_Creator_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for package creator
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Package_Creator_Exception extends PEAR2_Exception {}<?php
/**
 * PEAR2_Pyrus_Package_Creator_TaskIterator
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Class which iterates over all the tasks to perform for package creation.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Package_Creator_TaskIterator extends FilterIterator
{
    private $_inner;
    private $_parent;
    private $_tasksNs;
    private $_installphase;
    protected $lastversion;

    function __construct(array $arr, PEAR2_Pyrus_IPackage $parent, $phase, $lastversion = null)
    {
        $this->_parent = $parent;
        $this->_tasksNs = $this->_parent->getTasksNs();
        $this->_installphase = $phase;
        $this->lastversion = $lastversion;
        parent::__construct($this->_inner = new ArrayIterator($arr));
    }

    function accept()
    {
        if (!$this->_inner->valid()) {
            return false;
        }

        if ($this->_inner->key() == 'attribs') {
            return false;
        }

        $key = parent::key();
        if (strpos($key, $this->_tasksNs . ':') !== 0) {
            return false;
        }

        $task = str_replace(array($this->_tasksNs . ':', '-'), array('', ' '), parent::key());
        $task = str_replace(' ', '/', ucwords($task));
        $task = str_replace('/', '_', $task);
        $task = 'PEAR2_Pyrus_Task_' . $task;

        if (0 == $task::PHASE & $this->_installphase) {
            // skip tasks that won't run in this installphase
            return false;
        }

        if ($this->_installphase == PEAR2_Pyrus_Task_Common::INSTALL && $this->_parent->isPreProcessed()) {
            $info = $this->current();
            if ($info->isPreProcessed()) {
                // some tasks are pre-processed at package-time
                return false;
            }
        }
        return true;
    }

    function key()
    {
        return str_replace($this->_tasksNs . ':', '', parent::key());
    }

    function current()
    {
        $xml = parent::current();
        if (isset($xml[0])) {
            $tasks = array();
            $task = str_replace(array($this->_tasksNs . ':', '-'), array('', ' '), parent::key());
            $task = str_replace(' ', '/', ucwords($task));
            $task = str_replace('/', '_', $task);
            $task = 'PEAR2_Pyrus_Task_' . $task;
            foreach ($xml as $info) {
                $attribs = array();
                if (isset($xml['attribs'])) {
                    $attribs = $xml['attribs'];
                }
                $tasks[] = new $task($this->_parent, $this->_installphase, $info, $attribs, $this->lastversion);
            }
            // use proxy for multiple tasks
            return new PEAR2_Pyrus_Task_MultipleProxy($this->_parent, $tasks, $this->_inner['attribs'], $this->key());
        }
        $attribs = array();
        if (isset($xml['attribs'])) {
            $attribs = $xml['attribs'];
        }
        $task = str_replace(array($this->_tasksNs . ':', '-'), array('', ' '), parent::key());
        $task = str_replace(' ', '/', ucwords($task));
        $task = str_replace('/', '_', $task);
        $task = 'PEAR2_Pyrus_Task_' . $task;
        return new $task($this->_parent, $this->_installphase, $xml, $attribs, $this->lastversion);
    }
}<?php
/**
 * PEAR2_Pyrus_Package_InstalledException
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for installed packages
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Package_InstalledException extends PEAR2_Pyrus_Package_Exception {}<?php
/**
 * PEAR2_Pyrus_Package_Zip_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for Zip packages
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Package_Zip_Exception extends PEAR2_Exception {}<?php
/**
 * PEAR2_Pyrus_Package_Remote
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Class representing a remote package
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Package_Remote extends PEAR2_Pyrus_Package
{
    private $_info;
    protected $parsedname;
    protected $explicitState = false;
    protected $explicitVersion;
    protected $explicitGroup;
    protected $type;
    protected $isUpgradeable = null;
    /**
     * For easy unit testing
     */
    static public $downloadClass = 'PEAR2_HTTP_Request';
    /**
     * @param string $package path to package file
     */
    function __construct($package, PEAR2_Pyrus_Package $parent = null)
    {
        $this->_info = $package;
        if (!is_array($package) &&
              (preg_match('#^(http[s]?|ftp[s]?)://#', $package))) {
            $this->internal = $this->fromUrl($package);
        } else {
            $this->internal = $this->fromString($package);
        }
        $this->from = $parent;
    }

    function isStatic()
    {
        if ($this->type == 'url') {
            return true;
        }
        return $this->explicitVersion;
    }

    function getExplicitState()
    {
        return $this->explicitState;
    }

    function setUpgradeable()
    {
        $this->isUpgradeable = true;
    }

    function isUpgradeable()
    {
        if ($this->isUpgradeable === null) {
            // we are not a dependency, so figure out a version that could work
            if (!isset(PEAR2_Pyrus_Installer::$options['upgrade'])) {
                // we don't attempt to upgrade a dep unless we're upgrading
                return;
            }
            $reg = PEAR2_Pyrus_Config::current()->registry;
            $version = $reg->info($this->name, $this->channel, 'version');
            $stability = $reg->info($this->name, $this->channel, 'state');
            if ($this->explicitState) {
                $stability = $this->explicitState;
            } else {
                $installedstability = PEAR2_Pyrus_Installer::betterStates($stability);
                $preferred = PEAR2_Pyrus_Installer::betterStates($pref =PEAR2_Pyrus_Config::current()->preferred_state);
                if (count($preferred) < count($installedstability)) {
                    $stability = $pref;
                }
            }
            // see if there are new versions in our stability or better
            $remote = new PEAR2_Pyrus_Channel_Remotepackage(PEAR2_Pyrus_Config::current()
                                                            ->channelregistry[$this->channel], $stability);
            $found = false;
            foreach ($remote[$this->name] as $remoteversion => $rinfo) {
                if (version_compare($remoteversion, $version, '<=')) {
                    continue;
                }
                if (version_compare($rinfo['minimumphp'], phpversion(), '>')) {
                    continue;
                }
                // found one, so upgrade is possible if dependencies pass
                $found = true;
                break;
            }
            // the installed package version satisfies this dependency, don't do anything
            if (!$found) {
                $this->isUpgradeable = false;
            } else {
                $this->isUpgradeable = true;
            }
        }
        return $this->isUpgradeable;
    }

    /**
     * Convert this remote packagefile into a local .tar, .tgz or .phar
     *
     * @return PEAR2_Pyrus_Package_Base
     */
    function download()
    {
        if ($this->type === 'url') {
            return $this->internal;
        }

        $internal = $this->internal->download();
        if ($internal->name != $this->name) {
            throw new PEAR2_Pyrus_Package_Exception('Invalid package downloaded, package name changed from ' .
                                                    $this->name . ' to ' . $internal->name);
        }
        if ($internal->channel != $this->channel) {
            throw new PEAR2_Pyrus_Package_Exception('SECURITY ERROR: package is claiming to be from ' .
                                                    'channel ' . $internal->channel . ', but we are ' .
                                                    'channel ' . $this->name);
        }
        $internal->setFrom($this->internal);
        $this->internal = $internal;
        return $this->internal;
    }

    function copyTo($where)
    {
        $old = PEAR2_Pyrus_Config::current()->download_dir;
        PEAR2_Pyrus_Config::current()->download_dir = $where;
        $this->download();
        PEAR2_Pyrus_Config::current()->download_dir = $old;
        return;
    }

    protected function fromUrl($param, $saveparam = '')
    {
        $this->type = 'url';
        $dir = PEAR2_Pyrus_Config::current()->download_dir;
        try {
            $download = static::$downloadClass;
            $http = new $download($param);
            $response = $http->sendRequest();
            $name = 'unknown.tgz';
            if ($response->code != '200') {
                throw new PEAR2_Pyrus_Package_Exception('Download failed, received ' . $response->code);
            }

            if (isset($response->headers['content-disposition'])) {
                if (preg_match('/filename="(.+)"/', $response->headers['content-disposition'], $match)) {
                    $name = $match[1];
                }
            }

            if (!@file_exists($dir)) {
                mkdir($dir, 0755, true);
            }

            file_put_contents($dir . DIRECTORY_SEPARATOR . $name, $response->body);

            // whew, download worked!
            $a = new PEAR2_Pyrus_Package($dir . DIRECTORY_SEPARATOR . $name);
            return $a->getInternalPackage();
        } catch (Exception $e) {
            if (!empty($saveparam)) {
                $saveparam = ", cannot download \"$saveparam\"";
            }
            throw new PEAR2_Pyrus_Package_Exception('Could not download from "' . $param .
                '"' . $saveparam, $e);
        }
    }

    /**
     *
     * @param string|array pass in an array of format
     *                     array(
     *                      'package' => 'pname',
     *                     ['channel' => 'channame',]
     *                     ['version' => 'version',]
     *                     ['state' => 'state',])
     *                     or a string of format [channame/]pname[-version|-state]
     */
    protected function fromString($param)
    {
        try {
            $pname = PEAR2_Pyrus_Config::parsePackageName($param, true);
        } catch (PEAR2_Pyrus_ChannelRegistry_ParseException $e) {
            if ($e->why !== 'channel') {
                throw new PEAR2_Pyrus_Package_Exception(
                    'invalid package name/package file "' . $param . '"', $e);
            }

            if (PEAR2_Pyrus_Config::current()->auto_discover) {
                try {
                    try {
                        $chan = new PEAR2_Pyrus_Channel(
                                    new PEAR2_Pyrus_ChannelFile('https://' . $e->params['channel'] . '/channel.xml',
                                                                false, true));
                    } catch (\Exception $e) {
                        $chan = new PEAR2_Pyrus_Channel(
                                    new PEAR2_Pyrus_ChannelFile('http://' . $e->params['channel'] . '/channel.xml',
                                                                false, true));
                    }
                } catch (\Exception $e) {
                    throw new PEAR2_Pyrus_Package_Exception(
                        'Cannot auto-discover channel ' . $e->params['channel'], $e);
                }
                PEAR2_Pyrus_Config::current()->channelregistry[] = $chan;
                try {
                    PEAR2_Pyrus_Config::parsePackageName($param,
                            PEAR2_Pyrus_Config::current()->default_channel);
                } catch (\Exception $e) {
                    throw new PEAR2_Pyrus_Package_Exception(
                        'invalid package name/package file "' . $param . '"', $e);
                }
            } else {
                PEAR2_Pyrus_Log::log(0, 'Channel "' . $param['channel'] .
                    '" is not initialized, use ' .
                    '"pyrus channel-discover ' . $param['channel'] . '" to initialize' .
                    'or pyrus set auto_discover 1');
            }
        }

        $this->parsedname    = $pname;
        $this->explicitVersion = isset($pname['version']) ? $pname['version'] : false;
        $this->explicitState = isset($pname['state']) ? $pname['state'] : false;
        $this->explicitGroup = isset($pname['group']) ? true            : false;

        $reg = PEAR2_Pyrus_Config::current()->registry;
        $version = $reg->info($pname['package'], $pname['channel'], 'version');
        $stability = $reg->info($pname['package'], $pname['channel'], 'state');

        if (!isset(PEAR2_Pyrus_Installer::$options['force']) &&
              !isset(PEAR2_Pyrus_Installer::$options['downloadonly']) &&
              $version && $this->explicitVersion &&
              !isset($pname['group'])) {
            if (version_compare($version, $pname['version'], '>=')) {
                throw new PEAR2_Pyrus_Package_InstalledException(
                    PEAR2_Pyrus_Config::parsedPackageNameToString($parr, true) .
                    ' is already installed and is newer than detected ' .
                    'release version ' . $pname['version']);
            }
        }
        if (!$this->explicitVersion && $stability) {
            // if installed, use stability of the installed package,
            // but only if it is less restrictive than preferred_state.
            // This allows automatic upgrade to a newer beta for 1 package
            // even if preferred_state is stable, for instance.
            $states = PEAR2_Pyrus_Installer::betterStates(PEAR2_Pyrus_Config::current()->preferred_state);
            $newstates = PEAR2_Pyrus_Installer::betterStates($stability);
            if (count($newstates) > count($states)) {
                $this->explicitState = $stability;
            }
        }

        $this->type = 'abstract';
        $ret = $this->getRemotePackage($pname);
        if ($this->explicitVersion) {
            $ret->setExplicitVersion($this->explicitVersion);
            $ret->version['release'] = $this->explicitVersion;
        }
        if ($this->explicitState) {
            $ret->setExplicitState($this->explicitState);
        }
        return $ret;
    }

    /**
     * @param array output of {@link parsePackageName()}
     * @return PEAR2_Pyrus_Channel_RemotePackage
     * @access private
     */
    function getRemotePackage($parr)
    {
        // getDownloadURL returns an array.  On error, it only contains information
        // on the latest release as array(version, info).  On success it contains
        // array(version, info, download url string)
        $state = isset($parr['state']) ? $parr['state'] :  PEAR2_Pyrus_Config::current()->preferred_state;
        if (!isset(PEAR2_Pyrus_Config::current()->channelregistry[$parr['channel']])) {
            throw new PEAR2_Pyrus_Package_Exception(
                'Unknown remote channel: ' . $parr['channel']);
        }

        try {
            $chan = PEAR2_Pyrus_Config::current()->channelregistry[$parr['channel']];
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_Package_Exception('Cannot retrieve download information ' .
                'for remote abstract package ' . $parr['channel'] . '/' . $parr['package'], $e);
        }

        $p_mirror = PEAR2_Pyrus_Config::current()->preferred_mirror;
        $mirror   = isset($chan->mirrors[$p_mirror]) ? $chan->mirrors[$p_mirror] : $chan;
        return $mirror->remotepackage[$parr['package']];
    }
}<?php
/**
 * PEAR2_Pyrus_Package_Phar_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for Phar packages
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Package_Phar_Exception extends PEAR2_Exception {}<?php
/**
 * PEAR2_Pyrus_Package_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for Packages
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Package_Exception extends PEAR2_Exception {}<?php
/**
 * PEAR2_Pyrus_Package_Tar
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Class for handling a tar package
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Package_Tar extends PEAR2_Pyrus_Package_Base
{
    private $_fp;
    private $_packagename;
    private $_internalFileLength;
    private $_footerLength;
    private $_tmpdir;
    private $_BCpackage;
    static private $_tempfiles = array();

    /**
     * @param string $package path to package file
     */
    function __construct($package, PEAR2_Pyrus_Package $parent)
    {
        $this->_packagename = $package;
        $info = pathinfo($package);
        $streamfilters = stream_get_filters();
        $this->_fp = fopen($package, 'rb');
        switch ($info['extension']) {
            case 'tgz' :
                if ($this->_fp) {
                    fclose($this->_fp);
                    if (!function_exists('gzopen')) {
                        throw new PEAR2_Pyrus_Package_Tar_Exception('Cannot extract package '.
                            $package . ', PHP must have the zlib extension enabled --with-zlib.');
                    } else {
                        $this->_fp = gzopen($package, 'rb');
                    }
                }
                break;
            case 'tbz' :
                if (!in_array('bzip2.*', $streamfilters)) {
                    throw new PEAR2_Pyrus_Package_Tar_Exception('Cannot open package' .
                        $package . ', bzip2 decompression is not available');
                }
                stream_filter_append($this->_fp, 'bzip2.decompress');
        }

        if (!$this->_fp) {
            throw new PEAR2_Pyrus_Package_Tar_Exception('Cannot open package ' . $package);
        }

        $packagexml = $this->_extract();
        parent::__construct(new PEAR2_Pyrus_PackageFile($packagexml), $parent);
    }

    function __destruct()
    {
        usort(self::$_tempfiles, array('PEAR2_Pyrus_Package_Base', 'sortstuff'));
        foreach (self::$_tempfiles as $fileOrDir) {
            if (!file_exists($fileOrDir)) {
                continue;
            }

            if (is_file($fileOrDir)) {
                unlink($fileOrDir);
            } elseif (is_dir($fileOrDir)) {
                rmdir($fileOrDir);
            }
        }
    }

    function isNewPackage()
    {
        return !$this->_BCpackage;
    }

    private static function _addTempFile($file)
    {
        self::$_tempfiles[] = $file;
    }

    private static function _addTempDirectory($dir)
    {
        do {
            self::$_tempfiles[] = $dir;
            $dir = dirname($dir);
        } while (!file_exists($dir));
    }

    function getTarballPath()
    {
        return $this->_packagename;
    }

    function copyTo($where)
    {
        copy($this->_packagename, $where . DIRECTORY_SEPARATOR . basename($this->_packagename));
        $this->_packagename = $where . DIRECTORY_SEPARATOR . basename($this->_packagename);
    }

    function __get($var)
    {
        if ($var === 'archivefile') {
            return $this->_packagename;
        }
        return parent::__get($var);
    }

    function getFilePath($file)
    {
        if (!isset($this->packagefile->info->files[$file])) {
            throw new PEAR2_Pyrus_Package_Exception('file ' . $file . ' is not in package.xml');
        }

        $extract = '';
        if ($this->_BCpackage) {
            // old fashioned PEAR 1.x packages put everything in Package-Version/
            // directory
            $extract = $this->packagefile->info->name . '-' .
                $this->packagefile->info->version['release'];
        }

        $extract = $this->_tmpdir . $extract . DIRECTORY_SEPARATOR . $file;
        $extract = str_replace('\\', '/', $extract);
        $extract = str_replace('//', '/', $extract);
        $extract = str_replace('/', DIRECTORY_SEPARATOR, $extract);
        return $extract;
    }

    private function _processHeader($rawHeader)
    {
        if (strlen($rawHeader) < 512 || $rawHeader == pack("a512", "")) {
            throw new PEAR2_Pyrus_Package_Tar_Exception(
                'Error: "' . $this->_packagename . '" has corrupted tar header');
        }

        $header = unpack(
            "a100filename/a8mode/a8uid/a8gid/a12size/a12mtime/".
            "a8checksum/a1type/a100linkname/a6magic/a2version/".
            "a32uname/a32gname/a8devmajor/a8devminor/a155path",
            $rawHeader);
        $this->_internalFileLength = octdec($header['size']);
        if ($this->_internalFileLength % 512 == 0) {
            $this->_footerLength = 0;
        } else {
            $this->_footerLength = 512 - $this->_internalFileLength % 512;
        }
        return $header;
    }

    private function _readHeader($rawHeader)
    {
        if (!strlen($rawHeader)) {
            $this->_internalFileLength = $this->_footerLength = 0;
            return true;
        }

        if (strlen($rawHeader) != 512) {
            throw new PEAR2_Pyrus_Package_Tar_Exception(
                'Invalid block size : ' . strlen($rawHeader));
        }
        $header = $this->_processHeader($rawHeader);
        if ($header['type'] == 'L') {
            // filenames longer than 100 characters
            // borrowed from Archive_Tar written by Vincent Blavet
            $longFilename = '';
            $n = floor($header['size'] / 512);
            for ($i=0; $i < $n; $i++) {
                $content = fread($this->_fp, 512);
                $longFilename .= $content;
            }
            if (($header['size'] % 512) != 0) {
                $content = fread($this->_fp, 512);
                $longFilename .= $content;
            }
            // ----- Read the next header
            $newHeader = fread($this->_fp, 512);
            $header = $this->_processHeader($newHeader);
            $header['filename'] = trim($longFilename);
            $rawHeader = $newHeader;
        }
        if ($this->_maliciousFilename($header['filename'])) {
            throw new PEAR2_Pyrus_Package_Tar_Exception('Malicious .tar detected, file "' .
                $header['filename'] .
                '" will not install in desired directory tree');
        }

        $checksum = 256; // 8 * ord(' ');
        $c1 = str_split($rawHeader);
        $checkheader = array_merge(array_slice($c1, 0, 148), array_slice($c1, 156));
        if (!function_exists('_pear2tarchecksum')) {
            function _pear2tarchecksum($a, $b) {return $a + ord($b);}
        }
        $checksum += array_reduce($checkheader, '_pear2tarchecksum');

        // ----- Extract the checksum
        $header['checksum'] = octdec(trim($header['checksum']));
        if ($header['checksum'] != $checksum) {
            $header['filename'] = '';

            // ----- Look for last block (empty block)
            if (($checksum == 256) && ($header['checksum'] == 0)) {
                return true;
            }

            throw new PEAR2_Pyrus_Package_Tar_Exception(
                'Invalid checksum for header of file "' . $header['filename'] .
                '" : ' . $checksum . ' calculated, ' .
                $header['checksum'] . ' expected');
        }

        $header['filename'] = trim($header['filename']);
        $header['mode'] = octdec(trim($header['mode']));
        $header['uid'] = octdec(trim($header['uid']));
        $header['gid'] = octdec(trim($header['gid']));
        $header['size'] = octdec(trim($header['size']));
        $header['mtime'] = octdec(trim($header['mtime']));
        if ($header['type'] == '5') {
            $header['size'] = 0;
        }
        $header['linkname'] = trim($header['linkname']);
        return $header;
    }

    /**
     * Detect and report a malicious file name
     *
     * @param string $file
     * @return bool
     * @access private
     */
    private function _maliciousFilename($file)
    {
        if (strpos($file, '/../') !== false) {
            return true;
        }
        if (strpos($file, '../') === 0) {
            return true;
        }
        return false;
    }

    /**
     * Extract the archive so we can work with the contents
     *
     */
    private function _extract()
    {
        $packagexml = false;
        $where = (string) PEAR2_Pyrus_Config::current()->temp_dir;
        $where = str_replace('\\', '/', $where);
        $where = str_replace('//', '/', $where);
        $where = str_replace('/', DIRECTORY_SEPARATOR, $where);
        if (!file_exists($where)) {
            mkdir($where, 0777, true);
        }

        $where = realpath($where);
        if (dirname($where . 'a') != $where) {
            $where .= DIRECTORY_SEPARATOR;
        }

        $this->_tmpdir = $where;
        do {
            $header = fread($this->_fp, 512);
            if ($header == pack('a512', '')) {
                // end of archive
                break;
            }

            $header = $this->_readHeader($header);
            $extract = $where . $header['filename'];
            $extract = str_replace('\\', '/', $extract);
            $extract = str_replace('//', '/', $extract);
            $extract = str_replace('/', DIRECTORY_SEPARATOR, $extract);
            self::_addTempFile($extract);
            if (!file_exists(dirname($extract))) {
                self::_addTempDirectory(dirname($extract));
                mkdir(dirname($extract), 0777, true);
            }

            $fp = fopen($extract, 'wb');
            $amount = stream_copy_to_stream($this->_fp, $fp, $this->_internalFileLength);
            if ($amount != $this->_internalFileLength) {
                throw new PEAR2_Pyrus_Package_Tar_Exception(
                    'Unable to fully extract ' . $header['filename'] . ' from ' .
                    $this->_packagename);
            }

            if ($this->_footerLength) {
                fseek($this->_fp, $this->_footerLength, SEEK_CUR);
            }

            if (!$packagexml) {
                if (preg_match('/^package\-.+\-\\d+(?:\.\d+)*(?:[a-zA-Z]+\d*)?.xml$/',
                      $header['filename'])) {
                    $this->_BCpackage = false;
                    $packagexml = $where . $header['filename'];
                } elseif ($header['filename'] == 'package2.xml') {
                    $this->_BCpackage = true;
                    $packagexml = $where . $header['filename'];
                } elseif ($header['filename'] == 'package.xml') {
                    $this->_BCpackage = true;
                    $packagexml = $where . $header['filename'];
                }
            }
        } while ($this->_internalFileLength);

        fclose($fp);
        fclose($this->_fp);
        if (!$packagexml) {
            throw new PEAR2_Pyrus_Package_Tar_Exception('Archive ' . $this->_packagename .
                ' does not contain a package.xml file');
        }

        return $packagexml;
    }
}
<?php
/**
 * PEAR2_Pyrus_Package_Zip
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Class representing a Zip package
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Package_Zip extends PEAR2_Pyrus_Package_Base
{
    private $_packagename;
    static private $_tempfiles = array();
    private $_tmpdir;

    /**
     * @param string $package path to package file
     */
    function __construct($package, PEAR2_Pyrus_Package $parent)
    {
        if (!class_exists('ZIPArchive')) {
            throw new PEAR2_Pyrus_Package_Zip_Exception(
                'Zip extension is not available');
        }

        $this->_packagename = $package;
        $zip = new ZIPArchive;
        if (true !== ($zip->open($package))) {
            throw new PEAR2_Pyrus_Package_Zip_Exception('Could not open ZIP archive ' .
                $package);
        }

        if (false !== ($pxml = $zip->getNameIndex(0))) {
            if (!preg_match('/^package\-.+\-\\d+(?:\.\d+)*(?:[a-zA-Z]+\d*)?.xml$/',
                      $pxml)) {
                throw new PEAR2_Pyrus_Package_Zip_Exception('First file in ZIP archive ' .
                    'is not package.xml, cannot process');
            }
        }

        $where = (string) PEAR2_Pyrus_Config::current()->temp_dir;
        $where = str_replace('\\', '/', $where);
        $where = str_replace('//', '/', $where);
        $where = str_replace('/', DIRECTORY_SEPARATOR, $where);
        if (!file_exists($where)) {
            mkdir($where, 0777, true);
        }

        $where = realpath($where);
        if (dirname($where . 'a') != $where) {
            $where .= DIRECTORY_SEPARATOR;
        }

        $this->_tmpdir = $where;
        $zip->extractTo($where);
        parent::__construct(new PEAR2_Pyrus_PackageFile($where . DIRECTORY_SEPARATOR . $pxml),
            $parent);
    }

    function __destruct()
    {
        usort(self::$_tempfiles, array('PEAR2_Pyrus_Package_Base', 'sortstuff'));
        foreach (self::$_tempfiles as $fileOrDir) {
            if (!file_exists($fileOrDir)) {
                continue;
            }

            if (is_file($fileOrDir)) {
                unlink($fileOrDir);
            } elseif (is_dir($fileOrDir)) {
                rmdir($fileOrDir);
            }
        }
    }

    private static function _addTempFile($file)
    {
        self::$_tempfiles[] = $file;
    }

    private static function _addTempDirectory($dir)
    {
        do {
            self::$_tempfiles[] = $dir;
            $dir = dirname($dir);
        } while (!file_exists($dir));
    }

    function __get($var)
    {
        if ($var === 'archivefile') {
            return $this->_packagename;
        }

        return parent::__get($var);
    }

    function getFilePath($file)
    {
        if (!isset($this->packagefile->info->files[$file])) {
            throw new PEAR2_Pyrus_Package_Exception('file ' . $file . ' is not in package.xml');
        }

        $extract = $this->_tmpdir . DIRECTORY_SEPARATOR . $file;
        $extract = str_replace('\\', '/', $extract);
        $extract = str_replace('//', '/', $extract);
        $extract = str_replace('/', DIRECTORY_SEPARATOR, $extract);
        return $extract;
    }
}
<?php
/**
 * PEAR2_Pyrus_Package_Tar_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception class for Tar packages
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Package_Tar_Exception extends PEAR2_Exception {}<?php
/**
 * PEAR2_Pyrus_Package_Creator
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Create packages using provided renderers.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Package_Creator
{
    const VERSION = '2.0.0a1';
    private $_creators;
    private $_handles = array();
    /**
     * Begin package creation
     *
     * @param array|PEAR2_Pyrus_Package_ICreator $creators
     */
    function __construct($creators, $pear2ExceptionPath = false, $pear2AutoloadPath = false,
                         $pear2MultiErrorsPath = false)
    {
        if (!$pear2ExceptionPath) {
            if (!($pear2Exception = @fopen('PEAR2/Exception.php', 'r', true))) {
                throw new PEAR2_Pyrus_Package_Exception('Cannot locate PEAR2/Exception.php, please' .
                    ' pass in the path to the constructor');
            }
        } else {
            if ($a = realpath($pear2ExceptionPath)) {
                $pear2ExceptionPath = $a;
            }
            if (dirname($pear2ExceptionPath) == dirname($pear2ExceptionPath . 'test')) {
                $pear2ExceptionPath .= '/';
            }
            if (!($pear2Exception = @fopen($pear2ExceptionPath . 'Exception.php', 'r'))) {
                throw new PEAR2_Pyrus_Package_Exception('Cannot locate PEAR2/Exception.php' .
                    ' in ' . $pear2ExceptionPath);
            }
        }

        if (!$pear2AutoloadPath) {
            if (!($pear2Autoload = @fopen('PEAR2/Autoload.php', 'r', true))) {
                fclose($pear2Exception);
                throw new PEAR2_Pyrus_Package_Exception('Cannot locate PEAR2/Autoload.php, please' .
                    ' pass in the path to the constructor');
            }
        } else {
            if ($a = realpath($pear2AutoloadPath)) {
                $pear2AutoloadPath = $a;
            }
            if (dirname($pear2AutoloadPath) == dirname($pear2AutoloadPath . 'test')) {
                $pear2AutoloadPath .= '/';
            }
            if (!($pear2Autoload = @fopen($pear2AutoloadPath . 'Autoload.php', 'r'))) {
                fclose($pear2Exception);
                throw new PEAR2_Pyrus_Package_Exception('Cannot locate PEAR2/Autoload.php' .
                    ' in ' . $pear2AutoloadPath);
            }
        }

        if (!$pear2MultiErrorsPath) {
            if (!($pear2MultiErrors = @fopen('PEAR2/MultiErrors.php', 'r', true))) {
                fclose($pear2Exception);
                fclose($pear2Autoload);
                throw new PEAR2_Pyrus_Package_Exception('Cannot locate PEAR2/MultiErrors.php, please' .
                    ' pass in the path to the constructor');
            }

            if (!($pear2MultiErrorsException = @fopen('PEAR2/MultiErrors/Exception.php', 'r', true))) {
                fclose($pear2Exception);
                fclose($pear2Autoload);
                fclose($pear2MultiErrors);
                throw new PEAR2_Pyrus_Package_Exception('Cannot locate PEAR2/MultiErrors/Exception.php, please' .
                    ' pass in the path to the constructor');
            }
        } else {
            if ($a = realpath($pear2MultiErrorsPath)) {
                $pear2MultiErrorsPath = $a;
            }
            if (dirname($pear2MultiErrorsPath) == dirname($pear2MultiErrorsPath . 'test')) {
                $pear2MultiErrorsPath .= '/';
            }

            if (!($pear2MultiErrors = @fopen($pear2MultiErrorsPath . 'MultiErrors.php', 'r'))) {
                fclose($pear2Exception);
                fclose($pear2Autoload);
                throw new PEAR2_Pyrus_Package_Exception('Cannot locate PEAR2/MultiErrors.php' .
                    ' in ' . $pear2MultiErrorsPath . 'MultiErrors.php');
            }

            if (!($pear2MultiErrorsException = @fopen($pear2MultiErrorsPath . 'MultiErrors/Exception.php', 'r'))) {
                fclose($pear2Exception);
                fclose($pear2Autoload);
                fclose($pear2MultiErrors);
                throw new PEAR2_Pyrus_Package_Exception('Cannot locate PEAR2/MultiErrors/Exception.php' .
                    ' in ' . $pear2MultiErrorsPath . 'MultiErrors/Exception.php');
            }
        }

        $this->_handles['php/PEAR2/Autoload.php'] = $pear2Autoload;
        $this->_handles['php/PEAR2/MultiErrors.php'] = $pear2MultiErrors;
        $this->_handles['php/PEAR2/MultiErrors/Exception.php'] = $pear2MultiErrorsException;
        $this->_handles['php/PEAR2/Exception.php'] = $pear2Exception;
        if ($creators instanceof PEAR2_Pyrus_Package_ICreator) {
            $this->_creators = array($creators);
        } elseif (is_array($creators)) {
            foreach ($creators as $creator) {
                if ($creator instanceof PEAR2_Pyrus_Package_ICreator) {
                    continue;
                }

                throw new PEAR2_Pyrus_Package_Creator_Exception('Invalid ' .
                    'PEAR2 package creator passed into PEAR2_Pyrus_Package_Creator');
            }
            $this->_creators = $creators;
        } else {
            throw new PEAR2_Pyrus_Package_Creator_Exception('Invalid ' .
                'PEAR2 package creator passed into PEAR2_Pyrus_Package_Creator');
        }
    }

    /**
     * Render packages from the creators passed into the constructor.
     *
     * This will take any package source and an array mapping internal
     * path => file name and create new packages in the formats requested.
     *
     * All files in package.xml will have the string 2.0.0a1
     * automatically replaced with the current package's version
     * @param PEAR2_Pyrus_Package $package
     * @param array $extrafiles
     */
    function render(PEAR2_Pyrus_Package $package, array $extrafiles = array())
    {
        foreach ($this->_creators as $creator) {
            $creator->init();
        }

        $packagexml = '.xmlregistry/packages/' .
            str_replace('/', '!', $package->channel) . '/' . $package->name . '/' .
            $package->version['release'] . '-package.xml';
        if (self::VERSION === '@' . 'PACKAGE_VERSION@') {
            // we're running straight from SVN, so pretend to be 2.0.0
            $package->packagerversion = '2.0.0';
        } else {
            $package->packagerversion = self::VERSION;
        }

        // get packaging package.xml
        $packageingstr = (string) new PEAR2_Pyrus_XMLWriter($package->toArray(true));
        foreach ($this->_creators as $creator) {
            $creator->addFile($packagexml, $packageingstr);
        }
        $packagingloc = PEAR2_Pyrus_Config::current()->temp_dir . DIRECTORY_SEPARATOR . 'pyrpackage';
        if (file_exists($packagingloc)) {
            foreach (new RecursiveIteratorIterator(new RecursiveDirectoryIterator($packagingloc,
                        RecursiveDirectoryIterator::SKIP_DOTS), RecursiveIteratorIterator::CHILD_FIRST) as $file) {
                if (is_dir($file)) {
                    rmdir($file);
                } elseif (is_file($file)) {
                    unlink($file);
                }
            }
        } else {
            mkdir($packagingloc, 0777, true);
        }

        // $packageat is the relative path within the archive
        // $info is an array of format:
        // array('attribs' => array('name' => ...)[, 'tasks:blah' ...])
        $alreadyPackaged = array();
        $globalreplace = array('attribs' =>
                    array('from' => '@' . 'PACKAGE_VERSION@',
                          'to' => 'version',
                          'type' => 'package-info'));
        foreach ($package->packagingcontents as $packageat => $info) {
            $packageat = str_replace('\\', '/', $packageat);
            $packageat = str_replace('//', '/', $packageat);
            if ($packageat[0] === '/' ||
                  (strlen($packageat) > 2 && ($packageat[1] === ':' && $packageat[2] == '/'))) {
                throw new PEAR2_Pyrus_Package_Creator_Exception('Invalid path, cannot' .
                    ' save a root path ' . $packageat);
            }

            if (preg_match('@^\.\.?/|/\.\.?\\z|/\.\./@', $packageat)) {
                throw new PEAR2_Pyrus_Package_Creator_Exception('Invalid path, cannot' .
                    ' use directory reference . or .. ' . $packageat);
            }

            $alreadyPackaged[$packageat] = true;
            $contents = $package->getFileContents($info['attribs']['name'], true);
            if (!file_exists(dirname($packagingloc . DIRECTORY_SEPARATOR . $packageat))) {
                mkdir(dirname($packagingloc . DIRECTORY_SEPARATOR . $packageat), 0777, true);
            }
            $fp = fopen($packagingloc . DIRECTORY_SEPARATOR . $packageat, 'wb+');
            ftruncate($fp, 0);
            stream_copy_to_stream($contents, $fp);
            fclose($contents);
            rewind($fp);
            if ($info['attribs']['role'] == 'php') {
                if (isset($info['tasks:replace'])) {
                    if (isset($info['tasks:replace'][0])) {
                        $info['tasks:replace'][] = $globalreplace;
                    } else {
                        $info['tasks:replace'] = array($info['tasks:replace'], $globalreplace);
                    }
                } else {
                    $info['tasks:replace'] = $globalreplace;
                }
            }

            if (isset(PEAR2_Pyrus_Config::current()->registry->package[$package->channel . '/' . $package->name])) {
                $version = PEAR2_Pyrus_Config::current()->registry->info($package->name, $package->channel, 'version');
            } else {
                $version = null;
            }
            foreach (new PEAR2_Pyrus_Package_Creator_TaskIterator($info, $package,
                                                                  PEAR2_Pyrus_Task_Common::PACKAGE,
                                                                  $version) as $task) {
                // do pre-processing of file contents
                try {
                    $task->startSession($fp, $packageat);
                } catch (Exception $e) {
                    // TODO: handle exceptions
                }
            }
            fclose($fp);
        }

        foreach ($this->_creators as $creator) {
            $creator->addDir($packagingloc);
        }

        $creator->mkdir('php/PEAR2');
        foreach ($this->_handles as $path => $stream) {
            if (isset($alreadyPackaged[$path])) {
                continue; // we're packaging this package
            }

            foreach ($this->_creators as $creator) {
                $creator->addFile($path, $stream);
            }

            fclose($stream);
        }

        foreach ($this->_creators as $creator) {
            if (isset($alreadyPackaged['php/PEAR2/MultiErrors/Exception.php'])) {
                continue; // we're packaging MultiErrors package
            }

            $creator->mkdir('php/PEAR2/MultiErrors');
            $creator->addFile('php/PEAR2/MultiErrors/Exception.php',
                "<?php\nclass PEAR2_MultiErrors_Exception extends PEAR2_Exception {}");
        }

        foreach ($extrafiles as $path => $filename) {
            $path = str_replace('\\', '/', $path);
            $path = str_replace('//', '/', $path);
            if ($path[0] === '/' ||
                  (strlen($path) > 2 && ($path[1] === ':' && $path[2] == '/'))) {
                throw new PEAR2_Pyrus_Package_Creator_Exception('Invalid path, cannot' .
                    ' save a root path ' . $path);
            }

            if (preg_match('@^\.\.?/|/\.\.?\\z|/\.\./@', $path)) {
                throw new PEAR2_Pyrus_Package_Creator_Exception('Invalid path, cannot' .
                    ' use directory reference . or .. ' . $path);
            }

            if (isset($alreadyPackaged[$path])) {
                throw new PEAR2_Pyrus_Package_Creator_Exception('Path ' . $path .
                    'has already been added, and cannot be overwritten');
            }

            $alreadyPackaged[$path] = true;
            if (!@file_exists($filename) || !($fp = @fopen($filename, 'rb'))) {
                throw new PEAR2_Pyrus_Package_Creator_Exception('Extra file ' .
                    $filename . ' does not exist or cannot be read');
            }

            foreach ($this->_creators as $creator) {
                $creator->mkdir(dirname($path));
                $creator->addFile($path, $fp);
            }

            fclose($fp);
        }

        foreach ($this->_creators as $creator) {
            $creator->close();
        }
        foreach (new RecursiveIteratorIterator(new RecursiveDirectoryIterator($packagingloc,
                    RecursiveDirectoryIterator::SKIP_DOTS), RecursiveIteratorIterator::CHILD_FIRST) as $file) {
            if (is_dir($file)) {
                rmdir($file);
            } elseif (is_file($file)) {
                unlink($file);
            }
        }
        rmdir($packagingloc);
    }
}<?php
/**
 * PEAR2_Pyrus_Package_Phar
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/PEAR2/Pyrus/
 */

/**
 * Class for phar packages
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/PEAR2/Pyrus/
 */
class PEAR2_Pyrus_Package_Phar extends PEAR2_Pyrus_Package_Base
{
    private $_packagename;
    static private $_tempfiles = array();
    private $_tmpdir;
    private $_BCpackage = false;

    /**
     * @param string $package path to package file
     */
    function __construct($package, PEAR2_Pyrus_Package $parent)
    {
        $package = realpath($package);
        if (!$package) {
            throw new PEAR2_Pyrus_Package_Phar_Exception(
                'Phar package ' . $package . ' does not exist');
        }

        if (!class_exists('Phar')) {
            throw new PEAR2_Pyrus_Package_Phar_Exception(
                'Phar extension is not available');
        }

        $this->_packagename = $package;
        try {
            if (Phar::isValidPharFilename($package, 1)) {
                $phar = new Phar($package, RecursiveDirectoryIterator::KEY_AS_FILENAME);
                $pxml = $phar->getMetaData();
            } else {
                $phar = new PharData($package, RecursiveDirectoryIterator::KEY_AS_FILENAME);
                $pxml = false;
            }
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_Package_Phar_Exception('Could not open Phar archive ' .
                $package, $e);
        }

        $package = str_replace('\\', '/', $package);
        try {
            if ($pxml === false) {
                foreach (new RecursiveIteratorIterator($phar,
                            RecursiveIteratorIterator::LEAVES_ONLY) as $file) {
                    $filename = $file->getFileName();
                    // default to new package.xml, but search for old one
                    // also
                    if (preg_match('@^(.+)\-package.xml$@', $filename)) {
                        $pxml = $file->getPathName();
                        break;
                    } elseif ($filename == 'package2.xml') {
                        $this->_BCpackage = true;
                        $pxml = $file->getPathName();
                    } elseif ($pxml === false && $filename == 'package.xml') {
                        $this->_BCpackage = true;
                        $pxml = $file->getPathName();
                    }
                }
            }
            if ($pxml === false) {
                throw new PEAR2_Pyrus_Package_Phar_Exception('No package.xml in archive');
            }
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_Package_Phar_Exception('Could not extract Phar archive ' .
                $package, $e);
        }

        parent::__construct(new PEAR2_Pyrus_PackageFile($pxml,
                                                       'PEAR2_Pyrus_PackageFile_v2'),
                            $parent);
    }

    function getTarballPath()
    {
        return $this->_packagename;
    }

    function copyTo($where)
    {
        copy($this->_packagename, $where . DIRECTORY_SEPARATOR . basename($this->_packagename));
        $this->_packagename = $where . DIRECTORY_SEPARATOR . basename($this->_packagename);
    }

    function isNewPackage()
    {
        return !$this->_BCpackage;
    }

    function __get($var)
    {
        if ($var === 'archivefile') {
            return $this->_packagename;
        }

        return parent::__get($var);
    }

    function getFilePath($file)
    {
        if (!isset($this->packagefile->info->files[$file])) {
            throw new PEAR2_Pyrus_Package_Exception('file ' . $file . ' is not in package.xml');
        }
        
        $phar_file = 'phar://' . str_replace('\\', '/', $this->_packagename) . '/' . $file;
        if (!file_exists($phar_file)) {
            $phar_file = 'phar://' . str_replace('\\', '/', $this->_packagename) . '/' .
                    $this->packagefile->info->name . '-' .
                    $this->packagefile->info->version['release'] . '/' .
                    $file;
        
        }
        return $phar_file;
    }
}
<?php
/**
 * PEAR2_Pyrus_Package_ICreator
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Interface for a Package creator.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
interface PEAR2_Pyrus_Package_ICreator
{
    /**
     * save a file inside this package
     * @param string relative path within the package
     * @param string|resource file contents or open file handle
     */
    function addFile($path, $filename);
    /**
     * Add everything within a directory and all subdirectories
     * @param string path to the directory to add
     */
    function addDir($path);
    /**
     * Initialize the package creator
     */
    function init();
    /**
     * Create an internal directory, creating parent directories as needed
     * @param string $dir
     */
    function mkdir($dir);
    /**
     * Finish saving the package
     */
    function close();
}<?php
/**
 * PEAR2_Pyrus_Package_Dependency
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Class represents a package dependency.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Package_Dependency extends PEAR2_Pyrus_Package_Remote
{
    /**
     * A map of package name => packages that depend on this package =>
     * actual dependency
     */
    static protected $dependencyTree = array();
    
    /**
     * A map of package => packages it depends upon
     */
    static protected $packageDepTree = array();

    static function getPHPVersion()
    {
        return phpversion();
    }

    /**
     * Check to see if any packages in the list of packages to be installed
     * satisfy this dependency, and return one if found, otherwise
     * instantiate a new dependency package object
     * @return PEAR2_Pyrus_IPackage
     */
    static function retrieve($installerclass, array $toBeInstalled,
                             PEAR2_Pyrus_PackageFile_v2_Dependencies_Package $info,
                             PEAR2_Pyrus_Package $parentPackage)
    {
        $reg = PEAR2_Pyrus_Config::current()->registry;
        static::processDependencies($info, $parentPackage);
        // first check to see if the dependency is installed
        $canupgrade = false;
        if (isset($reg->package[$info->channel . '/' . $info->name])) {
            if (!isset(PEAR2_Pyrus_Installer::$options['upgrade'])) {
                // we don't attempt to upgrade a dep unless we're upgrading
                return;
            }
            $version = $reg->info($info->name, $info->channel, 'version');
            $stability = $reg->info($info->name, $info->channel, 'state');
            if ($parentPackage->isRemote() && $parentPackage->getExplicitState()) {
                $installedstability = PEAR2_Pyrus_Installer::betterStates($stability);
                $parentstability = PEAR2_Pyrus_Installer::betterStates($parentPackage->getExplicitState());
                if (count($parentstability) > count($installedstability)) {
                    $stability = $parentPackage->getExplicitState();
                }
            } else {
                $installedstability = PEAR2_Pyrus_Installer::betterStates($stability);
                $prefstability = PEAR2_Pyrus_Installer::betterStates(PEAR2_Pyrus_Config::current()->preferred_state);
                if (count($prefstability) > count($installedstability)) {
                    $stability = PEAR2_Pyrus_Config::current()->preferred_state;
                }
            }
            // see if there are new versions in our stability or better
            $remote = new PEAR2_Pyrus_Channel_Remotepackage(PEAR2_Pyrus_Config::current()
                                                            ->channelregistry[$info->channel], $stability);
            $found = false;
            foreach ($remote[$info->name] as $remoteversion => $rinfo) {
                if (version_compare($remoteversion, $version, '<=')) {
                    continue;
                }
                if (version_compare($rinfo['minimumphp'], static::getPHPversion(), '>')) {
                    continue;
                }
                // found one, so upgrade is possible if dependencies pass
                $found = true;
                break;
            }
            // the installed package version satisfies this dependency, don't do anything
            if (!$found) {
                return;
            }
            $canupgrade = true;
        }
        if (isset($toBeInstalled[$info->channel . '/' . $info->name])) {
            $ret = $toBeInstalled[$info->channel . '/' . $info->name];
            if ($parentPackage->isRemote() && $parentPackage->getExplicitState()
                && $ret->isRemote() && !$ret->getExplicitState()) {
                $ret->setExplicitState($parentPackage->getExplicitState());
            }
            if ($ret->isRemote() && $canupgrade) {
                $ret->setUpgradeable();
            }
            return $installerclass::prepare($ret);
        }
        if (isset($info->uri)) {
            $ret = new PEAR2_Pyrus_Package_Remote($info->uri);
            // set up the basics
            $ret->name = $info->name;
            $ret->uri = $info->uri;
            return $installerclass::prepare($ret);
        }
        if ($parentPackage->isRemote() && $parentPackage->getExplicitState()) {
            // pass the same explicit state to the child dependency
            $ret = new PEAR2_Pyrus_Package_Remote($info->channel . '/' . $info->name . '-' .
                                                  $parentPackage->getExplicitState());
            if ($canupgrade) {
                $ret->setUpgradeable();
            }
            return $installerclass::prepare($ret);
        }
        $ret = new PEAR2_Pyrus_Package_Remote($info->channel . '/' . $info->name);
        if ($canupgrade) {
            $ret->setUpgradeable();
        }
        return $installerclass::prepare($ret);
    }

    /**
     * Create a tree mapping packages to those that depend on them
     *
     * This is used to determine which versions of a package satisfy
     * all package dependencies.  A composite dependency is calculated
     * from all of them, and this also allows removing a package from the
     * calculation
     */
    static protected function processDependencies($info, $parentPackage)
    {
        static::$dependencyTree[$info->channel . '/' . $info->name]
                               [$parentPackage->channel . '/' . $parentPackage->name] = $info;
        static::$packageDepTree[$parentPackage->channel . '/' . $parentPackage->name]
            [$info->channel . '/' . $info->name] = 1;
    }

    /**
     * @return array A list of packages to be removed from the to-be-installed list
     */
    static function removePackage(PEAR2_Pyrus_Package $info)
    {
        if (!isset(static::$packageDepTree[$info->channel . '/' . $info->name])) {
            return array();
        }
        $ret = array();
        foreach (static::$packageDepTree[$info->channel . '/' . $info->name] as $package => $unused) {
            unset(static::$dependencyTree[$package][$info->channel . '/' . $info->name]);
            if (!count(static::$dependencyTree[$package])) {
                $ret[] = $package;
                unset(static::$dependencyTree[$package]);
            }
        }
        unset(static::$packageDepTree[$info->channel . '/' . $info->name]);
        return $ret;
    }

    /**
     * Return a composite dependency on the package, as defined by combining
     * all dependencies on this package into one.
     *
     * As an example, for these dependencies:
     *
     * <pre>
     * P1 version >= 1.2.0
     * P1 version <= 3.0.0, != 2.3.2
     * P1 version >= 1.1.0, != 1.2.0
     * </pre>
     *
     * The composite dependency is
     *
     * <pre>
     * P1 version >= 1.2.0, <= 3.0.0, != 2.3.2, 1.2.0
     * </pre>
     */
    static function getCompositeDependency(PEAR2_Pyrus_Package $info)
    {
        if (!isset(static::$dependencyTree[$info->channel . '/' . $info->name])) {
            return new PEAR2_Pyrus_PackageFile_v2_Dependencies_Package(
                'required', 'package', null, array('name' => $info->name, 'channel' => $info->channel, 'uri' => null,
                                            'min' => null, 'max' => null,
                                            'recommended' => null, 'exclude' => null,
                                            'providesextension' => null, 'conflicts' => null), 0);
        }
        $compdep = array('name' => $info->name, 'channel' => $info->channel, 'uri' => null,
                                            'min' => null, 'max' => null,
                                            'recommended' => null, 'exclude' => null,
                                            'providesextension' => null, 'conflicts' => null);
        $initial = true;
        $recommended = null;
        $min = null;
        $max = null;
        foreach (static::$dependencyTree[$info->channel . '/' . $info->name] as $deppackage => $actualdep) {
            if ($initial) {
                if ($actualdep->min) {
                    $compdep['min'] = $actualdep->min;
                    $min = $deppackage;
                }
                if ($actualdep->max) {
                    $compdep['max'] = $actualdep->max;
                    $max = $deppackage;
                }
                if ($actualdep->recommended) {
                    $compdep['recommended'] = $actualdep->recommended;
                    $recommended = $deppackage;
                }
                $compdep['exclude'] = $actualdep->exclude;
                $initial = false;
                continue;
            }
            if (isset($compdep['recommended']) && isset($actualdep->recommended)
                && $actualdep->recommended != $compdep['recommended']) {
                throw new PEAR2_Pyrus_Package_Exception('Cannot install ' . $info->channel . '/' .
                    $info->name . ', two dependencies conflict (different recommended values for ' .
                    $deppackage . ' and ' . $recommended . ')');
            }
            if ($compdep['max'] && $actualdep->min && version_compare($actualdep->min, $compdep['max'], '>')) {
                throw new PEAR2_Pyrus_Package_Exception('Cannot install ' . $info->channel . '/' .
                    $info->name . ', two dependencies conflict (' .
                    $deppackage . ' min is > ' . $max . ' max)');
            }
            if ($compdep['min'] && $actualdep->max && version_compare($actualdep->max, $compdep['min'], '<')) {
                throw new PEAR2_Pyrus_Package_Exception('Cannot install ' . $info->channel . '/' .
                    $info->name . ', two dependencies conflict (' .
                    $deppackage . ' max is < ' . $min . ' min)');
            }
            if ($actualdep->min) {
                if ($compdep['min']) {
                    if (version_compare($actualdep->min, $compdep['min'], '>')) {
                        $compdep['min'] = $actualdep->min;
                        $min = $deppackage;
                    }
                } else {
                    $compdep['min'] = $actualdep->min;
                    $min = $deppackage;
                }
            }
            if ($actualdep->max) {
                if ($compdep['max']) {
                    if (version_compare($actualdep->max, $compdep['max'], '<')) {
                        $compdep['max'] = $actualdep->max;
                        $max = $deppackage;
                    }
                } else {
                    $compdep['max'] = $actualdep->max;
                    $max = $deppackage;
                }
            }
            if ($actualdep->recommended) {
                $compdep['recommended'] = $actualdep->recommended;
                $recommended = $deppackage;
            }
            if ($actualdep->exclude) {
                if (!$compdep['exclude']) {
                    $compdep['exclude'] = array();
                    foreach ($actualdep->exclude as $exclude) {
                        $compdep['exclude'][] = $exclude;
                    }
                    continue;
                }
                foreach ($actualdep->exclude as $exclude) {
                    if (in_array($exclude, $compdep['exclude'])) {
                        continue;
                    }
                    $compdep['exclude'][] = $exclude;
                }
            }
        }
        return new PEAR2_Pyrus_PackageFile_v2_Dependencies_Package(
            'required', 'package', null, $compdep, 0);
    }
}<?php
/**
 * PEAR2_Pyrus_AtomicFileTransaction_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception for atomic file transaction mechanism
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_AtomicFileTransaction_Exception extends PEAR2_Exception {}<?php

/**
 * Extension to PEAR2_Console_CommandLine_Command
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * This class serves one purpose, removing the exit() call from displayUsage()
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

class PEAR2_Pyrus_ScriptFrontend_Command extends PEAR2_Console_CommandLine_Command
{

    /**
     * Display the usage help message to the user, but don't exit
     *
     * @param int $exitCode the exit code number
     *
     * @return void
     * @access public
     */
    public function displayUsage($exitCode = 1)
    {
        echo "\n", $this->renderer->usage();
    }
}<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * PEAR2_Console_CommandLine default renderer.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Pyrus_ScriptFrontend_Renderer extends PEAR2_Console_CommandLine_Renderer_Default
{
    /**
     * Return the command line usage message
     *
     * @return string the usage message
     * @access protected
     */
    protected function usageLine()
    {
        $usage = $this->parser->message_provider->get('USAGE_WORD') . ":\n";
        $ret   = $usage . '  ' . $this->name();
        if (count($this->parser->options) > 0) {
            $ret .= ' [/path/to/pear] [' 
                . strtolower($this->parser->message_provider->get('OPTION_WORD'))
                . ']';
        }
        if (count($this->parser->args) > 0) {
            foreach ($this->parser->args as $name=>$arg) {
                $ret .= ' <' . $arg->help_name . ($arg->multiple?'...':'') . '>';
            }
        }
        return $this->columnWrap($ret, 2);
    }

    /**
     * Return the command line usage message for subcommands
     *
     * @return string
     * @access protected
     */
    protected function commandUsageLine()
    {
        if (count($this->parser->commands) == 0) {
            return '';
        }
        $ret = '  ' . $this->name();
        if (count($this->parser->options) > 0) {
            $ret .= ' [/path/to/pear] [' 
                . strtolower($this->parser->message_provider->get('OPTION_WORD'))
                . ']';
        }
        //XXX
        $ret .= " <command> [options] [args]";
        return $this->columnWrap($ret, 2);
    }
}<?php
/**
 * This script handles the command line interface commands to Pyrus
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * This script handles the command line interface commands to Pyrus
 *
 * Each command is a separate method, and will be called with the arguments
 * entered by the end user.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_ScriptFrontend_Commands implements PEAR2_Pyrus_ILog
{
    public $commands = array();
    // for unit-testing ease
    public static $configclass = 'PEAR2_Pyrus_Config';
    public static $downloadClass = 'PEAR2_HTTP_Request';
    protected $term = array(
        'bold'   => '',
        'normal' => '',
    );
    protected static $commandParser;

    function __construct()
    {
        PEAR2_Pyrus_Log::attach($this);
        if (!isset(static::$commandParser)) {
            $schemapath = PEAR2_Pyrus::getDataPath() . '/customcommand-2.0.xsd';
            $defaultcommands = PEAR2_Pyrus::getDataPath() . '/built-in-commands.xml';
            if (!file_exists($schemapath)) {
                $schemapath = realpath(__DIR__ . '/../../../data/customcommand-2.0.xsd');
                $defaultcommands = realpath(__DIR__ . '/../../../data/built-in-commands.xml');
            }
            $parser = new PEAR2_Pyrus_XMLParser;
            $commands = $parser->parse($defaultcommands, $schemapath);
            $commands = $commands['commands']['command'];
            if ('2.0.0a1' == '@'.'PACKAGE_VERSION@') {
                $version = '2.0.0a1'; // running from svn
            } else {
                $version = '2.0.0a1';
            }
            static::$commandParser = new PEAR2_Pyrus_ScriptFrontend(array(
                    'version' => $version,
                    'description' => 'Pyrus, the installer for PEAR2',
                    'name' => 'php ' . basename($_SERVER['argv'][0])
                )
            );
            // set up our custom renderer for help options
            static::$commandParser->accept(new PEAR2_Pyrus_ScriptFrontend_Renderer(static::$commandParser));
            // set up command-less options and argument
            static::$commandParser->addOption('verbose', array(
                'short_name'  => '-v',
                'long_name'   => '--verbose',
                'action'      => 'Counter',
                'description' => 'increase verbosity'
            ));
            PEAR2_Pyrus_PluginRegistry::registerFrontend($this);
            PEAR2_Pyrus_PluginRegistry::addCommand($commands);
        }
        $term = getenv('TERM');
        if (function_exists('posix_isatty') && !posix_isatty(1)) {
            // output is being redirected to a file or through a pipe
        } elseif ($term) {
            if (preg_match('/^(xterm|vt220|linux)/', $term)) {
                $this->term['bold']   = sprintf("%c%c%c%c", 27, 91, 49, 109);
                $this->term['normal'] = sprintf("%c%c%c", 27, 91, 109);
            } elseif (preg_match('/^vt100/', $term)) {
                $this->term['bold']   = sprintf("%c%c%c%c%c%c", 27, 91, 49, 109, 0, 0);
                $this->term['normal'] = sprintf("%c%c%c%c%c", 27, 91, 109, 0, 0);
            }
        }
    }

    function mapCommand($commandinfo)
    {
        $command = static::$commandParser->addCommand($commandinfo['name'], array(
            'description' => $commandinfo['summary']
        ));
        if (isset($commandinfo['options']['option'])) {
            $options = $commandinfo['options']['option'];
            if (!isset($options[0])) {
                $options = array($options);
            }
            foreach ($options as $option) {
                switch (key($option['type'])) {
                    case 'bool' :
                        $action = 'StoreTrue';
                        break;
                    case 'string' :
                        $action = 'StoreString';
                        break;
                    case 'int' :
                        $action = 'StoreInt';
                        break;
                    case 'float' :
                        $action = 'StoreFloat';
                        break;
                    case 'counter' :
                        $action = 'Counter';
                        break;
                    case 'callback' :
                        $func = $option['type']['callback'];
                        $class = $commandinfo['class'];
                        $callback = function ($value, $option, $result, $parser) use ($func, $class) {
                            return $class::$func($value);
                        };
                        $action = 'Callback';
                        break;
                    case 'set' :
                        $action = 'StoreString';
                        $choice = $option['set']['value'];
                        settype($choice, 'array');
                        break;
                }
                $info = array(
                    'short_name' => '-' . $option['shortopt'],
                    'long_name' => '--' . $option['name'],
                    'description' => $option['doc'],
                    'action' => $action,
                );
                if ($action == 'Callback') {
                    $info['callback'] = $callback;
                }
                if (isset($option['default'])) {
                    $info['default'] = $option['default'];
                }
                if (isset($choice)) {
                    $info['choices'] = $choice;
                    $choice = null;
                }
                $command->addOption($option['name'], $info);
            }
        }
        if (isset($commandinfo['arguments']['argument'])) {
            $args = $commandinfo['arguments']['argument'];
            if (!isset($args[0])) {
                $args = array($args);
            }
            foreach ($args as $arg) {
                $command->addArgument($arg['name'], array(
                    'description' => $arg['doc'],
                    'multiple' => (bool) $arg['multiple'],
                    'optional' => (bool) $arg['optional'],
                ));
            }
        }
    }

    function _bold($text)
    {
        if (empty($this->term['bold'])) {
            return strtoupper($text);
        }

        return $this->term['bold'] . $text . $this->term['normal'];
    }

    /**
     * This method acts as a controller which dispatches the request to the
     * correct command/method.
     *
     * <code>
     * $cli = PEAR2_Pyrus_ScriptFrontend_Commands();
     * $cli->run($args = array (0 => 'install',
     *                          1 => 'PEAR2/Pyrus_Developer/package.xml'));
     * </code>
     *
     * The above code will dispatch to the install command
     *
     * @param array $args An array of command line arguments.
     *
     * @return void
     */
    function run($args)
    {
        try {
            $this->_findPEAR($args);
            // scan for custom commands/roles/tasks
            PEAR2_Pyrus_Config::current()->pluginregistry->scan();
            $result = static::$commandParser->parse(count($args) + 1, array_merge(array('cruft'), $args));
            if ($info = PEAR2_Pyrus_PluginRegistry::getCommandInfo($result->command_name)) {
                if ($this instanceof $info['class']) {
                    $this->{$info['function']}($result->command->args, $result->command->options);
                } else {
                    $class = new $info['class'];
                    $class->{$info['function']}($result->command->args, $result->command->options);
                }
            } else {
                $this->help(array('command' => isset($args[0]) ? $args[0] : null));
            }
        } catch (PEAR2_Console_CommandLine_Exception $e) {
            static::$commandParser->displayError($e->getMessage());
        } catch (Exception $e) {
            echo "Operation failed:\n$e";
            exit -1;
        }
    }

    function _ask($question, array $choices = null, $default = null)
    {
        if (is_array($choices)) {
            foreach ($choices as $i => $choice) {
                if (is_int($i) && ($default === null || ($default !== null && !is_string($default)))) {
                    $is_int = false;
                } else {
                    $is_int = true;
                }
                break;
            }
        }
previous:
        echo $question,"\n";
        if ($choices !== null) {
            echo "Please choose:\n";
            foreach ($choices as $i => $choice) {
                if ($is_int) {
                    echo '  ',$choice,"\n";
                } else {
                    echo '  [',$i,'] ',$choice,"\n";
                }
            }
        }
        if ($default !== null) {
            echo '[',$default,']';
        }
        echo ' : ';
        $answer = $this->_readStdin();

        if (!strlen($answer)) {
            if ($default !== null) {
                $answer = $default;
            } else {
                $answer = null;
            }
        } elseif ($choices !== null) {
            if (($is_int && in_array($answer, $choices)) || (!$is_int && array_key_exists($answer, $choices))) {
                return $answer;
            } else {
                echo "Please choose one choice\n";
                goto previous;
            }
        }
        return $answer;
    }

    function _readStdin($amount = 1024)
    {
        return trim(fgets(STDIN, $amount));
    }

    function _findPEAR(&$arr)
    {
        if (isset($arr[0]) && @file_exists($arr[0]) && @is_dir($arr[0])) {
            $maybe = array_shift($arr);
            $maybe = realpath($maybe);
            echo "Using PEAR installation found at $maybe\n";
            $configclass = static::$configclass;
            $config = $configclass::singleton($maybe);
            return;
        }
        $configclass = static::$configclass;
        if (!$configclass::userInitialized()) {
            echo "Pyrus: No user configuration file detected\n";
            if ('yes' === $this->_ask("It appears you have not used Pyrus before, welcome!  Initialize install?", array('yes', 'no'), 'yes')) {
                echo "Great.  We will store your configuration in:\n  ",$configclass::getDefaultUserConfigFile(),"\n";
previous:
                $path = $this->_ask("Where would you like to install packages by default?", null, getcwd());
                echo "You have chosen:\n", $path, "\n";
                if (!realpath($path)) {
                    echo " this path does not yet exist\n";
                    if ('yes' !== $this->_ask("Create it?", array('yes', 'no'), 'yes')) {
                        goto previous;
                    }
                } elseif (!is_dir($path)) {
                    echo $path," exists, and is not a directory\n";
                    goto previous;
                }
                $configclass = static::$configclass;
                $config = $configclass::singleton($path);
                $config->saveConfig();
                echo "Thank you, enjoy using Pyrus\n";
                echo "Documentation is at http://pear.php.net\n";
            } else {
                echo "OK, thank you, finishing execution now\n";
                exit;
            }
        }
        $configclass = static::$configclass;
        $mypath = $configclass::current()->my_pear_path;
        if ($mypath) {
            foreach (explode(PATH_SEPARATOR, $mypath) as $path) {
                echo "Using PEAR installation found at $path\n";
                $configclass = static::$configclass;
                $config = $configclass::singleton($path);
                return;
            }
        }
    }

    /**
     * Display the help dialog and list all commands supported.
     *
     * @param array $args Array of command line arguments
     */
    function help($args)
    {
        if (!isset($args['command']) || $args['command'] === 'help') {
            static::$commandParser->displayUsage();
        } else {
            $info = PEAR2_Pyrus_PluginRegistry::getCommandInfo($args['command']);
            if (!$info) {
                echo "Unknown command: $args[command]\n";
                static::$commandParser->displayUsage();
            } else {
                static::$commandParser->commands[$args['command']]->displayUsage();
                echo "\n", $info['doc'], "\n";
            }
        }
    }

    /**
     * install a local or remote package
     *
     * @param array $args
     */
    function install($args, $options)
    {
        if ($options['plugin']) {
            PEAR2_Pyrus_Installer::$options['install-plugin'] = true;
        }
        PEAR2_Pyrus_Installer::begin();
        try {
            $packages = array();
            foreach ($args['package'] as $arg) {
                PEAR2_Pyrus_Installer::prepare($packages[] = new PEAR2_Pyrus_Package($arg));
            }
            PEAR2_Pyrus_Installer::commit();
            foreach (PEAR2_Pyrus_Installer::getInstalledPackages() as $package) {
                echo 'Installed ' . $package->channel . '/' . $package->name . '-' .
                    $package->version['release'] . "\n";
                if ($package->type === 'extsrc' || $package->type === 'zendextsrc') {
                    echo " ==> To build this PECL package, use the build command\n";
                }
            }
        } catch (Exception $e) {
            echo $e;
            exit -1;
        }
    }

    /**
     * uninstall an installed package
     *
     * @param array $args
     */
    function uninstall($args, $options)
    {
        if ($options['plugin']) {
            PEAR2_Pyrus_Installer::$options['install-plugin'] = true;
        }
        PEAR2_Pyrus_Uninstaller::begin();
        try {
            $packages = $non = $failed = array();
            foreach ($args['package'] as $arg) {
                try {
                    if (!isset(PEAR2_Pyrus_Config::current()->registry->package[$arg])) {
                        $non[] = $arg;
                        continue;
                    }
                    $packages[] = PEAR2_Pyrus_Uninstaller::prepare($arg);
                } catch (Exception $e) {
                    $failed[] = $arg;
                }
            }
            PEAR2_Pyrus_Uninstaller::commit();
            foreach ($non as $package) {
                echo "Package $package not installed, cannot uninstall\n";
            }
            foreach ($packages as $package) {
                echo 'Uninstalled ', $package->channel, '/', $package->name, "\n";
            }
            foreach ($failed as $package) {
                echo "Package $package could not be uninstalled\n";
            }
        } catch (Exception $e) {
            echo $e;
            exit -1;
        }
    }

    /**
     * download a remote package
     *
     * @param array $args
     */
    function download($args)
    {
        PEAR2_Pyrus_Config::current()->download_dir = getcwd();
        $packages = array();
        foreach ($args['package'] as $arg) {
            try {
                $packages[] = array(new PEAR2_Pyrus_Package($arg), $arg);
            } catch (Exception $e) {
                echo "failed to init $arg for download (", $e->getMessage(), ")\n";
            }
        }
        foreach ($packages as $package) {
            $arg = $package[1];
            $package = $package[0];
            echo "Downloading ", $arg, '...';
            try {
                if ($package->isRemote()) {
                    $package->download();
                } else {
                    $package->copyTo(getcwd());
                }
                $path = $package->getInternalPackage()->getTarballPath();
                echo "done ($path)\n";
            } catch (Exception $e) {
                echo 'failed! (', $e->getMessage(), ")\n";
            }
        }
    }

    /**
     * Upgrade a package
     *
     * @param array $args
     */
    function upgrade($args, $options)
    {
        PEAR2_Pyrus_Installer::$options['upgrade'] = true;
        $this->install($args, $options);
    }

    /**
     * list all the installed packages
     *
     * @param array $args
     */
    function listPackages()
    {
        $reg = PEAR2_Pyrus_Config::current()->registry;
        $creg = PEAR2_Pyrus_Config::current()->channelregistry;
        $cascade = array(array($reg, $creg));
        $p = $reg;
        $c = $creg;
        while ($p = $p->getParent()) {
            $c = $c->getParent();
            $cascade[] = array($p, $c);
        }
        array_reverse($cascade);
        foreach ($cascade as $p) {
            $c = $p[1];
            $p = $p[0];
            echo "Listing installed packages [", $p->getPath(), "]:\n";
            $packages = array();
            foreach ($c as $channel) {
                PEAR2_Pyrus_Config::current()->default_channel = $channel->name;
                foreach ($p->package as $package) {
                    $packages[$channel->name][] = $package->name;
                }
            }
            asort($packages);
            foreach ($packages as $channel => $stuff) {
                echo "[channel $channel]:\n";
                foreach ($stuff as $package) {
                    echo " $package\n";
                }
            }
        }
    }

    /**
     * List all the known channels
     *
     * @param array $args
     */
    function listChannels()
    {
        $creg = PEAR2_Pyrus_Config::current()->channelregistry;
        $cascade = array($creg);
        while ($c = $creg->getParent()) {
            $cascade[] = $c;
            $creg = $c;
        }
        array_reverse($cascade);
        foreach ($cascade as $c) {
            echo "Listing channels [", $c->getPath(), "]:\n";
            foreach ($c as $channel) {
                echo $channel->name . ' (' . $channel->alias . ")\n";
            }
        }
    }

    /**
     * remotely connect to a channel server and grab the channel information,
     * then add it to the current pyrus managed repo
     *
     * @param array $args $args[0] should be the channel name, eg:pear.unl.edu
     */
    function channelDiscover($args)
    {
        // try secure first
        $chan = 'https://' . $args['channel'] . '/channel.xml';
        $dl = self::$downloadClass;
        $http = new $dl($chan);
        try {
            $response = $http->sendRequest();
            if ($response->code != 200) {
                throw new Exception('Download of channel.xml failed');
            }
addchan_success:    
            $chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile($response->body, true));
            PEAR2_Pyrus_Config::current()->channelregistry->add($chan);
            echo "Discovery of channel ", $chan->name, " successful\n";
        } catch (Exception $e) {
            try {
                $chan = 'http://' . $args['channel'] . '/channel.xml';
                $http = new $dl($chan);
                $response = $http->sendRequest();
                if ($response->code != 200) {
                    throw new Exception('Download of channel.xml failed');
                }
                goto addchan_success;
            } catch (Exception $e) {
                // failed, re-throw original error
                echo "Discovery of channel ", $args['channel'], " failed: ", $e->getMessage();
            }
        }
    }

    /**
     * add a channel to the current pyrus managed path using the raw channel.xml
     *
     * @param array $args $args[0] should be the channel.xml filename
     */
    function channelAdd($args)
    {
        echo "Adding channel from channel.xml:\n";
        $chan = new PEAR2_Pyrus_Channel(new PEAR2_Pyrus_ChannelFile($args['channelfile']));
        PEAR2_Pyrus_Config::current()->channelregistry->add($chan);
        echo "Adding channel ", $chan->name, " successful\n";
    }

    function channelDel($args)
    {
        $chan = PEAR2_Pyrus_Config::current()->channelregistry->get($args['channel'], false);
        if (count(PEAR2_Pyrus_Config::current()->registry->listPackages($chan->name))) {
            echo "Cannot remove channel ", $chan->name, " packages are installed\n";
            exit -1;
        }
        PEAR2_Pyrus_Config::current()->channelregistry->delete($chan);
        echo "Deleting channel ", $chan->name, " successful\n";
    }

    function upgradeRegistry($args, $options)
    {
        if (!file_exists($args['path']) || !is_dir($args['path'])) {
            echo "Cannot upgrade registries at ", $args['path'], ", path does not exist or is not a directory\n";
            exit -1;
        }
        echo "Upgrading registry at path ", $args['path'], "\n";
        $registries = PEAR2_Pyrus_Registry::detectRegistries($args['path']);
        if (!count($registries)) {
            echo "No registries found\n";
            exit;
        }
        if (!in_array('Pear1', $registries)) {
            echo "Registry already upgraded\n";
            exit;
        }
        $pear1 = new PEAR2_Pyrus_Registry_Pear1($args['path']);
        if (!in_array('Sqlite3', $registries)) {
            $sqlite3 = new PEAR2_Pyrus_Registry_Sqlite3($args['path']);
            $sqlite3->cloneRegistry($pear1);
        }
        if (!in_array('Xml', $registries)) {
            $xml = new PEAR2_Pyrus_Registry_Xml($args['path']);
            $sqlite3 = new PEAR2_Pyrus_Registry_Sqlite3($args['path']);
            $xml->cloneRegistry($sqlite3);
        }
        if ($options['removeold']) {
            PEAR2_Pyrus_Registry_Pear1::removeRegistry($args['path']);
        }
    }

    function runScripts($args)
    {
        $runner = new PEAR2_Pyrus_ScriptRunner($this);
        $reg = PEAR2_Pyrus_Config::current()->registry;
        foreach ($args['package'] as $package) {
            $package = $reg->package[$package];
            $runner->run($package);
        }
    }

    /**
     * Display pyrus configuration vars
     *
     */
    function configShow()
    {
        $conf = PEAR2_Pyrus_Config::current();
        echo "System paths:\n";
        foreach ($conf->mainsystemvars as $var) {
            echo "  $var => " . $conf->$var . "\n";
        }
        echo "Custom System paths:\n";
        foreach ($conf->customsystemvars as $var) {
            echo "  $var => " . $conf->$var . "\n";
        }
        echo "User config (from " . $conf->userfile . "):\n";
        foreach ($conf->mainuservars as $var) {
            echo "  $var => " . $conf->$var . "\n";
        }
        echo "Custom User config (from " . $conf->userfile . "):\n";
        foreach ($conf->customuservars as $var) {
            echo "  $var => " . $conf->$var . "\n";
        }
    }

    /**
     * Set a configuration option.
     *
     * @param array $args
     */
    function set($args)
    {
        $conf = PEAR2_Pyrus_Config::current();
        if (in_array($args['variable'], $conf->uservars)) {
            echo "Setting $args[0] in " . $conf->userfile . "\n";
            $conf->{$args['variable']} = $args[1];
        } elseif (in_array($args['variable'], $conf->systemvars)) {
            echo "Setting $args[variable] in system paths\n";
            $conf->{$args['variable']} = $args['value'];
        } else {
            echo "Unknown config variable: $args[variable]\n";
            exit -1;
        }
        $conf->saveConfig();
    }

    /**
     * Set up a pear path managed by pyrus.
     *
     * @param array $args Arguments
     */
    function mypear($args)
    {
        echo "Setting my pear repositories to:\n";
        echo implode("\n", $args['path']) . "\n";
        $args = implode(PATH_SEPARATOR, $args['path']);
        PEAR2_Pyrus_Config::current()->my_pear_path = $args;
        PEAR2_Pyrus_Config::current()->saveConfig();
    }

    function build($args)
    {
        echo "Building PECL extensions\n";
        $builder = new PEAR2_Pyrus_PECLBuild($this);
        foreach ($args['PackageName'] as $arg) {
            $package = PEAR2_Pyrus_Config::current()->registry->package[$arg];
            $builder->installBuiltStuff($package, $builder->build($package));
        }
    }

    /**
     * This is why we need to move to a better CLI system...
     *
     * make it possible to call confirmDialog() without it showing up as a command
     */
    function __call($func, $params)
    {
        if ($func === 'confirmDialog') {
            return $this->_confirmDialog($params[0]);
        }
        if ($func === 'display') {
            return $this->_display($params[0]);
        }
        if ($func === 'ask') {
            return call_user_func_array(array($this, '_ask'), $params);
        }
        throw new \Exception('Unknown method ' . $func . ' in class PEAR2_Pyrus_ScriptFrontend\Commands');
    }

    /**
     * Ask for user input, confirm the answers and continue until the user is satisfied
     * @param array an array of arrays, format array('name' => 'paramname', 'prompt' =>
     *              'text to display', 'type' => 'string'[, default => 'default value'])
     * @return array
     */
    function _confirmDialog($params)
    {
        $answers = $prompts = $types = array();
        foreach ($params as $param) {
            $prompts[$param['name']] = $param['prompt'];
            $types[$param['name']]   = $param['type'];
            $answers[$param['name']] = isset($param['default']) ? $param['default'] : '';
        }

        $tried = false;
        do {
            if ($tried) {
                $i = 1;
                foreach ($answers as $var => $value) {
                    if (!strlen($value)) {
                        echo $this->_bold("* Enter an answer for #" . $i . ": ({$prompts[$var]})\n");
                    }
                    $i++;
                }
            }

            $answers = $this->_userDialog('', $prompts, $types, $answers);
            $tried   = true;
        } while (is_array($answers) && count(array_filter($answers)) != count($prompts));

        return $answers;
    }

    function _display($text)
    {
        echo $text, "\n";
    }

    function _userDialog($command, $prompts, $types = array(), $defaults = array(), $screensize = 20)
    {
        if (!is_array($prompts)) {
            return array();
        }

        $testprompts = array_keys($prompts);
        $result      = $defaults;

        reset($prompts);
        if (count($prompts) === 1) {
            foreach ($prompts as $key => $prompt) {
                $type    = $types[$key];
                $default = isset($defaults[$key]) ? $defaults[$key] : false;
                print "$prompt ";
                if ($default) {
                    print "[$default] ";
                }
                print ": ";

                $line         = $this->_readStdin(2048);
                $result[$key] =  ($default && trim($line) == '') ? $default : trim($line);
            }

            return $result;
        }

        $first_run = true;
        while (true) {
            $descLength = max(array_map('strlen', $prompts));
            $descFormat = "%-{$descLength}s";
            $last       = count($prompts);

            $i = 0;
            foreach ($prompts as $n => $var) {
                $res = isset($result[$n]) ? $result[$n] : null;
                printf("%2d. $descFormat : %s\n", ++$i, $prompts[$n], $res);
            }
            print "\n1-$last, 'all', 'abort', or Enter to continue: ";

            $tmp = $this->_readStdin();
            if (empty($tmp)) {
                break;
            }

            if ($tmp == 'abort') {
                return false;
            }

            if (isset($testprompts[(int)$tmp - 1])) {
                $var     = $testprompts[(int)$tmp - 1];
                $desc    = $prompts[$var];
                $current = @$result[$var];
                print "$desc [$current] : ";
                $tmp = $this->_readStdin();
                if ($tmp !== '') {
                    $result[$var] = $tmp;
                }
            } elseif ($tmp == 'all') {
                foreach ($prompts as $var => $desc) {
                    $current = $result[$var];
                    print "$desc [$current] : ";
                    $tmp = $this->_readStdin();
                    if (trim($tmp) !== '') {
                        $result[$var] = trim($tmp);
                    }
                }
            }

            $first_run = false;
        }

        return $result;
    }

    function log($level, $message)
    {
        static $data = array();
        if (PEAR2_Pyrus_Config::initializing()) {
            // we can't check verbose until initializing is complete, so save
            // the message, and only display the log after config is initialized
            $data[] = array($level, $message);
            return;
        }
        if (count($data)) {
            $save = $data;
            $data = array();
            foreach ($save as $info) {
                $this->log($info[0], $info[1]);
            }
        }
        if ($level <= PEAR2_Pyrus_Config::current()->verbose) {
            echo $message, "\n";
        }
    }
}
<?php
/**
 * PEAR_REST
 *
 * PHP versions 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Intelligently retrieve data, following hyperlinks if necessary, and re-directing
 * as well
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_REST
{
    protected $config;
    protected $_options;
    /**
     * For easy unit testing
     */
    static public $downloadClass = 'PEAR2_HTTP_Request';

    function __construct()
    {
        $this->config = PEAR2_Pyrus_Config::current();
        $this->_options = PEAR2_Pyrus_Installer::$options;
    }

    /**
     * Retrieve REST data, but always retrieve the local cache if it is available.
     *
     * This is useful for elements that should never change, such as information on a particular
     * release
     * @param string full URL to this resource
     * @param array|false contents of the accept-encoding header
     * @param boolean     if true, xml will be returned as a string, otherwise, xml will be
     *                    parsed using PEAR_XMLParser
     * @return string|array
     */
    function retrieveCacheFirst($url, $accept = false, $forcestring = false)
    {
        $cachefile = $this->config->cache_dir . DIRECTORY_SEPARATOR .
            md5($url) . 'rest.cachefile';
        if (file_exists($cachefile)) {
            return unserialize(implode('', file($cachefile)));
        }
        return $this->retrieveData($url, $accept, $forcestring);
    }

    /**
     * Retrieve a remote REST resource
     * @param string full URL to this resource
     * @param array|false contents of the accept-encoding header
     * @param boolean     if true, xml will be returned as a string, otherwise, xml will be
     *                    parsed using PEAR_XMLParser
     * @return string|array
     */
    function retrieveData($url, $accept = false, $forcestring = false)
    {
        $cacheId = $this->getCacheId($url);
        if ($ret = $this->useLocalCache($url, $cacheId)) {
            return $ret;
        }

        if (!isset($this->_options['offline'])) {
            $trieddownload = true;
            try {
                $file = $this->downloadHttp($url, $cacheId ? $cacheId['lastChange'] : false, $accept);
            } catch (PEAR2_HTTP_Request_Exception $e) {
                $trieddownload = false;
                $file = false;
            }
        } else {
            $trieddownload = false;
            $file = false;
        }
        if (!$file) {
            $ret = $this->getCache($url);
            if ($trieddownload) {
                // reset the age of the cache if the server says it was unmodified
                $this->saveCache($url, $ret, null, true, $cacheId);
            }
            return $ret;
        }
        if (is_array($file)) {
            $headers = $file[2];
            $lastmodified = $file[1];
            $content = $file[0];
        } else {
            $content = $file;
            $lastmodified = false;
            $headers = array();
        }
        if ($forcestring) {
            $this->saveCache($url, $content, $lastmodified, false, $cacheId);
            return $content;
        }
        if (isset($headers['content-type'])) {
            switch ($headers['content-type']) {
                case 'text/xml' :
                case 'application/xml' :
                    $parser = new PEAR2_Pyrus_XMLParser;
                    try {
                        $content = $parser->parseString($content);
                        $content = current($content);
                    } catch (Exception $e) {
                        throw new PEAR2_Pyrus_REST_Exception(
                            'Invalid xml downloaded from "' . $url . '"', $e);
                    }
                case 'text/html' :
                default :
                    // use it as a string
            }
        } else {
            // assume XML
            $parser = new PEAR2_Pyrus_XMLParser;
            try {
                $content = $parser->parseString($content);
                $content = current($content);
            } catch (Exception $e) {
                throw new PEAR2_Pyrus_REST_Exception(
                    'Invalid xml downloaded from "' . $url . '"', $e);
            }
        }
        $this->saveCache($url, $content, $lastmodified, false, $cacheId);
        return $content;
    }

    function useLocalCache($url, $cacheid = null)
    {
        if ($cacheid === null) {
            $cacheidfile = $this->config->cache_dir . DIRECTORY_SEPARATOR .
                md5($url) . 'rest.cacheid';
            if (!file_exists($cacheidfile)) {
                return false;
            }

            $cacheid = unserialize(implode('', file($cacheidfile)));
        }
        $cachettl = $this->config->cache_ttl;
        // If cache is newer than $cachettl seconds, we use the cache!
        if (time() - $cacheid['age'] < $cachettl) {
            return $this->getCache($url);
        }
        return false;
    }

    function getCacheId($url)
    {
        $cacheidfile = $this->config->cache_dir . DIRECTORY_SEPARATOR .
            md5($url) . 'rest.cacheid';
        if (file_exists($cacheidfile)) {
            $ret = unserialize(implode('', file($cacheidfile)));
            return $ret;
        }

        return false;
    }

    function getCache($url)
    {
        $cachefile = $this->config->cache_dir . DIRECTORY_SEPARATOR .
            md5($url) . 'rest.cachefile';
        if (file_exists($cachefile)) {
            return unserialize(implode('', file($cachefile)));
        }

        throw new PEAR2_Pyrus_REST_Exception(
                'No cached content available for "' . $url . '"');
    }

    /**
     * @param string full URL to REST resource
     * @param string original contents of the REST resource
     * @param array  HTTP Last-Modified and ETag headers
     * @param bool   if true, then the cache id file should be regenerated to
     *               trigger a new time-to-live value
     */
    function saveCache($url, $contents, $lastmodified, $nochange = false, $cacheid = null)
    {
        $cacheidfile = $this->config->cache_dir . DIRECTORY_SEPARATOR .
            md5($url) . 'rest.cacheid';
        $cachefile = $this->config->cache_dir . DIRECTORY_SEPARATOR .
            md5($url) . 'rest.cachefile';
        if ($cacheid === null && $nochange) {
            $cacheid = unserialize(implode('', file($cacheidfile)));
        }

        $fp = @fopen($cacheidfile, 'wb');
        if (!$fp) {
            $cache_dir = $this->config->cache_dir;
            if (is_dir($cache_dir)) {
                return false;
            }

            if (!@mkdir($cache_dir, 0755, true)) {
                throw new PEAR2_Pyrus_REST_Exception(
                    'Cannot create REST cache directory ' . $cache_dir);
            }

            $fp = @fopen($cacheidfile, 'wb');
            if (!$fp) {
                return false;
            }
        }

        if ($nochange) {
            fwrite($fp, serialize(array(
                'age'        => time(),
                'lastChange' => $cacheid['lastChange'],
                )));
            fclose($fp);
            return true;
        } else {
            fwrite($fp, serialize(array(
                'age'        => time(),
                'lastChange' => $lastmodified,
                )));
        }
        fclose($fp);

        $fp = @fopen($cachefile, 'wb');
        if (!$fp) {
            if (file_exists($cacheidfile)) {
                @unlink($cacheidfile);
            }
            return false;
        }
        fwrite($fp, serialize($contents));
        fclose($fp);
        return true;
    }

    /**
     * Efficiently Download a file through HTTP.  Returns downloaded file as a string in-memory
     * This is best used for small files
     *
     * If an HTTP proxy has been configured (http_proxy PEAR_Config
     * setting), the proxy will be used.
     *
     * @param string  $url       the URL to download
     * @param string  $save_dir  directory to save file in
     * @param false|string|array $lastmodified header values to check against for caching
     *                           use false to return the header values from this download
     * @param false|array $accept Accept headers to send
     * @return string|array  Returns the contents of the downloaded file or a PEAR
     *                       error on failure.  If the error is caused by
     *                       socket-related errors, the error object will
     *                       have the fsockopen error code available through
     *                       getCode().  If caching is requested, then return the header
     *                       values.
     *
     * @access public
     */
    function downloadHttp($url, $lastmodified = null, $accept = false)
    {
        $info = parse_url($url);
        if (!isset($info['scheme']) || !in_array($info['scheme'], array('http', 'https'))) {
            throw new PEAR2_Pyrus_REST_Exception('Cannot download non-http URL "' . $url . '"');
        }
        if (!isset($info['host'])) {
            throw new PEAR2_Pyrus_REST_Exception('Cannot download from non-URL "' . $url . '"');
        }
        $class = static::$downloadClass;
        $request = new $class($url);
        $host = $info['host'];
        if (!array_key_exists('port', $info)) {
            $info['port'] = null;
        }
        if (!array_key_exists('path', $info)) {
            $info['path'] = null;
        }
        $port = $info['port'];
        $path = $info['path'];
        $proxy_host = $proxy_port = $proxy_user = $proxy_pass = '';
        if ($this->config->http_proxy &&
              $proxy = parse_url($this->config->http_proxy)) {
            $proxy_host = isset($proxy['host']) ? $proxy['host'] : null;
            if (isset($proxy['scheme']) && $proxy['scheme'] == 'https') {
                $proxy_host = 'ssl://' . $proxy_host;
            }
            $proxy_port = isset($proxy['port']) ? $proxy['port'] : 8080;
            $proxy_user = isset($proxy['user']) ? urldecode($proxy['user']) : null;
            $proxy_pass = isset($proxy['pass']) ? urldecode($proxy['pass']) : null;
            // TODO: implement this when HTTP_Request supports it
        }
        if (empty($port)) {
            if (isset($info['scheme']) && $info['scheme'] == 'https') {
                $port = 443;
            } else {
                $port = 80;
            }
        }

        if (is_array($lastmodified)) {
            if (isset($lastmodified['Last-Modified'])) {
                $request->setHeader('If-Modified-Since', $lastmodified['Last-Modified']);
            }
            if (isset($lastmodified['ETag'])) {
                $request->setHeader('If-None-Match', $lastmodified['ETag']);
            }
        } elseif ($lastmodified) {
            $request->setHeader('If-Modified-Since', $lastmodified);
        }
        $request->setHeader('User-Agent', 'PEAR2_Pyrus/2.0.0a1/PHP/' . PHP_VERSION);
        $username = $this->config->username;
        $password = $this->config->password;
        if ($username && $password) {
            $tmp = base64_encode("$username:$password");
            $request->setHeader('Authorization', 'Basic ' . $tmp);
        }
        if ($proxy_host != '' && $proxy_user != '') {
            $request->setHeader('Proxy-Authorization', 'Basic ' .
                base64_encode($proxy_user . ':' . $proxy_pass));
        }
        if ($accept) {
            $request->setHeader('Accept', implode(', ', $accept));
        } else {
            $request->setHeader('Accept', '');
        }
        $request->setHeader('Connection', 'close');
        $response = $request->sendRequest();
        if ($response->code == 304 && ($lastmodified || ($lastmodified === false))) {
            return false;
        }
        if ($response->code != 200) {
            throw new PEAR2_Pyrus_REST_HTTPException(
                "File http://$host:$port$path not valid (received: {$response->body})", $response->code);
        }
        if (isset($response->headers['content-length'])) {
            $length = $response->headers['content-length'];
        } else {
            $length = -1;
        }
        $data = $response->body;
        if ($lastmodified === false || $lastmodified) {
            if (isset($response->headers['etag'])) {
                $lastmodified = array('ETag' => $response->headers['etag']);
            }
            if (isset($response->headers['last-modified'])) {
                if (is_array($lastmodified)) {
                    $lastmodified['Last-Modified'] = $response->headers['last-modified'];
                } else {
                    $lastmodified = $response->headers['last-modified'];
                }
            }
            return array($data, $lastmodified, $response->headers);
        }
        return $data;
    }
}<?php
/**
 * PEAR2_Pyrus_ChannelFile_v1
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Base class for a PEAR channel.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_ChannelFile_v1 extends PEAR2_Pyrus_ChannelFile implements PEAR2_Pyrus_IChannelFile
{
    /**
     * Supported channel.xml versions, for parsing
     * @var array
     */
    protected $supportedVersions = array('1.0');

    /**
     * Parsed channel information
     * @var array
     */
    protected $channelInfo = array(
        'attribs' => array(
            'version' => '1.0',
            'xmlns' => 'http://pear.php.net/channel-1.0',
        ),
    );

    public $rootAttributes = array(
            'version' => '1.0',
            'xmlns' => 'http://pear.php.net/channel-1.0',
            'xmlns:xsi' => 'http://www.w3.org/2001/XMLSchema-instance',
            'xsi:schemaLocation' => 'http://pear.php.net/channel-1.0 
http://pear.php.net/dtd/channel-1.0.xsd'
        );

    private $_xml;
    
    /**
     * Mapping of __get variables to method handlers
     * @var array
     */
    protected $getMap = array(
        'ssl' => 'getSSL',
        'port' => 'getPort',
        'suggestedalias' => 'getSuggestedAlias',
        'alias' => 'getAlias',
        'name' => 'getName',
        'mirror' => 'getServers',
        'mirrors' => 'getServers',
        'protocols' => 'getProtocols'
    );
    
    protected $setMap = array(
        'name' => 'setName',
        'ssl' => 'setSSL',
        'summary' => 'setSummary',
        'alias' => 'setAlias',
        'localalias' => 'setLocalAlias',
        'port' => 'setPort',
        'rawrest' => 'setREST',
        'rawmirrors' => 'setMirrors',
    );

    function __construct(array $data = null)
    {
        if (null !== $data) {
            $this->fromArray($data);
        }
    }
    
    
    /**
     * Directly set the channel info.
     *
     * @param array $data The xml parsed data
     */
    function fromArray($data)
    {
        if (isset($data['channel'])) {
            $this->channelInfo = $data['channel'];
        } else {
            $this->channelInfo = $data;
        }
        // Reset root attributes.
        $this->channelInfo['attribs'] = $this->rootAttributes;
    }

    /**
     * Validate the xml against the channel schema.
     *
     */
    function validate()
    {
        if (!isset($this->_xml)) {
            $this->__toString();
        }
        $a = new PEAR2_Pyrus_XMLParser;
        $schema = PEAR2_Pyrus::getDataPath() . '/channel-1.0.xsd';
        // for running out of svn
        if (!file_exists($schema)) {
            $schema = dirname(dirname(dirname(dirname(__FILE__)))) . '/data/channel-1.0.xsd';
        }
        try {
            $a->parseString($this->_xml, $schema);
            return true;
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_Channel_Exception('Invalid channel.xml', $e);
        }
    }

    /**
     * Returns the raw xml for the channel file.
     *
     * @return string
     */
    function __toString()
    {
        return $this->_xml = (string) new PEAR2_Pyrus_XMLWriter(array('channel'=>$this->channelInfo));
    }

    /**
     * @return string|false
     */
    protected function getName()
    {
        if (isset($this->channelInfo['name'])) {
            return $this->channelInfo['name'];
        }

        return false;
    }

    /**
     * @return int|80 port number to connect to
     */
    protected function getPort()
    {
        if (isset($this->channelInfo['servers']['primary']['attribs']['port'])) {
            return (int)$this->channelInfo['servers']['primary']['attribs']['port'];
        }

        if ($this->getSSL()) {
            return 443;
        }

        return 80;
    }

    /**
     * @return bool Determines whether secure sockets layer (SSL) is used to connect to this channel
     */
    protected function getSSL()
    {
        if (isset($this->channelInfo['servers']['primary']['attribs']['ssl'])) {
            return true;
        }

        return false;
    }

    function __get($var)
    {
        if (isset($this->getMap[$var])) {
            return $this->{$this->getMap[$var]}($var);
        }
        if ($var == 'remotepackages') {
            return new PEAR2_Pyrus_Channel_Remotepackages($this);
        } elseif ($var == 'remotepackage') {
            return new PEAR2_Pyrus_Channel_Remotepackage($this, false);
        }
        if (!isset($this->channelInfo[$var])) {
            return null;
        }
        return $this->channelInfo[$var];
    }

    /**
     * Returns the protocols supported by the primary server for this channel
     *
     * @return PEAR2_Pyrus_ChannelFile_v1_Servers_Protocols
     */
    protected function getProtocols()
    {
        if (isset($this->channelInfo['name']) && $this->channelInfo['name'] == '__uri') {
            throw new PEAR2_Pyrus_Channel_Exception('__uri pseudo-channel has no protocols');
        }
        if (!isset($this->channelInfo['servers']) || !isset($this->channelInfo['servers']['primary'])) {
            return new PEAR2_Pyrus_ChannelFile_v1_Servers_Protocols(array(), $this);
        }
        return new PEAR2_Pyrus_ChannelFile_v1_Servers_Protocols($this->channelInfo['servers']['primary'], $this);
    }
    
    protected function getServers()
    {
        if ($this->channelInfo['name'] == '__uri') {
            throw new PEAR2_Pyrus_Channel_Exception('__uri pseudo-channel cannot have mirrors');
        }
        if (isset($this->channelInfo['servers'])) {
            $servers = $this->channelInfo['servers'];
        } else {
            $servers = array();
        }
        return new PEAR2_Pyrus_ChannelFile_v1_Servers($servers, $this);
    }
    
    /**
     * Determines whether a channel supports Representational State Transfer (REST) protocols
     * for retrieving channel information
     *
     * @return bool
     */
    function supportsREST()
    {
        return isset($this->channelInfo['servers']['primary']['rest']);
    }

    function __set($var, $value)
    {
        if (isset($this->setMap[$var])) {
            return $this->{$this->setMap[$var]}($value);
        }
        if (method_exists($this, "set$var")) {
            $sv = "set$var";
            $this->$sv($value);
        }
    }

    /**
     * Empty all REST definitions
     */
    function resetREST()
    {
        if (isset($this->channelInfo['servers']['primary']['rest'])) {
            unset($this->channelInfo['servers']['primary']['rest']);
        }
    }

    /**
     * @param string
     * @return string|false
     * @error PEAR_CHANNELFILE_ERROR_NO_NAME
     * @error PEAR_CHANNELFILE_ERROR_INVALID_NAME
     */
    protected function setName($name)
    {
        if (empty($name)) {
            throw new PEAR2_Pyrus_Channel_Exception('Primary server must be non-empty');
        }
        if (!$this->validChannelServer($name)) {
            throw new PEAR2_Pyrus_Channel_Exception('Primary server "' . $name .
                '" is not a valid channel server');
        }
        $this->channelInfo['name'] = $name;
    }

    /**
     * Test whether a string contains a valid channel server.
     * @param string $ver the package version to test
     * @return bool
     */
    static function validChannelServer($server)
    {
        if ($server == '__uri') {
            return true;
        }

        $regex = '/^[a-z0-9\-]+(?:\.[a-z0-9\-]+)*(\/[a-z0-9\-]+)*\\z/i';
        return (bool) preg_match($regex, $server);
    }

    /**
     * Set the socket number (port) that is used to connect to this channel
     * @param integer
     */
    protected function setPort($port)
    {
        if (isset($this->channelInfo['servers']) &&
              isset($this->channelInfo['servers']['primary']) &&
              !isset($this->channelInfo['servers']['primary']['attribs'])) {
            $this->channelInfo['servers']['primary'] =
                array_merge(array('attribs' => array('port' => $port)),
                            $this->channelInfo['servers']['primary']);
        } else {
            $this->channelInfo['servers']['primary']['attribs']['port'] = $port;
        }
    }

    /**
     * Set the socket number (port) that is used to connect to this channel
     * @param bool Determines whether to turn on SSL support or turn it off
     */
    protected function setSSL($ssl = true)
    {
        if ($ssl) {
        if (isset($this->channelInfo['servers']) &&
              isset($this->channelInfo['servers']['primary']) &&
              !isset($this->channelInfo['servers']['primary']['attribs'])) {
                $this->channelInfo['servers']['primary'] =
                    array_merge(array('attribs' => array('ssl' => 'yes')),
                                $this->channelInfo['servers']['primary']);
            } else {
                $this->channelInfo['servers']['primary']['attribs']['ssl'] = 'yes';
            }
        } elseif (isset($this->channelInfo['servers']['primary']['attribs']['ssl'])) {
            unset($this->channelInfo['servers']['primary']['attribs']['ssl']);
        }
    }

    /**
     * @param string
     * @return boolean success
     * @error PEAR_CHANNELFILE_ERROR_NO_SUMMARY
     * @warning PEAR_CHANNELFILE_ERROR_MULTILINE_SUMMARY
     */
    protected function setSummary($summary)
    {
        if (empty($summary)) {
            throw new PEAR2_Pyrus_Channel_Exception('Channel summary cannot be empty');
        } elseif (strpos(trim($summary), "\n") !== false) {
            // not sure what to do about this yet
            $this->_validateWarning(PEAR_CHANNELFILE_ERROR_MULTILINE_SUMMARY,
                array('summary' => $summary));
        }
        $this->channelInfo['summary'] = $summary;
        return true;
    }

    protected function setLocalAlias($alias)
    {
        return $this->setAlias($alias, true);
    }

    /**
     * @param string
     * @param boolean determines whether the alias is in channel.xml or local
     * @return boolean success
     */
    protected function setAlias($alias, $local = false)
    {
        if (!$this->validChannelServer($alias)) {
            throw new PEAR2_Pyrus_Channel_Exception('Alias "' . $alias . '" is not a valid channel alias');
        }

        $a = $local ? 'localalias' : 'suggestedalias';
        $this->channelInfo[$a] = $alias;
        return true;
    }

    protected function getSuggestedAlias()
    {
        if (isset($this->channelInfo['suggestedalias'])) {
            return $this->channelInfo['suggestedalias'];
        }

        return '';
    }

    /**
     * @return string
     */
    protected function getAlias()
    {
        if (isset($this->channelInfo['localalias'])) {
            return $this->channelInfo['localalias'];
        }

        if (isset($this->channelInfo['suggestedalias'])) {
            return $this->channelInfo['suggestedalias'];
        }

        if (isset($this->channelInfo['name'])) {
            return $this->channelInfo['name'];
        }

        return '';
    }

    /**
     * Set the package validation object if it differs from PEAR's default
     * The class must be includeable via changing _ in the classname to path separator,
     * but no checking of this is made.
     * @param string|false pass in false to reset to the default packagename regex
     * @return boolean success
     */
    function setValidationPackage($validateclass, $version)
    {
        if (empty($validateclass)) {
            unset($this->channelInfo['validatepackage']);
        }
        $this->channelInfo['validatepackage'] = array('_content' => $validateclass);
        $this->channelInfo['validatepackage']['attribs'] = array('version' => $version);
    }

    protected function setREST($rest)
    {
        if ($rest === null) {
            $this->resetREST();
            return;
        }
        $this->channelInfo['servers']['primary']['rest'] = $rest;
    }

    protected function setMirrors($mirrors)
    {
        if ($mirrors === null) {
            if (isset($this->channelInfo['servers']['mirror'])) {
                unset($this->channelInfo['servers']['mirror']);
            }
            return;
        }
        $this->channelInfo['servers']['mirror'] = $mirrors;
    }

    /**
     * Retrieve the name of the validation package for this channel
     * @return string|false
     */
    function getValidationPackage()
    {
        if (!isset($this->channelInfo['validatepackage'])) {
            return array('attribs' => array('version' => 'default'),
                '_content' => 'PEAR2_Pyrus_Validate');
        }

        $info = $this->channelInfo['validatepackage'];
        if (!is_array($info)) {
            $info = array('attribs' => array('version' => 'default'), '_content' => $info);
        }
        return $info;
    }

    function getArray()
    {
        return $this->channelInfo;
    }

    /**
     * Retrieve the object that can be used for custom validation
     * @param string|false the name of the package to validate.  If the package is
     *                     the channel validation package, PEAR_Validate is returned
     * @return PEAR2_Pyrus_Validate|false false is returned if the validation package
     *         cannot be located
     */
    function getValidationObject($package = false)
    {
        if (isset($this->channelInfo['validatepackage'])) {
            if ($package == $this->channelInfo['validatepackage']['_content']) {
                // channel validation packages are always validated by PEAR2_Pyrus_Validate
                $val = new PEAR2_Pyrus_Validate;
                return $val;
            }

            $vclass = str_replace('.', '_', $this->channelInfo['validatepackage']['_content']);
            $vclass = str_replace('PEAR_', 'PEAR2_Pyrus_', $vclass);
            if (!class_exists(str_replace('.', '_',
                  $vclass), true)) {
                throw new PEAR2_Pyrus_ChannelFile_Exception(
                    'Validation object ' . $this->channelInfo['validatepackage']['_content'] .
                    ' cannot be instantiated');
            }

            $val = new $vclass;
        } else {
            $val = new PEAR2_Pyrus_Validate;
        }
        return $val;
    }

    /**
     * This function is used by the channel updater and retrieves a value set by
     * the registry, or the current time if it has not been set
     * @return string
     */
    function lastModified()
    {
        if (isset($this->channelInfo['_lastmodified'])) {
            return $this->channelInfo['_lastmodified'];
        }

        return time();
    }

    function toChannelFile()
    {
        return $this;
    }
}
<?php
class PEAR2_Pyrus_ChannelFile_Exception extends Exception {}<?php

class PEAR2_Pyrus_ChannelFile_Parser_v1 extends PEAR2_Pyrus_XMLParser
{
    
    /**
     * @param string
     * @param string file name of the channel.xml
     *
     * @return PEAR2_Pyrus_ChannelFile_v1
     */
    function parse($data, $file = false, $class = 'PEAR2_Pyrus_ChannelFile_v1')
    {
        $ret = new $class();
        if (!$ret instanceof PEAR2_Pyrus_ChannelFile_v1) {
            throw new PEAR2_Pyrus_ChannelFile_Exception('Class ' . $class .
                ' passed to parse() must be a child class of PEAR2_Pyrus_ChannelFile_v1');
        }
        $schema = PEAR2_Pyrus::getDataPath() . '/channel-1.0.xsd';
        // for running out of svn
        if (!file_exists($schema)) {
            $schema = dirname(dirname(dirname(dirname(dirname(__FILE__))))) . '/data/channel-1.0.xsd';
        }
        try {
            $ret->fromArray(parent::parseString($data, $schema));
        } catch (Exception $e) {
            throw new PEAR2_Pyrus_ChannelFile_Exception('Invalid channel.xml', null, $e);
        }
        return $ret;
    }
}<?php
/**
 * PEAR2_Pyrus_ChannelFile_v1_Mirror
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Class for a PEAR2 channel mirror
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_ChannelFile_v1_Mirror extends PEAR2_Pyrus_ChannelFile_v1 implements PEAR2_Pyrus_Channel_IMirror
{
    
    /**
     * Mapping of __get variables to method handlers
     * @var array
     */
    protected $getMap = array(
        'ssl' => 'getSSL',
        'port' => 'getPort',
        'server' => 'getChannel',
        'alias' => 'getAlias',
        'name' => 'getName',
        'channel' => 'getChannel',
        'mirror' => 'getServers',
        'mirrors' => 'getServers',
        'protocols' => 'getProtocols'
    );

    private $_info;
    
    /**
     * Parent channel object
     *
     * @var PEAR2_Pyrus_Channel
     */
    protected $parentChannel;
    protected $parent;
    protected $index;

    function __construct($mirrorarray, $parent, $parentchannel, $index)
    {
        $this->_info = $mirrorarray;
        $this->parent = $parent;
        $this->parentChannel = $parentchannel;
        $this->index = $index;
    }

    function getChannel()
    {
        return $this->parentChannel->name;
    }

    /**
     * @return string|false
     */
    function getName()
    {
        if (isset($this->_info['attribs']['host'])) {
            return $this->_info['attribs']['host'];
        }

        return false;
    }

    /**
     * @return int|80 port number to connect to
     */
    function getPort()
    {
        if (isset($this->_info['attribs']['port'])) {
            return (int)$this->_info['attribs']['port'];
        }

        if ($this->getSSL()) {
            return 443;
        }

        return 80;
    }

    /**
     * @return bool Determines whether secure sockets layer (SSL) is used to connect to this channel
     */
    function getSSL()
    {
        if (isset($this->_info['attribs']['ssl'])) {
            return true;
        }

        return false;
    }
    
    /**
     * Returns the protocols supported by the primary server for this channel
     * 
     * @return PEAR2_Pyrus_ChannelFile_v1_Servers_Protocols
     */
    function getProtocols()
    {
        return new PEAR2_Pyrus_ChannelFile_v1_Servers_Protocols($this->_info, $this);
    }

    /**
     * Determines whether a channel supports Representational State Transfer (REST) protocols
     * for retrieving channel information
     * @return bool
     */
    function supportsREST()
    {
        return isset($this->_info['rest']);
    }

    function setREST($rest)
    {
        if ($rest === null) {
            if (isset($this->_info['rest'])) {
                unset($this->_info['rest']);
            }
            return;
        }
        $this->_info['rest'] = $rest;
        $this->save();
    }

    function setName($name)
    {
        if (empty($name)) {
            throw new PEAR2_Pyrus_Channel_Exception('Mirror server must be non-empty');
        }
        if (!$this->validChannelServer($name)) {
            throw new PEAR2_Pyrus_Channel_Exception('Mirror server "' . $name .
                '" for channel "' . $this->getChannel() . '" is not a valid channel server');
        }
        $this->_info['attribs']['host'] = $name;
        $this->save();
    }

    function setPort($port)
    {
        $this->_info['attribs']['port'] = $port;
        $this->save();
    }

    function setSSL($ssl = true)
    {
        if (!$ssl) {
            if (isset($this->_info['attribs']['ssl'])) {
                unset($this->_info['attribs']['ssl']);
            }
        } else {
            $this->_info['attribs']['ssl'] = 'yes';
        }
        $this->save();
    }

    /**
     * Empty all REST definitions
     */
    function resetREST()
    {
        if (isset($this->_info['rest'])) {
            unset($this->_info['rest']);
        }
        $this->save();
    }

    function getInfo()
    {
        return $this->_info;
    }

    function save()
    {
        $this->parent->setMirror($this->index, $this->_info);
        $this->parent->save();
    }
}<?php
class PEAR2_Pyrus_ChannelFile_v1_Servers_Protocols_REST implements ArrayAccess, Countable, Iterator
{
    protected $info;
    protected $parent;
    protected $index;
    
    function __construct($info, $parent, $index = null)
    {
        if (isset($info['baseurl']) && !isset($info['baseurl'][0])) {
            $info['baseurl'] = array($info['baseurl']);
        }
        $this->info = $info;
        $this->parent = $parent;
        $this->index = $index;
    }

    function current()
    {
        $info = current($this->info['baseurl']);
        if ($info['_content'][strlen($info['_content'])-1] != '/') {
            return $info['_content'] . '/';
        }
        return $info['_content'];
    }

    function rewind()
    {
        reset($this->info['baseurl']);
    }

    function key()
    {
        return $this->info['baseurl'][key($this->info['baseurl'])]['attribs']['type'];
    }

    function next()
    {
        return next($this->info['baseurl']);
    }

    function valid()
    {
        if (!isset($this->info['baseurl'])) {
            return false;
        }
        return current($this->info['baseurl']);
    }

    function count()
    {
        if (!isset($this->info['baseurl'])) {
            return 0;
        }
        return count($this->info['baseurl']);
    }
    
    function __get($var)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_ChannelFile_Exception('Cannot use -> to access '
                    . 'REST protocols, use []');
        }
        if ($var === 'baseurl') {
            return $this->info['_content'];
        }
        throw new PEAR2_Pyrus_ChannelFile_Exception('Unknown variable ' . $var);
    }

    function __set($var, $value)
    {
        if (!isset($this->index)) {
            throw new PEAR2_Pyrus_ChannelFile_Exception('Cannot use -> to access '
                    . 'REST protocols, use []');
        }
        if ($var === 'baseurl') {
            $this->info['_content'] = $value;
            return $this->save();
        }
        throw new PEAR2_Pyrus_ChannelFile_Exception('Unknown variable ' . $var);
    }
    
    function offsetGet($protocol)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_ChannelFile_Exception('Cannot use [] to access '
                    . 'baseurl, use ->');
        }
        if (!isset($this->info['baseurl'])) {
            return new PEAR2_Pyrus_ChannelFile_v1_Servers_Protocols_REST(
                array('attribs' => array('type' => $protocol), '_content' => null),
                $this, 0);
        }
        foreach ($this->info['baseurl'] as $baseurl) {
            if (strtolower($baseurl['attribs']['type']) == strtolower($protocol)) {
                $ret = new PEAR2_Pyrus_ChannelFile_v1_Servers_Protocols_REST(
                    $baseurl, $this, $protocol
                );
                return $ret;
            }
        }
        return new PEAR2_Pyrus_ChannelFile_v1_Servers_Protocols_REST(
            array('attribs' => array('type' => $protocol), '_content' => null),
            $this, count($this->info['baseurl']));
    }
    
    function offsetSet($protocol, $value)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_ChannelFile_Exception('Cannot use [] to access '
                    . 'baseurl, use ->');
        }
        if (!($value instanceof self)) {
            throw new PEAR2_Pyrus_ChannelFile_Exception('Can only set REST protocol ' .
                        ' to a PEAR2_Pyrus_ChannelFile_v1_Servers_Protocol_REST object');
        }
        if (!isset($this->info['baseurl'])) {
            $this->info['baseurl'] = $value->getInfo();
            return $this->save();
        }
        foreach ($this->info['baseurl'] as $i => $baseurl) {
            if (strtolower($baseurl['attribs']['type']) == strtolower($protocol)) {
                $this->info['baseurl'][$i] = $value->getInfo();
                return $this->save();
            }
        }
        $this->info['baseurl'][] = $value->getInfo();
        return $this->save();
    }
    
    function offsetExists($protocol)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_ChannelFile_Exception('Cannot use [] to access '
                    . 'baseurl, use ->');
        }
        foreach ($this->info['baseurl'] as $baseurl) {
            if (strtolower($baseurl['attribs']['type']) == strtolower($protocol)) {
                return true;
            }
        }
        return false;
    }
    
    function offsetUnset($protocol)
    {
        if (isset($this->index)) {
            throw new PEAR2_Pyrus_ChannelFile_Exception('Cannot use [] to access '
                    . 'baseurl, use ->');
        }
        foreach ($this->info['baseurl'] as $i => $baseurl) {
            if (strtolower($baseurl['attribs']['type']) == strtolower($protocol)) {
                unset($this->info['baseurl'][$i]);
                $this->info['baseurl'] = array_values($this->info['baseurl']);
                return $this->save();
            }
        }
    }

    function getInfo()
    {
        return $this->info;
    }

    function save()
    {
        if ($this->parent instanceof self) {
            $this->parent[$this->info['attribs']['type']] = $this;
            return $this->parent->save();
        }
        $info = $this->info;
        if (isset($info['baseurl']) && count($info['baseurl']) == 1) {
            $info['baseurl'] = $info['baseurl'][0];
        }
        $this->parent->rawrest = $info;
    }
}
?><?php

class PEAR2_Pyrus_ChannelFile_v1_Servers_Protocols
{
    protected $_info;
    
    protected $parent;
    
    function __construct($info, $parent)
    {
        $this->_info =  $info;
        $this->parent = $parent;
    }
    
    function __get($var)
    {
        switch($var){
            case 'rest':
            case 'soap':
            case 'xmlrpc':
                $method = 'get' . $var;
                return $this->{$method}();
            default:
                throw new PEAR2_Pyrus_ChannelFile_Exception('Unknown protocol: ' . $var);
        }
    }

    function __set($var, $value)
    {
        switch($var){
            case 'rest':
            case 'soap':
            case 'xmlrpc':
                $method = 'set' . $var;
                return $this->{$method}($value);
            default:
                throw new PEAR2_Pyrus_ChannelFile_Exception('Unknown protocol: ' . $var);
        }
    }

    function setREST($value)
    {
        if ($value === null) {
            $this->parent->rest = null;
            return;
        }
        if (!($value instanceof PEAR2_Pyrus_ChannelFile_v1_Servers_Protocols_REST)) {
            throw new PEAR2_Pyrus_ChannelFile_Exception('Can only set REST to ' .
                        'PEAR2_Pyrus_ChannelFile_v1_Servers_Protocols_REST object');
        }
        $info = $value->getInfo();
        if (!count($info)) {
            $this->parent->rest = null;
        } else {
            $this->parent->rest = $info;
        }
    }

    function getREST()
    {
        if (isset($this->_info['rest'])) {
            $info = $this->_info['rest'];
        } else {
            $info = array();
        }
        return new PEAR2_Pyrus_ChannelFile_v1_Servers_Protocols_REST($info, $this->parent);
    }
}

?><?php
class PEAR2_Pyrus_ChannelFile_v1_Servers implements ArrayAccess, Countable, Iterator
{
    /**
     * @var PEAR2_Pyrus_ChannelFile_v1
     */
    protected $parent;
    
    protected $info = array();
    
    protected $type = 'primary';
    
    function __construct($info, PEAR2_Pyrus_ChannelFile_v1 $parent)
    {
        if (isset($info['mirror']) && !isset($info['mirror'][0])) {
            $info['mirror'] = array($info['mirror']);
        }
        $this->info = $info;
        $this->parent = $parent;
    }

    function current()
    {
        $info = current($this->info['mirror']);
        return new PEAR2_Pyrus_ChannelFile_v1_Mirror($info, $this, $this->parent, key($this->info['mirror']));
    }

    function rewind()
    {
        if (!isset($this->info['mirror'])) {
            return;
        }
        reset($this->info['mirror']);
    }

    function key()
    {
        return key($this->info['mirror']);
    }

    function next()
    {
        return next($this->info['mirror']);
    }

    function valid()
    {
        if (!isset($this->info['mirror'])) {
            return false;
        }
        return current($this->info['mirror']);
    }
        

    function count()
    {
        if (!isset($this->info['mirror'])) {
            return 0;
        }
        return count($this->info['mirror']);
    }

    function offsetExists($mirror)
    {
        foreach ($this->info as $type=>$details) {
            if ($type == 'mirror'
                && isset($details[0])
                && $details[0]['attribs']['host'] == $mirror) {
                return true;
            }
        }
        return false;
    }
    
    function offsetUnset($mirror)
    {
        if (!isset($this->info['mirror'])) {
            return;
        }
        foreach ($this->info['mirror'] as $i => $details) {
            if (isset($details['attribs']) && isset($details['attribs']['host']) &&
                    $details['attribs']['host'] == $mirror) {
                unset($this->info['mirror'][$i]);
                $this->info['mirror'] = array_values($this->info['mirror']);
                return $this->save();
            }
        }
    }
    
    function offsetGet($mirror)
    {
        if (!isset($this->info['mirror'])) {
            return new PEAR2_Pyrus_ChannelFile_v1_Mirror(array('attribs' => array('host' => $mirror)), $this, $this->parent, 0);
        }
        foreach ($this->info['mirror'] as $i => $details) {
            if (isset($details['attribs']) && isset($details['attribs']['host']) &&
                $details['attribs']['host'] == $mirror) {
                return new PEAR2_Pyrus_ChannelFile_v1_Mirror($details, $this, $this->parent, $i);
            }
        }
        
        return new PEAR2_Pyrus_ChannelFile_v1_Mirror(array('attribs' => array('host' => $mirror)), $this, $this->parent, count($this->info['mirror']));
    }
    
    function offsetSet($mirror, $value)
    {
        if ($value === null) {
            return $this->offsetUnset($mirror);
        }
        if (!($value instanceof PEAR2_Pyrus_ChannelFile_v1_Mirror)) {
            throw new PEAR2_Pyrus_ChannelFile_Exception('Can only set mirror to a ' .
                        'PEAR2_Pyrus_ChannelFile_v1_Mirror object');
        }
        $info = $value->getInfo();
        if ($mirror != $value->server) {
            $info['attribs']['host'] = $mirror;
        }
        foreach ($this->info['mirror'] as $i => $details) {
            if (isset($details['attribs']) && isset($details['attribs']['host']) &&
                $details['attribs']['host'] == $mirror) {
                $this->setMirror($i, $info);
                return $this->save();
            }
        }
        $this->setMirror(count($this->info['mirror']), $info);
        $this->save();
    }

    function setMirror($index, $info)
    {
        $this->info['mirror'][$index] = $info;
    }

    function save()
    {
        $info = $this->info;
        if (!$info['mirror']) {
            return $this->parent->rawmirrors = null;
        }
        if (count($info['mirror']) === 1) {
            return $this->parent->rawmirrors = $info['mirror'][0];
        }
        $this->parent->rawmirrors = $info['mirror'];
    }
}<?php
/**
 * PEAR2_Pyrus_Registry
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Registry manager
 *
 * The registry for PEAR2 consists of four related components
 *
 *  - an sqlite database
 *  - saved original package.xml for each installed package
 *  - saved original channel.xml for each discovered channel
 *  - configuration values at package installation time
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_Registry implements PEAR2_Pyrus_IRegistry, IteratorAggregate
{
    static protected $allRegistries = array();
    /**
     * Class to instantiate for singleton.
     *
     * This is useful for unit-testing and for extending the registry
     * @var string
     */
    static public $className = 'PEAR2_Pyrus_Registry';
    /**
     * The parent registry
     *
     * This is used to implement cascading registries
     * @var PEAR2_Pyrus_Registry
     */
    protected $parent;

    /**
     * The base path of this registry
     *
     * @var string
     */
    protected $path;
    /**
     * If true, this registry is a cascaded parent registry, and should be treated
     * as read-only.
     *
     * @var bool
     */
    protected $readonly;

    protected $registries = array();
    /**
     * The channel registry for this path
     *
     * @var PEAR2_PyruschannelRegistry
     */
    protected $channelRegistry;

    public function setChannelRegistry(PEAR2_Pyrus_ChannelRegistry $reg)
    {
        $this->channelRegistry = $reg;
    }

    public function setParent(PEAR2_Pyrus_Registry $parent = null)
    {
        $this->parent = $parent;
    }

    public function __construct($path, $registries = array('Sqlite3', 'Xml'), $readonly = false)
    {
        $this->path     = $path;
        $this->readonly = $readonly;
        $exceptions     = array();
        foreach ($registries as $registry) {
            try {
                $registry = ucfirst($registry);
                $registry = "PEAR2_Pyrus_Registry_$registry";
                if (!class_exists($registry, true)) {
                    $exceptions[] = new PEAR2_Pyrus_Registry_Exception(
                        'Unknown registry type: ' . $registry);
                    continue;
                }
                $this->registries[] = new $registry($path, $readonly);
            } catch (Exception $e) {
                $exceptions[] = $e;
            }
        }

        if (!count($this->registries)) {
            throw new PEAR2_Pyrus_Registry_Exception(
                'Unable to initialize registry for path "' . $path . '"',
                $exceptions);
        }

        $this->channelRegistry = new PEAR2_Pyrus_ChannelRegistry($path,
            $registries, $readonly);
    }

    public function replace(PEAR2_Pyrus_IPackageFile $info)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot install packages, registry is read-only');
        }

        foreach ($this->registries as $reg) {
            $reg->replace($info);
        }
    }

    public function install(PEAR2_Pyrus_IPackageFile $info, $replace = false)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot install packages, registry is read-only');
        }

        foreach ($this->registries as $reg) {
            $reg->install($info, $replace);
        }
    }

    public function uninstall($name, $channel)
    {
        if ($this->readonly) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot uninstall packages, registry is read-only');
        }

        foreach ($this->registries as $reg) {
            $reg->uninstall($name, $channel);
        }
    }

    /**
     * Determines whether a package exists
     *
     * @param string $package
     * @param string $channel
     * @param bool   $onlyMain if true, only check the primary registry
     * 
     * @return bool
     */
    public function exists($package, $channel, $onlyMain = false)
    {
        $ret = $this->registries[0]->exists($package, $channel);
        if ($onlyMain) {
            return $ret;
        }

        if (!$ret) {
            if (!$this->parent) {
                return false;
            }

            return $this->parent->exists($package, $channel);
        }

        return true;
    }

    public function info($package, $channel, $field, $onlyMain = false)
    {
        if ($onlyMain) {
            return $this->registries[0]->info($package, $channel, $field);
        }

        if ($this->exists($package, $channel, true)) {
            return $this->registries[0]->info($package, $channel, $field);
        }

        if ($this->exists($package, $channel, false)) {
            if (!$this->parent) {
                return null;
            }

            // installed in parent registry
            return $this->parent->info($package, $channel, $field);
        }

        return null;
    }

    public function listPackages($channel, $onlyMain = false)
    {
        $ret = array();
        foreach ($this->registries as $registry) {
            $packages = $registry->listPackages($channel);
            $ret = array_merge($ret, $packages);
        }
        $ret = array_unique($ret);
        if ($onlyMain) {
            return $ret;
        }
        if ($this->parent) {
            return array_unique(array_merge($ret, $this->parent->listPackages($channel)));
        }

        return $ret;
    }

    // TODO: fix to support cascading
    public function getIterator()
    {
        return $this->registries[0];
    }

    public function toPackageFile($package, $channel, $onlyMain = false)
    {
        if ($this->exists($package, $channel, true)) {
            foreach ($this->registries as $reg) {
                if ($reg instanceof PEAR2_Pyrus_Registry_Xml) {
                    // prefer xml for retrieving packagefile object
                    try {
                        return $reg->toPackageFile($package, $channel);
                    } catch (Exception $e) {
                        // failed, cascade to using default registry instead
                        break;
                    }
                }
            }

            return $this->registries[0]->toPackageFile($package, $channel);
        } elseif ($onlyMain || !$this->exists($package, $channel, false)) {
            throw new PEAR2_Pyrus_Registry_Exception('Cannot retrieve package file object ' .
                'for package ' . $channel . '/' . $package . ', it is not installed');
        }

        // installed in parent registry
        return $this->parent->toPackageFile($package, $channel);
    }

    function __get($var)
    {
        // first registry is always the primary registry
        if ($var == 'package') {
            return $this->registries[0]->package;
        }

        if ($var == 'allregistries') {
            return $this->registries;
        }
    }

    public function getParent()
    {
        return $this->parent;
    }

    public function getPath()
    {
        return $this->path;
    }

    public function getDependentPackages(PEAR2_Pyrus_IPackageFile $package)
    {
        return $this->registries[0]->getDependentPackages($package);
    }

    public function detectFileConflicts(PEAR2_Pyrus_IPackageFile $package)
    {
        return $this->registries[0]->detectFileConflicts($package);
    }

    /**
     * Returns a list of registries present in the PEAR installation at $path
     * @param string
     * @return array
     * @todo make it possible to extend the registries to add customized future registries
     */
    static public function detectRegistries($path)
    {
        if (!file_exists($path) || !is_dir($path)) {
            return array();
        }
        return array_merge(PEAR2_Pyrus_Registry_Sqlite3::detectRegistries($path),
                           PEAR2_Pyrus_Registry_Xml::detectRegistries($path),
                           PEAR2_Pyrus_Registry_Pear1::detectRegistries($path));
    }

    /**
     * Completely remove all traces of a registry
     */
    static public function removeRegistry($path, array $registries = array())
    {
        if (!count($registries)) {
            $registries = static::detectRegistries($path);
        }
        foreach ($registries as $reg) {
            $class = 'PEAR2_Pyrus_Registry_' . ucfirst(strtolower($reg));
            $class::removeRegistry($path);
        }
    }
}
<?php
/**
 * PEAR2_Pyrus_PluginRegistry_Exception
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Exception for a Pyrus PECL package builder.
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
class PEAR2_Pyrus_PluginRegistry_Exception extends PEAR2_Exception
{
}<?php
/**
 * PEAR2_Pyrus_IChannel
 *
 * PHP version 5
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @version   SVN: $Id$
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */

/**
 * Interface for channels
 *
 * @category  PEAR2
 * @package   PEAR2_Pyrus
 * @author    Greg Beaver <cellog@php.net>
 * @copyright 2008 The PEAR Group
 * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License
 * @link      http://svn.pear.php.net/wsvn/PEARSVN/Pyrus/
 */
interface PEAR2_Pyrus_IChannelFile
{
    function __get($var);
    function __set($var, $value);
    function __toString();
}
<?php
/**
 * The PEAR2_Pyrus_OSGuess class
 *
 * PHP versions 4 and 5
 *
 * LICENSE: This source file is subject to version 3.0 of the PHP license
 * that is available through the world-wide-web at the following URI:
 * http://www.php.net/license/3_0.txt.  If you did not receive a copy of
 * the PHP License and are unable to obtain it through the web, please
 * send a note to license@php.net so we can mail you a copy immediately.
 *
 * @category   pear
 * @package    PEAR
 * @author     Stig Bakken <ssb@php.net>
 * @author     Gregory Beaver <cellog@php.net>
 * @copyright  1997-2007 The PHP Group
 * @license    http://www.php.net/license/3_0.txt  PHP License 3.0
 * @version    CVS: $Id: Guess.php,v 1.25 2006/12/14 00:24:37 cellog Exp $
 * @link       http://pear.php.net/package/PEAR
 * @since      File available since Pyrus 0.1
 */

// {{{ uname examples

// php_uname() without args returns the same as 'uname -a', or a PHP-custom
// string for Windows.
// PHP versions prior to 4.3 return the uname of the host where PHP was built,
// as of 4.3 it returns the uname of the host running the PHP code.
//
// PC RedHat Linux 7.1:
// Linux host.example.com 2.4.2-2 #1 Sun Apr 8 20:41:30 EDT 2001 i686 unknown
//
// PC Debian Potato:
// Linux host 2.4.17 #2 SMP Tue Feb 12 15:10:04 CET 2002 i686 unknown
//
// PC FreeBSD 3.3:
// FreeBSD host.example.com 3.3-STABLE FreeBSD 3.3-STABLE #0: Mon Feb 21 00:42:31 CET 2000     root@example.com:/usr/src/sys/compile/CONFIG  i386
//
// PC FreeBSD 4.3:
// FreeBSD host.example.com 4.3-RELEASE FreeBSD 4.3-RELEASE #1: Mon Jun 25 11:19:43 EDT 2001     root@example.com:/usr/src/sys/compile/CONFIG  i386
//
// PC FreeBSD 4.5:
// FreeBSD host.example.com 4.5-STABLE FreeBSD 4.5-STABLE #0: Wed Feb  6 23:59:23 CET 2002     root@example.com:/usr/src/sys/compile/CONFIG  i386
//
// PC FreeBSD 4.5 w/uname from GNU shellutils:
// FreeBSD host.example.com 4.5-STABLE FreeBSD 4.5-STABLE #0: Wed Feb  i386 unknown
//
// HP 9000/712 HP-UX 10:
// HP-UX iq B.10.10 A 9000/712 2008429113 two-user license
//
// HP 9000/712 HP-UX 10 w/uname from GNU shellutils:
// HP-UX host B.10.10 A 9000/712 unknown
//
// IBM RS6000/550 AIX 4.3:
// AIX host 3 4 000003531C00
//
// AIX 4.3 w/uname from GNU shellutils:
// AIX host 3 4 000003531C00 unknown
//
// SGI Onyx IRIX 6.5 w/uname from GNU shellutils:
// IRIX64 host 6.5 01091820 IP19 mips
//
// SGI Onyx IRIX 6.5:
// IRIX64 host 6.5 01091820 IP19
//
// SparcStation 20 Solaris 8 w/uname from GNU shellutils:
// SunOS host.example.com 5.8 Generic_108528-12 sun4m sparc
//
// SparcStation 20 Solaris 8:
// SunOS host.example.com 5.8 Generic_108528-12 sun4m sparc SUNW,SPARCstation-20
//
// Mac OS X (Darwin)
// Darwin home-eden.local 7.5.0 Darwin Kernel Version 7.5.0: Thu Aug  5 19:26:16 PDT 2004; root:xnu/xnu-517.7.21.obj~3/RELEASE_PPC  Power Macintosh
//
// Mac OS X early versions
//

// }}}

/* TODO:
 * - define endianness, to allow matchSignature("bigend") etc.
 */

/**
 * Retrieves information about the current operating system
 *
 * This class uses php_uname() to grok information about the current OS
 *
 * @category   pear
 * @package    PEAR
 * @author     Stig Bakken <ssb@php.net>
 * @author     Gregory Beaver <cellog@php.net>
 * @copyright  1997-2005 The PHP Group
 * @license    http://www.php.net/license/3_0.txt  PHP License 3.0
 * @version    Release: @package_version@
 * @link       http://pear.php.net/package/PEAR
 * @since      Class available since Release 0.1
 */
class PEAR2_Pyrus_OSGuess
{
    var $sysname;
    var $nodename;
    var $cpu;
    var $release;
    var $extra;

    function __construct($uname = null)
    {
        list($this->sysname,
             $this->release,
             $this->cpu,
             $this->extra,
             $this->nodename) = $this->parseSignature($uname);
    }

    function parseSignature($uname = null)
    {
        static $sysmap = array(
            'HP-UX' => 'hpux',
            'IRIX64' => 'irix',
        );
        static $cpumap = array(
            'i586' => 'i386',
            'i686' => 'i386',
            'ppc' => 'powerpc',
        );
        if ($uname === null) {
            $uname = php_uname();
        }
        $parts = preg_split('/\s+/', trim($uname));
        $n = count($parts);

        $release = $machine = $cpu = '';
        $sysname = $parts[0];
        $nodename = $parts[1];
        $cpu = $parts[$n-1];
        $extra = '';
        if ($cpu == 'unknown') {
            $cpu = $parts[$n-2];
        }

        switch ($sysname) {
            case 'AIX' :
                $release = "$parts[3].$parts[2]";
                break;
            case 'Windows' :
                switch ($parts[1]) {
                    case '95/98':
                        $release = '9x';
                        break;
                    default:
                        $release = $parts[1];
                        break;
                }
                $cpu = 'i386';
                break;
            case 'Linux' :
                $extra = $this->_detectGlibcVersion();
                // use only the first two digits from the kernel version
                $release = preg_replace('/^([0-9]+\.[0-9]+).*/', '\1', $parts[2]);
                break;
            case 'Mac' :
                $sysname = 'darwin';
                $nodename = $parts[2];
                $release = $parts[3];
                if ($cpu == 'Macintosh') {
                    if ($parts[$n - 2] == 'Power') {
                        $cpu = 'powerpc';
                    }
                }
                break;
            case 'Darwin' :
                if ($cpu == 'Macintosh') {
                    if ($parts[$n - 2] == 'Power') {
                        $cpu = 'powerpc';
                    }
                }
                $release = preg_replace('/^([0-9]+\.[0-9]+).*/', '\1', $parts[2]);
                break;
            default:
                $release = preg_replace('-.*', '', $parts[2]);
                break;
        }


        if (isset($sysmap[$sysname])) {
            $sysname = $sysmap[$sysname];
        } else {
            $sysname = strtolower($sysname);
        }
        if (isset($cpumap[$cpu])) {
            $cpu = $cpumap[$cpu];
        }
        return array($sysname, $release, $cpu, $extra, $nodename);
    }

    private function _detectGlibcVersion()
    {
        static $glibc = false;
        if ($glibc !== false) {
            return $glibc; // no need to run this multiple times
        }
        $major = $minor = 0;
        // Use glibc's <features.h> header file to
        // get major and minor version number:
        if (@file_exists('/usr/include/features.h') &&
              @is_readable('/usr/include/features.h')) {
            if (!@file_exists('/usr/bin/cpp') || !@is_executable('/usr/bin/cpp')) {
                $features_file = fopen('/usr/include/features.h', 'rb');
                while (!feof($features_file)) {
                    $line = fgets($features_file, 8192);
                    if (!$line || (strpos($line, '#define') === false)) {
                        continue;
                    }
                    if (strpos($line, '__GLIBC__')) {
                        // major version number #define __GLIBC__ version
                        $line = preg_split('/\s+/', $line);
                        $glibc_major = trim($line[2]);
                        if (isset($glibc_minor)) {
                            break;
                        }
                        continue;
                    }
                    if (strpos($line, '__GLIBC_MINOR__'))  {
                        // got the minor version number
                        // #define __GLIBC_MINOR__ version
                        $line = preg_split('/\s+/', $line);
                        $glibc_minor = trim($line[2]);
                        if (isset($glibc_major)) {
                            break;
                        }
                        continue;
                    }
                }
                fclose($features_file);
                if (!isset($glibc_major) || !isset($glibc_minor)) {
                    return $glibc = '';
                }
                return $glibc = 'glibc' . trim($glibc_major) . "." . trim($glibc_minor) ;
            } // no cpp
            $tmpfile = tempnam(sys_get_temp_dir(), "glibctest");
            $fp = fopen($tmpfile, "w");
            fwrite($fp, "#include <features.h>\n__GLIBC__ __GLIBC_MINOR__\n");
            fclose($fp);
            $cpp = popen("/usr/bin/cpp $tmpfile", "r");
            while ($line = fgets($cpp, 1024)) {
                if ($line{0} == '#' || trim($line) == '') {
                    continue;
                }
                if (list($major, $minor) = explode(' ', trim($line))) {
                    break;
                }
            }
            pclose($cpp);
            unlink($tmpfile);
        } // features.h
        if (!($major && $minor) && @is_link('/lib/libc.so.6')) {
            // Let's try reading the libc.so.6 symlink
            if (ereg('^libc-(.*)\.so$', basename(readlink('/lib/libc.so.6')), $matches)) {
                list($major, $minor) = explode('.', $matches[1]);
            }
        }
        if (!($major && $minor)) {
            return $glibc = '';
        }
        return $glibc = "glibc{$major}.{$minor}";
    }

    function getSignature()
    {
        if (empty($this->extra)) {
            return "{$this->sysname}-{$this->release}-{$this->cpu}";
        }
        return "{$this->sysname}-{$this->release}-{$this->cpu}-{$this->extra}";
    }

    function getSysname()
    {
        return $this->sysname;
    }

    function getNodename()
    {
        return $this->nodename;
    }

    function getCpu()
    {
        return $this->cpu;
    }

    function getRelease()
    {
        return $this->release;
    }

    function getExtra()
    {
        return $this->extra;
    }

    function matchSignature($match)
    {
        if (is_array($match)) {
            $fragments = $match;
        } else {
            $fragments = explode('-', $match);
        }
        $n = count($fragments);
        $matches = 0;
        if ($n > 0) {
            $matches += $this->_matchFragment($fragments[0], $this->sysname);
        }
        if ($n > 1) {
            $matches += $this->_matchFragment($fragments[1], $this->release);
        }
        if ($n > 2) {
            $matches += $this->_matchFragment($fragments[2], $this->cpu);
        }
        if ($n > 3) {
            $matches += $this->_matchFragment($fragments[3], $this->extra);
        }
        return ($matches == $n);
    }

    function _matchFragment($fragment, $value)
    {
        if (strcspn($fragment, '*?') < strlen($fragment)) {
            $reg = '/^' . str_replace(array('*', '?', '/'), array('.*', '.', '\\/'), $fragment) . '\\z/';
            return preg_match($reg, $value);
        }
        return ($fragment == '*' || !strcasecmp($fragment, $value));
    }

}
/*
 * Local Variables:
 * indent-tabs-mode: nil
 * c-basic-offset: 4
 * End:
 */
?>
<?xml version="1.0" encoding="UTF-8"?>
<commands version="2.0" xmlns="http://pear2.php.net/dtd/customcommand-2.0">
 <command>
  <name>install</name>
  <class>PEAR2_Pyrus_ScriptFrontend_Commands</class>
  <function>install</function>
  <summary>Install a package.  Use install --plugin to install plugins</summary>
  <shortcut>i</shortcut>
  <options>
   <option>
    <name>plugin</name>
    <shortopt>p</shortopt>
    <type><string/></type>
    <doc>Manage plugin installation only</doc>
   </option>
   <option>
    <name>packagingroot</name>
    <shortopt>r</shortopt>
    <type><string/></type>
    <doc>Install the package in a directory in preparation for packaging with tools like RPM</doc>
   </option>
   <option>
    <name>optionaldeps</name>
    <shortopt>o</shortopt>
    <type><bool/></type>
    <doc>Automatically download and install all optional dependencies</doc>
   </option>
   <option>
    <name>force</name>
    <shortopt>f</shortopt>
    <type><bool/></type>
    <doc>Force the installation to proceed independent of errors.  USE SPARINGLY.</doc>
   </option>
  </options>
  <arguments>
   <argument>
    <name>package</name>
    <multiple>1</multiple>
    <optional>0</optional>
    <doc>package.xml, local package archive, remove package archive, or abstract package.</doc>
   </argument>
  </arguments>
  <doc>Installs listed packages.

local package.xml example:
php pyrus.phar install package.xml

local package archive example:
php pyrus.phar install PackageName-1.2.0.tar

remote package archive example:
php pyrus.phar install http://www.example.com/PackageName-1.2.0.tgz

Examples of an abstract package:
php pyrus.phar install PackageName
 installs PackageName from the default channel with stability preferred_state
php pyrus.phar pear/PackageName
 installs PackageName from the pear.php.net channel with stability preferred_state
php pyrus.phar install channel://doc.php.net/PackageName
 installs PackageName from the doc.php.net channel with stability preferred_state
php pyrus.phar install PackageName-beta
 installs PackageName from the default channel, beta or stable stability
php pyrus.phar install PackageName-1.2.0
 installs PackageName from the default channel, version 1.2.0</doc>
 </command>
 <command>
  <name>upgrade</name>
  <class>PEAR2_Pyrus_ScriptFrontend_Commands</class>
  <function>upgrade</function>
  <summary>Upgrade a package.  Use upgrade --plugin to upgrade plugins</summary>
  <shortcut>up</shortcut>
  <options>
   <option>
    <name>plugin</name>
    <shortopt>p</shortopt>
    <type><string/></type>
    <doc>Manage plugin installation only</doc>
   </option>
   <option>
    <name>optionaldeps</name>
    <shortopt>o</shortopt>
    <type><bool/></type>
    <doc>Automatically download and install all optional dependencies</doc>
   </option>
   <option>
    <name>force</name>
    <shortopt>f</shortopt>
    <type><bool/></type>
    <doc>Force the installation to proceed independent of errors.  USE SPARINGLY.</doc>
   </option>
  </options>
  <arguments>
   <argument>
    <name>package</name>
    <multiple>1</multiple>
    <optional>0</optional>
    <doc>package.xml, local package archive, remove package archive, or abstract package.</doc>
   </argument>
  </arguments>
  <doc>Installs or upgrades listed packages.

local package.xml example:
php pyrus.phar install package.xml

local package archive example:
php pyrus.phar install PackageName-1.2.0.tar

remote package archive example:
php pyrus.phar install http://www.example.com/PackageName-1.2.0.tgz

Examples of an abstract package:
php pyrus.phar install PackageName
 installs PackageName from the default channel with stability preferred_state
php pyrus.phar pear/PackageName
 installs PackageName from the pear.php.net channel with stability preferred_state
php pyrus.phar install channel://doc.php.net/PackageName
 installs PackageName from the doc.php.net channel with stability preferred_state
php pyrus.phar install PackageName-beta
 installs PackageName from the default channel, beta or stable stability
php pyrus.phar install PackageName-1.2.0
 installs PackageName from the default channel, version 1.2.0</doc>
 </command>
 <command>
  <name>uninstall</name>
  <class>PEAR2_Pyrus_ScriptFrontend_Commands</class>
  <function>uninstall</function>
  <summary>Uninstall a package.  Use uninstall --plugin to uninstall plugins</summary>
  <shortcut>un</shortcut>
  <options>
   <option>
    <name>plugin</name>
    <shortopt>p</shortopt>
    <type><string/></type>
    <doc>Manage plugin installation only</doc>
   </option>
   <option>
    <name>force</name>
    <shortopt>f</shortopt>
    <type><bool/></type>
    <doc>Force the uninstallation to proceed independent of errors.  USE SPARINGLY.</doc>
   </option>
  </options>
  <arguments>
   <argument>
    <name>package</name>
    <multiple>1</multiple>
    <optional>0</optional>
    <doc>channel/PackageName of packages to uninstall</doc>
   </argument>
  </arguments>
  <doc>Uninstall a package

Uninstalls packages.

Example:
php pyrus.phar uninstall PackageName
  uninstalls [default channel]/PackageName
php pyrus.phar uninstall channelname/PackageName
  uninstalls package PackageName from channel channelname.</doc>
 </command>
 <command>
  <name>build</name>
  <class>PEAR2_Pyrus_ScriptFrontend_Commands</class>
  <function>build</function>
  <summary>Build a PHP extension package from source and install the compiled extension</summary>
  <shortcut>b</shortcut>
  <options/>
  <arguments>
   <argument>
    <name>PackageName</name>
    <multiple>1</multiple>
    <optional>0</optional>
    <doc>Package name to build.</doc>
   </argument>
  </arguments>
  <doc>Build a PECL package from source, and install the compiled extension.

This command is used to build an extension.  It performs an automatic version of:

phpize --clean
phpize
./configure
make
make install

In the source directory of the package.</doc>
 </command>
 <command>
  <name>download</name>
  <class>PEAR2_Pyrus_ScriptFrontend_Commands</class>
  <function>download</function>
  <summary>Download a remote package to the current directory</summary>
  <shortcut>d</shortcut>
  <options/>
  <arguments>
   <argument>
    <name>package</name>
    <multiple>1</multiple>
    <optional>0</optional>
    <doc>package.xml, local package archive, remove package archive, or abstract package.</doc>
   </argument>
  </arguments>
  <doc>Download a remote package.

This command downloads a package to the current directory.  It can download
a remote package or copy a local package (although cp may be more efficient)</doc>
 </command>
 <command>
  <name>list-packages</name>
  <class>PEAR2_Pyrus_ScriptFrontend_Commands</class>
  <function>listPackages</function>
  <summary>List all installed packages in all channels</summary>
  <shortcut>l</shortcut>
  <options/>
  <arguments/>
  <doc>List all installed packages.

This command lists all installed packages organized by channel and by installation location.</doc>
 </command>
 <command>
  <name>list-channels</name>
  <class>PEAR2_Pyrus_ScriptFrontend_Commands</class>
  <function>listChannels</function>
  <summary>List all discovered channels</summary>
  <shortcut>lc</shortcut>
  <options/>
  <arguments/>
  <doc>List all discovered channels.

This command lists channels already known.  Use channel-discover or channel-add
to add a new channel.</doc>
 </command>
 <command>
  <name>channel-discover</name>
  <class>PEAR2_Pyrus_ScriptFrontend_Commands</class>
  <function>channelDiscover</function>
  <summary>Discover a new channel</summary>
  <shortcut>di</shortcut>
  <options/>
  <arguments>
   <argument>
    <name>channel</name>
    <multiple>0</multiple>
    <optional>0</optional>
    <doc>Channel name</doc>
   </argument>
  </arguments>
  <doc>Discover a new channel.

This command searches for a channel.xml first at a secure and then unsecured http address.

Examples:
php pyrus.phar channel-discover pear.example.com
  This tries to locate https://pear.example.com/channel.xml and if that fails,
  http://pear.example.com/channel.xml, and then adds the channel to the registry.

Use channel-add to add a local channel.xml to the registry</doc>
 </command>
 <command>
  <name>channel-add</name>
  <class>PEAR2_Pyrus_ScriptFrontend_Commands</class>
  <function>channelAdd</function>
  <summary>Add a new channel to the registry</summary>
  <shortcut>ca</shortcut>
  <options/>
  <arguments>
   <argument>
    <name>channelfile</name>
    <multiple>0</multiple>
    <optional>0</optional>
    <doc>Path to local channel.xml file</doc>
   </argument>
  </arguments>
  <doc>Add a new channel to the registry.

Use channel-discover to add a remote channel to the registry.</doc>
 </command>
 <command>
  <name>channel-del</name>
  <class>PEAR2_Pyrus_ScriptFrontend_Commands</class>
  <function>channelDel</function>
  <summary>Remove a channel from the registry</summary>
  <shortcut>cd</shortcut>
  <options/>
  <arguments>
   <argument>
    <name>channel</name>
    <multiple>0</multiple>
    <optional>0</optional>
    <doc>Channel name</doc>
   </argument>
  </arguments>
  <doc>Remove an existing channel from the registry.

pear2.php.net, pear.php.net, pecl.php.net, and doc.php.net cannot be removed
from the registry.</doc>
 </command>
 <command>
  <name>upgrade-registry</name>
  <class>PEAR2_Pyrus_ScriptFrontend_Commands</class>
  <function>upgradeRegistry</function>
  <summary>Upgrade an old PEAR installation to the new registry format</summary>
  <shortcut>ur</shortcut>
  <options>
   <option>
    <name>removeold</name>
    <shortopt>r</shortopt>
    <type><bool/></type>
    <doc>Remove the old PEAR registry</doc>
   </option>
  </options>
  <arguments>
   <argument>
    <name>path</name>
    <multiple>0</multiple>
    <optional>0</optional>
    <doc>Path to PEAR registry to upgrade</doc>
   </argument>
  </arguments>
  <doc>Upgrade an old PEAR installation to the new Sqlite and XML registry.

This command does not remove the old PEAR registry, but creates a duplicate in the new Sqlite
and XML formats, so that Pyrus can take advantage of the greater stability and speed of the
new format.</doc>
 </command>
 <command>
  <name>run-scripts</name>
  <class>PEAR2_Pyrus_ScriptFrontend_Commands</class>
  <function>runScripts</function>
  <summary>Run all post-install scripts for a package</summary>
  <shortcut>r</shortcut>
  <options/>
  <arguments>
   <argument>
    <name>package</name>
    <multiple>1</multiple>
    <optional>0</optional>
    <doc>Package name for which to run post-install scripts</doc>
   </argument>
  </arguments>
  <doc>Run all post-install scripts for a package.

This command runs each post-install script, and is interactive, prompting
for answers to queries posed by the post-install script, and executes
based on the answers provided.</doc>
 </command>
 <command>
  <name>config-show</name>
  <class>PEAR2_Pyrus_ScriptFrontend_Commands</class>
  <function>configShow</function>
  <summary>Show all configuration values</summary>
  <shortcut>r</shortcut>
  <options/>
  <arguments/>
  <doc>List all configuration values.

This lists configuration values, organized by system configuration settings and
user configuration settings.</doc>
 </command>
 <command>
  <name>set</name>
  <class>PEAR2_Pyrus_ScriptFrontend_Commands</class>
  <function>set</function>
  <summary>Set a configuration value</summary>
  <shortcut>set</shortcut>
  <options/>
  <arguments>
   <argument>
    <name>variable</name>
    <multiple>0</multiple>
    <optional>0</optional>
    <doc>Configuration variable name.  This can be a system or user variable.</doc>
   </argument>
   <argument>
    <name>value</name>
    <multiple>0</multiple>
    <optional>0</optional>
    <doc>Value to set the variable.</doc>
   </argument>
  </arguments>
  <doc>Set a configuration variable.

For example:
php pyrus.phar set download_dir /home/blah/downloads</doc>
 </command>
 <command>
  <name>mypear</name>
  <class>PEAR2_Pyrus_ScriptFrontend_Commands</class>
  <function>mypear</function>
  <summary>Set a configuration value</summary>
  <shortcut>m</shortcut>
  <options/>
  <arguments>
   <argument>
    <name>path</name>
    <multiple>1</multiple>
    <optional>0</optional>
    <doc>Set the path of your preferred PEAR locations.</doc>
   </argument>
  </arguments>
  <doc>Set the path of your preferred PEAR locations.

For example:
to set a local PEAR install at /home/user/pear and a system install at
/usr/local/lib/php, do

php pyrus.phar mypear /home/user/pear /usr/local/lib/php

On windows:
php pyrus.phar mypear "C:\Documents and Settings\User\pear" C:\php5

This is a convenience alias to the set command with my_pear_path.</doc>
 </command>
 <command>
  <name>help</name>
  <class>PEAR2_Pyrus_ScriptFrontend_Commands</class>
  <function>help</function>
  <summary>Get help on a particular command, or all commands</summary>
  <shortcut>e</shortcut>
  <options/>
  <arguments>
   <argument>
    <name>command</name>
    <multiple>0</multiple>
    <optional>1</optional>
    <doc>Command to get help on.  Leave blank to get help on all commands</doc>
   </argument>
  </arguments>
  <doc>Get detailed help on a command.</doc>
 </command>
</commands><?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="http://pear2.php.net/dtd/customtask-2.0"
 targetNamespace="http://pear2.php.net/dtd/customtask-2.0" elementFormDefault="qualified"
 attributeFormDefault="unqualified" xml:lang="EN">
 <xs:element name="task">
  <xs:complexType>
   <xs:sequence>
    <xs:element name="name" type="xs:string"/>
    <xs:element name="classprefix" type="xs:string">
     <xs:annotation>
      <xs:documentation xml:lang="EN">
       Prefix to role for proper class name
      </xs:documentation>
     </xs:annotation>
    </xs:element>
    <xs:element name="autoloadpath" type="xs:string">
     <xs:annotation>
      <xs:documentation xml:lang="EN">
       Relative path within php_dir to search for this task's classes in the autoloader
      </xs:documentation>
     </xs:annotation>
    </xs:element>
   </xs:sequence>
   <xs:attribute name="version" type="xs:string" fixed="2.0"/>
  </xs:complexType>
 </xs:element>
</xs:schema>
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="http://pear2.php.net/dtd/customrole-2.0"
 targetNamespace="http://pear2.php.net/dtd/customrole-2.0" elementFormDefault="qualified"
 attributeFormDefault="unqualified" xml:lang="EN">
 <xs:element name="role">
  <xs:complexType>
   <xs:sequence>
    <xs:element name="name" type="xs:string"/>
    <xs:element name="classprefix" type="xs:string">
     <xs:annotation>
      <xs:documentation xml:lang="EN">
       Prefix to role for proper class name
      </xs:documentation>
     </xs:annotation>
    </xs:element>
    <xs:element name="autoloadpath" type="xs:string" minOccurs="0" maxOccurs="1">
     <xs:annotation>
      <xs:documentation xml:lang="EN">
       Relative path within php_dir to search for this role's classes in the autoloader.
       If not present, no additional autoloader is added to the autoloader chain.
      </xs:documentation>
     </xs:annotation>
    </xs:element>
    <xs:element name="releasetypes" type="xs:string" minOccurs="1" maxOccurs="unbounded"/>
    <xs:element name="installable" type="xs:int" default="0"/>
    <xs:element name="locationconfig" type="xs:string"/>
    <xs:element name="honorsbaseinstall" type="xs:int" default="0"/>
    <xs:element name="unusualbaseinstall" type="xs:int" default="0"/>
    <xs:element name="phpfile" type="xs:int" default="0"/>
    <xs:element name="executable" type="xs:int" default="0"/>
    <xs:element name="phpextension" type="xs:int" default="0"/>
    <xs:element ref="configvar" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
   <xs:attribute name="version" type="xs:string" fixed="2.0"/>
  </xs:complexType>
 </xs:element>
 <xs:element name="configvar">
  <xs:complexType>
   <xs:sequence>
    <xs:element name="name" type="xs:string"/>
    <xs:element name="type" type="xs:string"/>
    <xs:element name="default" type="xs:string">
     <xs:annotation>
      <xs:documentation xml:lang="EN">
       Should contain PHP source to execute to retrieve the default value.
       The source must set the variable $default to the default value
      </xs:documentation>
     </xs:annotation>
    </xs:element>
    <xs:element name="doc" type="xs:string"/>
    <xs:element name="validset" type="xs:string" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element name="prompt" type="xs:string"/>
    <xs:element name="group" type="xs:string"/>
    <xs:element name="configtype">
     <xs:simpleType>
      <xs:restriction base="xs:string">
       <xs:enumeration value="system"/>
       <xs:enumeration value="user"/>
      </xs:restriction>
     </xs:simpleType>
    </xs:element>
   </xs:sequence>
  </xs:complexType> 
 </xs:element>
</xs:schema>
<?xml version="1.0" encoding="UTF-8"?>
<!-- edited with XMLSpy v2005 rel. 3 U (http://www.altova.com) by Gregory Beaver (The Chiara String Quartet) -->
<!-- edited with XMLSPY v2004 rel. 4 U (http://www.xmlspy.com) by Greg Beaver (The Chiara String Quartet) -->
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="http://pear.php.net/dtd/package-2.0" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" targetNamespace="http://pear.php.net/dtd/package-2.0" elementFormDefault="qualified" attributeFormDefault="unqualified" xml:lang="EN">
 <xs:element name="package">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="name"/>
    <xs:choice>
     <xs:element ref="channel"/>
     <xs:element ref="uri"/>
    </xs:choice>
    <xs:element ref="extends" minOccurs="0"/>
    <xs:element ref="summary"/>
    <xs:element ref="description"/>
    <xs:choice>
     <xs:sequence>
      <xs:element ref="lead" maxOccurs="unbounded"/>
      <xs:element ref="developer" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element ref="contributor" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element ref="helper" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element ref="date"/>
      <xs:element ref="time" minOccurs="0"/>
     </xs:sequence>
     <xs:sequence>
      <xs:element ref="date"/>
      <xs:element ref="time" minOccurs="0"/>
      <xs:element ref="lead" maxOccurs="unbounded"/>
      <xs:element ref="developer" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element ref="contributor" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element ref="helper" minOccurs="0" maxOccurs="unbounded"/>
     </xs:sequence>
    </xs:choice>
    <xs:element ref="version"/>
    <xs:element ref="stability"/>
    <xs:element ref="license"/>
    <xs:element ref="notes"/>
    <xs:element ref="contents"/>
    <xs:element ref="compatible" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="dependencies"/>
    <xs:element ref="providesextension" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="usesrole" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="usestask" minOccurs="0" maxOccurs="unbounded"/>
    <xs:choice minOccurs="0">
     <xs:sequence>
      <xs:element ref="srcpackage"/>
      <xs:element ref="srcchannel"/>
     </xs:sequence>
     <xs:element name="srcuri" type="xs:anyURI">
      <xs:annotation>
       <xs:documentation>uri of the package that contains the source of this extension</xs:documentation>
      </xs:annotation>
     </xs:element>
    </xs:choice>
    <xs:choice>
     <xs:element ref="phprelease" maxOccurs="unbounded"/>
     <xs:element ref="extsrcrelease" maxOccurs="unbounded"/>
     <xs:element ref="extbinrelease" maxOccurs="unbounded"/>
     <xs:element ref="bundle"/>
    </xs:choice>
    <xs:element ref="changelog" minOccurs="0"/>
   </xs:sequence>
   <xs:attribute name="version" type="xs:string" fixed="2.0"/>
   <xs:attribute name="packagerversion" type="version"/>
  </xs:complexType>
 </xs:element>
 <xs:element name="name" type="xs:string">
  <xs:annotation>
   <xs:documentation>this is ignored if the release type is bundle</xs:documentation>
  </xs:annotation>
 </xs:element>
 <xs:element name="summary" type="xs:string"/>
 <xs:element name="description" type="xs:string"/>
 <xs:element name="lead">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="name"/>
    <xs:element ref="user"/>
    <xs:element ref="email"/>
    <xs:element ref="active"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="developer">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="name"/>
    <xs:element ref="user"/>
    <xs:element ref="email"/>
    <xs:element ref="active"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="contributor">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="name"/>
    <xs:element ref="user"/>
    <xs:element ref="email"/>
    <xs:element ref="active"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="helper">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="name"/>
    <xs:element ref="user"/>
    <xs:element ref="email"/>
    <xs:element ref="active"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="date" type="xs:date"/>
 <xs:element name="version">
  <xs:complexType>
   <xs:sequence>
    <xs:element name="release" type="version"/>
    <xs:element name="api" type="version"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="license">
  <xs:complexType>
   <xs:simpleContent>
    <xs:extension base="xs:string">
     <xs:attribute name="uri" type="xs:anyURI"/>
     <xs:attribute name="filesource" type="xs:string"/>
    </xs:extension>
   </xs:simpleContent>
  </xs:complexType>
 </xs:element>
 <xs:element name="stability">
  <xs:complexType>
   <xs:sequence>
    <xs:element name="release">
     <xs:simpleType>
      <xs:restriction base="xs:string">
       <xs:enumeration value="snapshot"/>
       <xs:enumeration value="devel"/>
       <xs:enumeration value="alpha"/>
       <xs:enumeration value="beta"/>
       <xs:enumeration value="stable"/>
      </xs:restriction>
     </xs:simpleType>
    </xs:element>
    <xs:element name="api">
     <xs:simpleType>
      <xs:restriction base="xs:string">
       <xs:enumeration value="devel"/>
       <xs:enumeration value="alpha"/>
       <xs:enumeration value="beta"/>
       <xs:enumeration value="stable"/>
      </xs:restriction>
     </xs:simpleType>
    </xs:element>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="notes" type="xs:string"/>
 <xs:element name="contents">
  <xs:complexType>
   <xs:choice>
    <xs:element ref="dir" maxOccurs="unbounded"/>
    <xs:element ref="bundledpackage" maxOccurs="unbounded"/>
   </xs:choice>
  </xs:complexType>
 </xs:element>
 <xs:element name="dir">
  <xs:complexType>
   <xs:choice>
    <xs:sequence maxOccurs="unbounded">
     <xs:element ref="dir" maxOccurs="unbounded"/>
     <xs:element ref="file" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
    <xs:sequence maxOccurs="unbounded">
     <xs:element ref="file" maxOccurs="unbounded"/>
     <xs:element ref="dir" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
   </xs:choice>
   <xs:attribute name="baseinstalldir" type="xs:string"/>
   <xs:attribute name="name" type="xs:string" use="required"/>
  </xs:complexType>
 </xs:element>
 <xs:element name="file">
  <xs:complexType>
   <xs:choice>
    <xs:any namespace="http://pear.php.net/dtd/tasks-1.0" processContents="lax" minOccurs="0" maxOccurs="unbounded"/>
   </xs:choice>
   <xs:attribute name="name" type="xs:string" use="required"/>
   <xs:attribute name="role" type="xs:string" use="required"/>
   <xs:attribute name="baseinstalldir" type="xs:string"/>
   <xs:attribute name="md5sum" type="xs:string"/>
  </xs:complexType>
 </xs:element>
 <xs:element name="install">
  <xs:complexType>
   <xs:attribute name="name" type="xs:string" use="required"/>
   <xs:attribute name="as" type="xs:string" use="required"/>
  </xs:complexType>
 </xs:element>
 <xs:element name="ignore">
  <xs:complexType>
   <xs:attribute name="name" type="xs:string"/>
  </xs:complexType>
 </xs:element>
 <xs:element name="phprelease">
  <xs:annotation>
   <xs:documentation>for php script releases</xs:documentation>
  </xs:annotation>
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="installconditions" minOccurs="0"/>
    <xs:element ref="filelist" minOccurs="0"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="extsrcrelease">
  <xs:annotation>
   <xs:documentation>for extension source releases</xs:documentation>
  </xs:annotation>
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="installconditions" minOccurs="0"/>
    <xs:element ref="configureoption" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element name="binarypackage" type="xs:string" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="filelist" minOccurs="0"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="extbinrelease">
  <xs:annotation>
   <xs:documentation>for compiled extension source releases</xs:documentation>
  </xs:annotation>
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="installconditions" minOccurs="0"/>
    <xs:element ref="filelist" minOccurs="0"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="bundle">
  <xs:annotation>
   <xs:documentation>for bundling several releases together in one release</xs:documentation>
  </xs:annotation>
  <xs:complexType/>
 </xs:element>
 <xs:element name="filelist">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="install" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="ignore" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="dependencies">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="required"/>
    <xs:element ref="optional" minOccurs="0"/>
    <xs:element ref="group" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="nodefault">
  <xs:annotation>
   <xs:documentation>tells the installer not to install the default dependency group</xs:documentation>
  </xs:annotation>
 </xs:element>
 <xs:element name="required">
  <xs:annotation>
   <xs:documentation>absolute required dependencies</xs:documentation>
  </xs:annotation>
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="php"/>
    <xs:element ref="pearinstaller"/>
    <xs:element name="package" minOccurs="0" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:element ref="name"/>
       <xs:choice>
        <xs:sequence>
         <xs:element ref="channel"/>
         <xs:element ref="min" minOccurs="0"/>
         <xs:element ref="max" minOccurs="0"/>
         <xs:element ref="recommended" minOccurs="0"/>
         <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
         <xs:element ref="nodefault" minOccurs="0"/>
        </xs:sequence>
        <xs:element ref="uri"/>
       </xs:choice>
       <xs:element ref="conflicts" minOccurs="0"/>
       <xs:element ref="providesextension" minOccurs="0" maxOccurs="unbounded"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
    <xs:element name="subpackage" minOccurs="0" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:element ref="name"/>
       <xs:choice>
        <xs:sequence>
         <xs:element ref="channel"/>
         <xs:element ref="min" minOccurs="0"/>
         <xs:element ref="max" minOccurs="0"/>
         <xs:element ref="recommended" minOccurs="0"/>
         <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
         <xs:element ref="nodefault" minOccurs="0"/>
        </xs:sequence>
        <xs:element ref="uri"/>
       </xs:choice>
       <xs:element ref="conflicts" minOccurs="0"/>
       <xs:element ref="providesextension" minOccurs="0" maxOccurs="unbounded"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
    <xs:element ref="extension" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="os" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="arch" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="group">
  <xs:annotation>
   <xs:documentation>all other optional dependency groups</xs:documentation>
  </xs:annotation>
  <xs:complexType>
   <xs:sequence>
    <xs:element name="package" minOccurs="0" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:element ref="name"/>
       <xs:choice>
        <xs:sequence>
         <xs:element ref="channel"/>
         <xs:element ref="min" minOccurs="0"/>
         <xs:element ref="max" minOccurs="0"/>
         <xs:element ref="recommended" minOccurs="0"/>
         <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
         <xs:element ref="nodefault" minOccurs="0"/>
        </xs:sequence>
        <xs:element ref="uri"/>
       </xs:choice>
       <xs:element ref="providesextension" minOccurs="0" maxOccurs="unbounded"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
    <xs:element name="subpackage" minOccurs="0" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:element ref="name"/>
       <xs:choice>
        <xs:sequence>
         <xs:element ref="channel"/>
         <xs:element ref="min" minOccurs="0"/>
         <xs:element ref="max" minOccurs="0"/>
         <xs:element ref="recommended" minOccurs="0"/>
         <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
         <xs:element ref="nodefault" minOccurs="0"/>
        </xs:sequence>
        <xs:element ref="uri"/>
       </xs:choice>
       <xs:element ref="providesextension" minOccurs="0" maxOccurs="unbounded"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
    <xs:element ref="extension" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
   <xs:attribute name="name" type="xs:string" use="required"/>
   <xs:attribute name="hint" type="xs:string" use="required"/>
  </xs:complexType>
 </xs:element>
 <xs:element name="optional">
  <xs:annotation>
   <xs:documentation>simple optional dependencies</xs:documentation>
  </xs:annotation>
  <xs:complexType>
   <xs:sequence>
    <xs:element name="package" minOccurs="0" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:element ref="name"/>
       <xs:choice>
        <xs:sequence>
         <xs:element ref="channel"/>
         <xs:element ref="min" minOccurs="0"/>
         <xs:element ref="max" minOccurs="0"/>
         <xs:element ref="recommended" minOccurs="0"/>
         <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
         <xs:element ref="nodefault" minOccurs="0"/>
        </xs:sequence>
        <xs:element ref="uri"/>
       </xs:choice>
       <xs:element ref="providesextension" minOccurs="0" maxOccurs="unbounded"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
    <xs:element name="subpackage" minOccurs="0" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:element ref="name"/>
       <xs:choice>
        <xs:sequence>
         <xs:element ref="channel"/>
         <xs:element ref="min" minOccurs="0"/>
         <xs:element ref="max" minOccurs="0"/>
         <xs:element ref="recommended" minOccurs="0"/>
         <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
         <xs:element ref="nodefault" minOccurs="0"/>
        </xs:sequence>
        <xs:element ref="uri"/>
       </xs:choice>
       <xs:element ref="conflicts" minOccurs="0"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
    <xs:element ref="extension" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="changelog">
  <xs:complexType>
   <xs:sequence>
    <xs:element name="release" minOccurs="1" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:choice>
        <xs:sequence>
         <xs:element ref="date"/>
         <xs:element ref="time" minOccurs="0" maxOccurs="1"/>
         <xs:element ref="lead" minOccurs="0" maxOccurs="unbounded"/>
         <xs:element ref="developer" minOccurs="0" maxOccurs="unbounded"/>
         <xs:choice>
          <xs:sequence>
           <xs:element name="version">
            <xs:complexType>
             <xs:sequence>
              <xs:element name="release" type="xs:string"/>
              <xs:element name="api" type="xs:string"/>
             </xs:sequence>
            </xs:complexType>
           </xs:element>
           <xs:element ref="stability"/>
          </xs:sequence>
          <xs:sequence>
           <xs:element ref="stability"/>
           <xs:element name="version">
            <xs:complexType>
             <xs:sequence>
              <xs:element name="release" type="xs:string"/>
              <xs:element name="api" type="xs:string"/>
             </xs:sequence>
            </xs:complexType>
           </xs:element>
          </xs:sequence>
         </xs:choice>
         <xs:element ref="license" minOccurs="0" maxOccurs="1"/>
        </xs:sequence>
        <xs:sequence>
         <xs:element ref="lead" minOccurs="0" maxOccurs="unbounded"/>
         <xs:element ref="developer" minOccurs="0" maxOccurs="unbounded"/>
         <xs:choice>
          <xs:sequence>
           <xs:element name="version">
            <xs:complexType>
             <xs:sequence>
              <xs:element name="release" type="xs:string"/>
              <xs:element name="api" type="xs:string"/>
             </xs:sequence>
            </xs:complexType>
           </xs:element>
           <xs:element ref="stability"/>
          </xs:sequence>
          <xs:sequence>
           <xs:element ref="stability"/>
           <xs:element name="version">
            <xs:complexType>
             <xs:sequence>
              <xs:element name="release" type="xs:string"/>
              <xs:element name="api" type="xs:string"/>
             </xs:sequence>
            </xs:complexType>
           </xs:element>
          </xs:sequence>
         </xs:choice>
         <xs:element ref="license" minOccurs="0" maxOccurs="1"/>
         <xs:element ref="date"/>
         <xs:element ref="time" minOccurs="0" maxOccurs="1"/>
         <xs:element ref="license" minOccurs="0" maxOccurs="1"/>
        </xs:sequence>
       </xs:choice>
       <xs:element ref="notes"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:simpleType name="version">
  <xs:annotation>
   <xs:documentation>version string regex</xs:documentation>
  </xs:annotation>
  <xs:restriction base="xs:string">
   <xs:pattern value="[0-9]+(\.[0-9]+)*([a-zA-Z]+[0-9]*)?"/>
  </xs:restriction>
 </xs:simpleType>
 <xs:element name="extension">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="name"/>
    <xs:element ref="min" minOccurs="0"/>
    <xs:element ref="max" minOccurs="0"/>
    <xs:element ref="recommended" minOccurs="0"/>
    <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="conflicts" minOccurs="0"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="pearinstaller">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="min"/>
    <xs:element ref="max" minOccurs="0"/>
    <xs:element ref="recommended" minOccurs="0"/>
    <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="php">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="min"/>
    <xs:element ref="max" minOccurs="0"/>
    <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="installconditions">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="php" minOccurs="0"/>
    <xs:element ref="extension" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="os" minOccurs="0"/>
    <xs:element ref="arch" minOccurs="0"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="exclude" type="version"/>
 <xs:element name="configureoption">
  <xs:complexType>
   <xs:attribute name="name" type="xs:string" use="required"/>
   <xs:attribute name="default" type="xs:string"/>
   <xs:attribute name="prompt" type="xs:string" use="required"/>
  </xs:complexType>
 </xs:element>
 <xs:element name="arch">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="pattern"/>
    <xs:element ref="conflicts" minOccurs="0"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="extends" type="xs:string"/>
 <xs:element name="time" type="xs:time"/>
 <xs:element name="compatible">
  <xs:complexType>
   <xs:sequence>
    <xs:element name="name"/>
    <xs:element name="channel"/>
    <xs:element ref="min"/>
    <xs:element ref="max"/>
    <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="min" type="version"/>
 <xs:element name="max" type="version"/>
 <xs:element name="user" type="xs:string"/>
 <xs:element name="email" type="xs:string"/>
 <xs:element name="active">
  <xs:simpleType>
   <xs:restriction base="xs:string">
    <xs:enumeration value="yes"/>
    <xs:enumeration value="no"/>
   </xs:restriction>
  </xs:simpleType>
 </xs:element>
 <xs:element name="recommended" type="version"/>
 <xs:element name="channel">
  <xs:simpleType>
   <xs:restriction base="xs:string">
    <xs:pattern value="[A-Za-z][a-zA-Z0-9_.]+"/>
   </xs:restriction>
  </xs:simpleType>
 </xs:element>
 <xs:element name="uri" type="xs:anyURI"/>
 <xs:element name="pattern" type="xs:string"/>
 <xs:element name="conflicts"/>
 <xs:element name="os">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="name"/>
    <xs:element ref="conflicts" minOccurs="0"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="srcpackage" type="xs:string">
  <xs:annotation>
   <xs:documentation>name of the package that contains the source of this extension (can be the same if the source and binaries are in the same package)</xs:documentation>
  </xs:annotation>
 </xs:element>
 <xs:element name="srcchannel" type="xs:string"/>
 <xs:element name="bundledpackage" type="xs:string"/>
 <xs:element name="filename" type="xs:string"/>
 <xs:element name="providesextension" type="xs:string">
  <xs:annotation>
   <xs:documentation>if a package can provide one or more compatible extensions (dblib/sybase/mssql for instance)</xs:documentation>
  </xs:annotation>
 </xs:element>
 <xs:element name="usesrole">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="role"/>
    <xs:choice>
     <xs:sequence>
      <xs:element name="package" type="xs:string"/>
      <xs:element ref="channel"/>
     </xs:sequence>
     <xs:element ref="uri"/>
    </xs:choice>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="usestask">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="task"/>
    <xs:choice>
     <xs:sequence>
      <xs:element name="package" type="xs:string"/>
      <xs:element ref="channel"/>
     </xs:sequence>
     <xs:element ref="uri"/>
    </xs:choice>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="role" type="xs:string"/>
 <xs:element name="task" type="xs:string"/>
</xs:schema>
<?xml version="1.0" encoding="ISO-8859-1"?>
<channel version="1.0" xmlns="http://pear.php.net/channel-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/channel-1.0
http://pear.php.net/dtd/channel-1.0.xsd">
 <name>__uri</name>
 <suggestedalias>__uri</suggestedalias>
 <summary>Pseudo-channel for static packages</summary>
 <servers>
  <primary>
   <xmlrpc>
    <function version="1.0">****</function>
   </xmlrpc>
  </primary>
 </servers>
</channel><?xml version="1.0" encoding="ISO-8859-1"?>
<channel version="1.0" xmlns="http://pear.php.net/channel-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/channel-1.0
http://pear.php.net/dtd/channel-1.0.xsd">
 <name>pecl.php.net</name>
 <suggestedalias>pecl</suggestedalias>
 <summary>PHP Extension Community Library</summary>
 <validatepackage version="1.0">PEAR_Validator_PECL</validatepackage>
 <servers>
  <primary>

   <xmlrpc>
    <function version="1.0">logintest</function>
    <function version="1.0">package.listLatestReleases</function>
    <function version="1.0">package.listAll</function>
    <function version="1.0">package.info</function>
    <function version="1.0">package.getDownloadURL</function>

    <function version="1.0">package.getDepDownloadURL</function>
    <function version="1.0">package.search</function>
    <function version="1.0">channel.listAll</function>
   </xmlrpc>
   <rest>
    <baseurl type="REST1.0">http://pecl.php.net/rest/</baseurl>
    <baseurl type="REST1.1">http://pecl.php.net/rest/</baseurl>

   </rest>
  </primary>
 </servers>
</channel><?xml version="1.0" encoding="ISO-8859-1"?>
<channel version="1.0" xmlns="http://pear.php.net/channel-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/channel-1.0
http://pear.php.net/dtd/channel-1.0.xsd">
 <name>pear.php.net</name>
 <suggestedalias>pear</suggestedalias>
 <summary>PHP Extension and Application Repository</summary>
 <servers>
  <primary>
   <rest>

    <baseurl type="REST1.0">http://pear.php.net/rest/</baseurl>
    <baseurl type="REST1.1">http://pear.php.net/rest/</baseurl>
    <baseurl type="REST1.2">http://pear.php.net/rest/</baseurl>
    <baseurl type="REST1.3">http://pear.php.net/rest/</baseurl>
   </rest>
  </primary>
  <mirror host="us.pear.php.net">

   <rest>
    <baseurl type="REST1.0">http://us.pear.php.net/rest/</baseurl>
    <baseurl type="REST1.1">http://us.pear.php.net/rest/</baseurl>
    <baseurl type="REST1.2">http://us.pear.php.net/rest/</baseurl>
    <baseurl type="REST1.3">http://us.pear.php.net/rest/</baseurl>
   </rest>
  </mirror>

  <mirror host="de.pear.php.net" ssl="yes" port="3452">
   <rest>
    <baseurl type="REST1.0">https://de.pear.php.net:3452/rest/</baseurl>
    <baseurl type="REST1.1">https://de.pear.php.net:3452/rest/</baseurl>
    <baseurl type="REST1.2">https://de.pear.php.net:3452/rest/</baseurl>
    <baseurl type="REST1.3">https://de.pear.php.net:3452/rest/</baseurl>
   </rest>

  </mirror>
 </servers>
</channel><?xml version="1.0" encoding="ISO-8859-1"?>
<channel version="1.0" xmlns="http://pear.php.net/channel-1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pear.php.net/channel-1.0
http://pear.php.net/dtd/channel-1.0.xsd">
 <name>pear2.php.net</name>
 <suggestedalias>pear2</suggestedalias>
 <summary>PEAR packages for PHP 5.3+ installed by Pyrus</summary>
 <servers>
  <primary>
   <rest>

    <baseurl type="REST1.0">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.1">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.2">http://pear2.php.net/rest/</baseurl>
    <baseurl type="REST1.3">http://pear2.php.net/rest/</baseurl>
   </rest>
  </primary>
 </servers>
</channel><?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="http://pear2.php.net/dtd/customcomand-2.0"
 targetNamespace="http://pear2.php.net/dtd/customcommand-2.0" elementFormDefault="qualified"
 attributeFormDefault="unqualified" xml:lang="EN">
 <xs:element name="commands">
  <xs:complexType>
   <xs:sequence>
    <xs:element name="command" minOccurs="1" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:element name="name" type="xs:string"/>
       <xs:element name="class" type="xs:string">
        <xs:annotation>
         <xs:documentation xml:lang="EN">
          Class implementing command name
         </xs:documentation>
        </xs:annotation>
       </xs:element>
       <xs:element name="function" type="xs:string"/>
       <xs:element name="autoloadpath" type="xs:string" minOccurs="0" maxOccurs="1">
        <xs:annotation>
         <xs:documentation xml:lang="EN">
          Relative path within php_dir to search for this role's classes in the autoloader.
          If not present, no additional autoloader is added to the autoloader chain.
         </xs:documentation>
        </xs:annotation>
       </xs:element>
       <xs:element name="summary" type="xs:string"/>
       <xs:element name="shortcut" type="xs:string"/>
 <xs:element name="options">
  <xs:complexType>
   <xs:sequence>
    <xs:element name="option" minOccurs="0" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:element name="name" type="xs:string"/>
       <xs:element name="shortopt" type="xs:string" minOccurs="0"/>
       <xs:element name="type">
        <xs:complexType>
         <xs:choice>
          <xs:element name="bool"/>
          <xs:element name="string"/>
          <xs:element name="int"/>
          <xs:element name="float"/>
          <xs:element name="counter"/>
          <xs:element name="callback">
           <xs:annotation>
            <xs:documentation>
             function within the command class that will handle the argument callback.
             Arguments: command name, option name
             Return: value to set the option result to
            </xs:documentation>
           </xs:annotation>
           <xs:simpleType>
            <xs:restriction base="xs:string"/>
           </xs:simpleType>
          </xs:element>
          <xs:element name="set">
           <xs:complexType>
            <xs:sequence>
             <xs:element name="value" type="xs:string" minOccurs="1" maxOccurs="unbounded"/>
            </xs:sequence>
           </xs:complexType>
          </xs:element>
         </xs:choice>
        </xs:complexType>
       </xs:element>
       <xs:element name="default" type="xs:string" minOccurs="0"/>
       <xs:element name="doc" type="xs:string"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
   </xs:sequence>
  </xs:complexType> 
 </xs:element>
 <xs:element name="arguments">
  <xs:complexType>
   <xs:sequence>
    <xs:element name="argument" minOccurs="0" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:element name="name" type="xs:string"/>
       <xs:element name="multiple" type="xs:boolean"/>
       <xs:element name="optional" type="xs:boolean"/>
       <xs:element name="doc" type="xs:string"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
   </xs:sequence>
  </xs:complexType> 
 </xs:element>
       <xs:element name="doc" type="xs:string"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
   </xs:sequence>
   <xs:attribute name="version" type="xs:string" fixed="2.0"/>
  </xs:complexType>
 </xs:element>
</xs:schema>
<?xml version="1.0"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:ch="http://pear.php.net/channel-1.0" targetNamespace="http://pear.php.net/channel-1.0" elementFormDefault="qualified">
 <xs:complexType name="function">
  <xs:simpleContent>
   <xs:extension base="xs:string">
    <xs:attribute name="version" use="required">
     <xs:simpleType>
      <xs:restriction base="xs:string">
       <xs:pattern value="[0-9]+\.[0-9]+"/>
      </xs:restriction>
     </xs:simpleType>
    </xs:attribute>
   </xs:extension>
  </xs:simpleContent>
 </xs:complexType>
 <xs:complexType name="functions">
  <xs:sequence>
   <xs:element name="function" type="ch:function" maxOccurs="unbounded"/>
  </xs:sequence>
 </xs:complexType>
 <xs:complexType name="serverinternals">
  <xs:sequence>
   <xs:element name="xmlrpc" minOccurs="0">
    <xs:complexType>
     <xs:complexContent>
      <xs:extension base="ch:functions">
       <xs:attribute name="path" type="xs:string"/>
      </xs:extension>
     </xs:complexContent>
    </xs:complexType>
   </xs:element>
   <xs:element name="rest" minOccurs="0">
    <xs:complexType>
     <xs:sequence>
      <xs:element name="baseurl" maxOccurs="unbounded">
       <xs:complexType>
        <xs:simpleContent>
         <xs:extension base="xs:string">
          <xs:attribute name="type" type="xs:string" use="required"/>
         </xs:extension>
        </xs:simpleContent>
       </xs:complexType>
      </xs:element>
     </xs:sequence>
    </xs:complexType>
   </xs:element>
   <xs:element name="soap" minOccurs="0">
    <xs:complexType>
     <xs:complexContent>
      <xs:extension base="ch:functions">
       <xs:attribute name="path" type="xs:string"/>
      </xs:extension>
     </xs:complexContent>
    </xs:complexType>
   </xs:element>
  </xs:sequence>
  <xs:attribute name="port" type="xs:int" default="80"/>
  <xs:attribute name="ssl">
   <xs:simpleType>
    <xs:restriction base="xs:string">
     <xs:enumeration value="yes"/>
    </xs:restriction>
   </xs:simpleType>
  </xs:attribute>
 </xs:complexType>
 <xs:complexType name="mirrorinternals">
  <xs:sequence>
   <xs:element name="xmlrpc" minOccurs="0">
    <xs:complexType>
     <xs:complexContent>
      <xs:extension base="ch:functions">
       <xs:attribute name="path" type="xs:string"/>
      </xs:extension>
     </xs:complexContent>
    </xs:complexType>
   </xs:element>
   <xs:element name="rest" minOccurs="0">
    <xs:complexType>
     <xs:sequence>
      <xs:element name="baseurl" maxOccurs="unbounded">
       <xs:complexType>
        <xs:simpleContent>
         <xs:extension base="xs:string">
          <xs:attribute name="type" type="xs:string" use="required"/>
         </xs:extension>
        </xs:simpleContent>
       </xs:complexType>
      </xs:element>
     </xs:sequence>
    </xs:complexType>
   </xs:element>
   <xs:element name="soap" minOccurs="0">
    <xs:complexType>
     <xs:complexContent>
      <xs:extension base="ch:functions">
       <xs:attribute name="path" type="xs:string"/>
      </xs:extension>
     </xs:complexContent>
    </xs:complexType>
   </xs:element>
  </xs:sequence>
  <xs:attribute name="port" type="xs:int" default="80"/>
  <xs:attribute name="host" use="required"/>
  <xs:attribute name="ssl">
   <xs:simpleType>
    <xs:restriction base="xs:string">
     <xs:enumeration value="yes"/>
    </xs:restriction>
   </xs:simpleType>
  </xs:attribute>
 </xs:complexType>
 <xs:complexType name="server">
  <xs:sequence>
   <xs:element name="primary">
    <xs:complexType>
     <xs:complexContent>
      <xs:extension base="ch:serverinternals"/>
     </xs:complexContent>
    </xs:complexType>
   </xs:element>
   <xs:element name="mirror" type="ch:mirrorinternals" minOccurs="0" maxOccurs="unbounded"/>
  </xs:sequence>
 </xs:complexType>
 <xs:complexType name="validatepackage">
  <xs:simpleContent>
   <xs:extension base="xs:string">
    <xs:attribute name="version"/>
   </xs:extension>
  </xs:simpleContent>
 </xs:complexType>
 <xs:simpleType name="channelname">
  <xs:restriction base="xs:string">
   <xs:pattern value="[A-Za-z][a-zA-Z0-9_.]+|__uri"/>
  </xs:restriction>
 </xs:simpleType>
 <xs:element name="channel">
  <xs:complexType>
   <xs:sequence>
     <xs:element name="name" type="ch:channelname"/>
    <xs:choice>
     <xs:sequence minOccurs="1" maxOccurs="1">
      <xs:element name="suggestedalias" type="ch:channelname"/>
      <xs:element name="summary" type="xs:string"/>
     </xs:sequence>
     <xs:sequence minOccurs="1" maxOccurs="1">
      <xs:element name="summary" type="xs:string"/>
      <xs:element name="suggestedalias" minOccurs="0" type="ch:channelname"/>
     </xs:sequence>
    </xs:choice>
    <xs:element name="validatepackage" minOccurs="0">
     <xs:complexType>
      <xs:simpleContent>
       <xs:restriction base="ch:validatepackage">
        <xs:pattern value="[A-Za-z][a-zA-Z0-9_]+"/>
       </xs:restriction>
      </xs:simpleContent>
     </xs:complexType>
    </xs:element>
    <xs:element name="servers" type="ch:server"/>
   </xs:sequence>
   <xs:attribute name="version" use="required">
    <xs:simpleType>
     <xs:restriction base="xs:string">
      <xs:pattern value="[0-9]+\.[0-9]+"/>
     </xs:restriction>
    </xs:simpleType>
   </xs:attribute>
  </xs:complexType>
 </xs:element>
</xs:schema>
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="http://pear.php.net/dtd/package-2.1" xmlns:tasks="http://pear.php.net/dtd/tasks-1.0" targetNamespace="http://pear.php.net/dtd/package-2.1" elementFormDefault="qualified" attributeFormDefault="unqualified" xml:lang="EN">
 <xs:element name="package">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="name"/>
    <xs:choice>
     <xs:element ref="channel"/>
     <xs:element ref="uri"/>
    </xs:choice>
    <xs:element ref="extends" minOccurs="0"/>
    <xs:element ref="summary"/>
    <xs:element ref="description"/>
    <xs:choice>
     <xs:sequence>
      <xs:element ref="lead" maxOccurs="unbounded"/>
      <xs:element ref="developer" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element ref="contributor" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element ref="helper" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element ref="date"/>
      <xs:element ref="time" minOccurs="0"/>
     </xs:sequence>
     <xs:sequence>
      <xs:element ref="date"/>
      <xs:element ref="time" minOccurs="0"/>
      <xs:element ref="lead" maxOccurs="unbounded"/>
      <xs:element ref="developer" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element ref="contributor" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element ref="helper" minOccurs="0" maxOccurs="unbounded"/>
     </xs:sequence>
    </xs:choice>
    <xs:element ref="version"/>
    <xs:element ref="stability"/>
    <xs:element ref="license"/>
    <xs:element ref="notes"/>
    <xs:element ref="contents"/>
    <xs:element ref="compatible" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="dependencies"/>
    <xs:element ref="providesextension" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="usesrole" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="usestask" minOccurs="0" maxOccurs="unbounded"/>
    <xs:choice minOccurs="0">
     <xs:sequence>
      <xs:element ref="srcpackage"/>
      <xs:element ref="srcchannel"/>
     </xs:sequence>
     <xs:element name="srcuri" type="xs:anyURI">
      <xs:annotation>
       <xs:documentation>uri of the package that contains the source of this extension</xs:documentation>
      </xs:annotation>
     </xs:element>
    </xs:choice>
    <xs:choice>
     <xs:element ref="phprelease" maxOccurs="unbounded"/>
     <xs:element ref="extsrcrelease" maxOccurs="unbounded"/>
     <xs:element ref="extbinrelease" maxOccurs="unbounded"/>
     <xs:element ref="bundle"/>
     <xs:element ref="zendextsrcrelease" maxOccurs="unbounded"/>
     <xs:element ref="zendextbinrelease" maxOccurs="unbounded"/>
    </xs:choice>
    <xs:element ref="changelog" minOccurs="0"/>
   </xs:sequence>
   <xs:attribute name="version" type="xs:string" fixed="2.1"/>
   <xs:attribute name="packagerversion" type="version"/>
  </xs:complexType>
 </xs:element>
 <xs:element name="name" type="xs:string">
  <xs:annotation>
   <xs:documentation>this is ignored if the release type is bundle</xs:documentation>
  </xs:annotation>
 </xs:element>
 <xs:element name="summary" type="xs:string"/>
 <xs:element name="description" type="xs:string"/>
 <xs:element name="lead">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="name"/>
    <xs:element ref="user"/>
    <xs:element ref="email"/>
    <xs:element ref="active"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="developer">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="name"/>
    <xs:element ref="user"/>
    <xs:element ref="email"/>
    <xs:element ref="active"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="contributor">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="name"/>
    <xs:element ref="user"/>
    <xs:element ref="email"/>
    <xs:element ref="active"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="helper">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="name"/>
    <xs:element ref="user"/>
    <xs:element ref="email"/>
    <xs:element ref="active"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="date" type="xs:date"/>
 <xs:element name="version">
  <xs:complexType>
   <xs:sequence>
    <xs:element name="release" type="version"/>
    <xs:element name="api" type="version"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="license">
  <xs:complexType>
   <xs:simpleContent>
    <xs:extension base="xs:string">
     <xs:attribute name="uri" type="xs:anyURI"/>
     <xs:attribute name="filesource" type="xs:string"/>
    </xs:extension>
   </xs:simpleContent>
  </xs:complexType>
 </xs:element>
 <xs:element name="stability">
  <xs:complexType>
   <xs:sequence>
    <xs:element name="release">
     <xs:simpleType>
      <xs:restriction base="xs:string">
       <xs:enumeration value="snapshot"/>
       <xs:enumeration value="devel"/>
       <xs:enumeration value="alpha"/>
       <xs:enumeration value="beta"/>
       <xs:enumeration value="stable"/>
      </xs:restriction>
     </xs:simpleType>
    </xs:element>
    <xs:element name="api">
     <xs:simpleType>
      <xs:restriction base="xs:string">
       <xs:enumeration value="devel"/>
       <xs:enumeration value="alpha"/>
       <xs:enumeration value="beta"/>
       <xs:enumeration value="stable"/>
      </xs:restriction>
     </xs:simpleType>
    </xs:element>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="notes" type="xs:string"/>
 <xs:element name="contents">
  <xs:complexType>
   <xs:choice>
    <xs:element ref="dir" maxOccurs="unbounded"/>
    <xs:element ref="bundledpackage" maxOccurs="unbounded"/>
   </xs:choice>
  </xs:complexType>
 </xs:element>
 <xs:element name="dir">
  <xs:complexType>
   <xs:choice>
    <xs:sequence maxOccurs="unbounded">
     <xs:element ref="dir" maxOccurs="unbounded"/>
     <xs:element ref="file" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
    <xs:sequence maxOccurs="unbounded">
     <xs:element ref="file" maxOccurs="unbounded"/>
     <xs:element ref="dir" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
   </xs:choice>
   <xs:attribute name="baseinstalldir" type="xs:string"/>
   <xs:attribute name="name" type="xs:string" use="required"/>
  </xs:complexType>
 </xs:element>
 <xs:element name="file">
  <xs:complexType>
   <xs:choice>
    <xs:any namespace="http://pear.php.net/dtd/tasks-1.0" processContents="lax" minOccurs="0" maxOccurs="unbounded"/>
   </xs:choice>
   <xs:attribute name="name" type="xs:string" use="required"/>
   <xs:attribute name="role" type="xs:string" use="required"/>
   <xs:attribute name="baseinstalldir" type="xs:string"/>
   <xs:attribute name="md5sum" type="xs:string"/>
  </xs:complexType>
 </xs:element>
 <xs:element name="install">
  <xs:complexType>
   <xs:attribute name="name" type="xs:string" use="required"/>
   <xs:attribute name="as" type="xs:string" use="required"/>
  </xs:complexType>
 </xs:element>
 <xs:element name="ignore">
  <xs:complexType>
   <xs:attribute name="name" type="xs:string"/>
  </xs:complexType>
 </xs:element>
 <xs:element name="phprelease">
  <xs:annotation>
   <xs:documentation>for php script releases</xs:documentation>
  </xs:annotation>
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="installconditions" minOccurs="0"/>
    <xs:element ref="filelist" minOccurs="0"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="extsrcrelease">
  <xs:annotation>
   <xs:documentation>for extension source releases</xs:documentation>
  </xs:annotation>
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="installconditions" minOccurs="0"/>
    <xs:element ref="configureoption" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element name="binarypackage" type="xs:string" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="filelist" minOccurs="0"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="zendextsrcrelease">
  <xs:annotation>
   <xs:documentation>for zend extension source releases</xs:documentation>
  </xs:annotation>
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="installconditions" minOccurs="0"/>
    <xs:element ref="configureoption" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element name="binarypackage" type="xs:string" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="filelist" minOccurs="0"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="extbinrelease">
  <xs:annotation>
   <xs:documentation>for compiled extension source releases</xs:documentation>
  </xs:annotation>
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="installconditions" minOccurs="0"/>
    <xs:element ref="filelist" minOccurs="0"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="zendextbinrelease">
  <xs:annotation>
   <xs:documentation>for compiled zend extension source releases</xs:documentation>
  </xs:annotation>
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="installconditions" minOccurs="0"/>
    <xs:element ref="filelist" minOccurs="0"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="bundle">
  <xs:annotation>
   <xs:documentation>for bundling several releases together in one release</xs:documentation>
  </xs:annotation>
  <xs:complexType/>
 </xs:element>
 <xs:element name="filelist">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="install" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="ignore" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="dependencies">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="required"/>
    <xs:element ref="optional" minOccurs="0"/>
    <xs:element ref="group" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="nodefault">
  <xs:annotation>
   <xs:documentation>tells the installer not to install the default dependency group</xs:documentation>
  </xs:annotation>
 </xs:element>
 <xs:element name="required">
  <xs:annotation>
   <xs:documentation>absolute required dependencies</xs:documentation>
  </xs:annotation>
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="php"/>
    <xs:element ref="pearinstaller"/>
    <xs:element name="package" minOccurs="0" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:element ref="name"/>
       <xs:choice>
        <xs:sequence>
         <xs:element ref="channel"/>
         <xs:element ref="min" minOccurs="0"/>
         <xs:element ref="max" minOccurs="0"/>
         <xs:element ref="recommended" minOccurs="0"/>
         <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
         <xs:element ref="nodefault" minOccurs="0"/>
        </xs:sequence>
        <xs:element ref="uri"/>
       </xs:choice>
       <xs:element ref="conflicts" minOccurs="0"/>
       <xs:element ref="providesextension" minOccurs="0" maxOccurs="unbounded"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
    <xs:element name="subpackage" minOccurs="0" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:element ref="name"/>
       <xs:choice>
        <xs:sequence>
         <xs:element ref="channel"/>
         <xs:element ref="min" minOccurs="0"/>
         <xs:element ref="max" minOccurs="0"/>
         <xs:element ref="recommended" minOccurs="0"/>
         <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
         <xs:element ref="nodefault" minOccurs="0"/>
        </xs:sequence>
        <xs:element ref="uri"/>
       </xs:choice>
       <xs:element ref="conflicts" minOccurs="0"/>
       <xs:element ref="providesextension" minOccurs="0" maxOccurs="unbounded"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
    <xs:element ref="extension" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="os" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="arch" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="group">
  <xs:annotation>
   <xs:documentation>all other optional dependency groups</xs:documentation>
  </xs:annotation>
  <xs:complexType>
   <xs:sequence>
    <xs:element name="package" minOccurs="0" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:element ref="name"/>
       <xs:choice>
        <xs:sequence>
         <xs:element ref="channel"/>
         <xs:element ref="min" minOccurs="0"/>
         <xs:element ref="max" minOccurs="0"/>
         <xs:element ref="recommended" minOccurs="0"/>
         <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
         <xs:element ref="nodefault" minOccurs="0"/>
        </xs:sequence>
        <xs:element ref="uri"/>
       </xs:choice>
       <xs:element ref="providesextension" minOccurs="0" maxOccurs="unbounded"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
    <xs:element name="subpackage" minOccurs="0" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:element ref="name"/>
       <xs:choice>
        <xs:sequence>
         <xs:element ref="channel"/>
         <xs:element ref="min" minOccurs="0"/>
         <xs:element ref="max" minOccurs="0"/>
         <xs:element ref="recommended" minOccurs="0"/>
         <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
         <xs:element ref="nodefault" minOccurs="0"/>
        </xs:sequence>
        <xs:element ref="uri"/>
       </xs:choice>
       <xs:element ref="conflicts" minOccurs="0"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
    <xs:element ref="extension" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
   <xs:attribute name="name" type="xs:string" use="required"/>
   <xs:attribute name="hint" type="xs:string" use="required"/>
  </xs:complexType>
 </xs:element>
 <xs:element name="optional">
  <xs:annotation>
   <xs:documentation>simple optional dependencies</xs:documentation>
  </xs:annotation>
  <xs:complexType>
   <xs:sequence>
    <xs:element name="package" minOccurs="0" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:element ref="name"/>
       <xs:choice>
        <xs:sequence>
         <xs:element ref="channel"/>
         <xs:element ref="min" minOccurs="0"/>
         <xs:element ref="max" minOccurs="0"/>
         <xs:element ref="recommended" minOccurs="0"/>
         <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
         <xs:element ref="nodefault" minOccurs="0"/>
        </xs:sequence>
        <xs:element ref="uri"/>
       </xs:choice>
       <xs:element ref="providesextension" minOccurs="0" maxOccurs="unbounded"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
    <xs:element name="subpackage" minOccurs="0" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:element ref="name"/>
       <xs:choice>
        <xs:sequence>
         <xs:element ref="channel"/>
         <xs:element ref="min" minOccurs="0"/>
         <xs:element ref="max" minOccurs="0"/>
         <xs:element ref="recommended" minOccurs="0"/>
         <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
         <xs:element ref="nodefault" minOccurs="0"/>
        </xs:sequence>
        <xs:element ref="uri"/>
       </xs:choice>
       <xs:element ref="providesextension" minOccurs="0" maxOccurs="unbounded"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
    <xs:element ref="extension" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="changelog">
  <xs:complexType>
   <xs:sequence>
    <xs:element name="release" minOccurs="1" maxOccurs="unbounded">
     <xs:complexType>
      <xs:sequence>
       <xs:choice>
        <xs:sequence>
         <xs:element ref="date"/>
         <xs:element ref="time" minOccurs="0" maxOccurs="1"/>
         <xs:element ref="lead" minOccurs="0" maxOccurs="unbounded"/>
         <xs:element ref="developer" minOccurs="0" maxOccurs="unbounded"/>
         <xs:choice>
          <xs:sequence>
           <xs:element name="version">
            <xs:complexType>
             <xs:sequence>
              <xs:element name="release" type="xs:string"/>
              <xs:element name="api" type="xs:string"/>
             </xs:sequence>
            </xs:complexType>
           </xs:element>
           <xs:element ref="stability"/>
          </xs:sequence>
          <xs:sequence>
           <xs:element ref="stability"/>
           <xs:element name="version">
            <xs:complexType>
             <xs:sequence>
              <xs:element name="release" type="xs:string"/>
              <xs:element name="api" type="xs:string"/>
             </xs:sequence>
            </xs:complexType>
           </xs:element>
          </xs:sequence>
         </xs:choice>
         <xs:element ref="license" minOccurs="0" maxOccurs="1"/>
        </xs:sequence>
        <xs:sequence>
         <xs:element ref="lead" minOccurs="0" maxOccurs="unbounded"/>
         <xs:element ref="developer" minOccurs="0" maxOccurs="unbounded"/>
         <xs:choice>
          <xs:sequence>
           <xs:element name="version">
            <xs:complexType>
             <xs:sequence>
              <xs:element name="release" type="xs:string"/>
              <xs:element name="api" type="xs:string"/>
             </xs:sequence>
            </xs:complexType>
           </xs:element>
           <xs:element ref="stability"/>
          </xs:sequence>
          <xs:sequence>
           <xs:element ref="stability"/>
           <xs:element name="version">
            <xs:complexType>
             <xs:sequence>
              <xs:element name="release" type="xs:string"/>
              <xs:element name="api" type="xs:string"/>
             </xs:sequence>
            </xs:complexType>
           </xs:element>
          </xs:sequence>
         </xs:choice>
         <xs:element ref="license" minOccurs="0" maxOccurs="1"/>
         <xs:element ref="date"/>
         <xs:element ref="time" minOccurs="0" maxOccurs="1"/>
         <xs:element ref="license" minOccurs="0" maxOccurs="1"/>
        </xs:sequence>
       </xs:choice>
       <xs:element ref="notes"/>
      </xs:sequence>
     </xs:complexType>
    </xs:element>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:simpleType name="version">
  <xs:annotation>
   <xs:documentation>version string regex</xs:documentation>
  </xs:annotation>
  <xs:restriction base="xs:string">
   <xs:pattern value="[0-9]+(\.[0-9]+)*([a-zA-Z]+[0-9]*)?"/>
  </xs:restriction>
 </xs:simpleType>
 <xs:element name="extension">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="name"/>
    <xs:element ref="min" minOccurs="0"/>
    <xs:element ref="max" minOccurs="0"/>
    <xs:element ref="recommended" minOccurs="0"/>
    <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="conflicts" minOccurs="0"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="pearinstaller">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="min"/>
    <xs:element ref="max" minOccurs="0"/>
    <xs:element ref="recommended" minOccurs="0"/>
    <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="php">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="min"/>
    <xs:element ref="max" minOccurs="0"/>
    <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="installconditions">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="php" minOccurs="0"/>
    <xs:element ref="extension" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element ref="os" minOccurs="0"/>
    <xs:element ref="arch" minOccurs="0"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="exclude" type="version"/>
 <xs:element name="configureoption">
  <xs:complexType>
   <xs:attribute name="name" type="xs:string" use="required"/>
   <xs:attribute name="default" type="xs:string"/>
   <xs:attribute name="prompt" type="xs:string" use="required"/>
  </xs:complexType>
 </xs:element>
 <xs:element name="arch">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="pattern"/>
    <xs:element ref="conflicts" minOccurs="0"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="extends" type="xs:string"/>
 <xs:element name="time" type="xs:time"/>
 <xs:element name="compatible">
  <xs:complexType>
   <xs:sequence>
    <xs:element name="name"/>
    <xs:element name="channel"/>
    <xs:element ref="min"/>
    <xs:element ref="max"/>
    <xs:element ref="exclude" minOccurs="0" maxOccurs="unbounded"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="min" type="version"/>
 <xs:element name="max" type="version"/>
 <xs:element name="user" type="xs:string"/>
 <xs:element name="email" type="xs:string"/>
 <xs:element name="active">
  <xs:simpleType>
   <xs:restriction base="xs:string">
    <xs:enumeration value="yes"/>
    <xs:enumeration value="no"/>
   </xs:restriction>
  </xs:simpleType>
 </xs:element>
 <xs:element name="recommended" type="version"/>
 <xs:element name="channel">
  <xs:simpleType>
   <xs:restriction base="xs:string">
    <xs:pattern value="[A-Za-z][a-zA-Z0-9_.]+"/>
   </xs:restriction>
  </xs:simpleType>
 </xs:element>
 <xs:element name="uri" type="xs:anyURI"/>
 <xs:element name="pattern" type="xs:string"/>
 <xs:element name="conflicts"/>
 <xs:element name="os">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="name"/>
    <xs:element ref="conflicts" minOccurs="0"/>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="srcpackage" type="xs:string">
  <xs:annotation>
   <xs:documentation>name of the package that contains the source of this extension (can be the same if the source and binaries are in the same package)</xs:documentation>
  </xs:annotation>
 </xs:element>
 <xs:element name="srcchannel" type="xs:string"/>
 <xs:element name="bundledpackage" type="xs:string"/>
 <xs:element name="filename" type="xs:string"/>
 <xs:element name="providesextension" type="xs:string">
  <xs:annotation>
   <xs:documentation>if a package can provide one or more compatible extensions (dblib/sybase/mssql for instance)</xs:documentation>
  </xs:annotation>
 </xs:element>
 <xs:element name="usesrole">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="role"/>
    <xs:choice>
     <xs:sequence>
      <xs:element name="package" type="xs:string"/>
      <xs:element ref="channel"/>
     </xs:sequence>
     <xs:element ref="uri"/>
    </xs:choice>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="usestask">
  <xs:complexType>
   <xs:sequence>
    <xs:element ref="task"/>
    <xs:choice>
     <xs:sequence>
      <xs:element name="package" type="xs:string"/>
      <xs:element ref="channel"/>
     </xs:sequence>
     <xs:element ref="uri"/>
    </xs:choice>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
 <xs:element name="role" type="xs:string"/>
 <xs:element name="task" type="xs:string"/>
</xs:schema>
<?php
function PEAR2_Autoload($class)
{
    if (substr($class, 0, 6) !== 'PEAR2_') {
        return false;
    }
    $fp = @fopen(str_replace('_', '/', $class) . '.php', 'r', true);
    if ($fp) {
        fclose($fp);
        require str_replace('_', '/', $class) . '.php';
        if (!class_exists($class, false) && !interface_exists($class, false)) {
            die(new Exception('Class ' . $class . ' was not present in ' .
                str_replace('_', '/', $class) . '.php (include_path="' . get_include_path() .
                '") [PEAR2_Autoload version 1.0]'));
        }
        return true;
    }
    $e = new Exception('Class ' . $class . ' could not be loaded from ' .
        str_replace('_', '/', $class) . '.php, file does not exist (include_path="' . get_include_path() .
        '") [PEAR2_Autoload version 1.0]');
    $trace = $e->getTrace();
    if (isset($trace[2]) && isset($trace[2]['function']) &&
          in_array($trace[2]['function'], array('class_exists', 'interface_exists'))) {
        return false;
    }
    if (isset($trace[1]) && isset($trace[1]['function']) &&
          in_array($trace[1]['function'], array('class_exists', 'interface_exists'))) {
        return false;
    }
    die ((string) $e);
}

// set up __autoload
if (function_exists('spl_autoload_register')) {
    if (!($_____t = spl_autoload_functions()) || !in_array('PEAR2_Autoload', spl_autoload_functions())) {
        spl_autoload_register('PEAR2_Autoload');
        if (function_exists('__autoload') && ($_____t === false)) {
            // __autoload() was being used, but now would be ignored, add
            // it to the autoload stack
            spl_autoload_register('__autoload');
        }
    }
    unset($_____t);
} elseif (!function_exists('__autoload')) {
    function __autoload($class) { return PEAR2_Autoload($class); }
}

// set up include_path if it doesn't register our current location
$____paths = explode(PATH_SEPARATOR, get_include_path());
$____found = false;
foreach ($____paths as $____path) {
    if ($____path == dirname(dirname(__FILE__))) {
        $____found = true;
        break;
    }
}
if (!$____found) {
    set_include_path(get_include_path() . PATH_SEPARATOR . dirname(dirname(__FILE__)));
}
unset($____paths);
unset($____path);
unset($____found);
<?php
/**
 * Multi-Error Error aggregator
 *
 * This class is designed to be extended for specific use.  It codifies easy
 * ways of aggregating error conditions that don't necessarily require an exception
 * to be thrown, but do need an easy way to retrieve them.
 * 
 * Usage:
 * 
 * <code>
 * $multi = new PEAR2_MultiErrors();
 * $multi->E_WARNING[] = new Exception('test');
 * $multi->E_ERROR[] = new Exception('test 2');
 * foreach ($multi as $error) {
 *     echo $error;
 * }
 * foreach ($multi->E_WARNING as $error) {
 *     echo $error;
 * }
 * foreach ($multi->E_ERROR as $error) {
 *     echo $error;
 * }
 * if (count($multi->E_ERROR)) {
 *     throw new PEAR2_Exception('Failure to do something', $multi);
 * }
 * </code>
 * @copyright 2007 Gregory Beaver
 * @package PEAR2_MultiErrors
 * @license http://www.php.net/license/3_0.txt PHP License
 */
class PEAR2_MultiErrors implements Iterator, Countable, ArrayAccess {

    private $_allowedLevels = array('E_NOTICE' => 0, 'E_WARNING' => 1, 'E_ERROR' => 2);
    /**
     * Errors are stored in the order that they are declared
     * @var array
     */
    private $_errors = array();

    /**
     * To allow $this->E_WARNING[] = new BlahException;
     *
     * @var int
     */
    private $_requestedLevel = false;

    /**
     * Internal PEAR2_MultiError objects for error levels
     * @var array
     */
    private $_subMulti = array();

    /**
     * Parent PEAR2_MultiErrors for an error level tracker
     *
     * @var PEAR2_MultiErrors
     */
    private $_parent;

    public function __construct($mylevel = false,
                                array $allowed = array('E_NOTICE', 'E_WARNING', 'E_ERROR'),
                                PEAR2_MultiErrors $parent = null)
    {
        foreach ($allowed as $level) {
            if (!is_string($level) || strpos($level, 'E_') !== 0) {
                throw new PEAR2_MultiErrors_Exception('Invalid level ' . (string) $level);
            }
        }
        $this->_allowedLevels = array_flip($allowed);
        $this->_requestedLevel = $mylevel;
        if ($mylevel) {
            $this->_parent = $parent;
        }
    }

    public function current()
    {
        return current($this->_errors);
    }

    public function key()
    {
        return key($this->_errors);
    }

    public function next()
    {
        return next($this->_errors);
    }

    public function rewind()
    {
        return reset($this->_errors);
    }

    public function valid()
    {
        return false !== current($this->_errors);
    }

    /**
     * Merge in errors from an existing PEAR2_MultiErrors
     * 
     * This also merges in any new error levels not supported in this instance.
     * @param PEAR2_MultiErrors $error
     */
    public function merge(PEAR2_MultiErrors $error)
    {
        foreach ($error->levels as $level) {
            if (!isset($this->_allowedLevels[$level])) {
                $this->_allowedLevels[$level] = 1;
            }
            foreach ($error->$level as $e) {
                $this->{$level}[] = $e;
            }
        }
    }

    public function count()
    {
        return count($this->_errors);
    }

    public function offsetExists($offset)
    {
        return isset($this->_errors[$offset]);
    }

    public function offsetGet ($offset)
    {
        if (isset($this->_errors[$offset])) {
            return $this->_errors[$offset];
        }
        return null;
    }

    public function offsetSet ($offset, $value)
    {
        if ($offset === null && !$this->_requestedLevel &&
              $value instanceof PEAR2_MultiErrors ) {
            $this->merge($value);
            return;
        }
        if (!($value instanceof Exception)) {
            throw new PEAR2_MultiErrors_Exception('offsetSet: $value is not an Exception object');
        }
        if ($this->_requestedLevel) {
        if ($offset === null) {
            // called with $a->E_BLAH[] = new Exception('hi');
            $offset = count($this->_errors);
        }
        if (!is_int($offset)) {
            throw new PEAR2_MultiErrors_Exception('offsetSet: $offset is not an integer');
        }
        $this->_errors[$offset] = $value;
            $this->_parent[$this->_requestedLevel . '-' . $offset] = $value;
        } else {
            if (!is_string($offset)) {
                throw new PEAR2_MultiErrors_Exception('Cannot add an error directly ' .
                    'to a PEAR2_MultiErrors with $a[] = new Exception, use an ' .
                    ' E_* constant like $a->E_WARNING[] = new Exception');
            }
            $offset = explode('-', $offset);
            $level = $offset[0];
            $offset = $offset[1];
            // this is called when the "$this->_parent[] = $value" line is executed.
            if (!isset($this->_subMulti[$level]) ||
                  $this->_subMulti[$level][$offset] !== $value) {
            // must be in a child or it'll throw off the whole thingy
                throw new PEAR2_MultiErrors_Exception('Cannot add an error directly ' .
                    'to a PEAR2_MultiErrors with $a[] = new Exception, use an ' .
                    ' E_* constant like $a->E_WARNING[] = new Exception');
            }
            $this->_errors[] = $value;
        }
    }

    public function offsetUnset ($offset)
    {
        if (isset($this->_errors[$offset])) {
            unset($this->_errors[$offset]);
        }
    }

    public function __get($level)
    {
        if ($level === 'levels') {
            return array_keys($this->_allowedLevels);
        }
        if (!count($this->_allowedLevels)) {
            throw new PEAR2_MultiErrors_Exception('Cannot nest requests ' .
              '(like $multi->E_WARNING->E_ERROR[] = new Exception(\'\');)');
        }
        if (isset($this->_allowedLevels[$level])) {
            if (!isset($this->_subMulti[$level])) {
            $this->_subMulti[$level] = new PEAR2_MultiErrors($level,
              array(), $this);
            }
            return $this->_subMulti[$level];
        }
        throw new PEAR2_MultiErrors_Exception('Requested error level must be one of ' .
          implode(', ', array_keys($this->_allowedLevels)));
    }

    public function toArray()
    {
        return $this->_errors;
    }
}
?><?php
class PEAR2_MultiErrors_Exception extends PEAR2_Exception {}<?php
/* vim: set expandtab tabstop=4 shiftwidth=4 foldmethod=marker: */
/**
 * PEAR2_Exception
 *
 * PHP versions 4 and 5
 *
 * LICENSE: This source file is subject to version 3.0 of the PHP license
 * that is available through the world-wide-web at the following URI:
 * http://www.php.net/license/3_0.txt.  If you did not receive a copy of
 * the PHP License and are unable to obtain it through the web, please
 * send a note to license@php.net so we can mail you a copy immediately.
 *
 * @category   pear
 * @package    PEAR2_Exception
 * @author     Tomas V. V. Cox <cox@idecnet.com>
 * @author     Hans Lellelid <hans@velum.net>
 * @author     Bertrand Mansion <bmansion@mamasam.com>
 * @author     Greg Beaver <cellog@php.net>
 * @copyright  1997-2007 The PHP Group
 * @license    http://www.php.net/license/3_0.txt  PHP License 3.0
 * @version    CVS: $Id: Exception.php,v 1.28 2007/05/07 01:58:54 cellog Exp $
 * @link       http://pear.php.net/package/PEAR
 * @since      File available since Release 0.1.0
 */


/**
 * Base PEAR2_Exception Class
 *
 * 1) Features:
 *
 * - Nestable exceptions (throw new PEAR2_Exception($msg, $prev_exception))
 * - Definable triggers, shot when exceptions occur
 * - Pretty and informative error messages
 * - Added more context info available (like class, method or cause)
 * - cause can be a PEAR2_Exception or an array of mixed
 *   PEAR2_Exceptions or a PEAR2_MultiErrors
 * - callbacks for specific exception classes and their children
 *
 * 2) Ideas:
 *
 * - Maybe a way to define a 'template' for the output
 *
 * 3) Inherited properties from PHP Exception Class:
 *
 * protected $message
 * protected $code
 * protected $line
 * protected $file
 * private   $trace
 *
 * 4) Inherited methods from PHP Exception Class:
 *
 * __clone
 * __construct
 * getMessage
 * getCode
 * getFile
 * getLine
 * getTraceSafe
 * getTraceSafeAsString
 * __toString
 *
 * 5) Usage example
 *
 * <code>
 * class PEAR2_MyPackage_Exception extends PEAR2_Exception {}
 *  class Test {
 *     function foo()
 *     {
 *         throw new PEAR2_MyPackage_Exception('Error Message', ERROR_CODE);
 *     }
 *  }
 *
 *  function myLogger($pear2_exception)
 *  {
 *     echo $pear2_exception->getMessage();
 *  }
 *  // each time a exception is thrown the 'myLogger' will be called
 *  // (its use is completely optional)
 *  PEAR2_Exception::addObserver('myLogger');
 *  $test = new Test;
 *  try {
 *     $test->foo();
 *  } catch (PEAR2_Exception $e) {
 *     print $e;
 *  }
 * </code>
 *
 * @category   pear
 * @package    PEAR
 * @author     Tomas V.V.Cox <cox@idecnet.com>
 * @author     Hans Lellelid <hans@velum.net>
 * @author     Bertrand Mansion <bmansion@mamasam.com>
 * @author     Greg Beaver <cellog@php.net>
 * @copyright  1997-2007 The PHP Group
 * @license    http://www.php.net/license/3_0.txt  PHP License 3.0
 * @version    Release: @package_version@
 * @link       http://pear.php.net/package/PEAR
 * @since      Class available since Release 0.1.0
 *
 */
abstract class PEAR2_Exception extends Exception
{
    public static $htmlError = false;
    const OBSERVER_PRINT = -2;
    const OBSERVER_TRIGGER = -4;
    const OBSERVER_DIE = -8;
    protected $cause;
    private static $_observers = array();
    private static $_uniqueid = 0;
    private $_trace;

    /**
     * Supported signatures:
     *  - PEAR2_Exception(string $message);
     *  - PEAR2_Exception(string $message, int $code);
     *  - PEAR2_Exception(string $message, Exception $cause);
     *  - PEAR2_Exception(string $message, Exception $cause, int $code);
     *  - PEAR2_Exception(string $message, PEAR2_MultiErrors $cause);
     *  - PEAR2_Exception(string $message, PEAR2_MultiErrors $cause, int $code);
     *  - PEAR2_Exception(string $message, array $causes);
     *  - PEAR2_Exception(string $message, array $causes, int $code);
     * @param string exception message
     * @param int|Exception|PEAR2_MultiErrors|array|null exception cause
     * @param int|null exception code or null
     */
    public function __construct($message, $p2 = null, $p3 = null)
    {
        if (is_int($p2)) {
            $code = $p2;
            $this->cause = null;
        } elseif (is_object($p2) || is_array($p2)) {
            if (!is_array($p2) && !($p2 instanceof Exception)) {
                if (!($p2 instanceof PEAR2_MultiErrors)) {
                    throw new Exception('exception cause must be Exception, ' .
                        'array, or PEAR2_MultiErrors');
                }
            }
            $code = $p3;
            $this->cause = $p2;
        } else {
            $code = null;
            $this->cause = null;
        }
        if (!is_string($message)) {
            throw new Exception('exception message must be a string, was ' . gettype($message));
        }
        parent::__construct($message, $code);
        $this->signal();
    }

    /**
     * @param mixed $callback  - A valid php callback, see php func is_callable()
     *                         - A PEAR2_Exception::OBSERVER_* constant
     *                         - An array(const PEAR2_Exception::OBSERVER_*,
     *                           mixed $options)
     * @param string $label    The name of the observer. Use this if you want
     *                         to remove it later with removeObserver()
     */
    public static function addObserver($callback, $label = 'default')
    {
        self::$_observers[$label] = $callback;
    }

    public static function removeObserver($label = 'default')
    {
        unset(self::$_observers[$label]);
    }

    /**
     * @return int unique identifier for an observer
     */
    public static function getUniqueId()
    {
        return self::$_uniqueid++;
    }

    private function signal()
    {
        foreach (self::$_observers as $func) {
            if (is_callable($func)) {
                call_user_func($func, $this);
                continue;
            }
            settype($func, 'array');
            switch ($func[0]) {
                case self::OBSERVER_PRINT :
                    $f = (isset($func[1])) ? $func[1] : '%s';
                    printf($f, $this->getMessage());
                    break;
                case self::OBSERVER_TRIGGER :
                    $f = (isset($func[1])) ? $func[1] : E_USER_NOTICE;
                    trigger_error($this->getMessage(), $f);
                    break;
                case self::OBSERVER_DIE :
                    $f = (isset($func[1])) ? $func[1] : '%s';
                    die(printf($f, $this->getMessage()));
                    break;
                default:
                    trigger_error('invalid observer type', E_USER_WARNING);
            }
        }
    }

    /**
     * Returns the exception that caused this exception to be thrown
     * @access public
     * @return Exception|array The context of the exception
     */
    public function getCause()
    {
        return $this->cause;
    }

    /**
     * Function must be public to call on caused exceptions
     * @param array
     */
    public function getCauseMessage(&$causes)
    {
        $trace = $this->getTraceSafe();
        $cause = array('class'   => get_class($this),
                       'message' => $this->message,
                       'file' => 'unknown',
                       'line' => 'unknown');
        if (isset($trace[0])) {
            if (isset($trace[0]['file'])) {
                $cause['file'] = $trace[0]['file'];
                $cause['line'] = $trace[0]['line'];
            }
        }
        $causes[] = $cause;
        if ($this->cause instanceof PEAR2_Exception) {
            $this->cause->getCauseMessage($causes);
        } elseif ($this->cause instanceof Exception) {
            $causes[] = array('class'   => get_class($this->cause),
                              'message' => $this->cause->getMessage(),
                              'file' => $this->cause->getFile(),
                              'line' => $this->cause->getLine());
        } elseif ($this->cause instanceof PEAR2_MultiErrors || is_array($this->cause)) {
            foreach ($this->cause as $cause) {
                if ($cause instanceof PEAR2_Exception) {
                    $cause->getCauseMessage($causes);
                } elseif ($cause instanceof Exception) {
                    $causes[] = array('class'   => get_class($cause),
                                   'message' => $cause->getMessage(),
                                   'file' => $cause->getFile(),
                                   'line' => $cause->getLine());
                }
            }
        }
    }

    public function getTraceSafe()
    {   
        if (!isset($this->_trace)) {
            $this->_trace = $this->getTrace();
            if (empty($this->_trace)) {
                $backtrace = debug_backtrace();
                $this->_trace = array($backtrace[count($backtrace)-1]);
            }
        }
        return $this->_trace;
    }

    public function getErrorClass()
    {
        $trace = $this->getTraceSafe();
        return $trace[0]['class'];
    }

    public function getErrorMethod()
    {
        $trace = $this->getTraceSafe();
        return $trace[0]['function'];
    }

    public function __toString()
    {
        if (self::$htmlError) {
            return $this->toHtml();
        }
        return $this->toText();
    }

    public function toHtml()
    {
        $trace = $this->getTraceSafe();
        $causes = array();
        $this->getCauseMessage($causes);
        $html =  '<table border="1" cellspacing="0">' . "\n";
        foreach ($causes as $i => $cause) {
            $html .= '<tr><td colspan="3" bgcolor="#ff9999">'
               . str_repeat('-', $i) . ' <b>' . $cause['class'] . '</b>: '
               . htmlspecialchars($cause['message']) . ' in <b>' . $cause['file'] . '</b> '
               . 'on line <b>' . $cause['line'] . '</b>'
               . "</td></tr>\n";
        }
        $html .= '<tr><td colspan="3" bgcolor="#aaaaaa" align="center"><b>Exception trace</b></td></tr>' . "\n"
               . '<tr><td align="center" bgcolor="#cccccc" width="20"><b>#</b></td>'
               . '<td align="center" bgcolor="#cccccc"><b>Function</b></td>'
               . '<td align="center" bgcolor="#cccccc"><b>Location</b></td></tr>' . "\n";

        foreach ($trace as $k => $v) {
            $html .= '<tr><td align="center">' . $k . '</td>'
                   . '<td>';
            if (!empty($v['class'])) {
                $html .= $v['class'] . $v['type'];
            }
            $html .= $v['function'];
            $args = array();
            if (!empty($v['args'])) {
                foreach ($v['args'] as $arg) {
                    if (is_null($arg)) $args[] = 'null';
                    elseif (is_array($arg)) $args[] = 'Array';
                    elseif (is_object($arg)) $args[] = 'Object('.get_class($arg).')';
                    elseif (is_bool($arg)) $args[] = $arg ? 'true' : 'false';
                    elseif (is_int($arg) || is_double($arg)) $args[] = $arg;
                    else {
                        $arg = (string)$arg;
                        $str = htmlspecialchars(substr($arg, 0, 16));
                        if (strlen($arg) > 16) $str .= '&hellip;';
                        $args[] = "'" . $str . "'";
                    }
                }
            }
            $html .= '(' . implode(', ',$args) . ')'
                   . '</td>'
                   . '<td>' . (isset($v['file']) ? $v['file'] : 'unknown')
                   . ':' . (isset($v['line']) ? $v['line'] : 'unknown')
                   . '</td></tr>' . "\n";
        }
        $html .= '<tr><td align="center">' . ($k+1) . '</td>'
               . '<td>{main}</td>'
               . '<td>&nbsp;</td></tr>' . "\n"
               . '</table>';
        return $html;
    }

    public function toText()
    {
        $causes = array();
        $this->getCauseMessage($causes);
        $causeMsg = '';
        foreach ($causes as $i => $cause) {
            $causeMsg .= str_repeat(' ', $i) . $cause['class'] . ': '
                   . $cause['message'] . ' in ' . $cause['file']
                   . ' on line ' . $cause['line'] . "\n";
        }
        return $causeMsg . $this->getTraceAsString();
    }
}
?><?php
/**
 * class to do http requests, uses a adapter based system for performing those requests
 *
 * Loosely Based on PEAR HTTP_Response
 *
 * @version $Id$
 */
class PEAR2_HTTP_Request 
{

    /**
     * The adapter that the requester uses.
     *
     * @see adapters
     */
    protected $adapter;

    /**
     * The listeners
     *
     * This variable contains the listeners that are
     * set (can be set) on this object.
     *
     * @var array $_listeners  The listeners
     */
    protected $_listeners = array();
    
    /**
     * Magic to retrieve items that are actually stored in the adapter
     *
     * @param  string $name name of var to get
     */
    public function __get($name)
    {
        if (isset($this->adapter->$name)) {
            return $this->adapter->$name;
        }
    }

    /**
     * Magic to set items that are actually stored in the adapter
     *
     * @param  string $name name of var to set
     * @param  mixed $value to give to var
     */
    public function __set($name, $value)
    {
        switch($name) {
            case 'verb':
                $this->adapter->verb = strtoupper($value);
                break;
            case 'uri':
            case 'url':
                $this->adapter->uri = new PEAR2_HTTP_Request_Uri($value);
                break;
            case 'body':
            case 'content':
                if (is_array($value)) {
                    $this->adapter->body = http_build_query($value);
                    $this->setHeader('Content-Type','application/x-www-form-urlencoded');
                    if ($this->adapter->verb == 'GET') {
                        $this->adapter->verb = 'POST';
                    }
                } else {
                    $this->adapter->body = $value;
                }
                break;
            case 'requestTimeout':
                $this->adapter->$name = (int)$value;
                break;
            case 'proxy':
                $this->adapter->$name = new PEAR2_HTTP_Request_Uri($value);
                break;
            default:
                $this->adapter->$name = $value;
                break;
        }
    }

    /**
     * sets up the adapter
     *
     * @param  string $class adapter to use
     */
    public function __construct($url = null, $instance = null) 
    {
        if (!is_null($instance) && $instance instanceof PEAR2_HTTP_Request_Adapter) {
            $this->adapter = $instance;
        } elseif (extension_loaded('curl')) {
            $this->adapter = new PEAR2_HTTP_Request_Adapter_Curl;
        } elseif (extension_loaded('http')) {
            $this->adapter = new PEAR2_HTTP_Request_Adapter_Http;
        } elseif (ini_get('allow_url_fopen') == true) {
            $this->adapter = new PEAR2_HTTP_Request_Adapter_Phpstream;
        } else {
            $this->adapter = new PEAR2_HTTP_Request_Adapter_Phpsocket;
        }

        $this->adapter->setListeners($this->_listeners);

        if ($url) {
            $this->url = $url;
        }
    }

    /**
     * asks for a response class from the adapter
     *
     * @return PEAR2_HTTP_Request_Response
     */
    public function sendRequest() 
    {
        $response = $this->adapter->sendRequest();
        return $response;
    }

    /**
     * Sends a request storing the output to a file
     *
     * @param  string $file File to store too
     * @return PEAR2_HTTP_Request_Response with no body
     */
    public function requestToFile($file) {
        $response = $this->adapter->requestToFile($file);
        return $response;
    }

    /**
     * Setter for request headers
     * 
     * @see $this->adapter->headers
     */
    public function setHeader($header, $value) 
    {
        $this->adapter->headers[$header] = $value;
    }

    /**
     * Attach a listener
     *
     * This method adds a listener to the list of listeners that are 
     * notified of the object's events.
     *
     * Events sent by the HTTP_Request Object
     *  - 'connect'     : On connection to server
     *  - 'sentRequest' : After the request was sent to server
     *  - 'disconnect'  : Upon server disconnection
     *
     * Events sent by the HTTP_Response object
     *  - 'gotHeaders' : After receiving response header
     *  - 'tick'       : On receiving part of response
     *  - 'gzTick'     : On receiving a gzip-encoded part
     *  - 'gotBody'    : Upon receiving body of the message
     *
     *
     * @param  PEAR2_HTTP_Request_Listener $listener  The listener object
     * @return boolean Whether object is a listener or not
     */
    public function attach(PEAR2_HTTP_Request_Listener &$listener)
    {
        $this->_listeners[$listener->getId()] =& $listener;
        return true;
    }

    /**
     * Detach a listener
     *
     * This method will detach the listener that was set
     * to a request.
     *
     * @param  PEAR2_HTTP_Request_Listener $listener   The listener
     * @return bool true
     */
    public function detach(PEAR2_HTTP_Request_Listener &$listener)
    {
        if (isset($this->_listeners[$listener->getId()])) {
            $this->_listeners[$listener->getId()] = null;
        }

        return true;
    }

    /**
     * Notify
     *
     * This method notifies all registered listeners of
     * the event that just happened.
     *
     * @param     string  $event  The event name
     * @param     mixed  $data   Additional data
     * @see       PEAR2_HTTP_Request->attach()
     * @return    void
     */
    protected function _notify($event, $data = null)
    {
        if (!empty($this->_listeners)) {
            foreach (array_keys($this->_listeners) as $id) {
                $this->_listeners[$id]->update($this, $event, $data);
            }
        }
    }

    /**
     * Get the class name of the adapter that is being used
     */
    public function getAdapterName() {
        return get_class($this->adapter);
    }
}
/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
?>
<?php
abstract class PEAR2_HTTP_Request_Adapter 
{

    /**
     * HTTP Version
     * @var string
     * @link http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.1
     */
    public $httpVersion = 'HTTP/1.1';

    /**
     * Uri to make the request too
     * @var string
     * @link http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.2
     */
    public $uri;

    /**
     * Called Method in the spec
     * @var string
     * @link http://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html#sec5.1.1
     */
    public $verb = 'GET';

    /**
     * Additional headers to send
     * @var array   Header Name => Header value
     * @link http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.2
     * @link http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.5
     * @link http://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html#sec5.3
     */
    public $headers = array();

    /**
     * Value to send as the body of the message, you need to handle the encoding
     * @var string
     * @link http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.3
     */
    public $body;

    /**
     * How long to wait until a request times out
     * @float seconds
     */
    public $requestTimeout = 100;

    /**
     * Full uri of the proxy server
     * @var PEAR2_HTTP_Request_Uri
     */
    public $proxy = null;

    /**
     * HTTP Return code
     * @var string
     * @link http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html
     */
    public $code = 0;

    /**
     * Listeners from the parent
     */
    protected $_listeners = array();

    /**
     * Parsed cookies
     * @var array
     */
    public $cookies = array();

    /**
     * @todo i don't like this approach
     */
    public function setListeners(&$listeners) {
        $this->_listeners &= $listeners;
    }

    /**
     * Send the specified request
     */
    public function sendRequest() 
    {
    }

    /**
     * Send a request storing the results to a file and return a response class with no body
     *
     * Base Adapter contains a non efficient baseline method
     */
    public function requestToFile($file) 
    {
        $response = $this->sendRequest();

        file_put_contents($file,$response->body);
        unset($response->body);

        return $response;
    }

    protected function parseResponseCode($line) 
    {
        if (sscanf($line, 'HTTP/%s %s', $http_version, $returncode) != 2) {
            throw new PEAR2_HTTP_Request_Exception('Malformed response.');
        } else {
            return array('code' => intval($returncode), 'httpVersion' => $http_version);
        }
    }

   /**
    * Processes the response header
    *
    * @access private
    * @param  string    HTTP header
    */
    protected function processHeader($header)
    {
        if (strpos($header, ':') === false) {
            return;
        }

        list($headername, $headervalue) = explode(':', $header, 2);
        if (strstr($headername,'-')) {
            list($p1,$p2) = explode('-',$headername);
            $headername  = ucfirst(strtolower($p1)).'-'.ucfirst(strtolower($p2));
        }
        else {
            $headername  = ucfirst($headername);
        }
        $headervalue = ltrim($headervalue);

        if ('set-cookie' != $headername) {
            if (isset($this->headers[$headername])) {
                $this->headers[$headername] .= ',' . $headervalue;
            } else {
                $this->headers[$headername]  = $headervalue;
            }
        } else {
            $this->cookies[] = $this->parseCookie($headervalue);
        }
    }


    /**
     * Parse a Set-Cookie header to fill $cookies array
     *
     * @access private
     * @param  string    value of Set-Cookie header
     */
    protected function parseCookie($headervalue)
    {
        $cookie = array(
            'expires' => null,
            'domain'  => null,
            'path'    => null,
            'secure'  => false
        );

        // Only a name=value pair
        if (!strpos($headervalue, ';')) {
            $pos = strpos($headervalue, '=');
            $cookie['name']  = trim(substr($headervalue, 0, $pos));
            $cookie['value'] = trim(substr($headervalue, $pos + 1));

            // Some optional parameters are supplied
        } else {
            $elements = explode(';', $headervalue);
            $pos = strpos($elements[0], '=');
            $cookie['name']  = trim(substr($elements[0], 0, $pos));
            $cookie['value'] = trim(substr($elements[0], $pos + 1));

            for ($i = 1; $i < count($elements); $i++) {
                if (false === strpos($elements[$i], '=')) {
                    $elName  = trim($elements[$i]);
                    $elValue = null;
                } else {
                    list ($elName, $elValue) = array_map('trim', explode('=', $elements[$i]));
                }

                $elName = strtolower($elName);

                if ($elName == 'secure') {
                    $cookie['secure'] = true;
                } elseif ($elName == 'expires') {
                    $cookie['expires'] = str_replace('"', '', $elValue);
                } elseif ($elName == 'path' || $elName == 'domain') {
                    $cookie[$elName] = urldecode($elValue);
                } else {
                    $cookie[$elName] = $elValue;
                }
            }
        }
        return $cookie;
    }
}
/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
<?php
class PEAR2_HTTP_Request_Adapter_Curl extends PEAR2_HTTP_Request_Adapter {

    protected $curl = false;
    protected $fp = false;

    public function sendRequest() 
    {
        $this->_setupRequest();

        return $this->_sendRequest();
    }

    public function requestToFile($file) {
        $this->_setupRequest();

        $this->fp = fopen($file,'w');
        curl_setopt($this->curl,CURLOPT_FILE,$this->fp);

        return $this->_sendRequest();
    }

    /**
     * @todo error checking
     * @implement put
     */
    protected function _setupRequest() 
    {
        $this->curl = curl_init($this->uri->url);
        // check error here

        // request timeout
        //curl_setopt($this->curl,CURLOPT_CONNECTTIMEOUT,$this->requestTimeout);
        curl_setopt($this->curl,CURLOPT_TIMEOUT,$this->requestTimeout);

        // progress callback
        // magical breakage the array becomes an int(0) somewhere along the line, we will ignore
        // this for now
        /*
		if (count($this->_listeners) > 0) {
            throw new Exception("Progress callback not implmented for curl yet");
        }
         */

        // follow redirects ???
        // curl_setopt($this->curl,CURLOPT_FOLLOWLOCATION,???);

        // set http version (currently we are only letting you force 1.0 otherwise we let curl auto determine
        switch(strtolower($this->httpVersion))
        {
            case 'http/1.0':
            curl_setopt($this->curl,CURLOPT_HTTP_VERSION,CURL_HTTP_VERSION_1_0);
            break;
            case 'http/1.1':
            default:
            curl_setopt($this->curl,CURLOPT_HTTP_VERSION,CURL_HTTP_VERSION_NONE);
            break;
        }
        
        // http verb
        if (strtoupper($this->verb) == 'PUT') {
            throw new Exception("HTTP put not implmented for Curl yet");
        }
        curl_setopt($this->curl,CURLOPT_CUSTOMREQUEST,$this->verb);

        // headers
        curl_setopt($this->curl,CURLOPT_HTTPHEADER,$this->headers);

        // general stuff
        curl_setopt($this->curl,CURLOPT_BINARYTRANSFER,true);
        curl_setopt($this->curl,CURLOPT_RETURNTRANSFER,true);

        // setup a callback to handle header info
        curl_setopt($this->curl,CURLOPT_HEADERFUNCTION,array($this,'_headerCallback'));

        // post data
        if (!empty($this->body)) {
            curl_setopt($this->curl,CURLOPT_POSTFIELDS,$this->body);
        }
	}

    protected function _sendRequest() {
        $body = curl_exec($this->curl);

        if ($this->fp !== false) {
            fclose($this->fp);
        }

        $details = $this->uri->toArray();


        $details['code'] = curl_getinfo($this->curl,CURLINFO_HTTP_CODE);
        //$details['httpVersion'] = $response->getHttpVersion();

        $headers = new PEAR2_HTTP_Request_Headers($this->headers);
        $cookies = array();

        return new PEAR2_HTTP_Request_Response($details, $body, $headers, $cookies);
    }

    protected function _headerCallback($curl,$data) {
        $this->processHeader(trim($data));
        return strlen($data);
    }
}
/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
<?php
class PEAR2_HTTP_Request_Adapter_Http extends PEAR2_HTTP_Request_Adapter {

	/**
	 * Throws exception if allow_url_fopen is off
	 */
    public function __construct()
	{
        if (!extension_loaded('http')) {
	        throw new PEAR2_HTTP_Request_Exception(
		        'The http extension must be loaded in order to use the Peclhttp adapter'
			);
		}
	}


	
    /**
     * Send the request
     *
     * This function sends the actual request to the
     * remote/local webserver using pecl http
     *
     * @link http://us2.php.net/manual/en/http.request.options.php
     * @todo catch exceptions from HttpRequest and rethrow
     * @todo handle Puts
     */
    public function sendRequest() 
    {
        $options = array(
            'connecttimeout'    => $this->requestTimeout,
            );

        // if we have any listeners register an onprogress callback
        if (count($this->_listeners) > 0) {
            $options['onprogress'] = array($this,'_onprogress');
        }

        $tmp = 'HTTP_METH_'.strtoupper($this->verb);
        if (defined($tmp)) {
            $method = constant($tmp);
        }
        else {
            $method = HTTP_METH_GET;
        }

        $request = new HttpRequest($this->uri->url,$method,$options);
        $request->setHeaders($this->headers);
        $request->setRawPostData($this->body);

        $request->send();
        $response = $request->getResponseMessage();
        $body = $response->getBody();

        $details = $this->uri->toArray();

        $details['code'] = $request->getResponseCode();
        $details['httpVersion'] = $response->getHttpVersion();

        $headers = new PEAR2_HTTP_Request_Headers($response->getHeaders());
        $cookies = $request->getResponseCookies();


        return new PEAR2_HTTP_Request_Response($details, $body, $headers, $cookies);
    }	   

    /**
     * Progress handler maps callback progress to listeners
     * @todo implement progress callback
     * @todo this doesn't want to be part of the public api but has to be public to be called as a callback
     */
    public function _onprogress($status) {
    }
}
/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
<?php
class PEAR2_HTTP_Request_Adapter_Phpsocket_Socket {
        public $lineLength = 2048;
        private $_handle;

        public function __construct($handle) {
                $this->_handle = $handle;
        }

        public function readLine() {
                $line = '';
                while(!$this->eof()) {
                        $line .= @fgets($this->_handle, $this->lineLength);
                        if (substr($line, -1) == "\n") {
                                return rtrim($line, "\r\n");
                        }
                }
                return false;
        }

        public function read($size) {
                if ($this->eof()) {
                        return false;
                }
                return @fread($this->_handle,$size);
        }

        public function write($payload) {
                return fwrite($this->_handle,$payload,strlen($payload));
        }

        public function eof() {
                return feof($this->_handle);
        }
}

/**
 * A class which represents an Http Reponse
 * Handles parsing cookies and headers
 *
 * Based on PEAR HTTP_Response
 *
 * @version $Revision: 1.52 $
 */
class PEAR2_HTTP_Request_Adapter_Phpsocket extends PEAR2_HTTP_Request_Adapter {

    
    /**
     * Used by _readChunked(): remaining length of the current chunk
     * @var string
     */
    private $_chunkLength = 0;

    /**
     * Bytes left to read from message-body
     * @var null|int
     */
    private $_toRead = null;

    /**
     * Raw Response to be parsed
     */
    private $_stream;

    public function sendRequest() {
        $payload = $this->_buildHeaders($this->uri->path,$this->uri->host,$this->headers,strlen($this->body));
        $payload .= $this->body;
        $this->body = '';

        $errno    = 0;
        $errstr   = '';
        $handle   = @fsockopen($this->uri->host, $this->uri->port, $errno, $errstr, 30);

        if (!is_resource($handle)) {
            throw new PEAR2_HTTP_Request_Exception("Couldn't connection to host using Phpsocket Adapter, fsockopen errors($errstr,$errno)");
        }
        stream_set_timeout($handle,10);

        $this->_stream = new PEAR2_HTTP_Request_Adapter_Phpsocket_Socket($handle);

        $this->_stream->write($payload);

        $this->parse();

        $details['code'] = $this->code;
        $details['httpVersion'] = $this->httpVersion;


        $response = new PEAR2_HTTP_Request_Response(
            $details,$this->body,new PEAR2_HTTP_Request_Headers($this->headers),$this->cookies);
        return $response;
    }

    /**
     * Parse a HTTP response
     * 
     * This extracts response code, headers, cookies and decodes body if it 
     * was encoded in some way
     *
     * @access public
     * @param  bool      Whether to store response body in object property, set
     *                   this to false if downloading a LARGE file and using a Listener.
     *                   This is assumed to be true if body is gzip-encoded.
     * @param  bool      Whether the response can actually have a message-body.
     *                   Will be set to false for HEAD requests.
     * @throws Exception
     * @return boolean     true on success
     */
    public function parse($saveBody = true, $canHaveBody = true)
    {
        do {
            $line = $this->_stream->readLine();
            $code = $this->parseResponseCode($line);
            $this->httpVersion = 'HTTP/' . $code['httpVersion'];
            $this->code     = $code['code'];

            while ('' !== ($header = $this->_stream->readLine())) {
                $this->processHeader($header);
            }
        } while ($this->code == 100);

        // RFC 2616, section 4.4:
        // 1. Any response message which "MUST NOT" include a message-body ... 
        // is always terminated by the first empty line after the header fields 
        // 3. ... If a message is received with both a
        // Transfer-Encoding header field and a Content-Length header field,
        // the latter MUST be ignored.
        $canHaveBody = $canHaveBody && $this->code >= 200 && 
                       $this->code != 204 && $this->code != 304;

        // If response body is present, read it and decode
        $chunked = isset($this->headers['transfer-encoding']) && ('chunked' == $this->headers['transfer-encoding']);
        $gzipped = isset($this->headers['content-encoding']) && ('gzip' == $this->headers['content-encoding']);
        $hasBody = false;
        if ($canHaveBody && ($chunked || !isset($this->headers['content-length']) || 
                0 != $this->headers['content-length']))
        {
            if ($chunked || !isset($this->headers['content-length'])) {
                $this->_toRead = null;
            } else {
                $this->_toRead = $this->headers['content-length'];
            }
            while (!$this->_stream->eof() && (is_null($this->_toRead) || $this->_toRead > 0)) {
                if ($chunked) {
                    $data = $this->_readChunked();
                } elseif (is_null($this->_toRead)) {
                    $data = $this->_stream->read(4096);
                } else {
                    $data = $this->_stream->read(min(4096, $this->_toRead));
                    $this->_toRead -= strlen($data);
                }
                if ($data == '') {
                    break;
                } else {
                    $hasBody = true;
                    if ($saveBody || $gzipped) {
                        $this->body .= $data;
                    }
                }
            }
        }

        if ($hasBody) {
            // Uncompress the body if needed
            if ($gzipped) {
                $body = $this->_decodeGzip($this->body);
                if (PEAR::isError($body)) {
                    return $body;
                }
                $this->body = $body;
            }
        }
        return true;
    }

   /**
    * Read a part of response body encoded with chunked Transfer-Encoding
    * 
    * @access private
    * @return string
    */
    private function _readChunked()
    {
        // at start of the next chunk?
        if (0 == $this->_chunkLength) {
            $line = $this->_stream->readLine();
            if (preg_match('/^([0-9a-f]+)/i', $line, $matches)) {
                $this->_chunkLength = hexdec($matches[1]); 
                // Chunk with zero length indicates the end
                if (0 == $this->_chunkLength) {
                    $this->_stream->readLine(); // make this an eof()
                    return '';
                }
            } else {
                return '';
            }
        }
        $data = $this->_stream->read($this->_chunkLength);
        $this->_chunkLength -= strlen($data);
        if (0 == $this->_chunkLength) {
            $this->_stream->readLine(); // Trailing CRLF
        }
        return $data;
    }

   /**
    * Decodes the message-body encoded by gzip
    *
    * The real decoding work is done by gzinflate() built-in function, this
    * method only parses the header and checks data for compliance with
    * RFC 1952  
    *
    * @access   private
    * @param    string  gzip-encoded data
    * @return   string  decoded data
    */
    private function _decodeGzip($data)
    {
        $length = strlen($data);
        // If it doesn't look like gzip-encoded data, don't bother
        if ($length < 18 || strcmp(substr($data, 0, 2), "\x1f\x8b")) {
            return $data;
        }
        $method = ord(substr($data, 2, 1));
        if ($method != 8) {
            throw new PEAR2_HTTP_Request_Exception('_decodeGzip(): unknown compression method');
        }
        
        $flags = ord(substr($data, 3, 1));

        if ($flags & 224) {
            throw new PEAR2_HTTP_Request_Exception('_decodeGzip(): reserved bits are set');
        }

        // header is 10 bytes minimum. may be longer, though.
        $headerLength = 10;
        // extra fields, need to skip 'em
        if ($flags & 4) {
            if ($length - $headerLength - 2 < 8) {
                throw new PEAR2_HTTP_Request_Exception('_decodeGzip(): data too short');
            }
            
            $extraLength = unpack('v', substr($data, 10, 2));
            if ($length - $headerLength - 2 - $extraLength[1] < 8) {
                throw new PEAR2_HTTP_Request_Exception('_decodeGzip(): data too short');
            }

            $headerLength += $extraLength[1] + 2;
        }
        // file name, need to skip that
        if ($flags & 8) {
            if ($length - $headerLength - 1 < 8) {
                throw new PEAR2_HTTP_Request_Exception('_decodeGzip(): data too short');
            }
            $filenameLength = strpos(substr($data, $headerLength), chr(0));
            if (false === $filenameLength || $length - $headerLength - $filenameLength - 1 < 8) {
                throw new PEAR2_HTTP_Request_Exception('_decodeGzip(): data too short');
            }
            $headerLength += $filenameLength + 1;
        }
        // comment, need to skip that also
        if ($flags & 16) {
            if ($length - $headerLength - 1 < 8) {
                throw new PEAR2_HTTP_Request_Exception('_decodeGzip(): data too short');
            }
            $commentLength = strpos(substr($data, $headerLength), chr(0));
            if (false === $commentLength || $length - $headerLength - $commentLength - 1 < 8) {
                throw new PEAR2_HTTP_Request_Exception('_decodeGzip(): data too short');
            }
            $headerLength += $commentLength + 1;
        }
        // have a CRC for header. let's check
        if ($flags & 1) {
            if ($length - $headerLength - 2 < 8) {
                throw new PEAR2_HTTP_Request_Exception('_decodeGzip(): data too short');
            }
            $crcReal   = 0xffff & crc32(substr($data, 0, $headerLength));
            $crcStored = unpack('v', substr($data, $headerLength, 2));
            if ($crcReal != $crcStored[1]) {
                throw new PEAR2_HTTP_Request_Exception('_decodeGzip(): header CRC check failed');
            }
            $headerLength += 2;
        }
        // unpacked data CRC and size at the end of encoded data
        $tmp = unpack('V2', substr($data, -8));
        $dataCrc  = $tmp[1];
        $dataSize = $tmp[2];

        // finally, call the gzinflate() function
        $unpacked = @gzinflate(substr($data, $headerLength, -8), $dataSize);
        if (false === $unpacked) {
            throw new PEAR2_HTTP_Request_Exception('_decodeGzip(): gzinflate() call failed');
        } elseif ($dataSize != strlen($unpacked)) {
            throw new PEAR2_HTTP_Request_Exception('_decodeGzip(): data size check failed');
        } elseif ($dataCrc != crc32($unpacked)) {
            throw new PEAR2_HTTP_Request_Exception('_decodeGzip(): data CRC check failed');
        }
        return $unpacked;
    }

    private function _buildHeaders($path, $host, $headers,$bodySize) {
        $httpRequest  = "$this->verb $path $this->httpVersion\r\n";
        $httpRequest .= "Host: $host\r\n";
        foreach($headers as $key => $value) {
            $httpRequest .= "$key: $value\r\n";
        }
        if ($bodySize > 0) {
            $httpRequest .= "Content-Length:".$bodySize."\r\n";
        }
        $httpRequest .= "\r\n";

        return $httpRequest;
    }
} // End class PEAR2_HTTP_Response
/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
?>
<?php
/**
 * driver that uses php http:// stream to do requests
 *
 * Loosely Based on PEAR HTTP_Response
 *
 * @version $Revision: 1.52 $
 */
class PEAR2_HTTP_Request_Adapter_PhpStream extends PEAR2_HTTP_Request_Adapter
{
    private $_phpErrorStr;

    /**
     * Throws exception if allow_url_fopen is off
     */
    public function __construct()
    {
        if (ini_get('allow_url_fopen') == false) {
            throw new PEAR2_HTTP_Request_Exception(
                'allow_url_fopen is off, the http:// stream wrapper will not function'
            );
        }
    }


    /**
     * Send the request
     *
     * This function sends the actual request to the
     * remote/local webserver using php streams.
     */
    public function sendRequest()
    {

        $proxyurl = '';
        if (!is_null($this->proxy)) {
            $proxyurl = $this->proxy->url;
        }
        // create context with proper junk
        $ctx = stream_context_create(
            array(
                $this->uri->protocol => array(
                    'method' => $this->verb,
                    'content' => $this->body,
                    'header' => $this->buildHeaderString(),
                    'proxy'  => $proxyurl,
                )
            )
        );

        set_error_handler(array($this,'_errorHandler'));
        $fp = fopen($this->uri->url, 'rb', false, $ctx);
        if (!is_resource($fp)) {
            // php sucks
            if (strpos($this->_phpErrorStr, 'HTTP/1.1 304')) {
                restore_error_handler();
                $details = $this->uri->toArray();

                $details['code'] = '304';
                $details['httpVersion'] = '1.1';

                return new PEAR2_HTTP_Request_Response($details,'',array(),array());
            }
            restore_error_handler();
            throw new PEAR2_HTTP_Request_Exception('Url ' . $this->uri->url . ' could not be opened (PhpStream Adapter ('.$this->_phpErrorStr.'))');
        } else {
            restore_error_handler();
        }

        stream_set_timeout($fp, $this->requestTimeout);
        $body = stream_get_contents($fp);

        if ($body === false) {
            throw new PEAR2_HTTP_Request_Exception(
                'Url ' . $this->uri->url . ' did not return a response'
            );
        }

        $meta = stream_get_meta_data($fp);
        fclose($fp);

        $headers = $meta['wrapper_data'];

        $details = $this->uri->toArray();

        $tmp = $this->parseResponseCode($headers[0]);
        $details['code'] = $tmp['code'];
        $details['httpVersion'] = $tmp['httpVersion'];

        $cookies = array();
        $this->headers = $this->cookies = array();

        foreach($headers as $line) {
            $this->processHeader($line);
        }

        return new PEAR2_HTTP_Request_Response(
            $details,$body,new PEAR2_HTTP_Request_Headers($this->headers),$this->cookies);
    }

    /**
     * Build header String
     *
     * This method builds the header string
     * to be passed to the request.
     *
     * @return string $out  The headers
     */
    private function buildHeaderString()
    {
        $out = '';
        foreach($this->headers as $header => $value) {
            $out .= "$header: $value\r\n";
        }
        return $out;
    }

    /**
     * This has to be public to be used as a callback but its actually private
     */
    public function _errorHandler($errno,$errstr) {
        $this->_phpErrorStr = $errstr;
    }
}
/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
?>
<?php
class PEAR2_HTTP_Request_Exception extends PEAR2_Exception {
}
<?php

/**
 * A container for HTTP request headers provides case insensitive access
 *
 * Array style access and object style access is provided
 *
 * Lazy processing of case insensitive access is provided so we don't strtolower the keys
 * until the headers are actually used
 *
 * @todo decide if this should be pulled out of the package and provided as a generic class
 */
class PEAR2_HTTP_Request_Headers implements Iterator, ArrayAccess, Countable {

	const ORIGINAL_CASE = 'fields';
	const LOWER_CASE = 'lowerCase';
	const CAMEL_CASE = 'camelCase';

	public $iterationStyle = self::LOWER_CASE;

	protected $fields = array();
	protected $camelCase = null;
	protected $lowerCase = null;

	/**
	 * Takes the headers to provide access too
	 */
	public function __construct($fields) {
		$this->fields = $fields;
	}

	/**
	 * Magic getter for object access
	 */
	public function __get($key) {
		if (is_null($this->camelCase)) {
			$this->camelCaseFields();
		}

		if (isset($this->camelCase[$key])) {
			return $this->camelCase[$key];
		}
		return null;
	}

	/**
	 * Magic setter for object access
	 *
	 * @todo set $this->fields and $this->lowerCase
	 */
	public function __set($key,$value) {
		$this->camelCase[$key] = $value;
	}

	/**
	 * Magic isset for object access
	 */
	public function __isset($key) {
		if (is_null($this->camelCase)) {
			$this->camelCaseFields();
		}
		return isset($this->camelCase[$key]);
	}

	/**
	 * Magic unset for object access
	 */
	public function __unset($key) {
		if (is_null($this->camelCase)) {
			$this->camelCaseFields();
		}
		unset($this->camelCase[$key]);
	}

	/**
	 * ArrayAccess Implementation
	 */
	public function offsetExists($key) {
		if (is_null($this->lowerCase)) {
			$this->lowerCaseFields();
		}
		$key = strtolower($key);
		return isset($this->lowerCase[$key]);
	}

	/**
	 * ArrayAccess Implementation
	 */
	public function offsetGet($key) {
		if (is_null($this->lowerCase)) {
			$this->lowerCaseFields();
		}
		$key = strtolower($key);
		if (isset($this->lowerCase[$key])) {
			return $this->lowerCase[$key];
		}
		return null;
	}

	/**
	 * ArrayAccess Implementation
	 */
	public function offsetSet($key,$value) {
		$key = strtolower($key);

		$this->lowerCase[$key] = $value;
	}

	/**
	 * ArrayAccess Implementation
	 */
	public function offsetUnset($key) {
		if (is_null($this->lowerCase)) {
			$this->lowerCaseFields();
		}
		$key = strtolower($key);
		unset($this->lowerCase[$key]);
	}

	/**
	 * Return the number of headers
	 * Countable interface implmentation
	 */
	public function count() {
		return count($this->fields);
	}

	/**
	 * Iterator Implmentation
	 */
	public function current() {
		return current($this->{$this->iterationStyle});
	}

	/**
	 * Iterator Implmentation
	 */
	public function key() {
		return key($this->{$this->iterationStyle});
	}

	/**
	 * Iterator Implmentation
	 */
	public function next() {
		return next($this->{$this->iterationStyle});
	}

	/**
	 * Iterator Implmentation
	 */
	public function rewind() {
		if (is_null($this->{$this->iterationStyle})) {
			$m = $this->iterationStyle."Fields";
			$this->$m();
		}
		reset($this->{$this->iterationStyle});
	}

	/**
	 * Iterator Implmentation
	 */
	public function valid() {
		return (boolean) current($this->{$this->iterationStyle});
	}

	/**
	 * Make all keys lower case
	 */
	protected function lowerCaseFields() {
		$fields = array();
		foreach($this->fields as $k => $v) {
			$fields[strtolower($k)] = $v;
		}
		$this->lowerCase = $fields;
	}

	/**
	 * Make all keys camel case, removing dashes
	 */
	protected function camelCaseFields() {
		$fields = array();
		foreach($this->fields as $k => $v) {
			$pieces = explode('-',$k);
			$pieces = array_map('ucfirst',$pieces);
			$fields[implode('',$pieces)] = $v;
		}
		$this->camelCase = $fields;
	}
}
<?php
/**
 * Listener for PEAR2_HTTP_Request and PEAR2_HTTP_Response objects
 *
 * PHP version 5
 * 
 * LICENSE:
 *
 * Copyright (c) 2002-2007, Richard Heyes
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * o Redistributions of source code must retain the above copyright
 *   notice, this list of conditions and the following disclaimer.
 * o Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 * o The names of the authors may not be used to endorse or promote
 *   products derived from this software without specific prior written
 *   permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @category    PEAR2::HTTP
 * @package     PEAR2_HTTP_Request
 * @author      Alexey Borzov <avb@php.net>
 * @copyright   2002-2007 Richard Heyes
 * @license     http://opensource.org/licenses/bsd-license.php New BSD License 
 */

/**
* Listener for PEAR2_HTTP_Request and PEAR2_HTTP_Response objects
*
* This class implements the Observer part of a Subject-Observer
* design pattern.
*
* @category    HTTP
* @package     HTTP_Request
* @author      Alexey Borzov <avb@php.net>
* @version     Release: @package_version@
*/
class PEAR2_HTTP_Request_Listener 
{
    /**
    * A listener's identifier
    *
    * @var string
    */
    private $_id;

    /**
     * A current log of the activities
     */
    private $_log = array(
        'notifications' => array(),
        'extraData'     => array(),
    );

    /**
    * Constructor, sets the object's identifier
    *
    * @access public
    */
    public function __construct()
    {
        $this->_id = md5(sha1('http_request_') . time());
    }


    /**
    * Returns the listener's identifier
    *
    * @access public
    * @return string
    */
    public function getId()
    {
        return $this->_id;
    }

    /**
    * This method is called when Listener is notified of an event
    *
    * @access   public
    * @param    object  an object the listener is attached to Is that even used?
    * @param    string  Event name
    * @param    mixed   Additional data
    * @abstract
    */
    public function update(&$subject, $event, $data = null)
    {
        $this->_log[$this->_id]['notifications'][] = "Notified of event: '$event'\n";
        if ($data !== null) {
            $tmpMessage  = "Additional data: ";
            $tmpMessage .= print_r($data, true);

            $this->_log[$this->_id]['extraData'][] = $tmpMessage;
        }
    }
}
?>

<?php
/**
 * A class which represents an HTTP Reponse
 *
 */
class PEAR2_HTTP_Request_Response
{
    /**
     * HTTP Return code
     * @var string
     * @link http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html
     */
    public $code = 100;

    /**
     * Response headers
     * @var array
     */
    public $headers;

    /**
     * Cookies set in response
     * @var array
     */
    public $cookies;

    /**
     * Response body
     * @var string
     */
    public $body = '';

    /**
     * Constructor
     *
     *
     * @see $this->body
     * @see $this->headers
     * @see $this->cookies
     */
    public function __construct($details, $body, $headers, $cookies)
    {
        foreach($details as $name => $value) {
            $this->$name = $value;
        }

        $this->body    = $body;
        $this->headers = $headers;
        $this->cookies = $cookies;
    }

    /**
     * Return the body of the response
     */
    public function __toString() {
        return $this->body;
    }
}
/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
?>
<?php

/**
 * Simple class for parsing url/uris
 *
 * Basically compatiable with Net_URL2 propery names but not methods
 */
class PEAR2_HTTP_Request_Uri {

	protected $pieces = array();
	protected $map = array(
			'url' => 'uri',
			'querystring' => 'query',
			'anchor' => 'fragment',
			'protocol' => 'scheme',
			);
	protected $schemes = array(
			'http' => 80,
			'https'=> 443,
		);

	public function __construct($uri) {
		$this->pieces = parse_url($uri);
		$this->pieces['uri'] = $uri;
		if (!isset($this->pieces['port'])) {
			if (isset($this->schemes[$this->pieces['scheme']])) {
				$this->pieces['port'] = $this->schemes[$this->pieces['scheme']];
			}
			else {
				$this->pieces['port'] = 80;
			}
		}
	}

	public function __get($key) {
		if (isset($this->map[$key])) {
			$key = $this->map[$key];
		}
		if (isset($this->pieces[$key])) {
			return $this->pieces[$key];
		}
		return null;
	}

	public function toArray() {
		return $this->pieces;
	}
}
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * A full featured package for managing command-line options and arguments 
 * hightly inspired from python optparse module, it allows the developper to 
 * easily build complex command line interfaces.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */

/**
 * Main class for parsing command line options and arguments.
 * 
 * There are three ways to create parsers with this class:
 * <code>
 * // direct usage
 * $parser = new PEAR2_Console_CommandLine();
 *
 * // with an xml definition file
 * $parser = PEAR2_Console_CommandLine::fromXmlFile('path/to/file.xml');
 *
 * // with an xml definition string
 * $validXmlString = '..your xml string...';
 * $parser = PEAR2_Console_CommandLine::fromXmlString($validXmlString);
 * </code>
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 * @example   docs/examples/ex1.php
 * @example   docs/examples/ex2.php
 */
class PEAR2_Console_CommandLine
{
    // Public properties {{{

    /**
     * Error messages.
     *
     * @var    array $errors
     * @access public
     */
    public static $errors = array(
        'option_bad_name'                    => 'option name must be a valid php variable name (got: {$name})',
        'argument_bad_name'                  => 'argument name must be a valid php variable name (got: {$name})',
        'option_long_and_short_name_missing' => 'you must provide at least an option short name or long name for option "{$name}"',
        'option_bad_short_name'              => 'option "{$name}" short name must be a dash followed by a letter (got: "{$short_name}")',
        'option_bad_long_name'               => 'option "{$name}" long name must be 2 dashes followed by a word (got: "{$long_name}")',
        'option_unregistered_action'         => 'unregistered action "{$action}" for option "{$name}".',
        'option_bad_action'                  => 'invalid action for option "{$name}".',
        'option_invalid_callback'            => 'you must provide a valid callback for option "{$name}"',
        'action_class_does_not_exists'       => 'action "{$name}" class "{$class}" not found, make sure that your class is available before calling PEAR2_Console_CommandLine::registerAction()',
        'invalid_xml_file'                   => 'XML definition file "{$file}" does not exists or is not readable',
        'invalid_rng_file'                   => 'RNG file "{$file}" does not exists or is not readable'
    );

    /**
     * The name of the program, if not given it defaults to argv[0].
     *
     * @var    string $name
     * @access public
     */
    public $name;

    /**
     * A description text that will be displayed in the help message.
     *
     * @var    string $description
     * @access public
     */
    public $description = '';

    /**
     * A string that represents the version of the program, if this property is 
     * not empty and property add_version_option is not set to false, the
     * command line parser will add a --version option, that will display the
     * property content.
     *
     * @var    string $version
     * @access public
     */
    public $version = '';

    /**
     * Boolean that determine if the command line parser should add the help
     * (-h, --help) option automatically.
     *
     * @var    bool $add_help_option
     * @access public
     */
    public $add_help_option = true;

    /**
     * Boolean that determine if the command line parser should add the version
     * (-v, --version) option automatically.
     * Note that the version option is also generated only if the version 
     * property is not empty, it's up to you to provide a version string of 
     * course.
     *
     * @var    bool $add_version_option
     * @access public
     */
    public $add_version_option = true;

    /**
     * The command line parser renderer instance.
     *
     * @var    object that implements PEAR2_Console_CommandLine_Renderer interface
     * @access protected
     */
    public $renderer = false;

    /**
     * The command line parser outputter instance.
     *
     * @var    object that implements PEAR2_Console_CommandLine::Outputter interface
     * @access protected
     */
    public $outputter = false;

    /**
     * The command line message provider instance.
     *
     * @var    object an instance of PEAR2_Console_CommandLine::Message
     * @access protected
     */
    public $message_provider = false;

    /**
     * Boolean that tells the parser to be POSIX compliant, POSIX demands the 
     * following behavior: the first non-option stops option processing.
     *
     * @var    bool $force_posix
     * @access public
     */
    public $force_posix = false;

    /**
     * An array of PEAR2_Console_CommandLine_Option objects.
     *
     * @var    array $options
     * @access public
     */
    public $options = array();

    /**
     * An array of PEAR2_Console_CommandLine_Argument objects.
     *
     * @var    array $args
     * @access public
     */
    public $args = array();

    /**
     * An array of PEAR2_Console_CommandLine_Command objects (sub commands).
     *
     * @var    array $commands
     * @access public
     */
    public $commands = array();

    /**
     * Parent, only relevant in Command objects but left here for interface 
     * convenience.
     *
     * @var    object PEAR2_Console_CommandLine
     * @access public
     */
    public $parent = false;

    /**
     * Array of valid actions for an option, this array will also store user 
     * registered actions.
     * The array format is:
     * <pre>
     * array(
     *     <ActionName:string> => array(<ActionClass:string>, <builtin:bool>)
     * )
     *
     * @var    array $actions
     * @static
     * @access public
     */
    public static $actions = array(
        'StoreTrue'   => array('PEAR2_Console_CommandLine_Action_StoreTrue', true),
        'StoreFalse'  => array('PEAR2_Console_CommandLine_Action_StoreFalse', true),
        'StoreString' => array('PEAR2_Console_CommandLine_Action_StoreString', true),
        'StoreInt'    => array('PEAR2_Console_CommandLine_Action_StoreInt', true),
        'StoreFloat'  => array('PEAR2_Console_CommandLine_Action_StoreFloat', true),
        'StoreArray'  => array('PEAR2_Console_CommandLine_Action_StoreArray', true),
        'Callback'    => array('PEAR2_Console_CommandLine_Action_Callback', true),
        'Counter'     => array('PEAR2_Console_CommandLine_Action_Counter', true),
        'Help'        => array('PEAR2_Console_CommandLine_Action_Help', true),
        'Version'     => array('PEAR2_Console_CommandLine_Action_Version', true),
        'Password'    => array('PEAR2_Console_CommandLine_Action_Password', true)
    );

    /**
     * Array of options that must be dispatched at the end.
     *
     * @var    array $_dispatchLater
     * @access private
     */
    private $_dispatchLater = array();

    // }}}
    // __construct() {{{

    /**
     * Constructor.
     * Example:
     *
     * <code>
     * $parser = new PEAR2_Console_CommandLine(array(
     *     'name'               => 'yourprogram', // defaults to argv[0]
     *     'description'        => 'Description of your program',
     *     'version'            => '0.0.1', // your program version
     *     'add_help_option'    => true, // or false to disable --version option
     *     'add_version_option' => true, // or false to disable --help option
     *     'force_posix'        => false // or true to force posix compliance
     * ));
     * </code>
     *
     * @param array $params an optional array of parameters
     *
     * @access public
     */
    public function __construct(array $params=array()) 
    {
        if (isset($params['name'])) {
            $this->name = $params['name'];
        } else if (isset($argv) && count($argv) > 0) {
            $this->name = $argv[0];
        } else if (isset($_SERVER['argv']) && count($_SERVER['argv']) > 0) {
            $this->name = $_SERVER['argv'][0];
        } else if (isset($_SERVER['SCRIPT_NAME'])) {
            $this->name = basename($_SERVER['SCRIPT_NAME']);
        }
        if (isset($params['description'])) {
            $this->description = $params['description'];
        }
        if (isset($params['version'])) {
            $this->version = $params['version'];
        }
        if (isset($params['add_version_option'])) {
            $this->add_version_option = $params['add_version_option'];
        }
        if (isset($params['add_help_option'])) {
            $this->add_help_option = $params['add_help_option'];
        }
        if (isset($params['force_posix'])) {
            $this->force_posix = $params['force_posix'];
        } else if (getenv('POSIXLY_CORRECT')) {
            $this->force_posix = true;
        }
        // set default instances
        $this->renderer         = new PEAR2_Console_CommandLine_Renderer_Default($this);
        $this->outputter        = new PEAR2_Console_CommandLine_Outputter_Default();
        $this->message_provider = new PEAR2_Console_CommandLine_MessageProvider_Default();
    }

    // }}}
    // accept() {{{

    /**
     * Method to allow PEAR2_Console_CommandLine to accept either:
     *  + a custom renderer, 
     *  + a custom outputter,
     *  + or a custom message provider
     *
     * @param mixed $instance the custom instance
     *
     * @access public
     * @return void
     * @throws PEAR2_Console_CommandLine_Exception if wrong argument passed
     */
    public function accept($instance) 
    {
        if ($instance instanceof PEAR2_Console_CommandLine_Renderer) {
            if (property_exists($instance, 'parser') && !$instance->parser) {
                $instance->parser = $this;
            }
            $this->renderer = $instance;
        } else if ($instance instanceof PEAR2_Console_CommandLine_Outputter) {
            $this->outputter = $instance;
        } else if ($instance instanceof PEAR2_Console_CommandLine_MessageProvider) {
            $this->message_provider = $instance;
        } else {
            throw PEAR2_Console_CommandLine_Exception::build(
                'INVALID_CUSTOM_INSTANCE',
                array(),
                $this
            );
        }
    }

    // }}}
    // fromXmlFile() {{{

    /**
     * Return a command line parser instance built from an xml file.
     *
     * Example:
     * <code>
     * $parser = PEAR2_Console_CommandLine::fromXmlFile('path/to/file.xml');
     * $result = $parser->parse();
     * </code>
     *
     * @param string $file path to the xml file
     *
     * @return object a PEAR2_Console_CommandLine instance
     * @access public
     * @static
     */
    public static function fromXmlFile($file) 
    {
        return PEAR2_Console_CommandLine_XmlParser::parse($file);
    }

    // }}}
    // fromXmlString() {{{

    /**
     * Return a command line parser instance built from an xml string.
     *
     * Example:
     * <code>
     * $xmldata = '<?xml version="1.0" encoding="utf-8" standalone="yes"?>
     * <command>
     *   <description>Compress files</description>
     *   <option name="quiet">
     *     <short_name>-q</short_name>
     *     <long_name>--quiet</long_name>
     *     <description>be quiet when run</description>
     *     <action>StoreTrue/action>
     *   </option>
     *   <argument name="files">
     *     <description>a list of files</description>
     *     <multiple>true</multiple>
     *   </argument>
     * </command>';
     * $parser = PEAR2_Console_CommandLine::fromXmlString($xmldata);
     * $result = $parser->parse();
     * </code>
     *
     * @param string $string the xml data
     *
     * @return object a PEAR2_Console_CommandLine instance
     * @access public
     * @static
     */
    public static function fromXmlString($string) 
    {
        return PEAR2_Console_CommandLine_XmlParser::parseString($string);
    }

    // }}}
    // addArgument() {{{

    /**
     * Add an argument with the given $name to the command line parser.
     *
     * Example:
     * <code>
     * $parser = new PEAR2_Console_CommandLine();
     * // add an array argument
     * $parser->addArgument('input_files', array('multiple'=>true));
     * // add a simple argument
     * $parser->addArgument('output_file');
     * $result = $parser->parse();
     * print_r($result->args['input_files']);
     * print_r($result->args['output_file']);
     * // will print:
     * // array('file1', 'file2')
     * // 'file3'
     * // if the command line was:
     * // myscript.php file1 file2 file3
     * </code>
     *
     * In a terminal, the help will be displayed like this:
     * <code>
     * $ myscript.php install -h
     * Usage: myscript.php <input_files...> <output_file>
     * </code>
     *
     * @param mixed $name   a string containing the argument name or an
     *                      instance of PEAR2_Console_CommandLine_Argument
     * @param array $params an array containing the argument attributes
     *
     * @return object PEAR2_Console_CommandLine_Argument
     * @access public
     * @see    PEAR2_Console_CommandLine_Command
     */
    public function addArgument($name, $params=array())
    {
        if ($name instanceof PEAR2_Console_CommandLine_Argument) {
            $argument = $name;
        } else {
            $argument = new PEAR2_Console_CommandLine_Argument($name, $params);
        }
        $argument->validate();
        $this->args[$argument->name] = $argument;
        return $argument;
    }

    // }}}
    // addCommand() {{{

    /**
     * Add a sub-command to the command line parser.
     *
     * Add a command with the given $name to the parser and return the 
     * PEAR2_Console_CommandLine_Command instance, you can then populate the command
     * with options, configure it, etc... like you would do for the main parser
     * because the class PEAR2_Console_CommandLine_Command inherits from
     * PEAR2_Console_CommandLine.
     *
     * An example:
     * <code>
     * $parser = new PEAR2_Console_CommandLine();
     * $install_cmd = $parser->addCommand('install');
     * $install_cmd->addOption(
     *     'verbose',
     *     array(
     *         'short_name'  => '-v',
     *         'long_name'   => '--verbose',
     *         'description' => 'be noisy when installing stuff',
     *         'action'      => 'StoreTrue'
     *      )
     * );
     * $parser->parse();
     * </code>
     * Then in a terminal:
     * <code>
     * $ myscript.php install -h
     * Usage: myscript.php install [options]
     *
     * Options:
     *   -h, --help     display this help message and exit
     *   -v, --verbose  be noisy when installing stuff
     *
     * $ myscript.php install --verbose
     * Installing whatever...
     * $
     * </code>
     *
     * @param mixed $name   a string containing the command name or an
     *                      instance of PEAR2_Console_CommandLine_Command
     * @param array $params an array containing the command attributes
     *
     * @return object PEAR2_Console_CommandLine_Command
     * @access public
     * @see    PEAR2_Console_CommandLine_Command
     */
    public function addCommand($name, $params=array())
    {
        if ($name instanceof PEAR2_Console_CommandLine_Command) {
            $command = $name;
        } else {
            $params['name'] = $name;
            $command        = new PEAR2_Console_CommandLine_Command($params);
        }
        $command->parent                = $this;
        $this->commands[$command->name] = $command;
        return $command;
    }

    // }}}
    // addOption() {{{

    /**
     * Add an option to the command line parser.
     *
     * Add an option with the name (variable name) $optname and set its 
     * attributes with the array $params, then return the
     * PEAR2_Console_CommandLine_Option instance created.
     * The method accepts another form: you can directly pass a 
     * PEAR2_Console_CommandLine_Option object as the sole argument, this allows to
     * contruct  the option separately, in order to reuse an option in
     * different command line parsers or commands for example.
     *
     * Example:
     * <code>
     * $parser = new PEAR2_Console_CommandLine();
     * $parser->addOption('path', array(
     *     'short_name'  => '-p',  // a short name
     *     'long_name'   => '--path', // a long name
     *     'description' => 'path to the dir', // a description msg
     *     'action'      => 'StoreString',
     *     'default'     => '/tmp' // a default value
     * ));
     * $parser->parse();
     * </code>
     *
     * In a terminal, the help will be displayed like this:
     * <code>
     * $ myscript.php --help
     * Usage: myscript.php [options]
     *
     * Options:
     *   -h, --help  display this help message and exit
     *   -p, --path  path to the dir
     *
     * </code>
     *
     * Various methods to specify an option, these 3 commands are equivalent:
     * <code>
     * $ myscript.php --path=some/path
     * $ myscript.php -p some/path
     * $ myscript.php -psome/path
     * </code>
     *
     * @param mixed $name   a string containing the option name or an
     *                      instance of PEAR2_Console_CommandLine_Option
     * @param array $params an array containing the option attributes
     *
     * @return object PEAR2_Console_CommandLine_Option
     * @access public
     * @see    PEAR2_Console_CommandLine_Option
     */
    public function addOption($name, $params=array())
    {
        if ($name instanceof PEAR2_Console_CommandLine_Option) {
            $opt = $name;
        } else {
            $opt = new PEAR2_Console_CommandLine_Option($name, $params);
        }
        $opt->validate();
        $this->options[$opt->name] = $opt;
        return $opt;
    }

    // }}}
    // displayError() {{{

    /**
     * Display an error to the user and exit with $exitCode.
     *
     * @param string $error    the error message
     * @param int    $exitCode the exit code number
     *
     * @return void
     * @access public
     */
    public function displayError($error, $exitCode = 1)
    {
        $this->outputter->stderr($this->renderer->error($error));
        exit($exitCode);
    }

    // }}}
    // displayUsage() {{{

    /**
     * Display the usage help message to the user and exit with $exitCode
     *
     * @param int $exitCode the exit code number
     *
     * @return void
     * @access public
     */
    public function displayUsage($exitCode = 1)
    {
        $this->outputter->stderr($this->renderer->usage());
        exit($exitCode);
    }

    // }}}
    // displayVersion() {{{

    /**
     * Display the program version to the user
     *
     * @return void
     * @access public
     */
    public function displayVersion()
    {
        $this->outputter->stdout($this->renderer->version());
        exit(0);
    }

    // }}}
    // findOption() {{{

    /**
     * Find the option that matches the given short_name (ex: -v), long_name
     * (ex: --verbose) or name (ex: verbose).
     *
     * @param string $str the option identifier
     *
     * @return mixed a PEAR2_Console_CommandLine_Option instance or false
     * @access public
     */
    public function findOption($str)
    {
        $str = trim($str);
        if ($str === '') {
            return false;
        }
        $matches = array();
        foreach ($this->options as $opt) {
            if ($opt->short_name == $str || $opt->long_name == $str ||
                $opt->name == $str) {
                // exact match
                return $opt;
            }
            if (substr($opt->long_name, 0, strlen($str)) === $str) {
                // abbreviated long option
                $matches[] = $opt;
            }
        }
        if ($count = count($matches)) {
            if ($count > 1) {
                $matches_str = '';
                $padding     = '';
                foreach ($matches as $opt) {
                    $matches_str .= $padding . $opt->long_name;
                    $padding      = ', ';
                }
                throw PEAR2_Console_CommandLine_Exception::build(
                    'OPTION_AMBIGUOUS',
                    array('name' => $str, 'matches' => $matches_str),
                    $this
                );
            }
            return $matches[0];
        }
        return false;
    }
    // }}}
    // registerAction() {{{

    /**
     * Register a custom action for the parser, an example:
     *
     * <code>
     * <?php
     *
     * // in this example we create a "range" action:
     * // the user will be able to enter something like:
     * // $ <program> -r 1,5
     * // and in the result we will have:
     * // $result->options['range']: array(1, 5)
     *
     * class ActionRange extends PEAR2_Console_CommandLine_Action
     * {
     *     public function execute($value=false, $params=array())
     *     {
     *         $range = explode(',', str_replace(' ', '', $value));
     *         if (count($range) != 2) {
     *             throw new Exception(sprintf(
     *                 'Option "%s" must be 2 integers separated by a comma',
     *                 $this->option->name
     *             ));
     *         }
     *         $this->setResult($range);
     *     }
     * }
     * // then we can register our action
     * PEAR2_Console_CommandLine::registerAction('Range', 'ActionRange');
     * // and now our action is available !
     * $parser = new PEAR2_Console_CommandLine();
     * $parser->addOption('range', array(
     *     'short_name'  => '-r',
     *     'long_name'   => '--range',
     *     'action'      => 'Range', // note our custom action
     *     'description' => 'A range of two integers separated by a comma'
     * ));
     * // etc...
     *
     * ?>
     * </code>
     *
     * @param string $name  the name of the custom action
     * @param string $class the class name of the custom action
     *
     * @return void
     * @access public
     * @static
     */
    public static function registerAction($name, $class) 
    {
        if (!isset(self::$actions[$name])) {
            if (!class_exists($class)) {
                self::triggerError('action_class_does_not_exists',
                    E_USER_ERROR,
                    array('{$name}' => $name, '{$class}' => $class));
            }
            self::$actions[$name] = array($class, false);
        }
    }

    // }}}
    // triggerError() {{{

    /**
     * A wrapper for programming errors triggering.
     *
     * @param string $msgId  identifier of the message
     * @param int    $level  the php error level
     * @param array  $params an array of search=>replaces entries
     *
     * @return void
     * @access public
     * @static
     */
    public static function triggerError($msgId, $level, $params=array()) 
    {
        if (isset(self::$errors[$msgId])) {
            $msg = str_replace(array_keys($params),
                array_values($params), self::$errors[$msgId]); 
            trigger_error($msg, $level);
        } else {
            trigger_error('unknown error', $level);
        }
    }

    // }}}
    // parse() {{{

    /**
     * Parse the command line arguments and return a PEAR2_Console_CommandLine_Result 
     * object.
     *
     * @param integer $userArgc number of arguments (optional)
     * @param array   $userArgv array containing arguments (optional)
     * @param integer $beginAt  beginning index of the argv array (optional)
     *
     * @return object PEAR2_Console_CommandLine_Result
     * @access public
     * @throws Exception on user errors
     */
    public function parse($userArgc=null, $userArgv=null)
    {
        $this->addBuiltinOptions();
        if ($userArgc !== null && $userArgv !== null) {
            $argc = $userArgc;
            $argv = $userArgv;
        } else {
            list($argc, $argv) = $this->getArgcArgv();
        }
        // build an empty result
        $result = new PEAR2_Console_CommandLine_Result();
        if (!$argc || empty($argv)) {
            return $result;
        }
        if (!($this instanceof PEAR2_Console_CommandLine_Command)) {
            // remove script name if we're not in a subcommand
            array_shift($argv);
            $argc--;
        }
        // will contain aruments
        $args = array();
        foreach ($this->options as $name=>$option) {
            $result->options[$name] = $option->default;
        }
        // parse command line tokens
        while ($argc--) {
            $token = array_shift($argv);
            try {
                if (isset($this->commands[$token])) {
                    $result->command_name = $token;
                    $result->command      = $this->commands[$token]->parse($argc,
                        $argv);
                    break;
                } else {
                    $this->parseToken($token, $result, $args, $argc);
                }
            } catch (Exception $exc) {
                throw $exc;
            }
        }
        // minimum argument number check
        $argnum = count($this->args);
        if (count($args) < $argnum) {
            throw PEAR2_Console_CommandLine_Exception::build(
                'ARGUMENT_REQUIRED',
                array('argnum' => $argnum, 'plural' => $argnum>1 ? 's': ''),
                $this
            );
        }
        // handle arguments
        $c = count($this->args);
        foreach ($this->args as $name=>$arg) {
            $c--;
            if ($arg->multiple) {
                $result->args[$name] = $c ? array_splice($args, 0, -$c) : $args;
            } else {
                $result->args[$name] = array_shift($args);
            }
        }
        // dispatch deferred options
        foreach ($this->_dispatchLater as $optArray) {
            $optArray[0]->dispatchAction($optArray[1], $optArray[2], $this);
        }
        return $result;
    }

    // }}}
    // parseToken() {{{

    /**
     * Parse the command line token and modify *by reference* the $options and 
     * $args arrays.
     *
     * @param string $token  the command line token to parse
     * @param object $result the PEAR2_Console_CommandLine_Result instance
     * @param array  &$args  the argv array
     * @param int    $argc   number of lasting args
     *
     * @return void
     * @access protected
     * @throws Exception on user errors
     */
    protected function parseToken($token, $result, &$args, $argc)
    {
        static $lastopt  = false;
        static $stopflag = false;
        $last  = $argc === 0;
        $token = trim($token);
        if (!$stopflag && $lastopt) {
            if (substr($token, 0, 1) == '-') {
                if ($lastopt->argument_optional) {
                    $this->_dispatchAction($lastopt, '', $result);
                    if ($lastopt->action != 'StoreArray') {
                        $lastopt = false;
                    }
                } else if (isset($result->options[$lastopt->name])) {
                    // case of an option that expect a list of args
                    $lastopt = false;
                } else {
                    throw PEAR2_Console_CommandLine_Exception::build(
                        'OPTION_VALUE_REQUIRED',
                        array('name' => $lastopt->name),
                        $this
                    );
                }
            } else {
                // when a StoreArray option is positioned last, the behavior
                // is to consider that if there's already an element in the
                // array, and the commandline expects one or more args, we
                // leave last tokens to arguments
                if ($lastopt->action == 'StoreArray' && 
                    !empty($result->options[$lastopt->name]) &&
                    count($this->args) > ($argc + count($args))) {
                    $args[] = $token;
                    return;
                }
                $this->_dispatchAction($lastopt, $token, $result);
                if ($lastopt->action != 'StoreArray') {
                    $lastopt = false;
                }
                return;
            }
        }
        if (!$stopflag && substr($token, 0, 2) == '--') {
            // a long option
            $optkv = explode('=', $token, 2);
            if (trim($optkv[0]) == '--') {
                // the special argument "--" forces in all cases the end of 
                // option scanning.
                $stopflag = true;
                return;
            }
            $opt = $this->findOption($optkv[0]);
            if (!$opt) {
                throw PEAR2_Console_CommandLine_Exception::build(
                    'OPTION_UNKNOWN',
                    array('name' => $optkv[0]),
                    $this
                );
            }
            $value = isset($optkv[1]) ? $optkv[1] : false;
            if (!$opt->expectsArgument() && $value !== false) {
                throw PEAR2_Console_CommandLine_Exception::build(
                    'OPTION_VALUE_UNEXPECTED',
                    array('name' => $opt->name, 'value' => $value),
                    $this
                );
            }
            if ($opt->expectsArgument() && $value === false) {
                // maybe the long option argument is separated by a space, if 
                // this is the case it will be the next arg
                if ($last && !$opt->argument_optional) {
                    throw PEAR2_Console_CommandLine_Exception::build(
                        'OPTION_VALUE_REQUIRED',
                        array('name' => $opt->name),
                        $this
                    );
                }
                // we will have a value next time
                $lastopt = $opt;
                return;
            }
            if ($opt->action == 'StoreArray') {
                $lastopt = $opt;
            }
            $this->_dispatchAction($opt, $value, $result);
        } else if (!$stopflag && substr($token, 0, 1) == '-') {
            // a short option
            $optname = substr($token, 0, 2);
            if ($optname == '-') {
                // special case of "-" passed on the command line, it should be 
                // treated as an argument
                $args[] = $optname;
                return;
            }
            $opt = $this->findOption($optname);
            if (!$opt) {
                throw PEAR2_Console_CommandLine_Exception::build(
                    'OPTION_UNKNOWN',
                    array('name' => $optname),
                    $this
                );
            }
            // parse other options or set the value
            // in short: handle -f<value> and -f <value>
            $next = substr($token, 2, 1);
            // check if we must wait for a value
            if ($next === false) {
                if ($opt->expectsArgument()) {
                    if ($last && !$opt->argument_optional) {
                        throw PEAR2_Console_CommandLine_Exception::build(
                            'OPTION_VALUE_REQUIRED',
                            array('name' => $opt->name),
                            $this
                        );
                    }
                    // we will have a value next time
                    $lastopt = $opt;
                    return;
                }
                $value = false;
            } else {
                if (!$opt->expectsArgument()) { 
                    if ($nextopt = $this->findOption('-' . $next)) {
                        $this->_dispatchAction($opt, false, $result);
                        $this->parseToken('-' . substr($token, 2), $result,
                            $args, $last);
                        return;
                    } else {
                        throw PEAR2_Console_CommandLine_Exception::build(
                            'OPTION_UNKNOWN',
                            array('name' => $next),
                            $this
                        );
                    }
                }
                if ($opt->action == 'StoreArray') {
                    $lastopt = $opt;
                }
                $value = substr($token, 2);
            }
            $this->_dispatchAction($opt, $value, $result);
        } else {
            // We have an argument.
            // if we are in POSIX compliant mode, we must set the stop flag to 
            // true in order to stop option parsing.
            if (!$stopflag && $this->force_posix) {
                $stopflag = true;
            }
            $args[] = $token;
        }
    }

    // }}}
    // addBuiltinOptions() {{{

    /**
     * Add the builtin "Help" and "Version" options if needed.
     *
     * @return void
     * @access protected 
     */
    public function addBuiltinOptions()
    {
        if ($this->add_help_option) {
            $helpOptionParams = array(
                'long_name'   => '--help',
                'description' => 'show this help message and exit',
                'action'      => 'Help'   
            );
            if (!($option = $this->findOption('-h')) || $option->action == 'Help') {
                // short name is available, take it
                $helpOptionParams['short_name'] = '-h';
            }
            $this->addOption('help', $helpOptionParams);
        }
        if ($this->add_version_option && !empty($this->version)) {
            $versionOptionParams = array(
                'long_name'   => '--version',
                'description' => 'show the program version and exit',
                'action'      => 'Version'   
            );
            if (!$this->findOption('-v')) {
                // short name is available, take it
                $versionOptionParams['short_name'] = '-v';
            }
            $this->addOption('version', $versionOptionParams);
        }
    } 

    // }}}
    // getArgcArgv() {{{

    /**
     * Try to return an array containing argc and argv, or trigger an error
     * if it fails to get them.
     *
     * @return array
     * @access protected
     * @throws Exception 
     */
    protected function getArgcArgv()
    {
        if (php_sapi_name() != 'cli') {
            // we have a web request
            $argv = array($this->name);
            if (isset($_REQUEST)) {
                foreach ($_REQUEST as $key => $value) {
                    if (!is_array($value)) {
                        $value = array($value);
                    }
                    $opt = $this->findOption($key);
                    if ($opt instanceof PEAR2_Console_CommandLine_Option) {
                        // match a configured option
                        $argv[] = $opt->short_name ? 
                            $opt->short_name : $opt->long_name;
                        foreach($value as $v) {
                            if ($opt->expectsArgument()) {
                                $argv[] = isset($_GET[$key]) ? urldecode($v) : $v;
                            } else if ($v == '0' || $v == 'false') {
                                array_pop($argv);
                            }
                        }
                    } else if (isset($this->args[$key])) {
                        // match a configured argument
                        foreach($value as $v) {
                            $argv[] = isset($_GET[$key]) ? urldecode($v) : $v;
                        }
                    }
                }
            }
            return array(count($argv), $argv);
        }
        if (isset($argc) && isset($argv)) {
            // case of register_argv_argc = 1
            return array($argc, $argv);
        }
        if (isset($_SERVER['argc']) && isset($_SERVER['argv'])) {
            return array($_SERVER['argc'], $_SERVER['argv']);
        }
        return array(0, array());
    }

    // }}}
    // _dispatchAction() {{{

    /**
     * Dispatch the given option or store the option to dispatch it later.
     *
     * @param object $option an instance of PEAR2_Console_CommandLine_Option
     * @param string $token  the command line token to parse
     * @param object $result the PEAR2_Console_CommandLine_Result instance
     *
     * @return void
     * @access protected
     * @throws Exception on user errors
     */
    private function _dispatchAction($option, $token, $result)
    {
        if ($option->action == 'Password') {
            $this->_dispatchLater[] = array($option, $token, $result);
        } else {
            $option->dispatchAction($token, $result, $this);
        }
    }
    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * A lightweight class to store the result of the command line parsing.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Console_CommandLine_Result
{
    // Public properties {{{

    /**
     * The result options associative array.
     * Key is the name of the option and value its value.
     *
     * @var array $options
     * @access public
     */
    public $options = array();

    /**
     * The result arguments array.
     *
     * @var array $args
     * @access public
     */
    public $args = array();

    /**
     * Name of the command invoked by the user, false if no command invoked.
     *
     * @var string $command_name
     * @access public
     */
    public $command_name = false;

    /**
     * A result instance for the command.
     *
     * @var object CommandLine_Result
     * @access public
     */
    public $command = false;

    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * Renderers common interface, all renderers must implement this interface.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
interface PEAR2_Console_CommandLine_Renderer
{
    // usage() {{{

    /**
     * Return the full usage message.
     *
     * @access public
     * @return string the usage message
     */
    public function usage();

    // }}}
    // error() {{{

    /**
     * Return a formatted error message
     *
     * @param string $error the error message to format
     *
     * @access public
     * @return string the error string
     */
    public function error($error);

    // }}}
    // version() {{{

    /**
     * Return the program version string.
     *
     * @access public
     * @return string the version string
     */
    public function version();

    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * Outputters common interface, all outputters must implement this interface.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
interface PEAR2_Console_CommandLine_Outputter
{
    // stdout() {{{

    /**
     * Process the output for a message that should be displayed on STDOUT
     *
     * @param string $msg the message to output
     *
     * @access public
     * @return void
     */
    public function stdout($msg);

    // }}}
    // stderr() {{{

    /**
     * Process the output for a message that should be displayed on STDERR
     *
     * @param string $msg the message to output
     *
     * @access public
     * @return void
     */
    public function stderr($msg);

    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * Class that represent a commandline option.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Console_CommandLine_Option extends PEAR2_Console_CommandLine_Element
{
    // Public properties {{{

    /**
     * The option short name (ex: -v).
     *
     * @var string $short_name
     * @access public
     */
    public $short_name;

    /**
     * The option long name (ex: --verbose).
     *
     * @var string $long_name
     * @access public
     */
    public $long_name;

    /**
     * The option action, defaults to StoreString.
     *
     * @var int $action
     * @access public
     */
    public $action = 'StoreString';

    /**
     * The default value of the option if not provided on the command line.
     *
     * @var mixed $default
     * @access public
     */
    public $default;

    /**
     * An array of possible values for the option if this array is not empty 
     * and the value passed is not in the array an exception is raised.
     * This only make sense for actions that accept values of course.
     *
     * @var array $choices
     * @access public
     */
    public $choices = array();

    /**
     * The callback function (or method) to call for an action of type 
     * Callback, this can be any callable supported by the php function 
     * call_user_func.
     * 
     * Example:
     *
     * <code>
     * $parser->addOption('myoption', array(
     *     'short_name' => '-m',
     *     'long_name'  => '--myoption',
     *     'action'     => 'Callback',
     *     'callback'   => 'myCallbackFunction'
     * ));
     * </code>
     *
     * @var    mixed $callback
     * @access public
     */
    public $callback;

    /**
     * An associative array of additional params to pass to the class 
     * corresponding to the action, this array will also be passed to the 
     * callback defined for an action of type Callback, Example:
     *
     * <code>
     * // for a custom action
     * $parser->addOption('myoption', array(
     *     'short_name'    => '-m',
     *     'long_name'     => '--myoption',
     *     'action'        => 'MyCustomAction',
     *     'action_params' => array('foo'=>true, 'bar'=>false)
     * ));
     *
     * // if the user type:
     * // $ <yourprogram> -m spam
     * // in your MyCustomAction class the execute() method will be called
     * // with the value 'spam' as first parameter and 
     * // array('foo'=>true, 'bar'=>false) as second parameter
     * </code>
     *
     * @var    array $action_params
     * @access public
     */
    public $action_params = array();

    /**
     * For options that expect an argument, this property tells the parser if 
     * the argument is optional and can be ommited
     *
     * @var boolean $argumentOptional
     * @access public
     */
    public $argument_optional = false;

    // }}}
    // __construct() {{{

    /**
     * Constructor.
     *
     * @param string $name   the name of the element
     * @param array  $params an optional array of parameters
     *
     * @access public
     */
    public function __construct($name = null, $params = array()) 
    {
        parent::__construct($name, $params);
        if ($this->action == 'Password') {
            // special case for Password action, password can be passed to the 
            // commandline or prompted by the parser
            $this->argument_optional = true;
        }
    }

    // }}}
    // toString() {{{

    /**
     * Return the string representation of the option.
     *
     * @access public
     * @return string
     */
    public function toString()
    {
        $ret     = '';
        $padding = '';
        if ($this->short_name != null) {
            $ret .= $this->short_name;
            if ($this->expectsArgument()) {
                $ret .= ' ' . $this->help_name;
            }
            $padding = ', ';
        }
        if ($this->long_name != null) {
            $ret .= $padding . $this->long_name;
            if ($this->expectsArgument()) {
                $ret .= '=' . $this->help_name;
            }
        }
        return $ret;
    }

    // }}}
    // expectsArgument() {{{

    /**
     * Return true if the option requires one or more argument and false 
     * otherwise.
     *
     * @access public
     * @return boolean
     */
    public function expectsArgument()
    {
        if ($this->action == 'StoreTrue' || $this->action == 'StoreFalse' ||
            $this->action == 'Help' || $this->action == 'Version' ||
            $this->action == 'Counter') {
            return false;
        }
        return true;
    }

    // }}}
    // dispatchAction() {{{

    /**
     * Format the value $value according to the action of the option and 
     * update the passed PEAR2_Console_CommandLine_Result object.
     *
     * @param mixed  $value  the value to format
     * @param object $result a PEAR2_Console_CommandLine_Result instance
     * @param object $parser a PEAR2_Console_CommandLine instance
     *
     * @return void
     * @access public
     */
    public function dispatchAction($value, $result, $parser)
    {
        // check value is in option choices
        if (!empty($this->choices) && !in_array($value, $this->choices)) {
            throw PEAR2_Console_CommandLine_Exception::build(
                'OPTION_VALUE_NOT_VALID',
                array(
                    'name'    => $this->name,
                    'choices' => implode('", "', $this->choices),
                    'value'   => $value,
                ),
                $parser
            );
        }
        $actionInfo = PEAR2_Console_CommandLine::$actions[$this->action];
        if (true === $actionInfo[1]) {
            // we have a "builtin" action
            $tokens = explode('_', $actionInfo[0]);
        }
        $clsname = $actionInfo[0];
        $action  = new $clsname($result, $this, $parser);
        $action->execute($value, $this->action_params);
    }

    // }}}
    // validate() {{{

    /**
     * Validate the option instance.
     *
     * @access public
     * @return void
     */
    public function validate()
    {
        // check if the option name is valid
        if (!preg_match('/^[a-zA-Z_\x7f-\xff]+[a-zA-Z0-9_\x7f-\xff]*$/',
            $this->name)) {
            PEAR2_Console_CommandLine::triggerError(
                'option_bad_name',
                E_USER_ERROR,
                array('{$name}' => $this->name)
            );
        }
        // call the parent validate method
        parent::validate();
        // a short_name or a long_name must be provided
        if ($this->short_name == null && $this->long_name == null) {
            PEAR2_Console_CommandLine::triggerError(
                'option_long_and_short_name_missing',
                E_USER_ERROR,
                array('{$name}' => $this->name)
            );
        }
        // check if the option short_name is valid
        if ($this->short_name != null && 
            !(preg_match('/^\-[a-zA-Z]{1}$/', $this->short_name))) {
            PEAR2_Console_CommandLine::triggerError(
                'option_bad_short_name',
                E_USER_ERROR, 
                array(
                    '{$name}' => $this->name, 
                    '{$short_name}' => $this->short_name
                )
            );
        }
        // check if the option long_name is valid
        if ($this->long_name != null && 
            !preg_match('/^\-\-[a-zA-Z]+[a-zA-Z0-9_\-]*$/', $this->long_name)) {
            PEAR2_Console_CommandLine::triggerError(
                'option_bad_long_name',
                E_USER_ERROR, 
                array(
                    '{$name}' => $this->name, 
                    '{$long_name}' => $this->long_name
                )
            );
        }
        // check if we have a valid action
        if (!is_string($this->action)) {
            PEAR2_Console_CommandLine::triggerError(
                'option_bad_action',
                E_USER_ERROR,
                array('{$name}' => $this->name)
            );
        }
        if (!isset(PEAR2_Console_CommandLine::$actions[$this->action])) {
            PEAR2_Console_CommandLine::triggerError(
                'option_unregistered_action',
                E_USER_ERROR,
                array(
                    '{$action}' => $this->action,
                    '{$name}' => $this->name
                )
            );
        }
        // if the action is a callback, check that we have a valid callback
        if ($this->action == 'Callback' && !is_callable($this->callback)) {
            PEAR2_Console_CommandLine::triggerError(
                'option_invalid_callback',
                E_USER_ERROR, 
                array('{$name}' => $this->name)
            );
        }
    }

    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * Message providers common interface, all message providers must implement
 * this interface.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
interface PEAR2_Console_CommandLine_MessageProvider
{
    // get() {{{

    /**
     * Retrieve the given string identifier corresponding message.
     *
     * @param string $code the string identifier of the message
     * @param array  $vars an array of template variables
     *
     * @return string
     * @access public
     */
    public function get($code, $vars=array());

    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * Class for exceptions raised by the PEAR2_Console_CommandLine package.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Console_CommandLine_Exception extends PEAR2_Exception
{
    // Codes constants {{{

    /**#@+
     * Exception code constants.
     */
    const OPTION_VALUE_REQUIRED   = 1;
    const OPTION_VALUE_UNEXPECTED = 2;
    const OPTION_VALUE_TYPE_ERROR = 3;
    const OPTION_UNKNOWN          = 4;
    const ARGUMENT_REQUIRED       = 5;
    /**#@-*/

    // }}}
    // build() {{{

    /**
     * Convenience method that builds the exception with the array of params by 
     * calling the message provider class.
     *
     * @param string $code   the string identifier of the exception
     * @param array  $params an array containing the vars of the message tpl
     * @param object $parser an instance of PEAR2_Console_CommandLine
     *
     * @return object an instance of PEAR2_Console_CommandLine_Exception
     * @access public
     * @static
     */
    public static function build($code, $params, $parser)
    {
        $msg   = $parser->message_provider->get($code, $params);
        $const = 'PEAR2_Console_CommandLine_Exception::' . $code;
        $code  = defined($const) ? constant($const) : 0;
        return new PEAR2_Console_CommandLine_Exception($msg, $code);
    }

    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * Class that represent a command line element (an option, or an argument).
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
abstract class PEAR2_Console_CommandLine_Element
{
    // Public properties {{{

    /**
     * The element name.
     *
     * @var    string $name
     * @access public
     */
    public $name;

    /**
     * The name of variable displayed in the usage message, if no set it 
     * defaults to the "name" property.
     *
     * @var    string $help_name
     * @access public
     */
    public $help_name;

    /**
     * The element description.
     *
     * @var    string $description
     * @access public
     */
    public $description;

    // }}}
    // __construct() {{{

    /**
     * Constructor.
     *
     * @param string $name   the name of the element
     * @param array  $params an optional array of parameters
     *
     * @access public
     */
    public function __construct($name = null, $params = array()) 
    {
        $this->name = $name;
        foreach ($params as $attr=>$value) {
            if (property_exists($this, $attr)) {
                $this->$attr = $value;
            }
        }
    }

    // }}}
    // toString() {{{

    /**
     * Return the string representation of the argument.
     *
     * @access public
     * @return string
     */
    public function toString()
    {
        return $this->help_name;
    }
    // }}}
    // validate() {{{

    /**
     * Validate the option instance.
     *
     * @access public
     * @return void
     */
    public function validate()
    {
        // if no help_name passed, default to name
        if ($this->help_name == null) {
            $this->help_name = $this->name;
        }
    }

    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * Class that represent a command with option and arguments.
 *
 * This class exist just to clarify the interface but at the moment it is 
 * strictly identical to PEAR2_Console_CommandLine class, it could change in the
 * future though.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Console_CommandLine_Command extends PEAR2_Console_CommandLine
{
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * Class that represent a command line argument.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Console_CommandLine_Argument extends PEAR2_Console_CommandLine_Element
{
    // Public properties {{{

    /**
     * If set to true argument values will be stored in an array.
     *
     * @var    boolean $multiple
     * @access public
     */
    public $multiple = false;

    // }}}
    // validate() {{{

    /**
     * Validate the option instance.
     *
     * @access public
     * @return void
     */
    public function validate()
    {
        // check if the option name is valid
        if (!preg_match('/^[a-zA-Z_\x7f-\xff]+[a-zA-Z0-9_\x7f-\xff]*$/',
            $this->name)) {
            PEAR2_Console_CommandLine::triggerError(
                'argument_bad_name',
                E_USER_ERROR,
                array('{$name}' => $this->name)
            );
        }
        parent::validate();
    }

    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * F
 * Class that represent an option action.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 * @abstract
 */
abstract class PEAR2_Console_CommandLine_Action
{
    // Properties {{{

    /**
     * A reference to the result instance.
     *
     * @var    object PEAR2_Console_CommandLine_Result $result
     * @access protected
     */
    protected $result;

    /**
     * A reference to the option instance.
     *
     * @var    object PEAR2_Console_CommandLine_Option $option
     * @access protected
     */
    protected $option;

    /**
     * A reference to the parser instance.
     *
     * @var    object PEAR2_Console_CommandLine $parser
     * @access protected
     */
    protected $parser;

    // }}}
    // __construct() {{{

    /**
     * Constructor
     *
     * @param object $result a PEAR2_Console_CommandLine_Result instance
     * @param object $option a PEAR2_Console_CommandLine_Option instance
     * @param object $parser a PEAR2_Console_CommandLine instance
     *
     * @access public
     */
    public function __construct($result, $option, $parser)
    {
        $this->result = $result;
        $this->option = $option;
        $this->parser = $parser;
    }

    // }}}
    // getResult() {{{

    /**
     * Convenience method to retrieve the value of result->options[name].
     *
     * @return mixed $value the assigned value or null
     * @access public
     */
    public function getResult()
    {
        if (isset($this->result->options[$this->option->name])) {
            return $this->result->options[$this->option->name];
        }
        return null;
    }

    // }}}
    // setResult() {{{

    /**
     * Convenience method to assign the result->options[name] value.
     *
     * @param mixed $result the option value
     *
     * @return void
     * @access public
     */
    public function setResult($result)
    {
        $this->result->options[$this->option->name] = $result;
    }

    // }}}
    // execute() {{{

    /**
     * Execute the action with the value entered by the user.
     *
     * @param mixed $value  the option value
     * @param array $params an optional array of parameters
     *
     * @return string
     * @access public
     * @abstract
     */
    abstract public function execute($value=false, $params=array());
    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * PEAR2_Console_CommandLine default renderer.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Console_CommandLine_Renderer_Default implements PEAR2_Console_CommandLine_Renderer
{
    // Properties {{{

    /**
     * integer that define the max width of the help text
     *
     * @var    integer $line_width
     * @access public
     */
    public $line_width = 75;

    /**
     * An instance of PEAR2_Console_CommandLine
     *
     * @var    object PEAR2_Console_CommandLine $parser
     * @access public
     */
    public $parser = false;

    // }}}
    // __construct() {{{

    /**
     * Constructor.
     *
     * @param object $parser a PEAR2_Console_CommandLine instance
     *
     * @access public
     */
    public function __construct($parser = false) 
    {
        $this->parser = $parser;
    }

    // }}}
    // usage() {{{

    /**
     * Return the full usage message
     *
     * @return string the usage message
     * @access public
     */
    public function usage()
    {
        $ret = '';
        if (!empty($this->parser->description)) { 
            $ret .= $this->description() . "\n\n";
        }
        $ret .= $this->usageLine() . "\n";
        if (count($this->parser->commands) > 0) {
            $ret .= $this->commandUsageLine() . "\n";
        }
        if (count($this->parser->options) > 0) {
            $ret .= "\n" . $this->optionList() . "\n";
        }
        if (count($this->parser->args) > 0) {
            $ret .= "\n" . $this->argumentList() . "\n";
        }
        if (count($this->parser->commands) > 0) {
            $ret .= "\n" . $this->commandList() . "\n";
        }
        $ret .= "\n";
        return $ret;
    }
    // }}}
    // error() {{{

    /**
     * Return a formatted error message
     *
     * @param string $error the error message to format
     *
     * @return string the error string
     * @access public
     */
    public function error($error)
    {
        $ret = 'Error: ' . $error . "\n";
        if ($this->parser->add_help_option) {
            $name = $this->name();
            $ret .= $this->wrap($this->parser->message_provider->get('PROG_HELP_LINE',
                array('progname' => $name))) . "\n";
            if (count($this->parser->commands) > 0) {
                $ret .= $this->wrap($this->parser->message_provider->get('COMMAND_HELP_LINE',
                    array('progname' => $name))) . "\n";
            }
        }
        return $ret;
    }

    // }}}
    // version() {{{

    /**
     * Return the program version string
     *
     * @return string the version string
     * @access public
     */
    public function version()
    {
        return $this->parser->message_provider->get('PROG_VERSION_LINE', array(
            'progname' => $this->name(),
            'version'  => $this->parser->version
        )) . "\n";
    }

    // }}}
    // name() {{{

    /**
     * return the full name of the program or the sub command
     *
     * @return string
     * @access protected
     */
    protected function name()
    {
        $name   = '';
        $parent = $this->parser->parent;
        while ($parent) {
            $name .= $parent->name . ' ';
            if (count($parent->options) > 0) {
                $name .= '[' 
                    . strtolower($this->parser->message_provider->get('OPTION_WORD',
                          array('plural' => 's'))) 
                    . '] ';
            }
            $parent = $parent->parent;
        }
        $name .= $this->parser->name;
        return $this->wrap($name);
    }

    // }}}
    // description() {{{

    /**
     * Return the command line description message
     *
     * @access protected
     * @return string the usage message
     */
    protected function description()
    {
        return $this->wrap($this->parser->description);
    }

    // }}}
    // usageLine() {{{

    /**
     * Return the command line usage message
     *
     * @return string the usage message
     * @access protected
     */
    protected function usageLine()
    {
        $usage = $this->parser->message_provider->get('USAGE_WORD') . ":\n";
        $ret   = $usage . '  ' . $this->name();
        if (count($this->parser->options) > 0) {
            $ret .= ' [' 
                . strtolower($this->parser->message_provider->get('OPTION_WORD'))
                . ']';
        }
        if (count($this->parser->args) > 0) {
            foreach ($this->parser->args as $name=>$arg) {
                $ret .= ' <' . $arg->help_name . ($arg->multiple?'...':'') . '>';
            }
        }
        return $this->columnWrap($ret, 2);
    }

    // }}}
    // commandUsageLine() {{{

    /**
     * Return the command line usage message for subcommands
     *
     * @return string
     * @access protected
     */
    protected function commandUsageLine()
    {
        if (count($this->parser->commands) == 0) {
            return '';
        }
        $ret = '  ' . $this->name();
        if (count($this->parser->options) > 0) {
            $ret .= ' [' 
                . strtolower($this->parser->message_provider->get('OPTION_WORD'))
                . ']';
        }
        //XXX
        $ret .= " <command> [options] [args]";
        return $this->columnWrap($ret, 2);
    }

    // }}}
    // argumentList() {{{

    /**
     * Render the arguments list that will be displayed to the user, you can 
     * override this method if you want to change the look of the list.
     *
     * @return string the formatted argument list
     * @access protected
     */
    protected function argumentList()
    {
        $col  = 0;
        $args = array();
        foreach ($this->parser->args as $arg) {
            $argstr = '  ' . $arg->toString();
            $args[] = array($argstr, $arg->description);
            $ln     = strlen($argstr);
            if ($col < $ln) {
                $col = $ln;
            }
        }
        $ret = $this->parser->message_provider->get('ARGUMENT_WORD') . ":";
        foreach ($args as $arg) {
            $text = str_pad($arg[0], $col) . '  ' . $arg[1];
            $ret .= "\n" . $this->columnWrap($text, $col+2);
        }
        return $ret;
    }

    // }}}
    // optionList() {{{

    /**
     * Render the options list that will be displayed to the user, you can 
     * override this method if you want to change the look of the list.
     *
     * @return string the formatted option list
     * @access protected
     */
    protected function optionList()
    {
        $col     = 0;
        $options = array();
        foreach ($this->parser->options as $option) {
            $optstr    = '  ' . $option->toString();
            $options[] = array($optstr, $option->description);
            $ln        = strlen($optstr);
            if ($col < $ln) {
                $col = $ln;
            }
        }
        $ret = $this->parser->message_provider->get('OPTION_WORD') . ":";
        foreach ($options as $option) {
            $text = str_pad($option[0], $col) . '  ' . $option[1];
            $ret .= "\n" . $this->columnWrap($text, $col+2);
        }
        return $ret;
    }

    // }}}
    // commandList() {{{

    /**
     * Render the command list that will be displayed to the user, you can 
     * override this method if you want to change the look of the list.
     *
     * @return string the formatted subcommand list
     * @access protected
     */
    protected function commandList()
    {

        $commands = array();
        $col      = 0;
        foreach ($this->parser->commands as $cmdname=>$command) {
            $cmdname    = '  ' . $cmdname;
            $commands[] = array($cmdname, $command->description);
            $ln         = strlen($cmdname);
            if ($col < $ln) {
                $col = $ln;
            }
        }
        $ret = $this->parser->message_provider->get('COMMAND_WORD') . ":";
        foreach ($commands as $command) {
            $text = str_pad($command[0], $col) . '  ' . $command[1];
            $ret .= "\n" . $this->columnWrap($text, $col+2);
        }
        return $ret;
    }

    // }}}
    // wrap() {{{

    /**
     * Wraps the text passed to the method.
     *
     * @param string $text The text to wrap
     * @param int    $lw   The column width. Defaults to line_width property.
     *
     * @return string
     * @access protected
     */
    protected function wrap($text, $lw=null)
    {
        if ($this->line_width > 0) {
            if ($lw === null) {
                $lw = $this->line_width;
            }
            return wordwrap($text, $lw, "\n", false);
        }
        return $text;
    }

    // }}}
    // columnWrap() {{{

    /**
     * Wraps the text passed to the method at the specified width.
     *
     * @param string $text the text to wrap
     * @param int    $cw   the wrap width
     *
     * @return string
     * @access protected
     */
    protected function columnWrap($text, $cw)
    {
        $tokens = explode("\n", $this->wrap($text));
        $ret    = $tokens[0];
        $chunks = $this->wrap(trim(substr($text, strlen($ret))), 
            $this->line_width - $cw);
        $tokens = explode("\n", $chunks);
        foreach ($tokens as $token) {
            if (!empty($token)) {
                $ret .= "\n" . str_repeat(' ', $cw) . $token;
            }
        }
        return $ret;
    }

    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */


/**
 * PEAR2_Console_CommandLine default Outputter.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Console_CommandLine_Outputter_Default implements PEAR2_Console_CommandLine_Outputter
{
    // stdout() {{{

    /**
     * Writes the message $msg to STDOUT
     *
     * @param string $msg the message to output
     *
     * @return void
     * @access public
     */
    public function stdout($msg)
    {
        if (defined('STDOUT')) {
            fwrite(STDOUT, $msg);
        } else {
            echo $msg;
        }
    }

    // }}}
    // stderr() {{{

    /**
     * Writes the message $msg to STDERR
     *
     * @param string $msg the message to output
     *
     * @return void
     * @access public
     */
    public function stderr($msg)
    {
        if (defined('STDERR')) {
            fwrite(STDERR, $msg);
        } else {
            echo $msg;
        }
    }

    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */


/**
 * Lightweight class that manages messages used by PEAR2_Console_CommandLine package, 
 * allowing the developper to customize these messages, for example to 
 * internationalize a command line frontend.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Console_CommandLine_MessageProvider_Default implements PEAR2_Console_CommandLine_MessageProvider
{
    // Properties {{{

    /**
     * Associative array of messages
     *
     * @var $messages
     * @static
     * @access protected
     */
    protected $messages = array(
        'OPTION_VALUE_REQUIRED'   => 'Option "{$name}" requires a value.',
        'OPTION_VALUE_UNEXPECTED' => 'Option "{$name}" does not expect a value (got "{$value}").',
        'OPTION_VALUE_NOT_VALID'  => 'Option "{$name}" must be one of the following: "{$choices}" (got "{$value}").',
        'OPTION_VALUE_TYPE_ERROR' => 'Option "{$name}" requires a value of type {$type} (got "{$value}").',
        'OPTION_AMBIGUOUS'        => 'Ambiguous option "{$name}", can be one of the following: {$matches}.',
        'OPTION_UNKNOWN'          => 'Unknown option "{$name}".',
        'ARGUMENT_REQUIRED'       => 'You must provide at least {$argnum} argument{$plural}.',
        'PROG_HELP_LINE'          => 'Type "{$progname} -h" to get help.',
        'PROG_VERSION_LINE'       => '{$progname} version {$version}.',
        'COMMAND_HELP_LINE'       => 'Type "{$progname} <command> -h" to get help on specific command.',
        'USAGE_WORD'              => 'Usage',
        'OPTION_WORD'             => 'Options',
        'ARGUMENT_WORD'           => 'Arguments',
        'COMMAND_WORD'            => 'Commands',
        'PASSWORD_PROMPT'         => 'Password: ',
        'PASSWORD_PROMPT_ECHO'    => 'Password (warning: will echo): ',
        'INVALID_CUSTOM_INSTANCE' => 'Instance does not implement the required interface'
    );

    // }}}
    // get() {{{

    /**
     * Retrieve the given string identifier corresponding message.
     *
     * @param string $code the string identifier of the message
     * @param array  $vars an array of template variables
     *
     * @return string
     * @access public
     */
    public function get($code, $vars=array())
    {
        if (!isset($this->messages[$code])) {
            return 'UNKNOWN';
        }
        $tmpkeys = array_keys($vars);
        $keys    = array();
        foreach ($tmpkeys as $key) {
            $keys[] = '{$' . $key . '}';
        }
        return str_replace($keys, array_values($vars), $this->messages[$code]);
    }

    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * Class that represent the Callback action.
 *
 * The result option array entry value is set to the return value of the
 * callback defined in the option.
 *
 * There are two steps to defining a callback option:
 *   - define the option itself using the callback action
 *   - write the callback; this is a function (or method) that takes five
 *     arguments, as described below.
 *
 * All callbacks are called as follows:
 * <code>
 * callable_func(
 *     $value,           // the value of the option
 *     $option_instance, // the option instance
 *     $result_instance, // the result instance
 *     $parser_instance, // the parser instance
 *     $params           // an array of params as specified in the option
 * );
 * </code>
 * and *must* return the option value.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Console_CommandLine_Action_Callback extends PEAR2_Console_CommandLine_Action
{
    // execute() {{{

    /**
     * Execute the action with the value entered by the user.
     *
     * @param mixed $value  the value of the option
     * @param array $params an optional array of parameters
     *
     * @return string
     * @access public
     */
    public function execute($value=false, $params=array())
    {
        $this->setResult(call_user_func($this->option->callback, $value,
            $this->option, $this->result, $this->parser, $params));
    }
    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * Class that represent the Version action.
 *
 * The execute methode add 1 to the value of the result option array entry.
 * The value is incremented each time the option is found, for example
 * with an option defined like that:
 *
 * <code>
 * $parser->addOption(
 *     'verbose',
 *     array(
 *         'short_name' => '-v',
 *         'action'     => 'Counter'
 *     )
 * );
 * </code>
 * If the user type:
 * <code>
 * $ script.php -v -v -v
 * </code>
 * or: 
 * <code>
 * $ script.php -vvv
 * </code>
 * the verbose variable will be set to to 3.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Console_CommandLine_Action_Counter extends PEAR2_Console_CommandLine_Action
{
    // execute() {{{

    /**
     * Execute the action with the value entered by the user.
     *
     * @param mixed $value  the option value
     * @param array $params an optional array of parameters
     *
     * @return string
     * @access public
     */
    public function execute($value=false, $params=array())
    {
        $result = $this->getResult();
        if ($result === null) {
            $result = 0;
        }
        $this->setResult(++$result);
    }
    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * Class that represent the Help action, a special action that displays the
 * help message, telling the user how to use the program.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Console_CommandLine_Action_Help extends PEAR2_Console_CommandLine_Action
{
    // execute() {{{

    /**
     * Execute the action with the value entered by the user.
     *
     * @param mixed $value  the option value
     * @param array $params an optional array of parameters
     *
     * @return string
     * @access public
     */
    public function execute($value=false, $params=array())
    {
        return $this->parser->displayUsage();
    }
    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * Class that represent the StoreFloat action.
 *
 * The execute method store the value of the option entered by the user as a
 * float in the result option array entry, if the value passed is not a float
 * an Exception is raised.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Console_CommandLine_Action_StoreFloat extends PEAR2_Console_CommandLine_Action
{
    // execute() {{{

    /**
     * Execute the action with the value entered by the user.
     *
     * @param mixed $value  the option value
     * @param array $params an array of optional parameters
     *
     * @return string
     * @access public
     */
    public function execute($value=false, $params=array())
    {
        if (!is_numeric($value)) {
            // include_once 'Console/CommandLine/Exception.php';
            throw PEAR2_Console_CommandLine_Exception::build(
                'OPTION_VALUE_TYPE_ERROR',
                array(
                    'name'  => $this->option->name,
                    'type'  => 'float',
                    'value' => $value
                ), 
                $this->parser
            );
        }
        $this->setResult((float)$value);
    }
    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * Class that represent the StoreInt action.
 *
 * The execute method store the value of the option entered by the user as an
 * integer in the result option array entry, if the value passed is not an 
 * integer an Exception is raised.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Console_CommandLine_Action_StoreInt extends PEAR2_Console_CommandLine_Action
{
    // execute() {{{

    /**
     * Execute the action with the value entered by the user.
     *
     * @param mixed $value  the option value
     * @param array $params an array of optional parameters
     *
     * @return string
     * @access public
     */
    public function execute($value=false, $params=array())
    {
        if (!is_numeric($value)) {
            // include_once 'Console/CommandLine/Exception.php';
            throw PEAR2_Console_CommandLine_Exception::build(
                'OPTION_VALUE_TYPE_ERROR',
                array(
                    'name'  => $this->option->name,
                    'type'  => 'int',
                    'value' => $value
                ),
                $this->parser
            );
        }
        $this->setResult((int)$value);
    }
    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * Class that represent the StoreString action.
 *
 * The execute method store the value of the option entered by the user as a 
 * string in the result option array entry.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Console_CommandLine_Action_StoreString extends PEAR2_Console_CommandLine_Action
{
    // execute() {{{

    /**
     * Execute the action with the value entered by the user.
     *
     * @param mixed $value  the option value
     * @param array $params an array of optional parameters
     *
     * @return string
     * @access public
     */
    public function execute($value=false, $params=array())
    {
        $this->setResult((string)$value);
    }
    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * Class that represent the StoreTrue action.
 *
 * The execute method store the boolean 'true' in the corrsponding result
 * option array entry (the value is false if the option is not present in the 
 * command line entered by the user).
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Console_CommandLine_Action_StoreTrue extends PEAR2_Console_CommandLine_Action
{
    // execute() {{{

    /**
     * Execute the action with the value entered by the user.
     *
     * @param mixed $value  the option value
     * @param array $params an array of optional parameters
     *
     * @return string
     * @access public
     */
    public function execute($value=false, $params=array())
    {
        $this->setResult(true);
    }
    // }}}
}

?>
<?php

/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * This file is part of the PEAR2_Console_CommandLine package.
 *
 * PHP version 5
 *
 * LICENSE: This source file is subject to the MIT license that is available
 * through the world-wide-web at the following URI:
 * http://opensource.org/licenses/mit-license.php
 *
 * @category  Console 
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   SVN: $Id$
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     File available since release 0.1.0
 */

/**
 * Class that represent the Version action, a special action that displays the
 * version string of the program.
 *
 * @category  Console
 * @package   PEAR2_Console_CommandLine
 * @author    David JEAN LOUIS <izimobil@gmail.com>
 * @copyright 2007 David JEAN LOUIS
 * @license   http://opensource.org/licenses/mit-license.php MIT License 
 * @version   Release: @package_version@
 * @link      http://pear.php.net/package/Console_CommandLine
 * @since     Class available since release 0.1.0
 */
class PEAR2_Console_CommandLine_Action_Version extends PEAR2_Console_CommandLine_Action
{
    // execute() {{{

    /**
     * Execute the action with the value entered by the user.
     *
     * @param mixed $value  the option value
     * @param array $params an array of optional parameters
     *
     * @return string
     * @access public
     */
    public function execute($value=false, $params=array())
    {
        return $this->parser->displayVersion();
    }
    // }}}
}

?>
≈˝;K±uoªQ`*≠ˆ„%˘   GBMB